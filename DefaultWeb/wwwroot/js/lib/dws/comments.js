//>>built
define(["dws/controller","dws/model"],function(h,b){function g(){$.ajax({url:"/Comments/DeleteSource?sid\x3d"+b.source().id,type:"POST",headers:{RequestVerificationToken:b.xsrfToken()}}).done(function(a,c,d){200==d.status&&b.removeSource(a)}).fail(function(a,c,d){b.abort(a,c,d)})}function k(){$.ajax({url:"/Comments/DeleteComment?cid\x3d"+b.comment().id,type:"POST",headers:{RequestVerificationToken:b.xsrfToken()}}).done(function(a,c,d){200==d.status&&b.removeComment(a)}).fail(function(a,c,d){b.abort(a,
c,d)})}$(document).on("click","#sources-table tbody tr",function(a){a=$(a.currentTarget).attr("id");b.sourceId(a)});$(document).on("click",".comment.card",function(a){a.preventDefault();a=$(a.currentTarget).attr("id");b.commentId(a)});$("#modal-action-template").on("show.bs.modal",function(a){var b=$(this);a=$(a.relatedTarget);b.draggable({handle:".modal-header",cursor:"move"});h.sendMessage(a,"#modal-action-template")});$(document).on("submit","form#create-source",function(a){a.preventDefault();
var c=$(this);c.attr("disabled",!0);a={url:"/Comments/CreateSource",type:"POST",data:c.serializeArray()};$.ajax(a).done(function(a,f,e){200==e.status?(c.closest("#modal-action-template").modal("hide"),b.addSource(a.source)):$("#target-modal").html(a)}).fail(function(a,f,e){c.closest("#modal-action-template").modal("hide");b.abort(a,f,e)})});$(document).on("submit","form#create-comment",function(a){a.preventDefault();var c=$(this);c.attr("disabled",!0);$("input#SourceId.form-control",c).val(b.source().id);
a=c.serializeArray();b.waitingTarget(".modal-header");b.waiting(!0);$.ajax({url:"/Comments/CreateComment",type:"POST",data:a}).done(function(a,f,e){200==e.status?(c.closest("#modal-action-template").modal("hide"),b.addComment(a.comment)):$("#target-modal").html(a)}).fail(function(a,f,e){c.closest("#modal-action-template").modal("hide");b.abort(a,f,e)}).always(function(a,c,e){b.waiting(!1)})});$(document).on("click","a#source-delete",function(a){0<b.comments().length?$.confirm({title:"Cascade Delete Source and Comments?",
content:"There are child Comments! Continuing will delete the Source record and all child Comments. This action can not be undone!!!",buttons:{confirm:function(){g()},cancel:function(){}}}):g()});$(document).on("click","a#comment-delete",function(a){$.confirm({title:"Delete Comment(s)?",content:"This action can not be undone!!!",buttons:{confirm:function(){k()},cancel:function(){}}})});return{GetSources:function(){b.waitingTarget("#navbar-main");b.waiting(!0);$.ajax({url:"/Comments/GetSources",cache:!1}).done(function(a){b.sources([]);
b.sources(a);b.sources.sortByName("sourceName","asc");0<a.length&&b.sourceId(b.sources()[0].id)}).fail(function(a,c,d){b.abort(a,c,d)}).always(function(a,c,d){b.waiting(!1)})}}});