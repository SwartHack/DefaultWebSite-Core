//>>built
define(["dws/controller","dws/thumbnail","dws/model"],function(r,k,c){function l(a){for(var b=0;b<c.mimeTypes().length;b++)if(a.type.match(c.mimeTypes()[b]))return!0;return!1}function f(a){a.stopPropagation();a.preventDefault();$("#file-upload-drop").removeClass("hover");a=a.target.files||a.dataTransfer.files;for(var b=0,d;d=a[b];b++)if(l(d)){var e=d.name;-1<c.uploadFilesInfo().findIndex(function(a){return a.name==e})||k.getThumbFromFile(d,m)}}function m(a,b){var d=c.getFileSize(a.size);c.uploadFilesInfo.push({name:a.name,
size:d,type:a.type,thumbcontext:b});c.uploadFiles.push(a)}function g(a){a=$(a.originalEvent.target).closest(".file-info-container").index();c.uploadFilesInfo.splice(a,1);c.uploadFiles.splice(a,1)}function h(a){a.lengthComputable?(a=Math.round(100*a.loaded/a.total),$("#file-progress").css("width",a+"%").attr("aria-valuenow",a),$("#file-progress span").text(a+"%")):$("#file-progress span").text("unable to compute")}function n(a){a.preventDefault();a.dataTransfer.effectAllowed="copy";a.dataTransfer.dropEffect=
"copy"}function p(){$("#file-upload-drop").addClass("hover")}function q(){$("#file-upload-drop").removeClass("hover")}$(document).on("submit","form#file-upload",function(a){a.preventDefault();a=$(this);var b=$("textarea#description",a[0]).val();if(""==b||10>b.length)$("span#description-validate",a[0]).text("Description is required, ten(10) character minimum...");else{$("textarea#description",a[0]).val(b);$("textarea#description",a[0]).text(b);a.attr("disabled",!0);b=new FormData(a[0]);b.set("files",
"");for(var d=0;d<c.uploadFiles().length;d++){var e=c.uploadFiles()[d];b.append("files",e)}b={url:"/api/dws/files/upload",type:"POST",xhr:function(){var a=$.ajaxSettings.xhr();a.upload&&a.upload.addEventListener("progress",h,!1);return a},data:b,contentType:!1,processData:!1};c.waitingTarget("#navbar-main");c.waiting(!0);$(a,".progress .upload-progress").show();$.ajax(b).done(function(a,b,d){200==d.status?c.serverFiles(a):c.abort(a,b,null)}).fail(function(a,b,d){c.abort(a,b,d)}).always(function(){c.uploadFiles([]);
c.uploadFilesInfo([]);$("#file-ops-client").dialog("close");c.waiting(!1)})}});return{init:function(){$("#file-input").change(function(a){f(a)});$("a#file-upload-open").on("click",function(a){$("#file-ops-client").dialog({minWidth:400,maxWidth:400,modal:!0,title:"Upload Files"})});$(document).on("click","a.upload-file-delete",function(a){a.preventDefault();g(a)});var a=document.getElementById("file-upload-drop");a.addEventListener("dragover",n,!1);a.addEventListener("drop",f,!1);a.addEventListener("dragenter",
p,!1);a.addEventListener("dragleave",q,!1);$.blockUI.defaults.overlayCSS={backgroundColor:"#000",opacity:.6}},progressHandlingFunction:h,fileRemove:g}});