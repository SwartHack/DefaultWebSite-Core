//>>built
define(["dws/model-utils"],function(f){var a={data:ko.observable(""),target:ko.observable(""),dataType:ko.observable(""),dataJson:ko.observable(""),targetJson:ko.observable(""),abort:function(b,c,e){a.errorStatus(c);a.errorXhr(b);a.errorMsg(e)},errorXhr:ko.observable(""),errorStatus:ko.observable(""),errorMsg:ko.observable(""),waiting:ko.observable(!1),waitingTarget:ko.observable(""),xsrfToken:ko.observable([]),sources:ko.observableArray([]),source:ko.observable(""),sourceId:function(b){var c=a.sources().findIndex(function(a){return a.id==
b});a.sourceIndex(c);c=a.sources()[c];a.source(c)},sourceIndex:ko.observable(""),sourcesCount:ko.pureComputed(function(){return"Records: "+a.sources().length},this),addSource:function(b){a.sources.unshift(b);a.sourceId(b.id)},removeSource:function(b){a.sources().findIndex(function(a){return a.id==b});var c=a.sources()[a.sourceIndex()];a.sources.remove(c);a.source("")},sourceAdded:function(a,c,e){$(a);$(e).hide().fadeIn("slow")},comments:ko.observableArray([]),comment:ko.observable(""),commentId:function(b){var c=
a.comments().findIndex(function(a){return a.id==b});a.commentIndex(c);a.comment(a.comments()[c]);return a.comment()},commentIndex:ko.observable(""),commentsCount:ko.pureComputed(function(){return"Records: "+a.comments().length},this),commentTitle:ko.pureComputed(function(){return"Ima a stupid title!"},this),addComment:function(b){a.comments.unshift(b);a.commentId(b.id)},removeComment:function(b){a.comments().findIndex(function(a){return a.id==b});var c=a.comments()[a.commentIndex()];a.comments.remove(c);
a.comment("")},commentAdded:function(a){$(a).hide().fadeIn("slow");console.log("Comment afterAdd... ")},canAddComment:function(){return 0===a.sources().length?!1:!0},uploadFilesInfo:ko.observableArray([]),uploadFiles:ko.observableArray([]),mimeTypes:ko.observableArray(["image/*","application/pdf","video/mp4"]),uploadFilesSize:ko.pureComputed(function(){return a.uploadFiles.sumProperty("size")},this),uploadFilesCount:ko.pureComputed(function(){return a.uploadFiles().length},this),uploadCount:ko.pureComputed(function(){return"Number files: "+
a.uploadFiles().length},this),uploadSize:ko.pureComputed(function(){return"Total size: "+a.getFileSize(a.uploadFiles.sumProperty("size"))},this),showFileUpload:ko.pureComputed(function(){return 0<a.uploadFiles().length&&!a.isMaxUpload()},this),getFileSize:function(a){var b=0;return b=1048576<a?Math.round(100*a/1048576)/100+" MB":1024<a?Math.round(100*a/1024)/100+" KB":a+" bytes"},isMaxUpload:ko.pureComputed(function(){return parseInt(a.uploadFilesSize())+parseInt(a.serverSpaceCurrent())>parseInt(a.serverSpaceMax())},
this),contentCacheQueue:ko.observableArray([]),serverFiles:ko.observableArray([]),serverFile:ko.observable(""),serverSpaceMax:ko.observable(1E7),serverSpaceCurrent:ko.pureComputed(function(){return a.serverFiles.sumProperty("fileSize")},this),serverFilesCount:ko.pureComputed(function(){return a.serverFiles().length},this),serverSpace:ko.pureComputed(function(){var b=a.serverSpaceMax(),c=a.serverSpaceCurrent(),b=parseInt(b)-parseInt(c);return a.getFileSize(b)},this),imageViewApi:ko.pureComputed(function(){return a.serverFile().fileApi},
this),pdfWorker:ko.observable(""),exif:ko.observableArray([]),viewMap:ko.observable(""),mapView:ko.observable(""),sceneView:ko.observable(""),viewInfo:ko.observable(""),viewInfoIcon:function(a,c){$(a).empty();c?$(a).append('\x3ci class\x3d"fa fa-check-square"\x3e'):$(a).append('\x3ci class\x3d"fa fa-square"\x3e')},cursorMap:ko.observable(""),cursorScreen:ko.observable("")};a.errorMsg.subscribe(function(b){null!=b?(b=$("#ajax-error"),ko.dataFor(b[0])||ko.applyBindings(a,b[0]),$(b).html(a.errorXhr().responseText),
$("#ajax-error").dialog({maxWidth:800,maxHeight:600,width:800,autoOpen:!0,modal:!0,buttons:{OK:function(){$(this).dialog("close")}}})):$("viewModel.errorData").dialog()});a.data.subscribe(function(b){a.target()?$(a.target()).html(b):$(b).dialog()});a.source.subscribe(function(b){if(b){var c=$($("#sources-table tbody tr")[a.sourceIndex()]);c.addClass("active").siblings().removeClass("active");a.comments(null==b.comments?[]:b.comments);0<a.comments().length&&a.commentId(a.comments()[0].id);a.sources.sortByName("sourceName",
"asc");c.scrollToTop()}else a.comments([]),1<=a.sources().length&&(c=parseInt(a.sourceIndex()),b="NaN"!=c?c-1:0,c="NaN"!=c?c:0,b=0<=b?a.sources()[b]:a.sources()[c],a.sourceId(b.id))});a.comment.subscribe(function(b){if(b)b=$("#comments.list-group").children(),b=$(b[a.commentIndex()]),b.addClass("active").siblings().removeClass("active"),$(".comment.card a#comment-delete").addClass("disabled"),b.find("a#comment-delete").removeClass("disabled"),a.comments.sortByDateTime("datetime","asc");else if(1<=
a.comments().length){var c=parseInt(a.commentIndex());b="NaN"!=c?c-1:0;c="NaN"!=c?c:0;b=0<=b?a.comments()[b]:a.comments()[c];a.commentId(b.id)}});a.waiting.subscribe(function(b){f.waitStatus(b,a.waitingTarget())});ko.observableArray.fn.sortByDateTime=function(a,c){return this.sort(function(b,d){b=new Date(b[a]);d=new Date(d[a]);return"asc"==c?Date.parse(b)==Date.parse(d)?0:Date.parse(b)>Date.parse(d)?-1:1:Date.parse(b)==Date.parse(d)?0:Date.parse(b)<Date.parse(d)?-1:1})};ko.observable.fn.sortByName=
function(a,c){return this.sort(function(b,d){b=b[a];d=d[a];return"asc"==c?b==d?0:b<d?-1:1:b==d?0:b>d?-1:1})};ko.observableArray.fn.sumProperty=function(a){for(var b=0,e=0,d=this().length;e<d;e++)b+=this()[e][a];return b};return a});