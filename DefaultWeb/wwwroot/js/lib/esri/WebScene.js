//>>built
require({cache:{"esri/Map":function(){define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/Accessor ./core/CollectionFlattener ./core/Evented ./core/Logger ./support/LayersMixin ./Basemap ./Ground ./support/basemapUtils ./support/groundUtils ./core/accessorSupport/decorators".split(" "),function(l,d,k,a,b,c,e,m,h,g,u,r,q,t){var v=m.getLogger("esri.Map");return function(b){function e(a){a=b.call(this)||this;return a.basemap=null,a.ground=new u,a._basemapCache=
r.createCache(),a}return k(e,b),Object.defineProperty(e.prototype,"allLayers",{get:function(){return new c({root:this,rootCollectionNames:["basemap.baseLayers","ground.layers","layers","basemap.referenceLayers"],getChildrenFunction:function(a){return a.layers}})},enumerable:!0,configurable:!0}),e.prototype.castBasemap=function(a){return r.ensureType(a,this._basemapCache)},e.prototype.castGround=function(a){return(a=q.ensureType(a))?a:(v.error("Map.ground may not be set to null or undefined"),this._get("ground"))},
a([t.property({readOnly:!0})],e.prototype,"allLayers",null),a([t.property({type:g})],e.prototype,"basemap",void 0),a([t.cast("basemap")],e.prototype,"castBasemap",null),a([t.property({type:u})],e.prototype,"ground",void 0),a([t.cast("ground")],e.prototype,"castGround",null),e=a([t.subclass("esri.Map")],e)}(t.declared(b,e,h))})},"esri/core/CollectionFlattener":function(){define("require exports ./tsSupport/declareExtendsHelper ./tsSupport/decorateHelper ./accessorSupport/decorators ./Collection ./HandleRegistry".split(" "),
function(l,d,k,a,b,c,e){return function(m){function h(a){a=m.call(this)||this;return a._handles=new e,a.root=null,a.refresh=a.refresh.bind(a),a.updateCollections=a.updateCollections.bind(a),a}return k(h,m),h.prototype.initialize=function(){var a=this;this._handles.add(this.rootCollectionNames.map(function(c){return a.watch("root."+c,a.updateCollections,!0)}));this.updateCollections()},h.prototype.destroy=function(){this.root=null;this.refresh();this._handles.destroy();this._handles=null},h.prototype.updateCollections=
function(){var a=this;this._collections=this.rootCollectionNames.map(function(c){return a.get("root."+c)}).filter(function(a){return null!=a});this.refresh()},h.prototype.refresh=function(){var a=this._handles;a.remove("collections");this.removeAll();for(var c=this._collections.slice(),e=0,b=this._collections;e<b.length;e++)this._processCollection(c,this,b[e]);for(e=0;e<c.length;e++)a.add(c[e].on("after-changes",this.refresh),"collections")},h.prototype._createNewInstance=function(a){return new c(a)},
h.prototype._processCollection=function(a,c,e){var b=this;e&&(a.push(e),e.forEach(function(e){e&&(c.push(e),b._processCollection(a,c,b.getChildrenFunction(e)))}))},a([b.property()],h.prototype,"rootCollectionNames",void 0),a([b.property()],h.prototype,"root",void 0),a([b.property()],h.prototype,"getChildrenFunction",void 0),h=a([b.subclass("esri.core.CollectionFlattener")],h)}(b.declared(c))})},"esri/support/LayersMixin":function(){define(["../core/Accessor","../core/Collection","../core/Logger"],
function(l,d,k){var a=function(c,e,b){for(var h,m,k=0,d=c.length;d>k;k++){if(h=c.getItemAt(k),h[e]===b)return h;if(h.layers&&(m=a(h.layers,e,b)))return m}},b=k.getLogger("esri.support.LayersMixin");return l.createSubclass({declaredClass:"esri.support.LayersMixin",destroy:function(){this._layersHandle.remove();this._layersHandle=null;this.layers.drain(this._lyrRemove,this)},properties:{layers:{type:d,get:function(){var a=this._get("layers");return a?a:(a=new d,a.on("after-add",function(a){a=a.item;
a.parent&&a.parent!==this&&a.parent.remove(a);a.parent=this;this.layerAdded(a);"elevation"===a.type&&b.error("Layer '"+a.title+", id:"+a.id+"' of type '"+a.type+"' is not supported as an operational layer and will therefore be ignored.")}.bind(this)),a.on("after-remove",function(a){a=a.item;a.parent=null;this.layerRemoved(a)}.bind(this)),a)},set:function(a){var c=this._get("layers");c&&this.remove(c.toArray());this.addMany(a.toArray())}}},findLayerById:function(c){return a(this.layers,"id",c)},add:function(a,
b){var c=this.layers;return b=c.getNextIndex(b),a.parent===this?void this.reorder(a,b):void c.add(a,b)},addMany:function(a,b){var c=this.layers;b=c.getNextIndex(b);a.slice().forEach(function(a){return a.parent===this?void this.reorder(a,b):(c.add(a,b),void(b+=1))},this)},remove:function(a){return this.layers.remove(a)},removeMany:function(a){return this.layers.removeMany(a)},removeAll:function(){return this.layers.removeAll()},reorder:function(a,b){return this.layers.reorder(a,b)},findLayerByUid:function(b){return a(this.layers,
"uid",b)},layerAdded:function(a){},layerRemoved:function(a){}})})},"esri/Basemap":function(){define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/accessorSupport/decorators dojo/_base/lang ./support/basemapDefinitions ./core/Collection ./core/collectionUtils ./core/Evented ./core/JSONSupport ./core/Loadable ./core/promiseUtils ./core/requireUtils ./core/urlUtils ./core/Logger ./portal/Portal ./portal/PortalItem ./layers/Layer".split(" "),function(l,
d,k,a,b,c,e,m,h,g,u,r,q,t,v,x,y,A,L){var f=0,n=m.ofType(L),F=x.getLogger("esri.Basemap");return function(I){function g(a){a=I.call(this)||this;a.id=null;a.portalItem=null;a.thumbnailUrl=null;a.title="Basemap";a.id=Date.now().toString(16)+"-basemap-"+f++;a.baseLayers=new m;a.referenceLayers=new m;var b=function(a){"elevation"===a.type&&F.error("Layer '"+a.title+", id:"+a.id+"' of type '"+a.type+"' is not supported as a basemap layer and will therefore be ignored.")};return a.baseLayers.on("after-add",
function(a){return b(a.item)}),a.referenceLayers.on("after-add",function(a){return b(a.item)}),a}return k(g,I),d=g,g.prototype.initialize=function(){var a=this;this.when()["catch"](function(f){F.error("#load()","Failed to load basemap (title: '"+a.title+"', id: '"+a.id+"')",f)});this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)},g.prototype.normalizeCtorArgs=function(a){return a&&"resourceInfo"in a&&(this._set("resourceInfo",a.resourceInfo),a=c.mixin({},a),delete a.resourceInfo),
a},Object.defineProperty(g.prototype,"baseLayers",{set:function(a){this._set("baseLayers",h.referenceSetter(a,this._get("baseLayers"),n))},enumerable:!0,configurable:!0}),g.prototype.writeBaseLayers=function(a,f,b,n){var F=[];return a?(n=c.mixin({},n,{layerContainerType:"basemap"}),this.baseLayers.forEach(function(a){if(a.write){var f={};a.write(f,n)&&F.push(f)}}),this.referenceLayers.forEach(function(a){if(a.write){var f={isReference:!0};a.write(f,n)&&F.push(f)}}),void(f[b]=F)):void(f[b]=F)},Object.defineProperty(g.prototype,
"referenceLayers",{set:function(a){this._set("referenceLayers",h.referenceSetter(a,this._get("referenceLayers"),n))},enumerable:!0,configurable:!0}),g.prototype.writeTitle=function(a,f){f.title=a||"Basemap"},g.prototype.load=function(){return this.addResolvingPromise(this._loadFromSource()),this.when()},g.prototype.clone=function(){var a={id:this.id,title:this.title,portalItem:this.portalItem,resourceInfo:this.resourceInfo,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};
return this.loaded&&(a.loadStatus="loaded"),new d(a)},g.prototype.read=function(a,f){return this.resourceInfo||this._set("resourceInfo",{data:a,context:f}),this.inherited(arguments)},g.prototype.write=function(a,f){return a=a||{},f&&f.origin||(f=c.mixin({origin:"web-map"},f)),this.inherited(arguments,[a,f]),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(a.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(function(a){a=c.clone(a);return a.url&&v.isProtocolRelative(a.url)&&
(a.url="https:"+a.url),a.templateUrl&&v.isProtocolRelative(a.templateUrl)&&(a.templateUrl="https:"+a.templateUrl),a})),a},g.prototype._loadFromSource=function(){var a=this.resourceInfo,f=this.portalItem;return a?this._loadLayersFromJSON(a.data,a.context?a.context.url:null):f?this._loadFromItem(f):q.resolve(null)},g.prototype._loadLayersFromJSON=function(a,f){var b=this,n=this.resourceInfo&&this.resourceInfo.context,c=this.portalItem&&this.portalItem.portal||n&&n.portal||null,F=n&&"web-scene"===n.origin?
"web-scene":"web-map";return t.when(l,"./portal/support/layersCreator").then(function(n){var g=[];if(a.baseMapLayers&&Array.isArray(a.baseMapLayers)){var A={context:{origin:F,url:f,portal:c,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},e=n.populateOperationalLayers(b.baseLayers,a.baseMapLayers.filter(function(a){return!a.isReference}),A);g.push.apply(g,e);n=n.populateOperationalLayers(b.referenceLayers,a.baseMapLayers.filter(function(a){return a.isReference}),A);g.push.apply(g,
n)}return q.eachAlways(g)}).then(function(){})},g.prototype._loadFromItem=function(a){var f=this;return a.load().then(function(a){return a.fetchData()}).then(function(b){var n=v.urlToObject(a.itemUrl);return f._set("resourceInfo",{data:b.baseMap,context:{origin:"web-map",portal:a.portal||y.getDefault(),url:n}}),f.read(f.resourceInfo.data,f.resourceInfo.context),f.read({title:a.title,thumbnailUrl:a.thumbnailUrl},{origin:"portal-item",portal:a.portal||y.getDefault(),url:n}),f._loadLayersFromJSON(f.resourceInfo.data,
n)})},g.fromId=function(a){return(a=e[a])?d.fromJSON(a):null},a([b.property({type:n,json:{write:{ignoreOrigin:!0,target:"baseMapLayers"}}}),b.cast(h.castForReferenceSetter)],g.prototype,"baseLayers",null),a([b.writer("baseLayers")],g.prototype,"writeBaseLayers",null),a([b.property({type:String,json:{origins:{"web-scene":{write:!0}}}})],g.prototype,"id",void 0),a([b.property({type:A})],g.prototype,"portalItem",void 0),a([b.property({type:n}),b.cast(h.castForReferenceSetter)],g.prototype,"referenceLayers",
null),a([b.property({readOnly:!0})],g.prototype,"resourceInfo",void 0),a([b.property()],g.prototype,"thumbnailUrl",void 0),a([b.property({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],g.prototype,"title",void 0),a([b.writer("title")],g.prototype,"writeTitle",null),g=d=a([b.subclass("esri.Basemap")],g);var d}(b.declared(u,g,r))})},"esri/core/collectionUtils":function(){define(["require","exports","./Collection"],function(l,d,k){Object.defineProperty(d,"__esModule",{value:!0});
d.referenceSetter=function(a,b,c){void 0===c&&(c=k);b||(b=new c);b.removeAll();return a&&(Array.isArray(a)||a.isInstanceOf&&a.isInstanceOf(k))?b.addMany(a):b.add(a),b};d.castForReferenceSetter=function(a){return a}})},"esri/Ground":function(){define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/accessorSupport/decorators dojo/_base/lang ./core/JSONSupport ./core/Loadable ./core/Collection ./core/collectionUtils ./core/Logger ./core/requireUtils ./core/promiseUtils ./core/Error ./layers/Layer ./layers/support/types".split(" "),
function(l,d,k,a,b,c,e,m,h,g,u,r,q,t,v,x){var y=h.ofType(v),A=u.getLogger("esri.Ground");return function(e){function f(a){a=e.call(this)||this;return a.layers=new y,a.layers.on("after-add",function(a){a=a.item;x.isOfType(a,["elevation","base-elevation"])||A.error("Layer '"+a.title+", id:"+a.id+"' of type '"+a.type+"' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.")}),a}return k(f,e),n=f,f.prototype.initialize=function(){this.when()["catch"](function(a){A.error("#load()",
"Failed to load ground",a)});this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)},f.prototype.normalizeCtorArgs=function(a){return a&&"resourceInfo"in a&&(this._set("resourceInfo",a.resourceInfo),a=c.mixin({},a),delete a.resourceInfo),a},Object.defineProperty(f.prototype,"layers",{set:function(a){this._set("layers",g.referenceSetter(a,this._get("layers"),y))},enumerable:!0,configurable:!0}),f.prototype.writeLayers=function(a,f,b,n){var g=[];return a?(n=c.mixin({},n,{layerContainerType:"ground"}),
a.forEach(function(a){if(a.write){var f={};a.write(f,n)&&g.push(f)}else n&&n.messages&&n.messages.push(new t("layer:unsupported","Layers ("+a.title+", "+a.id+") of type '"+a.declaredClass+"' cannot be persisted in the ground",{layer:a}))}),void(f.layers=g)):void(f.layers=g)},f.prototype.load=function(){return this.addResolvingPromise(this._loadFromSource()),this.when()},f.prototype.queryElevation=function(a,f){var b=this;return r.when(l,"./layers/support/ElevationQuery").then(function(n){n=new n.ElevationQuery;
var c=b.layers.filter(function(a){return"elevation"===a.type}).toArray();return n.queryAll(c,a,f)})},f.prototype.clone=function(){var a={resourceInfo:this.resourceInfo,layers:this.layers.slice()};return this.loaded&&(a.loadStatus="loaded"),new n(a)},f.prototype.read=function(a,f){return this.resourceInfo||this._set("resourceInfo",{data:a,context:f}),this.inherited(arguments)},f.prototype._loadFromSource=function(){var a=this.resourceInfo;return a?this._loadLayersFromJSON(a.data,a.context):q.resolve(null)},
f.prototype._loadLayersFromJSON=function(a,f){var b=this,n=f&&f.origin||"web-scene",c=f&&f.portal||null,g=f&&f.url||null;return r.when(l,"./portal/support/layersCreator").then(function(f){var e=[];a.layers&&Array.isArray(a.layers)&&e.push.apply(e,f.populateOperationalLayers(b.layers,a.layers,{context:{origin:n,url:g,portal:c,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"}));return q.eachAlways(e)}).then(function(){})},a([b.property({type:y,json:{read:!1}}),b.cast(g.castForReferenceSetter)],
f.prototype,"layers",null),a([b.writer("layers")],f.prototype,"writeLayers",null),a([b.property({readOnly:!0})],f.prototype,"resourceInfo",void 0),f=n=a([b.subclass("esri.Ground")],f);var n}(b.declared(e,m))})},"esri/layers/support/types":function(){define(["require","exports"],function(l,d){Object.defineProperty(d,"__esModule",{value:!0});d.isOfType=function(d,a){d=d.constructor._meta;if(!d||!d.bases)return!1;d=d.bases;var b=Array.isArray(a);return d.some(function(c){c=c.__accessorMetadata__;if(!c)return!1;
c=c.properties;if(!c||!c.type||!c.type.value)return!1;c=c.type.value;return b?-1!==a.indexOf(c):c===a})}})},"esri/support/basemapUtils":function(){define("require exports ./basemapDefinitions ../core/accessorSupport/ensureType ../core/Collection ../core/urlUtils ../core/Logger ../Basemap".split(" "),function(l,d,k,a,b,c,e,m){function h(f,b){var n;if("string"==typeof f){if(!(f in k))return b=Object.keys(k).map(function(a){return'"'+a+'"'}).join(", "),L.warn("Unable to find basemap definition for: "+
f+". Try one of these: "+b),null;b&&(n=b[f]);n||(n=m.fromId(f),b&&(b[f]=n))}else n=a["default"](m,f);return n}function g(a,b){return a.map(function(a){return b.find(function(f){var b=q(a);f=q(f);return b.type===f.type&&b.url===f.url})||a})}function u(a){return a?!a.loaded&&a.resourceInfo?t(a.resourceInfo.data):{baseLayers:r(a.baseLayers),referenceLayers:r(a.referenceLayers)}:null}function r(a){return(b.isCollection(a)?a.toArray():a).map(q)}function q(a){return{type:a.type,url:A(a.urlTemplate||a.url||
a.styleUrl)}}function t(a){return a?{baseLayers:v(a.baseMapLayers.filter(function(a){return!a.isReference})),referenceLayers:v(a.baseMapLayers.filter(function(a){return a.isReference}))}:null}function v(a){return a.map(function(a){var f;switch(a.layerType){case "VectorTileLayer":f="vector-tile";break;case "ArcGISTiledMapServiceLayer":f="tile";break;default:f="unknown"}return{type:f,url:A(a.templateUrl||a.urlTemplate||a.styleUrl||a.url)}})}function x(a,b,c){return null!=a!=(null!=b)?"not-equal":a?
y(a.baseLayers,b.baseLayers)?y(a.referenceLayers,b.referenceLayers)?"equal":c.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function y(a,b){return a.length!==b.length?!1:!a.some(function(a){return!b.some(function(f){return a.type===f.type&&a.url===f.url})})}function A(a){return a?c.normalize(a).replace(/^\s*https?:/i,"").toLowerCase():""}Object.defineProperty(d,"__esModule",{value:!0});var L=e.getLogger("esri.support.basemapUtils");d.createCache=function(){return{}};d.ensureType=
h;d.clonePreservingTiledLayers=function(a,b){void 0===b&&(b=null);a=h(a);if(!a)return null;var f=new m({id:a.id,title:a.title,baseLayers:a.baseLayers.slice(),referenceLayers:a.referenceLayers.slice()});return b&&(f.baseLayers=g(f.baseLayers,b.baseLayers),f.referenceLayers=g(f.referenceLayers,b.referenceLayers)),f.load(),f.portalItem=a.portalItem,f};d.getWellKnownBasemapId=function(a){var f=null;a=u(a);for(var b in k){var c=t(k[b]),c=x(a,c,{mustMatchReferences:!1});if("equal"===c){f=b;break}"base-layers-equal"===
c&&(f=b)}return f};d.contentEquals=function(a,b){if(a===b)return!0;a=u(a);b=u(b);return"equal"===x(a,b,{mustMatchReferences:!0})}})},"esri/support/groundUtils":function(){define("require exports ../core/accessorSupport/ensureType ../core/Logger ../Ground ../layers/ElevationLayer".split(" "),function(l,d,k,a,b,c){Object.defineProperty(d,"__esModule",{value:!0});var e=a.getLogger("esri.support.groundUtils");d.groundElevationLayers={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer"}};
d.ensureType=function(a){var h;"string"==typeof a?a in d.groundElevationLayers?(a=d.groundElevationLayers[a],a=new c({id:a.id,url:a.url}),h=new b({layers:[a]})):e.warn("Unable to find ground definition for: "+a+'. Try "world-elevation"'):h=k["default"](b,a);return h}})},"esri/core/accessorSupport/originUtils":function(){define(["require","exports","../MultiOriginJSONSupport"],function(l,d,k){Object.defineProperty(d,"__esModule",{value:!0});d.updateOrigins=function(a){a&&a.writtenProperties&&a.writtenProperties.forEach(function(a){var b=
a.target;a.newOrigin&&a.oldOrigin!==a.newOrigin&&b.isInstanceOf(k)&&b.updateOrigin(a.propName,a.newOrigin)})}})},"esri/support/webSceneUtils":function(){define(["require","exports","../core/Error"],function(l,d,k){Object.defineProperty(d,"__esModule",{value:!0});d.createCopyError=function(){return new k("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")};d.isCopyError=function(a){return a&&"webscene:failed-to-copy-embedded-resources"===a.name};
d.createSchemaValidationError=function(a){return new k("webscene:schema-validation","Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:a})};d.isSchemaValidationError=function(a){return a&&"webscene:schema-validation"===a.name}})},"esri/Viewpoint":function(){define(["./core/JSONSupport","./Camera","./geometry/support/typeUtils","./geometry/support/jsonUtils"],function(l,d,k,a){var b=l.createSubclass({declaredClass:"esri.Viewpoint",
properties:{rotation:{type:Number,value:0,cast:function(a){return a%=360,0>a&&(a+=360),a},json:{write:!0}},scale:{type:Number,value:0,json:{write:!0}},targetGeometry:{value:null,types:k.types,json:{read:function(b){return a.fromJSON(b)},write:!0}},camera:{value:null,type:d,json:{write:!0}}},clone:function(){return new b({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry?this.targetGeometry.clone():null,camera:this.camera?this.camera.clone():null})}});return b})},"esri/Camera":function(){define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/JSONSupport ./geometry/Point ./views/3d/support/mathUtils ./core/accessorSupport/decorators".split(" "),
function(l,d,k,a,b,c,e,m){return function(b){function g(a,c,g,e){a=b.call(this)||this;return a.position=null,a.heading=0,a.tilt=0,a.fov=55,a}return k(g,b),h=g,g.prototype.getDefaults=function(a){return a.position?void 0:{position:new c([0,0,0])}},g.prototype.normalizeCtorArgs=function(a,b,c,g){return a&&"object"==typeof a&&("x"in a||Array.isArray(a))?(a={position:a},null!=b&&(a.heading=b),null!=c&&(a.tilt=c),null!=g&&(a.fov=g),a):a},g.prototype.equals=function(a){return a?this.tilt===a.tilt&&this.heading===
a.heading&&this.fov===a.fov&&this.position.equals(a.position):!1},g.prototype.clone=function(){return new h({position:this.position.clone(),heading:this.heading,tilt:this.tilt,fov:this.fov})},a([m.property({type:c,json:{write:{isRequired:!0}}})],g.prototype,"position",void 0),a([m.property({type:Number,json:{write:{isRequired:!0}}}),m.cast(e.cyclicalDeg.normalize)],g.prototype,"heading",void 0),a([m.property({type:Number,json:{write:{isRequired:!0}}}),m.cast(function(a){return e.clamp(a,-180,180)})],
g.prototype,"tilt",void 0),a([m.property({json:{read:!1,write:!1}})],g.prototype,"fov",void 0),g=h=a([m.subclass("esri.Camera")],g);var h}(m.declared(b))})},"esri/geometry/support/typeUtils":function(){define("require exports ../../core/accessorSupport/ensureType ../Geometry ../Extent ../Multipoint ../Point ../Polyline ../Polygon".split(" "),function(l,d,k,a,b,c,e,m,h){Object.defineProperty(d,"__esModule",{value:!0});d.types={base:a,key:"type",typeMap:{extent:b,multipoint:c,point:e,polyline:m,polygon:h}};
d.ensureType=k.ensureOneOfType(d.types)})},"esri/geometry/Multipoint":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./Geometry ./Extent ./Point ../core/lang ./support/zmUtils".split(" "),function(l,d,k,a,b,c,e,m,h,g){function u(a){return function(b,c){return null==b?c:null==c?b:a(b,c)}}l=function(c){function d(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];a=c.apply(this,a)||this;return a.points=
[],a.type="multipoint",a}return k(d,c),l=d,d.prototype.normalizeCtorArgs=function(a,b){if(!a&&!b)return null;var c={};Array.isArray(a)?(c.points=a,c.spatialReference=b):!a||"esri.SpatialReference"!==a.declaredClass&&null==a.wkid?(a.points&&(c.points=a.points),a.spatialReference&&(c.spatialReference=a.spatialReference),a.hasZ&&(c.hasZ=a.hasZ),a.hasM&&(c.hasM=a.hasM)):c.spatialReference=a;a=c.points&&c.points[0];return a&&(void 0===c.hasZ&&void 0===c.hasM?(c.hasZ=2<a.length,c.hasM=!1):void 0===c.hasZ?
c.hasZ=3<a.length:void 0===c.hasM&&(c.hasM=3<a.length)),c},Object.defineProperty(d.prototype,"extent",{get:function(){var a=this.points;if(!a.length)return null;for(var b,c,g,h,f=new e,n=this.hasZ,d=this.hasM,m=n?3:2,k=a[0],l=u(Math.min),q=u(Math.max),r=k[0],N=k[1],B=k[0],k=k[1],J=0,O=a.length;O>J;J++){var z=a[J],p=z[0],t=z[1];if(r=l(r,p),N=l(N,t),B=q(B,p),k=q(k,t),n&&2<z.length)p=z[2],b=l(b,p),g=q(g,p);d&&z.length>m&&(z=z[m],c=l(c,z),h=q(h,z))}return f.xmin=r,f.ymin=N,f.xmax=B,f.ymax=k,f.spatialReference=
this.spatialReference,n?(f.zmin=b,f.zmax=g):(f.zmin=null,f.zmax=null),d?(f.mmin=c,f.mmax=h):(f.mmin=null,f.mmax=null),f},enumerable:!0,configurable:!0}),d.prototype.writePoints=function(a,b,c,g){b.points=h.clone(this.points)},d.prototype.addPoint=function(a){return this.clearCache(),g.updateSupportFromPoint(this,a),Array.isArray(a)?this.points.push(a):this.points.push(a.toArray()),this},d.prototype.clone=function(){var a={points:h.clone(this.points),spatialReference:this.spatialReference};return this.hasZ&&
(a.hasZ=!0),this.hasM&&(a.hasM=!0),new l(a)},d.prototype.getPoint=function(a){if(!this._validateInputs(a))return null;a=this.points[a];var b={x:a[0],y:a[1],spatialReference:this.spatialReference},c=2;return this.hasZ&&(b.z=a[2],c=3),this.hasM&&(b.m=a[c]),new m(b)},d.prototype.removePoint=function(a){return this._validateInputs(a)?(this.clearCache(),new m(this.points.splice(a,1)[0],this.spatialReference)):null},d.prototype.setPoint=function(a,b){return this._validateInputs(a)?(this.clearCache(),g.updateSupportFromPoint(b),
this.points[a]=b.toArray(),this):this},d.prototype.toJSON=function(a){return this.write(null,a)},d.prototype._validateInputs=function(a){return null!=a&&0<=a&&a<this.points.length},a([b.property({dependsOn:["points","hasZ","hasM","spatialReference"]})],d.prototype,"cache",void 0),a([b.property({dependsOn:["cache"]})],d.prototype,"extent",null),a([b.property({type:[[Number]],json:{write:{isRequired:!0}}})],d.prototype,"points",void 0),a([b.writer("points")],d.prototype,"writePoints",null),d=l=a([b.subclass("esri.geometry.Multipoint")],
d);var l}(b.declared(c));return l.prototype.toJSON.isDefaultToJSON=!0,l})},"esri/geometry/support/zmUtils":function(){define(["require","exports"],function(l,d){Object.defineProperty(d,"__esModule",{value:!0});d.updateSupportFromPoint=function(d,a,b){void 0===b&&(b=!1);var c=d.hasM,e=d.hasZ;Array.isArray(a)?4!==a.length||c||e?3===a.length&&b&&!c?(e=!0,c=!1):3===a.length&&c&&e&&(c=!1,e=!1):(c=!0,e=!0):(e=!e&&a.hasZ&&(!c||a.hasM),c=!c&&a.hasM&&(!e||a.hasZ));d.hasZ=e;d.hasM=c}})},"esri/geometry/Polyline":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ../core/lang ./Geometry ./Extent ./Point ./SpatialReference ./support/zmUtils".split(" "),
function(l,d,k,a,b,c,e,m,h,g,u){function r(a){return function(b,c){return null==b?c:null==c?b:a(b,c)}}var q=r(Math.min),t=r(Math.max);l=function(e){function d(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];a=e.apply(this,a)||this;return a.paths=[],a.type="polyline",a}return k(d,e),l=d,d.prototype.normalizeCtorArgs=function(a,b){var f,c,d=null,e=null;return a&&!Array.isArray(a)?(d=a.paths?a.paths:null,b||(a.spatialReference?b=a.spatialReference:a.paths||(b=a)),f=a.hasZ,c=a.hasM):d=a,d=
d||[],b=b||g.WGS84,d.length&&d[0]&&null!=d[0][0]&&"number"==typeof d[0][0]&&(d=[d]),e=d[0]&&d[0][0],e&&(void 0===f&&void 0===c?(f=2<e.length,c=!1):void 0===f?f=!c&&3<e.length:void 0===c&&(c=!f&&3<e.length)),{paths:d,spatialReference:b,hasZ:f,hasM:c}},Object.defineProperty(d.prototype,"extent",{get:function(){var a=this.hasZ,b=this.hasM,f=this.spatialReference,c=this.paths,d=a?3:2;if(!c.length||!c[0].length)return null;for(var g=c[0][0],e=g[0],g=g[1],h=c[0][0],k=h[0],h=h[1],l=void 0,u=void 0,B=void 0,
J=void 0,O=[],z=0;z<c.length;z++){for(var p=c[z],r=p[0],v=r[0],r=r[1],x=p[0],y=x[0],x=x[1],C=void 0,w=void 0,G=void 0,D=void 0,Q=0;Q<p.length;Q++){var E=p[Q],H=E[0],K=E[1];if(e=q(e,H),g=q(g,K),k=t(k,H),h=t(h,K),v=q(v,H),r=q(r,K),y=t(y,H),x=t(x,K),a&&2<E.length)H=E[2],l=q(l,H),u=t(u,H),C=q(C,H),w=t(w,H);b&&E.length>d&&(D=E[d],B=q(l,D),J=t(u,D),G=q(C,D),D=t(w,D))}O.push(new m({xmin:v,ymin:r,zmin:C,mmin:G,xmax:y,ymax:x,zmax:w,mmax:D,spatialReference:f}))}c=new m;return c.xmin=e,c.ymin=g,c.xmax=k,c.ymax=
h,c.spatialReference=f,a&&(c.zmin=l,c.zmax=u),b&&(c.mmin=B,c.mmax=J),c.cache._partwise=1<O.length?O:null,c},enumerable:!0,configurable:!0}),d.prototype.writePaths=function(a,b,f,g){b.paths=c.clone(this.paths)},d.prototype.addPath=function(a){if(a){this.clearCache();var b=this.paths,f=b.length;if(Array.isArray(a[0]))b[f]=a.concat();else{for(var c=[],g=0,d=a.length;d>g;g++)c[g]=a[g].toArray();b[f]=c}return this}},d.prototype.clone=function(){var a=new l;return a.spatialReference=this.spatialReference,
a.paths=c.clone(this.paths),a.hasZ=this.hasZ,a.hasM=this.hasM,a},d.prototype.getPoint=function(a,b){if(!this._validateInputs(a,b))return null;a=this.paths[a][b];b=this.hasZ;var f=this.hasM;return b&&!f?new h(a[0],a[1],a[2],void 0,this.spatialReference):f&&!b?new h(a[0],a[1],void 0,a[2],this.spatialReference):b&&f?new h(a[0],a[1],a[2],a[3],this.spatialReference):new h(a[0],a[1],this.spatialReference)},d.prototype.insertPoint=function(a,b,f){return this._validateInputs(a,b,!0)?(this.clearCache(),u.updateSupportFromPoint(this,
f),Array.isArray(f)||(f=f.toArray()),this.paths[a].splice(b,0,f),this):this},d.prototype.removePath=function(a){if(!this._validateInputs(a,null))return null;this.clearCache();a=this.paths.splice(a,1)[0];var b=this.spatialReference;return a.map(function(a){return new h(a,b)})},d.prototype.removePoint=function(a,b){return this._validateInputs(a,b)?(this.clearCache(),new h(this.paths[a].splice(b,1)[0],this.spatialReference)):null},d.prototype.setPoint=function(a,b,f){return this._validateInputs(a,b)?
(this.clearCache(),u.updateSupportFromPoint(this,f),Array.isArray(f)||(f=f.toArray()),this.paths[a][b]=f,this):this},d.prototype._validateInputs=function(a,b,f){if((void 0===f&&(f=!1),null==a||null==b)||0>a||a>=this.paths.length)return!1;a=this.paths[a];return f&&0>b||b>a.length?!1:0>b||b>=a.length?!1:!0},d.prototype.toJSON=function(a){return this.write(null,a)},a([b.property({dependsOn:["hasM","hasZ","paths"]})],d.prototype,"cache",void 0),a([b.property({dependsOn:["cache"],readOnly:!0})],d.prototype,
"extent",null),a([b.property({type:[[[Number]]],json:{write:{isRequired:!0}}})],d.prototype,"paths",void 0),a([b.writer("paths")],d.prototype,"writePaths",null),d=l=a([b.subclass("esri.geometry.Polyline")],d);var l}(b.declared(e));return l.prototype.toJSON.isDefaultToJSON=!0,l})},"esri/geometry/Polygon":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ../core/lang ./Geometry ./Extent ./Point ./SpatialReference ./support/webMercatorUtils ./support/zmUtils ./support/coordsUtils".split(" "),
function(l,d,k,a,b,c,e,m,h,g,u,r,q){function t(a){return function(b,c){return null==b?c:null==c?b:a(b,c)}}var v=t(Math.min),x=t(Math.max);l=function(d){function e(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];a=d.apply(this,a)||this;return a.rings=[],a.type="polygon",a}return k(e,d),l=e,e.createEllipse=function(a){var b=a.center.x,f=a.center.y,c=a.center.z,e=a.center.m,g=a.center.hasZ,d=a.center.hasM,h=a.longAxis,m=a.shortAxis,B=a.numberOfPoints;a=a.view;for(var k=[],u=2*Math.PI/B,q=
g?3:2,p=0;B>p;p++){var r=a.toMap(h*Math.cos(p*u)+b,m*Math.sin(p*u)+f),r=[r.x,r.y];g&&(r[2]=c);d&&(r[q]=e);k.push(r)}k.push(k[0]);return new l({rings:[k],spatialReference:a.spatialReference})},e.createCircle=function(a){return l.createEllipse({center:a.center,longAxis:a.r,shortAxis:a.r,numberOfPoints:a.numberOfPoints,view:a.view})},e.fromExtent=function(a){var b=a.clone().normalize();a=a.spatialReference;var f=!1,c=!1;b.map(function(a){a.hasZ&&(f=!0);a.hasM&&(c=!0)});b={rings:b.map(function(a){var b=
[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(f&&a.hasZ)for(var e=(a.zmax-a.zmin)/2,g=0;g<b.length;g++)b[g].push(e);if(c&&a.hasM)for(a=(a.mmax-a.mmin)/2,g=0;g<b.length;g++)b[g].push(a);return b}),spatialReference:a};return f&&(b.hasZ=!0),c&&(b.hasM=!0),new l(b)},e.prototype.normalizeCtorArgs=function(a,b){var f,c,e=null,d=null;return a&&!Array.isArray(a)?(e=a.rings?a.rings:null,b||(a.spatialReference?b=a.spatialReference:a.rings||(b=a)),f=a.hasZ,c=a.hasM):e=
a,e=e||[],b=b||g.WGS84,e.length&&e[0]&&null!=e[0][0]&&"number"==typeof e[0][0]&&(e=[e]),d=e[0]&&e[0][0],d&&(void 0===f&&void 0===c?(f=2<d.length,c=!1):void 0===f?f=!c&&3<d.length:void 0===c&&(c=!f&&3<d.length)),{rings:e,spatialReference:b,hasZ:f,hasM:c}},Object.defineProperty(e.prototype,"centroid",{get:function(){var a=q.ringsCentroid([],this.rings,this.hasZ);if(isNaN(a[0])||isNaN(a[1])||this.hasZ&&isNaN(a[2]))return null;var b=new h;return b.x=a[0],b.y=a[1],b.spatialReference=this.spatialReference,
this.hasZ&&(b.z=a[2]),b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extent",{get:function(){var a=this.hasZ,b=this.hasM,c=this.spatialReference,e=this.rings,g=a?3:2;if(!e.length||!e[0].length)return null;for(var d=e[0][0],h=d[0],d=d[1],k=e[0][0],l=k[0],k=k[1],B=void 0,u=void 0,q=void 0,r=void 0,p=[],t=0;t<e.length;t++){for(var y=e[t],A=y[0],X=A[0],A=A[1],C=y[0],w=C[0],C=C[1],G=void 0,D=void 0,Q=void 0,E=void 0,H=0;H<y.length;H++){var K=y[H],M=K[0],V=K[1];if(h=v(h,M),d=v(d,
V),l=x(l,M),k=x(k,V),X=v(X,M),A=v(A,V),w=x(w,M),C=x(C,V),a&&2<K.length)M=K[2],B=v(B,M),u=x(u,M),G=v(G,M),D=x(D,M);b&&K.length>g&&(E=K[g],q=v(B,E),r=x(u,E),Q=v(G,E),E=x(D,E))}p.push(new m({xmin:X,ymin:A,zmin:G,mmin:Q,xmax:w,ymax:C,zmax:D,mmax:E,spatialReference:c}))}e=new m;return e.xmin=h,e.ymin=d,e.xmax=l,e.ymax=k,e.spatialReference=c,a&&(e.zmin=B,e.zmax=u),b&&(e.mmin=q,e.mmax=r),e.cache._partwise=1<p.length?p:null,e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSelfIntersecting",
{get:function(){return q.isSelfIntersecting(this.rings)},enumerable:!0,configurable:!0}),e.prototype.writePaths=function(a,b,e,g){b.rings=c.clone(this.rings)},e.prototype.addRing=function(a){if(a){this.clearCache();var b=this.rings,c=b.length;if(Array.isArray(a[0]))b[c]=a.concat();else{for(var f=[],e=0,g=a.length;g>e;e++)f[e]=a[e].toArray();b[c]=f}return this}},e.prototype.clone=function(){var a=new l;return a.spatialReference=this.spatialReference,a.rings=c.clone(this.rings),a.hasZ=this.hasZ,a.hasM=
this.hasM,a},e.prototype.contains=function(a){return a?(u.canProject(a,this.spatialReference)&&(a=u.project(a,this.spatialReference)),q.contains(this.rings,q.geometryToCoordinates(a))):!1},e.prototype.isClockwise=function(a){var b,c=this;return b=Array.isArray(a[0])?a:a.map(function(a){return c.hasZ?c.hasM?[a.x,a.y,a.z,a.m]:[a.x,a.y,a.z]:[a.x,a.y]}),q.isClockwise(b,this.hasM,this.hasZ)},e.prototype.getPoint=function(a,b){if(!this._validateInputs(a,b))return null;a=this.rings[a][b];b=this.hasZ;var c=
this.hasM;return b&&!c?new h(a[0],a[1],a[2],void 0,this.spatialReference):c&&!b?new h(a[0],a[1],void 0,a[2],this.spatialReference):b&&c?new h(a[0],a[1],a[2],a[3],this.spatialReference):new h(a[0],a[1],this.spatialReference)},e.prototype.insertPoint=function(a,b,c){return this._validateInputs(a,b,!0)?(this.clearCache(),r.updateSupportFromPoint(this,c),Array.isArray(c)||(c=c.toArray()),this.rings[a].splice(b,0,c),this):this},e.prototype.removePoint=function(a,b){return this._validateInputs(a,b)?(this.clearCache(),
new h(this.rings[a].splice(b,1)[0],this.spatialReference)):null},e.prototype.removeRing=function(a){if(!this._validateInputs(a,null))return null;this.clearCache();a=this.rings.splice(a,1)[0];var b=this.spatialReference;return a.map(function(a){return new h(a,b)})},e.prototype.setPoint=function(a,b,c){return this._validateInputs(a,b)?(this.clearCache(),r.updateSupportFromPoint(this,c),Array.isArray(c)||(c=c.toArray()),this.rings[a][b]=c,this):this},e.prototype._validateInputs=function(a,b,c){if((void 0===
c&&(c=!1),null==a||null==b)||0>a||a>=this.rings.length)return!1;a=this.rings[a];return c&&0>b||b>a.length?!1:0>b||b>=a.length?!1:!0},e.prototype.toJSON=function(a){return this.write(null,a)},a([b.property({dependsOn:["hasM","hasZ","rings"]})],e.prototype,"cache",void 0),a([b.property({readOnly:!0,dependsOn:["cache"]})],e.prototype,"centroid",null),a([b.property({dependsOn:["cache"],readOnly:!0})],e.prototype,"extent",null),a([b.property({dependsOn:["cache"],readOnly:!0})],e.prototype,"isSelfIntersecting",
null),a([b.property({type:[[[Number]]],json:{write:{isRequired:!0}}})],e.prototype,"rings",void 0),a([b.writer("rings")],e.prototype,"writePaths",null),e=l=a([b.subclass("esri.geometry.Polygon")],e);var l}(b.declared(e));return l.prototype.toJSON.isDefaultToJSON=!0,l})},"esri/geometry/support/jsonUtils":function(){define("require exports ../Extent ../Multipoint ../Point ../Polygon ../Polyline".split(" "),function(l,d,k,a,b,c,e){function m(g){return g?void 0!==g.x&&void 0!==g.y?b.fromJSON(g):void 0!==
g.paths?e.fromJSON(g):void 0!==g.rings?c.fromJSON(g):void 0!==g.points?a.fromJSON(g):void 0!==g.xmin&&void 0!==g.ymin&&void 0!==g.xmax&&void 0!==g.ymax?k.fromJSON(g):null:null}Object.defineProperty(d,"__esModule",{value:!0});d.fromJson=function(a){try{throw Error("fromJson is deprecated, use fromJSON instead");}catch(u){console.warn(u.stack)}return m(a)};d.fromJSON=m;d.getJsonType=function(g){return g instanceof b?"esriGeometryPoint":g instanceof e?"esriGeometryPolyline":g instanceof c?"esriGeometryPolygon":
g instanceof k?"esriGeometryEnvelope":g instanceof a?"esriGeometryMultipoint":null};var h={esriGeometryPoint:b,esriGeometryPolyline:e,esriGeometryPolygon:c,esriGeometryEnvelope:k,esriGeometryMultipoint:a};d.getGeometryType=function(a){return a&&h[a]||null}})},"esri/webscene/Presentation":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/Collection ../core/collectionUtils ../core/accessorSupport/decorators ./Slide".split(" "),
function(l,d,k,a,b,c,e,m,h){var g=c.ofType(h);return function(b){function c(a){a=b.call(this,a)||this;return a.slides=new g,a}return k(c,b),Object.defineProperty(c.prototype,"slides",{set:function(a){this._set("slides",e.referenceSetter(a,this._get("slides"),g))},enumerable:!0,configurable:!0}),c.prototype.clone=function(){return new this.constructor({slides:this.slides.clone()})},c.sanitizeJSON=function(a){var b;return b=void 0!==a.slides&&Array.isArray(a.slides)?a.slides.filter(function(a){return a&&
!!a.viewpoint}).map(function(a){return h.sanitizeJSON(a)}):[],{slides:b}},a([m.property({type:g,json:{write:!0}}),m.cast(e.castForReferenceSetter)],c.prototype,"slides",null),c=a([m.subclass("esri.webscene.Presentation")],c)}(m.declared(b))})},"esri/webscene/Slide":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ../Viewpoint ../Basemap ../support/basemapUtils ../core/JSONSupport ../core/lang ../core/Logger ../core/Collection ../core/collectionUtils ../core/promiseUtils ./Environment ./Lighting ./support/Description ./support/Title ./support/Thumbnail dojo/_base/lang dojo/promise/all ../views/3d/lib/glMatrix".split(" "),
function(l,d,k,a,b,c,e,m,h,g,u,r,q,t,v,x,y,A,L,f,n,F){var I=0,S=function(c){function e(){var a=null!==c&&c.apply(this,arguments)||this;return a.id="",a}return k(e,c),g=e,e.prototype.clone=function(){return new g({id:this.id})},a([b.property({type:String,json:{write:!0}})],e.prototype,"id",void 0),e=g=a([b.subclass()],e);var g}(b.declared(h)),P=r.ofType(S),T=u.getLogger("esri.webscene.Slide");return function(d){function h(a){a=d.call(this,a)||this;return a._currentAnimation=null,a.id=Date.now().toString(16)+
"-slide-"+I++,a.title=new A["default"],a.description=new y["default"],a.thumbnail=new L["default"],a.viewpoint=null,a.basemap=null,a.environment=new v,a.visibleLayers=new P,a}return k(h,d),h.prototype.castBasemap=function(a){return m.ensureType(a)},Object.defineProperty(h.prototype,"visibleLayers",{set:function(a){this._set("visibleLayers",q.referenceSetter(a,this._get("visibleLayers"),P))},enumerable:!0,configurable:!0}),h.prototype.castVisibleLayers=function(a){return a&&"function"==typeof a.map?
a.map(function(a){return"string"==typeof a?{id:a}:a.id?{id:a.id}:(T.warn('Invalid visible layer, expected { id }, Layer or "id"'),a)}):a},h.prototype.clone=function(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&
this.environment.clone()||null})},h.prototype._updateVisibleLayersFrom=function(a){var b=this,c=[];return t.eachAlways(this._allLayers(a.map).map(function(b){return a.whenLayerView(b).then(function(a){a.visible&&c.push(new S({id:a.layer.id}))})}).toArray()).then(function(){b.visibleLayers.removeAll();b.visibleLayers.addMany(c)})},h.prototype.updateFrom=function(a,b){var c=this;return b=f.mixin({screenshot:f.mixin({format:"jpeg",quality:80,width:120,height:75},b&&b.screenshot)},b),a.when(function(){return c.viewpoint=
a.viewpoint.clone(),c.environment.lighting=x.prototype.clone.apply(a.environment.lighting),c.basemap=a.map.basemap&&a.map.basemap.clone()||null,c._updateVisibleLayersFrom(a)}).then(function(){return a.takeScreenshot(b.screenshot)}).then(function(a){return c.thumbnail=new L["default"]({url:a.dataURL}),c})},h.prototype.applyTo=function(a,b){var c=this,e=f.mixin({animate:!0},b);return this._applyBasemap(a).then(function(){return n([c._applyViewpoint(a,e),c._applyLayerVisibility(a,e)])}).then(function(){return c})},
h.prototype._applyBasemap=function(a){var b=this;return this.basemap?this.basemap.load().always(function(){a.map.basemap=m.clonePreservingTiledLayers(b.basemap,a.map.basemap)}):t.resolve()},h.prototype._allLayers=function(a){var b=new r;return this._collectLayers(a,b),this._collectLayers(a.ground,b),b},h.prototype._collectLayers=function(a,b){var c=this;a.layers.forEach(function(a){b.add(a);a.layers&&c._collectLayers(a,b)})},h.prototype._applyLayerVisibility=function(a,b){var c=this;if(this.visibleLayers){var e=
this._allLayers(a.map);return b.applyToLayerViews?t.eachAlways(e.map(function(b){return a.whenLayerView(b).then(function(a){a.visible=c.visibleLayers.some(function(b){return b.id===a.layer.id})})}).toArray()):(e.forEach(function(a){return a.visible=c.visibleLayers.some(function(b){return b.id===a.id})}),t.resolve())}},h.prototype._applyViewpoint=function(a,b){if(this.viewpoint){if(this.viewpoint.camera.fov=a.camera.fov,b.animate)return this.get("environment.lighting.date")?this._animateToLighting(a,
b):(a.environment.lighting=this.environment.lighting.clone(),a.goTo(this.viewpoint,b));a.viewpoint=this.viewpoint;a.environment.lighting=this.environment.lighting.clone()}return t.resolve()},h.prototype._animateToLighting=function(a,b){var c,e=this;"global"===a.viewingMode&&(c=this._animateLightingWithCamera(a));this._currentAnimation&&(this._currentAnimation.cancel(),this._currentAnimation=null);a.environment.lighting.cameraTrackingEnabled=!1;a.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled;
null!=this.environment.lighting.displayUTCOffset&&(a.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);var g=a.goTo(this.viewpoint,b);return this._currentAnimation=g,this._currentAnimation.always(function(){c&&c.remove();e._currentAnimation===g&&(a.environment.lighting.cameraTrackingEnabled=!0)}),this._currentAnimation.then(function(){a.environment.lighting=e.environment.lighting.clone()}),this._currentAnimation},h.prototype._getTime=function(a){var b=a.getTime();a=
3600*a.getUTCHours()+60*a.getUTCMinutes()+a.getUTCSeconds();return[b,a]},h.prototype._setTime=function(a,b,c){return a.setTime(b),a.setUTCHours(c/3600),a.setUTCMinutes(c%3600/60),a.setUTCSeconds(c%3600%60),a},h.prototype._animateLightingWithCamera=function(a){var b=this,c=F.vec3d,e=this._getTime(new Date(a.environment.lighting.date.toString())),g=e[0],d=e[1],e=this._getTime(this.environment.lighting.date),f=e[0],h=e[1],m=a.renderCoordsHelper,k=[0,0,0];m.toRenderCoords(a.camera.position,k);var w=[0,
0,0];m.toRenderCoords(this.viewpoint.camera.position,w);var G=[0,0,0],D=new Date;return a.watch("camera",function(e){m.toRenderCoords(e.position,G);e=c.dist2(k,G);var l=c.dist2(w,G),C=0;0!==e+l&&(C=e/(e+l));a.environment.lighting.date=b._setTime(D,g+(f-g)*C,d+(h-d)*C)})},h.createFrom=function(a,b){return(new this).updateFrom(a,b)},h.sanitizeJSON=function(a){var b;b=void 0!==a.visibleLayers&&Array.isArray(a.visibleLayers)?g.clone(a.visibleLayers):[];b={id:a.id||"",title:a.title||{text:""},thumbnail:a.thumbnail||
{url:""},viewpoint:a.viewpoint,baseMap:a.baseMap,visibleLayers:b};return void 0!==a.description&&(b.description=a.description),void 0!==a.environment&&(b.environment=v.sanitizeJSON(a.environment)),b},a([b.property({type:String,json:{write:{isRequired:!0}}})],h.prototype,"id",void 0),a([b.property({type:A["default"],json:{write:{isRequired:!0}}})],h.prototype,"title",void 0),a([b.property({type:y["default"],json:{write:!0}})],h.prototype,"description",void 0),a([b.property({type:L["default"],json:{write:{isRequired:!0}}})],
h.prototype,"thumbnail",void 0),a([b.property({type:c,json:{write:{isRequired:!0}}})],h.prototype,"viewpoint",void 0),a([b.property({type:e,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],h.prototype,"basemap",void 0),a([b.cast("basemap")],h.prototype,"castBasemap",null),a([b.property({type:P,json:{write:{isRequired:!0}}})],h.prototype,"visibleLayers",null),a([b.cast("visibleLayers")],h.prototype,"castVisibleLayers",null),a([b.property({type:v,json:{write:!0}})],h.prototype,"environment",
void 0),h=a([b.subclass("esri.webscene.Slide")],h)}(b.declared(h))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators ./Lighting".split(" "),function(l,d,k,a,b,c,e){return function(b){function d(a){a=b.call(this,a)||this;return a.lighting=new e,a}return k(d,b),g=d,d.prototype.clone=function(){return new g({lighting:e.prototype.clone.call(this.lighting)})},d.sanitizeJSON=
function(a){return{lighting:a.lighting?e.sanitizeJSON(a.lighting):(new e).toJSON()}},a([c.property({type:e,json:{write:!0}})],d.prototype,"lighting",void 0),d=g=a([c.subclass("esri.webscene.Environment")],d);var g}(c.declared(b))})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),function(l,d,k,a,b,c){return function(b){function e(a){a=b.call(this,
a)||this;return a.date=null,a.directShadowsEnabled=!1,a.displayUTCOffset=null,a}return k(e,b),d=e,e.prototype.readDate=function(a,b){return null!=b.datetime&&new Date(b.datetime)||null},e.prototype.writeDate=function(a,b,c){b[c]=a.getTime()},e.prototype.readDirectShadowsEnabled=function(a,b){return!!b.directShadows},e.prototype.writedirectShadowsEnabled=function(a,b,c){a&&(b[c]=a)},e.prototype.writeDisplayUTCOffset=function(a,b){null!=a&&(b.displayUTCOffset=a)},e.prototype.clone=function(){return new d({date:null!=
this.date?new Date(this.date.getTime()):null,directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null})},e.sanitizeJSON=function(a){var b={datetime:a.datetime};return void 0!==a.directShadows&&(b.directShadows=!!a.directShadows),void 0!==a.displayUTCOffset&&(b.displayUTCOffset=a.displayUTCOffset),b},a([c.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],e.prototype,"date",void 0),a([c.reader("date",["datetime"])],e.prototype,
"readDate",null),a([c.writer("date")],e.prototype,"writeDate",null),a([c.property({type:Boolean,json:{write:{target:"directShadows"}}})],e.prototype,"directShadowsEnabled",void 0),a([c.reader("directShadowsEnabled",["directShadows"])],e.prototype,"readDirectShadowsEnabled",null),a([c.writer("directShadowsEnabled")],e.prototype,"writedirectShadowsEnabled",null),a([c.property({type:Number,json:{write:!0}})],e.prototype,"displayUTCOffset",void 0),a([c.writer("displayUTCOffset")],e.prototype,"writeDisplayUTCOffset",
null),e=d=a([c.subclass("esri.webscene.Lighting")],e);var d}(c.declared(b))})},"esri/webscene/support/Description":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(l,d,k,a,b,c){Object.defineProperty(d,"__esModule",{value:!0});l=function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;return a.text="",a}return k(e,b),d=e,e.prototype.clone=function(){return new d({text:this.text})},
a([c.property({type:String,json:{write:!0}})],e.prototype,"text",void 0),e=d=a([c.subclass("esri.webscene.support.Description")],e);var d}(c.declared(b));d["default"]=l})},"esri/webscene/support/Title":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(l,d,k,a,b,c){Object.defineProperty(d,"__esModule",{value:!0});l=function(b){function e(){var a=null!==b&&
b.apply(this,arguments)||this;return a.text="",a}return k(e,b),d=e,e.prototype.clone=function(){return new d({text:this.text})},a([c.property({type:String,json:{write:{isRequired:!0}}})],e.prototype,"text",void 0),e=d=a([c.subclass("esri.webscene.support.Title")],e);var d}(c.declared(b));d["default"]=l})},"esri/webscene/support/Thumbnail":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(l,d,k,a,b,c){Object.defineProperty(d,"__esModule",{value:!0});l=function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;return a.url="",a}return k(e,b),d=e,e.prototype.clone=function(){return new d({url:this.url})},a([c.property({type:String,json:{write:{isRequired:!0}}})],e.prototype,"url",void 0),e=d=a([c.subclass("esri.webscene.support.Thumbnail")],e);var d}(c.declared(b));d["default"]=l})},"esri/webscene/InitialViewProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../Viewpoint ../core/Accessor ../geometry/SpatialReference ./Environment ../core/accessorSupport/decorators".split(" "),
function(l,d,k,a,b,c,e,m,h){return function(c){function d(a){a=c.call(this,a)||this;return a.environment=new m,a.spatialReference=null,a.viewpoint=null,a}return k(d,c),g=d,Object.defineProperty(d.prototype,"viewingMode",{set:function(a){"local"!==a&&"global"!==a||this._set("viewingMode",a)},enumerable:!0,configurable:!0}),d.prototype.clone=function(){return new g({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,
viewpoint:this.viewpoint?this.viewpoint.clone():null})},a([h.property({type:m,json:{write:{isRequired:!0}}})],d.prototype,"environment",void 0),a([h.property({type:e})],d.prototype,"spatialReference",void 0),a([h.property()],d.prototype,"viewingMode",null),a([h.property({type:b,json:{write:{isRequired:!0}}})],d.prototype,"viewpoint",void 0),d=g=a([h.subclass("esri.webscene.InitialViewProperties")],d);var g}(h.declared(c))})},"esri/webscene/Version":function(){define(["require","exports","../core/tsSupport/extendsHelper",
"../core/Version"],function(l,d,k,a){Object.defineProperty(d,"__esModule",{value:!0});l=function(a){function b(b,c){return a.call(this,b,c,"webscene")||this}return k(b,a),Object.defineProperty(b.prototype,"supportsGround",{get:function(){return this.since(1,8)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"supportsVisibleElevationLayersInSlides",{get:function(){return this.lessThan(1,8)},enumerable:!0,configurable:!0}),b}(a.Version);d.Version=l;d["default"]=l})},"esri/core/Version":function(){define(["require",
"exports","./Error"],function(l,d,k){Object.defineProperty(d,"__esModule",{value:!0});l=function(){function a(a,c,e){void 0===e&&(e="");this.major=a;this.minor=c;this._context=e}return a.prototype.lessThan=function(a,c){return this.major<a||a===this.major&&this.minor<c},a.prototype.since=function(a,c){return!this.lessThan(a,c)},a.prototype.validate=function(a){if(this.major!==a.major)throw new k((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+
" ")+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:a});},a.prototype.clone=function(){return new a(this.major,this.minor,this._context)},a.parse=function(b,c){void 0===c&&(c="");var e=b.split("."),d=e[0],e=e[1],h=/^\s*\d+\s*$/;if(!d||!d.match||!d.match(h))throw new k((c&&c+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:b});if(!e||!e.match||!e.match(h))throw new k((c&&c+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",
{version:b});b=parseInt(d,10);d=parseInt(e,10);return new a(b,d,c)},a}();d.Version=l})},"*noref":1}});
define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/tsSupport/paramHelper ./Map ./core/Error ./core/requireUtils ./core/promiseUtils ./core/JSONSupport ./core/Loadable ./core/Collection ./core/urlUtils ./core/Logger ./core/accessorSupport/read ./core/accessorSupport/originUtils ./support/webSceneUtils ./Viewpoint ./kernel ./geometry/support/jsonUtils ./geometry/Extent ./geometry/HeightModelInfo ./geometry/SpatialReference ./geometry/support/heightModelInfoUtils ./webscene/Presentation ./webscene/InitialViewProperties ./webscene/Environment ./webscene/Version ./portal/PortalItem ./portal/Portal dojo/has dojo/_base/lang ./core/accessorSupport/decorators".split(" "),function(l,
d,k,a,b,c,e,m,h,g,u,r,q,t,v,x,y,A,L,f,n,F,I,S,P,T,W,N,B,J,O,z,p){var R=t.getLogger("esri.WebScene"),Y=O("dojo-debug-messages"),U=new N["default"](1,9);return function(c){function d(a){a=c.call(this)||this;return a.clippingArea=null,a.clippingEnabled=!1,a.heightModelInfo=null,a.sourceVersion=null,a.supportsHeightModelInfo=!0,a.presentation=null,a.initialViewProperties=null,a.portalItem=null,a.resourceInfo=null,a.authoringApp=null,a.authoringAppVersion=null,a._isAuthoringAppSetByUser=!1,a._isAuthoringAppVersionSetByUser=
!1,a}return k(d,c),d.prototype.initialize=function(){if(this.when()["catch"](function(a){R.error("#load()","Failed to load web scene",a)}),this.resourceInfo){var a=void 0;try{a=this._validateJSON(this.resourceInfo)}catch(G){return void this.addResolvingPromise(h.reject(G))}this.read(a);this.addResolvingPromise(this._validateSpatialReference());this.addResolvingPromise(this._validateHeightModelInfo())}},d.prototype.getDefaults=function(a){return z.mixin(this.inherited(arguments),{presentation:{},initialViewProperties:{}})},
d.prototype.writeClippingArea=function(a,b){b.clippingArea||(b.clippingArea={});b.clippingArea.geometry=a.toJSON()},d.prototype.readClippingEnabled=function(a,b){return b.clippingArea?!!b.clippingArea.clip:!1},d.prototype.writeClippingEnabled=function(a,b){this.clippingArea&&(b.clippingArea||(b.clippingArea={}),b.clippingArea.clip=a)},d.prototype.writeLayers=function(a,b,c,d){var e=this,f=z.mixin({},d,{layerContainerType:"operational-layers"});a=a.filter(function(a){return e.verifyWriteLayer(a,f)}).map(function(a){return a.write(null,
f)}).filter(function(a){return!!a});b[c]=a.toArray()},d.prototype.verifyWriteLayer=function(a,b){return a.write?!0:(b&&b.messages&&b.messages.push(new e("layer:unsupported","Layers ("+a.title+", "+a.id+") of type '"+a.declaredClass+"' cannot be persisted in web scenes",{layer:a})),!1)},d.prototype.readSourceVersion=function(a,b){a=b.version.split(".");b=a[1];return new N["default"](parseInt(a[0],10),parseInt(b,10))},d.prototype.writeSourceVersion=function(a,b,c){b[c]=U.major+"."+U.minor},Object.defineProperty(d.prototype,
"authoringApp",{set:function(a){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",a)},enumerable:!0,configurable:!0}),d.prototype.writeAuthoringApp=function(a,b){a&&this._isAuthoringAppSetByUser?b.authoringApp=a:b.authoringApp="ArcGIS API for JavaScript"},Object.defineProperty(d.prototype,"authoringAppVersion",{set:function(a){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",a)},enumerable:!0,configurable:!0}),d.prototype.writeAuthoringAppVersion=function(a,b){a&&this._isAuthoringAppVersionSetByUser?
b.authoringAppVersion=a:b.authoringAppVersion=L.version},d.prototype.writeGround=function(a,b,c,d){a?b[c]=a.write(null,d):b[c]={layers:[]}},d.prototype.readInitialViewProperties=function(a,b){a={};return b.initialState&&b.initialState.environment&&(a.environment=W.fromJSON(b.initialState.environment)),b.spatialReference&&(a.spatialReference=I.fromJSON(b.spatialReference)),a.viewingMode=b.viewingMode||"global",b.initialState&&b.initialState.viewpoint&&(a.viewpoint=A.fromJSON(b.initialState.viewpoint)),
new T(a)},d.prototype.writeInitialViewProperties=function(a,b,c,d){a&&(c={},a.environment&&(c.environment=a.environment.write({},d)),a.viewpoint&&(c.viewpoint=a.viewpoint.write({},d)),0!==Object.keys(c).length&&(b.initialState=c),b.spatialReference=a.spatialReference?a.spatialReference.write({},d):I.WebMercator.toJSON(),b.viewingMode=null!=a.viewingMode?a.viewingMode:"global")},d.prototype.load=function(){return this.addResolvingPromise(this._loadFromSource()),this.when()},d.prototype.read=function(a,
b){var c=this;b=z.mixin({},b,{origin:"web-scene"});var d=this._isAuthoringAppVersionSetByUser,e=this._isAuthoringAppSetByUser,f=arguments;if(v.readLoadable(this,a,function(b){return c.inherited(f,[a,b])},b),e||(this._isAuthoringAppSetByUser=!1),d||(this._isAuthoringAppVersionSetByUser=!1),a.baseMap&&Array.isArray(a.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){var d=a.baseMap.elevationLayers.map(function(a){return{id:a.id}}),g=this.presentation.slides,h=function(a,
b){return a.visibleLayers.some(function(a){return a.id===b})},w=d.filter(function(a){return!g.some(function(b){return h(b,a.id)})});g.forEach(function(a){a.visibleLayers.addMany(w)})}return this},d.prototype._writeBasemapElevationLayers=function(a){var b=a.ground&&a.ground.layers;!a.baseMap&&b&&b.length&&(a.baseMap={title:"Basemap",baseMapLayers:[]});a.baseMap&&(a.baseMap.elevationLayers=z.clone(b))},d.prototype.write=function(a,b){if("loaded"!==this.loadStatus){var c=new e("webscene:not-loaded",
"Web scene must be loaded before it can be serialized");throw R.error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),c;}b=z.mixin({},b,{origin:"web-scene"});c=this.inherited(arguments,[a,b]);return this._writeBasemapElevationLayers(c),c},d.prototype.save=function(a){var b=this;if(!this.portalItem)return R.error("save(): requires the .portalItem property to be set"),h.reject(new e("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene"));
if("Web Scene"!==this.portalItem.type)return h.reject(new e("webscene:portal-item-wrong-type",'Portal item needs to have type "Web Scene"'));var c,d;return this.load().then(function(){return b._loadObjectsWithLayers()}).then(function(){return c=b._enableVerifyItemRelativeUrls({origin:"web-scene",url:b.portalItem.itemUrl&&q.urlToObject(b.portalItem.itemUrl),messages:[],portal:b.portalItem.portal||J.getDefault(),writtenProperties:[],blockedRelativeUrls:[]}),d=b.write(null,c),b._verifySave(d,c,a).then(function(){return b._updateTypeKeywords(b.portalItem),
b.portalItem.update({data:d})})}).then(function(){return x.updateOrigins(c),h.resolve(b.portalItem)})},d.prototype.saveAs=function(a,b){var c=this;if(!a)return R.error("saveAs(portalItem): requires a portal item parameter"),h.reject(new e("webscene:portal-item-required","saveAs requires a portal item to save to"));if(a.type&&"Web Scene"!==a.type||a.id)return h.reject(new e("webscene:portal-item-already-exists","WebScene can only saveAs to a new and empty portal item"));var d,f,w=a.portal||J.getDefault();
return this.load().then(function(){return c._loadObjectsWithLayers()}).then(function(){return d=c._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:w,writtenProperties:[],blockedRelativeUrls:[]}),f=c.write(null,d),c._verifySaveAs(f,d,b).then(function(){return w._signIn()})}).then(function(){return a.type="Web Scene",a.portal=w,c._updateTypeKeywords(a),w.user.addItem({item:a,folder:b&&b.folder,data:f})}).then(function(){return c.portalItem=a,g.prototype.read.call(c,{version:f.version,
authoringApp:f.authoringApp,authoringAppVersion:f.authoringAppVersion},{name:"web-scene",url:a.itemUrl&&q.urlToObject(a.itemUrl)}),x.updateOrigins(d),h.resolve(a)})},d.prototype._verifySave=function(a,b,c,d){void 0===d&&(d=!1);var f=b.messages.filter(function(a){return"error"===a.type}).map(function(a){return new e(a.name,a.message,a.details)});b.blockedRelativeUrls&&(f=f.concat(b.blockedRelativeUrls.map(function(a){return new e("url:unsupported","Relative url '"+a+"' is not supported in Web Scene")})));
c&&c.ignoreUnsupported&&(f=f.filter(function(a){return"layer:unsupported"!==a.name&&"symbol:unsupported"!==a.name&&"property:unsupported"!==a.name}));c&&c.strictSchemaValidationEnabled||(f=f.filter(function(a){return"web-document-write:property-required"!==a.name}));var g,w=c&&c.strictSchemaValidationEnabled;return g=Y||w?m.when(l,"./webscene/validator").then(function(b){b=b.validate(a);if(0<b.length){var c="webscene did not validate:\n"+b.join("\n");R.error((d?"saveAs":"save")+"(): "+c)}return b.map(function(a){return new e("webscene:schema-validation",
a)})}).then(function(a){return w&&0<a.length?(a=y.createSchemaValidationError(a.concat(f)),h.reject(a)):f}):h.resolve(f),g.then(function(a){return 0<a.length?h.reject(new e("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a})):void 0})},d.prototype._verifySaveAs=function(a,b,c){return this.canSaveAs(b)?h.reject(y.createCopyError()):this._verifySave(a,b,c,!0)},d.prototype.verifySaveAs=function(a){var b=this._enableVerifyItemRelativeUrls({origin:"web-scene",
messages:[]}),c=this.write(null,b);return this._verifySaveAs(c,b,a)},d.prototype.canSaveAs=function(a){return a||(a=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write(null,a)),a.verifyItemRelativeUrls&&0<a.verifyItemRelativeUrls.writtenUrls.length},d.prototype.updateFrom=function(a,b){void 0===b&&(b={});b.environmentExcluded||(this.initialViewProperties.environment=W.prototype.clone.apply(a.environment));b.viewpointExcluded||(this.initialViewProperties.viewpoint=a.viewpoint.clone());
this.initialViewProperties.spatialReference=a.spatialReference.clone();this.initialViewProperties.viewingMode=a.viewingMode;a.clippingArea?a.clippingArea!==this.clippingArea&&(this.clippingArea=a.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1;a.heightModelInfo&&(this.heightModelInfo=a.heightModelInfo.clone());a.map===this&&a.allLayerViews.forEach(function(a){a.layer.visible=a.visible})},d.prototype._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,
{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()},d.prototype._readAndLoadFromJSON=function(a,b){a=this._validateJSON(a,b&&b.url&&b.url.path);return this.read(a,b),this._loadFromJSON(a,b)},d.prototype._extractOperationalLayers=function(a){var b=this,c=[];if(!this.sourceVersion.supportsGround&&a.baseMap&&Array.isArray(a.baseMap.elevationLayers))for(var d=0,e=a.baseMap.elevationLayers;d<e.length;d++)c.push(e[d]);var f=[],g=function(a){return a.layers&&
(a.layers=a.layers.filter(g)),"ArcGISTiledElevationServiceLayer"===a.layerType?(b.sourceVersion.supportsGround||f.push(a),!1):!0};return{operationalLayers:a.operationalLayers?a.operationalLayers.filter(g):[],operationalElevationLayers:f,basemapElevationLayers:c}},d.prototype._loadFromJSON=function(a,b){var c=this,d=new r;return this._validateSpatialReference().then(function(){return c._validateHeightModelInfo()}).then(function(){return m.when(l,"./portal/support/layersCreator")}).then(function(e){var f=
c._extractOperationalLayers(a),g=f.operationalLayers,k=f.operationalElevationLayers,f=f.basemapElevationLayers,l=[],w={context:z.mixin({},b,{layerContainerType:"operational-layers"})};if(c.portalItem&&(w.context.portal=c.portalItem.portal||J.getDefault()),0<f.length){var m=z.mixin({},w,{context:z.mixin({},w.context,{layerContainerType:"ground"})});m.defaultLayerType="ArcGISTiledElevationServiceLayer";l.push.apply(l,e.populateOperationalLayers(c.ground.layers,f,m))}0<k.length&&(m=z.mixin({},w,{context:z.mixin({},
w.context,{layerContainerType:"ground"})}),m.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push.apply(l,e.populateOperationalLayers(d,k,m)));return g&&0<g.length&&l.push.apply(l,e.populateOperationalLayers(c.layers,g,w)),h.eachAlways(l).then(function(){})}).then(function(){return c._loadObjectsWithLayers()}).then(function(){c.ground.layers.addMany(d)})},d.prototype._loadObjectsWithLayers=function(){var a=[];return this.ground&&a.push(this.ground.load()),this.basemap&&a.push(this.basemap.load()),
this.presentation.slides.forEach(function(b){b.basemap&&a.push(b.basemap.load())}),h.eachAlways(a).then(function(){})},d.prototype._loadFromItem=function(a){var b=this;return a.load().otherwise(function(a){throw new e("webscene:load-portal-item","Failed to load portal item",{error:a});}).then(function(){if("Web Scene"!==a.type)throw new e("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:a.type});}).then(function(){return a.fetchData()}).then(function(c){return b.resourceInfo=
c,b._readAndLoadFromJSON(c,{origin:"web-scene",url:q.urlToObject(a.itemUrl),portal:a.portal||J.getDefault()})})},d.prototype._validateSpatialReference=function(){var a,b=this.initialViewProperties,c=this._sceneSpatialReference;if("local"!==b.viewingMode){if(!c.isWGS84&&!c.isWebMercator)return h.reject(new e("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator or WGS84 GCS are supported",{spatialReference:c,viewingMode:b.viewingMode}));
a=function(a){return!a||a.isWGS84||a.isWebMercator}}else{if(c.isGeographic)return h.reject(new e("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:c,viewingMode:b.viewingMode}));a=function(a){return!a||a.equals(c)}}var d=function(a){return a&&(a.camera&&a.camera.position&&a.camera.position.spatialReference||a.targetGeometry&&a.targetGeometry.spatialReference)},f=d(b.viewpoint);
return f&&!a(f)?h.reject(new e("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:f,sceneSpatialReference:c,viewingMode:b.viewingMode})):(f=this.presentation.slides.find(function(b){return!a(d(b.viewpoint))}))?(f=d(f.viewpoint),h.reject(new e("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",
{slideSpatialReference:f,sceneSpatialReference:c,viewingMode:b.viewingMode}))):h.resolve()},d.prototype._validateHeightModelInfo=function(){var a=S.validateWebSceneError(this.heightModelInfo,this._sceneSpatialReference);return a?h.reject(a):h.resolve()},d.prototype._validateJSON=function(a,b){void 0===b&&(b=null);a=this._sanitizeJSON(a,b);b=N["default"].parse(a.version,"webscene");return U.validate(b),a.version=b.major+"."+b.minor,1===b.major&&2>=b.minor&&(a.spatialReference=I.WebMercator.toJSON()),
a},d.prototype._sanitizeJSON=function(a,b){void 0===b&&(b=null);return{version:a.version||"",baseMap:a.baseMap,ground:a.ground,operationalLayers:a.operationalLayers,authoringApp:a.authoringApp||"",authoringAppVersion:a.authoringAppVersion||"",viewingMode:a.viewingMode||"global",presentation:a.presentation&&P.sanitizeJSON(a.presentation)||{},initialState:a.initialState,spatialReference:a.spatialReference||I.WebMercator.toJSON(),heightModelInfo:a.heightModelInfo||null,clippingArea:a.clippingArea}},
d.prototype._updateTypeKeywords=function(a){"local"===this.initialViewProperties.viewingMode?a.typeKeywords?-1===a.typeKeywords.indexOf("ViewingMode-Local")&&a.typeKeywords.push("ViewingMode-Local"):a.typeKeywords=["ViewingMode-Local"]:"global"===this.initialViewProperties.viewingMode&&a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a){return"ViewingMode-Local"!==a}));a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a,b,c){return c.indexOf(a)===b}))},Object.defineProperty(d.prototype,
"_sceneSpatialReference",{get:function(){return this.initialViewProperties.spatialReference||I.WebMercator},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"_verifyItemRelativeRootPath",{get:function(){return this.portalItem&&this.portalItem.itemUrl?q.urlToObject(this.portalItem.itemUrl).path:null},enumerable:!0,configurable:!0}),d.prototype._enableVerifyItemRelativeUrls=function(a){var b=this._verifyItemRelativeRootPath;return b&&(a.verifyItemRelativeUrls={rootPath:b,writtenUrls:[]}),
a},d.fromJSON=function(a){if(!a)throw new e("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:a})},d.VERSION=U,a([p.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],d.prototype,"basemap",void 0),a([p.property({type:n,json:{read:{source:"clippingArea.geometry",reader:f.fromJSON},write:{target:"clippingArea.geometry"}}})],d.prototype,"clippingArea",void 0),a([p.writer("clippingArea")],d.prototype,"writeClippingArea",null),a([p.property({type:Boolean,
json:{write:{target:"clippingArea.clip"}}})],d.prototype,"clippingEnabled",void 0),a([p.reader("clippingEnabled",["clippingArea"])],d.prototype,"readClippingEnabled",null),a([p.writer("clippingEnabled")],d.prototype,"writeClippingEnabled",null),a([p.property({type:F,json:{write:!0}})],d.prototype,"heightModelInfo",void 0),a([p.property({json:{write:{target:"operationalLayers"}}})],d.prototype,"layers",void 0),a([p.writer("layers")],d.prototype,"writeLayers",null),a([p.property({readOnly:!0,type:N["default"],
json:{type:String,write:{allowNull:!0,target:"version",isRequired:!0}}})],d.prototype,"sourceVersion",void 0),a([p.reader("sourceVersion",["version"])],d.prototype,"readSourceVersion",null),a([p.writer("sourceVersion")],d.prototype,"writeSourceVersion",null),a([p.property({type:String,json:{write:{allowNull:!0}}})],d.prototype,"authoringApp",null),a([p.writer("authoringApp")],d.prototype,"writeAuthoringApp",null),a([p.property({type:String,json:{write:{allowNull:!0}}})],d.prototype,"authoringAppVersion",
null),a([p.writer("authoringAppVersion")],d.prototype,"writeAuthoringAppVersion",null),a([p.property({json:{write:{isRequired:!0,allowNull:!0,enabled:!0}}})],d.prototype,"ground",void 0),a([p.writer("ground")],d.prototype,"writeGround",null),a([p.property({type:P,json:{write:!0}})],d.prototype,"presentation",void 0),a([p.property({type:T})],d.prototype,"initialViewProperties",void 0),a([p.reader("initialViewProperties",["initialState.environment","spatialReference","viewingMode","initialState.viewpoint"])],
d.prototype,"readInitialViewProperties",null),a([p.writer("initialViewProperties",{"initialState.environment":{type:W},spatialReference:{type:I},viewingMode:{type:String},"initialState.viewpoint":{type:A}})],d.prototype,"writeInitialViewProperties",null),a([p.property({type:B})],d.prototype,"portalItem",void 0),a([p.property()],d.prototype,"resourceInfo",void 0),a([b(0,p.cast(B))],d.prototype,"saveAs",null),a([p.property()],d.prototype,"_sceneSpatialReference",null),a([p.property()],d.prototype,"_verifyItemRelativeRootPath",
null),d=a([p.subclass("esri.WebScene")],d)}(p.declared(c,u,g))});