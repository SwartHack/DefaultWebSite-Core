//>>built
define("require exports ../geometry/Geometry ../geometry/Polygon ../geometry/Polyline ../geometry/Point ../geometry/Extent ../geometry/Multipoint ../geometry/SpatialReference dojo/promise/all dojo/Deferred dojo/promise/Promise ./languageUtils ./treeAnalysis ./Dictionary ./Feature ./FunctionWrapper ./functions/date ./functions/maths ./functions/geometry ./ImmutablePathArray ./ImmutablePointArray ./kernel ./functions/string ./functions/stats ./functions/geomasync".split(" "),function(T,t,U,ha,ia,ja,
ka,la,ma,A,l,na,f,m,u,x,E,oa,pa,qa,V,ra,g,sa,ta,ua){function n(c){var b=new l;return c instanceof Error?b.reject(c):b.reject(Error(c)),b.promise}function W(c){var b=new l;return b.resolve(c),b.promise}function I(c,b){for(var a=new l,d=[],e=0;e<b.arguments.length;e++)d.push(k(c,b.arguments[e]));return A(d).then(g.callback(function(b){a.resolve(b)},a),g.errback(a)),a.promise}function v(c,b,a){var d=new l;try{return I(c,b).then(g.callback(function(e){d.resolve(a(c,b,e))},d),g.errback(d)),d.promise}catch(e){return n(e)}}
function B(c,b,a){var d=new l;try{return I(c,b).then(g.callback(function(e){e=a(c,b,e);e instanceof na?e.then(g.callback(function(a){d.resolve(a)},d),g.errback(d)):d.resolve(e)},d),g.errback(d)),d.promise}catch(e){return n(e)}}function k(c,b){try{switch(b.type){case "VariableDeclarator":return va(c,b);case "VariableDeclaration":return X(c,b,0);case "BlockStatement":return wa(c,b);case "FunctionDeclaration":var a=new l;try{var d=b.id.name.toLowerCase();c.globalScope[d]={valueset:!0,node:null,value:new E(b,
c)};a.resolve(f.voidOperation)}catch(J){a.reject(J)}return a.promise;case "ReturnStatement":return xa(c,b);case "IfStatement":return ya(c,b);case "ExpressionStatement":return za(c,b);case "UpdateExpression":return Aa(c,b);case "AssignmentExpression":return Ba(c,b);case "ForStatement":return Ca(c,b);case "ForInStatement":return Da(c,b);case "BreakStatement":var e=new l;return e.resolve(f.breakResult),e.promise;case "EmptyStatement":var h=new l;return h.resolve(f.voidOperation),h.promise;case "ContinueStatement":var g=
new l;return g.resolve(f.continueResult),g.promise;case "Identifier":return K(c,b);case "MemberExpression":return Ea(c,b);case "Literal":return W(b.value);case "ThisExpression":return n(m.nodeErrorMessage(b,"RUNTIME","NOTSUPPORTED"));case "CallExpression":return Fa(c,b);case "UnaryExpression":return Ga(c,b);case "BinaryExpression":return Ha(c,b);case "LogicalExpression":return Ia(c,b);case "ConditionalExpression":return n(m.nodeErrorMessage(b,"RUNTIME","NOTSUPPORTED"));case "ArrayExpression":return Ja(c,
b);case "ObjectExpression":return Ka(c,b);case "Property":return La(c,b);case "Array":return n(m.nodeErrorMessage(b,"RUNTIME","NOTSUPPORTED"));default:return n(m.nodeErrorMessage(b,"RUNTIME","UNREOGNISED"))}}catch(J){return n(J)}}function Ka(c,b){try{for(var a=new l,d=[],e=0;e<b.properties.length;e++)d.push(k(c,b.properties[e]));return A(d).then(g.callback(function(b){for(var c={},d=0;d<b.length;d++){var e=b[d];if(f.isFunctionParameter(e.value))throw Error("Illegal Argument");if(!1===f.isString(e.key))throw Error("Illegal Argument");
e.value===f.voidOperation?c[e.key.toString()]=null:c[e.key.toString()]=e.value}b=new u(c);b.immutable=!1;a.resolve(b)},a),g.errback(a)),a.promise}catch(h){return n(h)}}function La(c,b){var a=new l;try{k(c,b.value).then(g.callback(function(c){a.resolve({key:"Identifier"===b.key.type?b.key.name:b.key.value,value:c})},a),g.errback(a))}catch(d){a.reject(d)}return a.promise}function Y(c,b,a){var d=new l;try{k(c,b.body).then(g.callback(function(e){return a.lastAction=e,a.lastAction===f.breakResult?(a.testResult=
!1,void d.resolve(a)):a.lastAction instanceof f.ReturnResult?(a.testResult=!1,void d.resolve(a)):void(null!==b.update?k(c,b.update).then(g.callback(function(b){d.resolve(a)},d),g.errback(d)):d.resolve(a))},d),g.errback(d))}catch(e){d.reject(e)}return d.promise}function Ma(c,b,a){var d=new l;try{return null!==b.test?(k(c,b.test).then(g.callback(function(e){return!0===c.progressTracker.isCanceled()?void d.reject(Error("Cancelled")):(a.testResult=e,!1===a.testResult?void d.resolve(a):!0!==a.testResult?
void d.reject(Error(m.nodeErrorMessage(b,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))):void Y(c,b,a).then(g.callback(function(a){d.resolve(a)},d),g.errback(d)))},d),g.errback(d)),d.promise):Y(c,b,a)}catch(e){d.reject(e)}return d.promise}function F(c,b,a,d,e,h){try{Ma(c,b,a).then(function(){try{!0===a.testResult?(h++,h>G?(h=0,setTimeout(function(){F(c,b,a,function(a){d(a)},function(a){e(a)},h)})):F(c,b,a,function(a){d(a)},function(a){e(a)},h)):d(a.lastAction instanceof f.ReturnResult?a.lastAction:
f.voidOperation)}catch(p){e(p)}},function(a){e(a)})}catch(p){e(p)}}function Ca(c,b){var a=new l;try{null!==b.init?k(c,b.init).then(g.callback(function(){F(c,b,{testResult:!0,lastAction:f.voidOperation},function(b){a.resolve(b)},function(b){a.reject(b)},0)},a),g.errback(a)):F(c,b,{testResult:!0,lastAction:f.voidOperation},function(b){a.resolve(b)},function(b){a.reject(b)},0)}catch(d){a.reject(d)}return a.promise}function L(c,b,a,d,e,h,g,l,r,y){try{if(h>=d)return void l(f.voidOperation);"k"===g?e.value=
a[h]:e.value=h;k(c,b.body).then(function(p){try{p instanceof f.ReturnResult?l(p):p===f.breakResult?l(f.voidOperation):(y++,y>G?(y=0,setTimeout(function(){L(c,b,a,d,e,h+1,g,function(a){l(a)},function(a){r(a)},y)})):L(c,b,a,d,e,h+1,g,function(a){l(a)},function(a){r(a)},y))}catch(N){r(N)}},function(a){r(a)})}catch(M){r(M)}}function O(c,b,a,d,e,h,g,l,r){try{if(a.length()<=e)return void g(f.voidOperation);"k"===h?d.value=a.get(e):d.value=e;k(c,b.body).then(function(p){p instanceof f.ReturnResult?g(p):
p===f.breakResult?g(f.voidOperation):(r++,r>G?(r=0,setTimeout(function(){O(c,b,a,d,e+1,h,function(a){g(a)},function(a){l(a)},r)})):O(c,b,a,d,e+1,h,function(a){g(a)},function(a){l(a)},r))},function(a){l(a)})}catch(y){l(y)}}function P(c,b,a,d,e,h){try{if(void 0===h&&(h="i"),0===a.length)return void d.resolve(f.voidOperation);L(c,b,a,a.length,e,0,h,function(a){d.resolve(a)},function(a){d.reject(a)},0)}catch(p){d.reject(p)}}function Na(c,b,a,d,e,h){try{if(void 0===h&&(h="i"),0===a.length)return void d.resolve(f.voidOperation);
O(c,b,a,e,0,h,function(a){d.resolve(a)},function(a){d.reject(a)},0)}catch(p){d.reject(p)}}function Oa(c,b,a,d,e){try{var f=a.keys();P(c,b,f,d,e,"k")}catch(p){d.reject(p)}}function Q(c,b,a,d,e,g,p,l){try{c.next().then(function(h){try{if(null===h)g(f.voidOperation);else{var r=new x(h.attributes,h.geometry,d);r._underlyingGraphic=h;e.value=r;k(b,a.body).then(function(h){try{h===f.breakResult?g(f.voidOperation):h instanceof f.ReturnResult?g(h):(l++,l>G?(l=0,setTimeout(function(){Q(c,b,a,d,e,function(a){g(a)},
function(a){p(a)},l)})):Q(c,b,a,d,e,function(a){g(a)},function(a){p(a)},l))}catch(N){p(N)}},function(a){p(a)})}}catch(M){p(M)}},function(a){p(a)})}catch(r){p(r)}}function Da(c,b){var a=new l;try{k(c,b.right).then(g.callback(function(d){var e=null;"VariableDeclaration"===b.left.type?e=k(c,b.left):(e=new l,e.resolve(),e=e.promise);e.then(g.callback(function(){var e="VariableDeclaration"===b.left.type?b.left.declarations[0].id.name:b.left.name,g=null;return null!==c.localScope&&void 0!==c.localScope[e]&&
(g=c.localScope[e]),null===g&&void 0!==c.globalScope[e]&&(g=c.globalScope[e]),null===g?void a.reject(Error(m.nodeErrorMessage(b,"RUNTIME","VARIABLENOTDECLARED"))):void(f.isArray(d)||f.isString(d)?P(c,b,d,a,g):f.isImmutableArray(d)?Na(c,b,d,a,g):d instanceof u||d instanceof x?Oa(c,b,d,a,g):f.isFeatureCursor(d)?Q(d.iterator(c.progressTracker),c,b,d,g,function(b){a.resolve(b)},function(b){a.reject(b)},0):P(c,b,[],a,g))},a),g.errback(a))},a),g.errback(a))}catch(d){a.reject(d)}return a.promise}function Aa(c,
b){var a=new l;try{if("MemberExpression"!==b.argument.type){var d=b.argument.name.toLowerCase(),e=void 0;if(null!==c.localScope&&void 0!==c.localScope[d])return e=f.toNumber(c.localScope[d].value),c.localScope[d]={value:"++"===b.operator?e+1:e-1,valueset:!0,node:b},!1===b.prefix?a.resolve(e):a.resolve("++"===b.operator?e+1:e-1),a.promise;throw void 0!==c.globalScope[d]&&(e=f.toNumber(c.globalScope[d].value),c.globalScope[d]={value:"++"===b.operator?e+1:e-1,valueset:!0,node:b},!1===b.prefix?a.resolve(e):
a.resolve("++"===b.operator?e+1:e-1)),Error("Variable not recognised");}k(c,b.argument.object).then(g.callback(function(d){var e=null,h=null;!0===b.argument.computed?h=k(c,b.argument.property):(e=new l,e.resolve(b.argument.property.name),h=e.promise);h.then(g.callback(function(c){var e;if(f.isArray(d)){if(!f.isNumber(c))throw Error("Invalid Parameter");if(0>c&&(c=d.length+c),0>c||c>=d.length)throw Error("Assignment outside of array bounds");e=f.toNumber(d[c]);d[c]="++"===b.operator?e+1:e-1}else{if(d instanceof
u){if(!1===f.isString(c))throw Error("Dictionary accessor must be a string");}else{if(!(d instanceof x))throw f.isImmutableArray(d)?Error("Array is Immutable"):Error("Invalid Parameter");if(!1===f.isString(c))throw Error("Feature accessor must be a string");}if(!0!==d.hasField(c))throw Error("Invalid Parameter");e=f.toNumber(d.field(c));d.setField(c,"++"===b.operator?e+1:e-1)}!1===b.prefix?a.resolve(e):a.resolve("++"===b.operator?e+1:e-1)},a),g.errback(a))},a),g.errback(a))}catch(h){a.reject(h)}return a.promise}
function C(c,b,a,d){switch(b){case "\x3d":return c===f.voidOperation?null:c;case "/\x3d":return f.toNumber(a)/f.toNumber(c);case "*\x3d":return f.toNumber(a)*f.toNumber(c);case "-\x3d":return f.toNumber(a)-f.toNumber(c);case "+\x3d":return f.isString(a)||f.isString(c)?f.toString(a)+f.toString(c):f.toNumber(a)+f.toNumber(c);case "%\x3d":return f.toNumber(a)%f.toNumber(c);default:throw Error(m.nodeErrorMessage(d,"RUNTIME","OPERATORNOTRECOGNISED"));}}function Ba(c,b){var a=new l;try{if("MemberExpression"===
b.left.type)k(c,b.right).then(g.callback(function(d){k(c,b.left.object).then(g.callback(function(e){var h=null,m=null;!0===b.left.computed?m=k(c,b.left.property):(h=new l,h.resolve(b.left.property.name),m=h.promise);m.then(g.callback(function(c){if(f.isArray(e)){if(!f.isNumber(c))throw Error("Invalid Parameter");if(0>c&&(c=e.length+c),0>c||c>e.length)throw Error("Assignment outside of array bounds");if(c===e.length&&"\x3d"!==b.operator)throw Error("Invalid Parameter");e[c]=C(d,b.operator,e[c],b)}else{if(e instanceof
u){if(!1===f.isString(c))throw Error("Dictionary accessor must be a string");}else{if(!(e instanceof x))throw f.isImmutableArray(e)?Error("Array is Immutable"):Error("Invalid Parameter");if(!1===f.isString(c))throw Error("Feature accessor must be a string");}if(!0===e.hasField(c))e.setField(c,C(d,b.operator,e.field(c),b));else{if("\x3d"!==b.operator)throw Error("Invalid Parameter");e.setField(c,C(d,b.operator,null,b))}}a.resolve(f.voidOperation)},a),g.errback(a))},a),g.errback(a))},a),g.errback(a));
else{var d=b.left.name.toLowerCase();if(null!==c.localScope&&void 0!==c.localScope[d])return k(c,b.right).then(g.callback(function(e){c.localScope[d]={value:C(e,b.operator,c.localScope[d].value,b),valueset:!0,node:b.right};a.resolve(f.voidOperation)},a),g.errback(a)),a.promise;if(void 0!==c.globalScope[d])return k(c,b.right).then(g.callback(function(e){c.globalScope[d]={value:C(e,b.operator,c.globalScope[d].value,b),valueset:!0,node:b.right};a.resolve(f.voidOperation)},a),g.errback(a)),a.promise;
a.reject(Error("Cannot assign undeclared variable"))}}catch(e){a.reject(e)}return a.promise}function za(c,b){var a=new l;try{"AssignmentExpression"===b.expression.type?k(c,b.expression).then(g.callback(function(b){a.resolve(b)},a),g.errback(a)):k(c,b.expression).then(g.callback(function(b){return b===f.voidOperation?void a.resolve(f.voidOperation):void a.resolve(new f.ImplicitResult(b))},a),g.errback(a))}catch(d){a.reject(d)}return a.promise}function ya(c,b){var a=new l;try{if("AssignmentExpression"===
b.test.type||"UpdateExpression"===b.test.type)return a.reject(Error(m.nodeErrorMessage(b.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))),a.promise;k(c,b.test).then(g.callback(function(d){!0===d?k(c,b.consequent).then(g.callback(function(b){a.resolve(b)},a),g.errback(a)):!1===d?null!==b.alternate?k(c,b.alternate).then(g.callback(function(b){a.resolve(b)},a),g.errback(a)):a.resolve(f.voidOperation):a.reject(Error(m.nodeErrorMessage(b.test,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION")))},a),
g.errback(a))}catch(d){a.reject(d)}return a.promise}function wa(c,b){var a=new l;try{Z(c,b,0).then(g.callback(function(b){a.resolve(b)},a),g.errback(a))}catch(d){a.reject(d)}return a.promise}function Z(c,b,a){var d=new l;try{a>=b.body.length?d.resolve(f.voidOperation):k(c,b.body[a]).then(g.callback(function(e){e instanceof f.ReturnResult||e===f.breakResult||e===f.continueResult?d.resolve(e):a===b.body.length-1?d.resolve(e):Z(c,b,a+1).then(g.callback(function(a){d.resolve(a)},d),g.errback(d))},d),
g.errback(d))}catch(e){d.reject(e)}return d.promise}function xa(c,b){var a=new l;try{null===b.argument?a.resolve(new f.ReturnResult(f.voidOperation)):k(c,b.argument).then(g.callback(function(b){a.resolve(new f.ReturnResult(b))},a),g.errback(a))}catch(d){a.reject(d)}return a.promise}function X(c,b,a){var d=new l;try{if(a>=b.declarations.length)return d.resolve(f.voidOperation),d.promise;k(c,b.declarations[a]).then(g.callback(function(e){a===b.declarations.length-1?d.resolve(f.voidOperation):X(c,b,
a+1).then(g.callback(function(a){d.resolve(f.voidOperation)},d),g.errback(d))},d),g.errback(d))}catch(e){d.reject(e)}return d.promise}function va(c,b){var a=new l;try{var d=null;null===b.init?(d=new l,d.resolve(null),d=d.promise):d=k(c,b.init);null!==c.localScope?d.then(g.callback(function(d){d===f.voidOperation&&(d=null);var e=b.id.name.toLowerCase();c.localScope[e]={value:d,valueset:!0,node:b.init};a.resolve(f.voidOperation)},a),g.errback(a)):d.then(g.callback(function(d){var e=b.id.name.toLowerCase();
d===f.voidOperation&&(d=null);c.globalScope[e]={value:d,valueset:!0,node:b.init};a.resolve(f.voidOperation)},a),g.errback(a))}catch(e){a.reject(e)}return a.promise}function aa(c,b,a,d){switch(b=b.toLowerCase()){case "hasz":return c=c.hasZ,void 0===c?!1:c;case "hasm":return c=c.hasM,void 0===c?!1:c;case "spatialreference":return b=c.spatialReference._arcadeCacheId,void 0===b&&(a=!0,Object.freeze&&Object.isFrozen(c.spatialReference)&&(a=!1),a&&(w++,c.spatialReference._arcadeCacheId=w,b=w)),c=new u({wkt:c.spatialReference.wkt,
wkid:c.spatialReference.wkid}),void 0!==b&&(c._arcadeCacheId="SPREF"+b.toString()),c}switch(c.type){case "extent":switch(b){case "xmin":case "xmax":case "ymin":case "ymax":case "zmin":case "zmax":case "mmin":case "mmax":return c=c[b],void 0!==c?c:null;case "type":return"Extent"}break;case "polygon":switch(b){case "rings":return b=f.isVersion4?c.cache._arcadeCacheId:c.getCacheValue("_arcadeCacheId"),void 0===b&&(w++,b=w,f.isVersion4?c.cache._arcadeCacheId=b:c.setCacheValue("_arcadeCacheId",b)),c=new V(c.rings,
c.spatialReference,!0===c.hasZ,!0===c.hasM,b);case "type":return"Polygon"}break;case "point":switch(b){case "x":case "y":case "z":case "m":return void 0!==c[b]?c[b]:null;case "type":return"Point"}break;case "polyline":switch(b){case "paths":return b=f.isVersion4?c.cache._arcadeCacheId:c.getCacheValue("_arcadeCacheId"),void 0===b&&(w++,b=w,f.isVersion4?c.cache._arcadeCacheId=b:c.setCacheValue("_arcadeCacheId",b)),c=new V(c.paths,c.spatialReference,!0===c.hasZ,!0===c.hasM,b);case "type":return"Polyline"}break;
case "multipoint":switch(b){case "points":return b=f.isVersion4?c.cache._arcadeCacheId:c.getCacheValue("_arcadeCacheId"),void 0===b&&(w++,b=w,f.isVersion4?c.cache._arcadeCacheId=b:c.setCacheValue("_arcadeCacheId",b)),c=new ra(c.points,c.spatialReference,!0===c.hasZ,!0===c.hasM,b,1);case "type":return"Multipoint"}}throw Error(m.nodeErrorMessage(d,"RUNTIME","PROPERTYNOTFOUND"));}function Ea(c,b){try{var a=new l;return k(c,b.object).then(g.callback(function(d){return null===d?void a.reject(Error(m.nodeErrorMessage(b,
"RUNTIME","NOTFOUND"))):void(!1===b.computed?d instanceof u||d instanceof x?a.resolve(d.field(b.property.name)):d instanceof U?a.resolve(aa(d,b.property.name,c,b)):a.reject(Error(m.nodeErrorMessage(b,"RUNTIME","INVALIDTYPE"))):k(c,b.property).then(g.callback(function(e){if(d instanceof u||d instanceof x)f.isString(e)?a.resolve(d.field(e)):a.reject(Error(m.nodeErrorMessage(b,"RUNTIME","INVALIDTYPE")));else if(d instanceof U)f.isString(e)?a.resolve(aa(d,e,c,b)):a.reject(Error(m.nodeErrorMessage(b,"RUNTIME",
"INVALIDTYPE")));else if(f.isArray(d))if(f.isNumber(e)&&isFinite(e)&&Math.floor(e)===e){if(0>e&&(e=d.length+e),e>=d.length||0>e)throw Error(m.nodeErrorMessage(b,"RUNTIME","OUTOFBOUNDS"));a.resolve(d[e])}else a.reject(Error(m.nodeErrorMessage(b,"RUNTIME","INVALIDTYPE")));else if(f.isImmutableArray(d))if(f.isNumber(e)&&isFinite(e)&&Math.floor(e)===e){if(0>e&&(e=d.length()+e),e>=d.length()||0>e)throw Error(m.nodeErrorMessage(b,"RUNTIME","OUTOFBOUNDS"));a.resolve(d.get(e))}else a.reject(Error(m.nodeErrorMessage(b,
"RUNTIME","INVALIDTYPE")));else if(f.isString(d))if(f.isNumber(e)&&isFinite(e)&&Math.floor(e)===e){if(0>e&&(e=d.length+e),e>=d.length||0>e)throw Error(m.nodeErrorMessage(b,"RUNTIME","OUTOFBOUNDS"));a.resolve(d[e])}else a.reject(Error(m.nodeErrorMessage(b,"RUNTIME","INVALIDTYPE")));else a.reject(Error(m.nodeErrorMessage(b,"RUNTIME","INVALIDTYPE")))},a),g.errback(a)))},a),g.errback(a)),a.promise}catch(d){return n(d)}}function Ga(c,b){try{var a=new l;return k(c,b.argument).then(g.callback(function(c){f.isBoolean(c)&&
"!"===b.operator?a.resolve(!c):"-"===b.operator?a.resolve(-1*f.toNumber(c)):"+"===b.operator?a.resolve(1*f.toNumber(c)):a.reject(Error(m.nodeErrorMessage(b,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR")))},a),g.errback(a)),a.promise}catch(d){return n(d)}}function Ja(c,b){try{for(var a=new l,d=[],e=0;e<b.elements.length;e++)d.push(k(c,b.elements[e]));return A(d).then(g.callback(function(c){for(var d=0;d<c.length;d++){if(f.isFunctionParameter(c[d]))return void a.reject(Error(m.nodeErrorMessage(b,"RUNTIME",
"FUNCTIONCONTEXTILLEGAL")));c[d]===f.voidOperation&&(c[d]=null)}a.resolve(c)},a),g.errback(a)),a.promise}catch(h){return n(h)}}function Ha(c,b){try{var a=new l;return A([k(c,b.left),k(c,b.right)]).then(g.callback(function(c){var d=c[0];c=c[1];switch(b.operator){case "\x3d\x3d":a.resolve(f.equalityTest(d,c));break;case "\x3d":a.resolve(f.equalityTest(d,c));break;case "!\x3d":a.resolve(!f.equalityTest(d,c));break;case "\x3c":a.resolve(f.greaterThanLessThan(d,c,b.operator));break;case "\x3e":a.resolve(f.greaterThanLessThan(d,
c,b.operator));break;case "\x3c\x3d":a.resolve(f.greaterThanLessThan(d,c,b.operator));break;case "\x3e\x3d":a.resolve(f.greaterThanLessThan(d,c,b.operator));break;case "+":f.isString(d)||f.isString(c)?a.resolve(f.toString(d)+f.toString(c)):a.resolve(f.toNumber(d)+f.toNumber(c));break;case "-":a.resolve(f.toNumber(d)-f.toNumber(c));break;case "*":a.resolve(f.toNumber(d)*f.toNumber(c));break;case "/":a.resolve(f.toNumber(d)/f.toNumber(c));break;case "%":a.resolve(f.toNumber(d)%f.toNumber(c));break;
default:a.reject(Error(m.nodeErrorMessage(b,"RUNTIME","OPERATORNOTRECOGNISED")))}},a),g.errback(a)),a.promise}catch(d){return n(d)}}function Ia(c,b){try{var a=new l;return"AssignmentExpression"===b.left.type||"UpdateExpression"===b.left.type?(a.reject(Error(m.nodeErrorMessage(b.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))),a.promise):"AssignmentExpression"===b.right.type||"UpdateExpression"===b.right.type?(a.reject(Error(m.nodeErrorMessage(b.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))),
a.promise):(k(c,b.left).then(g.callback(function(d){if(!f.isBoolean(d))throw Error(m.nodeErrorMessage(b,"RUNTIME","ONLYBOOLEAN"));switch(b.operator){case "||":!0===d?a.resolve(d):k(c,b.right).then(g.callback(function(c){if(!f.isBoolean(c))throw Error(m.nodeErrorMessage(b,"RUNTIME","ONLYORORAND"));a.resolve(c)},a),g.errback(a));break;case "\x26\x26":!1===d?a.resolve(d):k(c,b.right).then(g.callback(function(c){if(!f.isBoolean(c))throw Error(m.nodeErrorMessage(b,"RUNTIME","ONLYORORAND"));a.resolve(c)},
a),g.errback(a));break;default:throw Error(m.nodeErrorMessage(b,"RUNTIME","ONLYORORAND"));}},a),g.errback(a)),a.promise)}catch(d){return n(d)}}function K(c,b){try{var a=new l,d=b.name.toLowerCase();if(null!==c.localScope&&void 0!==c.localScope[d]){var e=c.localScope[d];return!0===e.valueset?a.resolve(e.value):null!==e.d?e.d.then(g.callback(function(b){a.resolve(b)},a),g.errback(a)):(e.d=k(c,e.node),e.d.then(g.callback(function(b){e.value=b;e.valueset=!0;a.resolve(b)},a),g.errback(a))),a.promise}if(void 0!==
c.globalScope[d]){var f=c.globalScope[d];return!0===f.valueset?a.resolve(f.value):null!==f.d?f.d.then(g.callback(function(b){a.resolve(b)},a),g.errback(a)):(f.d=k(c,f.node),f.d.then(g.callback(function(b){f.value=b;f.valueset=!0;a.resolve(b)},a),g.errback(a))),a.promise}return a.reject(Error(m.nodeErrorMessage(b,"RUNTIME","VARIABLENOTFOUND"))),a.promise}catch(p){return n(p)}}function Fa(c,b){try{if("Identifier"!==b.callee.type)return n(m.nodeErrorMessage(b,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==
c.localScope&&void 0!==c.localScope[b.callee.name.toLowerCase()]){var a=c.localScope[b.callee.name.toLowerCase()];return a.value instanceof f.NativeFunction?a.value.fn(c,b):a.value instanceof E?ba(c,b,a.value.definition):n(m.nodeErrorMessage(b,"RUNTIME","NOTAFUNCTION"))}return void 0!==c.globalScope[b.callee.name.toLowerCase()]?(a=c.globalScope[b.callee.name.toLowerCase()],a.value instanceof f.NativeFunction?a.value.fn(c,b):a.value instanceof E?ba(c,b,a.value.definition):n(m.nodeErrorMessage(b,"RUNTIME",
"NOTAFUNCTION"))):n(m.nodeErrorMessage(b,"RUNTIME","NOTFOUND"))}catch(d){return n(d)}}function ca(c){return null===c?"":f.isArray(c)?"Array":f.isImmutableArray(c)?"Array":f.isDate(c)?"Date":f.isString(c)?"String":f.isBoolean(c)?"Boolean":f.isNumber(c)?"Number":c instanceof u?"Dictionary":c instanceof x?"Feature":c instanceof ja?"Point":c instanceof ha?"Polygon":c instanceof ia?"Polyline":c instanceof la?"Multipoint":c instanceof ka?"Extent":f.isFunctionParameter(c)?"Function":c===f.voidOperation?
"":"number"==typeof c&&isNaN(c)?"Number":"Unrecognised Type"}function da(c,b,a,d){try{var e=new l;return k(c,b.arguments[a]).then(g.callback(function(h){f.equalityTest(h,d)?k(c,b.arguments[a+1]).then(g.callback(function(a){e.resolve(a)},e),g.errback(e)):(h=b.arguments.length-a,1===h?k(c,b.arguments[a]).then(g.callback(function(a){e.resolve(a)},e),g.errback(e)):2===h&&e.resolve(null),3===h?k(c,b.arguments[a+2]).then(g.callback(function(a){e.resolve(a)},e),g.errback(e)):da(c,b,a+2,d).then(g.callback(function(a){e.resolve(a)},
e),g.errback(e)))},e),g.errback(e)),e.promise}catch(h){return n(h)}}function ea(c,b,a,d){try{var e=new l;!0===d?k(c,b.arguments[a+1]).then(g.callback(function(a){e.resolve(a)},e),g.errback(e)):3===b.arguments.length-a?k(c,b.arguments[a+2]).then(g.callback(function(a){e.resolve(a)},e),g.errback(e)):k(c,b.arguments[a+2]).then(g.callback(function(d){return!1===f.isBoolean(d)?void e.reject(Error("WHEN needs boolean test conditions")):void ea(c,b,a+2,d).then(g.callback(function(a){e.resolve(a)},e),g.errback(e))},
e),g.errback(e));return e.promise}catch(h){return n(h)}}function R(c,b){var a=new l;try{var d=c.length,e=Math.floor(d/2);if(0===d)return a.resolve([]),a.promise;if(1===d)return a.resolve([c[0]]),a.promise;var f=[R(c.slice(0,e),b),R(c.slice(e,d),b)];A(f).then(g.callback(function(c){H(c[0],c[1],b,[]).then(g.callback(function(b){a.resolve(b)},a),g.errback(a))},a),g.errback(a))}catch(p){a.reject(p)}return a.promise}function H(c,b,a,d){var e=new l;try{0<c.length||0<b.length?0<c.length&&0<b.length?a(c[0],
b[0]).then(g.callback(function(f){isNaN(f)&&(f=1);0>=f?(d.push(c[0]),c=c.slice(1)):(d.push(b[0]),b=b.slice(1));H(c,b,a,d).then(g.callback(function(a){e.resolve(a)},e),g.errback(e))},e),g.errback(e)):0<c.length?(d.push(c[0]),c=c.slice(1),H(c,b,a,d).then(g.callback(function(a){e.resolve(a)},e),g.errback(e))):0<b.length&&(d.push(b[0]),b=b.slice(1),H(c,b,a,d).then(g.callback(function(a){e.resolve(a)},e),g.errback(e))):e.resolve(d)}catch(h){e.reject(h)}return e.promise}function z(c,b){var a=c.length,d=
Math.floor(a/2);return b||(b=function(a,b){return b>a?-1:a===b?0:1}),0===a?[]:1===a?[c[0]]:Pa(z(c.slice(0,d),b),z(c.slice(d,a),b),b)}function Pa(c,b,a){for(var d=[];0<c.length||0<b.length;)if(0<c.length&&0<b.length){var e=a(c[0],b[0]);isNaN(e)&&(e=1);0>=e?(d.push(c[0]),c=c.slice(1)):(d.push(b[0]),b=b.slice(1))}else 0<c.length?(d.push(c[0]),c=c.slice(1)):0<b.length&&(d.push(b[0]),b=b.slice(1));return d}function fa(c,b,a){var d=new l;try{var e=c.body;if(a.length!==c.params.length)return n(Error("Invalid Parameter calls to function."));
for(var h=0;h<a.length;h++)b.localScope[c.params[h].name.toLowerCase()]={d:null,value:a[h],valueset:!0,node:null};k(b,e).then(g.callback(function(a){return a instanceof f.ReturnResult?void d.resolve(a.value):a===f.breakResult?void d.reject(Error("Cannot Break from a Function")):a===f.continueResult?void d.reject(Error("Cannot Continue from a Function")):a instanceof f.ImplicitResult?void d.resolve(a.value):void d.resolve(a)},d),g.errback(d))}catch(p){d.reject(p)}return d.promise}function ba(c,b,a){return B(c,
b,function(b,e,f){b={spatialReference:c.spatialReference,services:c.services,console:c.console,localScope:{},progressTracker:c.progressTracker,globalScope:c.globalScope,depthCounter:c.depthCounter+1};if(64<b.depthCounter)throw Error("Exceeded maximum function depth");return fa(a,b,f)})}function S(c){return function(){var b={applicationCache:void 0===c.context.applicationCache?null:c.context.applicationCache,progressTracker:c.context.progressTracker,spatialReference:c.context.spatialReference,console:c.context.console,
services:c.context.services,localScope:{},globalScope:c.context.globalScope,depthCounter:c.context.depthCounter+1};if(64<b.depthCounter)throw Error("Exceeded maximum function depth");return fa(c.definition,b,arguments)}}function Qa(c,b){var a=new D;void 0!==c&&null!==c||(c={});void 0!==b&&null!==b||(b={});var d=new u({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});d.immutable=!1;a.textformatting={value:d,valueset:!0,node:null};for(var e in b)a[e]={value:new f.NativeFunction(b[e]),
"native":!0,valueset:!0,node:null};for(e in c)c[e]&&"esri.Graphic"===c[e].declaredClass?a[e]={value:new x(c[e]),valueset:!0,node:null}:a[e]={value:c[e],valueset:!0,node:null};return a}function Ra(c){console.log(c)}Object.defineProperty(t,"__esModule",{value:!0});var G=100,w=0,q={};oa.registerFunctions(q,v);sa.registerFunctions(q,v);pa.registerFunctions(q,v);qa.registerFunctions(q,v);ta.registerFunctions(q,v);ua.registerFunctions(q,v,B);q["typeof"]=function(c,b){return v(c,b,function(a,b,c){f.pcCheck(c,
1,1);a=ca(c[0]);if("Unrecognised Type"===a)throw Error("Unrecognised Type");return a})};q.iif=function(c,b){try{var a=new l;return f.pcCheck(null===b.arguments?[]:b.arguments,3,3),k(c,b.arguments[0]).then(g.callback(function(d){return!1===f.isBoolean(d)?void a.reject(Error("IF Function must have a boolean test condition")):void(!0===d?k(c,b.arguments[1]).then(g.callback(function(b){a.resolve(b)},a),g.errback(a)):k(c,b.arguments[2]).then(g.callback(function(b){a.resolve(b)},a),g.errback(a)))},a),g.errback(a)),
a.promise}catch(d){return n(d)}};q.decode=function(c,b){try{var a=new l;if(2>b.arguments.length)return n("Missing Parameters");if(2===b.arguments.length)k(c,b.arguments[1]).then(g.callback(function(b){a.resolve(b)},a),g.errback(a));else{if(0===(b.arguments.length-1)%2)return n("Must have a default value result.");k(c,b.arguments[0]).then(g.callback(function(d){da(c,b,1,d).then(g.callback(function(b){a.resolve(b)},a),g.errback(a))},a),g.errback(a))}return a.promise}catch(d){return n(d)}};q.when=function(c,
b){try{var a=new l;return 3>b.arguments.length?n("Missing Parameters"):0===b.arguments.length%2?n("Must have a default value result."):(k(c,b.arguments[0]).then(g.callback(function(d){if(!1===f.isBoolean(d))return void a.reject(Error("WHEN needs boolean test conditions"));ea(c,b,0,d).then(g.callback(function(b){a.resolve(b)},a),g.errback(a))},a),g.errback(a)),a.promise)}catch(d){return n(d)}};q.sort=function(c,b){return B(c,b,function(a,b,c){var d=new l;f.pcCheck(c,1,2);a=c[0];if(f.isImmutableArray(a)&&
(a=a.toArray()),!1===f.isArray(a))return n(Error("Illegal Argument"));if(1<c.length){if(!1===f.isFunctionParameter(c[1]))return n(Error("Illegal Argument"));var e=S(c[1]);return R(a,e).then(g.callback(function(a){d.resolve(a)},d),g.errback(d)),d.promise}if(0===a.length)return d.resolve([]),d.promise;c={};for(b=0;b<a.length;b++){var k=ca(a[b]);""!==k&&(c[k]=!0)}if(!0===c.Array||!0===c.Dictionary||!0===c.Feature||!0===c.Point||!0===c.Polygon||!0===c.Polyline||!0===c.Multipoint||!0===c.Extent||!0===
c.Function)return d.resolve(a.slice(0)),d.promise;b=0;k="";for(e in c)b++,k=e;return 1<b||"String"===k?a=z(a,function(a,b){if(null===a||void 0===a||a===f.voidOperation)return null===b||void 0===b||b===f.voidOperation?0:1;if(null===b||void 0===b||b===f.voidOperation)return-1;a=f.toString(a);b=f.toString(b);return b>a?-1:a===b?0:1}):"Number"===k?a=z(a,function(a,b){return a-b}):"Boolean"===k?a=z(a,function(a,b){return a===b?0:b?-1:1}):"Date"===k&&(a=z(a,function(a,b){return b-a})),d.resolve(a),d.promise})};
T={failDefferred:n,resolveDeffered:W,fixSpatialReference:f.fixSpatialReference,parseArguments:I,standardFunction:v,standardFunctionAsync:B,evaluateIdentifier:K,arcadeCustomFunction:S};for(var ga in q)q[ga]={value:new f.NativeFunction(q[ga]),valueset:!0,node:null};var D=function(){};D.prototype=q;D.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null};D.prototype.pi={value:Math.PI,valueset:!0,node:null};t.functionHelper=T;t.extend=function(c){for(var b={mode:"async",compiled:!1,
functions:{},signatures:[],standardFunction:v,standardFunctionAsync:B,failDefferred:n,evaluateIdentifier:K,arcadeCustomFunctionHandler:S},a=0;a<c.length;a++)c[a].registerFunctions(b);for(var d in b.functions)q[d]={value:new f.NativeFunction(b.functions[d]),valueset:!0,node:null},D.prototype[d]=q[d];for(a=0;a<b.signatures.length;a++)m.addFunctionDeclaration(b.signatures[a],"f")};t.executeScript=function(c,b,a){var d=new l;null!==a&&void 0!==a||(a=new ma({wkid:102100}));var e=Qa(b.vars,b.customfunctions);
return k({spatialReference:a,services:b.services,progressTracker:void 0===b.progressTracker||null===b.progressTracker?d.promise:b.progressTracker,globalScope:e,console:b.console?b.console:Ra,localScope:null,depthCounter:1},c.body[0].body).then(g.callback(function(a){return a instanceof f.ReturnResult&&(a=a.value),a instanceof f.ImplicitResult&&(a=a.value),a===f.voidOperation&&(a=null),a===f.breakResult?void d.reject(Error("Cannot return BREAK")):a===f.continueResult?void d.reject(Error("Cannot return CONTINUE")):
a instanceof f.NativeFunction?void d.reject(Error("Cannot return FUNCTION")):a instanceof E?void d.reject(Error("Cannot return FUNCTION")):void d.resolve(a)},d),g.errback(d)),d.promise};t.extractFieldLiterals=function(c,b){return void 0===b&&(b=!1),m.findFieldLiterals(c,b)};t.validateScript=function(c,b){return m.validateScript(c,b,"full")};t.referencesMember=function(c,b){return m.referencesMember(c,b)};t.referencesFunction=function(c,b){return m.referencesFunction(c,b)};t.findFunctionCalls=function(c){return m.findFunctionCalls(c,
!1)}});