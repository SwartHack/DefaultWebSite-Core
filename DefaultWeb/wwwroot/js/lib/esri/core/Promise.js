//>>built
define("dojo/_base/lang dojo/promise/all dojo/Deferred dojo/aspect dojo/has dojo/errors/create ./Scheduler ./Logger ./declare".split(" "),function(m,n,h,p,b,g,q,r,t){function d(a,c){u.warn("DEPRECATED: "+a+"()"+(c?" -- use "+c+" instead":""))}b.add("esri-promise-compatibility",!1);b.add("esri-promise-compatibility-deprecation-warnings",!0);var u=r.getLogger("esri.core.Promise"),k=function(a){var c=a._promiseProps;if(!c.resolver.isFulfilled()){var e,b,d=c.resolvingPromises;c.allPromise&&c.allPromise.cancel();
var f=new h;for(e=d.length-1;0<=e;e--)b=d[e],b.isCanceled&&b.isCanceled()?d.splice(e,1):b.then(null,null,c.resolver.progress);b=null;(c.allPromise=n(d.concat([f.promise]))).then(function(){c.resolver.resolve(a);a=c=f=c.allPromise=c.resolvingPromises=null},function(b){if(c.allPromise=null,!b||"cancel"!==b.dojoType){var e=Array.prototype.slice.call(arguments,0);c.resolver.reject(e[0]);a=c=f=c.allPromise=c.resolvingPromises=null}});f&&q.schedule(function(){f&&f.resolve()})}},v=g("CancelError",null,function(a){this.target=
a}),w=function(a){return a||new v(this.instance)},l=function(a){this.instance=a;this.canceler=w.bind(this);this.resolver=new h;this.initialized=!1;this.resolvingPromises=[]};l.prototype={canceler:null,cancel:function(a){if(!this.resolver.isFulfilled()){this.allPromise.cancel();for(var c=this.resolvingPromises.concat(),b=c.length-1;0<=b;b--)c[b].cancel(a);this.resolver.cancel(a)}}};g={declaredClass:"esri.core.Promise",constructor:function(){Object.defineProperty(this,"_promiseProps",{value:new l(this),
enumerable:!1,configurable:!1,writable:!0});var a=p.after(this,"postscript",function(c,b){a.remove();a=null;k(this)},!0)},_promiseProps:null,always:function(a){return b("esri-promise-compatibility-deprecation-warnings")&&d("always",".when(callback).catch(errBack)"),this.when(a,a)},isResolved:function(){return this._promiseProps.resolver.isResolved()},isRejected:function(){return this._promiseProps.resolver.isRejected()},isFulfilled:function(){return this._promiseProps.resolver.isFulfilled()},otherwise:function(a){return b("esri-promise-compatibility-deprecation-warnings")&&
d("otherwise",".when().catch(errback)"),this.when(null,a)},"catch":function(a){return b("esri-promise-compatibility-deprecation-warnings")&&d("catch",".when().catch(errback)"),this.when(null,a)},when:function(a,c,b){var d=new h(this._promiseProps.canceler);a=d.then(a,c,b);return this._promiseProps.resolver.then(d.resolve,d.reject,d.progress),a},addResolvingPromise:function(a){a&&!this._promiseProps.resolver.isFulfilled()&&(a._promiseProps&&(a=a.when()),this._promiseProps.resolvingPromises.push(a),
k(this))}};b("esri-promise-compatibility")||(g=m.mixin(g,{then:function(a,c,e){return b("esri-promise-compatibility-deprecation-warnings")&&d("then",".when(callback, errback)"),this.when(a,c,e)},cancel:function(){b("esri-promise-compatibility-deprecation-warnings")&&d("cancel")},isCanceled:function(){return b("esri-promise-compatibility-deprecation-warnings")&&d("isCanceled"),!1},trace:function(){return b("esri-promise-compatibility-deprecation-warnings")&&d("trace"),this},traceRejected:function(){return b("esri-promise-compatibility-deprecation-warnings")&&
d("traceRejected"),this}}));return t(null,g)});