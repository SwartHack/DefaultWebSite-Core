//>>built
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/_base/lang ../core/accessorSupport/decorators ../core/Error ../core/MultiOriginJSONSupport ../core/urlUtils ../core/promiseUtils ../core/lang ../request ../geometry/Extent ../geometry/SpatialReference ../portal/support/jsonContext ./TiledLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/ArcGISCachedService ./support/TileInfo ./support/vectorTileLayerLoader ../views/vectorTiles/style/StyleRepository ../views/vectorTiles/SchemaHelper".split(" "),
function(E,F,l,e,m,d,n,p,f,q,r,t,u,v,w,x,y,z,A,B,g,C,D,h){return function(k){function a(b,c){b=k.call(this)||this;return b.currentStyleInfo=null,b.fullExtent=null,b.style=null,b.operationalLayerType="VectorTileLayer",b.tileInfo=null,b.type="vector-tile",b.url=null,b}return l(a,k),a.prototype.normalizeCtorArgs=function(b,c){return"string"==typeof b?m.mixin({},{url:b},c):b},a.prototype.load=function(){var b=this,c=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1}).then(function(){if(b.portalItem&&
b.portalItem.id){var c=b.portalItem.itemUrl+"/resources/styles/root.json";return t(c,{query:{f:"json"}}).then(function(a){a.data&&b.read({url:c},w.createForItem(b.portalItem))})}}).always(function(){return b.loadStyle()});return this.addResolvingPromise(c),this.when()},Object.defineProperty(a.prototype,"attributionDataUrl",{get:function(){var b=this.currentStyleInfo;return(b=b&&b.serviceUrl&&f.urlToObject(b.serviceUrl))?this._getDefaultAttribution(b.path):null},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,
"serviceUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.serviceUrl||null},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"spatialReference",{get:function(){return this.tileInfo&&this.tileInfo.spatialReference||null},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"styleUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.styleUrl||null},enumerable:!0,configurable:!0}),a.prototype.writeStyleUrl=function(b,c){b&&f.isProtocolRelative(b)&&
(b="https:"+b);b&&!r.endsWith(b,"root.json")&&(b=f.join(b,"root.json"));c.styleUrl=b},a.prototype.readTileIndexType=function(b,c){return c.type},a.prototype.readTileIndexUrl=function(b,c){return f.join(this.serviceUrl,c.tileMap)},a.prototype.readTileServers=function(b,c){var a=this;b=c.tiles;return this.serviceUrl&&b.forEach(function(b,c,d){d[c]=f.join(a.serviceUrl,b)}),b},a.prototype.readVersion=function(b,c){return c.version?parseFloat(c.version):parseFloat(c.currentVersion)},a.prototype.readCompatibleTileInfo256=
function(b,c){return g.fromJSON(h.create256x256CompatibleTileInfo(c.tileInfo))},a.prototype.readCompatibleTileInfo512=function(b,c){return g.fromJSON(h.create512x512CompatibleTileInfo(c.tileInfo))},a.prototype.loadStyle=function(b){b=b||this.style||this.url;if(this._loadingPromise&&"string"==typeof b&&this.url===b)return this._loadingPromise;var c=this._loadingPromise;return this._loadingPromise=this._getSourceAndStyle(b),c&&!c.isFulfilled()&&c.cancel(),this._loadingPromise},a.prototype.getTileUrl=
function(b,c,a){var d=this.tileServers[c%this.tileServers.length];return d=d.replace(/\{z\}/gi,b.toString()).replace(/\{y\}/gi,c.toString()).replace(/\{x\}/gi,a.toString())},a.prototype.write=function(b,c){return c&&c.origin&&!this.styleUrl?(c.messages&&c.messages.push(new n("vectortilelayer:unsupported","VectorTileLayer ("+this.title+", "+this.id+") with style defined by JSON only are not supported",{layer:this})),null):this.inherited(arguments,[b,c])},a.prototype._getSourceAndStyle=function(b){var c=
this;return b?C.loadMetadata(b).then(function(a){c._set("currentStyleInfo",{serviceUrl:a.serviceUrl,styleUrl:a.styleUrl,spriteUrl:a.spriteUrl,glyphsUrl:a.glyphsUrl,style:a.style,layerDefinition:a.layerDefinition});"string"==typeof b?(c.url=b,c.style=null):(c.url=null,c.style=b);c._set("styleRepository",new D(a.style,a));c.read(a.layerDefinition)}):q.reject(Error("invalid style!"))},a.prototype._getDefaultAttribution=function(b){var a=b.match(/^https?:\/\/(basemaps|basemapsbeta|basemapsdev)\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i);
b=["World_Basemap","World_Basemap_v2","World_Basemap_GCS_v2","World_Basemap_WGS84"];if(a){var d=a[3]&&a[3].toLowerCase();if(d)for(var a=a[2]||"",e=0;e<b.length;e++){var g=b[e];if(-1<g.toLowerCase().indexOf(d))return f.normalize("//static.arcgis.com/attribution/Vector"+a+"/"+g)}}},e([d.shared({"2d":"../views/2d/layers/VectorTileLayerView2D","3d":"../views/3d/layers/VectorTileLayerView3D"})],a.prototype,"viewModulePaths",void 0),e([d.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],a.prototype,
"attributionDataUrl",null),e([d.property({readOnly:!0})],a.prototype,"currentStyleInfo",void 0),e([d.property({type:u,readOnly:!0})],a.prototype,"fullExtent",void 0),e([d.property()],a.prototype,"style",void 0),e([d.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],a.prototype,"serviceUrl",null),e([d.property({type:v,dependsOn:["tileInfo"],readOnly:!0})],a.prototype,"spatialReference",null),e([d.property({readOnly:!0})],a.prototype,"styleRepository",void 0),e([d.property({type:String,readOnly:!0,
dependsOn:["currentStyleInfo"],json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],a.prototype,"styleUrl",null),e([d.writer(["portal-item","web-document"],"styleUrl")],a.prototype,"writeStyleUrl",null),e([d.property({readOnly:!0})],a.prototype,"tileIndexType",void 0),e([d.reader("tileIndexType",["tileIndexType","type"])],a.prototype,"readTileIndexType",null),e([d.property({readOnly:!0})],a.prototype,"tileIndexUrl",void 0),e([d.reader("tileIndexUrl",["tileIndexUrl",
"tileMap"])],a.prototype,"readTileIndexUrl",null),e([d.property({readOnly:!0,type:g})],a.prototype,"tileInfo",void 0),e([d.property({readOnly:!0})],a.prototype,"tileServers",void 0),e([d.reader("tileServers",["tiles"])],a.prototype,"readTileServers",null),e([d.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],a.prototype,"type",void 0),e([d.property({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],a.prototype,"url",void 0),
e([d.property({readOnly:!0})],a.prototype,"version",void 0),e([d.reader("version",["version","currentVersion"])],a.prototype,"readVersion",null),e([d.property({readOnly:!0})],a.prototype,"compatibleTileInfo256",void 0),e([d.reader("compatibleTileInfo256",["tileInfo"])],a.prototype,"readCompatibleTileInfo256",null),e([d.property({readOnly:!0})],a.prototype,"compatibleTileInfo512",void 0),e([d.reader("compatibleTileInfo512",["tileInfo"])],a.prototype,"readCompatibleTileInfo512",null),a=e([d.subclass("esri.layers.VectorTileLayer")],
a)}(d.declared(x,y,z,A,p,B))});