//>>built
define("require exports dojo/has ../../core/promiseUtils ../../core/requireUtils ../PortalItem ./portalLayers ../../layers/Layer ../../renderers/support/styleUtils ./mapNotesUtils".split(" "),function(q,g,r,h,t,u,v,w,x,y){function z(a,b,c){var e,f;return t.when(q,"../../layers/"+b).then(function(b){var d={};return a.itemId&&(d.portalItem={id:a.itemId,portal:c.context.portal}),e=new b(d),f=e,f.read(a,c.context),x.loadStyleRenderer(f,c.context).then(function(){return h.resolve(e)})})}function l(a,b){return A(a,
b).then(function(c){return z(a,c,b)})}function A(a,b){var c=b.context,e=B(c),f=a.layerType||a.type;!f&&b&&b.defaultLayerType&&(f=b.defaultLayerType);b=e[f]||"UnknownLayer";if("Feature Collection"===a.type){if(a.itemId)return(new u({id:a.itemId,portal:c&&c.portal})).load().then(v.selectLayerClassPath).then(function(a){return a.className})}else"ArcGISFeatureLayer"===f&&y.isMapNotesLayer(a)&&(b="MapNotesLayer");return a.wmtsInfo&&(b="WMTSLayer"),h.resolve(b)}function B(a){switch(a.origin){case "web-scene":switch(a.layerContainerType){case "basemap":a=
C;break;case "ground":a=D;break;default:a=E}break;default:switch(a.layerContainerType){case "basemap":a=F;break;default:a=G}}return a}function m(a,b,c){return b&&b.filter?c.then(function(a){var c=b.filter(a);return void 0===c?h.resolve(a):c instanceof w?h.resolve(c):c}):c}function k(a,b,c){if(!b)return[];for(var e=[],f=[],g=0;g<b.length;g++){var d=b[g],k=l(d,c);if((e.push(k),f.push(null),"GroupLayer"===d.layerType)&&d.layers&&Array.isArray(d.layers)&&0<d.layers.length){d=d.layers.map(function(a){return l(a,
c)});e.push.apply(e,d);for(var n=0;n<d.length;n++)f.push(k)}}var p={};return e.map(function(b,d){var e=function(a,b){p[b.id]=d;var c=a.findIndex(function(a){if(!a.id)return!1;a=p[a.id];return void 0===a?!1:a>d});0>c&&(c=void 0);a.add(b,c)};b=m(a,c,b).then(function(b){return null!==f[d]?f[d].then(function(a){return e(a.layers,b),h.resolve(b)}):(e(a,b),h.resolve(b))});return H&&(b=b.otherwise(function(a){return console.error(a.toString?a.toString():a),h.reject(a)})),b})}Object.defineProperty(g,"__esModule",
{value:!0});var H=r("dojo-debug-messages"),E={ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",PointCloudLayer:"PointCloudLayer",ArcGISSceneServiceLayer:"SceneLayer",IntegratedMeshLayer:"IntegratedMeshLayer",ArcGISTiledElevationServiceLayer:"ElevationLayer",ArcGISTiledImageServiceLayer:"TileLayer",ArcGISTiledMapServiceLayer:"TileLayer",GroupLayer:"GroupLayer",WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",VectorTileLayer:"VectorTileLayer",
WMS:"WMSLayer",DefaultTileLayer:"TileLayer"},D={ArcGISTiledElevationServiceLayer:"ElevationLayer",DefaultTileLayer:"ElevationLayer"},C={ArcGISTiledMapServiceLayer:"TileLayer",ArcGISTiledImageServiceLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",WebTiledLayer:"WebTileLayer",VectorTileLayer:"VectorTileLayer",ArcGISImageServiceLayer:"UnsupportedLayer",WMS:"UnsupportedLayer",ArcGISMapServiceLayer:"UnsupportedLayer",DefaultTileLayer:"TileLayer"},G={ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",
ArcGISImageServiceVectorLayer:"UnsupportedLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISStreamLayer:"StreamLayer",ArcGISTiledImageServiceLayer:"TileLayer",ArcGISTiledMapServiceLayer:"TileLayer",VectorTileLayer:"VectorTileLayer",WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",GeoRSS:"GeoRSSLayer",KML:"KMLLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer"},F={ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"UnsupportedLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISTiledImageServiceLayer:"TileLayer",
ArcGISTiledMapServiceLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",VectorTileLayer:"VectorTileLayer",WebTiledLayer:"WebTileLayer",bingLayer:"UnsupportedLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer"};g.createLayer=l;g.processLayer=m;g.populateLayers=k;g.populateOperationalLayers=function(a,b,c){return k(a,b,c)}});