//>>built
define(["../core/Accessor","../core/Collection","../processors/Filter"],function(g,k,e){var h=g.createSubclass({declaredClass:"esri.processors.Pipeline",constructor:function(){this._workflow=[]},destroy:function(){for(var a,c,b,d,f=this._workflow.length-1;0<=f;f--)if(a=this._workflow[f],c=a.processor,b=c.input,c.isInstanceOf(h)?(c.destroy(),d=c.output):(d=[{processor:c,collection:c.output}],c.input=null),b&&a.parent&&(b.removeAll(),b=null),d&&a.children.length)for(var e=0,g=d.length;g>e;e++);this._workflow.splice(0,
this._workflow.length);this._currentStep=null;this.notifyChange("currentStep")},_workflow:null,_changeHandler:null,_currentStep:null,properties:{input:{value:null,set:function(a){this._workflow.length&&(this._workflow[0].processor.input=a);this._set("input",a)}},output:{readOnly:!0,get:function(){var a,c,b=[];if(!this._workflow.length)return b;for(var d=0;d<this._workflow.length;d++)a=this._workflow[d],a.children.length||(c=a.processor,c.isInstanceOf(e)?b.push({collection:c.output,processor:c}):b=
b.concat(a.processor.output));return b}},currentStep:{readOnly:!0,get:function(){return this._currentStep}}},pipe:function(a){if(!a||!a.isInstanceOf(e))throw new TypeError("Invalid value for 'filter' argument");var c,b,d;try{d={processor:a,children:[],parent:null},(b=this.currentStep)?(c=b.processor.output,a.input=c,b.children.push(d),d.parent=b):this.input?d.processor.input=this.input:d.processor.input&&(this.input=d.processor.input),d.processor.output=new k,this._currentStep=d,this.notifyChange("currentStep"),
this._workflow.push(d)}catch(f){throw f;}return this},branch:function(){var a,c=new h,b=this.currentStep;return b||(this.pipe(new e),b=this.currentStep),a={processor:c,parent:this.currentStep,children:[]},a.processor.input=b.processor.output,b.children.push(a),this._workflow.push(a),c}});return h});