//>>built
define("require exports dojo/i18n!../../nls/smartMapping dojo/_base/lang ../symbology/type ../../../core/promiseUtils ../../../core/lang ../support/utils ./support/utils ../statistics/uniqueValues ../../UniqueValueRenderer ../../support/utils ../../support/LegendOptions ../../PointCloudUniqueValueRenderer".split(" "),function(M,l,B,p,q,e,v,h,d,w,C,r,D,E){function F(b){if(!b||!b.layer||!b.field&&!b.valueExpression)return e.reject(d.createError("type-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required"));
var a=p.mixin({},b);a.symbolType=a.symbolType||"2d";a.numTypes=null==a.numTypes?10:a.numTypes;a.defaultSymbolEnabled=null==a.defaultSymbolEnabled?!0:a.defaultSymbolEnabled;a.sortBy=null==a.sortBy?"count":a.sortBy;a.statistics=v.clone(a.statistics);b=[0,1];var c=h.createLayerAdapter(a.layer,b);return a.layer=c,c?c.load().then(function(){var b=c.geometryType,g=-1<a.symbolType.indexOf("3d");if("mesh"===b)a.symbolType="3d-volumetric",a.colorMixMode=a.colorMixMode||"replace";else{if(g&&("polyline"===b||
"polygon"===b))return e.reject(d.createError("type-renderer:not-supported","3d symbols are not supported for polyline and polygon layers"));if(-1<a.symbolType.indexOf("3d-volumetric")&&(!a.view||"3d"!==a.view.type))return e.reject(d.createError("type-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'"))}b=h.getFieldsList({field:a.field,valueExpression:a.valueExpression});return(b=d.verifyBasicFieldValidity(c,
b,"type-renderer:invalid-parameters"))?e.reject(b):a}):e.reject(d.createError("type-renderer:invalid-parameters","'layer' must be one of these types: "+h.getLayerTypeLabels(b).join(", ")))}function G(b){if(!(b&&b.layer&&b.field))return e.reject(d.createError("type-point-cloud-class-renderer:missing-parameters","'layer' and 'field' parameters are required"));var a=p.mixin({},b);a.statistics=v.clone(a.statistics);b=[2];var c=h.createLayerAdapter(a.layer,b);return a.layer=c,a.density=a.density||25,a.size=
a.size||"100%",d.isValidPointSize(a.size)?c?c.load().then(function(){var b=h.getFieldsList({field:a.field});return(b=d.verifyBasicFieldValidity(c,b,"type-point-cloud-class-renderer:invalid-parameters"))?e.reject(b):a}):e.reject(d.createError("type-point-cloud-class-renderer:invalid-parameters","'layer' must be one of these types: "+h.getLayerTypeLabels(b).join(", "))):e.reject(d.createError("type-point-cloud-class-renderer:invalid-parameters","Invalid 'size' parameter. It should be a string of the form '100%'"))}
function x(b){var a=b.typeScheme,c=b.basemap;a?a=q.cloneScheme(a):(a=(b=q.getSchemes({basemap:b.basemap,geometryType:b.geometryType,theme:b.theme,worldScale:b.worldScale,view:b.view}))&&b.primaryScheme,c=b&&b.basemapId);return{scheme:a,basemapId:c}}function y(b,a){return b.label<a.label?-1:b.label>a.label?1:0}function z(b,a){return b.value<a.value?-1:b.value>a.value?1:0}function H(b,a){var c=a.count-b.count;return 0===c&&(c=y(b,a)),c}function I(b,a){var c=a.count-b.count;return 0===c&&(c=z(b,a)),
c}function A(b,a,c){var d;"count"===a?(d=I,c&&c.codedValues&&(d=H)):"value"===a&&(d=z,c&&c.codedValues&&(d=y));d&&b.sort(d)}function J(b,a){var c;b=b.uniqueValueInfos;var e=a.layer,g=a.field,f=g?e.getField(g):null,m=f?e.getFieldDomain(f.name):null,t=-1===a.numTypes?b.length:a.numTypes,h=e.geometryType,e=x({basemap:a.basemap,geometryType:h,typeScheme:a.typeScheme,worldScale:-1<a.symbolType.indexOf("3d-volumetric"),view:a.view}),k=e.scheme,g=new C({field:g}),l=-1,n={value:null,domain:m,fieldInfo:f};
if(b.forEach(function(a,b){n.value=a.value;a.label=r.createUniqueValueLabel(n);null===a.value&&(l=b)}),-1<l&&(c=b.splice(l,1)[0]),A(b,a.sortBy,m),f&&f.type===K)f=b.filter(function(a,b){return t>b}).map(function(a){return a.value}),n.dateFormatInterval=r.calculateDateFormatInterval(f);var u=d.createColors(k.colors,b.length);b.forEach(function(b,c){n.value=b.value;b.label=r.createUniqueValueLabel(n);b.symbol=d.createSymbol(k,u[c],h,a.symbolType,a.colorMixMode)});a.valueExpression&&(g.valueExpression=
a.valueExpression,g.valueExpressionTitle=a.valueExpressionTitle);a.legendOptions&&(g.legendOptions=new D.LegendOptions(a.legendOptions));u=d.createColors(k.colors,t);for(f=0;t>f;f++)(m=b[f])&&g.addUniqueValueInfo({value:m.value,label:m.label,symbol:d.createSymbol(k,u[f],h,a.symbolType,a.colorMixMode)});a.defaultSymbolEnabled&&(g.defaultSymbol=d.createSymbol(k,k.noDataColor,h,a.symbolType,a.colorMixMode),g.defaultLabel=B.other);c&&(c.symbol=d.createSymbol(k,k.noDataColor,h,a.symbolType,a.colorMixMode),
b.push(c));c=[];f=g.uniqueValueInfos.length===b.length?-1:g.uniqueValueInfos.length;if(-1<f)for(;f<b.length;f++)c.push(p.mixin({},b[f]));return{renderer:g,uniqueValueInfos:b,excludedUniqueValueInfos:c,typeScheme:q.cloneScheme(k),basemapId:e.basemapId}}function L(b,a){b=b.uniqueValueInfos;a=(a=x({basemap:"gray",theme:"point-cloud-class",geometryType:"point",typeScheme:a}))&&a.scheme;var c="point-cloud-class"===a.theme,e=c?a.colors:d.createColors(a.colors,b.length);return A(b,"value"),b.map(function(a,
b){var d=a.value,f=null;return c?(f=e[d],f||(f=e[e.length-1])):f=e[b],{values:[d],color:f,label:a.label}})}Object.defineProperty(l,"__esModule",{value:!0});var K="date";l.createRenderer=function(b){return F(b).then(function(a){return(null!=a.statistics?e.resolve(a.statistics):w({layer:a.layer,field:a.field,valueExpression:a.valueExpression,returnAllCodedValues:a.returnAllCodedValues})).then(function(b){return J(b,a)})})};l.createPCClassRenderer=function(b){return G(b).then(function(a){return(null!=
a.statistics?e.resolve(a.statistics):w({layer:a.layer,field:a.field})).then(function(b){return{renderer:new E({field:a.field,pointsPerInch:a.density,pointSizeAlgorithm:d.getPointSizeAlgorithm(a.size),colorUniqueValueInfos:L(b,a.typeScheme)})}})})}});