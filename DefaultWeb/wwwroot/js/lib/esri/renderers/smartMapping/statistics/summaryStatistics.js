//>>built
define("require exports dojo/_base/lang ./classBreaks ../../../core/promiseUtils ./support/utils ../support/utils ../../../layers/support/fieldUtils".split(" "),function(t,u,m,n,f,e,g,k){function p(b){if(!(b&&b.layer&&(b.field||b.valueExpression||b.sqlExpression)))return f.reject(e.createError("summary-statistics:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required"));var a=m.mixin({},b);a.normalizationType=e.getNormalizationType(a);b=[0,1,2];var c=
g.createLayerAdapter(a.layer,b);return a.layer=c,c?c.load().then(function(){var b=a.field,l=a.normalizationType,h=a.valueExpression||a.sqlExpression,b=b?c.getField(b):null,d=g.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression});if(d=e.verifyBasicFieldValidity(c,d,"summary-statistics:invalid-parameters"))return f.reject(d);if(b){if(h=e.verifyFieldType(c,b,"summary-statistics:invalid-parameters",q))return f.reject(h);if(k.isDateField(b)&&l)return f.reject(e.createError("summary-statistics:invalid-parameters",
"Normalization is not allowed for date fields"))}else if(h&&l)return f.reject(e.createError("summary-statistics:invalid-parameters","Normalization is not allowed when 'valueExpression' or 'sqlExpression' is specified"));return a}):f.reject(e.createError("summary-statistics:invalid-parameters","'layer' must be one of these types: "+g.getLayerTypeLabels(b).join(", ")))}function r(b){var a=b.normalizationType,c=b.normalizationField;return n({layer:b.layer,field:b.field,classificationMethod:"standard-deviation",
standardDeviationInterval:.25,normalizationType:a,normalizationField:"field"===a?c:void 0,minValue:b.minValue,maxValue:b.maxValue}).then(function(a){var b,c,d;if(a.classBreakInfos.some(function(a){return a.hasAvg&&(b=a),!!b}),b)d=b.maxValue-b.minValue,c=b.minValue+d/2,d*=4;return{min:a.minValue,max:a.maxValue,avg:c,stddev:d}}).then(g.processSummaryStatisticsResult)}var q=[].concat(k.numericTypes).concat("date");return function(b){return p(b).then(function(a){return a.normalizationType?r(a):a.layer.summaryStatistics({field:a.field,
valueExpression:a.valueExpression,sqlExpression:a.sqlExpression,sqlWhere:a.sqlWhere,minValue:a.minValue,maxValue:a.maxValue,features:a.features})})}});