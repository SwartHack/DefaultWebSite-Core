//>>built
define("require exports dojo/string ../../../../core/Error ../../../../tasks/support/ClassBreaksDefinition ../../support/utils ../../../../layers/support/fieldUtils".split(" "),function(z,e,q,r,t,u,k){function h(a){return q.pad(a,2,"0")}function l(a,b){var c;return"date"===b||"number"===b?("number"===b&&(a=new Date(a)),c="TIMESTAMP'"+a.getUTCFullYear()+"-"+h(a.getUTCMonth()+1)+"-"+h(a.getUTCDate())+" "+h(a.getUTCHours())+":"+h(a.getUTCMinutes())+":"+h(a.getUTCSeconds())+"'"):c=a,c}function m(a,b){var c;
b instanceof Date?c="date":"number"==typeof b?c="number":"string"==typeof b&&(a=a.getField(b),"\x3cnow\x3e"===b.toLowerCase()?c="":a&&a.type===v&&(c="field"));return c}function f(a,b){return new r(a,b)}function n(a){var b=("number"==typeof a?new Date(a):new Date).getUTCFullYear(),c=Date.UTC(b,0,1,12,0,0,0),b=Date.UTC(b,11,31,12,0,0,0);return"number"==typeof a&&(c>a&&(c=a),a>b&&(b=a)),[c,b]}function p(a,b){return b&&(a=a?"("+a+") AND ("+b+")":b),a}function w(a){var b=a.layer;return a.fields.filter(function(a){a=
b.getFieldUsageInfo(a);return!a||!a.supportsStatistics})}Object.defineProperty(e,"__esModule",{value:!0});e.statisticTypes="min max avg stddev count sum variance".split(" ");var v="date",x={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864E5},y=Math.LOG10E;e.msSinceUnixEpochSQL=function(a,b){var c=new Date(0);a="("+l(b,m(a,b))+" - "+l(c,m(a,c))+")";b=x.milliseconds;c="/";1>b&&(b=1/b,c="*");return 1===b?a:"("+a+" "+c+" "+b+")"};e.getFieldExpr=function(a,b){var c=
a.field,d=a.normalizationType;a=a.normalizationField;var e=c;return"percent-of-total"===d?e="(("+c+" / "+b+") * 100)":"log"===d?e="(log("+c+") * "+y+")":"field"===d&&(e="("+c+" / "+a+")"),e};e.getSQLFilterForNormalization=function(a){var b,c=a.field,d=a.normalizationType;a=a.normalizationField;return"log"===d?b="(NOT "+c+" \x3d 0)":"field"===d&&(b="(NOT "+a+" \x3d 0)"),b};e.createCBDefn=function(a,b){var c=a.field,d=a.classificationMethod||"equal-interval",e=a.normalizationType,f=a.normalizationField,
g=new t;return g.classificationField=c,g.breakCount=b,g.classificationMethod=d,g.standardDeviationInterval="standard-deviation"===d?a.standardDeviationInterval||1:void 0,g.normalizationType=e,g.normalizationField="field"===e?f:void 0,g};e.createError=f;e.getRangeExpr=function(a,b,c){b=null!=b?a+" \x3e\x3d "+b:"";a=null!=c?a+" \x3c\x3d "+c:"";c="";return c=b&&a?p(b,a):b||a,c?"("+c+")":""};e.verifyFieldType=function(a,b,c,d){var e=null;return b?(b.name===a.objectIdField||-1===d.indexOf(b.type))&&(e=
f(c,"'field' should be one of these types: "+d.join(","))):e=f(c,"'field' is not defined in the layer schema"),e};e.verifyNumericField=function(a,b,c){var d;return b?(b.name===a.objectIdField||-1===k.numericTypes.indexOf(b.type))&&(d=f(c,"'field' should be one of these numeric types: "+k.numericTypes.join(","))):d=f(c,"'field' is not defined in the layer schema"),d};e.getSuggestedDataRange=function(a){var b=a&&a.statistics;b||(b={});var c,d;null==b.min?a.isDate?(a=n(),c=a[0],d=a[1]):(c=0,d=100):b.min===
b.max&&(a.isDate?(a=n(b.min),c=a[0],d=a[1]):0>b.min?(c=2*b.min,d=0):0<b.min?(c=0,d=2*b.min):(c=0,d=100));return{min:null!=c?c:b.min,max:null!=d?d:b.max,defaultValuesUsed:null!=c||null!=d}};e.getCustomExprVal=function(a,b){var c;if(b=b.toLowerCase(),a)for(var d in a)if(d.toLowerCase()!==b){c=a[d];break}return c};e.getAttributeVal=function(a,b){var c;if(b=b.toLowerCase(),a)for(var d in a)if(d.toLowerCase()===b){c=a[d];break}return c};e.mergeWhereClauses=p;e.getNormalizationType=function(a){var b=a.normalizationType;
return b||(a.normalizationField?b="field":null!=a.normalizationTotal&&(b="percent-of-total")),b};e.verifyBasicFieldValidity=function(a,b,c){var d=u.getUnknownFields({layer:a,fields:b});if(d.length)return f(c,"Unknown fields: "+d.join(", ")+". You can only use fields defined in the layer schema");a=w({layer:a,fields:b});return a.length?f(c,"Unsupported fields: "+a.join(", ")+". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true"):void 0};e.isValidNumber=
function(a){return"number"==typeof a&&!isNaN(a)&&a!==1/0&&a!==-(1/0)}});