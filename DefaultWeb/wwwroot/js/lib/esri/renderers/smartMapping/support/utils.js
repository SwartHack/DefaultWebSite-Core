//>>built
define("require exports ../../../layers/FeatureLayer ./adapters/FeatureLayerAdapter ../../../layers/SceneLayer ./adapters/SceneLayerAdapter ../../../layers/PointCloudLayer ./adapters/PointCloudLayerAdapter ./adapters/LayerAdapter ../../../support/arcadeUtils ../statistics/support/utils ../../../core/promiseUtils dojo/_base/lang".split(" "),function(E,h,t,u,v,w,x,y,z,A,k,r,B){function m(a,b,c){b=(b-a)/c;for(var d=[],f=a,e=1;c>=e;e++)a=f+b,a=Number(a.toFixed(16)),d.push([f,a]),f=a;return d}function C(a,
b,c,d){for(var f=[],e=d.length,g=0;e>g;g++){var n=k.mergeWhereClauses(c,k.mergeWhereClauses(b+" \x3e\x3d "+d[g][0],null!==d[g][1]?b+(g===e-1?" \x3c\x3d ":" \x3c ")+d[g][1]:""));f.push(n)}return r.eachAlways(f.map(function(b){return a.queryFeatureCount(b)}))}function p(a,b){if(b)for(var c in a)a[c].label=b[c];return{count:a}}Object.defineProperty(h,"__esModule",{value:!0});var D=/_value$/i,q=(l={},l[0]={adapter:u,layer:t,label:"FeatureLayer"},l[1]={adapter:w,layer:v,label:"SceneLayer"},l[2]={adapter:y,
layer:x,label:"PointCloudLayer"},l);h.getLayerTypeLabels=function(a){return a.map(function(a){return q[a].label})};h.createLayerAdapter=function(a,b){if(a instanceof z)return a;var c=null;return b.some(function(b){var d=a.constructor===q[b].layer;d&&(c=new q[b].adapter({layer:a}));return d}),c};h.getFieldsList=function(a){var b=a.field,c=a.normalizationField;a=a.valueExpression;var d=[];return a&&(d=A.extractFieldNames(a)),b&&d.push(b),c&&d.push(c),d};h.getUnknownFields=function(a){var b=a.layer;
return a.fields.filter(function(a){return!b.getField(a)})};h.getEqualIntervalBins=m;h.getSummaryStatisticsFromFeatureSet=function(a){a=(a=a&&a.features)&&a[0]&&a[0].attributes;var b={},c;for(c in a)b[c.replace(D,"").toLowerCase()]=a[c];return b.min===b.max&&null!=b.min&&null==b.stddev&&(b.stddev=b.variance=0),b};h.processSummaryStatisticsResult=function(a){for(var b in a)-1<k.statisticTypes.indexOf(b)&&(k.isValidNumber(a[b])||(a[b]=null));return a};h.getHistogramFromFeatureSet=function(a,b,c,d){var f=
{};a&&a.features&&a.features.forEach(function(a){var b=a.attributes;a=k.getCustomExprVal(b,"countOFExpr");b=k.getAttributeVal(b,"countOFExpr");0!==a&&(f[a]=b)});var e=[];return m(b,c,d).forEach(function(a,b){b=(b+1).toString();e.push({minValue:a[0],maxValue:a[1],count:f.hasOwnProperty(b)?f[b]:0})}),{bins:e,minValue:b,maxValue:c}};h.getBins=function(a,b){var c=a.layer,d=a.field;a=a.numBins||10;var f=b.min,e=b.max,g=b.intervals||m(f,e,a),n=b.normTotal;return C(c,b&&b.sqlExpr||d,b&&b.excludeZerosExpr,
g).then(function(a){return{bins:a.map(function(a,b){return{minValue:g[b][0],maxValue:g[b][1],count:a.value}}),minValue:f,maxValue:e,normalizationTotal:n}})};h.getUniqueValuesFromFeatureSet=function(a,b,c,d){var f="countOF"+(c||"Expr"),e={},g=!1;return((a&&a.features).forEach(function(a){var b=a.attributes;a=k.getAttributeVal(b,f);b=c?k.getAttributeVal(b,c):k.getCustomExprVal(b,f);null===b&&0===a&&(g=!0);(null==b||"string"==typeof b&&""===B.trim(b))&&(b=null);null==e[b]?e[b]={count:a,data:b}:e[b].count+=
a}),c&&g)?b.queryFeatureCount(c+" is NULL").then(function(a){return a=a||0,e["null"].count+=a,p(e,d)}).otherwise(function(){return p(e,d)}):r.resolve(p(e,d))};var l});