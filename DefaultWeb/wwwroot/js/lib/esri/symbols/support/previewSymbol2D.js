//>>built
define("require exports dojox/gfx/_base ../SimpleMarkerSymbol ../../core/promiseUtils ../../core/Error ../../core/screenUtils ./renderUtils ./previewUtils ./gfxUtils".split(" "),function(B,q,x,m,v,y,n,z,A,t){Object.defineProperty(q,"__esModule",{value:!0});q.previewSymbol2D=function(f,l){var b=l&&l.size?n.pt2px(l.size):null,k=l&&l.maxSize?n.pt2px(l.maxSize):null,c=t.getStroke(f),g={shape:null,fill:null,stroke:c};c&&c.width&&(c.width=Math.min(c.width,80));var e=0,d=0,h=c&&c.width||0,q=!1,w=null;switch(f.type){case "simple-marker":var a=
m.defaultProps,c=f.style,b=Math.min(b||n.pt2px(f.size||a.size),k||120);switch(e=b,d=b,c){case m.STYLE_CIRCLE:g.shape={type:"circle",cx:0,cy:0,r:.5*b};break;case m.STYLE_CROSS:g.shape={type:"path",path:[{command:"M",values:[0,.5*d]},{command:"L",values:[e,.5*d]},{command:"M",values:[.5*e,0]},{command:"L",values:[.5*e,d]},{command:"E",values:[]}]};break;case m.STYLE_DIAMOND:g.shape={type:"path",path:[{command:"M",values:[0,.5*d]},{command:"L",values:[.5*e,0]},{command:"L",values:[e,.5*d]},{command:"L",
values:[.5*e,d]},{command:"Z",values:[]}]};break;case m.STYLE_SQUARE:g.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[e,0]},{command:"L",values:[e,d]},{command:"L",values:[0,d]},{command:"Z",values:[]}]};break;case m.STYLE_X:g.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[e,d]},{command:"M",values:[e,0]},{command:"L",values:[0,d]},{command:"E",values:[]}]};break;case m.STYLE_PATH:q=!0,g.shape={type:"path",path:f.path||""}}break;case "simple-line":h=
Math.min(b||h,k||80);e=22<h?2*h:40;d=h;c.width=h;h=0;g.shape={type:"path",path:[{command:"M",values:[0,.5*d]},{command:"L",values:[e,.5*d]},{command:"E",values:[]}]};break;case "picture-fill":case "simple-fill":g.shape=A.shapes.fill[0];break;case "picture-marker":k=k||120;c=n.pt2px(f.width);a=n.pt2px(f.height);b=Math.min(b||Math.max(c,a),k);a=c/a;c=1>=a?Math.ceil(b*a):b;a=1>=a?b:Math.ceil(b/a);e=c;d=a;w=l.opacity;g.shape={type:"image",x:-Math.round(c/2),y:-Math.round(a/2),width:c,height:a,src:f.url||
""};break;case "text":for(var c=f.text||"Aa",a=f.font,b=Math.min(b||n.pt2px(a.size),k||120),u=k=0;u<c.length;u++)var r=c.charAt(u),r=r===r.toUpperCase()?.7:.5,k=k+b*r;e=k;d=b;g.shape={type:"text",text:c,x:0,y:.25*x.normalizedLength((a?b:0).toString()),align:"middle",decoration:f.decoration||a&&a.decoration,rotated:f.rotated,kerning:f.kerning};g.font=a&&{size:b,style:a.style,decoration:a.decoration,weight:a.weight,family:a.family}}if(!g.shape)return v.reject(new y("symbolPreview: renderPreviewHTML2D",
"symbol not supported."));var e=(e||22)+2*h,d=(d||22)+2*h,p=t.getFill(f),h=f.color,b=null;return p&&"pattern"===p.type&&h&&"picture-fill"!==f.type?b=t.getPatternUrlWithColor(p.src,h.toCss(!0)).then(function(a){return p.src=a,g.fill=p,g}):(g.fill=p,b=v.resolve(g)),b.then(function(a){return z.renderSymbol([[a]],[e,d],{node:l&&l.node,scale:q,opacity:w})})}});