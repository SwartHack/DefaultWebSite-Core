//>>built
define("require exports ../../core/Logger ../../core/promiseUtils ../../core/Error ../../core/screenUtils ./styleUtils ./symbolUtils ./gfxUtils ./renderUtils ./previewUtils".split(" "),function(K,E,L,w,F,p,M,G,N,z,q){function x(a){var c=a.outline,b=a.get("material.color"),b=b&&b.toRgba().toString();if(!c)return"fill"===a.type&&"255,255,255,1"===b?{color:"#bdc3c7",width:.75}:null;a=p.pt2px(c.size)||0;return{color:"rgba("+(null!=c.color?c.color.toRgba():"255,255,255,1")+")",width:Math.min(a,C)}}function O(a,
c){var b=c&&c.resource,b=b&&b.href;return a.thumbnail&&a.thumbnail.url?w.resolve(a.thumbnail.url):b&&"object"!==c.type?w.resolve(G.getIconHref(a,c)):a.styleOrigin&&(a.styleOrigin.styleName||a.styleOrigin.styleUrl)?M.resolveWebStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal}).always(function(a){return a&&a.thumbnail&&a.thumbnail.url||H}):w.resolve(H)}function f(a,c){if(!a.material||!a.material.color)return a=Math.min(Math.max(N.defaultThematicColor.r+191.25*c,0),255),[a,a,a,100];for(var b=a.material.color.toRgb(),
e=0;3>e;e++)b[e]=Math.min(Math.max(b[e]+191.25*c,0),255);return b.push(a.material.color.a),b}function I(a){return a.outline?x(a):{color:"rgba(0, 0, 0, 1)",width:1.5}}function A(a,c){if(!a.material)return{};for(var b=a.material.color.toRgb(),e="rgba(",f=0;3>f;f++)e+=Math.min(Math.max(b[f]+191.25*c,0),255)+",";e+=a.material.color.a+");";a=a.size?p.pt2px(a.size):.75;return{color:e,width:Math.min(a,C)}}function B(a,c,b){b*=.75;return{type:"linear",x1:b?.25*b:0,y1:b?.5*b:0,x2:b||4,y2:b?.5*b:4,colors:[{color:a,
offset:0},{color:c,offset:1}]}}function P(a){var c=a.depth,b=a.height;return(a=a.width)&&c&&b&&a===c&&b>a}function Q(a,c,b,e){var t=a&&a.type,p="object"===t,d=[];if("icon"===t)switch(c){case "circle":d.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:f(a,0),stroke:x(a)});break;case "square":d.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[0,0]},{command:"L",values:[b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:f(a,0),stroke:x(a)});break;case "cross":d.push({shape:{type:"path",
path:[{command:"M",values:[.5*b,0]},{command:"L",values:[.5*b,b]},{command:"M",values:[0,.5*b]},{command:"L",values:[b,.5*b]},{command:"E",values:[]}]},stroke:I(a)});break;case "x":d.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[b,b]},{command:"M",values:[b,0]},{command:"L",values:[0,b]},{command:"E",values:[]}]},stroke:I(a)});break;case "kite":d.push({shape:{type:"path",path:[{command:"M",values:[0,.5*b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,.5*b]},
{command:"L",values:[.5*b,b]},{command:"Z",values:[]}]},fill:f(a,0),stroke:x(a)})}else if(p)switch(c){case "cone":c=f(a,0);a=f(a,-.6);a=B(c,a,e?D:b);b=q.getConeShapes(b,e);d.push({shape:b[0],fill:a});d.push({shape:b[1],fill:a});break;case "inverted-cone":e=f(a,0);a=f(a,-.6);a=B(e,a,b);b=q.getInvertedConeShapes(b);d.push({shape:b[0],fill:a});d.push({shape:b[1],fill:e});break;case "cube":b=q.getCubeShapes(b,e);d.push({shape:b[0],fill:f(a,0)});d.push({shape:b[1],fill:f(a,-.3)});d.push({shape:b[2],fill:f(a,
-.5)});break;case "cylinder":c=f(a,0);t=f(a,-.6);c=B(c,t,e?D:b);b=q.getCylinderShapes(b,e);d.push({shape:b[0],fill:c});d.push({shape:b[1],fill:c});d.push({shape:b[2],fill:f(a,0)});break;case "diamond":b=q.getDiamondShapes(b);d.push({shape:b[0],fill:f(a,-.3)});d.push({shape:b[1],fill:f(a,0)});d.push({shape:b[2],fill:f(a,-.3)});d.push({shape:b[3],fill:f(a,-.7)});break;case "sphere":e=f(a,0);a=f(a,-.6);a=B(e,a);a.x1=0;a.y1=0;a.x2=.25*b;a.y2=.25*b;d.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:a});
break;case "tetrahedron":b=q.getTetrahedronShapes(b),d.push({shape:b[0],fill:f(a,-.3)}),d.push({shape:b[1],fill:f(a,0)}),d.push({shape:b[2],fill:f(a,-.6)})}return d}function R(a,c){var b,f=c&&c.size?p.pt2px(c.size):null,t=c&&c.maxSize?p.pt2px(c.maxSize):null,q=c&&c.disableUpsampling,d=a.symbolLayers,k=[],l=0,g=0,h=d.getItemAt(d.length-1);return h&&"icon"===h.type&&(b=h.size&&p.pt2px(h.size)),d.forEach(function(d,e){if("icon"===d.type||"object"===d.type){e="icon"===d.type?d.size&&p.pt2px(d.size):0;
var h=f||e?Math.ceil(Math.min(f||e,t||J)):v,m=x(d),r=m?m.width:0;if(d&&d.resource&&d.resource.href)e=O(a,d).then(function(a){var b=d.get("material.color");return z.tintImageWithColor(a,h,b,"icon"===d.type?"multiply":"tint",q)}).then(function(a){var b=a.width,c=a.height;return l=Math.max(l,b+2*r),g=Math.max(g,c+2*r),[{shape:{type:"image",width:b,height:c,src:a.url},fill:null,stroke:null}]}),k.unshift(e);else{var m=d.get("resource.primitive")||("icon"===d.type?"circle":"sphere"),u=h;"icon"===d.type&&
b&&f&&(u=e/b*h);e=c&&"tall"===c.symbolConfig||("object"===d.type?P(d):!1);l=Math.max(l,e?D:u+2*r);g=Math.max(g,u+2*r);k.unshift(w.resolve(Q(d,m,u,e)))}}}),w.eachAlways(k).then(function(a){var b=[];return a.forEach(function(a){a.value?b.push(a.value):a.error&&S.warn("error while building swatchInfo!",a.error)}),z.renderSymbol(b,[l,g],{node:c&&c.node,scale:!1})})}function T(a,c){var b,e=a.symbolLayers,t=[];a=G.isVolumetricSymbol(a);var u=c&&c.size?p.pt2px(c.size):null,d=(c&&c.maxSize?p.pt2px(c.maxSize):
null)||C,k=0,l=0;return e.forEach(function(a,c){var e=a&&a.type,g="line"===e;if(g||"path"===e){var h=A(a,0),n=h&&h.width||0,e=[];g?(0===c&&(b=n),a=Math.min(u||n,d),a=0===c?a:u?n/b*a:a,c=a>v?2*a:U,l=Math.max(l,a),k=Math.max(k,c),h.width=a,e.push({shape:{type:"path",path:[{command:"M",values:[0,.5*l]},{command:"L",values:[k,.5*l]},{command:"E",values:[]}]},stroke:h})):(h=Math.min(u||v,d),c=f(a,0),g=f(a,-.2),a=A(a,-.4),a.width=1,e.push({shape:q.shapes.pathSymbol3DLayer[0],fill:g,stroke:a}),e.push({shape:q.shapes.pathSymbol3DLayer[1],
fill:c,stroke:a}),k=l=Math.max(l,h+2));t.push(e)}}),w.resolve(z.renderSymbol(t,[k,l],{node:c&&c.node,scale:a}))}Object.defineProperty(E,"__esModule",{value:!0});var H=K.toUrl("../../images/Legend/legend3dsymboldefault.png"),v=22,J=120,C=80,U=40,D=20,S=L.getLogger("esri.symbols.support.previewSymbol3D");E.previewSymbol3D=function(a,c){if(0===a.symbolLayers.length)return w.reject(new F("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));var b=null;switch(a.type){case "point-3d":b=
R(a,c);break;case "line-3d":b=T(a,c);break;case "polygon-3d":case "mesh-3d":a:{b="mesh-3d"===a.type;a=a.symbolLayers;for(var e=c&&c.size?p.pt2px(c.size):null,t=c&&c.maxSize?p.pt2px(c.maxSize):null,e=e||v,u=[],d=0,k=0,l=0;l<a.length;l++){var g=a.getItemAt(l),h=g.type,m="fill"===h,r="line"===h,y="extrude"===g.type,h=[];if(b&&!m){b=void 0;break a}var n=q.shapes.fill[0];m?(r=(m=x(g))&&m.width||0,d=Math.max(d,v+r),k=Math.max(k,v+r),h.push({shape:n,fill:f(g,0),stroke:m})):r?(g=(m=A(g,0))&&m.width||0,n=
{stroke:m,shape:n},d=Math.max(d,v+g),k=Math.max(k,v+g),h.push(n)):y&&(n=A(g,-.4),m=f(g,0),g=f(g,-.2),r=Math.min(e,t||J),y=q.getExtrudeSymbolShapes(r),n.width=1,h.push({shape:y[0],fill:g,stroke:n}),h.push({shape:y[1],fill:g,stroke:n}),h.push({shape:y[2],fill:m,stroke:n}),g=.7*v+.5*r,d=Math.max(d,v+2*n.width),k=Math.max(k,g+2*n.width));u.push(h)}b=w.resolve(z.renderSymbol(u,[d,k],{node:c&&c.node,scale:!1}))}}return b?b:w.reject(new F("symbolPreview: swatchInfo3D","symbol not supported."))}});