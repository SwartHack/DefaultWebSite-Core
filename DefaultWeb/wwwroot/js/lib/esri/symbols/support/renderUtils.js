//>>built
define("require exports dojo/_base/lang dojo/Deferred dojox/gfx/matrix dojox/gfx ../../request ../../core/sniff ../../core/Error ../../core/promiseUtils ../../core/urlUtils ../../core/colorUtils ../../kernel".split(" "),function(K,v,B,C,D,E,F,x,G,y,H,w,z){function I(a){return a.map(function(e){return e.command+" "+e.values.join(",")}).join(" ").trim()}function J(a,e,d,m){var l=m&&m.node||document.createElement("div"),c=E.createSurface(l,e,d);null!=m.opacity&&(l.style.opacity=m.opacity.toString());
try{a.forEach(function(a){var q=c.createGroup(),l=0;a.forEach(function(b){var a=b.shape,c=b.fill,d=b.stroke;l+=d&&d.width||0;var e=null;a&&("path"===a.type&&"string"!=typeof a.path&&(a.path=I(a.path)),e=q.createShape(a).setFill(c).setStroke(d?d:{width:0}),"text"===a.type&&e.setFont(b.font))});var f=q.getBoundingBox();a=f.width;var g=f.height,k=-(f.x+a/2),b=-(f.y+g/2),h=c.getDimensions(),k={dx:k+h.width/2,dy:b+h.height/2},b=!1;if(m.scale&&0!==f.width&&0!==f.height){var b=f.width/f.height,n=(e>d?e:
d)-2*l,p=1,r=1;isNaN(n)||(1<b?(p=n/f.width,r=n/b/f.height):(r=n/f.height,p=n*b/f.width));q.applyTransform(D.scaleAt(p,r,h.width/2,h.height/2));b=!0}!b&&(a>e||g>d)&&(f=a/e>g/d,a=((f?e:d)-5)/(f?a:g),B.mixin(k,{xx:a,yy:a}));q.applyTransform(k)})}catch(r){return c.clear(),c.destroy(),null}return l}function A(a,e,d,m){if(!a)return y.reject(new G("renderUtils: imageDataSize","href not provided."));var l;if(H.isDataProtocol(a)){var c=new Image;if(c.src=a,c.complete)l=y.resolve({data:c});else{var r=new C;
l=r.promise;c.onload=function(){r.resolve({data:c})};c.onerror=r.reject}}else l=F(a,{responseType:"image",allowImageDataAccess:d});return l.then(function(a){a=a.data;var c=a.width,f=a.height,g=c/f,k=e;m&&(k=Math.min(k,Math.max(c,f)));return{image:d?a:null,width:1>=g?Math.ceil(k*g):k,height:1>=g?k:Math.ceil(k/g)}}).otherwise(function(c){if(d)return A(a,e,!1,m);throw c;})}Object.defineProperty(v,"__esModule",{value:!0});v.renderSymbol=function(a,e,d){var m=Math.ceil(e[0]);e=Math.ceil(e[1]);return a.some(function(a){return!!a.length})?
J(a,m,e,d):null};v.tintImageWithColor=function(a,e,d,m,l){return A(a,e,!!d,l).then(function(c){var l=c.width?c.width:e,q=c.height?c.height:e;if(c.image&&d&&"ignore"!==m&&("multiply"!==m||255!==d.r||255!==d.g||255!==d.b||1!==d.a)){var u=c.image.width,f=c.image.height;(x("edge")||x("ie"))&&/\.svg$/i.test(a)&&(--u,--f);var g,k;g=Math.ceil(l);k=Math.ceil(q);var b=document.createElement("canvas");b.width=g;b.height=k;b.style.width=g+"px";b.style.height=k+"px";b=b.getContext("2d");g=(b.clearRect(0,0,g,
k),b);g.drawImage(c.image,0,0,u,f,0,0,l,q);c=g.getImageData(0,0,l,q);u=[d.r/255,d.g/255,d.b/255,d.a];f=w.toHSV(d);for(k=0;k<c.data.length;k+=4){var b=c.data,h=k,n=u,p=f;switch(m){case "multiply":b[h+0]*=n[0];b[h+1]*=n[1];b[h+2]*=n[2];b[h+3]*=n[3];break;default:var t=w.toHSV({r:b[h+0],g:b[h+1],b:b[h+2]});t.h=p.h;t.s=p.s;t.v=t.v/100*p.v;p=w.toRGB(t);b[h+0]=p.r;b[h+1]=p.g;b[h+2]=p.b;b[h+3]*=n[3]}}g.putImageData(c,0,0);a=g.canvas.toDataURL("image/png")}else(g=z.id&&z.id.findCredential(a))&&g.token&&(c=
-1===a.indexOf("?")?"?":"\x26",a=""+a+c+"token\x3d"+g.token);return{url:a,width:l,height:q}}).otherwise(function(){return{url:a,width:e,height:e}})}});