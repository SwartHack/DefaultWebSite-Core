//>>built
define("require exports ../Symbol3D ./jsonUtils ./Thumbnail ./StyleOrigin ../../core/urlUtils ../../core/promiseUtils ../../core/Error ../../request ../../portal/Portal ../../portal/PortalQueryParams".split(" "),function(D,c,v,w,p,q,f,m,h,x,y,z){function A(b,a){return r(b).then(function(a){return{data:a.data,baseUrl:f.removeFile(b),styleUrl:b}})}function B(b,a){var e;a=a.portal||y.getDefault();var n=a.url+" - "+(a.user&&a.user.username)+" - "+b;return k[n]||(k[n]=C(b,a).then(function(b){return e=
b,b.fetchData()}).then(function(a){return{data:a,baseUrl:e.itemUrl,styleName:b}})),k[n]}function C(b,a){return a.load().then(function(){var e=new z({disableExtraQuery:!0,query:"owner:"+l+" AND type:"+g+' AND typekeywords:"'+b+'"'});return a.queryItems(e)}).then(function(a){a=a.results;var e=null,f=b.toLowerCase();if(a&&Array.isArray(a))for(var c=0;c<a.length;c++){var d=a[c];if(d.typeKeywords.some(function(a){return a.toLowerCase()===f})&&d.type===g&&d.owner===l){e=d;break}}if(e)return e.load();throw new h("symbolstyleutils:style-not-found",
"The style '"+b+"' could not be found",{styleName:b});})}function t(b,a){return b.styleUrl?A(b.styleUrl,a):b.styleName?B(b.styleName,a):m.reject(new h("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function u(b,a,e){for(var c=b.data,k={portal:e.portal,url:f.urlToObject(b.baseUrl),origin:"portal-item"},l=function(c){if(c.name!==a)return"continue";var d=f.read(c.webRef,k),g={portal:e.portal,url:f.urlToObject(f.removeFile(d)),origin:"portal-item"};
return{value:r(d).then(function(d){if((d=w.fromJSON(d.data,g))&&d.isInstanceOf(v)){if(c.thumbnail)if(c.thumbnail.href){var h=f.read(c.thumbnail.href,k);d.thumbnail=new p["default"]({url:h})}else c.thumbnail.imageData&&(d.thumbnail=new p["default"]({url:"data:image/png;base64,"+c.thumbnail.imageData}));b.styleUrl?d.styleOrigin=new q({portal:e.portal,styleUrl:b.styleUrl,name:a}):b.styleName&&(d.styleOrigin=new q({portal:e.portal,styleName:b.styleName,name:a}))}return d})}},d=0,c=c.items;d<c.length;d++){var g=
l(c[d]);if("object"==typeof g)return g.value}return m.reject(new h("symbolstyleutils:symbol-name-not-found","The symbol name '"+a+"' could not be found",{symbolName:a}))}function r(b){var a={responseType:"json"};return a.query={f:"json"},x(f.normalize(b),a)}Object.defineProperty(c,"__esModule",{value:!0});var k={};c.fetchStyle=t;c.resolveWebStyleSymbol=function(b,a){return b.name?t(b,a).then(function(c){return u(c,b.name,a)}):m.reject(new h("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))};
c.fetchSymbolFromStyle=u;c.styleNameFromItem=function(b){var a=0;for(b=b.typeKeywords;a<b.length;a++){var c=b[a];if(/^Esri.*Style$/.test(c)&&"Esri Style"!==c)return c}};var l="esri_en",g="Style"});