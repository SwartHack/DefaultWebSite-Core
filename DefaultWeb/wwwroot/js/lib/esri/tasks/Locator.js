//>>built
define("dojo/_base/array dojo/_base/lang ../request ./Task ../geometry/SpatialReference ./support/AddressCandidate".split(" "),function(l,f,k,m,q,h){return m.createSubclass({declaredClass:"esri.tasks.Locator",properties:{categories:{value:null,type:[String]},countryCode:{value:null,type:String},outSpatialReference:{value:null,type:q},url:{}},addressToLocations:function(a,b){var d,e=a.outFields,g=a.searchExtent,c=a.countryCode,h=a.magicKey,r=a.distance,n=a.categories,l=a.maxLocations,m=a.forStorage;
a.location&&this.normalization&&(d=a.location.clone().normalize());g&&(g=g.shiftCentralMeridian());a=a.address;var p=this.outSpatialReference;a={query:this._encode(f.mixin({},this.parsedUrl.query,a,{f:"json",outSR:p&&JSON.stringify(p.toJSON()),outFields:e&&e.join(",")||null,searchExtent:g&&JSON.stringify(g.toJSON()),category:n&&n.join(",")||null,countryCode:c||null,magicKey:h||null,distance:r||null,location:d||null,maxLocations:l||null,forStorage:m||null})),callbackParamName:"callback"};return(this.requestOptions||
b)&&(a=f.mixin({},this.requestOptions,b,a)),k(this.parsedUrl.path+"/findAddressCandidates",a).then(this._handleAddressToLocationsResponse)},suggestLocations:function(a,b){a.hasOwnProperty("location")&&this.normalization&&(a.location=a.location.clone().normalize());a.searchExtent&&(a.searchExtent=a.searchExtent.shiftCentralMeridian());a={query:this._encode(f.mixin({},this.parsedUrl.query,{f:"json",text:a.text,maxSuggestions:a.maxSuggestions,searchExtent:a.searchExtent&&JSON.stringify(a.searchExtent.toJSON()),
category:a.categories&&a.categories.join(",")||null,countryCode:a.countryCode||null,location:a.location||null,distance:a.distance||null},{f:"json"})),callbackParamName:"callback"};return(this.requestOptions||b)&&(a=f.mixin({},this.requestOptions,b,a)),k(this.parsedUrl.path+"/suggest",a).then(this._handleSuggestLocationsResponse)},addressesToLocations:function(a,b){var d=this.outSpatialReference,e=[],g=a.categories,c=a.countryCode;l.forEach(a.addresses,function(a,b){e.push({attributes:a})});a={query:this._encode(f.mixin({},
this.parsedUrl.query,{category:g&&g.join(",")||null,sourceCountry:c||null},{addresses:JSON.stringify({records:e})},{f:"json",outSR:d&&JSON.stringify(d.toJSON())})),callbackParamName:"callback"};return(this.requestOptions||b)&&(a=f.mixin({},this.requestOptions,b,a)),k(this.parsedUrl.path+"/geocodeAddresses",a).then(this._handleAddressesToLocationsResponse)},locationToAddress:function(a,b,d){a&&this.normalization&&(a=a.clone().normalize());var e=this.outSpatialReference;a={query:this._encode(f.mixin({},
this.parsedUrl.query,{outSR:e&&JSON.stringify(e.toJSON()),location:a&&JSON.stringify(a.toJSON()),distance:b,f:"json"})),callbackParamName:"callback"};return(this.requestOptions||d)&&(a=f.mixin({},this.requestOptions,d,a)),k(this.parsedUrl.path+"/reverseGeocode",a).then(this._handleLocationToAddressResponse)},_handleAddressToLocationsResponse:function(a){var b,d;a=a.data;var e=a.spatialReference;return(a.candidates||[]).map(function(a){b=a.extent;var c=d=a.location;if(c=c&&c.hasOwnProperty("x")&&"NaN"!==
c.x&&c.hasOwnProperty("y")&&"NaN"!==c.y)c=b,c=!c||c.hasOwnProperty("xmin")&&"NaN"!==c.xmin&&c.hasOwnProperty("ymin")&&"NaN"!==c.ymin&&c.hasOwnProperty("xmax")&&"NaN"!==c.xmax&&c.hasOwnProperty("ymax")&&"NaN"!==c.ymax;return c?(b&&(b.spatialReference=e),d&&(d.spatialReference=e),h.fromJSON(a)):void 0}).filter(function(a){return!!a})},_handleSuggestLocationsResponse:function(a){return a.data.suggestions||[]},_handleAddressesToLocationsResponse:function(a){var b;a=a.data;var d=a.spatialReference;return(a.locations||
[]).map(function(a){return b=a.location,b&&(b.spatialReference=d),h.fromJSON(a)})},_handleLocationToAddressResponse:function(a){a=a.data;var b=a.address||{};return h.fromJSON({address:b.Match_addr||"",attributes:b,location:a.location,score:100})}})});