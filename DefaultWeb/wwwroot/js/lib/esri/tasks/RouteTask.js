//>>built
define("../geometry/support/normalizeUtils ../Graphic ../request ../core/promiseUtils ./support/NAMessage ./support/RouteResult ./Task ./support/NAServiceDescription dojo/_base/array dojo/_base/lang".split(" "),function(k,v,l,w,x,y,z,A,m,h){return z.createSubclass([A],{declaredClass:"esri.tasks.RouteTask",properties:{parsedUrl:{get:function(){var c=this._parseUrl(this.url);return c.path+="/solve",c}},url:{}},solve:function(c,d){var f=[],e=[],b={},a={};return c.stops&&c.stops.features&&this._collectGeometries(c.stops.features,
e,"stops.features",b),c.barriers&&c.barriers.features&&this._collectGeometries(c.barriers.features,e,"barriers.features",b),c.polylineBarriers&&c.polylineBarriers.features&&this._collectGeometries(c.polylineBarriers.features,e,"polylineBarriers.features",b),c.polygonBarriers&&c.polygonBarriers.features&&this._collectGeometries(c.polygonBarriers.features,e,"polygonBarriers.features",b),k.normalizeCentralMeridian(e).then(function(c){for(var d in b){var e=b[d];f.push(d);a[d]=c.slice(e[0],e[1])}return this._isInputGeometryZAware(a,
f)?this.getServiceDescription():w.resolve({dontCheck:!0})}.bind(this)).then(function(b){b.hasZ||b.dontCheck||this._dropZValuesOffInputGeometry(a,f);b={query:this._encode(h.mixin({},this.parsedUrl.query,{f:"json"},c.toJSON(a))),callbackParamName:"callback"};return(this.requestOptions||d)&&(b=h.mixin({},this.requestOptions,d,b)),l(this.parsedUrl.path,b)}.bind(this)).then(this._handleSolveResponse)},_collectGeometries:function(c,d,f,e){e[f]=[d.length,d.length+c.length];c.forEach(function(b){d.push(b.geometry)})},
_handleSolveResponse:function(c){var d,f,e=[],b=[],a=c.data,h=a.routes?a.routes.features:[],p=a.stops?a.stops.features:[];c=a.barriers?a.barriers.features:[];var k=a.polygonBarriers?a.polygonBarriers.features:[],l=a.polylineBarriers?a.polylineBarriers.features:[],n=a.messages,g=m.forEach,q=m.indexOf,r=!0,t=a.routes&&a.routes.spatialReference||a.stops&&a.stops.spatialReference||a.barriers&&a.barriers.spatialReference||a.polygonBarriers&&a.polygonBarriers.spatialReference||a.polylineBarriers&&a.polylineBarriers.spatialReference;
g(a.directions||[],function(a){e.push(d=a.routeName);b[d]={directions:a}});g(h,function(a){-1===q(e,d=a.attributes.Name)&&(e.push(d),b[d]={});b[d].route=a});g(p,function(a){f=a.attributes;-1===q(e,d=f.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME")&&(e.push(d),b[d]={});"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==d&&(r=!1);void 0===b[d].stops&&(b[d].stops=[]);b[d].stops.push(a)});0<p.length&&!0===r&&(b[e[0]].stops=b["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,delete b["esri.tasks.RouteTask.NULL_ROUTE_NAME"],
e.splice(m.indexOf(e,"esri.tasks.RouteTask.NULL_ROUTE_NAME"),1));var u=[];g(e,function(a,c){b[a].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===a?null:a;b[a].spatialReference=t;u.push(y.fromJSON(b[a]))});a=function(a){return g(a,function(b,c){b.geometry&&(b.geometry.spatialReference=t);a[c]=v.fromJSON(b)}),a};return g(n,function(a,b){n[b]=x.fromJSON(a)}),{routeResults:u,barriers:a(c),polygonBarriers:a(k),polylineBarriers:a(l),messages:n}}})});