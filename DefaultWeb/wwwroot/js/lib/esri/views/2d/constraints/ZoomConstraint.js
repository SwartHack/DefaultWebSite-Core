//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../layers/support/LOD".split(" "),function(w,x,t,g,e,u,v){return function(l){function b(){var a=null!==l&&l.apply(this,arguments)||this;return a._lodByScale={},a._scales=[],a.effectiveLODs=null,a.effectiveMinZoom=-1,a.effectiveMaxZoom=-1,a.effectiveMinScale=0,a.effectiveMaxScale=0,a.enabled=!0,a.lods=null,a.minZoom=-1,a.maxZoom=
-1,a.minScale=0,a.maxScale=0,a.snapToZoom=!0,a}return t(b,l),m=b,b.prototype.initialize=function(){var a=this,c=this.lods,h=this.minScale,b=this.maxScale,d=this.minZoom,f=this.maxZoom,e=-1,g=-1,l=!1,m=!1;if(0!==h&&0!==b&&b>h&&(k=[b,h],h=k[0],b=k[1]),!c||!c.length)return this._set("effectiveMinScale",h),void this._set("effectiveMaxScale",b);c=c.map(function(a){return a.clone()});c.sort(function(a,c){return c.scale-a.scale});c.forEach(function(a,c){return a.level=c});for(var p,k=0,r=c;k<r.length;k++){var n=
r[k];!l&&0<h&&h>=n.scale&&(e=n.level,l=!0);!m&&0<b&&b>=n.scale&&(g=p?p.level:-1,m=!0);p=n}-1===d&&(d=0===h?0:e);-1===f&&(f=0===b?c.length-1:g);d=Math.max(d,0);d=Math.min(d,c.length-1);f=Math.max(f,0);f=Math.min(f,c.length-1);d>f&&(q=[f,d],d=q[0],f=q[1]);h=c[d].scale;b=c[f].scale;c.splice(0,d);c.splice(f-d+1,c.length);c.forEach(function(c,b){a._lodByScale[c.scale]=c;a._scales[b]=c.scale});this._set("effectiveLODs",c);this._set("effectiveMinZoom",d);this._set("effectiveMaxZoom",f);this._set("effectiveMinScale",
h);this._set("effectiveMaxScale",b);var k,q},b.prototype.constrain=function(a,c){if(!this.enabled||c&&a.scale===c.scale)return a;var b=this.effectiveMinScale,e=this.effectiveMaxScale,d=a.targetGeometry,f=c&&c.targetGeometry,g=0!==b&&a.scale>b;if(0!==e&&a.scale<e||g)b=g?b:e,f&&(c=(b-c.scale)/(a.scale-c.scale),d.x=f.x+(d.x-f.x)*c,d.y=f.y+(d.y-f.y)*c),a.scale=b;return this.snapToZoom&&this.effectiveLODs&&(a.scale=this._getClosestScale(a.scale)),a},b.prototype.fit=function(a){if(!this.effectiveLODs)return this.constrain(a,
null);var c=a.scale,b=this.scaleToZoom(c);return.99<Math.abs(b-Math.round(b))?a.scale=this.snapToPreviousScale(c):a.scale=this.zoomToScale(Math.round(b)),a},b.prototype.zoomToScale=function(a){if(!this.effectiveLODs)return 0;a-=this.effectiveMinZoom;a=Math.max(0,a);var c=this._scales;if(0>=a)return c[0];if(a>=c.length)return c[c.length-1];var b=Math.round(a);return c[b]+(b-a)*(c[Math.round(a-.5)]-c[b])},b.prototype.scaleToZoom=function(a){if(!this.effectiveLODs)return-1;var c,b,e=this._scales,d=0,
f=e.length-1;for(d;f>d;d++){if(c=e[d],b=e[d+1],a>=c)return d+this.effectiveMinZoom;if(b===a)return d+1+this.effectiveMinZoom;if(c>a&&a>b)return d+1-(a-b)/(c-b)+this.effectiveMinZoom}return d},b.prototype.snapToClosestScale=function(a){if(!this.effectiveLODs)return a;a=this.scaleToZoom(a);return this.zoomToScale(Math.round(a))},b.prototype.snapToNextScale=function(a,c){if(void 0===c&&(c=.5),!this.effectiveLODs)return a*c;a=Math.round(this.scaleToZoom(a));return this.zoomToScale(a+1)},b.prototype.snapToPreviousScale=
function(a,c){if(void 0===c&&(c=2),!this.effectiveLODs)return a*c;a=Math.round(this.scaleToZoom(a));return this.zoomToScale(a-1)},b.prototype.clone=function(){return new m({enabled:this.enabled,lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})},b.prototype._getClosestScale=function(a){return this._lodByScale[a]?this._lodByScale[a].scale:(a=this._scales.reduce(function(c,b,e,d){return Math.abs(b-a)<=Math.abs(c-a)?b:c},this._scales[0]),this._lodByScale[a].scale)},
g([e.property({readOnly:!0})],b.prototype,"effectiveLODs",void 0),g([e.property({readOnly:!0})],b.prototype,"effectiveMinZoom",void 0),g([e.property({readOnly:!0})],b.prototype,"effectiveMaxZoom",void 0),g([e.property({readOnly:!0})],b.prototype,"effectiveMinScale",void 0),g([e.property({readOnly:!0})],b.prototype,"effectiveMaxScale",void 0),g([e.property()],b.prototype,"enabled",void 0),g([e.property({type:[v]})],b.prototype,"lods",void 0),g([e.property()],b.prototype,"minZoom",void 0),g([e.property()],
b.prototype,"maxZoom",void 0),g([e.property()],b.prototype,"minScale",void 0),g([e.property()],b.prototype,"maxScale",void 0),g([e.property()],b.prototype,"snapToZoom",void 0),b=m=g([e.subclass("esri.views.2d.constraints.ZoomConstraint")],b);var m}(e.declared(u))});