//>>built
define("require exports dojo/_base/lang ../../libs/gl-matrix/mat2d ../../libs/gl-matrix/mat2dExtras ../../../../core/screenUtils ../../../../geometry/Polygon ../../../../symbols/SimpleMarkerSymbol ../../../../symbols/support/gfxUtils ../../../../Color".split(" "),function(P,l,B,x,y,u,K,t,v,L){function w(c,a){return a.toRgba?(c[0]=a.r,c[1]=a.g,c[2]=a.b,c[3]=a.a):(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3]),c}function z(c,a,b){return null!=b&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=b),c}function C(c,a,b){var d=
a[0]/a[1];return c[0]=c[1]=1,isNaN(b)||(1<d?(c[0]=b/a[0],c[1]=b/d/a[1]):(c[1]=b/a[1],c[0]=b*d/a[0])),c}function D(c,a,b,d,e,h,f){var g,k,m=e.symbol;b=c.toScreenPoint(M,b,f[0]);f=[b.x,b.y];c=b.x;b=b.y;var q=e.heading,n=e.size&&e.size[0];x.identity(r);"number"==typeof n&&(k=isFinite(n)&&n);k=(n=k&&isFinite(k)&&!isNaN(k))?u.pt2px(k):NaN;h&&y.rotategAt(r,r,h,f);q&&y.rotategAt(r,r,q,f);var p;h=u.pt2px(m.xoffset);q=u.pt2px(m.yoffset);0===h&&0===q||(p=[h,-q]);h=null;0!==m.angle&&(h=x.create(),y.rotategAt(h,
h,m.angle,f));var l;if("simple-marker"===m.type)switch(g=m.style,e=Math.round,k=n?k:u.pt2px(m.size),n=void 0,g){case t.STYLE_SQUARE:case t.STYLE_CROSS:case t.STYLE_X:case t.STYLE_DIAMOND:n=isNaN(k)?16:.5*k;g=A(a,d,E(g,c,b,e(c-n),e(c+n),e(b-n),e(b+n)));break;case t.STYLE_PATH:g=l=A(a,d,m.path);l=l.getBoundingBox();k=C(x.create(),[l.width,l.height],k);1===k[0]&&1===k[3]||y.scaleAt(r,r,k,f);l=[-(l.x+.5*l.width)+c,-(l.y+.5*l.height)+b];break;default:n=isNaN(k)?16:.5*k,g=F(a,d,{cx:c,cy:b,r:n})}else if("picture-marker"===
m.type){f=g=null;var q=u.pt2px(m.width),w=u.pt2px(m.height);n?(f=k,g=q/w*f):(g=q,f=w);p&&(null!=p[0]&&(p[0]=p[0]/q*g),null!=p[1]&&(p[1]=p[1]/w*f));g=G(a,d,{x:c-.5*g,y:b-.5*f,width:g,height:f,src:m.url});(k=g.getNode())&&(null!=e.opacity?k.setAttribute("opacity",e.opacity.toString()):k.setAttribute("opacity","1"))}else"text"===m.type&&((e=m.font&&m.font.clone())&&(e.size=n?k:u.pt2px(e.size)),g=H(a,d,{type:"text",text:m.text,x:c,y:b,align:v.getSVGAlign(m),decoration:m.decoration||e&&e.decoration,rotated:m.rotated,
kerning:m.kerning}),e&&g.setFont(e),k=g.getNode(),a=v.getSVGBaseline(m),m=v.getSVGBaselineShift(m),k&&(k.setAttribute("dominant-baseline",a),m&&k.setAttribute("baseline-shift",m)));return p&&x.translate(r,r,p),h&&x.multiply(r,r,h),l&&x.translate(r,r,l),g.setTransform(r),g}function G(c,a,b){return a?a.setShape(b):c.createImage(b)}function F(c,a,b){return a?a.setShape(b):c.createCircle(b)}function A(c,a,b){b=Array.isArray(b)?b.join(" "):b;return a?a.setShape(b):c.createPath(b)}function H(c,a,b){return a?
a.setShape(b):c.createText(b)}function I(c,a){a=a&&a.shape&&a.shape.type;var b=c&&c.type;c=c&&c.style;return b&&(c=N[b]||c),O[c]&&(c="path"),!(!a||!c||a===c)}function E(c,a,b,d,e,h,f,g){switch(c){case t.STYLE_SQUARE:return["M",d+","+h,e+","+h,e+","+f,d+","+f,"Z"];case t.STYLE_CROSS:return["M",a+","+h,a+","+f,"M",d+","+b,e+","+b];case t.STYLE_X:return["M",d+","+h,e+","+f,"M",d+","+f,e+","+h];case t.STYLE_DIAMOND:return["M",a+","+h,e+","+b,a+","+f,d+","+b,"Z"];case t.STYLE_TARGET:return["M",d+","+h,
e+","+h,e+","+f,d+","+f,d+","+h,"M",d-g+","+b,d+","+b,"M",a+","+(h-g),a+","+h,"M",e+g+","+b,e+","+b,"M",a+","+(f+g),a+","+f]}}function J(c,a){var b=a.symbol;if("picture-marker"!==b.type){var d=v.getFill(b);if("simple-marker"===b.type){var e=b.style,h=(b=v.getStroke(b))&&b.color,e=e===t.STYLE_X||e===t.STYLE_CROSS,f=a.opacity;(a=a.color||w([0,0,0,0],e?h:d))&&null!=f&&(a=z([0,0,0,0],a,f));a&&(e?a!==h&&(b=b?B.mixin({},b):{},b.color=a):a!==d&&(d=a));c.setFill(d).setStroke(b)}else"text"===b.type&&(f=a.opacity,
(a=a.color||w([0,0,0,0],d))&&null!=f&&(a=z([0,0,0,0],a,f)),a&&a!==d&&(d=a),c.setFill(d))}}Object.defineProperty(l,"__esModule",{value:!0});l.getScalingVector=C;var M={x:0,y:0},r=x.create();l.drawPoint=D;l.drawMarkers=function(c,a,b,d,e,h,f){var g=e.symbol;b=b.points;a=d||a.createGroup();d=[0];a.children[0]&&I(g,a.children[0])&&a.clear();for(var k=0,m=b.length,g=0;m>g;g++)for(var l=b[g],n=f.length,p=0;n>p;p++)d[0]=f[p],a.add(D(c,a,{x:l[0],y:l[1]},a.children[k++],e,h,d));c=a.children.length;if(b.length*
f.length<c)for(f=b.length*f.length,g=c-1;g>=f;g--)a.children[g].removeShape();return a};l.drawShape=function(c,a,b,d,e){var h=[];if("extent"===b.type&&(b=K.fromExtent(b)),"polyline"===b.type||"polygon"===b.type){for(var f=e.length,g=0;f>g;g++)h=h.concat(c.toScreenPath(b,e[g]));d=A(a,d,h)}return d};l.drawRect=function(c,a,b){return a?a.setShape(b):c.createRect(b)};l.drawImage=G;l.drawCircle=F;l.drawPath=A;l.drawText=H;var N={"picture-marker":"image","picture-fill":"path","simple-fill":"path","simple-line":"path",
text:"text"},O={square:1,cross:1,x:1,diamond:1,target:1};l.isShapeInvalid=I;l.smsToPath=E;l.stylePoint=J;l.styleMarkers=function(c,a){for(var b=c.children.length,d=0;b>d;d++)J(c.children[d],a)};l.styleShape=function(c,a){var b,d=a.symbol,e=a.size,h=a.color,f=a.opacity,g=a.outlineSize;a=v.getStroke(d);var k=v.getFill(d),l=!1;"simple-line"===d.type?(l=!0,b="none"!==d.style):b=d.outline&&"none"!==d.outline.style;var q,n,p;if(null!=e||null!=g)e=e&&isFinite(e[0])&&e[0],g=l?null:g,null==e&&null==g||(p=
u.pt2px(g||e));e="picture-fill"===d.type;!h&&null==f||e||(l?(q=h||a&&a.color&&w([0,0,0,0],a.color),q&&null!=f&&(q=z(q,q,f))):k&&(n=h||w([0,0,0,0],k),n&&null!=f&&(n=z(n,n,f))));!b||null==p&&!q?c.setStroke(a):c.setStroke(B.mixin({},a,null!=p?{width:p}:null,q&&{color:q}));b=h&&new L(h)||d.color;k&&"pattern"===k.type&&b&&!e?v.getPatternUrlWithColor(k.src,b.toCss(!0)).then(function(a){k.src=a;c.setFill(k)}):c.setFill(n||k);c.rawNode.setAttribute("vector-effect","non-scaling-stroke")}});