//>>built
define("require exports ../../../../core/ArrayPool ../../../../core/screenUtils ../../../../core/libs/earcut/earcut ./Utils ./visualVariablesUtils ./MeshData ./enums ./lineMeshUtil".split(" "),function(M,C,G,E,J,d,K,H,F,L){Object.defineProperty(C,"__esModule",{value:!0});var z=new Float32Array(1),A=new Uint32Array(z.buffer);C.createTextMesh=function(d,k,w,v,z,y,c){return null};C.createMesh=function(p,k,w,v,B,y,c,x,r,a){switch(B){case F.WGLGeometryType.MARKER:var e,h,g,l,f,t,q;B=H.pool.acquire();var m=
0,b=0;(y=k.heatmapInfo)?(a=Math.round(k.heatmapInfo.radius),v=e=0,h=x=a,g=[1,1,1,1],l=[0,0,0,0],t=f=a,q=0):(h=v.spriteMosaicItem,e=Math.round(h.rect.x/4),v=Math.round(h.rect.y/4),x=e+Math.round(h.rect.width/4),h=v+Math.round(h.rect.height/4),m=0|a.xoffset,b=0|a.yoffset,g=d.isPictureSymbol(a)?[255,255,255,255]:d.copyAndPremultiply(a.color),f=Math.round(E.pt2px(a.width||a.size)),t=Math.round(E.pt2px(a.height||a.size)),a.outline?(l=null!=a.outline.color?d.copyAndPremultiply(a.outline.color):[255,255,
255,255],q=null!=a.outline.width?Math.round(E.pt2px(a.outline.width)):0):(l=[0,0,0,0],q=0));a=r.centroid||r.geometry;var n=a.x,u=a.y;a=[];c=d.i1616to32(n+m*c,u+b*c);g=d.i8888to32(g[0],g[1],g[2],g[3]);l=d.i8888to32(l[0],l[1],l[2],l[3]);q=d.i8888to32(f,t,q,0);p=d.numTo32(p);f=m=n=u=b=0;if(t=w.vvColor||w.vvOpacity||w.vvRotation||w.vvSizeMinMaxValue||w.vvSizeScaleStops||w.vvSizeFieldStops||w.vvSizeUnitValue)b=k.vvFields,n=b.rotation?k.getValue(r,b.rotation):0,u=b.opacity?k.getValue(r,b.opacity):0,m=b.color?
k.getValue(r,b.color):0,b=b.size&&!w.vvSizeScaleStops?k.getValue(r,b.size):0,w.vvSizeUnitValue&&(b=K.getVisualVariableSizeValueRepresentationRatio(b,k.vvRanges.size.unitValue.valueRepresentation)),isNaN(b)&&(b=1),isNaN(n)&&(n=1),isNaN(u)&&(u=1),isNaN(m)&&(m=1),z[0]=b,b=A[0],z[0]=u,u=A[0],z[0]=n,n=A[0],z[0]=m,m=A[0];return y&&(z[0]=k.heatmapInfo.getIntensity(r),f=A[0]),a.push(c),a.push(d.i8888to32(-32,-32,e,v)),a.push(p),a.push(g),a.push(l),a.push(q),t?(a.push(b),a.push(m),a.push(u),a.push(n)):y&&
a.push(f),a.push(c),a.push(d.i8888to32(32,-32,x,v)),a.push(p),a.push(g),a.push(l),a.push(q),t?(a.push(b),a.push(m),a.push(u),a.push(n)):y&&a.push(f),a.push(c),a.push(d.i8888to32(-32,32,e,h)),a.push(p),a.push(g),a.push(l),a.push(q),t?(a.push(b),a.push(m),a.push(u),a.push(n)):y&&a.push(f),a.push(c),a.push(d.i8888to32(32,32,x,h)),a.push(p),a.push(g),a.push(l),a.push(q),t?(a.push(b),a.push(m),a.push(u),a.push(n)):y&&a.push(f),B.update({geometry:a},4,[0,1,2,1,3,2]),B;case F.WGLGeometryType.FILL:B=H.pool.acquire();
c=null!=v?v.spriteMosaicItem:null;q=r.geometry;l=d.isPictureSymbol(a);h=!l&&a.color?d.copyAndPremultiply(a.color):[255,255,255,255];y=d.numTo32(p);w=w.vvColor||w.vvOpacity;x=v=0;w&&(x=k.vvFields,v=x.opacity?k.getValue(r,x.opacity):0,k=x.color?k.getValue(r,x.color):0,isNaN(v)&&(v=1),isNaN(k)&&(k=1),z[0]=v,v=A[0],z[0]=k,x=A[0]);k=d.i8888to32(h[0],h[1],h[2],h[3]);r=[0,0];h=[0,0];c&&(p=c.rect.x,g=c.rect.y,f=c.width,c=c.height,r[0]=p+1,r[1]=g+1,h[0]=p+1+f,h[1]=g+1+c);a=l&&a.width&&a.height?[d.nextHighestPowerOfTwo(a.width),
d.nextHighestPowerOfTwo(a.height),0,0]:[d.nextHighestPowerOfTwo(h[0]-r[0]),d.nextHighestPowerOfTwo(h[1]-r[1]),0,0];a=d.i8888to32(a[0],a[1],a[2],a[3]);p=G.acquire();l=[];g=c=0;for(q=q.rings;g<q.length;g++){f=q[g];t=c;m=0;b=f.length;n=f[0][0];u=f[0][1];p.push(n);p.push(u);c++;c++;for(var D=1;b>D;++D){var C=f[D][0],I=f[D][1],m=m-C*(u+u+I),n=n+C,u=u+I;p.push(n);p.push(u);c++;c++}0<m?(e&&l.push(e),e={holeIndices:[],offset:t,coordCount:2*b}):0>m?e&&(e.holeIndices.push((t-e.offset)/2),e.coordCount+=2*b):
(c=t,p.splice(t))}e&&l.push(e);e=[];q=[];for(g=c=0;g<l.length;g++)if(f=l[g],b=p.slice(f.offset,f.offset+f.coordCount),t=J(b,f.holeIndices,2),m=t.length,0<m){for(n=0;n<f.coordCount;)e.push(d.i1616to32(b[n++],b[n++])),e.push(y),e.push(k),e.push(d.i1616to32(r[0],r[1])),e.push(d.i1616to32(h[0],h[1])),e.push(a),w&&(e.push(x),e.push(v));for(b=0;m>b;)q.push(t[b++]+c),q.push(t[b++]+c),q.push(t[b++]+c);c+=f.coordCount/2}return G.release(p),B.update({geometry:e},c,q),B;case F.WGLGeometryType.LINE:return L.createLineMeshData(p,
k,w,v,y,c,x,r,a)}return null}});