//>>built
define("require exports ../../../../core/screenUtils ./enums ./Utils ./MeshData ./visualVariablesUtils ./MeshUtils ./MaterialInfoUtils ./enums ./WGLDisplayObject ./WGLDisplayRecord".split(" "),function(S,M,D,g,c,N,B,O,I,u,P,J){function Q(k,l,K,a,p,q){A.length=0;x.length=0;p=l.symbol;var r=q.get(p);q=p.text;var g=q.length;if(0===g||!r||!r.glyphMosaicItems)return A;for(var t=0;g>t;t++){var C=q.charCodeAt(t);x.push(C)}var d=0;x.forEach(function(a){d+=r.glyphMosaicItems[a].metrics.advance});var f,e,h,
n,v=-Math.round(d/2),B=l.vv,y=c.numTo32(K);l=k.centroid||k.geometry;k=l.x;l=l.y;q=c.copyAndPremultiply(p.color);var g=c.copyAndPremultiply(p.haloColor),E=c.i8888to32(q[0],q[1],q[2],q[3]),F=c.i8888to32(g[0],g[1],g[2],g[3]);a=[D.pt2px(p.xoffset)*a,D.pt2px(p.yoffset)*a];k+=a[0];l+=a[1];var z=p.font.size,w=R*(null!=p.haloSize?D.pt2px(D.toPt(p.haloSize)):0);if(0<w){var G=c.i1616to32(2*k+1,2*l);x.forEach(function(a){var b=[],d=[];a=r.glyphMosaicItems[a];f=Math.round(a.rect.x/4);e=Math.round(a.rect.y/4);
h=f+Math.round(a.rect.width/4);n=e+Math.round(a.rect.height/4);var g=I.createTextMaterialInfo(a,B),l=N.pool.acquire(),p=v,k=a.metrics.height;b.push(G);b.push(y);b.push(F);b.push(c.i1616to32(m*p,m*k));b.push(c.i8888to32(f,e,z,w));d.push(1);var q=p+a.metrics.width;b.push(G);b.push(y);b.push(F);b.push(c.i1616to32(m*q,m*k));b.push(c.i8888to32(h,e,z,w));d.push(1);b.push(G);b.push(y);b.push(F);b.push(c.i1616to32(m*p,0*m));b.push(c.i8888to32(f,n,z,w));d.push(1);b.push(G);b.push(y);b.push(F);b.push(c.i1616to32(m*
q,0*m));b.push(c.i8888to32(h,n,z,w));d.push(1);l.update({geometry:b,visibility:d},4,[0,1,2,1,3,2]);b=J.pool.acquire(K,u.WGLGeometryType.TEXT,l,g,0,0);A.push(b);v+=a.metrics.advance})}var v=-Math.round(d/2),H=c.i1616to32(2*k,2*l);return x.forEach(function(a){var b=[],d=[];a=r.glyphMosaicItems[a];f=Math.round(a.rect.x/4);e=Math.round(a.rect.y/4);h=f+Math.round(a.rect.width/4);n=e+Math.round(a.rect.height/4);var l=I.createTextMaterialInfo(a,B),p=N.pool.acquire(),g=v,k=a.metrics.height;b.push(H);b.push(y);
b.push(E);b.push(c.i1616to32(m*g,m*k));b.push(c.i8888to32(f,e,z,w));d.push(1);var q=g+a.metrics.width;b.push(H);b.push(y);b.push(E);b.push(c.i1616to32(m*q,m*k));b.push(c.i8888to32(h,e,z,w));d.push(1);b.push(H);b.push(y);b.push(E);b.push(c.i1616to32(m*g,0*m));b.push(c.i8888to32(f,n,z,w));d.push(1);b.push(H);b.push(y);b.push(E);b.push(c.i1616to32(m*q,0*m));b.push(c.i8888to32(h,n,z,w));d.push(1);p.update({geometry:b,visibility:d},4,[0,1,2,1,3,2]);b=J.pool.acquire(K,u.WGLGeometryType.TEXT,p,l,0,0);A.push(b);
v+=a.metrics.advance}),A}function L(c,l){if(!c)return g.WGLVVFlag.NONE;var k=0;return c.forEach(function(a){var c=a.type;"size"===c&&"outline"!==a.target?k|=B.getTypeOfSizeVisualVariable(a):"color"===c?k|=g.WGLVVFlag.COLOR:"opacity"===c?k|=g.WGLVVFlag.OPACITY:l&&"rotation"===c&&(k|=g.WGLVVFlag.ROTATION)}),k}Object.defineProperty(M,"__esModule",{value:!0});var r=[],x=[],A=[],m=32,R=10;M.getDisplayObject=function(k,l,m,a,p,q,A,x,t){l=k.attributes[l];var C=P.pool.acquire(l),d;r.length=0;d=m.renderer;
var f=m.getSymbol(k);if(f){var e=c.isMarkerSymbol(f)||c.isTextSymbol(f);if("esriGeometryPoint"===a||"esriGeometryPolyline"===a)d=(r.push({symbol:f,vv:L(d.visualVariables,e)}),r);else{if(e){if(d.backgroundFillSymbol&&(a=d.backgroundFillSymbol,r.push({symbol:a,vv:g.WGLVVFlag.NONE}),a.outline&&"none"!==a.outline.style)){e=g.WGLVVFlag.NONE;if(d.visualVariables)for(var h=0,n=d.visualVariables;h<n.length;h++){var v=n[h];if("size"===v.type&&"outline"===v.target){e|=B.getTypeOfSizeVisualVariable(v);break}}r.push({symbol:a.outline,
vv:e})}r.push({symbol:f,vv:L(d.visualVariables,!0)})}else if(c.isFillSymbol(f)){e=g.WGLVVFlag.NONE;if(d.visualVariables)for(h=0,n=d.visualVariables;h<n.length;h++)a=n[h],a=a.type,"color"===a?e|=g.WGLVVFlag.COLOR:"opacity"===a&&(e|=g.WGLVVFlag.OPACITY);if(r.push({symbol:f,vv:e}),f.outline&&"none"!==f.outline.style){e=g.WGLVVFlag.NONE;if(d.visualVariables)for(h=0,d=d.visualVariables;h<d.length;h++)if(a=d[h],"size"===a.type&&"outline"===a.target){e|=B.getTypeOfSizeVisualVariable(a);break}r.push({symbol:f.outline,
vv:e})}}else c.isLineSymbol(f)&&r.push({symbol:f,vv:L(d.visualVariables,e)});d=r}}else d=r;for(f=0;f<d.length;f++){e=d[f];h=e.symbol;a=c.getSymbolGeometryType(h);n=0!==e.vv;switch(a){case u.WGLGeometryType.MARKER:t.icon||(t.icon=c.getStrides(u.WGLGeometryType.MARKER,n,!1));break;case u.WGLGeometryType.LINE:t.line||(t.line=c.getStrides(u.WGLGeometryType.LINE,n));break;case u.WGLGeometryType.FILL:t.fill||(t.fill=c.getStrides(u.WGLGeometryType.FILL,n));break;case u.WGLGeometryType.TEXT:t.text||(t.text=
c.getStrides(u.WGLGeometryType.TEXT,n))}if(a===u.WGLGeometryType.TEXT)for(a=0,e=Q(k,e,l,q,m,x);a<e.length;a++)C.displayRecords.push(e[a]);else n=x.get(h),e=I.createMaterialInfo(m,n,a,e.vv),h=O.createMesh(l,m,e.materialKeyInfo,n,a,p,q,A,k,h),a=J.pool.acquire(l,a,h,e,0,0),C.displayRecords.push(a)}return C}});