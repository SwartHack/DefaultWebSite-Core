//>>built
define("require exports ./Utils ./visualVariablesUtils ./LineTess ./MeshData ./TileClipper".split(" "),function(da,M,y,aa,a,ba,ca){function X(d,t,g,y,A){"butt"===A?r.buttCap(d,t,g):"round"===A?r.roundCap(d,t,g,y,a.getNumberOfSlices(Math.PI),y===a.CapPosition.START?-1:1):"square"===A?r.squareCap(d,t,g,y):(r.buttCap(d,t,g),console.error("Unknown cap type!"))}function T(a,t,g,r,A,h,K,C,G,k,m,c){var d,H=0;for(d=0;d<m.vectors.count;++d){var J=m.vectors.items[d].vector[0],u=m.vectors.items[d].vector[1],
I=m.vectors.items[d].texCoords[0],v=m.vectors.items[d].texCoords[1],q=m.vectors.items[d].direction[0],z=m.vectors.items[d].direction[1],l=G+H;++H;c.push(y.i1616to32(a,t));c.push(K);c.push(r);c.push(y.i8888to32(Math.round(D*J),Math.round(D*u),Math.round(D*I),Math.round(D*v)));c.push(y.i1616to32(g,D*C));c.push(y.i1616to32(A[0],A[1]));c.push(y.i1616to32(h[0],h[1]));c.push(y.i8888to32(Math.round(D*q),Math.round(D*z),0,0));k&&(c.push(k.size),c.push(k.color),c.push(k.opacity));m.vectors.items[d].base={index:l,
point:[a,t]}}return H}function Y(d,a,g){r.bridge(Q,d,a);for(d=0;d<Q.count;++d)a=Q.items[d],g.push(a.v1.base.index,a.v2.base.index,a.v3.base.index)}Object.defineProperty(M,"__esModule",{value:!0});var r=new a.Tessellator({distanceAlongCorrection:!0}),R=new Float32Array(1),U=new Uint32Array(R.buffer),V=[a.allocExtrudeVectors(),a.allocExtrudeVectors()],Z=a.allocExtrudeVectors(),Q=a.allocTriangles(20),W=a.allocTriangles(20),D=31,N=new ca.TileClipper(0,0,0,1,8);N.setExtent(y.C_TILE_SIZE);M.createLineMeshData=
function(d,t,g,D,A,h,K,C,G){var k=null!=D?D.spriteMosaicItem:null,m=C.geometry,c=!y.isPictureSymbol(G)&&G.color?y.copyAndPremultiply(G.color):[255,255,255,1];D=y.numTo32(d);K=0<G.width?.5*(G.width+1/K):0;G=null!=k;var M=g.vvColor||g.vvOpacity||g.vvSizeMinMaxValue||g.vvSizeScaleStops||g.vvSizeFieldStops||g.vvSizeUnitValue,H=0,J=0,u=0;M&&(u=t.vvFields,H=u.opacity?t.getValue(C,u.opacity):0,J=u.color?t.getValue(C,u.color):0,u=u.size&&!g.vvSizeScaleStops?t.getValue(C,u.size):0,g.vvSizeUnitValue&&(u=aa.getVisualVariableSizeValueRepresentationRatio(u,
t.vvRanges.size.unitValue.valueRepresentation)),isNaN(u)&&(u=1),isNaN(H)&&(H=1),isNaN(J)&&(J=1),R[0]=u,u=U[0],R[0]=H,H=U[0],R[0]=J,J=U[0]);t=y.i8888to32(c[0],c[1],c[2],c[3]);g=[0,0];C=[0,0];if(k){var c=k.rect.x,I=k.rect.y,v=k.width,k=k.height;g[0]=c+1;g[1]=I+1;C[0]=c+1+v;C[1]=I+1+k}m=m.rings||m.paths;h*=8;k=-h;c=A+h;A=[];for(var I=m.length,v=0,q=!1;I>v;){var z=m[v];h=[];N.reset(2);var l=z[0][0],e=z[0][1];if(q)N.moveTo(l,e);else{if(k>l||l>c||k>e||e>c){q=!0;continue}h.push({x:l,y:e})}for(var L=!1,E=
z.length,x=1;E>x;++x)if(l+=z[x][0],e+=z[x][1],q)N.lineTo(l,e);else{if(k>l||l>c||k>e||e>c){L=!0;break}h.push({x:l,y:e})}if(L)q=!0;else{if(q){if(q=N.resultWithStarts())for(h=0;h<q.length;h++)A.push(q[h])}else A.push({line:h,start:0});v++;q=!1}}m=0;k=[];c=[];for(I=0;I<A.length;I++)if(v=A[I],h=v.line,z=v.start,!(2>h.length))for(v=h.length,l=h[0],e=h[v-1],q=e.x-l.x,l=e.y-l.y,q=1E-6>q*q+l*l,e=l=void 0,L=M?{size:u,color:J,opacity:H}:null,e=0;v>e;++e){x=h[e];E=l===V[e%2]?V[(e+1)%2]:V[e%2];if(v-1>e||!q||G){a:{var n=
E,p=e,B=h,w=v,S=q,F=B[p],b=[void 0,void 0],f=[void 0,void 0];if(0<p&&w-1>p){var O=B[(p+w-1)%w],P=B[(p+1)%w];a.normalize(b,[F.x-O.x,F.y-O.y]);a.normalize(f,[P.x-F.x,P.y-F.y])}else if(0===p)P=B[(p+1)%w],(a.normalize(f,[P.x-F.x,P.y-F.y]),S)?(B=B[w-2],a.normalize(b,[F.x-B.x,F.y-B.y])):b=f;else{if(p!==w-1){console.error("Vertex index 'i' out of range.");break a}O=B[(p+w-1)%w];(a.normalize(b,[F.x-O.x,F.y-O.y]),S)?(B=B[1],a.normalize(f,[B.x-F.x,B.y-F.y])):f=b}S||0!==p?S||p!==w-1?(p=a.getRads(b,f),p>Math.PI-
.05?r.rectJoin(n,b,f):.1>p?.05>p?r.fastMiterJoin(n,b,f):p<a.MITER_SAFE_RADS?r.miterJoin(n,b,f):r.bevelJoin(n,b,f,a.SYSTEM_MAG_LIMIT):(w=a.getNumberOfSlices(p),2.3>p?2>w||.5>p?r.bevelJoin(n,b,f,1):r.roundJoin(n,b,f,w):r.unitRoundJoin(n,b,f,w))):X(n,b,f,a.CapPosition.END,"round"):X(n,b,f,a.CapPosition.START,"round")}m+=T(x.x,x.y,z,t,g,C,D,K,m,L,E,k);if(E.capCenter&&(!q||e!==v-1))for(f=c,r.pie(W,E),b=void 0,b=0;b<W.count;++b)n=W.items[b],f.push(n.v1.base.index,n.v2.base.index,n.v3.base.index);q&&0===
e&&!G&&a.copyExtrudeVectors(Z,E)}else a.copyExtrudeVectors(E,Z);if(l&&Y(l,E,c),v-1>e)b=h[e+1],f=[b.x-x.x,b.y-x.y],n=a.length(f),f=[f[0]/n,f[1]/n],n=z+n,65535<n?(w=(65535-z)/(n-z),p=x.x+(b.x-x.x)*w,x=x.y+(b.y-x.y)*w,b=l,r.buttCap(b,f,f),m+=T(p,x,65535,t,g,C,d,K,m,L,b,k),r.bridge(Q,E,b),Y(E,b,c),r.buttCap(b,f,f),m+=T(p,x,0,t,g,C,d,K,m,L,b,k),z=n-z):(z=n,l=E)}d=new ba;return d.update({geometry:k},m,c),d}});