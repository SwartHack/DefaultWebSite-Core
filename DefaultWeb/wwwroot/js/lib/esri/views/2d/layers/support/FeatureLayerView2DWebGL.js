//>>built
require({cache:{"esri/renderers/support/diffUtils":function(){define("require exports dojo/_base/lang ../../core/Accessor ../../core/Collection ../../core/accessorSupport/utils".split(" "),function(u,q,r,n,k,h){function e(a){return a instanceof k?Object.keys(a.items):a instanceof n?h.getProperties(a).keys():a?Object.keys(a):[]}function c(a,b){return a instanceof k?a.items[b]:a[b]}function a(a,b){return Array.isArray(a)&&Array.isArray(b)?a.length!==b.length:!1}function b(g,m){var l=g.diff;if(l&&r.isFunction(l))return l(g,
m);var f=e(g),t=e(m);if(0!==f.length||0!==t.length){if(!f.length||!t.length||a(g,m))return{type:"complete",oldValue:g,newValue:m};var p=t.filter(function(a){return-1===f.indexOf(a)}),v=f.filter(function(a){return-1===t.indexOf(a)}),p=f.filter(function(a){return-1<t.indexOf(a)&&c(g,a)!==c(m,a)}).concat(p,v).sort();if((v=g?g.declaredClass:null)&&-1<d.indexOf(v)&&p.length)return{type:"complete",oldValue:g,newValue:m};var w,h;for(h in p){var v=p[h],k=c(g,v),y=c(m,v),z=void 0;r.isFunction(k)||r.isFunction(y)||
k!==y&&(null!=k||null!=y)&&(z=l&&l[v]&&r.isFunction(l[v])?l[v](k,y):"object"==typeof k&&"object"==typeof y&&(k?k.declaredClass:null)===(y?y.declaredClass:null)?b(k,y):{type:"complete",oldValue:k,newValue:y},z&&(w=w||{type:"partial",diff:{}},w.diff[v]=z))}return w}}Object.defineProperty(q,"__esModule",{value:!0});var d=["esri.Color","esri.portal.Portal"];q.diff=function(a,d){return r.isFunction(a)||r.isFunction(d)||!a&&!d?void 0:!a||!d||"object"==typeof a&&"object"==typeof a&&(a?a.declaredClass:null)!==
(d?d.declaredClass:null)?{type:"complete",oldValue:a,newValue:d}:b(a,d)}})},"esri/views/2d/engine/webgl/rendererInfoUtils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../support/arcadeUtils ../../../../arcade/Feature ./visualVariablesUtils".split(" "),function(u,q,r,n,k,h){function e(a,b){if(!a)return null;var d=0,g={};a=a.clone();var e=a.valueExpression,l=a.visualVariables,f=null;if(!a.field&&e){c||(c=new k(null));var t="$$fake"+d++,p=n.createFunction(e);g[t]=
function(a,f){return c.attributes=a.attributes,n.executeFunction(p,{vars:{$feature:c,$view:n.getViewInfo(f)},spatialReference:b})};a.field=t;a.valueExpression=null;f=function(a,f){return f.attributes[t]=g[t](f),a.getSymbol(f)}}return l&&(a.visualVariables=l.map(function(a){if(a.normalizationField){var f=a.field,t=a.normalizationField,l="$$fake"+d++;g[l]=function(a,b){return a.attributes[f]/a.attributes[t]};a=r({},a);return a.field=l,delete a.normalizationField,a}if(a.valueExpression&&"$view.scale"!==
a.valueExpression){var p=a.valueExpression,l="$$fake"+d++,e=n.createFunction(p);c||(c=new k(null));g[l]=function(a,f){return c.attributes=a.attributes,n.executeFunction(e,{vars:{$feature:c,$view:n.getViewInfo(f)},spatialReference:b})};a=r({},a);return a.field=l,delete a.valueExpression,a}return a})),{renderer:a,normalizingFunctions:g,getSymbolFunction:f}}Object.defineProperty(q,"__esModule",{value:!0});var c;q.createRendererInfo=function(a,b){var d=(b=e(a,b)||{renderer:null,normalizingFunctions:null,
getSymbolFunction:null},b.normalizingFunctions),g=b&&b.getSymbolFunction;a=b&&b.renderer||a;b=null;if("heatmap"===a.type){var c=a.offset;b=9*Math.round(a.blurRadius)+1;b={getIntensity:function(a){return"function"==typeof a?a:a?"abs"===c?function(f){return Math.abs(f.attributes[a])}:function(f){return f.attributes[a]+c}:function(a){return 1}}(a.field),kernelSize:b,radius:a.blurRadius}}var l=h.convertVisualVariables(a.visualVariables);return{renderer:a,vvFields:l.vvFields,vvRanges:l.vvRanges,heatmapInfo:b,
getValue:function(a,b){var f=d[b];return f?f(a):a.attributes[b]},getSymbol:function(a){return g?g(this.renderer,a):this.renderer.getSymbol?this.renderer.getSymbol(a):null}}};q.getNormalizedRenderer=function(a,b){return(b=e(a,b)||{renderer:null,normalizingFunctions:null,getSymbolFunction:null},b.renderer)||a};q.getSymbol=function(a,b){return a.getSymbol(b)}})},"esri/views/2d/engine/webgl/visualVariablesUtils":function(){define("require exports ../../../../core/screenUtils ../../../3d/layers/support/FastSymbolUpdates ./Utils ./enums".split(" "),
function(u,q,r,n,k,h){function e(a){return k.isNumber(a.minDataValue)&&k.isNumber(a.maxDataValue)&&null!=a.minSize&&null!=a.maxSize?h.WGLVVFlag.SIZE_MINMAX_VALUE:(a.expression&&"view.scale"===a.expression||a.valueExpression&&"$view.scale"===a.valueExpression)&&Array.isArray(a.stops)?h.WGLVVFlag.SIZE_SCALE_STOPS:(null!=a.field||a.expression&&"view.scale"!==a.expression||a.valueExpression&&"$view.scale"!==a.valueExpression)&&Array.isArray(a.stops)?h.WGLVVFlag.SIZE_FIELD_STOPS:(null!=a.field||a.expression&&
"view.scale"!==a.expression||a.valueExpression&&"$view.scale"!==a.valueExpression)&&null!=a.valueUnit?h.WGLVVFlag.SIZE_UNIT_VALUE:h.WGLVVFlag.NONE}function c(a){return{value:a.value,size:r.toPt(a.size)}}function a(a){return a.map(function(a){return c(a)})}function b(b){return"string"==typeof b||"number"==typeof b?r.toPt(b):{type:"size",expression:b.expression,stops:a(b.stops)}}function d(a){var b={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(k.isString(a.field))if(a.stops){if(8<a.stops.length)return null;
a=a.stops;for(var d=0;8>d;++d){var f=a[Math.min(d,a.length-1)];b.values[d]=f.value;b.opacities[d]=f.opacity}}else{if(!a.opacityValues||!k.isDefined(a.minDataValue)||!k.isDefined(a.maxDataValue)||2!==a.opacityValues.length)return null;b.values[0]=a.minDataValue;b.opacities[0]=a.opacityValues[0];b.values[1]=a.maxDataValue;b.opacities[1]=a.opacityValues[1];for(d=2;8>d;++d)b.values[d]=a.maxDataValue,b.opacities[d]=a.opacityValues[1]}else{if(!(a.stops&&0<=a.stops.length||a.opacityValues&&0<=a.opacityValues.length))return null;
a=a.stops&&0<=a.stops.length?a.stops[0].opacity:a.opacityValues[0];for(d=0;8>d;d++)b.values[d]=1/0,b.opacities[d]=a}return b}Object.defineProperty(q,"__esModule",{value:!0});q.getTypeOfSizeVisualVariable=e;q.getVisualVariableSizeValueRepresentationRatio=function(a,b){if(!a||!b)return a;switch(b){case "radius":case "distance":return 2*a;case "area":return Math.sqrt(a)}return a};q.stopToSizeStop=c;q.normalizeSizeStops=a;q.normalizeSizeElement=b;q.getVisualVariablesFields=function(a){var b=a&&0<a.length?
{}:null;return b&&a.forEach(function(a){var f=a.type;a.field&&(b[f]=a.field)}),b};q.convertVisualVariables=function(c){var g=c&&0<c.length?{}:null,l=g?{}:null;return g&&c.forEach(function(f){var c=f.type;if(f.field&&(g[c]=f.field),"size"===c)switch(l.size||(l.size={}),e(f)){case h.WGLVVFlag.SIZE_MINMAX_VALUE:l.size.minMaxValue={minDataValue:f.minDataValue,maxDataValue:f.maxDataValue,minSize:b(f.minSize),maxSize:b(f.maxSize)};break;case h.WGLVVFlag.SIZE_SCALE_STOPS:l.size.scaleStops={stops:a(f.stops)};
break;case h.WGLVVFlag.SIZE_FIELD_STOPS:var c=[],p=[];f=a(f.stops);for(var m=f.length,w=0;6>w;w++){var H=f[Math.min(w,m-1)];c.push(H.value);p.push(r.pt2px(H.size))}l.size.fieldStops={values:c,sizes:p};break;case h.WGLVVFlag.SIZE_UNIT_VALUE:l.size.unitValue={unit:f.valueUnit,valueRepresentation:f.valueRepresentation}}else if("color"===c)for(c=n.convertVisualVariables([f],{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null}),l.color=c.color,w=0;32>w;w+=4)k.premultiplyAlpha(l.color.colors,
w,!0);else"opacity"===c?l.opacity=d(f):"rotation"===c&&(l.rotation={type:f.rotationType})}),{vvFields:g,vvRanges:l}}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define(["require","exports","../../../../renderers/support/utils","../../lib/glMatrix","../graphics/graphicUtils"],function(u,q,r,n,k){function h(a){return null!==a&&void 0!==a}function e(a){return"number"==typeof a}function c(a,f){a&&a.push(f);b(f)}function a(a){y&&console.warn("[FastSymbolUpdates] "+a)}function b(a){y&&
console.info("[FastSymbolUpdates] "+a)}function d(a,b,f,d,t){var p=a.minSize,l=a.maxSize;if(a.expression)return c(t,"Could not convert size info: expression not supported"),!1;if(a.useSymbolValue)return a=d.symbolSize[f],b.minSize[f]=a,b.maxSize[f]=a,b.offset[f]=b.minSize[f],b.factor[f]=0,b.type[f]=1,!0;if(h(a.field))return h(a.stops)?2===a.stops.length&&e(a.stops[0].size)&&e(a.stops[1].size)?(g(a.stops[0].size,a.stops[1].size,a.stops[0].value,a.stops[1].value,b,f),b.type[f]=1,!0):(c(t,"Could not convert size info: stops only supported with 2 elements"),
!1):e(p)&&e(l)&&h(a.minDataValue)&&h(a.maxDataValue)?(g(p,l,a.minDataValue,a.maxDataValue,b,f),b.type[f]=1,!0):null!=r.meterIn[a.valueUnit]?(b.minSize[f]=-(1/0),b.maxSize[f]=1/0,b.offset[f]=0,b.factor[f]=1/r.meterIn[a.valueUnit],b.type[f]=1,!0):"unknown"===a.valueUnit?(c(t,"Could not convert size info: proportional size not supported"),!1):(c(t,"Could not convert size info: scale-dependent size not supported"),!1);if(!h(a.field)){if(a.stops&&a.stops[0]&&e(a.stops[0].size))return b.minSize[f]=a.stops[0].size,
b.maxSize[f]=a.stops[0].size,b.offset[f]=b.minSize[f],b.factor[f]=0,b.type[f]=1,!0;if(e(p))return b.minSize[f]=p,b.maxSize[f]=p,b.offset[f]=p,b.factor[f]=0,b.type[f]=1,!0}return c(t,"Could not convert size info: unsupported variant of sizeInfo"),!1}function g(a,b,f,d,c,t){d=0<Math.abs(d-f)?(b-a)/(d-f):0;c.minSize[t]=0<d?a:b;c.maxSize[t]=0<d?b:a;c.offset[t]=a-f*d;c.factor[t]=d}function m(a,b,f,t){if(a.normalizationField||a.valueRepresentation)return c(t,"Could not convert size info: unsupported property"),
null;var g=a.field;if(null!=g&&"string"!=typeof g)return c(t,"Could not convert size info: field is not a string"),null;if(b.size){if(a.field)if(b.size.field){if(a.field!==b.size.field)return c(t,"Could not convert size info: multiple fields in use"),null}else b.size.field=a.field}else b.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};var p;switch(a.axis){case "width":return p=d(a,b.size,0,f,t),p?b:null;case "height":return p=d(a,b.size,2,f,t),p?b:null;
case "depth":return p=d(a,b.size,1,f,t),p?b:null;case "width-and-depth":return p=d(a,b.size,0,f,t),p&&d(a,b.size,1,f,t),p?b:null;case null:case void 0:case "all":return p=d(a,b.size,0,f,t),p=p&&d(a,b.size,1,f,t),p=p&&d(a,b.size,2,f,t),p?b:null;default:return c(t,'Could not convert size info: unknown axis "'+a.axis+'""'),null}}function l(a,b,f){for(var d=0;3>d;++d){var t=b.unitInMeters;1===a.type[d]&&(t*=b.modelSize[d],a.type[d]=2);a.minSize[d]/=t;a.maxSize[d]/=t;a.offset[d]/=t;a.factor[d]/=t}if(0!==
a.type[0])b=0;else if(0!==a.type[1])b=1;else{if(0===a.type[2])return c(f,"No size axis contains a valid size or scale"),!1;b=2}for(d=0;3>d;++d)0===a.type[d]&&(a.minSize[d]=a.minSize[b],a.maxSize[d]=a.maxSize[b],a.offset[d]=a.offset[b],a.factor[d]=a.factor[b],a.type[d]=a.type[b]);return!0}function f(a,b,f){a[4*b+0]=f.r/255;a[4*b+1]=f.g/255;a[4*b+2]=f.b/255;a[4*b+3]=f.a}function t(a,b,d){if(a.normalizationField)return c(d,"Could not convert color info: unsupported property"),null;if("string"==typeof a.field)if(a.stops){if(8<
a.stops.length)return c(d,"Could not convert color info: too many color stops"),null;b.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};a=a.stops;for(d=0;8>d;++d){var t=a[Math.min(d,a.length-1)];b.color.values[d]=t.value;f(b.color.colors,d,t.color)}}else{if(!a.colors)return c(d,"Could not convert color info: missing stops or colors"),null;if(!h(a.minDataValue)||!h(a.maxDataValue))return c(d,"Could not convert color info: missing data values"),
null;if(2!==a.colors.length)return c(d,"Could not convert color info: invalid colors array"),null;b.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};b.color.values[0]=a.minDataValue;f(b.color.colors,0,a.colors[0]);b.color.values[1]=a.maxDataValue;f(b.color.colors,1,a.colors[1]);for(d=2;8>d;++d)b.color.values[d]=a.maxDataValue,f(b.color.colors,d,a.colors[1])}else{if(!(a.stops&&0<=a.stops.length||a.colors&&0<=a.colors.length))return c(d,
"Could not convert color info: no field and no colors/stops"),null;a=a.stops&&0<=a.stops.length?a.stops[0].color:a.colors[0];b.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(d=0;8>d;d++)b.color.values[d]=1/0,f(b.color.colors,d,a)}return b}function p(a,b,f,d){a=2===f&&"arithmetic"===a.rotationType;b.offset[f]=a?90:0;b.factor[f]=a?-1:1;b.type[f]=1}function v(a,b,f){if("string"!=typeof a.field)return c(f,"Could not convert rotation info: field is not a string"),
null;if(b.rotation){if(a.field)if(b.rotation.field){if(a.field!==b.rotation.field)return c(f,"Could not convert rotation info: multiple fields in use"),null}else b.rotation.field=a.field}else b.rotation={field:a.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(a.axis){case "tilt":return p(a,b.rotation,0,f),b;case "roll":return p(a,b.rotation,1,f),b;case null:case void 0:case "heading":return p(a,b.rotation,2,f),b;default:return c(f,'Could not convert rotation info: unknown axis "'+a.axis+
'""'),null}}function w(a,b,f){if(!a)return null;var d=!b.supportedTypes||!!b.supportedTypes.size,g=!b.supportedTypes||!!b.supportedTypes.color,p=!b.supportedTypes||!!b.supportedTypes.rotation;y&&(f=f||[]);return(a=a.reduce(function(a,l){if(!a)return a;if(l.valueExpression)return c(f,"Could not convert visual variables: arcade expressions not supported"),null;switch(l.type){case "size":return d?m(l,a,b,f):a;case "color":return g?t(l,a,f):a;case "rotation":return p?v(l,a,f):a;default:return c(f,"Could not convert visual variables: unsupported type "+
l.type),null}},{size:null,color:null,rotation:null}))&&a.size&&!l(a.size,b,f)?null:a}function H(b,f,d){if(!!b!=!!f)return a("State update failed ({$name} enabled/disabled)"),!1;if(b&&b.field!==f.field)return a("State update failed ({$name} field changed)"),!1;if(b&&"rotation"===d)for(d=0;3>d;d++)if(b.type[d]!==f.type[d]||b.offset[d]!==f.offset[d]||b.factor[d]!==f.factor[d])return!1;return!0}function I(a,b){var f={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,
vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvSymbolAnchor:null,vvSymbolRotation:null},d=a&&null!=a.size;return a&&a.size?(f.vvSizeEnabled=!0,f.vvSizeMinSize=a.size.minSize,f.vvSizeMaxSize=a.size.maxSize,f.vvSizeOffset=a.size.offset,f.vvSizeFactor=a.size.factor):a&&d&&(f.vvSizeValue=b.transformation.scale),a&&d&&(f.vvSymbolAnchor=b.transformation.anchor,f.vvSymbolRotation=b.transformation.rotation),a&&a.color&&(f.vvColorEnabled=!0,f.vvColorValues=a.color.values,f.vvColorColors=
a.color.colors),f}Object.defineProperty(q,"__esModule",{value:!0});var y=!1;q.convertVisualVariables=w;q.initFastSymbolUpdatesState=function(f,d,c){return d?f?f.disableFastUpdates?(a("State not initialized, fast updates disabled (renderer.disableFastUpdates set)"),{enabled:!1}):(f=w(f.visualVariables,c))?(b("State initialized, fast updates enabled"),{enabled:!0,visualVariables:f,materialParameters:I(f,c),customTransformation:f&&null!=f.size}):(a("State not initialized, fast updates disabled (conversion failed)"),
{enabled:!1}):(a("State not initialized, fast updates disabled (no renderer)"),{enabled:!1}):(a("State not initialized, fast updates disabled (no shader support)"),{enabled:!1})};q.updateFastSymbolUpdatesState=function(f,d,c){if(!d||!f.enabled)return!1;var t=f.visualVariables;return(d=w(d.visualVariables,c))?H(t.size,d.size,"size")&&H(t.color,d.color,"color")&&H(t.rotation,d.rotation,"rotation")?(f.visualVariables=d,f.materialParameters=I(d,c),f.customTransformation=d&&null!=d.size,b("State updated"),
!0):!1:(a("State update failed (conversion failed)"),!1)};q.getMaterialParams=I;var z;!function(a){var b=n.mat4d,f=n.vec3,d=b.create(),c=f.create();a.evaluateModelTransform=function(a,f,t){if(!a.vvSizeEnabled)return t;if(b.identity(d),b.multiply(t,d,d),k.computeObjectRotation(a.vvSymbolRotation[2],a.vvSymbolRotation[0],a.vvSymbolRotation[1],d),a.vvSizeEnabled){for(t=0;3>t;++t){var g=a.vvSizeOffset[t]+f[0]*a.vvSizeFactor[t],p=a.vvSizeMinSize[t],l=a.vvSizeMaxSize[t];c[t]=p>g?p:g>l?l:g}b.scale(d,c,d)}else b.scale(d,
a.vvSizeValue,d);return b.translate(d,a.vvSymbolAnchor,d),d}}(z||(z={}));q.evaluateModelTransform=z.evaluateModelTransform})},"esri/renderers/support/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/date/locale ../../Color ../../core/numberUtils dojo/i18n!dojo/cldr/nls/gregorian".split(" "),function(u,q,r,n,k,h){function e(a){return a&&q.map(a,function(a){return new n(a)})}function c(a,d,c){var f="";return 0===d?f=b.lt+" ":d===c&&(f=b.gt+" "),f+a}var a={},b={lte:"\x3c\x3d",gte:"\x3e\x3d",
lt:"\x3c",gt:"\x3e",pct:"%",ld:"\u2013"},d={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},g={millisecond:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",dateOptions:{formatLength:"long"}},month:{selector:"date",
dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},m={formatLength:"short",fullYear:!0},l={formatLength:"short"};return u.mixin(a,{meterIn:{inches:1/.0254,feet:1/.3048,"us-feet":3.28084,yards:1/.9144,miles:1/1609.344,"nautical-miles":1/1852,millimeters:1E3,centimeters:100,decimeters:10,meters:1,kilometers:.001,"decimal-degrees":180/20015077},timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(a,b){var f,
d=[];null==a||a instanceof Date||(a=new Date(a));b=b||{};b=u.mixin({},b);var c=b.selector?b.selector.toLowerCase():null,t=!c||-1<c.indexOf("time"),c=!c||-1<c.indexOf("date");return t&&(b.timeOptions=b.timeOptions||l,b.timeOptions&&(b.timeOptions=u.mixin({},b.timeOptions),b.timeOptions.selector=b.timeOptions.selector||"time",d.push(b.timeOptions))),c&&(b.dateOptions=b.dateOptions||m,b.dateOptions&&(b.dateOptions=u.mixin({},b.dateOptions),b.dateOptions.selector=b.dateOptions.selector||"date",d.push(b.dateOptions))),
d&&d.length?(d=q.map(d,function(b){return r.format(a,b)}),f=1==d.length?d[0]:h["dateTimeFormat-medium"].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(a,b){return d[b]})):f=r.format(a),f},createColorStops:function(b){var f=b.values,d=b.colors,g=b.labelIndexes,l=b.isDate,e=b.dateFormatOptions;return q.map(f,function(b,t){var p=null;if(!g||-1<q.indexOf(g,t)){var m;(m=l?a.formatDate(b,e):k.format(b))&&(p=c(m,t,f.length-1))}return{value:b,color:d[t],label:p}})},updateColorStops:function(b){var f,d=b.stops,
g=b.changes,l=b.isDate,e=b.dateFormatOptions,m=[],h=q.map(d,function(a){return a.value});q.forEach(g,function(a){m.push(a.index);h[a.index]=a.value});f=k.round(h,{indexes:m});q.forEach(d,function(b,t){if(b.value=h[t],null!=b.label){var g,p=null;(g=l?a.formatDate(f[t],e):k.format(f[t]))&&(p=c(g,t,d.length-1));b.label=p}})},createClassBreakLabel:function(a){var d=a.minValue,f=a.maxValue,c=a.isFirstBreak?"":b.gt+" ";a="percent-of-total"===a.normalizationType?b.pct:"";return d=null==d?"":k.format(d),
f=null==f?"":k.format(f),c+d+a+" "+b.ld+" "+f+a},setLabelsForClassBreaks:function(b){var d=b.classBreakInfos,f=b.classificationMethod,c=b.normalizationType,g=[];d&&d.length&&("standard-deviation"===f?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):b.round?(g.push(d[0].minValue),q.forEach(d,function(a){g.push(a.maxValue)}),g=k.round(g),q.forEach(d,function(b,d){b.label=a.createClassBreakLabel({minValue:0===d?g[0]:g[d],maxValue:g[d+
1],isFirstBreak:0===d,normalizationType:c})})):q.forEach(d,function(b,d){b.label=a.createClassBreakLabel({minValue:b.minValue,maxValue:b.maxValue,isFirstBreak:0===d,normalizationType:c})}))},updateClassBreak:function(b){var d,f=b.classBreaks,c=b.normalizationType,g=b.change,l=g.index,g=g.value,e=-1,m=-1,h=f.length;return"standard-deviation"===b.classificationMethod?void console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):(0===l?e=l:l===
h?m=l-1:(m=l-1,e=l),-1<e&&h>e&&(d=f[e],d.minValue=g,d.label=a.createClassBreakLabel({minValue:d.minValue,maxValue:d.maxValue,isFirstBreak:0===e,normalizationType:c})),void(-1<m&&h>m&&(d=f[m],d.maxValue=g,d.label=a.createClassBreakLabel({minValue:d.minValue,maxValue:d.maxValue,isFirstBreak:0===m,normalizationType:c}))))},calculateDateFormatInterval:function(a){var b,f,c,g,l,e,m,h,k,n=a.length,x=1/0;a=q.map(a,function(a){return new Date(a)});for(b=0;n-1>b;b++){c=a[b];l=[];m=1/0;h="";for(f=b+1;n>f;f++)g=
a[f],g=c.getFullYear()!==g.getFullYear()&&"year"||c.getMonth()!==g.getMonth()&&"month"||c.getDate()!==g.getDate()&&"day"||c.getHours()!==g.getHours()&&"hour"||c.getMinutes()!==g.getMinutes()&&"minute"||c.getSeconds()!==g.getSeconds()&&"second"||"millisecond",e=d[g],m>e&&(m=e,h=g),l.push(g);x>m&&(x=m,k=h)}return k},createUniqueValueLabel:function(b){var d=b.value,f=b.fieldInfo,c=b.domain;b=b.dateFormatInterval;var l=String(d),c=c&&c.codedValues?c.getName(d):null;return c?l=c:"number"==typeof d&&(l=
f&&"date"===f.type?a.formatDate(d,b&&g[b]):k.format(d)),l},cloneColorVariable:function(a){var b;return a&&(b=u.mixin({},a),b.colors=e(b.colors),b.stops=b.stops&&q.map(b.stops,function(a){return a=u.mixin({},a),a.color&&(a.color=new n(a.color)),a}),b.legendOptions&&(b.legendOptions=u.mixin({},b.legendOptions))),b},cloneOpacityVariable:function(a){var b;a&&(b=u.mixin({},a),(a=b.opacityValues)&&(b.opacityValues=a.slice(0)),(a=b.stops)&&(b.stops=q.map(a,function(a){return u.mixin({},a)})),(a=b.legendOptions)&&
(b.legendOptions=u.mixin({},a)));return b},cloneSizeVariable:function(b){var d;b&&(d=u.mixin({},b),d.stops&&(d.stops=q.map(d.stops,function(a){return u.mixin({},a)})),(b=d.minSize)&&"object"==typeof b&&(d.minSize=a.cloneSizeVariable(b)),(b=d.maxSize)&&"object"==typeof b&&(d.maxSize=a.cloneSizeVariable(b)),(b=d.legendOptions)&&(d.legendOptions=u.mixin({},b),b=b.customValues,b&&(d.legendOptions.customValues=b.slice(0))));return d}}),a})},"esri/core/numberUtils":function(){define(["dojo/number","dojo/i18n!dojo/cldr/nls/number"],
function(u,q){function r(c,a){return c-a}var n=/^-?(\d+)(\.(\d+))?$/i,k=new RegExp("\\"+q.decimal+"0+$","g"),h=/(\d)0*$/g,e={numDigits:function(c){var a=String(c),b=a.match(n);c={integer:0,fractional:0};if(b&&b[1])c.integer=b[1].split("").length,c.fractional=b[3]?b[3].split("").length:0;else if(-1<a.toLowerCase().indexOf("e")){var d,g,b=a.split("e"),a=b[0],b=b[1];a&&b&&(a=Number(a),b=Number(b),g=0<b,g||(b=Math.abs(b)),d=e.numDigits(a),g?(d.integer+=b,b>d.fractional?d.fractional=0:d.fractional-=b):
(d.fractional+=b,b>d.integer?d.integer=1:d.integer-=b),c=d)}return c},percentChange:function(c,a,b,d){var g,e,l,f={previous:null,next:null};return null!=b&&(g=c-b,e=a-b,l=e-g,f.previous=Math.floor(Math.abs(100*l/g))),null!=d&&(g=d-c,e=d-a,l=e-g,f.next=Math.floor(Math.abs(100*l/g))),f},round:function(c,a){var b,d,g,m,l,f,t,p,v,h;c=c.slice(0);var k=a&&null!=a.tolerance?a.tolerance:2,n=a&&a.indexes,y=a&&null!=a.strictBounds?a.strictBounds:!1;if(n)n.sort(r);else for(n=[],t=0;t<c.length;t++)n.push(t);
for(t=0;t<n.length;t++)if(h=n[t],b=c[h],a=0===h?null:c[h-1],d=h===c.length-1?null:c[h+1],g=e.numDigits(b),m=g.fractional){p=0;for(v=!1;m>=p&&!v;){f=b;v=p;var z=l=void 0;f=(l=Number(f.toFixed(v)),f>l?z=l+1/Math.pow(10,v):(z=l,l-=1/Math.pow(10,v)),l=Number(l.toFixed(v)),z=Number(z.toFixed(v)),[l,z]);l=y&&0===t?f[1]:f[0];v=k;f=z=void 0;var q=e.percentChange(b,l,a,d);v=(z=null==q.previous||q.previous<=v,f=null==q.next||q.next<=v,z&&f||q.previous+q.next<=2*v);p++}v&&(c[h]=l)}return c},format:function(c,
a){a=a||{places:20,round:-1};c=u.format(c,a);return c&&(c=c.replace(h,"$1").replace(k,"")),c}};return e})},"esri/views/3d/layers/graphics/graphicUtils":function(){define(["require","exports","../../../../geometry","../../../../geometry/support/webMercatorUtils","../../lib/glMatrix"],function(u,q,r,n,k){function h(a,b){var d=a.spatialReference;d.equals(b)||(d.isWebMercator&&b.wkid===r.SpatialReference.WGS84.wkid?n.webMercatorToGeographic(a,!1,a):b.isWebMercator&&d.wkid===r.SpatialReference.WGS84.wkid&&
n.geographicToWebMercator(a,!1,a))}function e(a){if(Array.isArray(a)){for(var b=0;b<a.length;b++)if(!e(a[b]))return!1;return!0}return null==a||0<=a}Object.defineProperty(q,"__esModule",{value:!0});var c=k.vec4d,a=k.mat4d,b=[1,1,1];q.computeCentroid=function(a,b){if("extent"===a.type)return a.center;if("polygon"===a.type)return a.centroid;for(var d=0,c=0,f=0,g=a.hasZ,e=0,v=0,w=a.paths;v<w.length;v++){for(var k=w[v],n=0,y=k;n<y.length;n++){var q=y[n],d=d+q[0],c=c+q[1];g&&(f+=q[2])}e+=k.length}a=new r.Point({x:d/
e,y:c/e,z:g?f/e:void 0,spatialReference:a.spatialReference});return b&&h(a,b),a};q.convertToSR=h;q.enlargeExtent=function(a,b,e){if(a){b||(b=c.create());var d=.5*a.width*(e-1);e=.5*a.height*(e-1);return a.width<1E-7*a.height?d+=e/20:a.height<1E-7*a.width&&(e+=d/20),c.set4(a.xmin-d,a.ymin-e,a.xmax+d,a.ymax+e,b),b}return null};q.updateVertexAttributeAuxpos1w=function(a,b){for(var d=0;d<a.geometries.length;++d){var c=a.geometries[d].data.vertexAttributes.auxpos1;c&&c.data[3]!==b&&(c.data[3]=b,a.geometryVertexAttrsUpdated(d))}};
q.mixinColorAndOpacity=function(a,b){var d=[1,1,1,1];return null!=a&&(d[0]=a[0],d[1]=a[1],d[2]=a[2]),null!==b&&void 0!==b?d[3]=b:null!=a&&3<a.length&&(d[3]=a[3]),d};q.overrideColor=function(a,b,c,e,f){f=[f[0],f[1],f[2],f[3]];for(var d=0;3>d;++d)a&&null!=a[d]?f[d]=a[d]:c&&null!=c[d]&&(f[d]=c[d]);return null!=b?f[3]=b:null!=e&&(f[3]=e),f};q.computeObjectScale=function(a,c,e,l){void 0===a&&(a=b);void 0===l&&(l=1);var d=Array(3);if(null==c||null==e)d[0]=1,d[1]=1,d[2]=1;else{for(var g=void 0,p=0,m=2;0<=
m;m--){var h=a[m],k=void 0,n=null!=h,y=0===m&&!g&&!n,q=e[m];"symbolValue"===h||y?k=0!==q?c[m]/q:1:n&&"proportional"!==h&&isFinite(h)&&(k=0!==q?h/q:1);null!=k&&(d[m]=k,g=k,p=Math.max(p,Math.abs(k)))}for(m=2;0<=m;m--)null==d[m]?d[m]=g:0===d[m]&&(d[m]=.001*p)}for(m=2;0<=m;m--)d[m]/=l;return d};q.computeSizeWithResourceSize=function(a,b){var d=b.width,c=b.depth,f=b.height;b=b.isPrimitive?10:1;if(null==d&&null==f&&null==c)return[b*a[0],b*a[1],b*a[2]];for(var g,d=[d,c,f],c=0;3>c;c++)if(f=d[c],null!=f){g=
f/a[c];break}for(c=0;3>c;c++)null==d[c]&&(d[c]=a[c]*g);return d};q.validateSymbolLayerSize=function(a){return null!=a.isPrimitive&&(a=[a.width,a.depth,a.height]),e(a)?null:"Symbol sizes may not be negative values"};q.computeObjectRotation=function(b,c,e,l){void 0===l&&(l=a.identity());b=b||0;c=c||0;e=e||0;return 0!==b&&a.rotateZ(l,-b/180*Math.PI,l),0!==c&&a.rotateX(l,c/180*Math.PI,l),0!==e&&a.rotateY(l,e/180*Math.PI,l),l}})},"esri/views/2d/engine/webgl/TileHandler":function(){define("require exports module ../../../../core/Error ../../../../core/promiseUtils ../../../../core/promiseUtils ../../../../core/kebabDictionary ../../../../core/workers/workers ../../../../core/requireUtils ../../../../tasks/QueryTask ../../../../tasks/support/Query ./TileData".split(" "),
function(u,q,r,n,k,h,e,c,a,b,d,g){var m=e({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});return function(){function e(a,b,d,c,e,g){this._parent=a;this._tilecoordRange=c;this._tileCoordRatio=e;this._quantizationFactor=g;this._wglFeatureView=b}return e.prototype.start=function(){var b=this;return c.open(this,a.getAbsMid("./WorkerTileHandler",u,r),!0).then(function(a){b._connection=a})},
e.prototype.configure=function(a,d){var f=this._parent.layer;this._queryTask=new b(f.parsedUrl.path);this._returnCentroid=this._getReturnCentroid(f.renderer);var c=f.createQuery();return this._connection.invoke("configure",{renderer:a.toJSON(),spatialReference:this._parent.view.spatialReference.toJSON(),capabilities:f.capabilities,url:f.parsedUrl.path,geometryType:m.toJSON(f.geometryType),query:c.toJSON(),outFields:c.outFields,objectIdField:f.objectIdField,tileCoordRange:this._tilecoordRange,tileCoordRatio:this._tileCoordRatio,
returnCentroid:this._returnCentroid,quantizationFactor:this._quantizationFactor,pixelRatio:window.devicePixelRatio||1,processing:d&&d.toWorker()||null,queryInMainThread:!0})},e.prototype.stop=function(){this._connection&&(this._connection.close(),this._connection=null)},e.prototype.registerTile=function(a){return this._connection.invoke("registerTile",{key:a.id}).then(function(a){return a&&a.displayData&&a.bufferData?g.deserialize(a):null})},e.prototype.removeTile=function(a){this._connection.invoke("unregisterTile",
{key:a.id})},e.prototype.getFeatures=function(a){return this._connection.invoke("getFeatures",{featureIds:a})},e.prototype.getMaterialItems=function(a){(a=a.items)&&0!==a.length||k.resolve({data:{items:[]},buffers:[]});var b=this._wglFeatureView.textureManager,d=[];return a.forEach(function(a){d.push(b.rasterizeItem(a.symbol,a.glyphIds))}),h.all(d).then(function(a){return{data:{items:a.map(function(a,b){return{id:b,mosaicItem:a}})},buffers:[]}})},e.prototype.executeProcessing=function(a){var b=this;
return k.resolve().then(function(){var c=b._parent.layer.processing;return c?(c=c.process(JSON.parse(a.featureSet),d.fromJSON(a.query),c.options))?c:k.reject(new n("FeatureLayer","invalid processing.process() method, returns nothing")):k.resolve({data:a.featureSet})}).then(function(a){return{data:{featureSet:JSON.stringify(a)},buffers:[]}})},e.prototype.queryFeatures=function(a){var b=this,c=d.fromJSON(a.query);a=this._queryTask;var f=this._parent.layer,e=f.source&&"esri.layers.graphics.sources.CSVSource"===
f.source.declaredClass;c.returnGeometry=!this._returnCentroid||f.renderer.backgroundFillSymbol;c.returnJSON=!0;c.returnCentroid=this._returnCentroid;return(e?f.source.queryFeaturesJSON(c):a.rawExecute(c).then(function(a){return a.data})).then(function(a){var d=b._parent.layer.processing;return d?(a=d.process(a,c,d.options))?a:k.reject(new n("FeatureLayer","invalid processing.process() method, returns nothing")):a}).then(function(a){return{data:{featureSet:JSON.stringify(a)},buffers:[]}})},e.prototype._getReturnCentroid=
function(a){function b(a){if(!a)return!1;a=a.type;return"simple-marker"===a||"picture-marker"===a||"text"===a}if("polygon"!==this._parent.layer.geometryType)return!1;switch(a.type){case "simple":return b(a.symbol);case "unique-value":return b(a.defaultSymbol)||a.uniqueValueInfos.some(function(a){return b(a.symbol)});case "class-breaks":return b(a.defaultSymbol)||a.classBreakInfos.some(function(a){return b(a.symbol)});default:return!0}},e}()})},"esri/views/2d/engine/webgl/TileData":function(){define("require exports ../../../../core/ObjectPool ./TileDisplayData ./TileBufferData ./WGLDisplayRecord ./enums".split(" "),
function(u,q,r,n,k,h,e){return function(){function c(){this.tileBufferData=this.tileDisplayData=null}return c.prototype.release=function(){n.pool.release(this.tileDisplayData);this.tileDisplayData=null;k.pool.release(this.tileBufferData);this.tileBufferData=null},c.prototype.serialize=function(){var a=this.tileBufferData.serialize(),b=this.tileBufferData.getBuffers(),d=n.serialize(this.tileDisplayData,null,0),d=new Uint8Array(d);n.serialize(this.tileDisplayData,d,0);b.push(d.buffer);return{data:{displayData:d.buffer,
bufferData:a},buffers:b}},c.deserialize=function(a){var b=n.pool.acquire();n.deserialize(b,new Uint8Array(a.displayData),0);a=k.deserialize(a.bufferData);var d=new c;return d.tileDisplayData=b,d.tileBufferData=a,d},c.prototype.deserializeMeshData=function(){var a=this;this.tileDisplayData.displayObjectRegistry.forEach(function(b,d){b=0;for(d=a.tileDisplayData.displayObjectRegistry.get(d).displayRecords;b<d.length;b++){var c=d[b],e=c.geometryType;c.readMeshDataFromBuffers(a.tileBufferData.geometries[e].vertexBuffer,
a.tileBufferData.geometries[e].indexBuffer)}})},c.bind=function(a,b){var d=new c;return d.tileDisplayData=a,d.tileBufferData=b,d},c.create=function(a,b){var d=new c;d.tileDisplayData=new n;for(var g=[0,0,0,0],m=[0,0,0,0],l=0;l<a.length;l++){var f=a[l];d.tileDisplayData.displayObjects.push(f);d.tileDisplayData.displayObjectRegistry.set(f.id,f);for(var t=0,f=f.displayRecords;t<f.length;t++){var p=f[t];d.tileDisplayData.displayRecords[p.geometryType].push(p);g[p.geometryType]+=p.meshData.vertexCount;
m[p.geometryType]+=p.meshData.indexData.length}}l=function(a,b){return a.sortKey-b.sortKey};for(a=0;a<d.tileDisplayData.displayRecords.length;a++)d.tileDisplayData.displayRecords[a].sort(l);l=[b.fill||{},b.line||{},b.icon||{},b.text||{}];t=new k;for(a=0;4>a;a++){t.geometries[a].indexBuffer=new Uint32Array(m[a]);t.geometries[a].vertexBuffer={};b=l[a];for(var v in b)t.geometries[a].vertexBuffer[v]={data:new Uint32Array(g[a]*b[v]/4),stride:b[v]}}d.tileBufferData=t;(g=d.tileBufferData.geometries[e.WGLGeometryType.FILL])&&
h.writeAllMeshDataToBuffers(d.tileDisplayData.displayRecords[e.WGLGeometryType.FILL],g.vertexBuffer,g.indexBuffer);(g=d.tileBufferData.geometries[e.WGLGeometryType.LINE])&&h.writeAllMeshDataToBuffers(d.tileDisplayData.displayRecords[e.WGLGeometryType.LINE],g.vertexBuffer,g.indexBuffer);(g=d.tileBufferData.geometries[e.WGLGeometryType.MARKER])&&h.writeAllMeshDataToBuffers(d.tileDisplayData.displayRecords[e.WGLGeometryType.MARKER],g.vertexBuffer,g.indexBuffer);g=d.tileBufferData.geometries[e.WGLGeometryType.TEXT];
return g&&h.writeAllMeshDataToBuffers(d.tileDisplayData.displayRecords[e.WGLGeometryType.TEXT],g.vertexBuffer,g.indexBuffer),d.tileDisplayData.displayList.addToList(d.tileDisplayData.displayRecords[e.WGLGeometryType.FILL]),d.tileDisplayData.displayList.addToList(d.tileDisplayData.displayRecords[e.WGLGeometryType.LINE]),d.tileDisplayData.displayList.addToList(d.tileDisplayData.displayRecords[e.WGLGeometryType.MARKER]),d.tileDisplayData.displayList.addToList(d.tileDisplayData.displayRecords[e.WGLGeometryType.TEXT]),
d},c.pool=new r(c),c}()})},"esri/views/2d/engine/webgl/TileDisplayData":function(){define("require exports ../../../../core/ObjectPool ./WGLDisplayObject ./WGLDisplayRecord ./WGLDisplayList ./enums ./Utils".split(" "),function(u,q,r,n,k,h,e,c){function a(a,b,d,f){a=a[b];b=0;b+=c.serializeInteger(a.length,d,f+b);for(var e=0;e<a.length;e++)b+=k.serialize(a[e],d,f+b,!1);return b}function b(a,b,f,e){a=a[b];var l=0,l=l+c.deserializeInteger(d,f,e+l);a.length=d.n;for(var p=0;p<d.n;++p)l+=k.deserialize(g,
f,e+l,!1),a[p]=g.displayRecord,a[p].geometryType=b;return l}var d={n:void 0},g={displayRecord:null},m={n:void 0},l={n:void 0},f={n:void 0};return function(){function d(){this.displayList=new h;this.displayRecords=[[],[],[],[]];this.displayObjects=[];this.displayObjectRegistry=new Map}return d.prototype.release=function(){},d.serialize=function(b,d,f){var g=b.displayRecords,l=b.displayObjects,p=0,p=p+h.serialize(b.displayList,d,f+p),p=p+a(g,e.WGLGeometryType.FILL,d,f+p),p=p+a(g,e.WGLGeometryType.LINE,
d,f+p),p=p+a(g,e.WGLGeometryType.MARKER,d,f+p);b=p+=a(g,e.WGLGeometryType.TEXT,d,f+p);f+=p;for(var p=0,p=p+c.serializeInteger(l.length,d,f+p),t=new Map,m=0,v=g.length;v>m;m++)for(var k=g[m],w=0,n=k.length;n>w;w++)t.set(k[w],w);m=0;for(v=l.length;v>m;m++)for(g=l[m],k=g.displayRecords,p+=c.serializeInteger(g.id,d,f+p),p+=c.serializeInteger(k.length,d,f+p),w=0,n=k.length;n>w;w++)g=k[w],t.has(g)&&(d&&(d[f+p]=g.geometryType),++p,p+=c.serializeInteger(t.get(g),d,f+p));return p=b+p},d.deserialize=function(a,
d,g){var p=0;a.displayList=h.pool.acquire();var p=p+h.deserialize(a.displayList,d,g+p),p=p+b(a.displayRecords,e.WGLGeometryType.FILL,d,g+p),p=p+b(a.displayRecords,e.WGLGeometryType.LINE,d,g+p),p=p+b(a.displayRecords,e.WGLGeometryType.MARKER,d,g+p),t=p+=b(a.displayRecords,e.WGLGeometryType.TEXT,d,g+p);g+=p;var p=a.displayObjects,k=a.displayObjectRegistry;a=a.displayRecords;var v=0;k.clear();for(var w={n:void 0},v=v+c.deserializeInteger(w,d,g+v),q=0;q<w.n;++q){var v=v+c.deserializeInteger(m,d,g+v),
v=v+c.deserializeInteger(l,d,g+v),x=n.pool.acquire();p.push(x);x.id=m.n;for(var r=0;r<l.n;++r){var u=void 0;v&&(u=d[g+v]);++v;v+=c.deserializeInteger(f,d,g+v);u=a[u][f.n];u.id=x.id;x.displayRecords[r]=u}k.set(x.id,x)}return p=t+v},d.pool=new r(d),d}()})},"esri/views/2d/engine/webgl/WGLDisplayObject":function(){define(["require","exports","../../../../core/ObjectPool","./WGLDisplayRecord","./Utils"],function(u,q,r,n,k){return function(){function h(){this.displayRecords=[]}return h.prototype.acquire=
function(e){this.id=e},h.prototype.release=function(){this.id=void 0;this.displayRecords.length=0},h.serialize=function(e,c,a){var b=0,b=b+k.serializeInteger(e.id,c,a+b),b=b+k.serializeInteger(e.displayRecords.length,c,a+b),d=0;for(e=e.displayRecords;d<e.length;d++)b+=n.serialize(e[d],c,a+b,!0);return b},h.deserialize=function(e,c,a){var b=0,d={n:0},b=b+k.deserializeInteger(d,c,a+b),g={n:0},b=b+k.deserializeInteger(g,c,a+b),m={displayRecord:void 0};e.displayObject=h.pool.acquire();e.displayObject.id=
d.n;e.displayObject.displayRecords.length=g.n;for(var l=0;l<g.n;++l)b+=n.deserialize(m,c,a+b,!0),e.displayObject.displayRecords[l]=m.displayRecord,e.displayObject.displayRecords[l].id=d.n;return b},h.pool=new r(h),h}()})},"esri/views/2d/engine/webgl/WGLDisplayRecord":function(){define("require exports ../../../../core/ObjectPool ./MeshData ./MaterialInfo ./enums ./Utils".split(" "),function(u,q,r,n,k,h,e){return function(){function c(){this.id=-1;this.geometryType=h.WGLGeometryType.UNKNOWN;this.materialInfo=
this.meshData=null;this.sortKey=this.indexCount=this.indexFrom=this.vertexCount=this.vertexFrom=this.zOrder=this.symbolLevel=0}return c.prototype.acquire=function(a,b,d,c,e,l){this.setData(a,b,d,c,e,l)},c.prototype.release=function(){this.id=-1;this.geometryType=h.WGLGeometryType.UNKNOWN;this.materialInfo=this.meshData=null;this.sortKey=this.indexCount=this.indexFrom=this.vertexCount=this.vertexFrom=this.zOrder=this.symbolLevel=0},c.prototype.setData=function(a,b,d,c,e,l){this.id=a;this.geometryType=
b;this.meshData=d;this.materialInfo=c;this.symbolLevel=e;this.zOrder=l;this._computeSortKey()},c.prototype.readMeshDataFromBuffers=function(a,b){this.meshData?this.meshData.clear():this.meshData=n.pool.acquire();for(var d in a){for(var c=a[d].stride,e=a[d].data,l=[],f=0;f<c*this.vertexCount/4;++f)l[f]=e[f+c*this.vertexFrom/4];this.meshData.vertexData.set(d,l)}for(f=this.meshData.indexData.length=0;f<this.indexCount;++f)this.meshData.indexData[f]=b[f+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=
this.vertexCount},c.prototype.writeMeshDataToBuffers=function(a,b,d,c){for(var e in b)for(var g=b[e].stride,f=this.meshData.vertexData.get(e),t=b[e].data,p=0;p<g*this.meshData.vertexCount/4;++p)t[p+g*a/4]=f[p];for(p=0;p<this.meshData.indexData.length;++p)c[p+d]=this.meshData.indexData[p]+a;this.vertexFrom=a;this.vertexCount=this.meshData.vertexCount;this.indexFrom=d;this.indexCount=this.meshData.indexData.length},c.writeAllMeshDataToBuffers=function(a,b,d){for(var c=0,e=0,l=0;l<a.length;l++){var f=
a[l];f.writeMeshDataToBuffers(c,b,e,d);c+=f.vertexCount;e+=f.indexCount}},c.prototype._computeSortKey=function(){this.sortKey=(31&this.symbolLevel)<<12|(127&this.zOrder)<<4|7&this.geometryType},c.serialize=function(a,b,d,c){var g=0;return c&&(b&&(b[d+g]=a.geometryType),++g),g+=k.serialize(a.materialInfo,b,d+g),b&&(b[d+g]=a.symbolLevel),++g,b&&(b[d+g]=a.zOrder),++g,g+=e.serializeInteger(a.vertexFrom,b,d+g),g+=e.serializeInteger(a.vertexCount,b,d+g),g+=e.serializeInteger(a.indexFrom,b,d+g),g+=e.serializeInteger(a.indexCount,
b,d+g)},c.deserialize=function(a,b,d,g){var m=0;a.displayRecord=c.pool.acquire();a.displayRecord.id=-1;g&&(a.displayRecord.geometryType=b[d+m],++m);a.displayRecord.meshData=null;g={materialInfo:null};m+=k.deserialize(g,b,d+m);a.displayRecord.materialInfo=g.materialInfo;a.displayRecord.symbolLevel=b[d+m];++m;a.displayRecord.zOrder=b[d+m];++m;g={n:void 0};return m+=e.deserializeInteger(g,b,d+m),a.displayRecord.vertexFrom=g.n,m+=e.deserializeInteger(g,b,d+m),a.displayRecord.vertexCount=g.n,m+=e.deserializeInteger(g,
b,d+m),a.displayRecord.indexFrom=g.n,m+=e.deserializeInteger(g,b,d+m),a.displayRecord.indexCount=g.n,a.displayRecord._computeSortKey(),m},c.pool=new r(c),c}()})},"esri/views/2d/engine/webgl/MeshData":function(){define(["require","exports","../../../../core/ObjectPool"],function(u,q,r){return function(){function n(){this.vertexData=new Map;this.vertexCount=0;this.indexData=[]}return n.prototype.release=function(){this.clear()},n.prototype.clear=function(){this.vertexData.clear();this.vertexCount=0;
this.indexData=[]},n.prototype.update=function(k,h,e){for(var c in k)this.vertexData.set(c,k[c]);for(c in this.vertexData)null===k[c]&&this.vertexData["delete"](c);this.vertexCount=h;this.indexData=e},n.pool=new r(n),n}()})},"esri/views/2d/engine/webgl/WGLDisplayList":function(){define("require exports ../../../../core/ObjectPool ./enums ./MaterialInfo ./Utils".split(" "),function(u,q,r,n,k,h){u=function(){function d(){this.symbolLevels=[]}return d.prototype.release=function(){this.symbolLevels.forEach(function(a){b.pool.release(a)});
this.symbolLevels.length=0},Object.defineProperty(d.prototype,"empty",{get:function(){return!this.symbolLevels||0===this.symbolLevels.length},enumerable:!0,configurable:!0}),d.prototype.addToList=function(a){var b=this;a.forEach(function(a){b._addToList(a)})},d.prototype.removeFromList=function(a){var b=this;a.forEach(function(a){b._removeFromList(a)})},d.prototype._addToList=function(a){var b=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),d=0<b.length?b[b.length-1]:null;null!==d&&h.isSameMaterialInfo(d.materialInfo,
a.materialInfo)&&d.indexFrom+d.indexCount===a.indexFrom?d.indexCount+=a.indexCount:(d=e.pool.acquire(),d.indexFrom=a.indexFrom,d.indexCount=a.indexCount,d.materialInfo=a.materialInfo,d.geometryType=a.geometryType,b.push(d))},d.prototype._removeFromList=function(a){for(var b=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),d=b.length,c=void 0,g=0;d>g;++g){var p=b[g];a.indexFrom+a.indexCount>p.indexFrom&&a.indexFrom<p.indexFrom+p.indexCount&&(c=g)}if(void 0!==c)if(p=b[c],a.indexFrom<p.indexFrom)p.indexCount-=
a.indexCount,p.indexFrom+=a.indexCount;else if(a.indexFrom+a.indexCount>p.indexFrom+p.indexCount)p.indexCount-=a.indexCount;else{var d=p.indexFrom,g=a.indexFrom-p.indexFrom,h=a.indexCount;a=p.indexFrom+p.indexCount-(a.indexFrom+a.indexCount);p.indexCount=g;var w=e.pool.acquire();w.geometryType=p.geometryType;w.materialInfo=k.pool.acquire();w.materialInfo.copy(p.materialInfo);w.indexFrom=d+g+h;w.indexCount=a;b.splice(c+1,0,w)}},d.prototype._getDisplayList=function(d,e,l){for(var f,g=this.symbolLevels.length,
p=0;g>p;p++)if(this.symbolLevels[p].symbolLevel===d){f=this.symbolLevels[p];break}f||(f=b.pool.acquire(),f.symbolLevel=d,this.symbolLevels.push(f));var m;d=f.zLevels.length;for(g=0;d>g;g++)if(f.zLevels[g].zLevel===e){m=f.zLevels[g];break}m||(m=a.pool.acquire(),m.geometryDPInfo=c.pool.acquire(),m.zLevel=e,f.zLevels.push(m));var h;switch(l){case n.WGLGeometryType.FILL:m.geometryDPInfo.fill||(m.geometryDPInfo.fill=[]);h=m.geometryDPInfo.fill;break;case n.WGLGeometryType.LINE:m.geometryDPInfo.line||(m.geometryDPInfo.line=
[]);h=m.geometryDPInfo.line;break;case n.WGLGeometryType.MARKER:m.geometryDPInfo.marker||(m.geometryDPInfo.marker=[]);h=m.geometryDPInfo.marker;break;case n.WGLGeometryType.TEXT:m.geometryDPInfo.text||(m.geometryDPInfo.text=[]);h=m.geometryDPInfo.text;break;default:console.error("Trying to add a record with geometry type '"+l+"'.")}return h},d.serialize=function(a,b,d){var c=0;b&&(b[d+c]=a.symbolLevels.length);++c;var e=0;for(a=a.symbolLevels;e<a.length;e++){var g=a[e];b&&(b[d+c]=g.symbolLevel);++c;
b&&(b[d+c]=g.zLevels.length);++c;for(var l=0,g=g.zLevels;l<g.length;l++){var m=g[l];b&&(b[d+c]=m.zLevel);++c;m=m.geometryDPInfo;c+=this._serializeDisplayListInfo(m.fill,b,d+c);c+=this._serializeDisplayListInfo(m.line,b,d+c);c+=this._serializeDisplayListInfo(m.marker,b,d+c);c+=this._serializeDisplayListInfo(m.text,b,d+c)}}return c},d.deserialize=function(d,c,e){var f=0,g=c[e+f];++f;for(var p=0;g>p;++p){var l=b.pool.acquire();l.symbolLevel=c[e+f];++f;d.symbolLevels.push(l);var m=c[e+f];++f;for(var h=
0;m>h;++h){var k=a.pool.acquire();k.zLevel=c[e+f];++f;l.zLevels.push(k);var q=[],f=f+this._deserializeDisplayListInfo(q,n.WGLGeometryType.FILL,c,e+f);0<q.length?k.geometryDPInfo.fill=q:k.geometryDPInfo.fill=null;q=[];f+=this._deserializeDisplayListInfo(q,n.WGLGeometryType.LINE,c,e+f);0<q.length?k.geometryDPInfo.line=q:k.geometryDPInfo.line=null;q=[];f+=this._deserializeDisplayListInfo(q,n.WGLGeometryType.MARKER,c,e+f);0<q.length?k.geometryDPInfo.marker=q:k.geometryDPInfo.marker=null;q=[];f+=this._deserializeDisplayListInfo(q,
n.WGLGeometryType.TEXT,c,e+f);0<q.length?k.geometryDPInfo.text=q:k.geometryDPInfo.text=null}}return f},d._serializeDisplayListInfo=function(a,b,d){var c=0;if(a)for(var c=c+h.serializeInteger(a.length,b,d+c),e=0;e<a.length;e++)var g=a[e],c=c+k.serialize(g.materialInfo,b,d+c),c=c+h.serializeInteger(g.indexFrom,b,d+c),c=c+h.serializeInteger(g.indexCount,b,d+c);else b&&(b[d+c]=0),++c;return c},d._deserializeDisplayListInfo=function(a,b,d,c){var f={n:void 0},g=0,g=g+h.deserializeInteger(f,d,c+g),l=f.n;
a.length=l;for(var m=0;l>m;++m){var n=e.pool.acquire();n.geometryType=b;var q={materialInfo:null},g=g+k.deserialize(q,d,c+g);n.materialInfo=q.materialInfo;g+=h.deserializeInteger(f,d,c+g);n.indexFrom=f.n;g+=h.deserializeInteger(f,d,c+g);n.indexCount=f.n;a[m]=n}return g},d.pool=new r(d),d}();var e=function(){function a(){this.materialInfo=null;this.indexCount=this.indexFrom=0}return a.prototype.release=function(){this.geometryType=n.WGLGeometryType.UNKNOWN;this.materialInfo=null;this.indexCount=this.indexFrom=
0},a.pool=new r(a),a}(),c=function(){function a(){this.text=this.marker=this.line=this.fill=null}return a.prototype.release=function(){this.fill&&(this.fill.forEach(function(a){return e.pool.release(a)}),this.fill.length=0);this.line&&(this.line.forEach(function(a){return e.pool.release(a)}),this.line.length=0);this.marker&&(this.marker.forEach(function(a){return e.pool.release(a)}),this.marker.length=0);this.text&&(this.text.forEach(function(a){return e.pool.release(a)}),this.text.length=0)},a.pool=
new r(a),a}(),a=function(){function a(){}return a.prototype.acquire=function(){this.geometryDPInfo=c.pool.acquire()},a.prototype.release=function(){this.zLevel=null;c.pool.release(this.geometryDPInfo);this.geometryDPInfo=null},a.pool=new r(a),a}(),b=function(){function b(){this.zLevels=[]}return b.prototype.release=function(){this.symbolLevel=null;this.zLevels.forEach(function(b){return a.pool.release(b)});this.zLevels.length=0},b.pool=new r(b),b}();return u})},"esri/views/2d/engine/webgl/TileBufferData":function(){define(["require",
"exports","../../../../core/ObjectPool"],function(u,q,r){return function(){function n(){this.geometries=[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}return n.prototype.release=function(){},n.deserialize=function(k){for(var h=n.pool.acquire(),e=0;4>e;++e){h.geometries[e].indexBuffer=new Uint32Array(k.geometries[e].indexBuffer);h.geometries[e].vertexBuffer={};for(var c in k.geometries[e].vertexBuffer)h.geometries[e].vertexBuffer[c]=
{data:new Uint32Array(k.geometries[e].vertexBuffer[c].data),stride:k.geometries[e].vertexBuffer[c].stride}}return h},n.prototype.serialize=function(){for(var k={geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}}]},h=0;4>h;++h)for(var e in this.geometries[h].vertexBuffer)k.geometries[h].vertexBuffer[e]=
{data:this.geometries[h].vertexBuffer[e].data.buffer,stride:this.geometries[h].vertexBuffer[e].stride};return k},n.prototype.getBuffers=function(){for(var k=[],h=0;4>h;++h){k.push(this.geometries[h].indexBuffer.buffer);for(var e in this.geometries[h].vertexBuffer)k.push(this.geometries[h].vertexBuffer[e].data.buffer)}return k},n.pool=new r(n),n}()})},"esri/views/2d/engine/webgl/WGLTile":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/ObjectPool ../../../../core/libs/gl-matrix/vec2 ../../../../core/libs/gl-matrix/mat4 ../../tiling/TileKey ../DisplayObject ./WGLDisplayRecord ./WGLGeometry ./enums ./Utils ./WGLDisplayList".split(" "),
function(u,q,r,n,k,h,e,c,a,b,d,g,m){return function(c){function f(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];b=c.call(this)||this;return b.displayList=null,b.hlDisplayList=null,b.displayObjectRegistry=new Map,b.iconDisplayRecords=null,b.textDisplayRecords=null,b.lineDisplayRecords=null,b.fillDisplayRecords=null,b.iconGeometry=null,b.textGeometry=null,b.lineGeometry=null,b.fillGeometry=null,b.coords=[0,0],b.bounds=[0,0,0,0],b.tileTransform={transform:Float32Array[16],displayCoord:Float32Array[2]},
b._hasVisualVariables=!1,0<a.length&&(d=b.acquire).call.apply(d,[b].concat(a)),b.tileTransform.transform=h.create(),b.tileTransform.displayCoord=k.create(),b;var d}return r(f,c),f.prototype.acquire=function(a,b,d,c,f){this.key=e.pool.acquire(a);this.coords[0]=b[0];this.coords[1]=b[3];this.bounds=b;this.coordRange=d;this.width=c;this.height=f},f.prototype.release=function(){this.clear();e.pool.release(this.key);this.key=null},Object.defineProperty(f.prototype,"canDisplay",{get:function(){return!!this.attached&&
!!this.displayList},enumerable:!0,configurable:!0}),f.prototype.setData=function(a,c,f){a&&a.tileDisplayData&&(this._hasVisualVariables=c,this.displayList&&a.tileDisplayData.displayList!==this.displayList&&m.pool.release(this.displayList),this.displayList=a.tileDisplayData.displayList,this.fillDisplayRecords=a.tileDisplayData.displayRecords[d.WGLGeometryType.FILL],this.lineDisplayRecords=a.tileDisplayData.displayRecords[d.WGLGeometryType.LINE],this.iconDisplayRecords=a.tileDisplayData.displayRecords[d.WGLGeometryType.MARKER],
this.textDisplayRecords=a.tileDisplayData.displayRecords[d.WGLGeometryType.TEXT],this.displayObjectRegistry=a.tileDisplayData.displayObjectRegistry,this.fillDisplayRecords&&0<this.fillDisplayRecords.length&&(this.fillGeometry=new b,this.fillGeometry.initializeWithBuffers(this._hasVisualVariables?g.C_FILL_VERTEX_DEF_VV:g.C_FILL_VERTEX_DEF,a.tileBufferData.geometries[d.WGLGeometryType.FILL],35044)),this.lineDisplayRecords&&0<this.lineDisplayRecords.length&&(this.lineGeometry=new b,this.lineGeometry.initializeWithBuffers(this._hasVisualVariables?
g.C_LINE_VERTEX_DEF_VV:g.C_LINE_VERTEX_DEF,a.tileBufferData.geometries[d.WGLGeometryType.LINE],35044)),this.iconDisplayRecords&&0<this.iconDisplayRecords.length&&(this.iconGeometry=new b,this.iconGeometry.initializeWithBuffers(this._hasVisualVariables?g.C_ICON_VERTEX_DEF_VV:g.C_ICON_VERTEX_DEF,a.tileBufferData.geometries[d.WGLGeometryType.MARKER],35044)),this.textDisplayRecords&&0<this.textDisplayRecords.length&&(this.textGeometry=new b,this.textGeometry.initializeWithBuffers(this._hasVisualVariables?
g.C_TEXT_VERTEX_DEF_VV:g.C_TEXT_VERTEX_DEF,a.tileBufferData.geometries[d.WGLGeometryType.TEXT],35044)))},f.prototype.appendData=function(a){},f.prototype.updateObjects=function(a){var c=(a.remove||[]).slice();a=a.update||[];for(var f=[],e=[],l=[],h=[],t=[],k=0;k<a.length;k++){var n=a[k];this.displayObjectRegistry.get(n.id)&&c.push(n.id)}for(var q=0;q<c.length;q++){var r=c[q];if(n=this.displayObjectRegistry.get(r)){for(var u=0,n=n.displayRecords;u<n.length;u++)switch(k=n[u],f.push(k),k.geometryType){case d.WGLGeometryType.FILL:e.push(k);
break;case d.WGLGeometryType.LINE:l.push(k);break;case d.WGLGeometryType.MARKER:h.push(k);break;case d.WGLGeometryType.TEXT:t.push(k)}this.displayObjectRegistry["delete"](r)}}this.displayList||(this.displayList=m.pool.acquire());(n=this.displayList)&&n.removeFromList(f);this._removeRecords(this.fillGeometry,this.fillDisplayRecords,e);this._removeRecords(this.lineGeometry,this.lineDisplayRecords,l);this._removeRecords(this.iconGeometry,this.iconDisplayRecords,h);this._removeRecords(this.textGeometry,
this.textDisplayRecords,t);c=[];for(f=0;f<a.length;f++){n=a[f];e=0;for(l=n.displayRecords;e<l.length;e++)switch(k=l[e],c.push(k),k.geometryType){case d.WGLGeometryType.FILL:this.fillDisplayRecords=this.fillDisplayRecords||[];this.fillDisplayRecords.push(k);break;case d.WGLGeometryType.LINE:this.lineDisplayRecords=this.lineDisplayRecords||[];this.lineDisplayRecords.push(k);break;case d.WGLGeometryType.MARKER:this.iconDisplayRecords=this.iconDisplayRecords||[];this.iconDisplayRecords.push(k);break;
case d.WGLGeometryType.TEXT:this.textDisplayRecords=this.textDisplayRecords||[],this.textDisplayRecords.push(k)}this.displayObjectRegistry.set(n.id,n)}a=!1;(this.fillGeometry||(this.fillGeometry=new b),this.lineGeometry||(this.lineGeometry=new b),this.iconGeometry||(this.iconGeometry=new b),a=a||this._updateRecords(this.iconGeometry,this.iconDisplayRecords,this._hasVisualVariables?g.C_ICON_VERTEX_DEF_VV:g.C_ICON_VERTEX_DEF),this.textGeometry||(this.textGeometry=new b),a)?(this.displayList&&m.pool.release(this.displayList),
a=m.pool.acquire(),a.addToList(this.fillDisplayRecords),a.addToList(this.lineDisplayRecords),a.addToList(this.iconDisplayRecords),a.addToList(this.textDisplayRecords),this.displayList=a):(a=this.displayList)?a.addToList(c):(a=m.pool.acquire(),a.addToList(c),this.displayList=a)},f.prototype._updateRecords=function(a,b,c){return a.update(b)===d.WGLGeometryTransactionStatus.FAILED_OUT_OF_MEMORY?(a.initializeWithRecords(c,b,35044),this.attached=!1,!0):(a.invalidateIndexBuffer(),a.invalidateVertexBuffers(),
!1)},f.prototype._removeRecords=function(a,b,d){if(a){this.iconGeometry.remove(d);for(var c=a=b.length,f=0;a>f;++f){for(var e=void 0,e=0;c>e&&b[f]!==d[e];++e);e<d.length&&(b.splice(f,1),f--)}}},f.prototype.clear=function(){this.iconGeometry&&(this.iconGeometry.clear(),this.iconGeometry=null);this.textGeometry&&(this.textGeometry.clear(),this.textGeometry=null);this.lineGeometry&&(this.lineGeometry.clear(),this.lineGeometry=null);this.fillGeometry&&(this.fillGeometry.clear(),this.fillGeometry=null);
this.displayObjectRegistry.clear();this.displayList&&(m.pool.release(this.displayList),this.displayList=null);this.hlDisplayList&&(m.pool.release(this.hlDisplayList),this.hlDisplayList=null);this.iconDisplayRecords&&(this.iconDisplayRecords.length=0);this.textDisplayRecords&&(this.textDisplayRecords.length=0);this.lineDisplayRecords&&(this.lineDisplayRecords.length=0);this.fillDisplayRecords&&(this.fillDisplayRecords.length=0)},f.prototype.dispose=function(){this.release()},f.prototype.attach=function(a){var b=
!0;return this.fillGeometry&&(this.fillGeometry.attached||(b=b&&this.fillGeometry.attach(a))),this.lineGeometry&&(this.lineGeometry.attached||(b=b&&this.lineGeometry.attach(a))),this.iconGeometry&&(this.iconGeometry.attached||(b=b&&this.iconGeometry.attach(a))),this.textGeometry&&(this.textGeometry.attached||(b=b&&this.textGeometry.attach(a))),b},f.prototype.detach=function(a){},f.prototype.doRender=function(a){},f.prototype.buildHLList=function(b){var d=this;this.hlDisplayList&&m.pool.release(this.hlDisplayList);
this.hlDisplayList=m.pool.acquire();b.forEach(function(b){if(b=d.displayObjectRegistry.get(b)){b=b.displayRecords.map(function(b){var d=a.pool.acquire();return d.id=b.id,d.geometryType=b.geometryType,d.vertexFrom=b.vertexFrom,d.vertexCount=b.vertexCount,d.indexFrom=b.indexFrom,d.indexCount=b.indexCount,d.materialInfo=b.materialInfo,d.meshData=null,d.sortKey=0,d.symbolLevel=0,d.zOrder=0,d});b.sort(function(a,b){return a.sortKey-b.sortKey});d.hlDisplayList.addToList(b);for(var c=0;c<b.length;c++)a.pool.release(b[c])}})},
f.pool=new n(f),f}(c)})},"esri/views/2d/engine/webgl/WGLGeometry":function(){define(["require","exports","../../../webgl/BufferObject","./FreeList","./enums"],function(u,q,r,n,k){return function(){function h(){this._bufferSpec={};this._ibFreeList=this._vbFreeList=null;this.vertexBufferMap={};this.vertexBufferMapCPU={};this.vao=this.indexBufferCPU=this.indexBuffer=null;this.usage=35044}return Object.defineProperty(h.prototype,"attached",{get:function(){return null!==this.indexBuffer},enumerable:!0,
configurable:!0}),h.prototype.attach=function(e){for(var c in this._bufferSpec)this.vertexBufferMap[c]=r.createVertex(e.context,this.usage,this.vertexBufferMapCPU[c].buffer);return this.indexBufferCPU&&(this.indexBuffer=r.createIndex(e.context,this.usage,this.indexBufferCPU)),!0},h.prototype.initializeEmpty=function(e,c,a,b){void 0===b&&(b=35044);this.clear();this.usage=b;a&&(this.indexBufferCPU=new Uint32Array(a));var d;for(b=0;b<e.length;b++){var g=e[b];d=0!==g.divisor?Math.ceil(c/g.divisor):c;
d*=g.strideInBytes;this._bufferSpec[g.name]=g;this.vertexBufferMapCPU[g.name]=new Uint32Array(d/4)}this._vbFreeList=n.create(c);a&&(this._ibFreeList=n.create(a))},h.prototype.initializeWithRecords=function(e,c,a){void 0===a&&(a=35044);c.sort(function(a,b){return a.sortKey-b.sortKey});for(var b=0,d=0,g=0;g<c.length;g++){var m=c[g],b=b+m.meshData.vertexCount;m.meshData.indexData&&(d+=m.meshData.indexData.length);m.indexFrom=void 0;m.indexCount=0;m.vertexFrom=void 0;m.vertexCount=0}this.initializeEmpty(e,
Math.floor(1.5*b),Math.floor(1.5*d),a);this.update(c)},h.prototype.initializeWithBuffers=function(e,c,a){void 0===a&&(a=35044);this.clear();this.usage=a;this.indexBufferCPU=c.indexBuffer;a=this.indexBufferCPU.length;for(var b=void 0,d=0;d<e.length;d++){var g=e[d];this._bufferSpec[g.name]=g;this.vertexBufferMapCPU[g.name]=c.vertexBuffer[g.name].data;g=c.vertexBuffer[g.name].data.buffer.byteLength/g.strideInBytes;void 0!==b&&b!==g?console.error("Buffers with different vertex counts."):b=g}this._vbFreeList=
n.create(b);this._vbFreeList.allocate(b);this._ibFreeList=n.create(a);this._ibFreeList.allocate(a)},h.prototype.clear=function(){this.indexBuffer&&(this.indexBuffer.dispose(),this.indexBuffer=null);this.indexBufferCPU=null;for(var e in this.vertexBufferMap)this.vertexBufferMap[e].dispose(),delete this.vertexBufferMap[e];this.vertexBufferMap={};this.vertexBufferMapCPU={};this.vao&&(this.vao.dispose(),this.vao=null);this._bufferSpec={};this._ibFreeList=this._vbFreeList=null},h.prototype.update=function(e){for(var c=
0;c<e.length;c++){var a=this._updateRecord(e[c]);if(a!==k.WGLGeometryTransactionStatus.SUCCEEDED)return a}return k.WGLGeometryTransactionStatus.SUCCEEDED},h.prototype._updateRecord=function(e){var c;void 0===e.vertexFrom||e.vertexCount!==e.meshData.vertexCount?(void 0!==e.vertexFrom&&this._vbFreeList.free(e.vertexFrom,e.vertexCount),c=0<e.meshData.vertexCount?this._vbFreeList.allocate(e.meshData.vertexCount):-1):c=e.vertexFrom;-1!==c?(e.vertexFrom=c,e.vertexCount=e.meshData.vertexCount):(e.vertexFrom=
void 0,e.vertexCount=0);var a=e.meshData.indexData?e.meshData.indexData.length:0;if(void 0===e.indexFrom||e.indexCount!==a?(void 0!==e.indexFrom&&this._ibFreeList.free(e.indexFrom,e.indexCount),c=0<a?this._ibFreeList.allocate(a):-1):c=e.indexFrom,-1!==c?(e.indexFrom=c,e.indexCount=a):(e.indexFrom=void 0,e.indexCount=0),void 0!==e.vertexFrom&&void 0!==e.indexFrom){var b;b=a=c=c=void 0;for(var d in e.meshData.vertexData){c=this._bufferSpec[d].divisor;b=0!==c?e.vertexFrom/c:e.vertexFrom;c=this.vertexBufferMapCPU[d];
var a=e.meshData.vertexData[d],g=a.length;b=b*this._bufferSpec[d].strideInBytes/4;for(var m=0;g>m;m++)c[b+m]=a[m]}d=e.vertexFrom;a=(c=e.meshData.indexData)?c.length:0;for(g=0;a>g;++g)this.indexBufferCPU[e.indexFrom+g]=d+c[g];return k.WGLGeometryTransactionStatus.SUCCEEDED}return k.WGLGeometryTransactionStatus.FAILED_OUT_OF_MEMORY},h.prototype.remove=function(e){for(var c=0;c<e.length;c++)this._removeRecord(e[c])},h.prototype._removeRecord=function(e){this._vbFreeList.free(e.vertexFrom,e.vertexCount);
e.vertexFrom=void 0;e.vertexCount=0;this._ibFreeList.free(e.indexFrom,e.indexCount);e.indexFrom=void 0;e.indexCount=0},h.prototype.invalidateIndexBuffer=function(){var e=this.indexBuffer;e&&e.setData(this.indexBufferCPU)},h.prototype.invalidateVertexBuffers=function(e){if(!e){e=[];for(var c in this.vertexBufferMap)e.push(c)}for(var a=0;a<e.length;a++){c=e[a];var b=this.vertexBufferMap[c];b&&b.setData(this.vertexBufferMapCPU[c].buffer)}},h}()})},"esri/views/2d/engine/webgl/FreeList":function(){define(["require",
"exports"],function(u,q){Object.defineProperty(q,"__esModule",{value:!0});var r=function(){function k(h){this._parent=h}return k.prototype.rangeCreated=function(h){},k.prototype.rangeResized=function(h,e,c){},k.prototype.findBestRange=function(h){for(var e=this._parent._freeHead;null!==e&&h>e.count;)e=e.next;return e},k.prototype.findAdjacentRanges=function(h,e){for(var c=!0,a=!1,b=null,d=this._parent._freeHead;c&&!a;){var g=null!==d?d.from:this._parent._size;h>=(null!==b?b.from+b.count:0)&&g>=h+
e?(c=!1,a=!0):null!==d?(b=d,d=d.next):c=!1}return[b,d]},k}();u=function(){function k(){this._rangesSortedByFrom=[];this._rangesSortedByCount=[]}return k.prototype.rangeCreated=function(h){this._rangesSortedByFrom.push(h);this._rangesSortedByFrom.sort(function(e,c){return e.from-c.from});this._rangesSortedByCount.push(h);this._rangesSortedByCount.sort(function(e,c){return e.count-c.count})},k.prototype.rangeResized=function(h,e,c){0===h.count?(this._rangesSortedByFrom.splice(this._rangesSortedByFrom.indexOf(h),
1),this._rangesSortedByCount.splice(this._rangesSortedByCount.indexOf(h),1)):this._rangesSortedByCount.sort(function(a,b){return a.count-b.count})},k.prototype.findBestRange=function(h){if(0===this._rangesSortedByCount.length)return null;for(var e=0,c=this._rangesSortedByCount.length-1,a=void 0;c>=e;){var b=Math.floor((e+c)/2),d=this._rangesSortedByCount[b].count;if(d===h){a=b;break}h>d?e=b+1:d>h&&(c=b-1,a=b)}return void 0===a?null:this._rangesSortedByCount[a]},k.prototype.findAdjacentRanges=function(h,
e){if(0===this._rangesSortedByFrom.length)return[null,null];if(h+e<=this._rangesSortedByFrom[0].from)return[null,this._rangesSortedByFrom[0]];if(h>=this._rangesSortedByFrom[this._rangesSortedByFrom.length-1].from+this._rangesSortedByFrom[this._rangesSortedByFrom.length-1].count)return[this._rangesSortedByFrom[this._rangesSortedByFrom.length-1],null];for(var c=0;c<this._rangesSortedByFrom.length-1;++c){var a=this._rangesSortedByFrom[c],b=this._rangesSortedByFrom[c+1];if(h>=a.from+a.count&&h+e<=b.from)return[a,
b]}throw Error("Could not find adjacent ranges.");},k}();q.SortingBookKeeper=u;var n=function(){function k(h,e){this._size=h;this._bookKeeper=e||new r(this);0<h?(this._freeHead={from:0,count:h,prev:null,next:null},this._bookKeeper.rangeCreated(this._freeHead)):this._freeHead=null}return k.prototype.allocate=function(h){var e=this._bookKeeper.findBestRange(h);if(null===e)return-1;var c=e.from,a=e.count;if(e.from+=h,e.count-=h,this._bookKeeper.rangeResized(e,c,a),0===e.count)h=null!==e.prev?this._freeHead:
e.next,k._removeRange(e),this._freeHead=h;return c},k.prototype.free=function(h,e){var c=this._bookKeeper.findAdjacentRanges(h,e),a=c[0],c=c[1];h={from:h,count:e,prev:a,next:c};if(null!==a&&(a.next=h),null!==c&&(c.prev=h),this._bookKeeper.rangeCreated(h),null!==c&&h.from+h.count===c.from){e=h.from;var b=h.count;k._fuse(h,c);k._removeRange(c);this._bookKeeper.rangeResized(h,e,b);this._bookKeeper.rangeResized(c,void 0,0)}null!==a&&a.from+a.count===h.from&&(e=a.from,b=a.count,k._fuse(a,h),k._removeRange(h),
this._bookKeeper.rangeResized(a,e,b),this._bookKeeper.rangeResized(h,void 0,0));this._freeHead=null!==h.prev?this._freeHead:h},k._removeRange=function(h){null!==h.prev?null!==h.next?(h.prev.next=h.next,h.next.prev=h.prev):h.prev.next=null:null!==h.next&&(h.next.prev=null)},k._fuse=function(h,e){h.count+=e.count;h.next=e.next;e.from+=e.count;e.count=0;null!==e.next&&(e.next.prev=h)},k}();q.DefaultFreeList=n;q.create=function(k){return new n(k)}})},"esri/views/2d/engine/webgl/WGLFeatureView":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix/vec3 ../../../../core/libs/gl-matrix/mat4 ../../../../core/promiseUtils ../../../../geometry/Point ../Container ./GeometryUtils ./WGLRendererInfo ./TextureManager ./Utils".split(" "),
function(u,q,r,n,k,h,e,c,a,b,d,g){return function(c){function l(a,b,e){var f=c.call(this)||this;return f._displayWidth=0,f._displayHeight=0,f._pointToCallbacks=new Map,f._highlightIDs=new Set,f._highlightOptionsUpToDate=!1,f.textureManager=new d,f._tileCoordRange=b,f._tileCoordRatio=b/a,f._parentLayerView=e,f._oneOverTileRatio=1/f._tileCoordRatio,f._tileCoordinateScale=n.create(),f._orientationVec=n.create(),f._displayScale=n.create(),f._orientationVec.set([0,0,1]),f._defaultTransform=k.create(),
f}return r(l,c),Object.defineProperty(l.prototype,"highlightOptions",{get:function(){return this._highlightOptions},set:function(a){this._highlightOptions=a;this._highlightOptionsUpToDate=!1},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"displayWidth",{get:function(){return this._displayWidth},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"displayHeight",{get:function(){return this._displayHeight},enumerable:!0,configurable:!0}),l.prototype.initialize=function(a){this._tileInfoView=
a;this.wglRendererInfo=new b(this)},l.prototype.updateHeatmapParameters=function(a){this.wglRendererInfo.updateHeatmapParameters(a);this.requestRender()},l.prototype.hitTest=function(a,b){var d=this,c=[a,b];return h.create(function(a,b){d._pointToCallbacks.set(c,{resolve:a,reject:b});d.requestRender()},function(){d._pointToCallbacks.has(c)&&d._pointToCallbacks["delete"](c)})},l.prototype.setHighlight=function(a){this._highlightIDs.clear();this.addHighlight(a)},l.prototype.addHighlight=function(a){var b=
this;a.forEach(function(a){b._highlightIDs.add(a)});this._buildHLList()},l.prototype.removeHighlight=function(a){var b=this;a.forEach(function(a){b._highlightIDs["delete"](a)});this._buildHLList()},l.prototype.addChild=function(a){a=c.prototype.addChild.call(this,a);return this._buildHLList(),a},l.prototype.removeChild=function(a){a=c.prototype.removeChild.call(this,a);return this._buildHLList(),a},l.prototype.prepareChildrenRenderParameters=function(a){return a},l.prototype.renderChildren=function(a){var b=
this;this.wglRendererInfo.updateVisualVariables(this._parentLayerView.visualVariablesInfo.vvRanges,a.state);var d=this.parent.glPainter;this.sortChildren(function(a,b){return a.key.level-b.key.level});var c=this._tileInfoView.getClosestInfoForScale(a.state.scale).level;this.wglRendererInfo.heatmapParameters?d.drawHeatmap(a.context,this,c,a.devicePixelRatio):d.draw(a.context,this,c,a.devicePixelRatio,a.stationary);0<this._highlightIDs.size&&d.highlight(a.context,this,c,a.devicePixelRatio);0!==this._pointToCallbacks.size&&
(this._pointToCallbacks.forEach(function(d,c){d.resolve(b._hitTest(a,c[0],c[1]))}),this._pointToCallbacks.clear())},l.prototype.attachChild=function(a,b){return a.attach(b)},l.prototype.detachChild=function(a,b){a.detach(b)},l.prototype.renderChild=function(a,b){a.doRender(b)},l.prototype.beforeRenderChildren=function(a,b){this._updateTilesTransform(a.state,this._tileInfoView.getClosestInfoForScale(a.state.scale).level);this._updateHighlightOptions()},l.prototype._hitTest=function(a,b,d){var c=this.parent.glPainter,
f=this._tileInfoView.getClosestInfoForScale(a.state.scale).level,l=[0,0];a.state.toMap(l,[b,d]);var m=a.state.clone(),h=m.viewpoint.clone();return h.targetGeometry=new e(l[0],l[1],a.state.spatialReference),m.viewpoint=h,m.size=[g.C_HITTEST_SEARCH_SIZE,g.C_HITTEST_SEARCH_SIZE],this._updateTilesTransform(m,f),c.update(m,a.devicePixelRatio),c.hitTest({context:a.context,budget:a.budget,state:m,devicePixelRatio:a.devicePixelRatio,stationary:a.stationary},b,d,this,f)},l.prototype._updateTilesTransform=
function(a,b){var d=1/a.width,c=1/a.height,f=[0,0];this._calculateRelativeViewProjMat(this._tileInfoView.tileInfo.lods[b].resolution,a.resolution,a.rotation,this._tileInfoView.tileInfo.size[0],this._tileCoordRange,a.width,a.height,this._defaultTransform);for(var e=0,g=this.children;e<g.length;e++){var l=g[e];a.toScreen(f,l.coords);f[1]=a.height-f[1];l.tileTransform.displayCoord[0]=2*f[0]*d-1;l.tileTransform.displayCoord[1]=2*f[1]*c-1;l.key.level===b?l.tileTransform.transform.set(this._defaultTransform):
this._calculateRelativeViewProjMat(this._tileInfoView.tileInfo.lods[l.key.level].resolution,a.resolution,a.rotation,this._tileInfoView.tileInfo.size[0],l.coordRange,a.width,a.height,l.tileTransform.transform)}},l.prototype._calculateRelativeViewProjMat=function(b,d,c,e,g,l,m,h){b=b/d*this._oneOverTileRatio;this._tileCoordinateScale.set([b,b,1]);(l!==this._displayWidth||m!==this._displayHeight)&&(this._displayScale.set([2/l,-2/m,1]),this._displayWidth=l,this._displayHeight=m);k.identity(h);k.scale(h,
h,this._tileCoordinateScale);k.rotate(h,h,-c*a.C_DEG_TO_RAD,this._orientationVec);k.scale(h,h,this._displayScale);k.transpose(h,h)},l.prototype._updateHighlightOptions=function(){this._highlightOptionsUpToDate||this._setHighlightOptions(this._highlightOptions)&&(this._highlightOptionsUpToDate=!0)},l.prototype._setHighlightOptions=function(a){if(!this.parent)return!1;var b=this.parent.glPainter;if(!b)return!1;var d=a.color.toRgba();d[0]/=255;d[1]/=255;d[2]/=255;var c=d.slice();return d[3]*=a.fillOpacity,
c[3]*=a.haloOpacity,b.setHighlightOptions({fillColor:d,outlineColor:c,outlineWidth:2,outerHaloWidth:.3,innerHaloWidth:.3,outlinePosition:0}),!0},l.prototype._buildHLList=function(){var a=this;this.children.forEach(function(b){b.buildHLList(a._highlightIDs)});this.requestRender()},l}(c)})},"esri/views/2d/engine/webgl/WGLRendererInfo":function(){define("require exports ../../../../geometry/support/scaleUtils ../../../../core/screenUtils ../../../../renderers/support/utils ./Utils".split(" "),function(u,
q,r,n,k,h){function e(c,a){var b=a.length;if(c<a[0].value||1===b)return a[0].size;for(var d=1;b>d;d++)if(c<a[d].value)return a[d-1].size+(c-a[d-1].value)/(a[d].value-a[d-1].value)*(a[d].size-a[d-1].size);return a[b-1].size}return function(){function c(a){this.symbolLevels=[];this.vvColorValues=new Float32Array(8);this.vvColors=new Float32Array(32);this.vvOpacityValues=new Float32Array(8);this.vvOpacities=new Float32Array(8);this.vvSizeMinMaxValue=new Float32Array(4);this.vvSizeFieldStopsValues=new Float32Array(6);
this.vvSizeFieldStopsSizes=new Float32Array(6);this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1};this.symbolLevels.push(0)}return Object.defineProperty(c.prototype,"vvMaterialParameters",{get:function(){return this._vvMaterialParameters},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"heatmapParameters",{get:function(){return this._heatmapParameters},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,
"vvMaterialParams",{get:function(){return this._vvMaterialParameters},enumerable:!0,configurable:!0}),c.prototype.updateHeatmapParameters=function(a){var b=a.blurRadius,d=Math.round(4.5*a.blurRadius),c=2*d+1;this._heatmapParameters||(this._heatmapParameters={radius:b,blurRadius:d,kernelSize:c,refreshIntensityKernel:!0,intensityKernel:null,color:null,maxPixelIntensity:a.maxPixelIntensity,minPixelIntensity:a.minPixelIntensity});for(var e=this._heatmapParameters,l=a.colorStops,f,k=[0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0],p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;16>n;n++){var q=l[Math.min(n,l.length-1)];k[n]=q.ratio;f=4*n;p[f+0]=q.color[0]/255;p[f+1]=q.color[1]/255;p[f+2]=q.color[2]/255;p[f+3]=1<q.color[3]?q.color[3]/255:q.color[3];h.premultiplyAlpha(p,f,!0)}e.color={values:k,colors:p,refreshColorRamp:!0};1E-6<Math.abs(e.radius-a.radius)&&(e.radius=b,e.blurRadius=d,e.kernelSize=c,e.refreshIntensityKernel=!0);
e.maxPixelIntensity=a.maxPixelIntensity;e.minPixelIntensity=a.minPixelIntensity},c.prototype.updateVisualVariables=function(a,b){var d=this._vvMaterialParameters;if(d.vvOpacityEnabled=!1,d.vvSizeEnabled=!1,d.vvColorEnabled=!1,d.vvRotationEnabled=!1,a){var c=a.size;if(c){if(d.vvSizeEnabled=!0,c.minMaxValue){var m=c.minMaxValue,l=void 0,f=void 0;h.isDefined(m.minSize)&&h.isDefined(m.maxSize)&&(h.isNumber(m.minSize)&&h.isNumber(m.maxSize)?(l=n.pt2px(m.minSize),f=n.pt2px(m.maxSize)):(f=b.scale,l=n.pt2px(e(f,
m.minSize.stops)),f=n.pt2px(e(f,m.maxSize.stops))));this.vvSizeMinMaxValue.set([m.minDataValue,m.maxDataValue,l,f])}if(c.scaleStops&&(this.vvSizeScaleStopsValue=n.pt2px(e(b.scale,c.scaleStops.stops))),c.unitValue)this.vvSizeUnitValueToPixelsRatio=r.getMetersPerUnitForSR(b.spatialReference)/k.meterIn[c.unitValue.unit]/b.resolution;c.fieldStops&&(this.vvSizeFieldStopsValues.set(c.fieldStops.values),this.vvSizeFieldStopsSizes.set(c.fieldStops.sizes))}(b=a.color)&&(d.vvColorEnabled=!0,this.vvColorValues.set(b.values),
this.vvColors.set(b.colors));(b=a.opacity)&&(d.vvOpacityEnabled=!0,this.vvOpacityValues.set(b.values),this.vvOpacities.set(b.opacities));(a=a.rotation)&&(d.vvRotationEnabled=!0,d.vvRotationType=a.type)}},c}()})},"esri/views/2d/engine/webgl/TextureManager":function(){define("require exports dojo/Deferred ../../../../core/promiseUtils ../../../3d/support/imageUtils ./SpriteMosaic ./Utils ./CIMSymbolHelper ./SDFHelper ./GlyphSource ./GlyphMosaic".split(" "),function(u,q,r,n,k,h,e,c,a,b,d){var g=[];return function(){function m(){this._rasterizeQueue=
new Map;this._spriteMosaic=new h(1024,1024,250);this._glyphSource=new b("https://basemaps.arcgis.com/v1/arcgis/rest/services/World_Basemap/VectorTileServer/resources/fonts/{fontstack}/{range}.pbf");this._glyphMosaic=new d(1024,1024,this._glyphSource)}return Object.defineProperty(m.prototype,"sprites",{get:function(){return this._spriteMosaic},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"glyphs",{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0}),m.prototype.processItems=
function(a){var b=this;if(a.done)return!1;for(;this._spriteMosaic.hasItemsToProcess();)this._spriteMosaic.processNextItem();this._rasterizeQueue.forEach(function(d,c){if(a.done)return!1;var f=b._rasterizeJSON(c);d.resolve(f);g.push(c)});for(var d=0;d<g.length;d++)this._rasterizeQueue["delete"](g[d]);return g.length=0,!0},m.prototype.rasterizeItem=function(a,b){return void 0===b&&(b=null),a?!a.type||"text"!==a.type&&"esriTS"!==a.type?this._rasterizeSpriteSymbol(a).then(function(a){return{spriteMosaicItem:a}}):
this._rasterizeTextSymbol(a,b).then(function(a){return{glyphMosaicItems:a}}):n.resolve(null)},m.prototype.bindSpritePage=function(a,b,d,c){c||(c=9729);this._spriteMosaic.bind(a,c,b,d)},m.prototype.bindGlyphsPage=function(a,b,d){this._glyphMosaic.bind(a,9729,b,d)},m.prototype._rasterizeTextSymbol=function(a,b){return this._glyphMosaic.getGlyphItems(a,b)},m.prototype._rasterizeSpriteSymbol=function(a){var b=this;return!e.isFillSymbol(a)&&!e.isLineSymbol(a)||"solid"!==a.style&&"esriSFSSolid"!==a.style&&
"esriSLSSolid"!==a.style&&"none"!==a.style?this._spriteMosaic.has(a)?n.resolve(this._spriteMosaic.getSpriteItem(a)):a.url||a.imageData?k.requestImage(a.url?a.url:"data:"+a.contentType+";base64,"+a.imageData).then(function(d){return b._rasterizeResource(d).then(function(d){return b._addItemToMosaic(a,d.size,d.anchor,d.image,!e.isMarkerSymbol(a),d.sdf)})}):this._rasterizeResource(a).then(function(d){return b._addItemToMosaic(a,d.size,d.anchor,d.image,!e.isMarkerSymbol(a),d.sdf)}):n.resolve(null)},m.prototype._rasterizeResource=
function(a){var b=this;if(this._rasterizeQueue.has(a))return this._rasterizeQueue.get(a).promise;var d=new r(function(){b._rasterizeQueue.has(a)&&b._rasterizeQueue["delete"](a)});if(a instanceof HTMLImageElement){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));this._rasterizationCanvas.width=a.width;this._rasterizationCanvas.height=a.height;var c=this._rasterizationCanvas.getContext("2d");c.drawImage(a,0,0,a.width,a.height);for(var c=c.getImageData(0,0,a.width,
a.height),c=new Uint8Array(c.data),e=void 0,g=0;g<c.length;g+=4)e=c[g+3]/255,c[g]*=e,c[g+1]*=e,c[g+2]*=e;d.resolve({size:[a.width,a.height],anchor:[0,0],image:new Uint32Array(c.buffer),sdf:!1})}else c=this._rasterizeJSON(a),d.resolve(c);return d.promise},m.prototype._addItemToMosaic=function(a,b,d,c,e,g){return this._spriteMosaic.addSpriteItem(a,b,d,c,e,g)},m.prototype._rasterizeJSON=function(b){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),"simple-fill"===
b.type||"esriSFS"===b.type){var d=c.SymbolHelper.rasterizeSimpleFill(this._rasterizationCanvas,b.style);b=d[0];var e=d[1],d=d[2];return{size:[e,d],anchor:[0,0],image:new Uint32Array(b.buffer),sdf:!1}}if("simple-line"===b.type||"esriSLS"===b.type)return d=c.SymbolHelper.rasterizeSimpleLine(this._rasterizationCanvas,b.style),b=d[0],e=d[1],d=d[2],{size:[e,d],anchor:[0,0],image:new Uint32Array(b.buffer),sdf:!0};if("simple-marker"===b.type||"esriSMS"===b.type?(e=c.CIMSymbolHelper.fromSimpleMarker(b),d=
!0):(e=b,d=a.SDFHelper.checkSDF(e)),d)return e=(new a.SDFHelper).buildSDF(e),b=e[0],{size:[e[1],e[2]],anchor:[0,0],image:new Uint32Array(b.buffer),sdf:!0};var g=c.CIMSymbolHelper.rasterize(this._rasterizationCanvas,e);b=g[0];e=g[1];d=g[2];return{size:[e,d],anchor:[g[3],g[4]],image:new Uint32Array(b.buffer),sdf:!1}},m}()})},"esri/views/3d/support/imageUtils":function(){define(["require","exports","dojo/Deferred","../../../core/urlUtils","../../../request"],function(u,q,r,n,k){function h(e){var c=!1,
a=new Image,b=new r(function(){c=!0;a.src=""}),d=function(){c||b.reject()};return a.onload=function(){c||b.resolve(a)},a.onerror=d,a.onabort=d,a.src=e,b.promise}Object.defineProperty(q,"__esModule",{value:!0});q.dataURItoBlob=function(e){var c=atob(e.split(",")[1]);e=e.split(",")[0].split(":")[1].split(";")[0];for(var a=new ArrayBuffer(c.length),b=new Uint8Array(a),d=0;d<c.length;d++)b[d]=c.charCodeAt(d);return new Blob([a],{type:e})};q.dataUriToImage=h;q.requestImage=function(e){return n.isDataProtocol(e)?
h(e):k(e,{responseType:"image",allowImageDataAccess:!0}).then(function(c){return c.data})}})},"esri/views/2d/engine/webgl/SpriteMosaic":function(){define("require exports ./Rect ./GeometryUtils ./RectangleBinPack ../../../webgl/Texture".split(" "),function(u,q,r,n,k,h){return function(){function e(c,a,b){void 0===b&&(b=0);this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects=new Map;this._spriteCopyQueue=
[];this.pixelRatio=1;(0>=c||0>=a)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=c;this._pageHeight=a;0<b&&(this._maxItemSize=b);this.pixelRatio=1|window.devicePixelRatio;this._binPack=new k(this._pageWidth,this._pageHeight);this._mosaicsData[0]=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}return e.prototype.getWidth=
function(c){return c>=this._size.length?-1:this._size[c][0]},e.prototype.getHeight=function(c){return c>=this._size.length?-1:this._size[c][1]},e.prototype.getPage=function(c){return c<this._textures.length?this._textures[c]:null},e.prototype.has=function(c){return this._mosaicRects.has(JSON.stringify(c))},e.prototype.getSpriteItem=function(c){return this._mosaicRects.get(JSON.stringify(c))},e.prototype.addSpriteItem=function(c,a,b,d,e,h){c=JSON.stringify(c);if(this._mosaicRects.has(c))return this._mosaicRects.get(c);
var g=this._allocateImage(a[0],a[1]),f=g[0],m=g[1],g=g[2];if(0>=f.width||0>=f.height)return null;b={rect:f,width:a[0],height:a[1],anchorX:b[0],anchorY:b[1],sdf:h,pixelRatio:1,page:m};return this._mosaicRects.set(c,b),this._copy({rect:f,spriteSize:a,spriteData:d,page:m,pageSize:g,repeat:e,sdf:h}),b},e.prototype.hasItemsToProcess=function(){return 0!==this._spriteCopyQueue.length},e.prototype.processNextItem=function(){var c=this._spriteCopyQueue.pop();c&&this._copy(c)},e.prototype.getSpriteItems=function(c){for(var a=
{},b=0;b<c.length;b++){var d=c[b];a[d]=this.getSpriteItem(d)}return a},e.prototype.getMosaicItemPosition=function(c,a){a=(c=this.getSpriteItem(c))&&c.rect;if(!a)return null;a.width=c.width;a.height=c.height;return{size:[c.width,c.height],tl:[(a.x+1)/this._size[c.page][0],(a.y+1)/this._size[c.page][1]],br:[(a.x+1+c.width)/this._size[c.page][0],(a.y+1+c.height)/this._size[c.page][1]],page:c.page}},e.prototype.bind=function(c,a,b,d){void 0===b&&(b=0);void 0===d&&(d=0);this._textures[b]||(this._textures[b]=
new h(c,{pixelFormat:6408,dataType:5121,width:this._size[b][0],height:this._size[b][1]},new Uint8Array(this._mosaicsData[b].buffer)));var e=this._textures[b];e.setSamplingMode(a);this._dirties[b]&&(e.setData(new Uint8Array(this._mosaicsData[b].buffer)),e.generateMipmap());c.bindTexture(e,d);this._dirties[b]=!1},e._copyBits=function(c,a,b,d,e,h,l,f,k,p,n){var g=d*a+b;l=f*h+l;if(n)for(l-=h,n=-1;p>=n;n++,g=((n+p)%p+d)*a+b,l+=h)for(f=-1;k>=f;f++)e[l+f]=c[g+(f+k)%k];else for(n=0;p>n;n++){for(f=0;k>f;f++)e[l+
f]=c[g+f];g+=a;l+=h}},e.prototype._copy=function(c){if(!(c.page>=this._mosaicsData.length)){var a=c.spriteData,b=this._mosaicsData[c.page];b&&a||console.error("Source or target images are uninitialized!");e._copyBits(a,c.spriteSize[0],0,0,b,c.pageSize[0],c.rect.x+1,c.rect.y+1,c.spriteSize[0],c.spriteSize[1],c.repeat);this._dirties[c.page]=!0}},e.prototype._allocateImage=function(c,a){c+=2;a+=2;var b=Math.max(c,a);if(this._maxItemSize&&this._maxItemSize<b){var b=Math.pow(2,Math.ceil(n.log2(c))),d=
Math.pow(2,Math.ceil(n.log2(a)));c=new r(0,0,c,a);return this._mosaicsData.push(new Uint32Array(b*d)),this._dirties.push(!0),this._size.push([b,d]),this._textures.push(void 0),[c,this._mosaicsData.length-1,[b,d]]}b=this._binPack.allocate(c+(c%4?4-c%4:0),a+(a%4?4-a%4:0));return 0>=b.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),
this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new k(this._pageWidth,this._pageHeight),this._allocateImage(c,a)):[b,this._currentPage,[this._pageWidth,this._pageHeight]]},e.prototype._dispose=function(){this._binPack=null;this._mosaicRects.clear()},e}()})},"esri/views/2d/engine/webgl/Rect":function(){define(["require","exports"],function(u,q){return function(){function q(n,k,h,e){void 0===n&&(n=0);void 0===k&&(k=0);void 0===h&&(h=0);void 0===e&&(e=0);
this.x=n;this.y=k;this.width=h;this.height=e}return Object.defineProperty(q.prototype,"isEmpty",{get:function(){return 0>=this.width||0>=this.height},enumerable:!0,configurable:!0}),q}()})},"esri/views/2d/engine/webgl/RectangleBinPack":function(){define(["require","exports","./Rect"],function(u,q,r){return function(){function n(k,h){this._height=this._width=0;this._free=[];this._width=k;this._height=h;this._free.push(new r(0,0,k,h))}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},
enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.allocate=function(k,h){if(k>this._width||h>this._height)return new r;for(var e=null,c=-1,a=0;a<this._free.length;++a){var b=this._free[a];k<=b.width&&h<=b.height&&(null===e||b.y<=e.y&&b.x<=e.x)&&(e=b,c=a)}return null===e?new r:(this._free.splice(c,1),e.width<e.height?(e.width>k&&this._free.push(new r(e.x+k,e.y,e.width-k,h)),e.height>h&&this._free.push(new r(e.x,
e.y+h,e.width,e.height-h))):(e.width>k&&this._free.push(new r(e.x+k,e.y,e.width-k,e.height)),e.height>h&&this._free.push(new r(e.x,e.y+h,k,e.height-h))),new r(e.x,e.y,k,h))},n.prototype.release=function(k){for(var h=0;h<this._free.length;++h){var e=this._free[h];if(e.y===k.y&&e.height===k.height&&e.x+e.width===k.x)e.width+=k.width;else if(e.x===k.x&&e.width===k.width&&e.y+e.height===k.y)e.height+=k.height;else if(k.y===e.y&&k.height===e.height&&k.x+k.width===e.x)e.x=k.x,e.width+=k.width;else{if(k.x!==
e.x||k.width!==e.width||k.y+k.height!==e.y)continue;e.y=k.y;e.height+=k.height}this._free.splice(h,1);this.release(k)}this._free.push(k)},n}()})},"esri/views/2d/engine/webgl/CIMSymbolHelper":function(){define(["require","exports","../../../vectorTiles/GeometryUtils","./CIMSymbolDrawHelper","./SDFHelper"],function(u,q,r,n,k){Object.defineProperty(q,"__esModule",{value:!0});u=function(){function h(){}return h.getEnvelope=function(e){if("CIMPointSymbol"!==e.type)return null;var c=new n.EnvDrawHelper;
return c.drawSymbol(e,{type:"point",x:0,y:0}),c.envelope()},h.rasterize=function(e,c){var a=this.getEnvelope(c);if(!a||0>=a.width||0>=a.height)return[null,0,0,0,0];var b=96/72,d=(a.x+.5*a.width)*b,g=-(a.y+.5*a.height)*b;e.width=a.width*b+2;e.height=a.height*b+2;a=e.getContext("2d");b=n.Transformation.createScale(b,-b);b.translate(.5*e.width-d,.5*e.height-g);(new n.CanvasDrawHelper(a,b)).drawSymbol(c,{type:"point",x:0,y:0});c=a.getImageData(0,0,e.width,e.height);b=new Uint8Array(c.data);for(a=0;a<
b.length;a+=4)c=b[a+3]/255,b[a]*=c,b[a+1]*=c,b[a+2]*=c;return[b,e.width,e.height,d/e.width,g/e.height]},h.fromSimpleMarker=function(e){var c,a,b=e.style;if("circle"===b||"esriSMSCircle"===b){c=Math.acos(.995);a=Math.ceil(r.C_PI/c/4);0===a&&(a=1);c=r.C_PI_BY_2/a;a*=4;b=[];b.push([50,0]);for(var d=1;a>d;d++)b.push([50*Math.cos(d*c),-50*Math.sin(d*c)]);b.push([50,0]);c={rings:[b]};a={xmin:-50,ymin:-50,xmax:50,ymax:50}}else if("cross"===b||"esriSMSCross"===b)c=10,c={rings:[[[c,50],[c,c],[50,c],[50,-c],
[c,-c],[c,-50],[-c,-50],[-c,-c],[-50,-c],[-50,c],[-c,c],[-c,50],[c,50]]]},a={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("diamond"===b||"esriSMSDiamond"===b)c={rings:[[[-50,0],[0,50],[50,0],[0,-50],[-50,0]]]},a={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("square"===b||"esriSMSSquare"===b)c={rings:[[[-50,-50],[-50,50],[50,50],[50,-50],[-50,-50]]]},a={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("x"===b||"esriSMSX"===b)c=14.142135623730951,c={rings:[[[0,c],[50-c,50],[50,50-c],[c,0],[50,c-50],[50-c,-50],
[0,-c],[c-50,-50],[-50,c-50],[-c,0],[-50,50-c],[c-50,50],[0,c]]]},a={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("triangle"===b||"esriSMSTriangle"===b)a=2/3*100,b=a-100,c={rings:[[[-57.735026918962575,b],[0,a],[57.735026918962575,b],[-57.735026918962575,b]]]},a={xmin:-57.735026918962575,ymin:b,xmax:57.735026918962575,ymax:a};var g;c&&a&&(g=[{type:"CIMSolidFill",enable:!0,color:e.color}],e.outline&&g.push({type:"CIMSolidStroke",enable:!0,width:e.outline.width,color:e.outline.color}),g={type:"CIMPointSymbol",
symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:e.angle,size:e.size,offsetX:e.xoffset,offsetY:e.yoffset,frame:a,markerGraphics:[{type:"CIMMarkerGraphic",geometry:c,symbol:{type:"CIMPolygonSymbol",symbolLayers:g}}]}]});return g},h}();q.CIMSymbolHelper=u;u=function(){function h(){}return h.rasterizeSimpleFill=function(e,c){"solid"!==c&&"none"!==c&&"esriSFSSolid"!==c&&"esriSFSNull"!==c||console.error("Unexpected: style does not require rasterization");e.width=8;e.height=8;var a=e.getContext("2d");
a.strokeStyle="#FFFFFF";a.beginPath();"vertical"!==c&&"cross"!==c&&"esriSFSCross"!==c&&"esriSFSVertical"!==c||(a.moveTo(0,0),a.lineTo(0,8));"horizontal"!==c&&"cross"!==c&&"esriSFSCross"!==c&&"esriSFSHorizontal"!==c||(a.moveTo(0,0),a.lineTo(8,0));"forward-diagonal"!==c&&"diagonal-cross"!==c&&"esriSFSDiagonalCross"!==c&&"esriSFSForwardDiagonal"!==c||(a.moveTo(0,0),a.lineTo(8,8));"backward-diagonal"!==c&&"diagonal-cross"!==c&&"esriSFSBackwardDiagonal"!==c&&"esriSFSDiagonalCross"!==c||(a.moveTo(8,0),
a.lineTo(0,8));a.stroke();c=a.getImageData(0,0,e.width,e.height);for(var a=new Uint8Array(c.data),b=0;b<a.length;b+=4)c=a[b+3]/255,a[b]*=c,a[b+1]*=c,a[b+2]*=c;return[a,e.width,e.height]},h.rasterizeSimpleLine=function(e,c){var a;switch(c){case "dash":case "esriSLSDash":a=[3,2];break;case "dash-dot":case "esriSLSDashDot":a=[2,2,0,2];break;case "dot":case "esriSLSDot":a=[0,3];break;case "long-dash":case "esriSLLongDash":a=[6,3];break;case "long-dash-dot":case "esriSLLongDashDot":a=[6,3,0,3];break;case "long-dash-dot-dot":case "esriSLLongDashDotDot":a=
[2,2,0,2,0,2];break;case "short-dash":case "esriSLSShortDash":a=[2,2];break;case "short-dash-dot":case "esriSLSShortDashDot":a=[2,2,0,2];break;case "short-dash-dot-dot":case "esriSLSShortDashDotDot":a=[2,2,0,2,0,2];break;case "short-dot":case "esriSLSShortDot":a=[0,2];break;case "solid":case "esriSLSSolid":throw Error("Unexpected: style does not require rasterization");case "none":throw Error("Unexpected: style does not require rasterization");}c=e=0;for(var b=a;c<b.length;c++){var d=b[c];e+=d}e*=
16;b=31*e;c=new Float32Array(b);for(d=0;b>d;++d)c[d]=257;for(var g=b=.5,h=!0,l=0;l<a.length;l++){for(var d=a[l],b=g,g=g+16*d,f=b;g>f;){for(var n=.5;31>n;){var d=(31-n+1.5)*e+f-.5,p=(n-15.5)*(n-15.5);h?c[d]=p:c[d]=Math.min((f-b)*(f-b)+p,(f-g)*(f-g)+p);n++}f++}h=!h}a=c.length;b=new Uint8Array(4*a);for(d=0;a>d;++d)k.packFloat(Math.sqrt(c[d])/15,b,4*d);return[b,e,31]},h}();q.SymbolHelper=u})},"esri/views/2d/engine/webgl/CIMSymbolDrawHelper":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ./Rect ./GeometryUtils".split(" "),
function(u,q,r,n,k,h){Object.defineProperty(q,"__esModule",{value:!0});var e=function(){function c(a){this._t=a}return c.createIdentity=function(){return new c([1,0,0,0,1,0])},c.prototype.clone=function(){return new c(this._t.slice())},c.prototype.transform=function(a){var b=this._t;return[b[0]*a[0]+b[1]*a[1]+b[2],b[3]*a[0]+b[4]*a[1]+b[5]]},c.createScale=function(a,b){return new c([a,0,0,0,b,0])},c.prototype.scale=function(a,b){var d=this._t;return d[0]*=a,d[1]*=a,d[2]*=a,d[3]*=b,d[4]*=b,d[5]*=b,
this},c.prototype.scaleRatio=function(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])},c.createTranslate=function(a,b){return new c([0,0,a,0,0,b])},c.prototype.translate=function(a,b){var d=this._t;return d[2]+=a,d[5]+=b,this},c.createRotate=function(a){var b=Math.cos(a);a=Math.sin(a);return new c([b,-a,0,a,b,0])},c.prototype.rotate=function(a){return this.multiply(c.createRotate(a))},c.prototype.multiply=function(a){var b=this._t;a=a._t;var d=b[1]*a[0]+b[4]*a[1],c=b[2]*a[0]+b[5]*
a[1]+a[2],e=b[0]*a[3]+b[3]*a[4],h=b[1]*a[3]+b[4]*a[4],f=b[2]*a[3]+b[5]*a[4]+a[5];return b[0]=b[0]*a[0]+b[3]*a[1],b[1]=d,b[2]=c,b[3]=e,b[4]=h,b[5]=f,this},c}();q.Transformation=e;u=function(){function c(a){this._transfos=[];this._sizeTransfos=[];this._transfos.push(a||e.createIdentity());this._sizeTransfos.push(a?a.scaleRatio():1)}return c.prototype.transformPt=function(a){return this._transfos[this._transfos.length-1].transform(a)},c.prototype.transformSize=function(a){return a*this._sizeTransfos[this._sizeTransfos.length-
1]},c.prototype.back=function(){return this._transfos[this._transfos.length-1]},c.prototype.push=function(a){var b=a.scaleRatio();a.multiply(this.back());this._transfos.push(a);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*b)},c.prototype.pop=function(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,1)},c.prototype.drawSolidFill=function(a,b){},c.prototype.drawSolidStroke=function(a,b,d){},c.prototype.drawSymbol=function(a,b){if(a)switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(a,
b)}},c.prototype.drawMultiLayerSymbol=function(a,b){if(a&&(a=a.symbolLayers))for(var d=a.length;d--;){var c=a[d];if(c&&c.enable)switch(c.type){case "CIMSolidFill":this.drawSolidFill(b,c.color);break;case "CIMSolidStroke":this.drawSolidStroke(b,c.color,c.width);break;case "CIMVectorMarker":this.drawVectorMarker(c,b)}}},c.prototype.drawVectorMarker=function(a,b){if(a){var d=a.markerGraphics;if(d){var c=a.size,m=a.frame,l=m?m.ymax-m.ymin:0,l=c&&l?c/l:1,f=e.createIdentity();m&&f.translate(.5*-(m.xmax+
m.xmin),.5*-(m.ymax+m.ymin));var k=a.anchorPt;if(k){var p=k.x,k=k.y;"relative"===a.anchorPtUnits&&m&&(p*=(m.xmax-m.xmin)*l,k*=c);f.translate(-p,-k)}1!==l&&f.scale(l,l);a.rotation&&f.rotate(a.rotation*h.C_DEG_TO_RAD);f.translate(a.offsetX||0,a.offsetY||0);f.translate(b.x,b.y);this.push(f);for(a=0;a<d.length;a++)(b=d[a])&&this.drawSymbol(b.symbol,b.geometry);this.pop()}}},c}();q.CIMSymbolDrawHelper=u;n=function(c){function a(){var a=c.call(this)||this;return a._xmin=a._ymin=1/0,a._xmax=a._ymax=-(1/
0),a}return r(a,c),a.prototype.envelope=function(){return new k(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)},a.prototype._merge=function(a,d){a[0]-d<this._xmin&&(this._xmin=a[0]-d);a[0]+d>this._xmax&&(this._xmax=a[0]+d);a[1]-d<this._ymin&&(this._ymin=a[1]-d);a[1]+d>this._ymax&&(this._ymax=a[1]+d)},a.prototype.drawSolidFill=function(a,d){d=0;for(a=a.rings;d<a.length;d++){var b=a[d],c=b?b.length:0;if(2<c){this._merge(this.transformPt(b[0]),0);for(var e=1;c>e;++e)this._merge(this.transformPt(b[e]),
0)}}},a.prototype.drawSolidStroke=function(a,d,c){d=.5*this.transformSize(c);c=0;for(a=a.rings||a.paths;c<a.length;c++){var b=a[c],e=b?b.length:0;if(1<e){this._merge(this.transformPt(b[0]),d);for(var f=1;e>f;++f)this._merge(this.transformPt(b[f]),d)}}},a}(u);q.EnvDrawHelper=n;u=function(c){function a(a,d){d=c.call(this,d)||this;return d._ctx=a,d}return r(a,c),a.prototype.drawSolidFill=function(a,d){var b=this._ctx;b.fillStyle="rgba("+Math.round(d[0])+","+Math.round(d[1])+","+Math.round(d[2])+","+
d[3]/255+")";b.beginPath();d=0;for(a=a.rings;d<a.length;d++){var c=a[d],e=c?c.length:0;if(2<e){var f=this.transformPt(c[0]);b.moveTo(f[0],f[1]);for(var h=1;e>h;++h)f=this.transformPt(c[h]),b.lineTo(f[0],f[1]);b.closePath()}}b.fill("evenodd")},a.prototype.drawSolidStroke=function(a,d,c){var b=this._ctx;b.strokeStyle="rgba("+Math.round(d[0])+","+Math.round(d[1])+","+Math.round(d[2])+","+d[3]/255+")";b.lineWidth=this.transformSize(c)+.5;b.beginPath();d=!!a.rings;c=0;for(a=a.rings||a.paths;c<a.length;c++){var e=
a[c],f=e?e.length:0;if(1<f){var g=this.transformPt(e[0]);b.moveTo(g[0],g[1]);for(var h=1;f>h;++h)g=this.transformPt(e[h]),b.lineTo(g[0],g[1]);d&&b.closePath()}}b.stroke()},a}(u);q.CanvasDrawHelper=u})},"esri/views/2d/engine/webgl/SDFHelper":function(){define(["require","exports","./Geometry","./Rect"],function(u,q,r,n){function k(a){return a-Math.floor(a)}function h(a,b,d){a=0>a?0:.9999991<a?.9999991:a;var g=k(a*e[0]),h=k(a*e[1]),l=k(a*e[2]);a=k(a*e[3]);b[d+0]=256*(g-g*c[0]);b[d+1]=256*(h-g*c[1]);
b[d+2]=256*(l-h*c[2]);b[d+3]=256*(a-l*c[3])}Object.defineProperty(q,"__esModule",{value:!0});var e=[16777216,65536,256,1],c=[0,1/256,1/256,1/256];q.packFloat=h;u=function(){function a(){}return a.checkSDF=function(a){return!0},a.prototype._extractGeometry=function(a){if(!a)return null;a=a.symbolLayers;if(!a||1!==a.length)return null;a=a[0];if(!a)return null;a=a.markerGraphics;if(!a||1!==a.length)return null;a=a[0];if(!a)return null;var b=a.geometry;if(!b||!b.rings)return null;a=[];for(var c=0,b=b.rings;c<
b.length;c++){for(var e=[],h=0,f=b[c];h<f.length;h++){var k=f[h];e.push(new r.Point(k[0],k[1]))}a.push(e)}return a},a.prototype._getEnvelope=function(a){for(var b=1/0,c=-(1/0),e=1/0,h=-(1/0),f=0;f<a.length;f++)for(var k=0,p=a[f];k<p.length;k++){var q=p[k];q.x<b&&(b=q.x);q.x>c&&(c=q.x);q.y<e&&(e=q.y);q.y>h&&(h=q.y)}return new n(b,e,c-b,h-e)},a.prototype.buildSDF=function(a){a=this._extractGeometry(a);if(!a)return null;var b=this._getEnvelope(a);if(0>=b.width||0>=b.height)return null;for(var c=Math.floor(31.5),
e=(128-2*(c+0+1))/Math.max(b.width,b.height),h=Math.round(b.width*e),f=Math.round(b.height*e),k=h+2*c,p=f+2*c,n=0;n<a.length;n++)for(var q=0,r=a[n];q<r.length;q++){var u=r[q];u.x-=b.x;u.y-=b.y;u.x*=e;u.y*=e;u.x+=c-.5;u.y+=c-.5}b=this._dist_map(a,k,p,c);return this._sign_dist_map(a,k,p,c,b),[this._encodeDistMap(b,c),k,p,h,f,e]},a.prototype._dist_map=function(a,d,c,e){for(var b=d*c,f=new Float32Array(b),g=e*e+1,h=0;b>h;++h)f[h]=g;for(g=0;g<a.length;g++)for(var k=a[g],m=k.length,h=1;m>h;++h){var n=k[h-
1],q=k[h],r=void 0,u=void 0;n.x<q.x?(r=n.x,u=q.x):(r=q.x,u=n.x);var A=void 0,D=void 0;n.y<q.y?(A=n.y,D=q.y):(A=q.y,D=n.y);var x=Math.floor(r)-e,u=Math.floor(u)+e,A=Math.floor(A)-e,D=Math.floor(D)+e;0>x&&(x=0);u>d&&(u=d);0>A&&(A=0);D>c&&(D=c);for(var r=q.x-n.x,J=q.y-n.y,G=r*r+J*J;u>x;x++)for(var B=A;D>B;B++){var E=(x-n.x)*r+(B-n.y)*J,C=void 0,F=void 0;0>E?(C=n.x,F=n.y):E>G?(C=q.x,F=q.y):(E/=G,C=n.x+E*r,F=n.y+E*J);E=(x-C)*(x-C)+(B-F)*(B-F);C=(c-B-1)*d+x;E<f[C]&&(f[C]=E)}}for(h=0;b>h;++h)f[h]=Math.sqrt(f[h]);
return f},a.prototype._sign_dist_map=function(a,d,c,e,h){for(var b=0;b<a.length;b++)for(var g=a[b],k=g.length,l=1;k>l;++l){var m=g[l-1],n=g[l],q=void 0,r=void 0;m.x<n.x?(q=m.x,r=n.x):(q=n.x,r=m.x);var u=void 0,A=void 0;m.y<n.y?(u=m.y,A=n.y):(u=n.y,A=m.y);q=Math.floor(q);r=Math.floor(r)+1;u=Math.floor(u);A=Math.floor(A)+1;e>q&&(q=e);r>d-e&&(r=d-e);e>u&&(u=e);for(A>c-e&&(A=c-e);A>u;++u)if(m.y>u!=n.y>u){for(var D=(c-u-1)*d,x=q;r>x;++x)x<(n.x-m.x)*(u-m.y)/(n.y-m.y)+m.x&&(h[D+x]=-h[D+x]);for(x=e;q>x;++x)h[D+
x]=-h[D+x]}}},a.prototype._encodeDistMap=function(a,d){d*=2;for(var b=a.length,c=new Uint8Array(4*b),e=0;b>e;++e)h(.5-a[e]/d,c,4*e);return c},a}();q.SDFHelper=u})},"esri/views/2d/engine/webgl/GlyphSource":function(){define(["require","exports","../../../../core/promiseUtils","../../../../request","../../../../core/pbf"],function(u,q,r,n,k){var h=function(){function c(a){this._metrics=[];for(this._bitmaps=[];a.next();)switch(a.tag()){case 1:for(var b=a.getMessage();b.next();)switch(b.tag()){case 3:for(var d=
b.getMessage(),c=void 0,e=void 0,h=void 0,f=void 0,k=void 0,n=void 0,q=void 0;d.next();)switch(d.tag()){case 1:c=d.getUInt32();break;case 2:e=d.getBytes();break;case 3:h=d.getUInt32();break;case 4:f=d.getUInt32();break;case 5:k=d.getSInt32();break;case 6:n=d.getSInt32();break;case 7:q=d.getUInt32();break;default:d.skip()}c&&(this._metrics[c]={width:h,height:f,left:k,top:n,advance:q},this._bitmaps[c]=e);break;default:b.skip()}break;default:a.skip()}}return c.prototype.getMetrics=function(a){return this._metrics[a]},
c.prototype.getBitmap=function(a){return this._bitmaps[a]},c}(),e=function(){function c(){this._ranges=[]}return c.prototype.getRange=function(a){return this._ranges[a]},c.prototype.addRange=function(a,b){this._ranges[a]=b},c}();return function(){function c(a){this._glyphInfo={};this._baseURL=a}return c.prototype.getRange=function(a,b){var c=this._getFontStack(a);if(c.getRange(b))return r.resolve();var e=256*b,m=e+255;a=this._baseURL.replace("{fontstack}",a).replace("{range}",e+"-"+m);return n(a,
{callbackParamName:"callback",responseType:"array-buffer"}).then(function(a){c.addRange(b,new h(new k(new Uint8Array(a.data),new DataView(a.data))))})},c.prototype.getGlyph=function(a,b){if(a=this._getFontStack(a)){var c=Math.floor(b/256);if(!(256<c)&&(a=a.getRange(c)))return{metrics:a.getMetrics(b),bitmap:a.getBitmap(b)}}},c.prototype._getFontStack=function(a){var b=this._glyphInfo[a];return b||(b=this._glyphInfo[a]=new e),b},c}()})},"esri/views/2d/engine/webgl/GlyphMosaic":function(){define("require exports dojo/promise/all dojo/has ../../../webgl/Texture ./Rect ./RectangleBinPack".split(" "),
function(u,q,r,n,k,h,e){var c;n("stable-symbol-rendering")&&(c=new Set);return function(){function a(a,c,g){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;(0>=a||0>=c)&&console.error("Glyph mosaic width and height must be greater than zero!");this.width=a;this.height=c;this._glyphSource=g;this._binPack=new e(a-4,c-4);this._glyphData.push(new Uint8Array(a*c));this._dirties.push(!0);this._textures.push(void 0)}
return a.prototype.getGlyphItems=function(a,d){var b=this,k=[],l=this._glyphSource,f=new Set;a=1/256;for(var q=0;q<d.length;q++)f.add(Math.floor(d[q]*a));var p=[];return f.forEach(function(a){if(256>=a){var c="Arial Regular"+a;b._rangePromises.has(c)?p.push(b._rangePromises.get(c)):(a=l.getRange("Arial Regular",a).always(function(){b._rangePromises["delete"](c)}),b._rangePromises.set(c,a),p.push(a))}}),r(p).then(function(a){(a=b._glyphIndex["Arial Regular"])||(a={},b._glyphIndex["Arial Regular"]=
a);var g;if(n("stable-symbol-rendering")){c.clear();for(var m=0;m<d.length;m++)g=d[m],c.add(g);var p=[];f.forEach(function(a){p.push(a)});p.sort();g=[];for(m=0;m<p.length;m++)for(var q=p[m],r=0;256>r;++r)g.push(256*q+r)}else g=d;m=0;for(q=g;m<q.length;m++)if(g=q[m],r=a[g])n("stable-symbol-rendering")&&!c.has(g)||(k[g]={rect:r.rect,metrics:r.metrics,page:r.page});else{var u=l.getGlyph("Arial Regular",g);if(u&&u.metrics){var r=u.metrics,t=void 0;if(0===r.width)t=new h(0,0,0,0);else{var x=r.width+6,
v=r.height+6,G=x%4?4-x%4:4,B=v%4?4-v%4:4;1===G&&(G=5);1===B&&(B=5);t=b._binPack.allocate(x+G,v+B);t.isEmpty&&(b._dirties[b._currentPage]||(b._glyphData[b._currentPage]=null),b._currentPage=b._glyphData.length,b._glyphData.push(new Uint8Array(b.width*b.height)),b._dirties.push(!0),b._textures.push(void 0),b._binPack=new e(b.width-4,b.height-4),t=b._binPack.allocate(x+G,v+B));var G=b._glyphData[b._currentPage],u=u.bitmap,E=B=void 0;if(u)for(var C=0;v>C;C++)for(var B=x*C,E=b.width*(t.y+C+1)+t.x,F=0;x>
F;F++)G[E+F+1]=u[B+F]}a[g]={rect:t,metrics:r,tileIDs:null,page:b._currentPage};n("stable-symbol-rendering")&&!c.has(g)||(k[g]={rect:t,metrics:r,page:b._currentPage});b._dirties[b._currentPage]=!0}}return k})},a.prototype.bind=function(a,c,e,h){this._textures[e]||(this._textures[e]=new k(a,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var b=this._textures[e];b.setSamplingMode(c);this._dirties[e]&&b.setData(this._glyphData[e]);a.bindTexture(b,
h);this._dirties[e]=!1},a.prototype.dispose=function(){this._binPack=null;for(var a=0,c=this._textures;a<c.length;a++){var e=c[a];e&&e.dispose()}this._textures.length=0},a}()})},"*noref":1}});
define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/accessorSupport/decorators ../../../../core/HandleRegistry ../../../../core/promiseUtils ../../../../core/Logger ../../../../Graphic ../../../../layers/support/TileInfo ../../../../renderers/support/diffUtils ../../engine/StageGL ../../engine/webgl/rendererInfoUtils ../../engine/webgl/visualVariablesUtils ../../engine/webgl/TileHandler ../../engine/webgl/WGLTile ../../engine/webgl/WGLFeatureView ../../tiling/TileQueue ../../tiling/TileInfoView ../../tiling/TileStrategy ../LayerView2D".split(" "),function(u,
q,r,n,k,h,e,c,a,b,d,g,m,l,f,t,p,v,w,H,I,y){var z=a.getLogger("esri.views.2d.layers.FeatureLayerView2D");return function(a){function k(){var b=null!==a&&a.apply(this,arguments)||this;return b._tileRequests=new Map,b._hasVV=!1,b._handles=new e,b._wglFeatureView=new v(512,512,b),b.container=new m,b}return r(k,a),k.prototype.initialize=function(){this._tileHandler=new t(this,this._wglFeatureView,512,512,1,1);this.addResolvingPromise(this._tileHandler.start())},k.prototype.destroy=function(){this._tileHandler.stop();
this._tileHandler=null},Object.defineProperty(k.prototype,"numFeatures",{get:function(){var a=0;return this.attached?this._tileStrategy.tiles.forEach(function(b){a+=b.iconDisplayRecords?b.iconDisplayRecords.length:0}):0,a},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"visualVariablesInfo",{get:function(){return this._visualVariablesInfo},enumerable:!0,configurable:!0}),k.prototype.highlight=function(a){var b=this._wglFeatureView;return b.addHighlight(a),{remove:function(){b.removeHighlight(a)}}},
k.prototype.hitTest=function(a,d){var e=this;return this.suspended?c.resolve(null):this._wglFeatureView.hitTest(a,d).then(function(a){return 0===a.length?null:e._tileHandler.getFeatures(a).then(function(a){if(0===a.features.length)return null;a=b.fromJSON(a.features[0]);return a.layer=e.layer,a.geometry.spatialReference=e.view.spatialReference,a})})},k.prototype.update=function(a){this._configurationPromise||this._fetchQueue&&(this._fetchQueue.pause(),this._fetchQueue.state=a.state,this._tileStrategy.update(a),
this._fetchQueue.resume(),this.notifyChange("numFeatures"),this.notifyChange("updating"))},k.prototype.attach=function(){var a=this,b=this._tileInfo=d.create({spatialReference:this.view.spatialReference,size:512});this._tileInfoView=new H(b);this._wglFeatureView.highlightOptions=this.view.highlightOptions;this._wglFeatureView.initialize(this._tileInfoView);this._configure(this.layer.renderer);this._normalizedRenderer=l.getNormalizedRenderer(this.layer.renderer,this.view.spatialReference);this._visualVariablesInfo=
f.convertVisualVariables(this._normalizedRenderer.visualVariables);this._handles.add(this.layer.watch("renderer",function(b){return a._rendererChangeHhandler(b)}));this._handles.add(this.layer.watch("definitionExpression, processing, outFields",function(b,c,d){"outFields"!==d?a.refresh():b.sort().join()!==c.sort().join()&&a.refresh()}))},k.prototype.detach=function(){this.container.removeChild(this._wglFeatureView);this._tileHandler.stop();this._tileStrategy.destroy();this._tileStrategy=null;this._handles.removeAll()},
k.prototype.moveStart=function(){this.requestUpdate()},k.prototype.viewChange=function(){this.requestUpdate()},k.prototype.moveEnd=function(){this.requestUpdate()},k.prototype.isUpdating=function(){return this._fetchQueue&&0!==this._fetchQueue.length},k.prototype.refresh=function(){var a=this;this._configure(this.layer.renderer).then(function(){a._fetchQueue.resume();a._wglFeatureView.requestRender();a.requestUpdate()})},k.prototype.acquireTile=function(a){var b=this,c=this._tileInfoView.getTileBounds([0,
0,0,0],a),d=p.pool.acquire(a,c,512,512,512);a=this._fetchQueue.push(d.key).then(function(a){a&&d.setData(a,b._hasVV,!1);b._wglFeatureView.addChild(d);d.once("attach",function(){b.notifyChange("updating");b.requestUpdate()});b.notifyChange("updating")}).otherwise(function(a){"cancel"!==a.dojoType&&z.error("query-error",a)});return this._tileRequests.set(d.key.id,a),this.notifyChange("updating"),d},k.prototype.releaseTile=function(a){var b=this,c=a.key.id,d=this._tileRequests.get(c);d&&(d.isFulfilled()||
d.cancel(),this._tileRequests["delete"](c),this._wglFeatureView.removeChild(a),this.requestUpdate(),a.once("detach",function(){b._tileHandler.removeTile(a.key);p.pool.release(a)}),this.notifyChange("updating"))},k.prototype._configure=function(a){var b=this;return this._configurationPromise&&(this._configurationPromise.cancel(),this._configurationPromise=null),this._fetchQueue&&(this._fetchQueue.pause(),this._fetchQueue.clear(),this._tileStrategy.clear()),this._configurationPromise=this._tileHandler.configure(this.layer.renderer,
this.layer.processing).then(function(){b._fetchQueue||(b._fetchQueue=new w({tileInfoView:b._tileInfoView,concurrency:50,process:function(a){return b._tileHandler.registerTile(a)}}),b._tileStrategy=new I({cachePolicy:"purge",acquireTile:function(a){return b.acquireTile(a)},releaseTile:function(a){return b.releaseTile(a)},tileInfoView:b._tileInfoView}),b.container.addChild(b._wglFeatureView));b.requestUpdate()}).always(function(){b._configurationPromise=null}),this._configurationPromise},k.prototype._applyRendererDiff=
function(a,b){var c;a:{for(c in a.diff){var d=a.diff[c];if("collection"===d.type){if(0!==d.changed.length||0!==d.added.length||0!==d.removed.length){c=!0;break a}}else if("visualVariables"!==c&&"authoringInfo"!==c){c=!0;break a}}c=!1}if(c)return!1;if(a.diff.visualVariables){a=b.vvRanges;b=g.diff(this._visualVariablesInfo.vvFields,b.vvFields);if(this._visualVariablesInfo.vvRanges=a,b)return!1;this._wglFeatureView.requestRender()}return!0},k.prototype._rendererChangeHhandler=function(a){a=l.getNormalizedRenderer(a,
this.view.spatialReference);var b=g.diff(this._normalizedRenderer,a);if(b)if("complete"===b.type)this._normalizedRenderer=a,this._visualVariablesInfo=f.convertVisualVariables(a.visualVariables),this.refresh();else if("partial"===b.type){var c=f.convertVisualVariables(a.visualVariables);this._applyRendererDiff(b,c)||(this._normalizedRenderer=a,this._visualVariablesInfo=c,this.refresh())}},n([h.property()],k.prototype,"numFeatures",null),k=n([h.subclass("esri.views.2d.layers.FeatureLayerView2DWebGL")],
k)}(h.declared(y))});