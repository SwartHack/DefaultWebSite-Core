//>>built
define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../core/Collection ../../../../core/HandleRegistry ../../../../core/promiseUtils ../../../../core/Logger ../../../../renderers/support/renderingInfoUtils ../../../../Graphic ../../../layers/GraphicsView ../../engine/graphics/GFXSurface ../../engine/graphics/GFXGroup ../../engine/graphics/GFXObject ../../../../symbols/Symbol3D".split(" "),
function(z,A,r,g,f,t,u,k,v,l,w,x,y,m,h,n){var p=v.getLogger("esri.views.2d.layers.support.FeaturesView2D");return function(q){function d(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];var a=q.apply(this,b)||this;return a._handles=new u,a._backgroundGroup=new m,a._frontGroup=new m,a._frontObjects=new Map,a._backgroundObjects=new Map,a._scale=0,a.container=new y,a.layer=null,a.container.addChild(a._backgroundGroup),a.container.addChild(a._frontGroup),a.watch("graphics",function(){return a._reset()}),
a.watch("renderer",function(){return a._resymbolize()}),a.watch("mapView.scale, mapView.stationary",function(){return a._applyScale()}),a}return r(d,q),d.prototype.destroy=function(){this.renderer=this.graphics=null},d.prototype.hitTest=function(b,c){b+=this.mapView.position[0]-window.pageXOffset;c+=this.mapView.position[1]-window.pageYOffset;return(b=this.container.hitTest(b,c))?k.resolve(b.graphic):k.resolve()},d.prototype._reset=function(){var b=this;this._handles.remove("graphics");this.graphics&&
(this.graphics.forEach(this._add,this),this._handles.add(this.graphics.on("change",function(c){return b._graphicsChangeHandler(c)}),"graphics"))},d.prototype._applyScale=function(){var b=this.get("mapView.scale"),c=this.get("mapView.stationary");b!==this._scale&&c&&(this._scale=b,this._resymbolize())},d.prototype._resymbolize=function(){var b=this;this.graphics&&this.graphics.forEach(function(c){return b._resymbolizeGraphic(c)})},d.prototype._add=function(b){if(!this._frontObjects.has(b)){var c=l.getRenderingInfo(b,
{renderer:this.renderer,viewingMode:"map",scale:this.mapView.state.scale,resolution:this.mapView.state.resolution,spatialReference:this.mapView.spatialReference});if(c){if(c.symbol instanceof n)return void p.error("3D symbols are not supported with MapView");var a=new h;a.graphic=b;a.renderingInfo=c;this._frontObjects.set(b,a);this._frontGroup.addChild(a);var d=c.renderer&&c.renderer.backgroundFillSymbol;d&&a.isPolygonMarkerSymbol&&(a=new h,a.graphic=b,null!=c.outlineSize?a.renderingInfo={symbol:d,
size:[c.outlineSize,c.outlineSize,c.outlineSize]}:a.renderingInfo={symbol:d},this._backgroundObjects.set(b,a),this._backgroundGroup.addChild(a))}}},d.prototype._remove=function(b){var c=this._frontObjects.get(b);c&&(this._frontObjects["delete"](b),this._frontGroup.removeChild(c),this._backgroundObjects.has(b))&&(c=this._backgroundObjects.get(b),this._backgroundObjects["delete"](b),this._backgroundGroup.removeChild(c))},d.prototype._resymbolizeGraphic=function(b){if(this._frontObjects.has(b)){var c=
l.getRenderingInfo(b,{renderer:this.renderer,viewingMode:"map",scale:this.mapView.state.scale,resolution:this.mapView.state.resolution,spatialReference:this.mapView.spatialReference});if(c){if(c.symbol instanceof n)return void p.error("3D symbols are not supported with MapView");var a=this._frontObjects.get(b);a&&(a.renderingInfo=c);var d=c.renderer&&c.renderer.backgroundFillSymbol,e=this._backgroundObjects.get(b);d&&a.isPolygonMarkerSymbol?(e||(e=new h,e.graphic=b,this._backgroundObjects.set(b,e),
this._backgroundGroup.addChild(e)),null!=c.outlineSize?e.renderingInfo={symbol:d,size:[c.outlineSize,c.outlineSize,c.outlineSize]}:e.renderingInfo={symbol:d}):!d&&e&&(this._backgroundObjects["delete"](b),this._backgroundGroup.removeChild(e))}}},d.prototype._graphicsChangeHandler=function(b){for(var c=b.removed,a=0,d=b.added;a<d.length;a++)b=d[a],this._add(b);for(a=0;a<c.length;a++)b=c[a],this._remove(b)},g([f.property()],d.prototype,"container",void 0),g([f.property(),f.cast(t.ofType(w))],d.prototype,
"graphics",void 0),g([f.property()],d.prototype,"layer",void 0),g([f.property()],d.prototype,"mapView",void 0),d=g([f.subclass("esri.views.2d.layers.support.FeaturesView2D")],d)}(f.declared(x))});