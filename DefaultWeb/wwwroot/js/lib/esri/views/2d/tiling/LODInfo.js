//>>built
define(["require","exports","./TileKey","../../../geometry/support/spatialReferenceUtils"],function(u,v,g,t){function r(c,a,b){return c[0]=a,c[1]=b,c}return function(){function c(a,b,c,f,d,e,h,k,l,m,n,q){this.level=a;this.resolution=b;this.scale=c;this.origin=f;this.first=d;this.last=e;this.size=h;this.norm=k;this.worldStart=l;this.worldEnd=m;this.worldSize=n;this.wrap=q}return c.create=function(a,b,p){var f=t.getInfo(a.spatialReference),d=[a.origin.x,a.origin.y],e=[a.size[0]*b.resolution,a.size[1]*
b.resolution],h=[-(1/0),-(1/0)],k=[+(1/0),+(1/0)],l=[+(1/0),+(1/0)];p&&(r(h,Math.max(0,Math.floor((p.xmin-d[0])/e[0])),Math.max(0,Math.floor((d[1]-p.ymax)/e[1]))),r(k,Math.max(0,Math.floor((p.xmax-d[0])/e[0])),Math.max(0,Math.floor((d[1]-p.ymin)/e[1]))),r(l,k[0]-h[0]+1,k[1]-h[1]+1));var m,n,q,g;return a.isWrappable?(m=[Math.ceil(Math.round(2*f.origin[1]/b.resolution)/a.size[0]),l[1]],n=[Math.floor((f.origin[0]-d[0])/e[0]),h[1]],q=[m[0]+n[0]-1,k[1]],g=!0):(n=h,q=k,m=l,g=!1),new c(b.level,b.resolution,
b.scale,d,h,k,l,e,n,q,m,g)},c.prototype.normalizeCol=function(a){if(!this.wrap)return a;var b=this.worldSize[0];return 0>a?b-1-Math.abs((a+1)%b):a%b},c.prototype.denormalizeCol=function(a,b){return this.wrap?this.worldSize[0]*b+a:a},c.prototype.getWorldForColumn=function(a){return this.wrap?Math.floor(a/this.worldSize[0]):0},c.prototype.getFirstColumnForWorld=function(a){return a*this.worldSize[0]+this.first[0]},c.prototype.getLastColumnForWorld=function(a){return a*this.worldSize[0]+this.first[0]+
this.size[0]-1},c.prototype.getColumnForX=function(a){return(a-this.origin[0])/this.norm[0]},c.prototype.getXForColumn=function(a){return this.origin[0]+a*this.norm[0]},c.prototype.getRowForY=function(a){return(this.origin[1]-a)/this.norm[1]},c.prototype.getYForRow=function(a){return this.origin[1]-a*this.norm[1]},c.prototype.getTileBounds=function(a,b){b=g.pool.acquire(b);var c=this.denormalizeCol(b.col,b.world),f=b.row,d=this.getXForColumn(c),e=this.getYForRow(f+1),c=this.getXForColumn(c+1),f=this.getYForRow(f);
return a[0]=d,a[1]=e,a[2]=c,a[3]=f,g.pool.release(b),a},c.prototype.getTileCoords=function(a,b){b=g.pool.acquire(b);return r(a,this.getXForColumn(this.denormalizeCol(b.col,b.world)),this.getYForRow(b.row)),g.pool.release(b),a},c}()});