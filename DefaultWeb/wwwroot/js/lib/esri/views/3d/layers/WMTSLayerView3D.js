//>>built
define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Error ../../../core/HandleRegistry ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ./TiledLayerView3D".split(" "),function(r,t,k,d,e,l,m,n,f,p,q){var h=n.getLogger("esri.views.3d.layers.WMTSLayerView3d");return function(g){function a(){var b=null!==g&&g.apply(this,arguments)||this;return b._handles=new m,b}return k(a,g),
a.prototype.initialize=function(){var b=this,a=p.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeDone").then(function(){var a=function(){return new l("layerview:no-compatible-tiling-scheme","None of the tiling schemes supported by the service are compatible with the scene.")};if(!b.view.basemapTerrain.tilingSchemeLocked)return f.reject(a());var c,e=b.view.basemapTerrain.tilingScheme,d=b.layer.activeLayer;if(d&&d.tileMatrixSet){if(c=d.tileMatrixSet,a=c.tileInfo,e=b._getTileInfoSupportError(a,c.fullExtent)||
b._getTileInfoCompatibilityError(a,e))return f.reject(e)}else{if(c=b._getCompatibleTileMatrixSet(),!c)return f.reject(a());d.tileMatrixSetId=c.id}b.tileInfo=c.tileInfo;b.fullExtent=c.fullExtent;b._updateMinMaxDataLevel()});this.addResolvingPromise(a);this.when(function(){return b._initialized()})},a.prototype.destroy=function(){this._handles.removeAll()},a.prototype.refresh=function(){this.emit("data-changed")},a.prototype.canResume=function(){if(!this.inherited(arguments))return!1;var b=this.layer.activeLayer.tileMatrixSet;
return b&&!this._getTileInfoError(b.tileInfo,b.fullExtent)},a.prototype._initialized=function(){var b=this;this._handles.add(this.layer.activeLayer.watch("styleId",function(a){b.refresh()}));this._handles.add(this.layer.watch("activeLayer",function(a){var c=a.tileMatrixSet;c?(a=b._getTileInfoError(c.tileInfo,c.fullExtent))&&(h.error("The selected tile matrix set is not compatible with the view",a),c=null):(c=b._getCompatibleTileMatrixSet())?a.tileMatrixSetId=c.id:h.error("The layer does not provide a tiling scheme that is compatible with the view");
b.notifyChange("suspended");b.canResume()&&b.refresh()}))},a.prototype._getCompatibleTileMatrixSet=function(){var b=this;return this.layer.activeLayer.tileMatrixSets.find(function(a){return!b._getTileInfoError(a.tileInfo,a.fullExtent)})},a.prototype._getTileInfoError=function(a,c){return this._getTileInfoSupportError(a,c)||this._getTileInfoCompatibilityError(a,this.view.basemapTerrain.tilingScheme)},d([e.property({aliasOf:"layer.fullExtent"})],a.prototype,"fullExtent",void 0),d([e.property()],a.prototype,
"layer",void 0),d([e.property({aliasOf:"layer.tileInfo"})],a.prototype,"tileInfo",void 0),a=d([e.subclass("esri.views.3d.layers.WMTSLayerView3D")],a)}(e.declared(q))});