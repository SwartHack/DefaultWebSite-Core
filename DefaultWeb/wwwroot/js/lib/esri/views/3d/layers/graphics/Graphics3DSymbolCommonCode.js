//>>built
define("require exports ../../../../geometry/Point ../../../../symbols/callouts/calloutUtils ../../../../geometry/support/coordsUtils ./graphicUtils ../../support/projectionUtils ../../lib/glMatrix ../../webgl-engine/lib/Object3D".split(" "),function(E,e,A,M,F,G,x,H,N){function B(b,a,d,c,f){var g=0,k=a.z||0,h=0,e=d.mode;c=d.calculateOffsetRenderUnits(c);d=d.featureExpressionInfoContext;return"on-the-ground"===e?(h=b.getElevation(a,"ground")||0,g=h,f&&(f.verticalDistanceToGround=0,f.terrainElevation=
h)):"relative-to-ground"===e?(h=b.getElevation(a,"ground")||0,g=c,null==d&&(g+=k),f&&(f.verticalDistanceToGround=g,f.terrainElevation=h),g+=h):"relative-to-scene"===e?(h=b.getElevation(a,"scene")||0,g=c,f&&(f.verticalDistanceToGround=g,f.terrainElevation=h),g+=h):"absolute-height"===e&&(g=c,null==d&&(g+=k),f&&(h=b.getElevation(a,"ground")||0,f.verticalDistanceToGround=g-h,f.terrainElevation=h)),g}function I(b){for(var a=0,d=b.length-1,c=0;d>c;c++)a+=b[c][0]*b[c+1][1]-b[c+1][0]*b[c][1];return 0<=a}
function y(b,a,d,c,f,g){c*=3;for(var k=0;f>k;++k){var h=b[a++];d[c++]=h[0];d[c++]=h[1];d[c++]=g?h[2]:0}return c/3}function C(b,a){for(var d=b.length,c=Array(d),f=Array(d),g=Array(d),k=0,h=0,e=0,q=0,n=0;d>n;++n)q+=b[n].length;for(var q=new Float64Array(3*q),p=0,t=d-1;0<=t;t--){var l=b[t];if(I(l))c[k++]=l;else{for(var m=l.length,n=0;k>n;++n)m+=c[n].length;n={index:p,pathLengths:Array(k+1),count:m,holeIndices:Array(k)};n.pathLengths[0]=l.length;0<l.length&&(g[e++]={index:p,count:l.length});p=y(l,0,q,
p,l.length,a);for(l=0;k>l;++l)m=c[l],n.holeIndices[l]=p,n.pathLengths[l+1]=m.length,0<m.length&&(g[e++]={index:p,count:m.length}),p=y(m,0,q,p,m.length,a);k=0;0<n.count&&(f[h++]=n)}}for(l=0;k>l;++l)m=c[l],0<m.length&&(g[e++]={index:p,count:m.length}),p=y(m,0,q,p,m.length,a);return d>h&&(f.length=h),d>e&&(g.length=e),{vertexData:q,polygons:f,outlines:g}}function J(b,a,d,c,f){a*=3;c*=3;for(var g=0;f>g;++g)d[c++]=b[a++],d[c++]=b[a++],d[c++]=b[a++]}function D(b,a,d,c,f,g,e){return x.bufferToBuffer(b,d,
a,c,g,f,e)}function z(b,a,d){x.pointToVector(b,a,d)}function K(b,a){return!(b[0]>a[3]||b[0]<a[0]||b[1]>a[4]||b[1]<a[1])}function L(b,a){return!(a[0]>b[3]||a[3]<b[0]||a[1]>b[4]||a[4]<b[1])}Object.defineProperty(e,"__esModule",{value:!0});E=H.mat4d;var r=H.vec3d.create(),O=E.identity(),u=new A({x:0,y:0,z:0,spatialReference:null});e.createStageObjectForPoint=function(b,a,d,c,f,g,e,h,u,q,n){var k=a?a.length:0,t=this._context.clippingExtent;if(z(b,r,this._context.elevationProvider.spatialReference),t&&
!K(r,t))return null;z(b,r,this._context.renderSpatialReference);t=this._context.localOriginFactory.getOrigin(r);e=new N({castShadow:!1,metadata:{layerUid:h,graphicId:u,usesVerticalDistanceToGround:!!q},idHint:e});for(h=0;k>h;h++)e.addGeometry(a[h],d[h],c?c[h]:O,f,t,n);a=this._context.renderSpatialReference;c=this._context.elevationProvider;f=this._context.renderCoordsHelper;var l;d=0;e.metadata.usesVerticalDistanceToGround?(d=B(c,b,g,f,v),G.updateVertexAttributeAuxpos1w(e,v.verticalDistanceToGround),
l=v.terrainElevation):(n="absolute-height"!==g.mode,d=B(c,b,g,f,n?v:null),n&&(l=v.terrainElevation));g=e.getObjectTransformation();r[0]=b.x;r[1]=b.y;r[2]=d;b=(x.computeLinearTransformation(b.spatialReference,r,g,a)?e.setObjectTransformation(g):console.warn("Could not locate symbol object properly, it might be misplaced"),{terrainElevation:l});return{object:e,terrainElevation:b.terrainElevation}};e.extendPointGraphicElevationContext=function(b,a,d){b=b.elevationContext;d=d.spatialReference;z(a,r,d);
b.centerPointInElevationSR=new A({x:r[0],y:r[1],z:a.hasZ?r[2]:0,spatialReference:d})};e.placePointOnPolyline=function(b){var a=b.paths[0];if(!a||0===a.length)return null;a=F.getPointOnPath(a,F.getPathLength(a)/2);return new A({x:a[0],y:a[1],z:a[2],spatialReference:b.spatialReference})};e.placePointOnPolygon=function(b){return G.computeCentroid(b)};e.computeElevation=B;e.getSingleSizeDriver=function(b,a){return void 0===a&&(a=0),isFinite(b[a])?b[a]:null};e.isCounterClockwise=I;e.copyPointData=y;e.copyPathData=
C;e.copyVertices=J;e.chooseOrigin=function(b,a,d,c){a=Math.floor(a+(d-1)/2);c[0]=b[3*a+0];c[1]=b[3*a+1];c[2]=b[3*a+2]};e.subtractCoordinates=function(b,a,d,c){a*=3;for(var f=0;d>f;++f)b[a++]-=c[0],b[a++]-=c[1],b[a++]-=c[2]};e.setZ=function(b,a,d,c){a*=3;for(var f=0;d>f;++f)b[a+2]=c,a+=3};e.offsetZ=function(b,a,d,c){a*=3;for(var f=0;d>f;++f)b[a+2]+=c,a+=3};e.scaleZ=function(b,a,d,c){a*=3;for(var f=0;d>f;++f)b[a+2]*=c,a+=3};e.flatArrayToArrayOfArrays=function(b,a,d){var c=[];a*=3;for(var f=0;d>f;++f)c.push([b[a++],
b[a++],b[a++]]);return c};e.reproject=D;e.reprojectPoint=z;e.getGeometryVertexData3D=function(b,a,d,c,f,e,k){var g=f.spatialReference;b=C(b,a);a=b.vertexData;var r=a.length/3,q=new Float64Array(a.length),n=!0;d.equals(g)?J(a,0,q,0,a.length):n=D(a,0,d,q,0,g,r);var p=0,t=0,l=k.mode,m=0,w=0;d=0;e=k.calculateOffsetRenderUnits(e);k=k.featureExpressionInfoContext;u.spatialReference=f.spatialReference;for(var p=3*p,t=3*t,v=0;r>v;++v)u.x=q[p+0],u.y=q[p+1],u.z=q[p+2],"on-the-ground"===l?(m=f.getElevation(u)||
0,w=m,d+=m):"relative-to-ground"===l?(m=f.getElevation(u)||0,w=m+e,null==k&&(w+=u.z),d+=m):"relative-to-scene"===l?(m=f.getElevation(u,"scene")||0,w=m+e,d+=m):"absolute-height"===l&&(w=e,null==k&&(w+=u.z)),a[t+0]=q[p+0],a[t+1]=q[p+1],a[t+2]=w,p+=3,t+=3;f=(d/=r,{terrainElevation:d});return g.equals(c)||D(a,0,g,a,0,c,r),{geometryData:b,vertexData:a,eleVertexData:q,terrainElevation:f.terrainElevation,projectionSuccess:n}};e.getGeometryVertexDataDraped=function(b,a,d){b=C(b,!1);var c=b.vertexData,e=c.length/
3,g=!0;return a.equals(d)||(g=x.bufferToBuffer(c,a,0,c,d,0,e)),{geometryData:b,vertexData:c,projectionSuccess:g}};e.computeBoundingBox=function(b,a,d,c){c[0]=Number.MAX_VALUE;c[1]=Number.MAX_VALUE;c[2]=Number.MAX_VALUE;c[3]=-Number.MAX_VALUE;c[4]=-Number.MAX_VALUE;c[5]=-Number.MAX_VALUE;a*=3;for(var e=0;d>e;++e){var g=b[a++],k=b[a++],h=b[a++];g<c[0]&&(c[0]=g);k<c[1]&&(c[1]=k);h<c[2]&&(c[2]=h);g>c[3]&&(c[3]=g);k>c[4]&&(c[4]=k);h>c[5]&&(c[5]=h)}return c};e.pointInBox2D=K;e.boxesIntersect2D=L;e.boundingBoxClipped=
function(b,a){return a?!L(b,a):!1};e.needsElevationUpdates2D=function(b){return"relative-to-ground"===b||"relative-to-scene"===b};e.needsElevationUpdates3D=function(b){return"absolute-height"!==b};e.needsOffsetAdjustment=function(b,a,d,c){if(!1===a.needsOffsetAdjustment||!1===a.supportsOffsetAdjustment||"on-the-ground"===b.mode)return!1;if(0===b.meterUnitOffset){if(!0===a.needsOffsetAdjustment)return!0;if(M.isCalloutSupport(c)&&c.hasVisibleVerticalOffset())return!1;if("relative-to-ground"===b.mode&&
(!d.hasZ||b.featureExpressionInfoContext)||"relative-to-scene"===b.mode)return!0}return!1};var v={verticalDistanceToGround:0,terrainElevation:0}});