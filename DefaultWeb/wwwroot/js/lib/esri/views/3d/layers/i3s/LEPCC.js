//>>built
define(["require","exports","../../../../core/Error"],function(D,t,l){function y(a,g,l){return{identifier:String.fromCharCode.apply(null,new Uint8Array(a,l+r.identifierOffset,r.identifierLength)),version:g.getUint16(l+r.versionOffset,k),checksum:g.getUint32(l+r.checksumOffset,k)}}function w(a,g,k){var d=[];g=u(a,g,d);for(var b=[],h=0;h<d.length;h++){b.length=0;g=u(a,g,b);for(var e=0;e<b.length;e++)k.push(b[e]+d[h])}return g}function u(a,g,q){var d=new DataView(a,g),b=d.getUint8(0),h=31&b,e=!!(32&
b),c=(192&b)>>6,b=0;if(0===c)b=d.getUint32(1,k),g+=5;else if(1===c)b=d.getUint16(1,k),g+=3;else{if(2!==c)throw new l("lepcc-decode-error","Bad count type");b=d.getUint8(1);g+=2}if(e)throw new l("lepcc-decode-error","LUT not implemented");a=new Uint8Array(a,g,Math.ceil(b*h/8));for(var c=e=d=0,f=-1>>>32-h,r=0;b>r;r++){for(;h>e;)d|=a[c]<<e,e+=8,c+=1;q[r]=d&f;d>>>=h;e-=h;32<e+h&&(d|=a[c-1]>>8-e)}return g+c}Object.defineProperty(t,"__esModule",{value:!0});var k=!0,r={identifierOffset:0,identifierLength:10,
versionOffset:10,checksumOffset:12,byteCount:16};t.decodeXYZ=function(a){var g,q,d,b,h,e,c,f,t,u,z,v,m=new DataView(a,0),n=0;b=y(a,m,n);d=b.identifier;b=b.version;if(n+=r.byteCount,"LEPCC     "!==d)throw new l("lepcc-decode-error","Bad identifier");if(1<b)throw new l("lepcc-decode-error","Unknown version");var p=n;g=m.getUint32(p+0,k);q=m.getUint32(p+4,k);d=m.getFloat64(p+8,k);b=m.getFloat64(p+16,k);h=m.getFloat64(p+24,k);e=m.getFloat64(p+32,k);c=m.getFloat64(p+40,k);f=m.getFloat64(p+48,k);t=m.getFloat64(p+
56,k);u=m.getFloat64(p+64,k);z=m.getFloat64(p+72,k);v=m.getUint32(p+80,k);m.getUint32(p+84,k);n+=88;if(q*Math.pow(2,32)+g!==a.byteLength)throw new l("lepcc-decode-error","Bad size");m=new Float64Array(3*v);g=[];q=[];v=[];p=[];if(n=w(a,n,g),n=w(a,n,q),n=w(a,n,v),n=w(a,n,p),n!==a.byteLength)throw new l("lepcc-decode-error","Bad length");for(var x=n=a=0;x<g.length;x++)for(var n=n+g[x],A=0,B=0;B<q[x];B++){var A=A+v[a],C=p[a];m[3*a]=Math.min(e,d+2*t*A);m[3*a+1]=Math.min(c,b+2*u*n);m[3*a+2]=Math.min(f,
h+2*z*C);a++}return{errorX:t,errorY:u,errorZ:z,result:m}};t.decodeRGB=function(a){var g,q,d,b,h,e,c=new DataView(a,0),f=0;b=y(a,c,f);d=b.identifier;b=b.version;if(f+=r.byteCount,"ClusterRGB"!==d)throw new l("lepcc-decode-error","Bad identifier");if(1<b)throw new l("lepcc-decode-error","Unknown version");e=f;g=c.getUint32(e+0,k);q=c.getUint32(e+4,k);d=c.getUint32(e+8,k);b=c.getUint16(e+12,k);h=c.getUint8(e+14);e=c.getUint8(e+15);f+=16;if(q*Math.pow(2,32)+g!==a.byteLength)throw new l("lepcc-decode-error",
"Bad size");if(2!==h&&1!==h||0!==e){if(0===h&&0===e){if(3*d+f!==a.byteLength||0!==b)throw new l("lepcc-decode-error","Bad count");return(new Uint8Array(a,f)).slice()}if(2>=h&&1===e){if(f+3!==a.byteLength||1!==b)throw new l("lepcc-decode-error","Bad count");a=c.getUint8(f);b=c.getUint8(f+1);g=c.getUint8(f+2);f=new Uint8Array(3*d);for(c=0;c<d;c++)f[3*c]=a,f[3*c+1]=b,f[3*c+2]=g;return f}throw new l("lepcc-decode-error","Bad method "+h+","+e);}if(3*b+d+f!==a.byteLength||256<b)throw new l("lepcc-decode-error",
"Bad count");g=new Uint8Array(a,f,3*b);a=new Uint8Array(a,f+3*b,d);f=new Uint8Array(3*d);for(c=0;c<d;c++)b=a[c],f[3*c]=g[3*b],f[3*c+1]=g[3*b+1],f[3*c+2]=g[3*b+2];return f};t.decodeIntensity=function(a){var g,q,d,b,h,e=new DataView(a,0),c=0;b=y(a,e,c);d=b.identifier;b=b.version;if(c+=r.byteCount,"Intensity "!==d)throw new l("lepcc-decode-error","Bad identifier");if(1<b)throw new l("lepcc-decode-error","Unknown version");var f=c;g=e.getUint32(f+0,k);q=e.getUint32(f+4,k);d=e.getUint32(f+8,k);b=e.getUint16(f+
12,k);h=e.getUint8(f+14);e.getUint8(f+15);c+=16;if(q*Math.pow(2,32)+g!==a.byteLength)throw new l("lepcc-decode-error","Bad size");e=new Uint16Array(d);if(8===h){if(d+c!==a.byteLength)throw new l("lepcc-decode-error","Bad size");h=new Uint8Array(a,c,d)}else if(16===h){if(2*d+c!==a.byteLength)throw new l("lepcc-decode-error","Bad size");h=new Uint16Array(a,c,d)}else if(h=[],u(a,c,h)!==a.byteLength)throw new l("lepcc-decode-error","Bad size");for(a=0;a<d;a++)e[a]=h[a]*b;return e}});