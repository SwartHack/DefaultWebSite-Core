//>>built
define([],function(){function t(a){return new Date((a+.5-n)*p)}function q(a,b){return l(c(a)*f(h)-k(b)*c(h),f(a))}function y(a,b){return C(c(b)*f(h)+f(b)*c(h)*c(a))}function D(a,b,d){return l(c(a),f(a)*c(b)-k(d)*f(b))}function E(a,b,d){return C(c(b)*c(d)+f(b)*f(d)*f(a))}function F(a){return e*(1.9148*c(a)+.02*c(2*a)+3E-4*c(3*a))}function G(a,b){a=e*(357.5291+.98560028*a);var d=F(a);a=a+d+102.9372*e+m;return b||(b={dec:0,ra:0}),b.dec=y(a,0),b.ra=q(a,0),b}function H(a,b,d){return r+a+.0053*c(b)-.0069*
c(2*d)}function I(a){var b=e*(134.963+13.064993*a),d=e*(93.272+13.22935*a);a=e*(218.316+13.176396*a)+6.289*e*c(b);d=5.128*e*c(d);b=385001-20905*f(b);return{ra:q(a,d),dec:y(a,d),dist:b}}var m=Math.PI,c=Math.sin,f=Math.cos,k=Math.tan,C=Math.asin,l=Math.atan2,J=Math.acos,e=m/180,p=864E5,n=2440588,r=2451545,K={dec:0,ra:0},h=23.4397*e,g={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(a,b,d,c){d=e*-d;b*=e;var f=a.valueOf()/p-.5+n-r;a=G(f,K);d=e*(280.16+360.9856235*f)-d-a.ra;
return c||(c={azimuth:0,altitude:0}),c.azimuth=D(d,b,a.dec),c.altitude=E(d,b,a.dec),c}},u=[[-.83,"sunrise","sunset"]];g.addTime=function(a,b,d){u.push([a,b,d])};return g.getTimes=function(a,b,d){function L(a){var b=z,d=A;a=J((c(a)-c(b)*c(d))/(f(b)*f(d)));return H(9E-4+(a+k)/(2*m)+q,v,B)}var h,l,k=e*-d,z=e*b,q=Math.round(a.valueOf()/p-.5+n-r-9E-4-k/(2*m));a=9E-4+(0+k)/(2*m)+q;var v=e*(357.5291+.98560028*a);b=F(v);var B=v+b+102.9372*e+m,A=y(B,0),w=H(a,v,B),x={solarNoon:t(w),nadir:t(w-.5),polarException:g.POLAR_EXCEPTION.NORMAL};
a=0;for(b=u.length;b>a;a+=1)d=u[a],h=L(d[0]*e),l=w-(h-w),x[d[1]]=t(l),x[d[2]]=t(h);return x.polarException=function(a){a=(c(a)-c(z)*c(A))/(f(z)*f(A));return-1>a?g.POLAR_EXCEPTION.MIDNIGHT_SUN:1<a?g.POLAR_EXCEPTION.POLAR_NIGHT:g.POLAR_EXCEPTION.NORMAL}(u[0][0]*e),x},g.getMoonPosition=function(a,b,d){d=e*-d;b*=e;var c=a.valueOf()/p-.5+n-r;a=I(c);d=e*(280.16+360.9856235*c)-d-a.ra;c=E(d,b,a.dec);return c+=.017*e/k(c+10.26*e/(c+5.1*e)),{azimuth:D(d,b,a.dec),altitude:c,distance:a.dist}},g.getMoonFraction=
function(a){var b=a.valueOf()/p-.5+n-r;a=G(b);b=I(b);a=J(c(a.dec)*c(b.dec)+f(a.dec)*f(b.dec)*f(a.ra-b.ra));a=l(149598E3*c(a),b.dist-149598E3*f(a));return(1+f(a))/2},g});