//>>built
define("require exports dojo/_base/lang ../../../geometry/SpatialReference ../../../config ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../../../Camera ../webgl-engine/lib/Camera ../lib/glMatrix ./mathUtils ./earthUtils ./projectionUtils ./cameraUtilsPlanar ./cameraUtilsSpherical ../camera/intersectionUtils".split(" "),function(V,g,N,r,E,t,y,z,O,m,v,w,p,F,G,P){function x(a){return"global"===a.viewingMode?G:F}function H(a,b,c){var d=a.renderSpatialReference,e=m.vec3d.set(b.viewForward,
Q),e=I(a,b.eye,e,b.up,R);a=a.spatialReference||r.WGS84;return p.vectorToVector(b.eye,d,q,a)||(a=r.WGS84,p.vectorToVector(b.eye,d,q,a)),c?(c.position.x=q[0],c.position.y=q[1],c.position.z=q[2],c.position.spatialReference=a,c.heading=e.heading,c.tilt=e.tilt,c.fov=v.rad2deg(b.fov),c):new z(new t(q,a),e.heading,e.tilt,v.rad2deg(b.fov))}function J(a,b,c){var d=a.state.camera,e=d.fovX,d=d.width/2;"global"===a.viewingMode&&null!=c&&(b*=Math.cos(v.deg2rad(c)));b/=a.renderCoordsHelper.unitInMeters;return d/
(E.screenDPI*K/b)/Math.tan(e/2)}function L(a,b,c){var d=a.state.camera;b=E.screenDPI*K/(d.width/2/(b*Math.tan(d.fovX/2)));return"global"===a.viewingMode&&(b/=Math.cos(v.deg2rad(c))),b*=a.renderCoordsHelper.unitInMeters}function M(a,b,c,d,e,f){var l=a.renderSpatialReference;b=A(a,d.heading,d.tilt,b,c,e);return(a=p.vectorToPoint(b.eye,l,a.spatialReference||r.WGS84))?f?(f.position=a,f.heading=b.heading,f.tilt=b.tilt,f.fov=d.fov,f):new z(a,b.heading,b.tilt,d.fov):null}function I(a,b,c,d,e){return x(a).directionToHeadingTilt(b,
c,d,e)}function A(a,b,c,d,e,f){var l=m.vec3d.create(),h=a.renderSpatialReference;if(d)if(d instanceof t){var k=d;if(p.pointToVector(k,l,a.renderSpatialReference),null==k.z&&null!=a.basemapTerrain)k=a.basemapTerrain.getElevation(k),null!=k&&a.renderCoordsHelper.setAltitude(k,l)}else d&&m.vec3d.set(d,l);else m.vec3d.set(a.state.camera.center,l);d&&d instanceof t||(d=p.vectorToPoint(l,h,a.spatialReference||r.WGS84));e=Math.max(e,a.state.constraints.minimumPoiDistance);h=c;c=e;if(!(k=f&&f.noReset))var k=
d,g=a.engineToScreen(a.state.camera.center),n=a.toScreen(k),k=g.x-n.x,g=g.y-n.y,n=a.pointsOfInterest.centerOnSurfaceFrequent.distance,n=Math.log(Math.max(c,n)/Math.min(c,n))/Math.LN2,k=!(Math.sqrt(k*k+g*g)>S*Math.max(a.width,a.height)||n>T&&c>U);k?(h=x(a).eyeTiltToLookAtTilt(l,c,h),h=a.state.constraints.clampTilt(c,h),h=x(a).lookAtTiltToEyeTilt(l,c,h)):(b=0,h=a.state.constraints.tilt(c).min);c=h;h=x(a).eyeForCenterWithHeadingTilt;b=h(l,e,b,c);l={eye:b.eye,up:b.up,center:l,heading:b.heading,tilt:b.tilt};
if(b=!(f&&f.noReset||"global"!==a.viewingMode))b=a.renderCoordsHelper.fromRenderCoords(l.eye,C,a.spatialReference)?a.basemapTerrain&&(a.basemapTerrain.getElevation(C)||0)>C.z-1:!1;return b?(l=a.state.constraints.tilt(e).min,A(a,0,l,d,e,N.mixin({},f,{noReset:!0}))):l}Object.defineProperty(g,"__esModule",{value:!0});var K=39.37,S=5,T=8,U=8E5,q=m.vec3d.create(),B=m.vec3d.create(),Q=m.vec3d.create(),R={heading:0,tilt:0},C=new t,D=new v.Cyclical(-2.0037508342788905E7,2.0037508342788905E7);g.externalToInternal=
function(a,b){var c=a.renderSpatialReference,d=x(a).headingTiltToDirectionUp,e=m.vec3d.create();return p.pointToVector(b.position,e,c)?(c=d(e,b.heading,b.tilt),m.vec3d.add(c.direction,e),a=P.cameraOnContentAlongViewDirection(a,e,c.direction,c.up),a.fov=v.deg2rad(b.fov),a):null};g.internalToExternal=H;g.scaleToDistance=J;g.distanceToScale=L;g.fromCenterScale=function(a,b,c,d,e,f){c=J(a,c,b.latitude);return M(a,b,c,d,e,f)};g.fromCenterDistance=M;g.directionToHeadingTilt=I;g.eyeHeadingTiltForCenterPointAtDistance=
A;g.fromExtent=function(a,b,c,d,e,f){var l;e instanceof z?(f=e,l={noReset:!1}):l=e;var h,k="global"===a.viewingMode;e=a.renderSpatialReference;var g=a.spatialReference||r.WGS84,n=r.WebMercator,m=b.spatialReference||n,q=0;null!=b.zmax&&null!=b.zmin&&(h=(b.zmax+b.zmin)/2,q=b.zmax-b.zmin);if(k){var k=new t(b.xmin,b.ymin,m),u=new t(b.xmax,b.ymax,m);if(k=y.project(k,n),u=y.project(u,n),null===k||null===u)return;b=new t(D.center(k.x,u.x),(u.y+k.y)/2,n);null!=h&&(b.z=h);h=w.getGreatCircleSpanAt(b,k,u);n=
h.lon;m=h.lat;D.diff(k.x,u.x)>D.range/2&&(n+=w.halfEarthCircumference);n=Math.min(n,w.halfEarthCircumference);m=Math.min(m,w.halfEarthCircumference)}else y.canProject(b,g)&&(b=y.project(b,g)),n=b.xmax-b.xmin,m=b.ymax-b.ymin,b=new t({x:b.xmin+.5*n,y:b.ymin+.5*m,z:h,spatialReference:g});h=a.state.camera;c=A(a,c,d,b,Math.max(1/Math.tan(h.fovX/2)*n*.5,1/Math.tan(h.fovY/2)*m*.5,1/Math.tan(h.fov/2)*q*.5)/1,l);return(d=p.vectorToPoint(c.eye,e,g))?(f||(f=new z),f.position=d,f.heading=c.heading,f.tilt=c.tilt,
f.fov=a.camera.fov,f):null};g.toExtent=function(a,b,c,d,e){var f,g=a.renderSpatialReference;if(b||(c||(c=a.state.camera),b=H(a,c,e)),c)f=p.vectorToPoint(c.center,g,a.spatialReference||r.WGS84),e=c.distance;else{if(f=a.toMap(a.screenCenter),!f)return null;e=w.computeCarthesianDistance(b.position,f)}c||(c=a.state.camera);b=2*e*Math.tan(c.fovX/2)*1;c=2*e*Math.tan(c.fovY/2)*1;return"global"===a.viewingMode?G.toExtent(a,f,b,c,d):F.toExtent(a,f,b,c,d)};g.scaleToZoom=function(a,b){return(a=a.basemapTerrain&&
a.basemapTerrain.tilingScheme)?a.levelAtScale(b):void 0};g.zoomToScale=function(a,b){return(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)?a.scaleAtLevel(b):void 0};g.computeScale=function(a,b,c){var d=a.renderSpatialReference;b||(b=a.state.camera);var e,f,g=r.WGS84;return b instanceof O?(p.vectorToVector(b.center,d,B,g),e=B[1],f=b.distance):(e=b.position.latitude,p.pointToVector(b.position,q,d),p.pointToVector(c,B,d),f=m.vec3d.dist(q,B)),L(a,f,e)}});