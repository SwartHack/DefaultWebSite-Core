//>>built
define("require exports ../../../geometry/SpatialReference ../../../geometry/Extent ../../../geometry/support/webMercatorUtils ./mathUtils ./earthUtils ./cameraUtilsInternal ../lib/glMatrix".split(" "),function(J,l,x,F,G,n,B,H,c){function C(d,b,e){var h=c.vec3d.create(),a=c.vec3d.create();return c.vec3d.cross(d,D,r),0===c.vec3d.dot(r,r)&&c.vec3d.cross(d,E,r),c.mat4d.identity(q),c.mat4d.rotate(q,-n.deg2rad(b),d),c.mat4d.rotate(q,-n.deg2rad(e),r),c.vec3d.cross(r,d,a),c.vec3d.normalize(a),c.mat4d.multiplyVec3(q,
a),c.vec3d.normalize(d,h),c.mat4d.multiplyVec3(q,c.vec3d.negate(h)),{direction:h,up:a}}function z(d){var b=d[1];d[1]=-d[2];d[2]=b}function A(d,b){b=C(b,d.heading,d.tilt);return d.up=b.up,d}Object.defineProperty(l,"__esModule",{value:!0});var D=c.vec3d.createFrom(0,0,1),E=c.vec3d.normalize(c.vec3d.createFrom(1,1,1)),I=new n.Cyclical(-180,180),q=c.mat4d.create(),r=c.vec3d.create(),p=c.vec3d.create();l.headingTiltToDirectionUp=C;l.directionToHeadingTilt=function(d,b,e,h){var a=r;return c.vec3d.normalize(d,
a),c.vec3d.cross(a,D,p),0===c.vec3d.dot(p,p)&&c.vec3d.cross(a,E,p),c.vec3d.cross(p,a,p),H.directionToHeadingTilt(b,e,h,a,p)};l.eyeForCenterWithHeadingTilt=function(d,b,e,h){var a={eye:c.vec3d.create(),up:null,tilt:h,heading:e},g=r;g[0]=d[0];g[1]=d[2];g[2]=-d[1];var f;e=n.deg2rad(e);f=n.deg2rad(h);h=Math.sin(e);e=Math.cos(e);var k=Math.sin(f),y=Math.cos(f),m=c.vec3d.length(g);if(1E-8>Math.abs(f))f=b+m;else{var w=m/k,v=n.asin(b/w);f=w*Math.sin(Math.PI-f-v)}var w=k*b,y=y*b,v=e*w,l=f-y,p=l*l,q=b*b*k*
k,k=e*e*q,q=h*h*q,t=g[1]*l,u=k*(k+p-g[1]*g[1]);if(0>u)return c.vec3d.scale(g,f/m,a.eye),a.tilt=0,a;var x=Math.sqrt(u),u=k+p;if(t=0<e?-x+t:x+t,1E-8>Math.abs(u))return 1E-8>m?(a.eye[0]=0,a.eye[1]=0,a.eye[2]=b):c.vec3d.scale(g,f/m,a.eye),a.tilt=0,z(a.eye),A(a,d);a.eye[1]=t/u;u=a.eye[1]*a.eye[1];b=1-u;t=Math.sqrt(b);v=k*u+q-2*v*a.eye[1]*t*l+b*p;return 1E-8>Math.abs(v)?(c.vec3d.scale(g,f/m,a.eye),a.tilt=0,z(a.eye),A(a,d)):(a.eye[0]=(b*(f*g[0]-y*g[0])-w*t*(g[0]*a.eye[1]*e+g[2]*h))/v,a.eye[2]=(b*(f*g[2]-
y*g[2])-w*t*(g[2]*a.eye[1]*e-g[0]*h))/v,c.vec3d.scale(a.eye,f),z(a.eye),A(a,d))};l.lookAtTiltToEyeTilt=function(d,b,e){d=c.vec3d.length(d);b=n.asin(b/(Math.sqrt(b*b+d*d-2*b*d*Math.cos(Math.PI-e))/Math.sin(e)));return n.rad2deg(e-b)};l.eyeTiltToLookAtTilt=function(d,b,e){e=n.deg2rad(e);d=c.vec3d.length(d);return n.asin(b/(d/Math.sin(e)))+e};l.toExtent=function(d,b,e,c,a){function g(a){var b=Math.PI/2;return a=n.cyclical2PI.normalize(a,-b),a>b&&(a=Math.PI-a),a}var f,k,h=b.latitude;b=b.longitude;var m=
B.getLonDeltaForDistance(b,h,e)/2;e=b-m;b+=m;var m=n.deg2rad(h),h=B.earthRadius,m=(1+Math.sin(m))/(1-Math.sin(m)),l=(m+1)*Math.tan(c/h/2);if(f=1.5*Math.PI-2*Math.atan(.5*(l+Math.sqrt(4*m+l*l))),k=f+c/h,f=g(f),k=g(k),f>k)f=k=f;if(f=Math.max(n.rad2deg(f),-90),k=Math.min(n.rad2deg(k),90),b=I.monotonic(e,b),180<b-e)c=(b-e-180)/2,e+=c,b-=c;return a?(a.xmin=e,a.ymin=f,a.xmax=b,a.ymax=k,a.spatialReference=x.WGS84):a=new F(e,f,b,k,x.WGS84),d.spatialReference&&d.spatialReference.isWebMercator&&G.geographicToWebMercator(a,
!1,a),a}});