//>>built
define("../../../geometry/SpatialReference ../../../geometry/Point ./mathUtils ./earthUtils ../lib/glMatrix ../webgl-engine/lib/BufferVectorMath".split(" "),function(w,J,x,D,E,K){var F,l,G,y,A=E.vec3d,z=E.mat4d,L=K.Vec3Compact,d=A.create(),g=A.create(),n=A.create(),m=x.deg2rad(1),t=x.rad2deg(1),H=new w({wkt:'      GEOCCS["Spherical geocentric",        DATUM["Not specified",          SPHEROID["Sphere",'+D.earthRadius+',0]],        PRIMEM["Greenwich",0.0,          AUTHORITY["EPSG","8901"]],        UNIT["m",1.0],        AXIS["Geocentric X",OTHER],        AXIS["Geocentric Y",EAST],        AXIS["Geocentric Z",NORTH]      ]    '}),
I=new w({wkt:'      GEOCCS["WGS 84",        DATUM["WGS_1984",          SPHEROID["WGS 84",6378137,298.257223563,            AUTHORITY["EPSG","7030"]],          AUTHORITY["EPSG","6326"]],        PRIMEM["Greenwich",0,          AUTHORITY["EPSG","8901"]],        UNIT["m",1.0,          AUTHORITY["EPSG","9001"]],        AXIS["Geocentric X",OTHER],        AXIS["Geocentric Y",OTHER],        AXIS["Geocentric Z",NORTH],        AUTHORITY["EPSG","4978"]      ]    '}),h=D.earthRadius,u=function(a){return a===H?
1:a.isWGS84?2:a.isWebMercator?3:a===I?4:0};w=function(a,b,c,e){c[e++]=a[b++];c[e++]=a[b++];c[e]=a[b]};var B=function(a,b,c,e){var f=.4999999*Math.PI,d=m*a[b+1],d=x.clamp(d,-f,f),f=Math.sin(d);c[e++]=m*a[b]*h;c[e++]=h/2*Math.log((1+f)/(1-f));c[e]=a[b+2]},C=function(a,b,c,e){var f=h+a[b+2],d=m*a[b+1];a=m*a[b];b=Math.cos(d);c[e++]=Math.cos(a)*b*f;c[e++]=Math.sin(a)*b*f;c[e]=Math.sin(d)*f},M=[void 0,C,w,B,function(a,b,c,e){var f=m*a[b],d=m*a[b+1];a=a[b+2];b=Math.sin(d);var d=Math.cos(d),k=6378137/Math.sqrt(1-
.006694379990137799*b*b);c[e++]=(k+a)*d*Math.cos(f);c[e++]=(k+a)*d*Math.sin(f);c[e++]=(.9933056200098622*k+a)*b}],v=[void 0,function(a,b,c,e){var f=L.length(a,b),d=x.asin(a[b+2]/f);a=(0<a[b+1]?1:-1)*x.acos(a[b]/(Math.cos(d)*f));c[e++]=t*a;c[e++]=t*d;c[e]=f-h},w,function(a,b,c,e){c[e++]=t*(a[b++]/h);c[e++]=t*(Math.PI/2-2*Math.atan(Math.exp(-1*a[b++]/h)));c[e]=a[b]},function(a,b,c,e){var f,d,k,g,h,m,p,q,r,l,n;l=a[b];h=a[b+1];a=a[b+2];b=Math.abs(a);f=l*l+h*h;d=Math.sqrt(f);k=f+a*a;g=Math.sqrt(k);l=Math.atan2(h,
l);h=a*a/k;m=f/k;f=1.8230912546075456E9/g;k=142.91722289812412-4.557728136518864E9/g;.3<m?(p=b/g*(1+m*(42697.67270715754+f+h*k)/g),n=Math.asin(p),r=p*p,q=Math.sqrt(1-r)):(q=d/g*(1-h*(42840.589930055656-f-m*k)/g),n=Math.acos(q),r=1-q*q,p=Math.sqrt(r));r=1-.006694379990137799*r;f=6378137/Math.sqrt(r);g=.9933056200098622*f;f=d-f*q;k=b-g*p;b=q*f+p*k;p=q*k-p*f;q=p/(g/r+b);n+=q;0>a&&(n=-n);c[e++]=t*l;c[e++]=t*n;c[e]=b+p*q/2}];return{SphericalECEFSpatialReference:H,WGS84ECEFSpatialReference:I,vectorToVector:function(a,
b,c,e){return 2===a.length?(d[0]=a[0],d[1]=a[1],d[2]=0,a=d):a===c&&(A.set(a,d),a=d),this.bufferToBuffer(a,b,0,c,e,0,1)},pointToVector:function(a,b,c){d[0]=a.x;d[1]=a.y;var e=a.z;return d[2]=void 0!==e?e:0,this.bufferToBuffer(d,a.spatialReference,0,b,c,0,1)},vectorToPoint:function(a,b,c,e){var f;return"esri.SpatialReference"===c.declaredClass?(e=c,f=new J({spatialReference:e})):(f=c,e=e||f.spatialReference),this.bufferToBuffer(a,b,0,d,e,0,1)?(f.x=d[0],f.y=d[1],f.z=d[2],f.spatialReference=e,f):null},
xyzToVector:function(a,b,c,e,f,g){return d[0]=a,d[1]=b,d[2]=c,this.bufferToBuffer(d,e,0,f,g,0,1)},bufferToBuffer:function(a,b,c,e,f,d,k){k=k||1;F!==b&&(l=u(b),F=b);G!==f&&(y=u(f),G=f);k=c+3*k;if(l!==y||0===l&&!b.equals(f)){if(!(0<l&&0<y))return!1;if(2!==y){var h=M[y];if(2!==l)for(f=v[l];k>c;c+=3,d+=3)f(a,c,g,0,b.wkid),h(g,0,e,d);else for(;k>c;c+=3,d+=3)h(a,c,e,d)}else for(f=v[l];k>c;c+=3,d+=3)f(a,c,e,d,b.wkid)}else if(e!==a||c!==d)for(;k>c;c++,d++)e[d]=a[c];return!0},computeLinearTransformation:function(a,
b,c,e){var d=u(a),h=u(e);if(d===h&&(0!==d||a.equals(e)))return z.identity(c),z.translate(c,b),!0;if(1===h){if(e=v[d])return e(b,0,g,0,a.wkid),C(g,0,n,0),e=m*g[0],b=m*g[1],a=Math.sin(e),e=Math.cos(e),d=Math.sin(b),b=Math.cos(b),c[0]=-a,c[4]=-d*e,c[8]=b*e,c[12]=n[0],c[1]=e,c[5]=-d*a,c[9]=b*a,c[13]=n[1],c[2]=0,c[6]=b,c[10]=d,c[14]=n[2],c[3]=0,c[7]=0,c[11]=0,c[15]=1,!0}else if(3===h&&(2===d||1===d))return v[d](b,0,g,0,a.wkid),a=m*g[1],B(g,0,n,0),z.identity(c),z.translate(c,n),a=1/Math.cos(a),z.scale(c,
[a,a,1]),!0;return!1},mbsToMbs:function(a,b,c,d){var e=u(b),l=u(d);if(e===l&&(0!==e||b.equals(d)))return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],!0;if(1===l){if(d=v[e])return d(a,0,g,0,b.wkid),C(g,0,c,0),c[3]=a[3],!0}else if(3===l&&(2===e||1===e))return v[e](a,0,g,0,b.wkid),b=m*g[1],(b=Math.abs(b)+Math.asin(a[3]/(h+a[2])),B(g,0,c,0),b>.9999*Math.PI)?c[3]=Number.MAX_VALUE:c[3]=1/Math.cos(b)*a[3],!0;return!1},extentToBoundingBox:function(a,b,c){if(null==a)return!1;var e=!0;return d[0]=null!=a.xmin?
a.xmin:0,d[1]=null!=a.ymin?a.ymin:0,d[2]=null!=a.zmin?a.zmin:0,e=e&&this.bufferToBuffer(d,a.spatialReference,0,b,c,0,1),d[0]=null!=a.xmax?a.xmax:0,d[1]=null!=a.ymax?a.ymax:0,d[2]=null!=a.zmax?a.zmax:0,e=e&&this.bufferToBuffer(d,a.spatialReference,0,b,c,3,1),null==a.xmin&&(b[0]=-(1/0)),null==a.ymin&&(b[1]=-(1/0)),null==a.zmin&&(b[2]=-(1/0)),null==a.xmax&&(b[3]=1/0),null==a.ymax&&(b[4]=1/0),null==a.zmax&&(b[5]=1/0),e},extentToBoundingRect:function(a,b,c){if(null==a)return!1;var e=!0;return d[0]=null!=
a.xmin?a.xmin:0,d[1]=null!=a.ymin?a.ymin:0,d[2]=null!=a.zmin?a.zmin:0,e=e&&this.bufferToBuffer(d,a.spatialReference,0,d,c,0,1),b[0]=d[0],b[1]=d[1],d[0]=null!=a.xmax?a.xmax:0,d[1]=null!=a.ymax?a.ymax:0,d[2]=null!=a.zmax?a.zmax:0,e=e&&this.bufferToBuffer(d,a.spatialReference,0,d,c,0,1),b[2]=d[0],b[3]=d[1],null==a.xmin&&(b[0]=-(1/0)),null==a.ymin&&(b[1]=-(1/0)),null==a.xmax&&(b[2]=1/0),null==a.ymax&&(b[3]=1/0),e},webMercator:{x2lon:function(a){return a/h},y2lat:function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*
a/h))},lon2x:function(a){return a*h},lat2y:function(a){a=Math.sin(a);return h/2*Math.log((1+a)/(1-a))}}}});