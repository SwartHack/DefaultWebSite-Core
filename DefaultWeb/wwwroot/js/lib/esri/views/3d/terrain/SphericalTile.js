//>>built
define("./TileBase ./TileGeometryFactory ../../../core/ObjectPool ../support/mathUtils ../support/earthUtils ../lib/glMatrix".split(" "),function(h,l,m,n,c,p){var f=p.vec3d,g=c.earthRadius,k=function(a,d,b,e){b=g+b;var c=Math.cos(a);e[0]=Math.cos(d)*c*b;e[1]=Math.sin(d)*c*b;e[2]=Math.sin(a)*b};c=function(a,d,b,e){h.call(this);this.tileUp=f.create();this.obb=Array(8);this._isWebMercator=!1;for(var c=0;8>c;c++)this.obb[c]=f.create();void 0!==a&&this.init(a,d,b,e)};return c.prototype=new h,c.prototype.constructor=
c,c.prototype.init=function(a,d,b,e){h.prototype.init.call(this,a,d,b,e);this._isWebMercator=e.spatialReference.isWebMercator;d=this.extentWGS84Rad[0];b=this.extentWGS84Rad[1];e=this.extentWGS84Rad[2];var c=this.extentWGS84Rad[3];a=a[0];var l=n.lerp(b,c,.5),m=n.lerp(d,e,.5);this.edgeLen=(e-d)*Math.cos(0===a?0:Math.min(Math.abs(b),Math.abs(c)))*g;this.curvatureHeight=g-Math.sqrt(g*g-this.edgeLen*this.edgeLen/4);k(l,m,0,this.centerAtSeaLevel);f.set(this.centerAtSeaLevel,this.tileUp);f.normalize(this.tileUp);
this._updateOBB();this.updateRadiusAndCenter()},c.prototype.isVisible=function(a,d){if(!this.intersectsClippingArea)return!1;if(9<this.lij[0]){d=this.obb;for(var b=0;6>b;b++){for(var c=0;8>c&&!(0>a[b][0]*d[c][0]+a[b][1]*d[c][1]+a[b][2]*d[c][2]+a[b][3]);c++);if(8===c)return!1}}else if(d=this.radius,b=this.center,a[0][0]*b[0]+a[0][1]*b[1]+a[0][2]*b[2]+a[0][3]>d||a[1][0]*b[0]+a[1][1]*b[1]+a[1][2]*b[2]+a[1][3]>d||a[2][0]*b[0]+a[2][1]*b[1]+a[2][2]*b[2]+a[2][3]>d||a[3][0]*b[0]+a[3][1]*b[1]+a[3][2]*b[2]+
a[3][3]>d||a[4][0]*b[0]+a[4][1]*b[1]+a[4][2]*b[2]+a[4][3]>d||a[5][0]*b[0]+a[5][1]*b[1]+a[5][2]*b[2]+a[5][3]>d)return!1;return!0},c.prototype.computeElevationBounds=function(){h.prototype.computeElevationBounds.call(this);this._updateOBB()},c.prototype.updateRadiusAndCenter=function(){if(0===this.lij[0])f.set3(0,0,0,this.center),this.radius=g+this.elevationBounds[1];else{h.prototype.updateRadiusAndCenter.call(this);var a=Math.max(f.dist2(this.center,this.obb[0]),f.dist2(this.center,this.obb[1]));this.radius=
Math.sqrt(a)}},c.prototype._numSubdivisionsAtLevel=[128,64,32,16,16,8,8,4],c.prototype.createGeometry=function(a,d,b){var c=this._isPole(this.lij[1],this.lij[0]);return a.needsUpdate=!1,l.createSphericalGlobeTile(a.numVertsPerRow,this.extent,this.extentWGS84Rad,this._isWebMercator,a.samplerData,d,c,b)},c.prototype._updateOBB=function(){var a,c=this.extentWGS84Rad,b=this.obb;for(a=0;2>a;a++){var e=this.elevationBounds[a],h=4*a;k(c[1],c[0],e,b[h++]);k(c[3],c[0],e,b[h++]);k(c[3],c[2],e,b[h++]);k(c[1],
c[2],e,b[h++])}this._isWebMercator&&(a=this._isPole(this.lij[1],this.lij[0]),2===a?(f.set3(0,0,g,b[1]),f.set3(0,0,g,b[2]),f.set3(0,0,g,b[5]),f.set3(0,0,g,b[6])):1===a&&(f.set3(0,0,-g,b[0]),f.set3(0,0,-g,b[3]),f.set3(0,0,-g,b[4]),f.set3(0,0,-g,b[7])))},c.prototype._isPole=function(a,c){var b=0;return a===(1<<c)-1&&(b+=1),0===a&&(b+=2),b},c.Pool=new m(c),c});