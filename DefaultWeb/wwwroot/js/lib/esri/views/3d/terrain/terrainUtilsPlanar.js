//>>built
define("require exports ./TilingScheme ./TerrainConst ../../../core/Error ../support/aaBoundingRect ../lib/glMatrix".split(" "),function(x,k,q,r,p,n,v){function l(a,b,e,c){f.set(e,m);m[c]=b[c];c=f.subtract(m,b);var d=f.subtract(a,b,w),d=f.dot(d,c),t=f.dot(c,c);b=0>=d?b:d>=t?e:f.add(b,f.scale(c,d/t),m);a=f.subtract(a,b,m);return Math.PI/2-Math.atan(a[2]/Math.sqrt(a[0]*a[0]+a[1]*a[1]))}function u(a,b){var e=a.getElevationBounds();a=a.extent;e=.5*(e[0]+e[1]);h[0]=a[0];h[1]=a[1];h[2]=e;g[0]=a[2];g[1]=
a[3];g[2]=e;e=1/0;a=1/0;return b[0]<h[0]?e=l(b,h,g,0):b[0]>g[0]&&(e=l(b,g,h,0)),b[1]<h[1]?a=l(b,h,g,1):b[1]>g[1]&&(a=l(b,g,h,1)),Math.min(e,a)}Object.defineProperty(k,"__esModule",{value:!0});var f=v.vec3d,m=f.create(),w=f.create(),h=f.create(),g=f.create();k.autoUpdateSkirtsVisibility=function(a,b){var e,c=!0,d=a.extent,f=n.containsPoint(d,b);f?e=a.getElevation(b):(e=a.getElevationBounds(),e=.5*(e[0]+e[1]));e>b[2]?c=!1:f||(n.containsPointWithMargin(d,b,a.hideSkirtsDistanceFromExtentMargin*Math.min(d[2]-
d[0],d[3]-d[1]))?u(a,b)>a.hideSkirtsMinimumCameraTilt&&(c=!1):c=!1);c!==a.skirts&&(a.skirts=c)};k.tiltOnEdge=l;k.tiltToExtentEdge=u;k.checkIfTileInfoSupportedForViewSR=function(a,b,e){if(a.spatialReference.isGeographic)return new p("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");var c=q.checkUnsupported(a);if(c)return c;var d;d=a.lods;var c=d[0].resolution*Math.pow(2,d[0].level),f=[c*a.size[0],c*a.size[1]],h=[a.origin.x,a.origin.y];b=n.fromExtent(b);
var g=n.create();q.computeRowColExtent(b,f,h,g);f=(g[2]-g[0])*(g[3]-g[1]);f>r.MAX_ROOT_TILES?(d=d[0].scale*Math.pow(2,d[0].level),c=Math.max((b[3]-b[1])/a.size[1],(b[2]-b[0])/a.size[0])*d/c,b=Math.floor(Math.log(c)/Math.log(10)),d=(c=Math.ceil(c/Math.pow(10,b))*Math.pow(10,b),new p("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(d).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+c.toLocaleString()+".",{level0Scale:d,suggestedLevel0Scale:c,
requiredNumRootTiles:f,allowedNumRootTiles:r.MAX_ROOT_TILES}))):d=null;return d?d:e&&!a.spatialReference.equals(e)?new p("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}});