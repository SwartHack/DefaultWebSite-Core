//>>built
define(["require","exports","./gl-matrix"],function(H,d,e){function B(a,b){if(!a)throw a=Error("dummy"),a.stack&&console.log(a.stack),new I(b);}function t(a,b,c){return b>a?b:a>c?c:a}function C(a){return a/180*Math.PI}function D(a){return 180*a/Math.PI}function J(a,b,c){e.mat4d.multiply(b,a,E);e.mat4d.inverse(E);for(a=0;8>a;++a)e.mat4d.multiplyVec4(E,Q[a],g),e.vec3d.set3(g[0]/g[3],g[1]/g[3],g[2]/g[3],c[a])}function r(a,b,c,f){e.vec3d.subtract(a,b,F);e.vec3d.subtract(c,b,K);e.vec3d.cross(K,F,f);e.vec3d.normalize(f);
f[3]=-e.vec3d.dot(f,a)}function L(a,b,c,f){var e=6378137/Math.sqrt(1-d.ECCENTRICITY_SQUARED*Math.pow(Math.sin(a),2)),p=Math.cos(a);f[0]=(e+c)*Math.cos(b)*p;f[1]=(e*(1-d.ECCENTRICITY_SQUARED)+c)*Math.sin(a);f[2]=-(e+c)*Math.sin(b)*p}function M(a){for(var b in a)return b}function N(a,b){a[12]=b[0];a[13]=b[1];a[14]=b[2]}Object.defineProperty(d,"__esModule",{value:!0});var E=e.mat4d.create(),Q=[e.vec4d.createFrom(-1,-1,-1,1),e.vec4d.createFrom(1,-1,-1,1),e.vec4d.createFrom(1,1,-1,1),e.vec4d.createFrom(-1,
1,-1,1),e.vec4d.createFrom(-1,-1,1,1),e.vec4d.createFrom(1,-1,1,1),e.vec4d.createFrom(1,1,1,1),e.vec4d.createFrom(-1,1,1,1)],g=e.vec4d.create(),R=[e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create()],F=e.vec3d.create(),K=e.vec3d.create(),O=e.vec3d.create(),u=e.vec3d.create(),m=e.vec3d.create(),k=e.vec3d.create(),w=e.vec3d.create(),x=e.vec3d.create(),G=e.vec3d.create(),P=e.vec3d.create(),y=e.vec3d.create(),q=e.vec3d.create(),
z=e.vec3d.create(),A=e.vec3d.create(),S=e.vec3d.createFrom(0,0,0),I=function(){function a(a){this.message=a}return a.prototype.toString=function(){return"AssertException: "+this.message},a}();d.AssertException=I;d.EARTH_RADIUS=6378137;d.METER2FEET=3.28084;d.ECCENTRICITY_SQUARED=.0066943799901414;d.VertexAttrConstants={POSITION:"position",NORMAL:"normal",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region"};d.assert=B;d.verify=function(a,
b){a||(console.log("Verify failed: "+b),console.log(Error("dummy").stack))};d.createQuadVertexUvBuffer=function(a){void 0===a&&(a=Float32Array);a=new a(20);return a[0]=-1,a[1]=-1,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=-1,a[7]=0,a[8]=1,a[9]=0,a[10]=-1,a[11]=1,a[12]=0,a[13]=0,a[14]=1,a[15]=1,a[16]=1,a[17]=0,a[18]=1,a[19]=1,a};d.isPowerOfTwo=function(a){return 0===(a&a-1)};d.lerp=function(a,b,c){return a+(b-a)*c};d.clamp=t;d.fallbackIfUndefined=function(a,b){return void 0===a?b:a};d.hex2rgb=function(a){a=
Math.floor(a);return[(a>>16&255)/255,(a>>8&255)/255,(255&a)/255]};d.rgb2hex=function(a){var b=t(Math.round(255*a[0]),0,255),c=t(Math.round(255*a[1]),0,255);a=t(Math.round(255*a[2]),0,255);return"0x"+((b<<16)+(c<<8)+a).toString(16)};d.dec2hex=function(a){a=a.toString(16);return"00000000".substr(0,8-a.length)+a};d.deg2rad=C;d.rad2deg=D;d.azimuthElevationAngle2Direction=function(a,b){a=1.5*Math.PI-a;b=.5*Math.PI-b;return[Math.cos(a)*Math.sin(b),Math.cos(b),Math.sin(a)*Math.sin(b)]};d.rayPlane=function(a,
b,c,f){var d=e.vec3d.dot(c,b);if(0===d)return!1;c=-(e.vec3d.dot(c,a)+c[3])/d;return e.vec3d.add(a,e.vec3d.scale(b,c,f),f),!0};d.raySphere=function(a,b,c,f,d){c=c||S;var h=e.vec3d.subtract(a,c,F);c=e.vec3d.dot(b,b);var l=2*e.vec3d.dot(b,h);f=e.vec3d.dot(h,h)-f*f;f=l*l-4*c*f;if(0>f)return!1;h=Math.sqrt(f);f=(-l-h)/(2*c);c=(-l+h)/(2*c);return(0>f||f>c&&0<c)&&(f=c),0<f?(e.vec3d.add(a,e.vec3d.scale(b,f,A),d),!0):!1};d.rayTriangle3D=function(a,b,c,f,d,p,l,n,v){void 0===v&&(v=e.vec3d.create());var h=f[l]-
c[p],g=f[l+1]-c[p+1],m=f[l+2]-c[p+2];f=d[n]-c[p];l=d[n+1]-c[p+1];d=d[n+2]-c[p+2];var k=b[1]*d-l*b[2],t=b[2]*f-d*b[0],u=b[0]*l-f*b[1];n=h*k+g*t+m*u;if(-1E-5<n&&1E-5>n)return!1;n=1/n;var q=a[0]-c[p],r=a[1]-c[p+1];a=a[2]-c[p+2];if(v[1]=n*(q*k+r*t+a*u),0>v[1]||1<v[1])return!1;c=r*m-g*a;a=a*h-m*q;h=q*g-h*r;return v[2]=n*(b[0]*c+b[1]*a+b[2]*h),0>v[2]||1<v[1]+v[2]?!1:(v[0]=n*(f*c+l*a+d*h),!0)};d.rayBoxTest=function(a,b,c,f){var d,e=(c[0]-a[0])/b[0],l=(f[0]-a[0])/b[0];e>l&&(d=e,e=l,l=d);var n=(c[1]-a[1])/
b[1],g=(f[1]-a[1])/b[1];if(n>g&&(d=n,n=g,g=d),e>g||n>l)return!1;n>e&&(e=n);l>g&&(l=g);c=(c[2]-a[2])/b[2];a=(f[2]-a[2])/b[2];return c>a&&(d=c,c=a,a=d),e>a||c>l?!1:(l>a&&(l=a),0>l?!1:!0)};d.rayRay2D=function(a,b,c,f,d,p){void 0===p&&(p=e.vec2d.create());var h=(f[d]-c[d])*(b[0]-a[0])-(f[0]-c[0])*(b[d]-a[d]);if(0===h)return!1;c=((f[0]-c[0])*(a[d]-c[d])-(f[d]-c[d])*(a[0]-c[0]))/h;return p[0]=a[0]+c*(b[0]-a[0]),p[1]=a[d]+c*(b[d]-a[d]),!0};d.matrix2frustum=J;d.matrix2frustumPlanes=function(a,b,c,d){void 0===
d&&(d=c,c=R);J(a,b,c);r(c[4],c[0],c[3],d[0]);r(c[1],c[5],c[6],d[1]);r(c[4],c[5],c[1],d[2]);r(c[3],c[2],c[6],d[3]);r(c[0],c[1],c[2],d[4]);r(c[5],c[4],c[7],d[5])};d.point2plane=r;d.project=function(a,b,c,d,h){h||(h=a);g[0]=a[0];g[1]=a[1];g[2]=a[2];g[3]=1;e.mat4d.multiplyVec4(b,g);2<h.length&&(h[2]=-g[2]);e.mat4d.multiplyVec4(c,g);B(0!==g[3]);h[0]=g[0]/g[3];h[1]=g[1]/g[3];h[2]=g[2]/g[3];h[0]=(.5*h[0]+.5)*d[2]+d[0];h[1]=(.5*h[1]+.5)*d[3]+d[1]};d.geodeticToGeocentricLatidude=function(a){return Math.atan((1-
d.ECCENTRICITY_SQUARED)*Math.tan(a))};d.latLon2positionWGS84Ellipsoid=L;d.pos2latLon=function(a,b){var c=e.vec3d.length(a);b[0]=Math.asin(t(a[1]/c,-1,1));b[1]=(0>a[2]?1:-1)*Math.acos(t(a[0]/(Math.cos(b[0])*c),-1,1));b[0]=D(b[0]);b[1]=D(b[1]);b[2]=c};d.pos2latLonWGS84Ellipsoid=function(a,b){var c=a[0],e=-a[2],h=a[1],p=Math.sqrt(Math.pow(6378137,2)*(1-d.ECCENTRICITY_SQUARED));a=Math.sqrt(Math.pow(c,2)+Math.pow(e,2));var l=Math.atan2(6378137*h,p*a),c=Math.atan2(e,c),e=Math.atan2(h+Math.pow(Math.sqrt((Math.pow(6378137,
2)-Math.pow(p,2))/Math.pow(p,2)),2)*p*Math.pow(Math.sin(l),3),a-6378137*d.ECCENTRICITY_SQUARED*Math.pow(Math.cos(l),3));a=a/Math.cos(e)-6378137/Math.sqrt(1-d.ECCENTRICITY_SQUARED*Math.pow(Math.sin(e),2))+d.EARTH_RADIUS;b[0]=e;b[1]=c;b[2]=a};d.computeGlobeTransformation=function(a,b,c){var d=C(a[0]);a=C(a[1]);return L(d,a,b,O),e.mat4d.translate(c,O),e.mat4d.rotateY(c,.5*Math.PI+a),e.mat4d.rotateX(c,.5*Math.PI-d),c};d.readUInt16=function(a,b){return a[b]+(a[b+1]<<8)};d.readUInt32=function(a,b){return a[b]+
(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24)};d.setIfDefined=function(a,b,c){void 0!==b[a]&&(c[a]=b[a])};d.array2object=function(a,b){var c={};if(void 0!==b)for(var d=0;d<a.length;d++){var e=a[d];c[b(e)]=e}else for(b=0;b<a.length;b++)e=a[b],c[e]=e;return c};d.object2array=function(a){var b=[],c;for(c in a)b.push(a[c]);return b};d.mergeObjects=function(a,b,c){if(void 0===c&&(c={}),c!==a)for(var d in a)c[d]=a[d];if(c!==b)for(var e in b)c[e]=b[e];return c};d.subtractObjects=function(a,b){var c={},d;for(d in a)void 0===
b[d]&&(c[d]=a[d]);return c};d.intersectObjects=function(a,b){var c={},d;for(d in a)void 0!==b[d]&&(c[d]=a[d]);return c};d.getFirstObjectKey=M;d.getFirstObjectValue=function(a){return a[M(a)]};d.objectEmpty=function(a){for(var b in a)return!1;return!0};d.arraysEqual=function(a,b){if(a.length!==b.length)return!1;for(var c=0,d=a.length;d>c;++c)if(a[c]!==b[c])return!1;return!0};d.arrayRemove=function(a,b){var c=a.indexOf(b);return-1!==c?(a[c]=a[a.length-1],a.pop(),b):null};d.byteBuffer2base64image=function(a,
b,c,d,e){var f=4*b;B(a.length===f*c,"buffer length must match image resolution");var h=document.createElement("canvas");h.width=b;h.height=c;var g=h.getContext("2d");b=g.getImageData(0,0,b,c);for(var m=b.data,k=0;c>k;++k)for(var t=k*f,u=(c-1-k)*f,q=0;f>q;++q)m[t++]=a[u++];return g.putImageData(b,0,0),h.toDataURL(d,e)};d.cround=function(a){return Math.round(100*a)/100};d.logWithBase=function(a,b){return Math.log(a)/Math.log(b)};d.setMatrixTranslation=N;d.setMatrixTranslation3=function(a,b,c,d){a[12]=
b;a[13]=c;a[14]=d};d.getMatrixTranslation=function(a,b){return void 0===b&&(b=e.vec3d.create()),b[0]=a[12],b[1]=a[13],b[2]=a[14],b};d.createTranslationMatrix=function(a,b){return a=e.mat4d.identity(a),N(a,b),a};d.fovx2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/b)};d.fovy2fovx=function(a,b,c){return 2*Math.atan(b*Math.tan(.5*a)/c)};d.fovx2fovd=function(a,b,c){return 2*Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*a)/b)};d.fovy2fovd=function(a,b,c){return 2*Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*
a)/c)};d.fovd2fovx=function(a,b,c){return 2*Math.atan(b*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};d.fovd2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};d.nextHighestPowerOfTwo=function(a){--a;for(var b=1;32>b;b<<=1)a|=a>>b;return a+1};d.nextHighestPowerOfTen=function(a){return Math.pow(10,Math.ceil(Math.LOG10E*Math.log(a)))};d.lineSegmentLineSegmentDistance3D=function(a,b,c,d){var f,g,l,n,q,r;if((u[0]=a[0]-c[0],u[1]=a[1]-c[1],u[2]=a[2]-c[2],m[0]=d[0]-c[0],m[1]=d[1]-c[1],m[2]=
d[2]-c[2],1E-4>Math.abs(m[0])&&1E-4>Math.abs(m[1])&&1E-4>Math.abs(m[2]))||(k[0]=b[0]-a[0],k[1]=b[1]-a[1],k[2]=b[2]-a[2],1E-4>Math.abs(k[0])&&1E-4>Math.abs(k[1])&&1E-4>Math.abs(k[2]))||(f=u[0]*m[0]+u[1]*m[1]+u[2]*m[2],g=m[0]*k[0]+m[1]*k[1]+m[2]*k[2],l=u[0]*k[0]+u[1]*k[1]+u[2]*k[2],n=m[0]*m[0]+m[1]*m[1]+m[2]*m[2],q=k[0]*k[0]+k[1]*k[1]+k[2]*k[2],r=q*n-g*g,1E-4>Math.abs(r)))return[!1];b=t((f*g-l*n)/r,0,1);f=t((f+g*b)/n,0,1);w[0]=a[0]+b*k[0];w[1]=a[1]+b*k[1];w[2]=a[2]+b*k[2];x[0]=c[0]+f*m[0];x[1]=c[1]+
f*m[1];x[2]=c[2]+f*m[2];return[!0,e.vec3d.dist(w,x),w,x]};d.pointLineSegmentDistance2D=function(a,b,c){q[0]=b[0]-a[0];q[1]=b[1]-a[1];q[2]=0;z[0]=c[0]-a[0];z[1]=c[1]-a[1];z[2]=0;A[0]=c[0];A[1]=c[1];A[2]=0;b=e.vec3d.dot(z,q);c=e.vec3d.length(q);b=t(b/(c*c),0,1);y[0]=q[0]*b;y[1]=q[1]*b;G[0]=a[0]+y[0];G[1]=a[1]+y[1];e.vec3d.subtract(A,G,P);a=e.vec3d.length(P);b=e.vec3d.length(z);c=e.vec3d.length(q);var d=e.vec3d.length(y);return(d>b||d>c)&&(a=Number.MAX_VALUE),a};H=function(){var a=window.performance||
{};if(a.now)return function(){return a.now()};if(a.webkitNow)return function(){return a.webkitNow()};if(a.mozNow)return function(){return a.mozNow()};if(a.msNow)return function(){return a.msNow()};if(a.oNow)return function(){return a.oNow()};var b;return b=a.timing&&a.timing.navigationStart?a.timing.navigationStart:Date.now(),function(){return Date.now()-b}}();d.performance={now:H}});