//>>built
define("require exports dojo/has ../lib/PerformanceTimer ../lib/Camera ../lib/Util ../lib/gl-matrix ./Visualizer".split(" "),function(d,L,t,p,u,y,n,v){var q=n.vec3;d=n.vec4d;var w=n.mat4d,g=[0,0],x=w.create(),b=[d.create(),d.create(),d.create(),d.create(),d.create(),d.create()],m=t("dojo-debug-messages");return function(){function c(a,h,c,b){this._content={};this._frustumCullingEnabled=!0;this._maxFarNearRatio=2E4;this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,visualizerRenderTimer:null,
viewportRenderTimer:null};this._needsRender=!0;this._rctx=b;this._gl=b.gl;this._visualizer=new v(a,h,c,this._rctx);this._camera=new u(q.createFrom(0,100,-100),q.createFrom(0,0,0));m&&(this._stats.visualizerRenderTimer=new p(10),this._stats.viewportRenderTimer=new p(10))}return c.prototype.getCombinedStats=function(){var a={},h=this._visualizer.getCombinedStats(),b;for(b in h)a[b]=h[b];if(a.renderGeometriesTotal=this._stats.renderGeometriesTotal,a.renderGeometriesVisible=this._stats.renderGeometriesVisible,
m&&(a.visualizerTotalRenderTime=this._stats.visualizerRenderTimer.getTotal(),a.visualizerCurrentRenderTime=this._stats.visualizerRenderTimer.getLastFiltered(),a.viewportTotalRenderTime=this._stats.viewportRenderTimer.getTotal(),a.viewportCurrentRenderTime=this._stats.viewportRenderTimer.getLastFiltered(),a.totalNumFramesRendered=this._stats.viewportRenderTimer.getNumMeasurements()),void 0!==this._gl.getUsedTextureMemory&&(a.textureMemory=this._gl.getUsedTextureMemory()),void 0!==this._gl.getUsedRenderbufferMemory&&
(a.renderbufferMemory=this._gl.getUsedRenderbufferMemory()),void 0!==this._gl.getUsedVBOMemory&&(a.VBOMemory=this._gl.getUsedVBOMemory()),void 0!==this._gl.getUsedTextureMemoryStats){var h=this._gl.getUsedTextureMemoryStats(),c;for(c in h)a["texMem type: "+c]=h[c]}return a},c.prototype.dispose=function(){this._visualizer.dispose();this._visualizer=null},c.prototype.setLighting=function(a){this._visualizer.setLighting(a)},c.prototype.getViewParams=function(a){var b=this._visualizer.getViewParams(a);
return(!a||a.frustumCullingEnabled)&&(b.frustumCullingEnabled=this._frustumCullingEnabled),(!a||a.maxFarNearRatio)&&(b.maxFarNearRatio=this._maxFarNearRatio),b},c.prototype.setViewParams=function(a){void 0!==a.frustumCullingEnabled&&(this._frustumCullingEnabled=a.frustumCullingEnabled);void 0!==a.maxFarNearRatio&&(-1===a.maxFarNearRatio?this._maxFarNearRatio=2E4:this._maxFarNearRatio=a.maxFarNearRatio);this._visualizer.setViewParams(a);this._needsRender=!0},c.prototype.setRenderParams=function(a){this._visualizer.setRenderParams(a)},
c.prototype.getRenderParams=function(){return this._visualizer.getRenderParams()},c.prototype.getFrustumObjects=function(){var a={},b;for(b in this._content)a[this._content[b].name]=1;return a},c.prototype.modify=function(a,b,c,d){this._visualizer.modify(a,b,c,d);this._content=this._visualizer.getContent()},c.prototype.getContent=function(){return this._content},c.prototype.setCamera=function(a){this._camera.copyFrom(a);this._updateNearFar();this._needsRender=!0},c.prototype.getCamera=function(){return this._camera},
c.prototype.getPickRay=function(a,b,c){return this.pickRayWithBeginPoint(a,void 0,this._camera.viewMatrix,b,c)},c.prototype.pickRayWithBeginPoint=function(a,b,c,d,g){return this._visualizer.getPickRay(a,b,this._camera,c,d,g)},c.prototype.addExternalRenderer=function(a,b){return this._visualizer.addExternalRenderer(a,b)},c.prototype.removeExternalRenderer=function(a){return this._visualizer.removeExternalRenderer(a)},c.prototype.getExternalRenderers=function(){return this._visualizer.getExternalRenderers()},
c.prototype.render=function(a,b){m&&this._stats.viewportRenderTimer.start();this._updateNearFar();m&&this._stats.visualizerRenderTimer.start();this._visualizer.render(this._camera,a,b);m&&(this._stats.visualizerRenderTimer.stop(),this._stats.viewportRenderTimer.stop())},c.prototype.resetNeedsRender=function(){this._needsRender=!1;this._visualizer.resetNeedsRender()},c.prototype.needsRender=function(){return this._needsRender||this._visualizer.needsRender()},c.prototype._updateNearFar=function(){(this._frustumCullingEnabled||
0<this._maxFarNearRatio)&&(g[1]=0,this._computeFrustumCullingAndNearFar(this._camera.eye,g),0<this._maxFarNearRatio&&0<g[1]&&(this._camera.far=g[1],this._camera.near=Math.max(g[0],this._camera.far/this._maxFarNearRatio)))},c.prototype._computeFrustumCullingAndNearFar=function(a,c){w.perspective(this._camera.fovY,this._camera.aspect,1,10,x);y.matrix2frustumPlanes(this._camera.viewMatrix,x,b);this._stats.renderGeometriesTotal=0;this._stats.renderGeometriesVisible=0;a=-Number.MAX_VALUE;var d=-Number.MAX_VALUE,
g=b[0][0],h=b[0][1],m=b[0][2],n=b[0][3],p=b[1][0],q=b[1][1],t=b[1][2],u=b[1][3],v=b[2][0],z=b[2][1],A=b[2][2],B=b[2][3],C=b[3][0],D=b[3][1],E=b[3][2],F=b[3][3],G=b[4][0],H=b[4][1],I=b[4][2],J=b[4][3],K=b[5][3],r;for(r in this._content){var f=this._content[r];if(this._stats.renderGeometriesTotal++,!f.material.isBackdrop){var k=f.center,l=k[0],e=k[1],k=k[2],f=f.bsRadius;if(g*l+h*e+m*k+n>f)continue;if(p*l+q*e+t*k+u>f)continue;if(v*l+z*e+A*k+B>f)continue;if(C*l+D*e+E*k+F>f)continue;e=G*l+H*e+I*k;l=e+
f;e=-e+f;l>a&&(a=l);e>d&&(d=e)}this._stats.renderGeometriesVisible++}r=a!==-Number.MAX_VALUE;0<this._stats.renderGeometriesVisible&&r&&(c[0]=.99*Math.max(1-(a+J),2),c[1]=1.01*Math.max(10+(d+K),c[0]+1))},c}()});