//>>built
require({cache:{"esri/views/View":function(){define("dojo/_base/lang ../Graphic ../core/Accessor ../core/Collection ../core/CollectionFlattener ../core/Evented ../core/HandleRegistry ../core/Promise ../core/watchUtils ../core/promiseUtils ../core/Scheduler ../geometry/Extent ../geometry/HeightModelInfo ../geometry/SpatialReference ./LayerViewManager ./RefreshManager ./BasemapView ./GroundView ./support/DefaultsFromMap".split(" "),function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b){return w.createSubclass([r,
d],{declaredClass:"esri.views.View",properties:{allLayerViews:{readOnly:!0},basemapView:{},animation:{},resizing:{},interacting:{},graphics:{type:l.ofType(p)},groundView:{},defaultsFromMap:b,heightModelInfo:{readOnly:!0,type:C,dependsOn:["map.heightModelInfo","defaultsFromMap.heightModelInfo"]},initialExtent:{readOnly:!0,type:t,dependsOn:["defaultsFromMap.extent"]},initialExtentRequired:{},layerViews:{type:l},map:{},ready:{readOnly:!0,dependsOn:"map spatialReference width height initialExtentRequired initialExtent defaultsFromMap.isSpatialReferenceDone map.loaded".split(" ")},
size:{readOnly:!0,dependsOn:["width","height"],get:function(){return[this.width,this.height]}},spatialReference:{type:q,dependsOn:["defaultsFromMap.spatialReference","defaultsFromMap.vcsWkid","defaultsFromMap.latestVcsWkid"]},stationary:{dependsOn:["animation","interacting","resizing"]},type:{},updating:{},padding:{},width:{},height:{},cursor:{}},constructor:function(m){this._viewHandles=new u;this._viewHandles.add(this.watch("ready",function(b,m){b?this._currentSpatialReference=this.spatialReference:
this._currentSpatialReference=null;this.notifyChange("spatialReference");!b&&m&&this.layerViewManager.empty()}.bind(this)));this.allLayerViews=new h({root:this,rootCollectionNames:["basemapView.baseLayerViews","groundView.layerViews","layerViews","basemapView.referenceLayerViews"],getChildrenFunction:function(b){return b.layerViews}});this.defaultsFromMap=new b({view:this})},getDefaults:function(){return A.mixin(this.inherited(arguments),{layerViews:[],graphics:[],padding:{left:0,top:0,right:0,bottom:0}})},
initialize:function(){var b=this.validate().then(function(){this._isValid=!0;this.notifyChange("ready");var b=function(){return a.whenOnce(this,"ready").then(function(){return k.after(0)}.bind(this)).then(function(){return this.ready?void 0:b()}.bind(this))}.bind(this);return b()}.bind(this));this.addResolvingPromise(b);this.basemapView=new B({view:this});this.groundView=new D({view:this});this.layerViewManager=new v({view:this});this.refreshManager=new y({view:this});this._resetInitialViewPropertiesFromContent()},
destroy:function(){this.destroyed||(this.basemapView.destroy(),this.groundView.destroy(),this.destroyLayerViews(),this.refreshManager.destroy(),this.defaultsFromMap.destroy(),this.defaultsFromMap=null,this._viewHandles.destroy(),this.map=null)},destroyLayerViews:function(){this.layerViewManager.destroy()},_viewHandles:null,_isValid:!1,_readyCycleForced:!1,_userSpatialReference:null,_currentSpatialReference:null,animation:null,basemapView:null,groundView:null,graphics:null,_graphicsSetter:function(b){this._graphicsView&&
(this._graphicsView.graphics=b);this._set("graphics",b)},heightModelInfo:null,_heightModelInfoGetter:function(){return this.getDefaultHeightModelInfo()},interacting:!1,layerViews:null,map:null,_mapSetter:function(b){var m=this._get("map");b!==m&&(b&&b.load&&b.load(),this._forceReadyCycle(),this._resetInitialViewPropertiesFromContent(),this._set("map",b))},padding:null,_readyGetter:function(){return!!(this._isValid&&!this._readyCycleForced&&this.map&&0!==this.width&&0!==this.height&&this.spatialReference&&
(!this.map.load||this.map.loaded)&&(this._currentSpatialReference||!this.initialExtentRequired||this.initialExtent||this.defaultsFromMap&&this.defaultsFromMap.isSpatialReferenceDone)&&this.defaultsFromMap&&this.defaultsFromMap.isTileInfoDone&&this.isSpatialReferenceSupported(this.spatialReference))},spatialReference:null,_spatialReferenceGetter:function(){var b=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return b&&this.isHeightModelInfoRequired&&
this.defaultsFromMap&&(b=b.clone(),b.vcsWkid=this.defaultsFromMap.vcsWkid,b.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),b},_spatialReferenceSetter:function(b){this._userSpatialReference=b;this._set("spatialReference",b)},stationary:!0,_stationaryGetter:function(){return!this.animation&&!this.interacting&&!this.resizing},type:null,updating:!1,initialExtentRequired:!0,initialExtent:null,_initialExtentGetter:function(){return this.defaultsFromMap&&this.defaultsFromMap.extent},cursor:"default",
whenLayerView:function(b){return this.layerViewManager.whenLayerView(b)},getDefaultSpatialReference:function(){return this.get("defaultsFromMap.spatialReference")},getDefaultHeightModelInfo:function(){return this.get("map.supportsHeightModelInfo")&&this.get("map.heightModelInfo")||this.get("defaultsFromMap.heightModelInfo")||null},validate:function(){return k.resolve()},isSpatialReferenceSupported:function(){return!0},isTileInfoRequired:function(){return!1},_resetInitialViewPropertiesFromContent:function(){if(this.defaultsFromMap){var b=
this.defaultsFromMap.start.bind(this.defaultsFromMap);this.defaultsFromMap.reset();this._currentSpatialReference=null;this.notifyChange("spatialReference");this._viewHandles.remove("defaultsFromMap");this._viewHandles.add([a.watch(this,"spatialReference",b),a.watch(this,"initialExtentRequired",b),c.schedule(b)],"defaultsFromMap")}},_forceReadyCycle:function(){this.ready&&(this._readyCycleForced=!0,a.whenFalseOnce(this,"ready",function(){this._readyCycleForced=!1;this.notifyChange("ready")}.bind(this)),
this.notifyChange("ready"))}})})},"esri/Graphic":function(){define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/accessorSupport/decorators dojo/_base/lang ./core/lang ./core/JSONSupport ./PopupTemplate ./symbols/support/typeUtils ./symbols/support/jsonUtils ./geometry ./geometry/support/typeUtils".split(" "),function(A,p,w,l,h,d,u,r,a,k,c,t,C){var q=0;return function(v){function y(a,b,m,c){a=v.call(this,a,b,m,c)||this;return a.layer=null,Object.defineProperty(a,
"uid",{value:q++}),a}return w(y,v),B=y,y.prototype.normalizeCtorArgs=function(a,b,m,c){return a&&!a.declaredClass?a:{geometry:a,symbol:b,attributes:m,popupTemplate:c}},Object.defineProperty(y.prototype,"attributes",{set:function(a){var b=this._get("attributes");b!==a&&(this._set("attributes",a),this._notifyLayer("attributes",b,a))},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"geometry",{set:function(a){var b=this._get("geometry");b!==a&&(this._set("geometry",a),this._notifyLayer("geometry",
b,a))},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"popupTemplate",{get:function(){return this.get("layer.popupTemplate")||null},set:function(a){return void 0===a?void this._clearOverride("popupTemplate"):void this._override("popupTemplate",a)},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"symbol",{set:function(a){var b=this._get("symbol");b!==a&&(this._set("symbol",a),this._notifyLayer("symbol",b,a))},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,
"visible",{set:function(a){var b=this._get("visible");b!==a&&(this._set("visible",a),this._notifyLayer("visible",b,a))},enumerable:!0,configurable:!0}),y.prototype.getAttribute=function(a){return this.attributes&&this.attributes[a]},y.prototype.setAttribute=function(a,b){if(this.attributes){var m=this.getAttribute(a);this.attributes[a]=b;this._notifyLayer("attributes",m,b,a)}else this.attributes=(m={},m[a]=b,m),this._notifyLayer("attributes",void 0,b,a)},y.prototype.toJSON=function(){return{geometry:this.geometry&&
this.geometry.toJSON(),symbol:this.symbol&&this.symbol.toJSON(),attributes:d.mixin({},this.attributes),popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}},y.prototype.clone=function(){return new B({attributes:u.clone(this.attributes),geometry:this.geometry&&this.geometry.clone()||null,popupTemplate:this.popupTemplate&&this.popupTemplate.clone(),symbol:this.symbol&&this.symbol.clone()||null,visible:this.visible})},y.prototype._notifyLayer=function(a,b,m,c){this.layer&&(a={graphic:this,
property:a,oldValue:b,newValue:m},c&&(a.attributeName=c),this.layer.graphicChanged(a))},l([h.property({value:null})],y.prototype,"attributes",null),l([h.property({value:null,types:C.types,json:{read:t.fromJSON}})],y.prototype,"geometry",null),l([h.property()],y.prototype,"layer",void 0),l([h.property({dependsOn:["layer.popupTemplate"],type:a})],y.prototype,"popupTemplate",null),l([h.property({value:null,types:k.types,json:{read:c.read}})],y.prototype,"symbol",null),l([h.property({value:!0,set:function(a){}})],
y.prototype,"visible",null),y=B=l([h.subclass("esri.Graphic")],y);var B}(h.declared(r))})},"esri/PopupTemplate":function(){define("require exports ./core/tsSupport/assignHelper ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/accessorSupport/decorators ./core/date ./core/Collection ./core/kebabDictionary ./core/JSONSupport ./core/lang ./support/Action ./support/arcadeUtils ./layers/support/fieldUtils".split(" "),function(A,p,w,l,h,d,u,r,a,k,c,t,C,q){var v=a({richtext:"rich-text",
textarea:"text-area",textbox:"text-box"}),y=a({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});return function(a){function D(){var b=null!==a&&a.apply(this,arguments)||this;return b.actions=null,b.content="",b.expressionInfos=null,b.fieldInfos=null,b.layerOptions=null,b.overwriteActions=!1,b.title="",b.relatedRecordsInfo=null,b}return l(D,a),b=D,D.prototype.readContent=function(b,a){var m=this,c=a.description,D=a.mediaInfos;b=a.showAttachments;if((a=a.popupElements)&&
a.length)return a.map(function(b){return"text"!==b.type||b.text?"media"===b.type&&(b.mediaInfos||D)&&(b.mediaInfos||(b.mediaInfos=D),b.mediaInfos=m._readMediaInfos(b.mediaInfos)):b.text=c,b});a=[];return c?a.push({type:"text",text:c}):a.push({type:"fields"}),D&&D.length&&a.push({type:"media",mediaInfos:this._readMediaInfos(D)}),b&&a.push({type:"attachments",displayType:"list"}),a.length?a:c},D.prototype.writeContent=function(b,a){var m=this;return a.showAttachments=!1,"string"==typeof b?void(a.description=
b):Array.isArray(b)?(a.popupElements=c.clone(b),void a.popupElements.forEach(function(b){return"attachments"!==b.type||a.showAttachments?"media"!==b.type||a.mediaInfos?"text"!==b.type||a.description?"fields"!==b.type||a.fieldInfos||(b.fieldInfos&&(a.fieldInfos=m._writeFieldInfos(c.clone(b.fieldInfos))),delete b.fieldInfos):(b.text&&(a.description=b.text),delete b.text):(b.mediaInfos&&(a.mediaInfos=c.clone(b.mediaInfos),a.mediaInfos.forEach(function(b){b.type=y.toJSON(b.type)})),delete b.mediaInfos):
a.showAttachments=!0,b})):void 0},D.prototype.writeExpressionInfos=function(b,a){a.expressionInfos=b||null},D.prototype.readFieldInfos=function(b){return b?(b.forEach(function(b){var m=b.format&&b.format.dateFormat,a=b.stringFieldOption;m&&(b.format.dateFormat=u.fromJSON(m));a&&(b.stringFieldOption=v.fromJSON(a))}),b):void 0},D.prototype.writeFieldInfos=function(b,a){a.fieldInfos=b?this._writeFieldInfos(c.clone(b)):b},D.prototype.writeLayerOptions=function(b,a){a.layerOptions=b||null},D.prototype.writeTitle=
function(b,a){a.title=b||""},D.prototype.writeRelatedRecordsInfo=function(b,a){a.relatedRecordsInfo=b||null},Object.defineProperty(D.prototype,"requiredFields",{get:function(){return this.collectRequiredFields()},enumerable:!0,configurable:!0}),D.prototype.clone=function(){var m=this.actions,m=m?c.clone(m.toArray()):[];return new b({actions:m,content:Array.isArray(this.content)?c.clone(this.content):this.content,fieldInfos:this.fieldInfos?c.clone(this.fieldInfos):null,layerOptions:this.layerOptions?
c.clone(this.layerOptions):null,overwriteActions:this.overwriteActions,relatedRecordsInfo:this.relatedRecordsInfo?c.clone(this.relatedRecordsInfo):null,title:this.title})},D.prototype.collectRequiredFields=function(){return this._getActionsFields(this.actions).concat(this._getTitleFields(this.title),this._getContentFields(this.content),this._getExpressionInfoFields(this.expressionInfos)).filter(function(b,a,c){return a===c.indexOf(b)})},D.prototype._getContentElementFields=function(b){var m=this;
return b&&"attachments"!==b.type?"fields"===b.type?this._getFieldInfoFields(b.fieldInfos||this.fieldInfos):"media"===b.type?(b.mediaInfos||[]).reduce(function(b,a){return b.concat(m._getMediaInfoFields(a))},[]):"text"===b.type?q.extractFieldNames(b.text):void 0:[]},D.prototype._getMediaInfoFields=function(b){var m=b.caption,a=b.value||{},c=a.fields,D=void 0===c?[]:c,c=a.normalizeField,k=a.tooltipField,d=a.sourceURL,a=a.linkURL;b=q.extractFieldNames(b.title).concat(q.extractFieldNames(m),q.extractFieldNames(d),
q.extractFieldNames(a),D);return c&&b.push(c),k&&b.push(k),b},D.prototype._getContentFields=function(b){var m=this;return"string"==typeof b?q.extractFieldNames(b):Array.isArray(b)?b.reduce(function(b,a){return b.concat(m._getContentElementFields(a))},[]):[]},D.prototype._getExpressionInfoFields=function(b){return b?b.reduce(function(b,m){return b.concat(C.extractFieldNames(m.expression))},[]):[]},D.prototype._getFieldInfoFields=function(b){return b?b.filter(function(b){return"undefined"==typeof b.visible?
!0:!!b.visible}).map(function(b){return b.fieldName}).filter(function(b){return-1===b.indexOf("relationships/")&&-1===b.indexOf("expression/")}):[]},D.prototype._getActionsFields=function(b){var m=this;return b?b.toArray().reduce(function(b,a){return b.concat(m._getActionFields(a))},[]):[]},D.prototype._getActionFields=function(b){return q.extractFieldNames(b.title).concat(q.extractFieldNames(b.className),q.extractFieldNames(b.image))},D.prototype._getTitleFields=function(b){return"string"==typeof b?
q.extractFieldNames(b):[]},D.prototype._readMediaInfos=function(b){return b.forEach(function(b){b.type=y.fromJSON(b.type)}),b},D.prototype._writeFieldInfos=function(b){return b.forEach(function(b){var m=b.format&&b.format.dateFormat,a=b.stringFieldOption;m&&(b.format.dateFormat=u.toJSON(m));a&&(b.stringFieldOption=v.toJSON(a));b.format||delete b.format}),b},h([d.property({type:r.ofType(t)})],D.prototype,"actions",void 0),h([d.property()],D.prototype,"content",void 0),h([d.reader("content",["description",
"popupElements","mediaInfos","showAttachments"])],D.prototype,"readContent",null),h([d.writer("content")],D.prototype,"writeContent",null),h([d.property()],D.prototype,"expressionInfos",void 0),h([d.writer("expressionInfos")],D.prototype,"writeExpressionInfos",null),h([d.property()],D.prototype,"fieldInfos",void 0),h([d.reader("fieldInfos")],D.prototype,"readFieldInfos",null),h([d.writer("fieldInfos")],D.prototype,"writeFieldInfos",null),h([d.property()],D.prototype,"layerOptions",void 0),h([d.writer("layerOptions")],
D.prototype,"writeLayerOptions",null),h([d.property()],D.prototype,"overwriteActions",void 0),h([d.property()],D.prototype,"title",void 0),h([d.writer("title")],D.prototype,"writeTitle",null),h([d.property()],D.prototype,"relatedRecordsInfo",void 0),h([d.writer("relatedRecordsInfo")],D.prototype,"writeRelatedRecordsInfo",null),h([d.property({dependsOn:["actions","title","content","fieldInfos","expressionInfos"],readOnly:!0})],D.prototype,"requiredFields",null),D=b=h([d.subclass("esri.PopupTemplate")],
D);var b}(d.declared(k))})},"esri/core/date":function(){define(["require","exports","./kebabDictionary"],function(A,p,w){Object.defineProperty(p,"__esModule",{value:!0});var l={"short-date":"(datePattern: 'M/d/y', selector: 'date')","short-date-le":"(datePattern: 'd/M/y', selector: 'date')","long-month-day-year":"(datePattern: 'MMMM d, y', selector: 'date')","day-short-month-year":"(datePattern: 'd MMM y', selector: 'date')","long-date":"(datePattern: 'EEEE, MMMM d, y', selector: 'date')","short-date-short-time":"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",
"short-date-le-short-time":"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')","short-date-short-time-24":"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')","short-date-le-short-time-24":"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')","short-date-long-time":"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')","short-date-le-long-time":"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",
"short-date-long-time-24":"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')","short-date-le-long-time-24":"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')","long-month-year":"(datePattern: 'MMMM y', selector: 'date')","short-month-year":"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"};A=w({shortDate:"short-date",shortDateLE:"short-date-le",longDate:"long-date",dayShortMonthYear:"day-short-month-year",longMonthDayYear:"long-month-day-year",
shortDateLongTime:"short-date-long-time",shortDateLELongTime:"short-date-le-long-time",shortDateShortTime:"short-date-short-time",shortDateLEShortTime:"short-date-le-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLongTime24:"short-date-long-time-24",shortDateLELongTime24:"short-date-le-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year"});p.toJSON=A.toJSON;p.fromJSON=A.fromJSON;p.getFormat=function(h){return l[h]}})},
"esri/support/Action":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/Identifiable ../core/accessorSupport/decorators".split(" "),function(A,p,w,l,h,d,u){return function(d){function a(a){a=d.call(this)||this;return a.className="",a.temporary=!1,a.image="",a.id="",a.title="",a.visible=!0,a}return w(a,d),k=a,a.prototype.clone=function(){return new k({className:this.className,image:this.image,id:this.id,title:this.title,
visible:this.visible})},l([u.property()],a.prototype,"className",void 0),l([u.property()],a.prototype,"temporary",void 0),l([u.property()],a.prototype,"image",void 0),l([u.property()],a.prototype,"id",void 0),l([u.property()],a.prototype,"title",void 0),l([u.property()],a.prototype,"visible",void 0),a=k=l([u.subclass("esri.support.Action")],a);var k}(u.declared(h,d))})},"esri/support/arcadeUtils":function(){define(["require","exports","dojo/_base/lang","../arcade/arcade","../arcade/Dictionary"],function(A,
p,w,l,h){function d(a){var k;try{k=a?l.parseScript(a):null}catch(c){k=null}return k}Object.defineProperty(p,"__esModule",{value:!0});var u=/^\$feature\./i,r={vars:{$feature:"any",$view:"any"},spatialReference:null};p.createSyntaxTree=d;p.createFunction=function(a,k){k=k||w.clone(r);var c;a="string"==typeof a?d(a):a;try{c=a?l.compileScript(a,k):null}catch(t){c=null}return c};p.createExecContext=function(a,k){return{vars:{$feature:l.constructFeature(a),$view:k&&k.view},spatialReference:k&&k.sr}};p.createFeature=
function(a){return l.constructFeature(a)};p.updateExecContext=function(a,k){a.vars.$feature=k};p.evalSyntaxTree=function(a,k){var c;try{c=l.executeScript(a,k,k.spatialReference)}catch(t){c=null}return c};p.executeFunction=function(a,k){var c;try{c=a?a(k,k.spatialReference):null}catch(t){c=null}return c};p.extractFieldNames=function(a){if(!a)return[];a="string"==typeof a?d(a):a;var k=[];return l.extractFieldLiterals(a).forEach(function(a){u.test(a)&&(a=a.replace(u,""),k.push(a))}),k.sort(),k.filter(function(a,
d){return 0===d||k[d-1]!==a})};p.dependsOnView=function(a){return l.referencesMember(a,"$view")};p.getViewInfo=function(a){return a&&a.viewingMode&&null!=a.scale&&a.spatialReference?{view:new h({viewingMode:a.viewingMode,scale:a.scale}),sr:a.spatialReference}:void 0}})},"esri/arcade/arcade":function(){define("require exports ./arcadeRuntime ./parser ./Feature ./arcadeCompiler dojo/has dojo/Deferred".split(" "),function(A,p,w,l,h,d,u,r){Object.defineProperty(p,"__esModule",{value:!0});var a="disjoint intersects touches crosses within contains overlaps equals relate intersection union difference symmetricdifference clip cut area areageodetic length lengthgeodetic distance densify densifygeodetic generalize buffer buffergeodetic offset rotate issimple simplify multiparttosinglepart".split(" ");
p.compileScript=function(a,c){return u("csp-restrictions")?function(c,k){return w.executeScript(a,c,k)}:d.compileScript(a,c)};p.extend=function(a){w.extend(a);d.extend(a)};p.constructFeature=function(a){return h.fromFeature(a)};p.parseScript=function(a){return l.parseScript(a)};p.validateScript=function(a,c){return l.validateScript(a,c,"simple")};p.scriptCheck=function(a,c,d){return l.scriptCheck(a,c,d,"full")};p.parseAndExecuteScript=function(a,c,d){return w.executeScript(l.parseScript(a),c,d)};
p.executeScript=function(a,c,d){return w.executeScript(a,c,d)};p.referencesMember=function(a,c){return w.referencesMember(a,c)};p.referencesFunction=function(a,c){return w.referencesFunction(a,c)};p.extractFieldLiterals=function(a,c){return void 0===c&&(c=!1),l.extractFieldLiterals(a,c)};p.scriptUsesGeometryEngine=function(k){k=w.findFunctionCalls(k);for(var c=0;c<k.length;c++)if(-1<a.indexOf(k[c]))return!0;return!1};p.enableGeometrySupport=function(){var a=new r;return A(["esri/geometry/geometryEngine",
"./functions/geomsync"],function(c,k){k.setGeometryEngine(c);a.resolve(!0)},function(c){a.reject(c)}),a.promise}})},"esri/arcade/arcadeRuntime":function(){define("require exports ../geometry/Polygon ../geometry/Polyline ../geometry/Point ../geometry/Extent ../geometry/Multipoint ../geometry/SpatialReference ./languageUtils ./treeAnalysis ./Dictionary ./Feature ./FunctionWrapper ./functions/date ./functions/string ./functions/maths ./functions/geometry ./functions/geomsync ./functions/stats ./ImmutablePathArray ./ImmutablePointArray ../geometry/Geometry".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E,J){function G(e,f){for(var n=[],g=0;g<f.arguments.length;g++)n.push(M(e,f.arguments[g]));return n}function K(e,f,n){try{return n(e,f,G(e,f))}catch(ka){throw ka;}}function M(e,f){try{switch(f.type){case "EmptyStatement":return a.voidOperation;case "VariableDeclarator":var n=null===f.init?null:M(e,f.init);n===a.voidOperation&&(n=null);var g=f.id.name.toLowerCase();return null!==e.localScope?e.localScope[g]={value:n,valueset:!0,node:f.init}:e.globalScope[g]=
{value:n,valueset:!0,node:f.init},a.voidOperation;case "VariableDeclaration":for(var x=0;x<f.declarations.length;x++)M(e,f.declarations[x]);return a.voidOperation;case "BlockStatement":var I;a:{for(var L=a.voidOperation,x=0;x<f.body.length;x++)if(L=M(e,f.body[x]),L instanceof a.ReturnResult||L===a.breakResult||L===a.continueResult){I=L;break a}I=L}return I;case "FunctionDeclaration":var b=f.id.name.toLowerCase();return e.globalScope[b]={valueset:!0,node:null,value:new C(f,e)},a.voidOperation;case "ReturnStatement":var m;
if(null===f.argument)m=new a.ReturnResult(a.voidOperation);else{var P=M(e,f.argument);m=new a.ReturnResult(P)}return m;case "IfStatement":var Y;if("AssignmentExpression"===f.test.type||"UpdateExpression"===f.test.type)throw Error(k.nodeErrorMessage(f.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));var D=M(e,f.test);if(!0===D)Y=M(e,f.consequent);else if(!1===D)Y=null!==f.alternate?M(e,f.alternate):a.voidOperation;else throw Error(k.nodeErrorMessage(f,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"));
return Y;case "ExpressionStatement":var E;if("AssignmentExpression"===f.expression.type||"UpdateExpression"===f.expression.type)E=M(e,f.expression);else{var q=M(e,f.expression);E=q===a.voidOperation?a.voidOperation:new a.ImplicitResult(q)}return E;case "AssignmentExpression":var d;var v=M(e,f.right),x=null,y="";if("MemberExpression"===f.left.type){if(x=M(e,f.left.object),y=!0===f.left.computed?M(e,f.left.property):f.left.property.name,a.isArray(x)){if(!a.isNumber(y))throw Error("Invalid Parameter");
if(0>y&&(y=x.length+y),0>y||y>x.length)throw Error("Assignment outside of array bounds");if(y===x.length&&"\x3d"!==f.operator)throw Error("Invalid Parameter");x[y]=N(v,f.operator,x[y],f)}else{if(x instanceof c){if(!1===a.isString(y))throw Error("Dictionary accessor must be a string");}else{if(!(x instanceof t))throw a.isImmutableArray(x)?Error("Array is Immutable"):Error("Invalid Parameter");if(!1===a.isString(y))throw Error("Feature accessor must be a string");}if(!0===x.hasField(y))x.setField(y,
N(v,f.operator,x.field(y),f));else{if("\x3d"!==f.operator)throw Error("Invalid Parameter");x.setField(y,N(v,f.operator,null,f))}}d=a.voidOperation}else if(x=f.left.name.toLowerCase(),null!==e.localScope&&void 0!==e.localScope[x])d=(e.localScope[x]={value:N(v,f.operator,e.localScope[x].value,f),valueset:!0,node:f.right},a.voidOperation);else if(void 0!==e.globalScope[x])d=(e.globalScope[x]={value:N(v,f.operator,e.globalScope[x].value,f),valueset:!0,node:f.right},a.voidOperation);else throw Error("Variable not recognised");
return d;case "UpdateExpression":var B,x=null;d="";if("MemberExpression"===f.argument.type){if(x=M(e,f.argument.object),d=!0===f.argument.computed?M(e,f.argument.property):f.argument.property.name,a.isArray(x)){if(!a.isNumber(d))throw Error("Invalid Parameter");if(0>d&&(d=x.length+d),0>d||d>=x.length)throw Error("Assignment outside of array bounds");B=a.toNumber(x[d]);x[d]="++"===f.operator?B+1:B-1}else{if(x instanceof c){if(!1===a.isString(d))throw Error("Dictionary accessor must be a string");}else{if(!(x instanceof
t))throw a.isImmutableArray(x)?Error("Array is Immutable"):Error("Invalid Parameter");if(!1===a.isString(d))throw Error("Feature accessor must be a string");}if(!0!==x.hasField(d))throw Error("Invalid Parameter");B=a.toNumber(x.field(d));x.setField(d,"++"===f.operator?B+1:B-1)}y=!1===f.prefix?B:"++"===f.operator?B+1:B-1}else if(x=f.argument.name.toLowerCase(),null!==e.localScope&&void 0!==e.localScope[x])y=(B=a.toNumber(e.localScope[x].value),e.localScope[x]={value:"++"===f.operator?B+1:B-1,valueset:!0,
node:f},!1===f.prefix?B:"++"===f.operator?B+1:B-1);else if(void 0!==e.globalScope[x])y=(B=a.toNumber(e.globalScope[x].value),e.globalScope[x]={value:"++"===f.operator?B+1:B-1,valueset:!0,node:f},!1===f.prefix?B:"++"===f.operator?B+1:B-1);else throw Error("Variable not recognised");return y;case "BreakStatement":return a.breakResult;case "ContinueStatement":return a.continueResult;case "ForStatement":null!==f.init&&M(e,f.init);x={testResult:!0,lastAction:a.voidOperation};do a:{d=e;v=f;y=x;if(null!==
v.test){if(y.testResult=M(d,v.test),!1===y.testResult)break a;if(!0!==y.testResult)throw Error(k.nodeErrorMessage(v,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"));}y.lastAction=M(d,v.body);y.lastAction===a.breakResult?y.testResult=!1:y.lastAction instanceof a.ReturnResult?y.testResult=!1:null!==v.update&&M(d,v.update)}while(!0===x.testResult);return x.lastAction instanceof a.ReturnResult?x.lastAction:a.voidOperation;case "ForInStatement":return U(e,f);case "Identifier":return X(e,f);case "MemberExpression":return R(e,
f);case "Literal":return f.value;case "ThisExpression":throw Error(k.nodeErrorMessage(f,"RUNTIME","NOTSUPPORTED"));case "CallExpression":return z(e,f);case "UnaryExpression":return V(e,f);case "BinaryExpression":return Q(e,f);case "LogicalExpression":return S(e,f);case "ConditionalExpression":throw Error(k.nodeErrorMessage(f,"RUNTIME","NOTSUPPORTED"));case "ArrayExpression":try{for(x=[],d=0;d<f.elements.length;d++){var h=M(e,f.elements[d]);if(a.isFunctionParameter(h))throw Error(k.nodeErrorMessage(f,
"RUNTIME","FUNCTIONCONTEXTILLEGAL"));h===a.voidOperation?x.push(null):x.push(h)}}catch(La){throw La;}return x;case "ObjectExpression":x={};for(d=0;d<f.properties.length;d++){var r=M(e,f.properties[d]);if(a.isFunctionParameter(r.value))throw Error("Illegal Argument");if(!1===a.isString(r.key))throw Error("Illegal Argument");r.value===a.voidOperation?x[r.key.toString()]=null:x[r.key.toString()]=r.value}var l=new c(x);return l.immutable=!1,l;case "Property":return{key:"Identifier"===f.key.type?f.key.name:
M(e,f.key),value:M(e,f.value)};case "Array":throw Error(k.nodeErrorMessage(f,"RUNTIME","NOTSUPPORTED"));default:throw Error(k.nodeErrorMessage(f,"RUNTIME","UNREOGNISED"));}}catch(La){throw La;}}function U(e,f){var n=M(e,f.right);"VariableDeclaration"===f.left.type&&M(e,f.left);var g=null,x="VariableDeclaration"===f.left.type?f.left.declarations[0].id.name:f.left.name;if(null!==e.localScope&&void 0!==e.localScope[x]&&(g=e.localScope[x]),null===g&&void 0!==e.globalScope[x]&&(g=e.globalScope[x]),null===
g)throw Error(k.nodeErrorMessage(f,"RUNTIME","VARIABLENOTDECLARED"));if(a.isArray(n)||a.isString(n)){for(var n=n.length,I=0;n>I;I++){g.value=I;x=M(e,f.body);if(x===a.breakResult)break;if(x instanceof a.ReturnResult)return x}return a.voidOperation}if(a.isImmutableArray(n)){for(I=0;I<n.length();I++){g.value=I;x=M(e,f.body);if(x===a.breakResult)break;if(x instanceof a.ReturnResult)return x}return a.voidOperation}if(!(n instanceof c||n instanceof t))return a.voidOperation;n=n.keys();for(I=0;I<n.length;I++){g.value=
n[I];x=M(e,f.body);if(x===a.breakResult)break;if(x instanceof a.ReturnResult)return x}}function N(e,f,n,g){switch(f){case "\x3d":return e===a.voidOperation?null:e;case "/\x3d":return a.toNumber(n)/a.toNumber(e);case "*\x3d":return a.toNumber(n)*a.toNumber(e);case "-\x3d":return a.toNumber(n)-a.toNumber(e);case "+\x3d":return a.isString(n)||a.isString(e)?a.toString(n)+a.toString(e):a.toNumber(n)+a.toNumber(e);case "%\x3d":return a.toNumber(n)%a.toNumber(e);default:throw Error(k.nodeErrorMessage(g,
"RUNTIME","OPERATORNOTRECOGNISED"));}}function W(e,f,n,g){switch(f=f.toLowerCase()){case "hasz":return e=e.hasZ,void 0===e?!1:e;case "hasm":return e=e.hasM,void 0===e?!1:e;case "spatialreference":return f=e.spatialReference._arcadeCacheId,void 0===f&&(n=!0,Object.freeze&&Object.isFrozen(e.spatialReference)&&(n=!1),n&&(L++,e.spatialReference._arcadeCacheId=L,f=L)),e=new c({wkt:e.spatialReference.wkt,wkid:e.spatialReference.wkid}),void 0!==f&&(e._arcadeCacheId="SPREF"+f.toString()),e}switch(e.type){case "extent":switch(f){case "xmin":case "xmax":case "ymin":case "ymax":case "zmin":case "zmax":case "mmin":case "mmax":return e=
e[f],void 0!==e?e:null;case "type":return"Extent"}break;case "polygon":switch(f){case "rings":return f=a.isVersion4?e.cache._arcadeCacheId:e.getCacheValue("_arcadeCacheId"),void 0===f&&(L++,f=L,a.isVersion4?e.cache._arcadeCacheId=f:e.setCacheValue("_arcadeCacheId",f)),e=new m(e.rings,e.spatialReference,!0===e.hasZ,!0===e.hasM,f);case "type":return"Polygon"}break;case "point":switch(f){case "x":case "y":case "z":case "m":return void 0!==e[f]?e[f]:null;case "type":return"Point"}break;case "polyline":switch(f){case "paths":return f=
a.isVersion4?e.cache._arcadeCacheId:e.getCacheValue("_arcadeCacheId"),void 0===f&&(L++,f=L,a.isVersion4?e.cache._arcadeCacheId=f:e.setCacheValue("_arcadeCacheId",f)),e=new m(e.paths,e.spatialReference,!0===e.hasZ,!0===e.hasM,f);case "type":return"Polyline"}break;case "multipoint":switch(f){case "points":return f=a.isVersion4?e.cache._arcadeCacheId:e.getCacheValue("_arcadeCacheId"),void 0===f&&(L++,f=L,a.isVersion4?e.cache._arcadeCacheId=f:e.setCacheValue("_arcadeCacheId",f)),e=new E(e.points,e.spatialReference,
!0===e.hasZ,!0===e.hasM,f,1);case "type":return"Multipoint"}}throw Error(k.nodeErrorMessage(g,"RUNTIME","PROPERTYNOTFOUND"));}function R(e,f){try{var n=M(e,f.object);if(null===n)throw Error(k.nodeErrorMessage(f,"RUNTIME","NOTFOUND"));if(!1===f.computed){if(n instanceof c||n instanceof t)return n.field(f.property.name);if(n instanceof J)return W(n,f.property.name,e,f);throw Error(k.nodeErrorMessage(f,"RUNTIME","INVALIDTYPE"));}var g=M(e,f.property);if(n instanceof c||n instanceof t){if(a.isString(g))return n.field(g);
throw Error(k.nodeErrorMessage(f,"RUNTIME","INVALIDTYPE"));}if(n instanceof J){if(a.isString(g))return W(n,g,e,f);throw Error(k.nodeErrorMessage(f,"RUNTIME","INVALIDTYPE"));}if(a.isArray(n)){if(a.isNumber(g)&&isFinite(g)&&Math.floor(g)===g){if(0>g&&(g=n.length+g),g>=n.length||0>g)throw Error(k.nodeErrorMessage(f,"RUNTIME","OUTOFBOUNDS"));return n[g]}throw Error(k.nodeErrorMessage(f,"RUNTIME","INVALIDTYPE"));}if(a.isString(n)){if(a.isNumber(g)&&isFinite(g)&&Math.floor(g)===g){if(0>g&&(g=n.length+g),
g>=n.length||0>g)throw Error(k.nodeErrorMessage(f,"RUNTIME","OUTOFBOUNDS"));return n[g]}throw Error(k.nodeErrorMessage(f,"RUNTIME","INVALIDTYPE"));}if(a.isImmutableArray(n)&&a.isNumber(g)&&isFinite(g)&&Math.floor(g)===g){if(0>g&&(g=n.length()+g),g>=n.length()||0>g)throw Error(k.nodeErrorMessage(f,"RUNTIME","OUTOFBOUNDS"));return n.get(g)}throw Error(k.nodeErrorMessage(f,"RUNTIME","INVALIDTYPE"));}catch(wa){throw wa;}}function V(e,f){try{var n=M(e,f.argument);if(a.isBoolean(n)){if("!"===f.operator)return!n;
if("-"===f.operator)return-1*a.toNumber(n);if("+"===f.operator)return 1*a.toNumber(n);throw Error(k.nodeErrorMessage(f,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"));}if("-"===f.operator)return-1*a.toNumber(n);if("+"===f.operator)return 1*a.toNumber(n);throw Error(k.nodeErrorMessage(f,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"));}catch(ka){throw ka;}}function Q(e,f){try{var n=[M(e,f.left),M(e,f.right)],g=n[0],x=n[1];switch(f.operator){case "\x3d\x3d":return a.equalityTest(g,x);case "\x3d":return a.equalityTest(g,
x);case "!\x3d":return!a.equalityTest(g,x);case "\x3c":return a.greaterThanLessThan(g,x,f.operator);case "\x3e":return a.greaterThanLessThan(g,x,f.operator);case "\x3c\x3d":return a.greaterThanLessThan(g,x,f.operator);case "\x3e\x3d":return a.greaterThanLessThan(g,x,f.operator);case "+":return a.isString(g)||a.isString(x)?a.toString(g)+a.toString(x):a.toNumber(g)+a.toNumber(x);case "-":return a.toNumber(g)-a.toNumber(x);case "*":return a.toNumber(g)*a.toNumber(x);case "/":return a.toNumber(g)/a.toNumber(x);
case "%":return a.toNumber(g)%a.toNumber(x);default:throw Error(k.nodeErrorMessage(f,"RUNTIME","OPERATORNOTRECOGNISED"));}}catch(ta){throw ta;}}function S(e,f){try{if("AssignmentExpression"===f.left.type||"UpdateExpression"===f.left.type)throw Error(k.nodeErrorMessage(f.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("AssignmentExpression"===f.right.type||"UpdateExpression"===f.right.type)throw Error(k.nodeErrorMessage(f.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));var n=M(e,f.left);
if(!a.isBoolean(n))throw Error(k.nodeErrorMessage(f,"RUNTIME","ONLYBOOLEAN"));switch(f.operator){case "||":if(!0===n)return n;var g=M(e,f.right);if(a.isBoolean(g))return g;throw Error(k.nodeErrorMessage(f,"RUNTIME","ONLYORORAND"));case "\x26\x26":if(!1===n)return n;g=M(e,f.right);if(a.isBoolean(g))return g;throw Error(k.nodeErrorMessage(f,"RUNTIME","ONLYORORAND"));default:throw Error(k.nodeErrorMessage(f,"RUNTIME","ONLYORORAND"));}}catch(wa){throw wa;}}function X(e,f){var n;try{var g=f.name.toLowerCase();
if(null!==e.localScope&&void 0!==e.localScope[g])return n=e.localScope[g],!0===n.valueset?n.value:(n.value=M(e,n.node),n.valueset=!0,n.value);if(void 0!==e.globalScope[g])return n=e.globalScope[g],!0===n.valueset?n.value:(n.value=M(e,n.node),n.valueset=!0,n.value);throw Error(k.nodeErrorMessage(f,"RUNTIME","VARIABLENOTFOUND"));}catch(wa){throw wa;}}function z(e,f){try{if("Identifier"!==f.callee.type)throw Error(k.nodeErrorMessage(f,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==e.localScope&&void 0!==
e.localScope[f.callee.name.toLowerCase()]){var g=e.localScope[f.callee.name.toLowerCase()];if(g.value instanceof a.NativeFunction)return g.value.fn(e,f);if(g.value instanceof C)return n(e,f,g.value.definition);throw Error(k.nodeErrorMessage(f,"RUNTIME","NOTAFUNCTION"));}if(void 0!==e.globalScope[f.callee.name.toLowerCase()]){g=e.globalScope[f.callee.name.toLowerCase()];if(g.value instanceof a.NativeFunction)return g.value.fn(e,f);if(g.value instanceof C)return n(e,f,g.value.definition);throw Error(k.nodeErrorMessage(f,
"RUNTIME","NOTAFUNCTION"));}throw Error(k.nodeErrorMessage(f,"RUNTIME","NOTFOUND"));}catch(ka){throw ka;}}function Z(e){return null==e?"":a.isArray(e)?"Array":a.isImmutableArray(e)?"Array":a.isDate(e)?"Date":a.isString(e)?"String":a.isBoolean(e)?"Boolean":a.isNumber(e)?"Number":e instanceof c?"Dictionary":e instanceof t?"Feature":e instanceof h?"Point":e instanceof w?"Polygon":e instanceof l?"Polyline":e instanceof u?"Multipoint":e instanceof d?"Extent":a.isFunctionParameter(e)?"Function":e===a.voidOperation?
"":"number"==typeof e&&isNaN(e)?"Number":"Unrecognised Type"}function O(e,f,n,g){try{var x=M(e,f.arguments[n]);if(a.equalityTest(x,g))return M(e,f.arguments[n+1]);var I=f.arguments.length-n;return 1===I?M(e,f.arguments[n]):2===I?null:3===I?M(e,f.arguments[n+2]):O(e,f,n+2,g)}catch(sa){throw sa;}}function g(e,f,n,x){try{if(!0===x)return M(e,f.arguments[n+1]);if(3===f.arguments.length-n)return M(e,f.arguments[n+2]);var I=M(e,f.arguments[n+2]);if(!1===a.isBoolean(I))throw Error("WHEN needs boolean test conditions");
return g(e,f,n+2,I)}catch(ta){throw ta;}}function e(f,n){var g=f.length,x=Math.floor(g/2);if(0===g)n=[];else if(1===g)n=[f[0]];else{var I=e(f.slice(0,x),n);f=e(f.slice(x,g),n);for(g=[];0<I.length||0<f.length;)0<I.length&&0<f.length?(x=n(I[0],f[0]),isNaN(x)&&(x=0),0>=x?(g.push(I[0]),I=I.slice(1)):(g.push(f[0]),f=f.slice(1))):0<I.length?(g.push(I[0]),I=I.slice(1)):0<f.length&&(g.push(f[0]),f=f.slice(1));n=g}return n}function f(e,f,n){try{var g=e.body;if(n.length!==e.params.length)throw Error("Invalid Parameter calls to function.");
for(var x=0;x<n.length;x++)f.localScope[e.params[x].name.toLowerCase()]={value:n[x],valueset:!0,node:null};var I=M(f,g);if(I instanceof a.ReturnResult)return I.value;if(I===a.breakResult)throw Error("Cannot Break from a Function");if(I===a.continueResult)throw Error("Cannot Continue from a Function");return I instanceof a.ImplicitResult?I.value:I}catch(sa){throw sa;}}function n(e,n,g){return K(e,n,function(n,x,I){n={spatialReference:e.spatialReference,applicationCache:void 0===e.applicationCache?
null:e.applicationCache,globalScope:e.globalScope,depthCounter:e.depthCounter+1,console:e.console,localScope:{}};if(64<n.depthCounter)throw Error("Exceeded maximum function depth");return f(g,n,I)})}function x(e){return function(){var n={applicationCache:void 0===e.context.applicationCache?null:e.context.applicationCache,spatialReference:e.context.spatialReference,console:e.context.console,localScope:{},depthCounter:e.context.depthCounter+1,globalScope:e.context.globalScope};if(64<n.depthCounter)throw Error("Exceeded maximum function depth");
return f(e.definition,n,arguments)}}function I(e){console.log(e)}Object.defineProperty(p,"__esModule",{value:!0});var L=0,P={};q.registerFunctions(P,K);v.registerFunctions(P,K);y.registerFunctions(P,K);B.registerFunctions(P,K);b.registerFunctions(P,K);D.registerFunctions(P,K);P["typeof"]=function(e,f){return K(e,f,function(e,f,n){a.pcCheck(n,1,1);e=Z(n[0]);if("Unrecognised Type"===e)throw Error("Unrecognised Type");return e})};P.iif=function(e,f){try{a.pcCheck(null===f.arguments?[]:f.arguments,3,
3);var n=M(e,f.arguments[0]);if(!1===a.isBoolean(n))throw Error("IF Function must have a boolean test condition");return!0===n?M(e,f.arguments[1]):M(e,f.arguments[2])}catch(ka){throw ka;}};P.decode=function(e,f){try{if(2>f.arguments.length)throw Error("Missing Parameters");if(2===f.arguments.length)return M(e,f.arguments[1]);if(0===(f.arguments.length-1)%2)throw Error("Must have a default value result.");var n=M(e,f.arguments[0]);return O(e,f,1,n)}catch(ka){throw ka;}};P.when=function(e,f){try{if(3>
f.arguments.length)throw Error("Missing Parameters");if(0===f.arguments.length%2)throw Error("Must have a default value result.");var n=M(e,f.arguments[0]);if(!1===a.isBoolean(n))throw Error("WHEN needs boolean test conditions");return g(e,f,0,n)}catch(ka){throw ka;}};P.top=function(e,f){return K(e,f,function(e,f,n){if(a.pcCheck(n,2,2),a.isArray(n[0]))return a.toNumber(n[1])>=n[0].length?n[0].slice(0):n[0].slice(0,a.toNumber(n[1]));if(a.isImmutableArray(n[0]))return a.toNumber(n[1])>=n[0].length()?
n[0].slice(0):n[0].slice(0,a.toNumber(n[1]));throw Error("Top cannot accept this parameter type");})};P.first=function(e,f){return K(e,f,function(e,f,n){return a.pcCheck(n,1,1),a.isArray(n[0])?0===n[0].length?null:n[0][0]:a.isImmutableArray(n[0])?0===n[0].length()?null:n[0].get(0):null})};P.sort=function(f,n){return K(f,n,function(f,n,g){a.pcCheck(g,1,2);f=g[0];if(a.isImmutableArray(f)&&(f=f.toArray()),!1===a.isArray(f))throw Error("Illegal Argument");if(1<g.length){if(!1===a.isFunctionParameter(g[1]))throw Error("Illegal Argument");
var I=x(g[1]);return f=e(f,function(e,f){return I(e,f)})}if(0===f.length)return[];g={};for(n=0;n<f.length;n++){var z=Z(f[n]);""!==z&&(g[z]=!0)}if(!0===g.Array||!0===g.Dictionary||!0===g.Feature||!0===g.Point||!0===g.Polygon||!0===g.Polyline||!0===g.Multipoint||!0===g.Extent||!0===g.Function)return f.slice(0);n=0;var z="",L;for(L in g)n++,z=L;return f=1<n||"String"===z?e(f,function(e,f){if(null===e||void 0===e||e===a.voidOperation)return null===f||void 0===f||f===a.voidOperation?0:1;if(null===f||void 0===
f||f===a.voidOperation)return-1;e=a.toString(e);f=a.toString(f);return f>e?-1:e===f?0:1}):"Number"===z?e(f,function(e,f){return e-f}):"Boolean"===z?e(f,function(e,f){return e===f?0:f?-1:1}):"Date"===z?e(f,function(e,f){return f-e}):f.slice(0)})};for(var Y in P)P[Y]={value:new a.NativeFunction(P[Y]),valueset:!0,node:null};var fa=function(){};fa.prototype=P;fa.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null};fa.prototype.pi={value:Math.PI,valueset:!0,node:null};p.functionHelper=
{fixSpatialReference:a.fixSpatialReference,parseArguments:G,standardFunction:K};p.extend=function(e){for(var f={mode:"sync",compiled:!1,functions:{},signatures:[],standardFunction:K,evaluateIdentifier:X,arcadeCustomFunctionHandler:x},n=0;n<e.length;n++)e[n].registerFunctions(f);for(var g in f.functions)P[g]={value:new a.NativeFunction(f.functions[g]),valueset:!0,node:null},fa.prototype[g]=P[g];for(n=0;n<f.signatures.length;n++)k.addFunctionDeclaration(f.signatures[n],"f")};p.executeScript=function(e,
f,n){n||(n=new r(102100));var g=f.vars,x=f.customfunctions,z=new fa;g||(g={});x||(x={});var L=new c({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});L.immutable=!1;z.textformatting={value:L,valueset:!0,node:null};for(var b in x)z[b]={value:new a.NativeFunction(x[b]),"native":!0,valueset:!0,node:null};for(b in g)g[b]&&"esri.Graphic"===g[b].declaredClass?z[b]={value:new t(g[b]),valueset:!0,node:null}:z[b]={value:g[b],valueset:!0,node:null};e=M({spatialReference:n,
globalScope:z,localScope:null,console:f.console?f.console:I,depthCounter:1,applicationCache:void 0===f.applicationCache?null:f.applicationCache},e.body[0].body);if(e instanceof a.ReturnResult&&(e=e.value),e instanceof a.ImplicitResult&&(e=e.value),e===a.voidOperation&&(e=null),e===a.breakResult)throw Error("Cannot return BREAK");if(e===a.continueResult)throw Error("Cannot return CONTINUE");if(e instanceof C)throw Error("Cannot return FUNCTION");if(e instanceof a.NativeFunction)throw Error("Cannot return FUNCTION");
return e};p.extractFieldLiterals=function(e,f){return void 0===f&&(f=!1),k.findFieldLiterals(e,f)};p.validateScript=function(e,f){return k.validateScript(e,f,"simple")};p.referencesMember=function(e,f){return k.referencesMember(e,f)};p.referencesFunction=function(e,f){return k.referencesFunction(e,f)};p.findFunctionCalls=function(e){return k.findFunctionCalls(e,!1)}})},"esri/geometry/Polygon":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ../core/lang ./Geometry ./Extent ./Point ./SpatialReference ./support/webMercatorUtils ./support/zmUtils ./support/coordsUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C){function q(a){return function(c,b){return null==c?b:null==b?c:a(c,b)}}var v=q(Math.min),y=q(Math.max);A=function(q){function D(){for(var b=[],a=0;a<arguments.length;a++)b[a]=arguments[a];b=q.apply(this,b)||this;return b.rings=[],b.type="polygon",b}return w(D,q),b=D,D.createEllipse=function(m){var a=m.center.x,c=m.center.y,D=m.center.z,k=m.center.m,d=m.center.hasZ,q=m.center.hasM,t=m.longAxis,v=m.shortAxis,y=m.numberOfPoints;m=m.view;for(var B=[],h=2*Math.PI/y,r=
d?3:2,C=0;y>C;C++){var z=m.toMap(t*Math.cos(C*h)+a,v*Math.sin(C*h)+c),z=[z.x,z.y];d&&(z[2]=D);q&&(z[r]=k);B.push(z)}B.push(B[0]);return new b({rings:[B],spatialReference:m.spatialReference})},D.createCircle=function(m){return b.createEllipse({center:m.center,longAxis:m.r,shortAxis:m.r,numberOfPoints:m.numberOfPoints,view:m.view})},D.fromExtent=function(m){var a=m.clone().normalize();m=m.spatialReference;var c=!1,D=!1;a.map(function(b){b.hasZ&&(c=!0);b.hasM&&(D=!0)});a={rings:a.map(function(b){var m=
[[b.xmin,b.ymin],[b.xmin,b.ymax],[b.xmax,b.ymax],[b.xmax,b.ymin],[b.xmin,b.ymin]];if(c&&b.hasZ)for(var a=(b.zmax-b.zmin)/2,k=0;k<m.length;k++)m[k].push(a);if(D&&b.hasM)for(b=(b.mmax-b.mmin)/2,k=0;k<m.length;k++)m[k].push(b);return m}),spatialReference:m};return c&&(a.hasZ=!0),D&&(a.hasM=!0),new b(a)},D.prototype.normalizeCtorArgs=function(b,a){var m,c,D=null,E=null;return b&&!Array.isArray(b)?(D=b.rings?b.rings:null,a||(b.spatialReference?a=b.spatialReference:b.rings||(a=b)),m=b.hasZ,c=b.hasM):D=
b,D=D||[],a=a||k.WGS84,D.length&&D[0]&&null!=D[0][0]&&"number"==typeof D[0][0]&&(D=[D]),E=D[0]&&D[0][0],E&&(void 0===m&&void 0===c?(m=2<E.length,c=!1):void 0===m?m=!c&&3<E.length:void 0===c&&(c=!m&&3<E.length)),{rings:D,spatialReference:a,hasZ:m,hasM:c}},Object.defineProperty(D.prototype,"centroid",{get:function(){var b=C.ringsCentroid([],this.rings,this.hasZ);if(isNaN(b[0])||isNaN(b[1])||this.hasZ&&isNaN(b[2]))return null;var c=new a;return c.x=b[0],c.y=b[1],c.spatialReference=this.spatialReference,
this.hasZ&&(c.z=b[2]),c},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"extent",{get:function(){var b=this.hasZ,a=this.hasM,c=this.spatialReference,D=this.rings,k=b?3:2;if(!D.length||!D[0].length)return null;for(var d=D[0][0],q=d[0],d=d[1],t=D[0][0],B=t[0],t=t[1],h=void 0,C=void 0,l=void 0,u=void 0,p=[],z=0;z<D.length;z++){for(var w=D[z],O=w[0],g=O[0],O=O[1],e=w[0],f=e[0],e=e[1],n=void 0,x=void 0,I=void 0,L=void 0,P=0;P<w.length;P++){var Y=w[P],fa=Y[0],ga=Y[1];if(q=v(q,fa),d=v(d,
ga),B=y(B,fa),t=y(t,ga),g=v(g,fa),O=v(O,ga),f=y(f,fa),e=y(e,ga),b&&2<Y.length)fa=Y[2],h=v(h,fa),C=y(C,fa),n=v(n,fa),x=y(x,fa);a&&Y.length>k&&(L=Y[k],l=v(h,L),u=y(C,L),I=v(n,L),L=y(x,L))}p.push(new r({xmin:g,ymin:O,zmin:n,mmin:I,xmax:f,ymax:e,zmax:x,mmax:L,spatialReference:c}))}D=new r;return D.xmin=q,D.ymin=d,D.xmax=B,D.ymax=t,D.spatialReference=c,b&&(D.zmin=h,D.zmax=C),a&&(D.mmin=l,D.mmax=u),D.cache._partwise=1<p.length?p:null,D},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,
"isSelfIntersecting",{get:function(){return C.isSelfIntersecting(this.rings)},enumerable:!0,configurable:!0}),D.prototype.writePaths=function(b,a,c,D){a.rings=d.clone(this.rings)},D.prototype.addRing=function(b){if(b){this.clearCache();var m=this.rings,a=m.length;if(Array.isArray(b[0]))m[a]=b.concat();else{for(var c=[],D=0,k=b.length;k>D;D++)c[D]=b[D].toArray();m[a]=c}return this}},D.prototype.clone=function(){var m=new b;return m.spatialReference=this.spatialReference,m.rings=d.clone(this.rings),
m.hasZ=this.hasZ,m.hasM=this.hasM,m},D.prototype.contains=function(b){return b?(c.canProject(b,this.spatialReference)&&(b=c.project(b,this.spatialReference)),C.contains(this.rings,C.geometryToCoordinates(b))):!1},D.prototype.isClockwise=function(b){var m,a=this;return m=Array.isArray(b[0])?b:b.map(function(b){return a.hasZ?a.hasM?[b.x,b.y,b.z,b.m]:[b.x,b.y,b.z]:[b.x,b.y]}),C.isClockwise(m,this.hasM,this.hasZ)},D.prototype.getPoint=function(b,c){if(!this._validateInputs(b,c))return null;b=this.rings[b][c];
c=this.hasZ;var m=this.hasM;return c&&!m?new a(b[0],b[1],b[2],void 0,this.spatialReference):m&&!c?new a(b[0],b[1],void 0,b[2],this.spatialReference):c&&m?new a(b[0],b[1],b[2],b[3],this.spatialReference):new a(b[0],b[1],this.spatialReference)},D.prototype.insertPoint=function(b,a,c){return this._validateInputs(b,a,!0)?(this.clearCache(),t.updateSupportFromPoint(this,c),Array.isArray(c)||(c=c.toArray()),this.rings[b].splice(a,0,c),this):this},D.prototype.removePoint=function(b,c){return this._validateInputs(b,
c)?(this.clearCache(),new a(this.rings[b].splice(c,1)[0],this.spatialReference)):null},D.prototype.removeRing=function(b){if(!this._validateInputs(b,null))return null;this.clearCache();b=this.rings.splice(b,1)[0];var m=this.spatialReference;return b.map(function(b){return new a(b,m)})},D.prototype.setPoint=function(b,a,c){return this._validateInputs(b,a)?(this.clearCache(),t.updateSupportFromPoint(this,c),Array.isArray(c)||(c=c.toArray()),this.rings[b][a]=c,this):this},D.prototype._validateInputs=
function(b,a,c){if((void 0===c&&(c=!1),null==b||null==a)||0>b||b>=this.rings.length)return!1;b=this.rings[b];return c&&0>a||a>b.length?!1:0>a||a>=b.length?!1:!0},D.prototype.toJSON=function(b){return this.write(null,b)},l([h.property({dependsOn:["hasM","hasZ","rings"]})],D.prototype,"cache",void 0),l([h.property({readOnly:!0,dependsOn:["cache"]})],D.prototype,"centroid",null),l([h.property({dependsOn:["cache"],readOnly:!0})],D.prototype,"extent",null),l([h.property({dependsOn:["cache"],readOnly:!0})],
D.prototype,"isSelfIntersecting",null),l([h.property({type:[[[Number]]],json:{write:{isRequired:!0}}})],D.prototype,"rings",void 0),l([h.writer("rings")],D.prototype,"writePaths",null),D=b=l([h.subclass("esri.geometry.Polygon")],D);var b}(h.declared(u));return A.prototype.toJSON.isDefaultToJSON=!0,A})},"esri/geometry/support/zmUtils":function(){define(["require","exports"],function(A,p){Object.defineProperty(p,"__esModule",{value:!0});p.updateSupportFromPoint=function(p,l,h){void 0===h&&(h=!1);var d=
p.hasM,u=p.hasZ;Array.isArray(l)?4!==l.length||d||u?3===l.length&&h&&!d?(u=!0,d=!1):3===l.length&&d&&u&&(d=!1,u=!1):(d=!0,u=!0):(u=!u&&l.hasZ&&(!d||l.hasM),d=!d&&l.hasM&&(!u||l.hasZ));p.hasZ=u;p.hasM=d}})},"esri/geometry/Polyline":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ../core/lang ./Geometry ./Extent ./Point ./SpatialReference ./support/zmUtils".split(" "),function(A,p,w,l,h,d,u,r,a,k,c){function t(a){return function(c,
k){return null==c?k:null==k?c:a(c,k)}}var C=t(Math.min),q=t(Math.max);A=function(t){function v(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];a=t.apply(this,a)||this;return a.paths=[],a.type="polyline",a}return w(v,t),B=v,v.prototype.normalizeCtorArgs=function(a,b){var m,c,D=null,d=null;return a&&!Array.isArray(a)?(D=a.paths?a.paths:null,b||(a.spatialReference?b=a.spatialReference:a.paths||(b=a)),m=a.hasZ,c=a.hasM):D=a,D=D||[],b=b||k.WGS84,D.length&&D[0]&&null!=D[0][0]&&"number"==typeof D[0][0]&&
(D=[D]),d=D[0]&&D[0][0],d&&(void 0===m&&void 0===c?(m=2<d.length,c=!1):void 0===m?m=!c&&3<d.length:void 0===c&&(c=!m&&3<d.length)),{paths:D,spatialReference:b,hasZ:m,hasM:c}},Object.defineProperty(v.prototype,"extent",{get:function(){var a=this.hasZ,b=this.hasM,m=this.spatialReference,c=this.paths,k=a?3:2;if(!c.length||!c[0].length)return null;for(var d=c[0][0],t=d[0],d=d[1],v=c[0][0],y=v[0],v=v[1],B=void 0,h=void 0,l=void 0,u=void 0,p=[],w=0;w<c.length;w++){for(var X=c[w],z=X[0],Z=z[0],z=z[1],O=
X[0],g=O[0],O=O[1],e=void 0,f=void 0,n=void 0,x=void 0,I=0;I<X.length;I++){var L=X[I],P=L[0],Y=L[1];if(t=C(t,P),d=C(d,Y),y=q(y,P),v=q(v,Y),Z=C(Z,P),z=C(z,Y),g=q(g,P),O=q(O,Y),a&&2<L.length)P=L[2],B=C(B,P),h=q(h,P),e=C(e,P),f=q(f,P);b&&L.length>k&&(x=L[k],l=C(B,x),u=q(h,x),n=C(e,x),x=q(f,x))}p.push(new r({xmin:Z,ymin:z,zmin:e,mmin:n,xmax:g,ymax:O,zmax:f,mmax:x,spatialReference:m}))}c=new r;return c.xmin=t,c.ymin=d,c.xmax=y,c.ymax=v,c.spatialReference=m,a&&(c.zmin=B,c.zmax=h),b&&(c.mmin=l,c.mmax=u),
c.cache._partwise=1<p.length?p:null,c},enumerable:!0,configurable:!0}),v.prototype.writePaths=function(a,b,m,c){b.paths=d.clone(this.paths)},v.prototype.addPath=function(a){if(a){this.clearCache();var b=this.paths,m=b.length;if(Array.isArray(a[0]))b[m]=a.concat();else{for(var c=[],D=0,k=a.length;k>D;D++)c[D]=a[D].toArray();b[m]=c}return this}},v.prototype.clone=function(){var a=new B;return a.spatialReference=this.spatialReference,a.paths=d.clone(this.paths),a.hasZ=this.hasZ,a.hasM=this.hasM,a},v.prototype.getPoint=
function(c,b){if(!this._validateInputs(c,b))return null;c=this.paths[c][b];b=this.hasZ;var m=this.hasM;return b&&!m?new a(c[0],c[1],c[2],void 0,this.spatialReference):m&&!b?new a(c[0],c[1],void 0,c[2],this.spatialReference):b&&m?new a(c[0],c[1],c[2],c[3],this.spatialReference):new a(c[0],c[1],this.spatialReference)},v.prototype.insertPoint=function(a,b,m){return this._validateInputs(a,b,!0)?(this.clearCache(),c.updateSupportFromPoint(this,m),Array.isArray(m)||(m=m.toArray()),this.paths[a].splice(b,
0,m),this):this},v.prototype.removePath=function(c){if(!this._validateInputs(c,null))return null;this.clearCache();c=this.paths.splice(c,1)[0];var b=this.spatialReference;return c.map(function(m){return new a(m,b)})},v.prototype.removePoint=function(c,b){return this._validateInputs(c,b)?(this.clearCache(),new a(this.paths[c].splice(b,1)[0],this.spatialReference)):null},v.prototype.setPoint=function(a,b,m){return this._validateInputs(a,b)?(this.clearCache(),c.updateSupportFromPoint(this,m),Array.isArray(m)||
(m=m.toArray()),this.paths[a][b]=m,this):this},v.prototype._validateInputs=function(a,b,m){if((void 0===m&&(m=!1),null==a||null==b)||0>a||a>=this.paths.length)return!1;a=this.paths[a];return m&&0>b||b>a.length?!1:0>b||b>=a.length?!1:!0},v.prototype.toJSON=function(a){return this.write(null,a)},l([h.property({dependsOn:["hasM","hasZ","paths"]})],v.prototype,"cache",void 0),l([h.property({dependsOn:["cache"],readOnly:!0})],v.prototype,"extent",null),l([h.property({type:[[[Number]]],json:{write:{isRequired:!0}}})],
v.prototype,"paths",void 0),l([h.writer("paths")],v.prototype,"writePaths",null),v=B=l([h.subclass("esri.geometry.Polyline")],v);var B}(h.declared(u));return A.prototype.toJSON.isDefaultToJSON=!0,A})},"esri/geometry/Multipoint":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./Geometry ./Extent ./Point ../core/lang ./support/zmUtils".split(" "),function(A,p,w,l,h,d,u,r,a,k){function c(a){return function(c,
k){return null==c?k:null==k?c:a(c,k)}}A=function(d){function t(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];a=d.apply(this,a)||this;return a.points=[],a.type="multipoint",a}return w(t,d),q=t,t.prototype.normalizeCtorArgs=function(a,c){if(!a&&!c)return null;var k={};Array.isArray(a)?(k.points=a,k.spatialReference=c):!a||"esri.SpatialReference"!==a.declaredClass&&null==a.wkid?(a.points&&(k.points=a.points),a.spatialReference&&(k.spatialReference=a.spatialReference),a.hasZ&&(k.hasZ=a.hasZ),
a.hasM&&(k.hasM=a.hasM)):k.spatialReference=a;a=k.points&&k.points[0];return a&&(void 0===k.hasZ&&void 0===k.hasM?(k.hasZ=2<a.length,k.hasM=!1):void 0===k.hasZ?k.hasZ=3<a.length:void 0===k.hasM&&(k.hasM=3<a.length)),k},Object.defineProperty(t.prototype,"extent",{get:function(){var a=this.points;if(!a.length)return null;for(var k,d,D,b,m=new u,E=this.hasZ,q=this.hasM,t=E?3:2,h=a[0],r=c(Math.min),C=c(Math.max),l=h[0],p=h[1],w=h[0],h=h[1],A=0,Q=a.length;Q>A;A++){var S=a[A],X=S[0],z=S[1];if(l=r(l,X),
p=r(p,z),w=C(w,X),h=C(h,z),E&&2<S.length)X=S[2],k=r(k,X),D=C(D,X);q&&S.length>t&&(S=S[t],d=r(d,S),b=C(b,S))}return m.xmin=l,m.ymin=p,m.xmax=w,m.ymax=h,m.spatialReference=this.spatialReference,E?(m.zmin=k,m.zmax=D):(m.zmin=null,m.zmax=null),q?(m.mmin=d,m.mmax=b):(m.mmin=null,m.mmax=null),m},enumerable:!0,configurable:!0}),t.prototype.writePoints=function(c,k,d,D){k.points=a.clone(this.points)},t.prototype.addPoint=function(a){return this.clearCache(),k.updateSupportFromPoint(this,a),Array.isArray(a)?
this.points.push(a):this.points.push(a.toArray()),this},t.prototype.clone=function(){var c={points:a.clone(this.points),spatialReference:this.spatialReference};return this.hasZ&&(c.hasZ=!0),this.hasM&&(c.hasM=!0),new q(c)},t.prototype.getPoint=function(a){if(!this._validateInputs(a))return null;a=this.points[a];var c={x:a[0],y:a[1],spatialReference:this.spatialReference},k=2;return this.hasZ&&(c.z=a[2],k=3),this.hasM&&(c.m=a[k]),new r(c)},t.prototype.removePoint=function(a){return this._validateInputs(a)?
(this.clearCache(),new r(this.points.splice(a,1)[0],this.spatialReference)):null},t.prototype.setPoint=function(a,c){return this._validateInputs(a)?(this.clearCache(),k.updateSupportFromPoint(c),this.points[a]=c.toArray(),this):this},t.prototype.toJSON=function(a){return this.write(null,a)},t.prototype._validateInputs=function(a){return null!=a&&0<=a&&a<this.points.length},l([h.property({dependsOn:["points","hasZ","hasM","spatialReference"]})],t.prototype,"cache",void 0),l([h.property({dependsOn:["cache"]})],
t.prototype,"extent",null),l([h.property({type:[[Number]],json:{write:{isRequired:!0}}})],t.prototype,"points",void 0),l([h.writer("points")],t.prototype,"writePoints",null),t=q=l([h.subclass("esri.geometry.Multipoint")],t);var q}(h.declared(d));return A.prototype.toJSON.isDefaultToJSON=!0,A})},"esri/arcade/languageUtils":function(){define("require exports ../geometry/Geometry ../moment dojo/number ./ImmutableArray ../kernel ./ImmutablePointArray ./ImmutablePathArray dojo/_base/array ../geometry/Point ../geometry/Polyline ../geometry/Polygon ../geometry/Extent ../geometry/Multipoint ./FunctionWrapper".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y){function B(e,f,n){if(""===f||null===f||void 0===f||f===n||f===n)return e;do e=e.replace(f,n);while(-1!==e.indexOf(f));return e}function D(e){return e instanceof O||e instanceof y||e instanceof g}function b(e){return"string"==typeof e||e instanceof String}function m(e){return"boolean"==typeof e}function E(e){return"number"==typeof e}function J(e){return e instanceof Array}function G(e){return e instanceof Date}function K(e,f){return!1===isNaN(e)?void 0===f||
null===f||""===f?e.toString():(f=B(f,"\u2030",""),f=B(f,"\u00a4",""),h.format(e,{pattern:f})):e.toString()}function M(e,f){e=l(e);return void 0===f||null===f||""===f?e.format():e.format(U(f))}function U(e){return e.replace(/(LTS)|L|l/g,function(e){return"["+e+"]"})}function N(e,f,n){switch(n){case "\x3e":return e>f;case "\x3c":return f>e;case "\x3e\x3d":return e>=f;case "\x3c\x3d":return f>=e}return!1}function W(e,f){if(e===f||null===e&&f===p.voidOperation||null===f&&e===p.voidOperation)return!0;
if(G(e)&&G(f))return e.getTime()===f.getTime();if(e instanceof a||e instanceof r)return e.equalityTest(f);if(e instanceof c&&f instanceof c){var n=void 0,g=void 0;if(p.isVersion4?(n=e.cache._arcadeCacheId,g=f.cache._arcadeCacheId):(n=e.getCacheValue("_arcadeCacheId"),g=f.getCacheValue("_arcadeCacheId")),void 0!==n&&null!==n)return n===g}return void 0!==e&&void 0!==f&&null!==e&&null!==f&&"object"==typeof e&&"object"==typeof f&&(e._arcadeCacheId===f._arcadeCacheId&&void 0!==e._arcadeCacheId&&null!==
e._arcadeCacheId||e._underlyingGraphic===f._underlyingGraphic&&void 0!==e._underlyingGraphic&&null!==e._underlyingGraphic)?!0:!1}function R(e,f){if(b(e))return e;if(null===e)return"";if(E(e))return K(e,f);if(m(e))return e.toString();if(G(e))return M(e,f);if(e instanceof w)return JSON.stringify(e.toJSON());if(J(e)){f=[];for(var n=0;n<e.length;n++)f[n]=Q(e[n]);return"["+f.join(",")+"]"}if(e instanceof d){f=[];for(n=0;n<e.length();n++)f[n]=Q(e.get(n));return"["+f.join(",")+"]"}return null!==e&&"object"==
typeof e&&void 0!==e.castToText?e.castToText():D(e)?"object, Function":(e===p.voidOperation,"")}function V(e,f){if(b(e))return e;if(null===e)return"";if(E(e))return K(e,f);if(m(e))return e.toString();if(G(e))return M(e,f);if(e instanceof w)return e instanceof q?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+
",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+z(e.spatialReference)+"}":z(e.toJSON(),function(e,f){return e.key===f.key?0:"spatialReference"===e.key?1:"spatialReference"===f.key?-1:e.key<f.key?-1:e.key>f.key?1:0});if(J(e)){f=[];for(var n=0;n<e.length;n++)f[n]=Q(e[n]);return"["+f.join(",")+"]"}if(e instanceof d){f=[];for(n=0;n<e.length();n++)f[n]=Q(e.get(n));return"["+f.join(",")+"]"}return null!==e&&"object"==typeof e&&void 0!==e.castToText?e.castToText():D(e)?"object, Function":
(e===p.voidOperation,"")}function Q(e){return null===e?"null":m(e)||E(e)||b(e)?JSON.stringify(e):e instanceof w||e instanceof d||e instanceof Array?V(e):e instanceof Date?JSON.stringify(M(e,"")):null!==e&&"object"==typeof e&&void 0!==e.castToText?e.castToText():"null"}function S(e,f){return E(e)?e:null===e?0:""===e?0:G(e)?NaN:m(e)?e?1:0:J(e)?NaN:""===e?NaN:void 0===e?NaN:void 0!==f&&b(e)?(f=B(f,"\u2030",""),f=B(f,"\u00a4",""),h.parse(e,{pattern:f})):e===p.voidOperation?0:Number(e)}function X(e,f){var n;
return k.some(f.fields,function(f){return f.name===e&&(n=f.domain),!!n}),n}function z(e,f){f||(f={});"function"==typeof f&&(f={cmp:f});var n="boolean"==typeof f.cycles?f.cycles:!1,g=f.cmp&&function(e){return function(f){return function(n,g){return e({key:n,value:f[n]},{key:g,value:f[g]})}}}(f.cmp),I=[];return function P(e){if(e&&e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON()),void 0!==e){if("number"==typeof e)return isFinite(e)?""+e:"null";if("object"!=typeof e)return JSON.stringify(e);var f,
x;if(Array.isArray(e)){x="[";for(f=0;f<e.length;f++)f&&(x+=","),x+=P(e[f])||"null";return x+"]"}if(null===e)return"null";if(-1!==I.indexOf(e)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON");}var z=I.push(e)-1,b=Object.keys(e).sort(g&&g(e));x="";for(f=0;f<b.length;f++){var a=b[f],m=P(e[a]);m&&(x&&(x+=","),x+=JSON.stringify(a)+":"+m)}return I.splice(z,1),"{"+x+"}"}}(e)}Object.defineProperty(p,"__esModule",{value:!0});A=function(){return function(e){this.value=
e}}();var Z=function(){return function(e){this.value=e}}(),O=function(){return function(e){this.fn=e}}(),g=function(){return function(e){this.fn=e}}();p.NativeFunction=O;p.ImplicitResult=Z;p.ReturnResult=A;p.SizzleFunction=g;p.isVersion4=0===u.version.indexOf("4.");p.voidOperation={type:"VOID"};p.breakResult={type:"BREAK"};p.continueResult={type:"CONTINUE"};p.multiReplace=B;p.isFunctionParameter=D;p.isSimpleType=function(e){return b(e)?!0:E(e)?!0:G(e)?!0:m(e)?!0:null===e?!0:e===p.voidOperation?!0:
"number"==typeof e?!0:!1};p.defaultUndefined=function(e,f){return void 0===e?f:e};p.isString=b;p.isBoolean=m;p.isNumber=E;p.isArray=J;p.isFeatureCursor=function(e){return e&&void 0!==e.isFeatureCursor};p.isImmutableArray=function(e){return e instanceof d};p.isDate=G;p.pcCheck=function(e,f,n){if(e.length<f||e.length>n)throw Error("Function called with wrong number of Parameters");};p.generateUUID=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(f){var n=
(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===f?n:3&n|8).toString(16)})};p.formatNumber=K;p.formatDate=M;p.standardiseDateFormat=U;p.greaterThanLessThan=function(e,f,n){if(null===e){if(null===f||f===p.voidOperation)return N(null,null,n);if(E(f))return N(0,f,n);if(b(f)||m(f))return N(0,S(f),n);if(G(f))return N(0,f.getTime(),n)}if(e===p.voidOperation){if(null===f||f===p.voidOperation)return N(null,null,n);if(E(f))return N(0,f,n);if(b(f)||m(f))return N(0,S(f),n);if(G(f))return N(0,f.getTime(),
n)}else if(E(e)){if(E(f))return N(e,f,n);if(m(f))return N(e,S(f),n);if(null===f||f===p.voidOperation)return N(e,0,n);if(b(f))return N(e,S(f),n);if(G(f))return N(e,f.getTime(),n)}else if(b(e)){if(b(f))return N(R(e),R(f),n);if(G(f))return N(S(e),f.getTime(),n);if(E(f))return N(S(e),f,n);if(null===f||f===p.voidOperation)return N(S(e),0,n);if(m(f))return N(S(e),S(f),n)}else if(G(e)){if(G(f))return N(e,f,n);if(null===f||f===p.voidOperation)return N(e.getTime(),0,n);if(E(f))return N(e.getTime(),f,n);if(m(f)||
b(f))return N(e.getTime(),S(f),n)}else if(m(e)){if(m(f))return N(e,f,n);if(E(f))return N(S(e),S(f),n);if(G(f))return N(S(e),f.getTime(),n);if(null===f||f===p.voidOperation)return N(S(e),0,n);if(b(f))return N(S(e),S(f),n)}return!W(e,f)||"\x3c\x3d"!==n&&"\x3e\x3d"!==n?!1:!0};p.equalityTest=W;p.toString=R;p.toNumberArray=function(e){var f=[];if(!1===J(e))return null;if(e instanceof d){for(var n=0;n<e.length();n++)f[n]=S(e.get(n));return f}for(n=0;n<e.length;n++)f[n]=S(e[n]);return f};p.toStringExplicit=
V;p.toNumber=S;p.toDate=function(e,f){return G(e)?e:b(e)&&(e=l(e,[void 0===f||null===f||""===f?l.ISO_8601:f]),e.isValid())?e.toDate():null};p.toDateM=function(e,f){return G(e)?l(e):b(e)&&(e=l(e,[void 0===f||null===f||""===f?l.ISO_8601:f]),e.isValid())?e:null};p.toBoolean=function(e){return m(e)?e:b(e)?(e=e.toLowerCase(),"true"===e?!0:!1):E(e)?0===e?!1:isNaN(e)?!1:!0:!1};p.fixSpatialReference=function(e,f){return null===e||void 0===e?null:((null===e.spatialReference||void 0===e.spatialReference)&&
(e.spatialReference=f),e)};p.fixNullGeometry=function(e){return null===e?null:e instanceof c?"NaN"===e.x||null===e.x||isNaN(e.x)?null:e:e instanceof C?0===e.rings.length?null:e:e instanceof t?0===e.paths.length?null:e:e instanceof v?0===e.points.length?null:e:e instanceof q?"NaN"===e.xmin||null===e.xmin||isNaN(e.xmin)?null:e:null};p.getDomainValue=function(e,f){if(!e||!e.domain)return null;var n=null;f="string"===e.field.type||"esriFieldTypeString"===e.field.type?R(f):S(f);for(var g=0;g<e.domain.codedValues.length;g++){var I=
e.domain.codedValues[g];I.code===f&&(n=I)}return null===n?null:n.name};p.getDomainCode=function(e,f){if(!e||!e.domain)return null;var n=null;f=R(f);for(var g=0;g<e.domain.codedValues.length;g++){var I=e.domain.codedValues[g];I.name===f&&(n=I)}return null===n?null:n.code};p.getDomain=function(e,f,n,g){if((void 0===n&&(n=null),!f)||!f.fields)return null;for(var x=null,z=0;z<f.fields.length;z++){var b=f.fields[z];b.name.toLowerCase()===e.toString().toLowerCase()&&(x=b)}if(null===x)return null;var a,
m;return g||(g=n&&f.typeIdField&&n._field(f.typeIdField)),null!=g&&k.some(f.types,function(e){return e.id===g?(a=e.domains&&e.domains[x.name],a&&"inherited"===a.type&&(a=X(x.name,f),m=!0),!0):!1}),m||a||(a=X(e,f)),{field:x,domain:a}};p.stableStringify=z})},"esri/moment":function(){define(["require","exports","./plugins/moment!"],function(A,p,w){return w})},"esri/plugins/moment":function(){define(["require","exports","dojo/_base/kernel","moment/moment"],function(A,p,w,l){Object.defineProperty(p,"__esModule",
{value:!0});var h={ar:1,"ar-dz":1,"ar-kw":1,"ar-ly":1,"ar-ma":1,"ar-sa":1,"ar-tn":1,bs:1,cs:1,da:1,de:1,"de-at":1,"de-ch":1,el:1,"en-au":1,"en-ca":1,"en-gb":1,"en-ie":1,"en-nz":1,es:1,"es-do":1,"es-us":1,et:1,fi:1,fr:1,"fr-ca":1,"fr-ch":1,he:1,hi:1,hr:1,id:1,it:1,ja:1,ko:1,lt:1,lv:1,nb:1,nl:1,"nl-be":1,pl:1,pt:1,"pt-br":1,ro:1,ru:1,sl:1,sr:1,"sr-cyrl":1,sv:1,th:1,tr:1,vi:1,"zh-cn":1,"zh-hk":1,"zh-tw":1};p.load=function(d,u,r){d=w.locale;var a=d in h;if(!a){var k=d.split("-");1<k.length&&k[0]in h&&
(d=k[0],a=!0)}a?u(["moment/locale/"+d],function(){r(l)}):r(l)}})},"moment/moment":function(){(function(A,p){"object"===typeof exports&&"undefined"!==typeof module?module.exports=p():"function"===typeof define&&define.amd?define(p):A.moment=p()})(this,function(){function A(){return jd.apply(null,arguments)}function p(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function w(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function l(e){if(Object.getOwnPropertyNames)return 0===
Object.getOwnPropertyNames(e).length;for(var f in e)if(e.hasOwnProperty(f))return!1;return!0}function h(e){return void 0===e}function d(e){return"number"===typeof e||"[object Number]"===Object.prototype.toString.call(e)}function u(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function r(e,f){var n=[],g;for(g=0;g<e.length;++g)n.push(f(e[g],g));return n}function a(e,f){return Object.prototype.hasOwnProperty.call(e,f)}function k(e,f){for(var n in f)a(f,n)&&(e[n]=f[n]);
a(f,"toString")&&(e.toString=f.toString);a(f,"valueOf")&&(e.valueOf=f.valueOf);return e}function c(e,f,n,g){return bb(e,f,n,g,!0).utc()}function t(e){null==e._pf&&(e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1});return e._pf}function C(e){if(null==e._isValid){var f=t(e),n=kd.call(f.parsedDateParts,function(e){return null!=e}),n=!isNaN(e._d.getTime())&&
0>f.overflow&&!f.empty&&!f.invalidMonth&&!f.invalidWeekday&&!f.weekdayMismatch&&!f.nullInput&&!f.invalidFormat&&!f.userInvalidated&&(!f.meridiem||f.meridiem&&n);e._strict&&(n=n&&0===f.charsLeftOver&&0===f.unusedTokens.length&&void 0===f.bigHour);if(null!=Object.isFrozen&&Object.isFrozen(e))return n;e._isValid=n}return e._isValid}function q(e){var f=c(NaN);null!=e?k(t(f),e):t(f).userInvalidated=!0;return f}function v(e,f){var n,g,x;h(f._isAMomentObject)||(e._isAMomentObject=f._isAMomentObject);h(f._i)||
(e._i=f._i);h(f._f)||(e._f=f._f);h(f._l)||(e._l=f._l);h(f._strict)||(e._strict=f._strict);h(f._tzm)||(e._tzm=f._tzm);h(f._isUTC)||(e._isUTC=f._isUTC);h(f._offset)||(e._offset=f._offset);h(f._pf)||(e._pf=t(f));h(f._locale)||(e._locale=f._locale);if(0<Uc.length)for(n=0;n<Uc.length;n++)g=Uc[n],x=f[g],h(x)||(e[g]=x);return e}function y(e){v(this,e);this._d=new Date(null!=e._d?e._d.getTime():NaN);this.isValid()||(this._d=new Date(NaN));!1===Vc&&(Vc=!0,A.updateOffset(this),Vc=!1)}function B(e){return e instanceof
y||null!=e&&null!=e._isAMomentObject}function D(e){return 0>e?Math.ceil(e)||0:Math.floor(e)}function b(e){e=+e;var f=0;0!==e&&isFinite(e)&&(f=D(e));return f}function m(e,f,n){var g=Math.min(e.length,f.length),x=Math.abs(e.length-f.length),I=0,z;for(z=0;z<g;z++)(n&&e[z]!==f[z]||!n&&b(e[z])!==b(f[z]))&&I++;return I+x}function E(e){!1===A.suppressDeprecationWarnings&&"undefined"!==typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function J(e,f){var n=!0;return k(function(){null!=
A.deprecationHandler&&A.deprecationHandler(null,e);if(n){for(var g=[],x,I=0;I<arguments.length;I++){x="";if("object"===typeof arguments[I]){x+="\n["+I+"] ";for(var z in arguments[0])x+=z+": "+arguments[0][z]+", ";x=x.slice(0,-2)}else x=arguments[I];g.push(x)}E(e+"\nArguments: "+Array.prototype.slice.call(g).join("")+"\n"+Error().stack);n=!1}return f.apply(this,arguments)},f)}function G(e,f){null!=A.deprecationHandler&&A.deprecationHandler(e,f);ld[e]||(E(f),ld[e]=!0)}function K(e){return e instanceof
Function||"[object Function]"===Object.prototype.toString.call(e)}function M(e,f){var n=k({},e),g;for(g in f)a(f,g)&&(w(e[g])&&w(f[g])?(n[g]={},k(n[g],e[g]),k(n[g],f[g])):null!=f[g]?n[g]=f[g]:delete n[g]);for(g in e)a(e,g)&&!a(f,g)&&w(e[g])&&(n[g]=k({},n[g]));return n}function U(e){null!=e&&this.set(e)}function N(e,f){var n=e.toLowerCase();jb[n]=jb[n+"s"]=jb[f]=e}function W(e){return"string"===typeof e?jb[e]||jb[e.toLowerCase()]:void 0}function R(e){var f={},n,g;for(g in e)a(e,g)&&(n=W(g))&&(f[n]=
e[g]);return f}function V(e){var f=[],n;for(n in e)f.push({unit:n,priority:Ra[n]});f.sort(function(e,f){return e.priority-f.priority});return f}function Q(e,f,n){var g=""+Math.abs(e);return(0<=e?n?"+":"":"-")+Math.pow(10,Math.max(0,f-g.length)).toString().substr(1)+g}function S(e,f,n,g){var x=g;"string"===typeof g&&(x=function(){return this[g]()});e&&(nb[e]=x);f&&(nb[f[0]]=function(){return Q(x.apply(this,arguments),f[1],f[2])});n&&(nb[n]=function(){return this.localeData().ordinal(x.apply(this,arguments),
e)})}function X(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function z(e){var f=e.match(ic),n,g;n=0;for(g=f.length;n<g;n++)f[n]=nb[f[n]]?nb[f[n]]:X(f[n]);return function(n){var x="",I;for(I=0;I<g;I++)x+=K(f[I])?f[I].call(n,e):f[I];return x}}function Z(e,f){if(!e.isValid())return e.localeData().invalidDate();f=O(f,e.localeData());Xb[f]=Xb[f]||z(f);return Xb[f](e)}function O(e,f){function n(e){return f.longDateFormat(e)||e}var g=5;for(Ib.lastIndex=0;0<=g&&Ib.test(e);)e=
e.replace(Ib,n),Ib.lastIndex=0,--g;return e}function g(e,f,n){Wc[e]=K(f)?f:function(e,g){return e&&n?n:f}}function e(e,n){return a(Wc,e)?Wc[e](n._strict,n._locale):new RegExp(f(e))}function f(e){return n(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,f,n,g,x){return f||n||g||x}))}function n(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$\x26")}function x(e,f){var n,g=f;"string"===typeof e&&(e=[e]);d(f)&&(g=function(e,n){n[f]=b(e)});for(n=0;n<e.length;n++)Xc[e[n]]=g}
function I(e,f){x(e,function(e,n,g,x){g._w=g._w||{};f(e,g._w,g,x)})}function L(e){return 0===e%4&&0!==e%100||0===e%400}function P(e,f){return function(n){return null!=n?(fa(this,e,n),A.updateOffset(this,f),this):Y(this,e)}}function Y(e,f){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+f]():NaN}function fa(e,f,n){if(e.isValid()&&!isNaN(n))if("FullYear"===f&&L(e.year())&&1===e.month()&&29===e.date())e._d["set"+(e._isUTC?"UTC":"")+f](n,e.month(),ga(n,e.month()));else e._d["set"+(e._isUTC?"UTC":"")+
f](n)}function ga(e,f){if(isNaN(e)||isNaN(f))return NaN;var n=(f%12+12)%12;return 1===n?L(e+(f-n)/12)?29:28:31-n%7%2}function ia(e,f){var n;if(!e.isValid())return e;if("string"===typeof f)if(/^\d+$/.test(f))f=b(f);else if(f=e.localeData().monthsParse(f),!d(f))return e;n=Math.min(e.date(),ga(e.year(),f));e._d["set"+(e._isUTC?"UTC":"")+"Month"](f,n);return e}function na(e){return null!=e?(ia(this,e),A.updateOffset(this,!0),this):Y(this,"Month")}function ka(){function e(e,f){return f.length-e.length}
var f=[],g=[],x=[],I,z;for(I=0;12>I;I++)z=c([2E3,I]),f.push(this.monthsShort(z,"")),g.push(this.months(z,"")),x.push(this.months(z,"")),x.push(this.monthsShort(z,""));f.sort(e);g.sort(e);x.sort(e);for(I=0;12>I;I++)f[I]=n(f[I]),g[I]=n(g[I]);for(I=0;24>I;I++)x[I]=n(x[I]);this._monthsShortRegex=this._monthsRegex=new RegExp("^("+x.join("|")+")","i");this._monthsStrictRegex=new RegExp("^("+g.join("|")+")","i");this._monthsShortStrictRegex=new RegExp("^("+f.join("|")+")","i")}function wa(e,f,n,g,x,I,z){f=
new Date(e,f,n,g,x,I,z);100>e&&0<=e&&isFinite(f.getFullYear())&&f.setFullYear(e);return f}function ta(e){var f=new Date(Date.UTC.apply(null,arguments));100>e&&0<=e&&isFinite(f.getUTCFullYear())&&f.setUTCFullYear(e);return f}function sa(e,f,n){n=7+f-n;return-((7+ta(e,0,n).getUTCDay()-f)%7)+n-1}function aa(e,f,n,g,x){n=(7+n-g)%7;g=sa(e,g,x);g=1+7*(f-1)+n+g;0>=g?(f=e-1,e=(L(f)?366:365)+g):g>(L(e)?366:365)?(f=e+1,e=g-(L(e)?366:365)):(f=e,e=g);return{year:f,dayOfYear:e}}function ya(e,f,n){var g=sa(e.year(),
f,n),g=Math.floor((e.dayOfYear()-g-1)/7)+1;1>g?(e=e.year()-1,f=g+la(e,f,n)):g>la(e.year(),f,n)?(f=g-la(e.year(),f,n),e=e.year()+1):(e=e.year(),f=g);return{week:f,year:e}}function la(e,f,n){var g=sa(e,f,n);f=sa(e+1,f,n);return((L(e)?366:365)-g+f)/7}function za(e,f,n){var g,x;e=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],g=0;7>g;++g)x=c([2E3,1]).day(g),this._minWeekdaysParse[g]=this.weekdaysMin(x,"").toLocaleLowerCase(),
this._shortWeekdaysParse[g]=this.weekdaysShort(x,"").toLocaleLowerCase(),this._weekdaysParse[g]=this.weekdays(x,"").toLocaleLowerCase();if(n)f="dddd"===f?Da.call(this._weekdaysParse,e):"ddd"===f?Da.call(this._shortWeekdaysParse,e):Da.call(this._minWeekdaysParse,e);else if("dddd"===f){f=Da.call(this._weekdaysParse,e);if(-1!==f)return f;f=Da.call(this._shortWeekdaysParse,e);if(-1!==f)return f;f=Da.call(this._minWeekdaysParse,e)}else if("ddd"===f){f=Da.call(this._shortWeekdaysParse,e);if(-1!==f)return f;
f=Da.call(this._weekdaysParse,e);if(-1!==f)return f;f=Da.call(this._minWeekdaysParse,e)}else{f=Da.call(this._minWeekdaysParse,e);if(-1!==f)return f;f=Da.call(this._weekdaysParse,e);if(-1!==f)return f;f=Da.call(this._shortWeekdaysParse,e)}return-1!==f?f:null}function oa(){function e(e,f){return f.length-e.length}var f=[],g=[],x=[],I=[],z,L,b,a;for(z=0;7>z;z++)L=c([2E3,1]).day(z),b=this.weekdaysMin(L,""),a=this.weekdaysShort(L,""),L=this.weekdays(L,""),f.push(b),g.push(a),x.push(L),I.push(b),I.push(a),
I.push(L);f.sort(e);g.sort(e);x.sort(e);I.sort(e);for(z=0;7>z;z++)g[z]=n(g[z]),x[z]=n(x[z]),I[z]=n(I[z]);this._weekdaysMinRegex=this._weekdaysShortRegex=this._weekdaysRegex=new RegExp("^("+I.join("|")+")","i");this._weekdaysStrictRegex=new RegExp("^("+x.join("|")+")","i");this._weekdaysShortStrictRegex=new RegExp("^("+g.join("|")+")","i");this._weekdaysMinStrictRegex=new RegExp("^("+f.join("|")+")","i")}function F(){return this.hours()%12||12}function Ia(e,f){S(e,0,0,function(){return this.localeData().meridiem(this.hours(),
this.minutes(),f)})}function Ea(e,f){return f._meridiemParse}function Qa(e){return e?e.toLowerCase().replace("_","-"):e}function Pa(e){var f=null;if(!Wa[e]&&"undefined"!==typeof module&&module&&module.exports)try{f=Bc._abbr,require("./locale/"+e),Fa(f)}catch(Sd){}return Wa[e]}function Fa(e,f){e&&(e=h(f)?Na(e):ea(e,f))&&(Bc=e);return Bc._abbr}function ea(e,f){if(null!==f){var n=md;f.abbr=e;if(null!=Wa[e])G("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),
n=Wa[e]._config;else if(null!=f.parentLocale)if(null!=Wa[f.parentLocale])n=Wa[f.parentLocale]._config;else return jc[f.parentLocale]||(jc[f.parentLocale]=[]),jc[f.parentLocale].push({name:e,config:f}),null;Wa[e]=new U(M(n,f));jc[e]&&jc[e].forEach(function(e){ea(e.name,e.config)});Fa(e);return Wa[e]}delete Wa[e];return null}function Na(e){var f;e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr);if(!e)return Bc;if(!p(e)){if(f=Pa(e))return f;e=[e]}a:{f=0;for(var n,g,x,I;f<e.length;){I=Qa(e[f]).split("-");
n=I.length;for(g=(g=Qa(e[f+1]))?g.split("-"):null;0<n;){if(x=Pa(I.slice(0,n).join("-"))){e=x;break a}if(g&&g.length>=n&&m(I,g,!0)>=n-1)break;n--}f++}e=null}return e}function Ga(e){var f;(f=e._a)&&-2===t(e).overflow&&(f=0>f[cb]||11<f[cb]?cb:1>f[sb]||f[sb]>ga(f[hb],f[cb])?sb:0>f[Xa]||24<f[Xa]||24===f[Xa]&&(0!==f[ob]||0!==f[Ab]||0!==f[Jb])?Xa:0>f[ob]||59<f[ob]?ob:0>f[Ab]||59<f[Ab]?Ab:0>f[Jb]||999<f[Jb]?Jb:-1,t(e)._overflowDayOfYear&&(f<hb||f>sb)&&(f=sb),t(e)._overflowWeeks&&-1===f&&(f=zd),t(e)._overflowWeekday&&
-1===f&&(f=kc),t(e).overflow=f);return e}function La(e,f,n){return null!=e?e:null!=f?f:n}function ib(e){var f,n=[],g;if(!e._d){g=new Date(A.now());g=e._useUTC?[g.getUTCFullYear(),g.getUTCMonth(),g.getUTCDate()]:[g.getFullYear(),g.getMonth(),g.getDate()];if(e._w&&null==e._a[sb]&&null==e._a[cb]){var x,I,z,b,a,m;x=e._w;if(null!=x.GG||null!=x.W||null!=x.E){if(a=1,m=4,I=La(x.GG,e._a[hb],ya(da(),1,4).year),z=La(x.W,1),b=La(x.E,1),1>b||7<b)f=!0}else if(a=e._locale._week.dow,m=e._locale._week.doy,z=ya(da(),
a,m),I=La(x.gg,e._a[hb],z.year),z=La(x.w,z.week),null!=x.d){if(b=x.d,0>b||6<b)f=!0}else if(null!=x.e){if(b=x.e+a,0>x.e||6<x.e)f=!0}else b=a;1>z||z>la(I,a,m)?t(e)._overflowWeeks=!0:null!=f?t(e)._overflowWeekday=!0:(f=aa(I,z,b,a,m),e._a[hb]=f.year,e._dayOfYear=f.dayOfYear)}if(null!=e._dayOfYear){f=La(e._a[hb],g[hb]);if(e._dayOfYear>(L(f)?366:365)||0===e._dayOfYear)t(e)._overflowDayOfYear=!0;f=ta(f,0,e._dayOfYear);e._a[cb]=f.getUTCMonth();e._a[sb]=f.getUTCDate()}for(f=0;3>f&&null==e._a[f];++f)e._a[f]=
n[f]=g[f];for(;7>f;f++)e._a[f]=n[f]=null==e._a[f]?2===f?1:0:e._a[f];24===e._a[Xa]&&0===e._a[ob]&&0===e._a[Ab]&&0===e._a[Jb]&&(e._nextDay=!0,e._a[Xa]=0);e._d=(e._useUTC?ta:wa).apply(null,n);null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm);e._nextDay&&(e._a[Xa]=24);e._w&&"undefined"!==typeof e._w.d&&e._w.d!==e._d.getDay()&&(t(e).weekdayMismatch=!0)}}function ha(e){var f,n;f=e._i;var g=Ad.exec(f)||Bd.exec(f),x,I,z,L;if(g){t(e).iso=!0;f=0;for(n=Cc.length;f<n;f++)if(Cc[f][1].exec(g[1])){I=
Cc[f][0];x=!1!==Cc[f][2];break}if(null==I)e._isValid=!1;else{if(g[3]){f=0;for(n=Yc.length;f<n;f++)if(Yc[f][1].exec(g[3])){z=(g[2]||" ")+Yc[f][0];break}if(null==z){e._isValid=!1;return}}if(x||null==z){if(g[4])if(Cd.exec(g[4]))L="Z";else{e._isValid=!1;return}e._f=I+(z||"")+(L||"");qa(e)}else e._isValid=!1}}else e._isValid=!1}function Ua(e){var f=Dd.exec(e._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim());if(f){var n=f[3],g=f[2],x=f[5],I=f[6],z=f[7],L=parseInt(f[4],10),n=[49>=L?2E3+
L:999>=L?1900+L:L,lc.indexOf(n),parseInt(g,10),parseInt(x,10),parseInt(I,10)];z&&n.push(parseInt(z,10));a:{if(z=f[1])if(z=Kb.indexOf(z),g=(new Date(n[0],n[1],n[2])).getDay(),z!==g){t(e).weekdayMismatch=!0;z=e._isValid=!1;break a}z=!0}z&&(e._a=n,(z=f[8])?f=Dc[z]:f[9]?f=0:(f=parseInt(f[10],10),z=f%100,f=(f-z)/100*60+z),e._tzm=f,e._d=ta.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),t(e).rfc2822=!0)}else e._isValid=!1}function Ma(e){var f=Ed.exec(e._i);null!==f?e._d=new Date(+f[1]):
(ha(e),!1===e._isValid&&(delete e._isValid,Ua(e),!1===e._isValid&&(delete e._isValid,A.createFromInputFallback(e))))}function qa(f){if(f._f===A.ISO_8601)ha(f);else if(f._f===A.RFC_2822)Ua(f);else{f._a=[];t(f).empty=!0;var n=""+f._i,g,x,I,z,L,b=n.length,m=0;I=O(f._f,f._locale).match(ic)||[];for(g=0;g<I.length;g++){z=I[g];if(x=(n.match(e(z,f))||[])[0])L=n.substr(0,n.indexOf(x)),0<L.length&&t(f).unusedInput.push(L),n=n.slice(n.indexOf(x)+x.length),m+=x.length;if(nb[z]){if(x?t(f).empty=!1:t(f).unusedTokens.push(z),
L=f,null!=x&&a(Xc,z))Xc[z](x,L._a,L,z)}else f._strict&&!x&&t(f).unusedTokens.push(z)}t(f).charsLeftOver=b-m;0<n.length&&t(f).unusedInput.push(n);12>=f._a[Xa]&&!0===t(f).bigHour&&0<f._a[Xa]&&(t(f).bigHour=void 0);t(f).parsedDateParts=f._a.slice(0);t(f).meridiem=f._meridiem;n=f._a;g=Xa;b=f._locale;I=f._a[Xa];m=f._meridiem;null!=m&&(null!=b.meridiemHour?I=b.meridiemHour(I,m):null!=b.isPM&&((b=b.isPM(m))&&12>I&&(I+=12),b||12!==I||(I=0)));n[g]=I;ib(f);Ga(f)}}function db(e){if(!e._d){var f=R(e._i);e._a=
r([f.year,f.month,f.day||f.date,f.hour,f.minute,f.second,f.millisecond],function(e){return e&&parseInt(e,10)});ib(e)}}function Va(e){var f=e._i,n=e._f;e._locale=e._locale||Na(e._l);if(null===f||void 0===n&&""===f)return q({nullInput:!0});"string"===typeof f&&(e._i=f=e._locale.preparse(f));if(B(f))return new y(Ga(f));if(u(f))e._d=f;else if(p(n)){var g,x,I;if(0===e._f.length)t(e).invalidFormat=!0,e._d=new Date(NaN);else{for(f=0;f<e._f.length;f++)if(n=0,g=v({},e),null!=e._useUTC&&(g._useUTC=e._useUTC),
g._f=e._f[f],qa(g),C(g)&&(n+=t(g).charsLeftOver,n+=10*t(g).unusedTokens.length,t(g).score=n,null==I||n<I))I=n,x=g;k(e,x||g)}}else n?qa(e):va(e);C(e)||(e._d=null);return e}function va(e){var f=e._i;h(f)?e._d=new Date(A.now()):u(f)?e._d=new Date(f.valueOf()):"string"===typeof f?Ma(e):p(f)?(e._a=r(f.slice(0),function(e){return parseInt(e,10)}),ib(e)):w(f)?db(e):d(f)?e._d=new Date(f):A.createFromInputFallback(e)}function bb(e,f,n,g,x){var I={};if(!0===n||!1===n)g=n,n=void 0;if(w(e)&&l(e)||p(e)&&0===e.length)e=
void 0;I._isAMomentObject=!0;I._useUTC=I._isUTC=x;I._l=n;I._i=e;I._f=f;I._strict=g;e=new y(Ga(Va(I)));e._nextDay&&(e.add(1,"d"),e._nextDay=void 0);return e}function da(e,f,n,g){return bb(e,f,n,g,!1)}function Ba(e,f){var n,g;1===f.length&&p(f[0])&&(f=f[0]);if(!f.length)return da();n=f[0];for(g=1;g<f.length;++g)if(!f[g].isValid()||f[g][e](n))n=f[g];return n}function T(e){for(var f in e)if(-1===Da.call(pb,f)||null!=e[f]&&isNaN(e[f]))return!1;f=!1;for(var n=0;n<pb.length;++n)if(e[pb[n]]){if(f)return!1;
parseFloat(e[pb[n]])!==b(e[pb[n]])&&(f=!0)}return!0}function ra(e){e=R(e);var f=e.year||0,n=e.quarter||0,g=e.month||0,x=e.week||0,I=e.day||0,z=e.hour||0,L=e.minute||0,b=e.second||0,a=e.millisecond||0;this._isValid=T(e);this._milliseconds=+a+1E3*b+6E4*L+36E5*z;this._days=+I+7*x;this._months=+g+3*n+12*f;this._data={};this._locale=Na();this._bubble()}function ua(e){return e instanceof ra}function Aa(e){return 0>e?-1*Math.round(-1*e):Math.round(e)}function ma(e,f){S(e,0,0,function(){var e=this.utcOffset(),
n="+";0>e&&(e=-e,n="-");return n+Q(~~(e/60),2)+f+Q(~~e%60,2)})}function pa(e,f){e=(f||"").match(e);if(null===e)return null;e=((e[e.length-1]||[])+"").match(Ec)||["-",0,0];f=+(60*e[1])+b(e[2]);return 0===f?0:"+"===e[0]?f:-f}function ca(e,f){return f._isUTC?(f=f.clone(),e=(B(e)||u(e)?e.valueOf():da(e).valueOf())-f.valueOf(),f._d.setTime(f._d.valueOf()+e),A.updateOffset(f,!1),f):da(e).local()}function Db(){return this.isValid()?this._isUTC&&0===this._offset:!1}function $a(e,f){var n=e,g=null;ua(e)?n=
{ms:e._milliseconds,d:e._days,M:e._months}:d(e)?(n={},f?n[f]=e:n.milliseconds=e):(g=Fc.exec(e))?(n="-"===g[1]?-1:1,n={y:0,d:b(g[sb])*n,h:b(g[Xa])*n,m:b(g[ob])*n,s:b(g[Ab])*n,ms:b(Aa(1E3*g[Jb]))*n}):(g=mc.exec(e))?(n="-"===g[1]?-1:1,n={y:kb(g[2],n),M:kb(g[3],n),w:kb(g[4],n),d:kb(g[5],n),h:kb(g[6],n),m:kb(g[7],n),s:kb(g[8],n)}):null==n?n={}:"object"===typeof n&&("from"in n||"to"in n)&&(g=da(n.from),n=da(n.to),g.isValid()&&n.isValid()?(n=ca(n,g),g.isBefore(n)?n=Lb(g,n):(n=Lb(n,g),n.milliseconds=-n.milliseconds,
n.months=-n.months),g=n):g={milliseconds:0,months:0},n={},n.ms=g.milliseconds,n.M=g.months);n=new ra(n);ua(e)&&a(e,"_locale")&&(n._locale=e._locale);return n}function kb(e,f){e=e&&parseFloat(e.replace(",","."));return(isNaN(e)?0:e)*f}function Lb(e,f){var n={milliseconds:0,months:0};n.months=f.month()-e.month()+12*(f.year()-e.year());e.clone().add(n.months,"M").isAfter(f)&&--n.months;n.milliseconds=+f-+e.clone().add(n.months,"M");return n}function tb(e,f){return function(n,g){var x;null===g||isNaN(+g)||
(G(f,"moment()."+f+"(period, number) is deprecated. Please use moment()."+f+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),x=n,n=g,g=x);n=$a("string"===typeof n?+n:n,g);Mb(this,n,e);return this}}function Mb(e,f,n,g){var x=f._milliseconds,I=Aa(f._days);f=Aa(f._months);e.isValid()&&(g=null==g?!0:g,f&&ia(e,Y(e,"Month")+f*n),I&&fa(e,"Date",Y(e,"Date")+I*n),x&&e._d.setTime(e._d.valueOf()+x*n),g&&A.updateOffset(e,I||f))}function Eb(e,f){var n=12*(f.year()-
e.year())+(f.month()-e.month()),g=e.clone().add(n,"months");0>f-g?(e=e.clone().add(n-1,"months"),f=(f-g)/(g-e)):(e=e.clone().add(n+1,"months"),f=(f-g)/(e-g));return-(n+f)||0}function Yb(e){if(void 0===e)return this._locale._abbr;e=Na(e);null!=e&&(this._locale=e);return this}function Zb(){return this._locale}function eb(e,f){S(0,[e,e.length],0,f)}function Nb(e,f,n,g,x){var I;if(null==e)return ya(this,g,x).year;I=la(e,g,x);f>I&&(f=I);e=aa(e,f,n,g,x);e=ta(e.year,0,e.dayOfYear);this.year(e.getUTCFullYear());
this.month(e.getUTCMonth());this.date(e.getUTCDate());return this}function ub(e,f){f[Jb]=b(1E3*("0."+e))}function $b(e){return e}function qb(e,f,n,g){var x=Na();f=c().set(g,f);return x[n](f,e)}function Fb(e,f,n){d(e)&&(f=e,e=void 0);e=e||"";if(null!=f)return qb(e,f,n,"month");var g=[];for(f=0;12>f;f++)g[f]=qb(e,f,n,"month");return g}function ac(e,f,n,g){"boolean"!==typeof e&&(n=f=e,e=!1);d(f)&&(n=f,f=void 0);f=f||"";var x=Na();e=e?x._week.dow:0;if(null!=n)return qb(f,(n+e)%7,g,"day");x=[];for(n=0;7>
n;n++)x[n]=qb(f,(n+e)%7,g,"day");return x}function Ob(e,f,n,g){f=$a(f,n);e._milliseconds+=g*f._milliseconds;e._days+=g*f._days;e._months+=g*f._months;return e._bubble()}function Pb(e){return 0>e?Math.floor(e):Math.ceil(e)}function rb(e){return function(){return this.as(e)}}function lb(e){return function(){return this.isValid()?this._data[e]:NaN}}function Gc(e,f,n,g,x){return x.relativeTime(f||1,!!n,e,g)}function Bb(e){return(0<e)-(0>e)||+e}function vb(){if(!this.isValid())return this.localeData().invalidDate();
var e=Fd(this._milliseconds)/1E3,f=Fd(this._days),n=Fd(this._months),g,x;g=D(e/60);x=D(g/60);e%=60;g%=60;var I=D(n/12),n=n%12,e=e?e.toFixed(3).replace(/\.?0+$/,""):"",z=this.asSeconds();if(!z)return"P0D";var L=0>z?"-":"",b=Bb(this._months)!==Bb(z)?"-":"",a=Bb(this._days)!==Bb(z)?"-":"",z=Bb(this._milliseconds)!==Bb(z)?"-":"";return L+"P"+(I?b+I+"Y":"")+(n?b+n+"M":"")+(f?a+f+"D":"")+(x||g||e?"T":"")+(x?z+x+"H":"")+(g?z+g+"M":"")+(e?z+e+"S":"")}var jd,kd;kd=Array.prototype.some?Array.prototype.some:
function(e){for(var f=Object(this),n=f.length>>>0,g=0;g<n;g++)if(g in f&&e.call(this,f[g],g,f))return!0;return!1};var Uc=A.momentProperties=[],Vc=!1,ld={};A.suppressDeprecationWarnings=!1;A.deprecationHandler=null;var nd;nd=Object.keys?Object.keys:function(e){var f,n=[];for(f in e)a(e,f)&&n.push(f);return n};var jb={},Ra={},ic=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,
Ib=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Xb={},nb={},nc=/\d/,Ya=/\d\d/,bc=/\d{3}/,Qb=/\d{4}/,Rb=/[+-]?\d{6}/,Ja=/\d\d?/,oc=/\d\d\d\d?/,pc=/\d\d\d\d\d\d?/,Cb=/\d{1,3}/,Sb=/\d{1,4}/,Tb=/[+-]?\d{1,6}/,Hc=/\d+/,Ic=/[+-]?\d+/,Gd=/Z|[+-]\d\d:?\d\d/gi,Jc=/Z|[+-]\d\d(?::?\d\d)?/gi,qc=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Wc={},Xc={},hb=0,cb=1,sb=2,Xa=3,ob=4,Ab=5,Jb=6,zd=7,kc=8;S("Y",0,0,function(){var e=this.year();return 9999>=
e?""+e:"+"+e});S(0,["YY",2],0,function(){return this.year()%100});S(0,["YYYY",4],0,"year");S(0,["YYYYY",5],0,"year");S(0,["YYYYYY",6,!0],0,"year");N("year","y");Ra.year=1;g("Y",Ic);g("YY",Ja,Ya);g("YYYY",Sb,Qb);g("YYYYY",Tb,Rb);g("YYYYYY",Tb,Rb);x(["YYYYY","YYYYYY"],hb);x("YYYY",function(e,f){f[hb]=2===e.length?A.parseTwoDigitYear(e):b(e)});x("YY",function(e,f){f[hb]=A.parseTwoDigitYear(e)});x("Y",function(e,f){f[hb]=parseInt(e,10)});A.parseTwoDigitYear=function(e){return b(e)+(68<b(e)?1900:2E3)};
var Ub=P("FullYear",!0),Da;Da=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var f;for(f=0;f<this.length;++f)if(this[f]===e)return f;return-1};S("M",["MM",2],"Mo",function(){return this.month()+1});S("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)});S("MMMM",0,0,function(e){return this.localeData().months(this,e)});N("month","M");Ra.month=8;g("M",Ja);g("MM",Ja,Ya);g("MMM",function(e,f){return f.monthsShortRegex(e)});g("MMMM",function(e,f){return f.monthsRegex(e)});
x(["M","MM"],function(e,f){f[cb]=b(e)-1});x(["MMM","MMMM"],function(e,f,n,g){g=n._locale.monthsParse(e,g,n._strict);null!=g?f[cb]=g:t(n).invalidMonth=e});var rc=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,lc="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");S("w",["ww",2],"wo","week");S("W",["WW",2],"Wo","isoWeek");N("week","w");N("isoWeek","W");Ra.week=5;Ra.isoWeek=5;g("w",Ja);g("ww",Ja,Ya);g("W",Ja);g("WW",Ja,Ya);I(["w","ww","W","WW"],function(e,f,n,g){f[g.substr(0,1)]=b(e)});S("d",0,"do","day");
S("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)});S("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)});S("dddd",0,0,function(e){return this.localeData().weekdays(this,e)});S("e",0,0,"weekday");S("E",0,0,"isoWeekday");N("day","d");N("weekday","e");N("isoWeekday","E");Ra.day=11;Ra.weekday=11;Ra.isoWeekday=11;g("d",Ja);g("e",Ja);g("E",Ja);g("dd",function(e,f){return f.weekdaysMinRegex(e)});g("ddd",function(e,f){return f.weekdaysShortRegex(e)});g("dddd",function(e,
f){return f.weekdaysRegex(e)});I(["dd","ddd","dddd"],function(e,f,n,g){g=n._locale.weekdaysParse(e,g,n._strict);null!=g?f.d=g:t(n).invalidWeekday=e});I(["d","e","E"],function(e,f,n,g){f[g]=b(e)});var Kb="Sun Mon Tue Wed Thu Fri Sat".split(" ");S("H",["HH",2],0,"hour");S("h",["hh",2],0,F);S("k",["kk",2],0,function(){return this.hours()||24});S("hmm",0,0,function(){return""+F.apply(this)+Q(this.minutes(),2)});S("hmmss",0,0,function(){return""+F.apply(this)+Q(this.minutes(),2)+Q(this.seconds(),2)});
S("Hmm",0,0,function(){return""+this.hours()+Q(this.minutes(),2)});S("Hmmss",0,0,function(){return""+this.hours()+Q(this.minutes(),2)+Q(this.seconds(),2)});Ia("a",!0);Ia("A",!1);N("hour","h");Ra.hour=13;g("a",Ea);g("A",Ea);g("H",Ja);g("h",Ja);g("k",Ja);g("HH",Ja,Ya);g("hh",Ja,Ya);g("kk",Ja,Ya);g("hmm",oc);g("hmmss",pc);g("Hmm",oc);g("Hmmss",pc);x(["H","HH"],Xa);x(["k","kk"],function(e,f,n){e=b(e);f[Xa]=24===e?0:e});x(["a","A"],function(e,f,n){n._isPm=n._locale.isPM(e);n._meridiem=e});x(["h","hh"],
function(e,f,n){f[Xa]=b(e);t(n).bigHour=!0});x("hmm",function(e,f,n){var g=e.length-2;f[Xa]=b(e.substr(0,g));f[ob]=b(e.substr(g));t(n).bigHour=!0});x("hmmss",function(e,f,n){var g=e.length-4,x=e.length-2;f[Xa]=b(e.substr(0,g));f[ob]=b(e.substr(g,2));f[Ab]=b(e.substr(x));t(n).bigHour=!0});x("Hmm",function(e,f,n){n=e.length-2;f[Xa]=b(e.substr(0,n));f[ob]=b(e.substr(n))});x("Hmmss",function(e,f,n){n=e.length-4;var g=e.length-2;f[Xa]=b(e.substr(0,n));f[ob]=b(e.substr(n,2));f[Ab]=b(e.substr(g))});var Hd=
P("Hours",!0),md={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",
hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:"January February March April May June July August September October November December".split(" "),monthsShort:lc,week:{dow:0,doy:6},weekdays:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),weekdaysMin:"Su Mo Tu We Th Fr Sa".split(" "),weekdaysShort:Kb,meridiemParse:/[ap]\.?m?\.?/i},Wa={},jc={},Bc,Ad=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,
Bd=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Cd=/Z|[+-]\d\d(?::?\d\d)?/,Cc=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],Yc=
[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Ed=/^\/?Date\((\-?\d+)/i,Dd=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,Dc={UT:0,GMT:0,EDT:-240,
EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};A.createFromInputFallback=J("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))});A.ISO_8601=function(){};
A.RFC_2822=function(){};var Kc=J("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=da.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:q()}),Lc=J("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=da.apply(null,arguments);return this.isValid()&&e.isValid()?e>this?this:e:q()}),pb="year quarter month week day hour minute second millisecond".split(" ");
ma("Z",":");ma("ZZ","");g("Z",Jc);g("ZZ",Jc);x(["Z","ZZ"],function(e,f,n){n._useUTC=!0;n._tzm=pa(Jc,e)});var Ec=/([\+\-]|\d\d)/gi;A.updateOffset=function(){};var Fc=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,mc=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;$a.fn=ra.prototype;$a.invalid=function(){return $a(NaN)};var Mc=tb(1,"add"),Nc=tb(-1,"subtract");A.defaultFormat=
"YYYY-MM-DDTHH:mm:ssZ";A.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var sc=J("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});S(0,["gg",2],0,function(){return this.weekYear()%100});S(0,["GG",2],0,function(){return this.isoWeekYear()%100});eb("gggg","weekYear");eb("ggggg","weekYear");eb("GGGG","isoWeekYear");eb("GGGGG","isoWeekYear");N("weekYear",
"gg");N("isoWeekYear","GG");Ra.weekYear=1;Ra.isoWeekYear=1;g("G",Ic);g("g",Ic);g("GG",Ja,Ya);g("gg",Ja,Ya);g("GGGG",Sb,Qb);g("gggg",Sb,Qb);g("GGGGG",Tb,Rb);g("ggggg",Tb,Rb);I(["gggg","ggggg","GGGG","GGGGG"],function(e,f,n,g){f[g.substr(0,2)]=b(e)});I(["gg","GG"],function(e,f,n,g){f[g]=A.parseTwoDigitYear(e)});S("Q",0,"Qo","quarter");N("quarter","Q");Ra.quarter=7;g("Q",nc);x("Q",function(e,f){f[cb]=3*(b(e)-1)});S("D",["DD",2],"Do","date");N("date","D");Ra.date=9;g("D",Ja);g("DD",Ja,Ya);g("Do",function(e,
f){return e?f._dayOfMonthOrdinalParse||f._ordinalParse:f._dayOfMonthOrdinalParseLenient});x(["D","DD"],sb);x("Do",function(e,f){f[sb]=b(e.match(Ja)[0],10)});var tc=P("Date",!0);S("DDD",["DDDD",3],"DDDo","dayOfYear");N("dayOfYear","DDD");Ra.dayOfYear=4;g("DDD",Cb);g("DDDD",bc);x(["DDD","DDDD"],function(e,f,n){n._dayOfYear=b(e)});S("m",["mm",2],0,"minute");N("minute","m");Ra.minute=14;g("m",Ja);g("mm",Ja,Ya);x(["m","mm"],ob);var Oc=P("Minutes",!1);S("s",["ss",2],0,"second");N("second","s");Ra.second=
15;g("s",Ja);g("ss",Ja,Ya);x(["s","ss"],Ab);var Pc=P("Seconds",!1);S("S",0,0,function(){return~~(this.millisecond()/100)});S(0,["SS",2],0,function(){return~~(this.millisecond()/10)});S(0,["SSS",3],0,"millisecond");S(0,["SSSS",4],0,function(){return 10*this.millisecond()});S(0,["SSSSS",5],0,function(){return 100*this.millisecond()});S(0,["SSSSSS",6],0,function(){return 1E3*this.millisecond()});S(0,["SSSSSSS",7],0,function(){return 1E4*this.millisecond()});S(0,["SSSSSSSS",8],0,function(){return 1E5*
this.millisecond()});S(0,["SSSSSSSSS",9],0,function(){return 1E6*this.millisecond()});N("millisecond","ms");Ra.millisecond=16;g("S",Cb,nc);g("SS",Cb,Ya);g("SSS",Cb,bc);var ab;for(ab="SSSS";9>=ab.length;ab+="S")g(ab,Hc);for(ab="S";9>=ab.length;ab+="S")x(ab,ub);var Qc=P("Milliseconds",!1);S("z",0,0,"zoneAbbr");S("zz",0,0,"zoneName");var ja=y.prototype;ja.add=Mc;ja.calendar=function(e,f){e=e||da();var n=ca(e,this).startOf("day"),n=A.calendarFormat(this,n)||"sameElse";f=f&&(K(f[n])?f[n].call(this,e):
f[n]);return this.format(f||this.localeData().calendar(n,this,da(e)))};ja.clone=function(){return new y(this)};ja.diff=function(e,f,n){var g;if(!this.isValid())return NaN;e=ca(e,this);if(!e.isValid())return NaN;g=6E4*(e.utcOffset()-this.utcOffset());f=W(f);switch(f){case "year":f=Eb(this,e)/12;break;case "month":f=Eb(this,e);break;case "quarter":f=Eb(this,e)/3;break;case "second":f=(this-e)/1E3;break;case "minute":f=(this-e)/6E4;break;case "hour":f=(this-e)/36E5;break;case "day":f=(this-e-g)/864E5;
break;case "week":f=(this-e-g)/6048E5;break;default:f=this-e}return n?f:D(f)};ja.endOf=function(e){e=W(e);if(void 0===e||"millisecond"===e)return this;"date"===e&&(e="day");return this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms")};ja.format=function(e){e||(e=this.isUtc()?A.defaultFormatUtc:A.defaultFormat);e=Z(this,e);return this.localeData().postformat(e)};ja.from=function(e,f){return this.isValid()&&(B(e)&&e.isValid()||da(e).isValid())?$a({to:this,from:e}).locale(this.locale()).humanize(!f):
this.localeData().invalidDate()};ja.fromNow=function(e){return this.from(da(),e)};ja.to=function(e,f){return this.isValid()&&(B(e)&&e.isValid()||da(e).isValid())?$a({from:this,to:e}).locale(this.locale()).humanize(!f):this.localeData().invalidDate()};ja.toNow=function(e){return this.to(da(),e)};ja.get=function(e){e=W(e);return K(this[e])?this[e]():this};ja.invalidAt=function(){return t(this).overflow};ja.isAfter=function(e,f){e=B(e)?e:da(e);if(!this.isValid()||!e.isValid())return!1;f=W(h(f)?"millisecond":
f);return"millisecond"===f?this.valueOf()>e.valueOf():e.valueOf()<this.clone().startOf(f).valueOf()};ja.isBefore=function(e,f){e=B(e)?e:da(e);if(!this.isValid()||!e.isValid())return!1;f=W(h(f)?"millisecond":f);return"millisecond"===f?this.valueOf()<e.valueOf():this.clone().endOf(f).valueOf()<e.valueOf()};ja.isBetween=function(e,f,n,g){g=g||"()";return("("===g[0]?this.isAfter(e,n):!this.isBefore(e,n))&&(")"===g[1]?this.isBefore(f,n):!this.isAfter(f,n))};ja.isSame=function(e,f){e=B(e)?e:da(e);if(!this.isValid()||
!e.isValid())return!1;f=W(f||"millisecond");if("millisecond"===f)return this.valueOf()===e.valueOf();e=e.valueOf();return this.clone().startOf(f).valueOf()<=e&&e<=this.clone().endOf(f).valueOf()};ja.isSameOrAfter=function(e,f){return this.isSame(e,f)||this.isAfter(e,f)};ja.isSameOrBefore=function(e,f){return this.isSame(e,f)||this.isBefore(e,f)};ja.isValid=function(){return C(this)};ja.lang=sc;ja.locale=Yb;ja.localeData=Zb;ja.max=Lc;ja.min=Kc;ja.parsingFlags=function(){return k({},t(this))};ja.set=
function(e,f){if("object"===typeof e){e=R(e);f=V(e);for(var n=0;n<f.length;n++)this[f[n].unit](e[f[n].unit])}else if(e=W(e),K(this[e]))return this[e](f);return this};ja.startOf=function(e){e=W(e);switch(e){case "year":this.month(0);case "quarter":case "month":this.date(1);case "week":case "isoWeek":case "day":case "date":this.hours(0);case "hour":this.minutes(0);case "minute":this.seconds(0);case "second":this.milliseconds(0)}"week"===e&&this.weekday(0);"isoWeek"===e&&this.isoWeekday(1);"quarter"===
e&&this.month(3*Math.floor(this.month()/3));return this};ja.subtract=Nc;ja.toArray=function(){return[this.year(),this.month(),this.date(),this.hour(),this.minute(),this.second(),this.millisecond()]};ja.toObject=function(){return{years:this.year(),months:this.month(),date:this.date(),hours:this.hours(),minutes:this.minutes(),seconds:this.seconds(),milliseconds:this.milliseconds()}};ja.toDate=function(){return new Date(this.valueOf())};ja.toISOString=function(){if(!this.isValid())return null;var e=
this.clone().utc();return 0>e.year()||9999<e.year()?Z(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):K(Date.prototype.toISOString)?this.toDate().toISOString():Z(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")};ja.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e="moment",f="";this.isLocal()||(e=0===this.utcOffset()?"moment.utc":"moment.parseZone",f="Z");var e="["+e+'("]',n=0<=this.year()&&9999>=this.year()?"YYYY":"YYYYYY";return this.format(e+n+"-MM-DD[T]HH:mm:ss.SSS"+(f+'[")]'))};ja.toJSON=
function(){return this.isValid()?this.toISOString():null};ja.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")};ja.unix=function(){return Math.floor(this.valueOf()/1E3)};ja.valueOf=function(){return this._d.valueOf()-6E4*(this._offset||0)};ja.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}};ja.year=Ub;ja.isLeapYear=function(){return L(this.year())};ja.weekYear=function(e){return Nb.call(this,
e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)};ja.isoWeekYear=function(e){return Nb.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)};ja.quarter=ja.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)};ja.month=na;ja.daysInMonth=function(){return ga(this.year(),this.month())};ja.week=ja.weeks=function(e){var f=this.localeData().week(this);return null==e?f:this.add(7*(e-f),"d")};ja.isoWeek=ja.isoWeeks=function(e){var f=
ya(this,1,4).week;return null==e?f:this.add(7*(e-f),"d")};ja.weeksInYear=function(){var e=this.localeData()._week;return la(this.year(),e.dow,e.doy)};ja.isoWeeksInYear=function(){return la(this.year(),1,4)};ja.date=tc;ja.day=ja.days=function(e){if(!this.isValid())return null!=e?this:NaN;var f=this._isUTC?this._d.getUTCDay():this._d.getDay();if(null!=e){var n=this.localeData();"string"===typeof e&&(isNaN(e)?(e=n.weekdaysParse(e),e="number"===typeof e?e:null):e=parseInt(e,10));return this.add(e-f,"d")}return f};
ja.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var f=(this.day()+7-this.localeData()._week.dow)%7;return null==e?f:this.add(e-f,"d")};ja.isoWeekday=function(e){if(!this.isValid())return null!=e?this:NaN;if(null!=e){var f=this.localeData();e="string"===typeof e?f.weekdaysParse(e)%7||7:isNaN(e)?null:e;return this.day(this.day()%7?e:e-7)}return this.day()||7};ja.dayOfYear=function(e){var f=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864E5)+1;return null==
e?f:this.add(e-f,"d")};ja.hour=ja.hours=Hd;ja.minute=ja.minutes=Oc;ja.second=ja.seconds=Pc;ja.millisecond=ja.milliseconds=Qc;ja.utcOffset=function(e,f,n){var g=this._offset||0,x;if(!this.isValid())return null!=e?this:NaN;if(null!=e){if("string"===typeof e){if(e=pa(Jc,e),null===e)return this}else 16>Math.abs(e)&&!n&&(e*=60);!this._isUTC&&f&&(x=15*-Math.round(this._d.getTimezoneOffset()/15));this._offset=e;this._isUTC=!0;null!=x&&this.add(x,"m");g!==e&&(!f||this._changeInProgress?Mb(this,$a(e-g,"m"),
1,!1):this._changeInProgress||(this._changeInProgress=!0,A.updateOffset(this,!0),this._changeInProgress=null));return this}return this._isUTC?g:15*-Math.round(this._d.getTimezoneOffset()/15)};ja.utc=function(e){return this.utcOffset(0,e)};ja.local=function(e){this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(15*-Math.round(this._d.getTimezoneOffset()/15),"m"));return this};ja.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"===typeof this._i){var e=
pa(Gd,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,!0)}return this};ja.hasAlignedHourOffset=function(e){if(!this.isValid())return!1;e=e?da(e).utcOffset():0;return 0===(this.utcOffset()-e)%60};ja.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()};ja.isLocal=function(){return this.isValid()?!this._isUTC:!1};ja.isUtcOffset=function(){return this.isValid()?this._isUTC:!1};ja.isUtc=Db;ja.isUTC=Db;ja.zoneAbbr=function(){return this._isUTC?
"UTC":""};ja.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""};ja.dates=J("dates accessor is deprecated. Use date instead.",tc);ja.months=J("months accessor is deprecated. Use month instead",na);ja.years=J("years accessor is deprecated. Use year instead",Ub);ja.zone=J("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,f){return null!=e?("string"!==typeof e&&(e=-e),this.utcOffset(e,f),this):-this.utcOffset()});
ja.isDSTShifted=J("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!h(this._isDSTShifted))return this._isDSTShifted;var e={};v(e,this);e=Va(e);if(e._a){var f=e._isUTC?c(e._a):da(e._a);this._isDSTShifted=this.isValid()&&0<m(e._a,f.toArray())}else this._isDSTShifted=!1;return this._isDSTShifted});var Ha=U.prototype;Ha.calendar=function(e,f,n){e=this._calendar[e]||this._calendar.sameElse;return K(e)?e.call(f,n):e};Ha.longDateFormat=
function(e){var f=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];if(f||!n)return f;this._longDateFormat[e]=n.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)});return this._longDateFormat[e]};Ha.invalidDate=function(){return this._invalidDate};Ha.ordinal=function(e){return this._ordinal.replace("%d",e)};Ha.preparse=$b;Ha.postformat=$b;Ha.relativeTime=function(e,f,n,g){var x=this._relativeTime[n];return K(x)?x(e,f,n,g):x.replace(/%d/i,e)};Ha.pastFuture=function(e,f){e=this._relativeTime[0<
e?"future":"past"];return K(e)?e(f):e.replace(/%s/i,f)};Ha.set=function(e){var f,n;for(n in e)f=e[n],K(f)?this[n]=f:this["_"+n]=f;this._config=e;this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)};Ha.months=function(e,f){return e?p(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||rc).test(f)?"format":"standalone"][e.month()]:p(this._months)?this._months:this._months.standalone};Ha.monthsShort=
function(e,f){return e?p(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[rc.test(f)?"format":"standalone"][e.month()]:p(this._monthsShort)?this._monthsShort:this._monthsShort.standalone};Ha.monthsParse=function(e,f,n){var g,x;if(this._monthsParseExact){a:{e=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],g=0;12>g;++g)x=c([2E3,g]),this._shortMonthsParse[g]=this.monthsShort(x,"").toLocaleLowerCase(),this._longMonthsParse[g]=
this.months(x,"").toLocaleLowerCase();if(n)f="MMM"===f?Da.call(this._shortMonthsParse,e):Da.call(this._longMonthsParse,e);else if("MMM"===f){f=Da.call(this._shortMonthsParse,e);if(-1!==f)break a;f=Da.call(this._longMonthsParse,e)}else{f=Da.call(this._longMonthsParse,e);if(-1!==f)break a;f=Da.call(this._shortMonthsParse,e)}f=-1!==f?f:null}return f}this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]);for(g=0;12>g;g++)if(x=c([2E3,g]),n&&!this._longMonthsParse[g]&&
(this._longMonthsParse[g]=new RegExp("^"+this.months(x,"").replace(".","")+"$","i"),this._shortMonthsParse[g]=new RegExp("^"+this.monthsShort(x,"").replace(".","")+"$","i")),n||this._monthsParse[g]||(x="^"+this.months(x,"")+"|^"+this.monthsShort(x,""),this._monthsParse[g]=new RegExp(x.replace(".",""),"i")),n&&"MMMM"===f&&this._longMonthsParse[g].test(e)||n&&"MMM"===f&&this._shortMonthsParse[g].test(e)||!n&&this._monthsParse[g].test(e))return g};Ha.monthsRegex=function(e){if(this._monthsParseExact)return a(this,
"_monthsRegex")||ka.call(this),e?this._monthsStrictRegex:this._monthsRegex;a(this,"_monthsRegex")||(this._monthsRegex=qc);return this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex};Ha.monthsShortRegex=function(e){if(this._monthsParseExact)return a(this,"_monthsRegex")||ka.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex;a(this,"_monthsShortRegex")||(this._monthsShortRegex=qc);return this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex};
Ha.week=function(e){return ya(e,this._week.dow,this._week.doy).week};Ha.firstDayOfYear=function(){return this._week.doy};Ha.firstDayOfWeek=function(){return this._week.dow};Ha.weekdays=function(e,f){return e?p(this._weekdays)?this._weekdays[e.day()]:this._weekdays[this._weekdays.isFormat.test(f)?"format":"standalone"][e.day()]:p(this._weekdays)?this._weekdays:this._weekdays.standalone};Ha.weekdaysMin=function(e){return e?this._weekdaysMin[e.day()]:this._weekdaysMin};Ha.weekdaysShort=function(e){return e?
this._weekdaysShort[e.day()]:this._weekdaysShort};Ha.weekdaysParse=function(e,f,n){var g,x;if(this._weekdaysParseExact)return za.call(this,e,f,n);this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]);for(g=0;7>g;g++)if(x=c([2E3,1]).day(g),n&&!this._fullWeekdaysParse[g]&&(this._fullWeekdaysParse[g]=new RegExp("^"+this.weekdays(x,"").replace(".",".?")+"$","i"),this._shortWeekdaysParse[g]=new RegExp("^"+this.weekdaysShort(x,"").replace(".",
".?")+"$","i"),this._minWeekdaysParse[g]=new RegExp("^"+this.weekdaysMin(x,"").replace(".",".?")+"$","i")),this._weekdaysParse[g]||(x="^"+this.weekdays(x,"")+"|^"+this.weekdaysShort(x,"")+"|^"+this.weekdaysMin(x,""),this._weekdaysParse[g]=new RegExp(x.replace(".",""),"i")),n&&"dddd"===f&&this._fullWeekdaysParse[g].test(e)||n&&"ddd"===f&&this._shortWeekdaysParse[g].test(e)||n&&"dd"===f&&this._minWeekdaysParse[g].test(e)||!n&&this._weekdaysParse[g].test(e))return g};Ha.weekdaysRegex=function(e){if(this._weekdaysParseExact)return a(this,
"_weekdaysRegex")||oa.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex;a(this,"_weekdaysRegex")||(this._weekdaysRegex=qc);return this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex};Ha.weekdaysShortRegex=function(e){if(this._weekdaysParseExact)return a(this,"_weekdaysRegex")||oa.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex;a(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=qc);return this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:
this._weekdaysShortRegex};Ha.weekdaysMinRegex=function(e){if(this._weekdaysParseExact)return a(this,"_weekdaysRegex")||oa.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex;a(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=qc);return this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex};Ha.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)};Ha.meridiem=function(e,f,n){return 11<e?n?"pm":"PM":n?"am":"AM"};Fa("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,
ordinal:function(e){var f=e%10,f=1===b(e%100/10)?"th":1===f?"st":2===f?"nd":3===f?"rd":"th";return e+f}});A.lang=J("moment.lang is deprecated. Use moment.locale instead.",Fa);A.langData=J("moment.langData is deprecated. Use moment.localeData instead.",Na);var fb=Math.abs,od=rb("ms"),pd=rb("s"),qd=rb("m"),rd=rb("h"),H=rb("d"),Vb=rb("w"),Za=rb("M"),Wb=rb("y"),ba=lb("milliseconds"),Md=lb("seconds"),Nd=lb("minutes"),Od=lb("hours"),Pd=lb("days"),Qd=lb("months"),Rd=lb("years"),cc=Math.round,Gb={ss:44,s:45,
m:45,h:22,d:26,M:11},Fd=Math.abs,Ka=ra.prototype;Ka.isValid=function(){return this._isValid};Ka.abs=function(){var e=this._data;this._milliseconds=fb(this._milliseconds);this._days=fb(this._days);this._months=fb(this._months);e.milliseconds=fb(e.milliseconds);e.seconds=fb(e.seconds);e.minutes=fb(e.minutes);e.hours=fb(e.hours);e.months=fb(e.months);e.years=fb(e.years);return this};Ka.add=function(e,f){return Ob(this,e,f,1)};Ka.subtract=function(e,f){return Ob(this,e,f,-1)};Ka.as=function(e){if(!this.isValid())return NaN;
var f,n=this._milliseconds;e=W(e);if("month"===e||"year"===e)return f=this._days+n/864E5,f=this._months+4800*f/146097,"month"===e?f:f/12;f=this._days+Math.round(146097*this._months/4800);switch(e){case "week":return f/7+n/6048E5;case "day":return f+n/864E5;case "hour":return 24*f+n/36E5;case "minute":return 1440*f+n/6E4;case "second":return 86400*f+n/1E3;case "millisecond":return Math.floor(864E5*f)+n;default:throw Error("Unknown unit "+e);}};Ka.asMilliseconds=od;Ka.asSeconds=pd;Ka.asMinutes=qd;Ka.asHours=
rd;Ka.asDays=H;Ka.asWeeks=Vb;Ka.asMonths=Za;Ka.asYears=Wb;Ka.valueOf=function(){return this.isValid()?this._milliseconds+864E5*this._days+this._months%12*2592E6+31536E6*b(this._months/12):NaN};Ka._bubble=function(){var e=this._milliseconds,f=this._days,n=this._months,g=this._data;0<=e&&0<=f&&0<=n||0>=e&&0>=f&&0>=n||(e+=864E5*Pb(146097*n/4800+f),n=f=0);g.milliseconds=e%1E3;e=D(e/1E3);g.seconds=e%60;e=D(e/60);g.minutes=e%60;e=D(e/60);g.hours=e%24;f+=D(e/24);e=D(4800*f/146097);n+=e;f-=Pb(146097*e/4800);
e=D(n/12);g.days=f;g.months=n%12;g.years=e;return this};Ka.clone=function(){return $a(this)};Ka.get=function(e){e=W(e);return this.isValid()?this[e+"s"]():NaN};Ka.milliseconds=ba;Ka.seconds=Md;Ka.minutes=Nd;Ka.hours=Od;Ka.days=Pd;Ka.weeks=function(){return D(this.days()/7)};Ka.months=Qd;Ka.years=Rd;Ka.humanize=function(e){if(!this.isValid())return this.localeData().invalidDate();var f=this.localeData(),n;n=!e;var g=$a(this).abs(),x=cc(g.as("s")),I=cc(g.as("m")),z=cc(g.as("h")),L=cc(g.as("d")),b=cc(g.as("M")),
g=cc(g.as("y")),x=x<=Gb.ss&&["s",x]||x<Gb.s&&["ss",x]||1>=I&&["m"]||I<Gb.m&&["mm",I]||1>=z&&["h"]||z<Gb.h&&["hh",z]||1>=L&&["d"]||L<Gb.d&&["dd",L]||1>=b&&["M"]||b<Gb.M&&["MM",b]||1>=g&&["y"]||["yy",g];x[2]=n;x[3]=0<+this;x[4]=f;n=Gc.apply(null,x);e&&(n=f.pastFuture(+this,n));return f.postformat(n)};Ka.toISOString=vb;Ka.toString=vb;Ka.toJSON=vb;Ka.locale=Yb;Ka.localeData=Zb;Ka.toIsoString=J("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",vb);Ka.lang=sc;S("X",0,
0,"unix");S("x",0,0,"valueOf");g("x",Ic);g("X",/[+-]?\d+(\.\d{1,3})?/);x("X",function(e,f,n){n._d=new Date(1E3*parseFloat(e,10))});x("x",function(e,f,n){n._d=new Date(b(e))});A.version="2.19.2";jd=da;A.fn=ja;A.min=function(){var e=[].slice.call(arguments,0);return Ba("isBefore",e)};A.max=function(){var e=[].slice.call(arguments,0);return Ba("isAfter",e)};A.now=function(){return Date.now?Date.now():+new Date};A.utc=c;A.unix=function(e){return da(1E3*e)};A.months=function(e,f){return Fb(e,f,"months")};
A.isDate=u;A.locale=Fa;A.invalid=q;A.duration=$a;A.isMoment=B;A.weekdays=function(e,f,n){return ac(e,f,n,"weekdays")};A.parseZone=function(){return da.apply(null,arguments).parseZone()};A.localeData=Na;A.isDuration=ua;A.monthsShort=function(e,f){return Fb(e,f,"monthsShort")};A.weekdaysMin=function(e,f,n){return ac(e,f,n,"weekdaysMin")};A.defineLocale=ea;A.updateLocale=function(e,f){if(null!=f){var n,g=md;n=Pa(e);null!=n&&(g=n._config);f=M(g,f);f=new U(f);f.parentLocale=Wa[e];Wa[e]=f;Fa(e)}else null!=
Wa[e]&&(null!=Wa[e].parentLocale?Wa[e]=Wa[e].parentLocale:null!=Wa[e]&&delete Wa[e]);return Wa[e]};A.locales=function(){return nd(Wa)};A.weekdaysShort=function(e,f,n){return ac(e,f,n,"weekdaysShort")};A.normalizeUnits=W;A.relativeTimeRounding=function(e){return void 0===e?cc:"function"===typeof e?(cc=e,!0):!1};A.relativeTimeThreshold=function(e,f){if(void 0===Gb[e])return!1;if(void 0===f)return Gb[e];Gb[e]=f;"s"===e&&(Gb.ss=f-1);return!0};A.calendarFormat=function(e,f){e=e.diff(f,"days",!0);return-6>
e?"sameElse":-1>e?"lastWeek":0>e?"lastDay":1>e?"sameDay":2>e?"nextDay":7>e?"nextWeek":"sameElse"};A.prototype=ja;return A})},"esri/arcade/ImmutableArray":function(){define(["require","exports"],function(A,p){return function(){function p(l){void 0===l&&(l=[]);this._elements=l}return p.prototype.length=function(){return this._elements.length},p.prototype.get=function(l){return this._elements[l]},p.prototype.toArray=function(){for(var l=[],h=0;h<this.length();h++)l.push(this.get(h));return l},p}()})},
"esri/arcade/ImmutablePointArray":function(){define("require exports ../core/tsSupport/extendsHelper ./ImmutableArray ../geometry/Point ../kernel".split(" "),function(A,p,w,l,h,d){var u=0===d.version.indexOf("4.");return function(d){function a(a,c,t,h,q,v){a=d.call(this,a)||this;return a._lazyPt=[],a._hasZ=!1,a._hasM=!1,a._spRef=c,a._hasZ=t,a._hasM=h,a._cacheId=q,a._partId=v,a}return w(a,d),a.prototype.get=function(a){if(void 0===this._lazyPt[a]){var c=this._elements[a];if(void 0===c)return;var k=
this._hasZ,d=this._hasM,q=null,q=k&&!d?new h(c[0],c[1],c[2],void 0,this._spRef):d&&k?new h(c[0],c[1],void 0,c[2],this._spRef):k&&d?new h(c[0],c[1],c[2],c[3],this._spRef):new h(c[0],c[1],this._spRef);u?q.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+a.toString():q.setCacheValue("_arcadeCacheId",this._cacheId.toString()+"-"+this._partId.toString()+"-"+a.toString());this._lazyPt[a]=q}return this._lazyPt[a]},a.prototype.equalityTest=function(k){return k===this?!0:null===
k?!1:0==k instanceof a?!1:k.getUniqueHash()===this.getUniqueHash()},a.prototype.getUniqueHash=function(){return this._cacheId.toString()+"-"+this._partId.toString()},a}(l)})},"esri/arcade/ImmutablePathArray":function(){define(["require","exports","../core/tsSupport/extendsHelper","./ImmutableArray","./ImmutablePointArray"],function(A,p,w,l,h){return function(d){function l(h,a,k,c,t){h=d.call(this,h)||this;return h._lazyPath=[],h._hasZ=!1,h._hasM=!1,h._hasZ=k,h._hasM=c,h._spRef=a,h._cacheId=t,h}return w(l,
d),l.prototype.get=function(d){if(void 0===this._lazyPath[d]){var a=this._elements[d];if(void 0===a)return;this._lazyPath[d]=new h(a,this._spRef,this._hasZ,this._hasM,this._cacheId,d)}return this._lazyPath[d]},l.prototype.equalityTest=function(d){return d===this?!0:null===d?!1:0==d instanceof l?!1:d.getUniqueHash()===this.getUniqueHash()},l.prototype.getUniqueHash=function(){return this._cacheId.toString()},l}(l)})},"esri/arcade/FunctionWrapper":function(){define(["require","exports"],function(A,
p){return function(){return function(p,l){this.context=this.definition=null;this.definition=p;this.context=l}}()})},"esri/arcade/treeAnalysis":function(){define(["require","exports"],function(A,p){function w(a,b,m,c){return"0"!==a.min&&m.length<Number(a.min)?-2:"*"!==a.max&&m.length>Number(a.max)?-2:1}function l(a,b,m){if(null!==m.localScope&&void 0!==m.localScope[a.toLowerCase()]){var c=m.localScope[a.toLowerCase()];if("FormulaFunction"===c.type||"any"===c.type)return void 0===c.signature&&(c.signature=
{min:"0",max:"*"}),w(c.signature,a,b,m)}return void 0!==m.globalScope[a.toLowerCase()]&&(c=m.globalScope[a.toLowerCase()],"FormulaFunction"===c.type||"any"===c.type)?(void 0===c.signature&&(c.signature={min:"0",max:"*"}),w(c.signature,a,b,m)):-1}function h(a,b){void 0===b&&(b=!0);var m=C(a,"SYNTAX","UNREOGNISED");try{switch(a.type){case "VariableDeclarator":return null!==a.init&&"FunctionExpression"===a.init.type?C(a,"SYNTAX","FUNCTIONVARIABLEDECLARATOR"):"Identifier"!==a.id.type?C(a,"SYNTAX","VARIABLEMUSTHAVEIDENTIFIER"):
null!==a.init?h(a.init,!1):"";case "VariableDeclaration":for(var c=0;c<a.declarations.length;c++)if(m=h(a.declarations[c],b),""!==m)return m;return"";case "ForInStatement":if(m=h(a.left,b),""!==m)break;if("VariableDeclaration"===a.left.type){if(1<a.left.declarations.length)return C(a,"SYNTAX","ONLY1VAR");if(null!==a.left.declarations[0].init)return C(a,"SYNTAX","CANNOTDECLAREVAL")}else if("Identifier"!==a.left.type)return C(a,"SYNTAX","LEFTNOTVAR");return m=h(a.right,b),""!==m?m:(m=h(a.body,b),""!==
m?m:"");case "ForStatement":return null!==a.test&&(m=h(a.test,b),""!==m)?m:null!==a.init&&(m=h(a.init,b),""!==m)?m:null!==a.update&&(m=h(a.update,b),""!==m)?m:null!==a.body&&(m=h(a.body,b),""!==m)?m:"";case "ContinueStatement":return"";case "EmptyStatement":return"";case "BreakStatement":return"";case "IfStatement":return m=h(a.test,b),""!==m?m:null!==a.consequent&&(m=h(a.consequent,!1),""!==m)?m:null!==a.alternate&&(m=h(a.alternate,!1),""!==m)?m:"";case "BlockStatement":for(var k=[],c=0;c<a.body.length;c++)"EmptyStatement"!==
a.body[c].type&&k.push(a.body[c]);a.body=k;for(c=0;c<a.body.length;c++)if(m=h(a.body[c],b),""!==m)return m;return"";case "FunctionDeclaration":return!1===b?C(a,"SYNTAX","GLOBALFUNCTIONSONLY"):"Identifier"!==a.id.type?C(a,"SYNTAX","FUNCTIONMUSTHAVEIDENTIFIER"):h(a.body,!1);case "ReturnStatement":return null!==a.argument?h(a.argument,b):"";case "UpdateExpression":return"Identifier"!==a.argument.type&&"MemberExpression"!==a.argument.type?C(a,"SYNTAX","ASSIGNMENTTOVARSONLY"):h(a.argument,b);case "AssignmentExpression":if("Identifier"!==
a.left.type&&"MemberExpression"!==a.left.type)return C(a,"SYNTAX","ASSIGNMENTTOVARSONLY");if(m=h(a.left,b),""!==m)break;switch(a.operator){case "\x3d":case "/\x3d":case "*\x3d":case "%\x3d":case "+\x3d":case "-\x3d":break;default:return C(a,"SYNTAX","OPERATORNOTRECOGNISED")}return h(a.right,!1);case "ExpressionStatement":return h(a.expression,!1);case "Identifier":m="";break;case "MemberExpression":return m=h(a.object,b),""!==m?m:!0===a.computed?h(a.property,b):"";case "Literal":return"";case "ThisExpression":return C(a,
"SYNTAX","NOTSUPPORTED");case "CallExpression":if("Identifier"!==a.callee.type)return C(a,"SYNTAX","ONLYNODESSUPPORTED");m="";for(c=0;c<a.arguments.length;c++)if(m=h(a.arguments[c],b),""!==m)return m;return"";case "UnaryExpression":m=h(a.argument,b);break;case "BinaryExpression":if(m=h(a.left,b),""!==m)break;if(m=h(a.right,b),""!==m)break;switch(a.operator){case "\x3d\x3d":case "!\x3d":case "\x3c":case "\x3c\x3d":case "\x3e":case "\x3e\x3d":case "+":case "-":case "*":case "/":case "%":break;default:return C(a,
"SYNTAX","OPERATORNOTRECOGNISED")}return"";case "LogicalExpression":if(m=h(a.left,b),""!==m)break;if(m=h(a.right),""!==m)break;switch(a.operator){case "\x26\x26":case "||":break;default:return C(a,"SYNTAX","OPERATORNOTRECOGNISED")}return"";case "ConditionalExpression":return C(a,"SYNTAX","NOTSUPPORTED");case "ArrayExpression":m="";for(c=0;c<a.elements.length&&(m=h(a.elements[c],b),""===m);c++);break;case "Array":return C(a,"SYNTAX","NOTSUPPORTED");case "ObjectExpression":m="";for(c=0;c<a.properties.length;c++){if(m=
"",null!==a.properties[c].key&&("Literal"!==a.properties[c].key.type&&"Identifier"!==a.properties[c].key.type&&(m=C(a,"SYNTAX","OBJECTPROPERTYMUSTBESTRING")),"Literal"===a.properties[c].key.type))k=a.properties[c].key.value,"string"==typeof k||k instanceof String||(m=C(a,"SYNTAX","OBJECTPROPERTYMUSTBESTRING"));if(""===m&&(m=h(a.properties[c],b)),""!==m)break}break;case "Property":return"Literal"!==a.key.type&&"Identifier"!==a.key.type?C(a,"SYNTAX","ONLYLITERAL"):"Identifier"!==a.key.type&&(m=h(a.key,
b),""!==m)?m:m=h(a.value,b)}return m}catch(G){throw G;}}function d(a,b){var m=C(a,"SYNTAX","UNREOGNISED"),q=null,D="";try{switch(a.type){case "VariableDeclarator":if(null!==a.init&&"FunctionExpression"===a.init.type)return C(a,"SYNTAX","FUNCTIONVARIABLEDECLARATOR");null!==b.localScope?void 0!==b.localScope[a.id.name.toLowerCase()]:void 0!==b.globalScope[a.id.name.toLowerCase()];var t=null===a.init?"":d(a.init,b);return""!==t?t:(null===b.localScope?b.globalScope[a.id.name.toLowerCase()]={type:"any"}:
b.localScope[a.id.name.toLowerCase()]={type:"any"},"");case "FunctionDeclaration":return q=k(a.id.name.toLowerCase(),a,b),D=c(a,b),""!==D?D:null!==b.localScope?C(a,"SYNTAX","GLOBALFUNCTIONSONLY"):(q.isnative=!1,b.globalScope[a.id.name.toLowerCase()]={type:"FormulaFunction",signature:[q]},"");case "VariableDeclaration":for(var m="",v=0;v<a.declarations.length&&(m=d(a.declarations[v],b),""===m);v++);break;case "IfStatement":return m=d(a.test,b),""!==m?m:"AssignmentExpression"===a.test.type||"UpdateExpression"===
a.test.type?C(a.test,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"):null!==a.consequent&&(m=d(a.consequent,b),""!==m)?m:null!==a.alternate&&(m=d(a.alternate,b),""!==m)?m:"";case "EmptyStatement":return"";case "BlockStatement":for(v=0;v<a.body.length;v++)if(m=d(a.body[v],b),""!==m)return m;return"";case "ReturnStatement":return null!==a.argument?d(a.argument,b):"";case "ForInStatement":if("VariableDeclaration"===a.left.type){if(1<a.left.declarations.length)return C(a,"SYNTAX","ONLY1VAR");if(null!==
a.left.declarations[0].init)return C(a,"SYNTAX","CANNOTDECLAREVAL")}else if("Identifier"!==a.left.type)return C(a,"SYNTAX","LEFTNOTVAR");return m=d(a.left,b),""!==m?m:(m=d(a.right,b),""!==m?m:(m=d(a.body,b),""!==m?m:""));case "ForStatement":return null!==a.init&&(m=d(a.init,b),""!==m)?m:null!==a.test&&(m=d(a.test,b),""!==m)?m:null!==a.body&&(m=d(a.body,b),""!==m)?m:null!==a.update&&(m=d(a.update,b),""!==m)?m:"";case "BreakStatement":return"";case "ContinueStatement":return"";case "UpdateExpression":if("Identifier"!==
a.argument.type&&"MemberExpression"!==a.argument.type)return C(a,"SYNTAX","ASSIGNMENTTOVARSONLY");var y=!1;return"MemberExpression"===a.argument.type?d(a.argument,b):(null!==b.localScope&&void 0!==b.localScope[a.argument.name.toLowerCase()]&&(y=!0),void 0!==b.globalScope[a.argument.name.toLowerCase()]&&(y=!0),!1===y?"Identifier "+a.argument.name+" has not been declared.":"");case "AssignmentExpression":if("Identifier"!==a.left.type&&"MemberExpression"!==a.left.type)return C(a,"SYNTAX","ASSIGNMENTTOVARSONLY");
var B=d(a.right,b);return""!==B?B:(y=!1,"MemberExpression"===a.left.type?(B=d(a.left,b),""!==B?B:""):(null!==b.localScope&&void 0!==b.localScope[a.left.name.toLowerCase()]&&(y=!0),void 0!==b.globalScope[a.left.name.toLowerCase()]&&(y=!0),!1===y?"Identifier "+a.left.name+" has not been declared.":""));case "ExpressionStatement":return d(a.expression,b);case "Identifier":var h=a.name.toLowerCase();if(null!==b.localScope&&void 0!==b.localScope[h])return"";m=void 0!==b.globalScope[h]?"":C(a,"SYNTAX",
"VARIABLENOTFOUND");break;case "MemberExpression":return m=d(a.object,b),""!==m?m:!0===a.computed?d(a.property,b):"";case "Literal":return"";case "ThisExpression":m=C(a,"SYNTAX","NOTSUPPORTED");break;case "CallExpression":if("Identifier"!==a.callee.type)return C(a,"SYNTAX","ONLYNODESSUPPORTED");m="";for(v=0;v<a.arguments.length;v++)if(m=d(a.arguments[v],b),""!==m)return m;var r=l(a.callee.name,a.arguments,b);-1===r&&(m=C(a,"SYNTAX","NOTFOUND"));-2===r&&(m=C(a,"SYNTAX","WRONGSIGNATURE"));break;case "UnaryExpression":m=
d(a.argument,b);break;case "BinaryExpression":return m=d(a.left,b),""!==m?m:(m=d(a.right,b),""!==m?m:"");case "LogicalExpression":return m=d(a.left,b),""!==m?m:"AssignmentExpression"===a.left.type||"UpdateExpression"===a.left.type?C(a.left,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"):(m=d(a.right,b),""!==m?m:"AssignmentExpression"===a.right.type||"UpdateExpression"===a.right.type?C(a.right,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"):"");case "ConditionalExpression":return C(a,"SYNTAX","NOTSUPPORTED");
case "ArrayExpression":m="";for(v=0;v<a.elements.length&&(m=d(a.elements[v],b),""===m);v++);break;case "ObjectExpression":m="";for(v=0;v<a.properties.length;v++){if(m="",null!==a.properties[v].key&&("Literal"!==a.properties[v].key.type&&"Identifier"!==a.properties[v].key.type&&(m=C(a,"SYNTAX","OBJECTPROPERTYMUSTBESTRING")),"Literal"===a.properties[v].key.type)){var u=a.properties[v].key.value;"string"==typeof u||u instanceof String||(m=C(a,"SYNTAX","OBJECTPROPERTYMUSTBESTRING"))}if(""===m&&(m=d(a.properties[v],
b)),""!==m)break}break;case "Property":return"Literal"!==a.key.type&&"Identifier"!==a.key.type?C(a,"SYNTAX","ONLYLITERAL"):"Identifier"!==a.key.type&&(m=d(a.key,b),""!==m)?m:m=d(a.value,b);case "Array":return C(a,"SYNTAX","NOTSUPPORTED")}return m}catch(V){throw V;}}function u(a,b){var m=!1;try{switch(a.type){case "VariableDeclarator":return null!==a.init?u(a.init,b):m;case "FunctionDeclaration":return u(a.body,b);case "VariableDeclaration":for(var c=0;c<a.declarations.length;c++)if(u(a.declarations[c],
b))return!0;return m;case "IfStatement":return u(a.test,b)?!0:null!==a.consequent&&u(a.consequent,b)?!0:null!==a.alternate&&u(a.alternate,b)?!0:m;case "EmptyStatement":return m;case "BlockStatement":for(c=0;c<a.body.length;c++)if(u(a.body[c],b))return!0;return m;case "ReturnStatement":return null!==a.argument?u(a.argument,b):m;case "UpdateExpression":return u(a.argument,b);case "AssignmentExpression":return m=u(a.right,b),m?m:u(a.left,b);case "ExpressionStatement":return u(a.expression,b);case "ForInStatement":return(m=
u(a.left,b))?m:(m=u(a.right,b))?m:(m=u(a.body,b),m);case "ForStatement":return null!==a.init&&(m=u(a.init,b))?m:null!==a.test&&(m=u(a.test,b))?m:null!==a.body&&(m=u(a.body,b))?m:(null!==a.update&&(m=u(a.update,b)),m);case "BreakStatement":return m;case "ContinueStatement":return m;case "Compound":return m;case "Identifier":return b.toLowerCase()===a.name.toLowerCase();case "MemberExpression":return(m=u(a.object,b))?m:(!0===a.computed&&(m=u(a.property,b)),m);case "Literal":return m;case "ThisExpression":return m;
case "CallExpression":for(c=0;c<a.arguments.length;c++)u(a.arguments[c],b)&&(m=!0);return m;case "ArrayExpression":for(c=0;c<a.elements.length;c++)u(a.elements[c],b)&&(m=!0);return m;case "UnaryExpression":return u(a.argument,b);case "BinaryExpression":return(m=u(a.left,b))?m:m=u(a.right,b);case "LogicalExpression":return(m=u(a.left,b))?m:m=u(a.right,b);case "ObjectExpression":for(c=0;c<a.properties.length;c++)u(a.properties[c],b)&&(m=!0);return m;case "Property":return m=u(a.value,b);case "ConditionalExpression":return m;
case "Array":return m;default:return m}}catch(J){throw J;}}function r(a,b){var m=!1;try{switch(a.type){case "VariableDeclarator":return null!==a.init?r(a.init,b):m;case "FunctionDeclaration":return r(a.body,b);case "VariableDeclaration":for(var c=0;c<a.declarations.length;c++)if(r(a.declarations[c],b))return!0;return m;case "IfStatement":return r(a.test,b)?!0:null!==a.consequent&&r(a.consequent,b)?!0:null!==a.alternate&&r(a.alternate,b)?!0:m;case "EmptyStatement":return m;case "BlockStatement":for(c=
0;c<a.body.length;c++)if(r(a.body[c],b))return!0;return m;case "ReturnStatement":return null!==a.argument?r(a.argument,b):m;case "UpdateExpression":return r(a.argument,b);case "AssignmentExpression":return r(a.left,b)?!0:r(a.right,b);case "ExpressionStatement":return r(a.expression,b);case "ForInStatement":return(m=r(a.left,b))?m:(m=r(a.right,b))?m:(m=r(a.body,b),m);case "ForStatement":return null!==a.init&&(m=r(a.init,b))?m:null!==a.test&&(m=r(a.test,b))?m:null!==a.body&&(m=r(a.body,b))?m:(null!==
a.update&&(m=r(a.update,b)),m);case "BreakStatement":return m;case "ContinueStatement":return m;case "Compound":return m;case "Identifier":return m;case "MemberExpression":return(m=r(a.object,b))?m:(!0===a.computed&&(m=r(a.property,b)),m);case "Literal":return m;case "ThisExpression":return m;case "CallExpression":if(a.callee.name.toLowerCase()===b.toLowerCase())return!0;for(c=0;c<a.arguments.length;c++)r(a.arguments[c],b)&&(m=!0);return m;case "ArrayExpression":for(c=0;c<a.elements.length;c++)r(a.elements[c],
b)&&(m=!0);return m;case "UnaryExpression":return r(a.argument,b);case "BinaryExpression":return(m=r(a.left,b))?m:m=r(a.right,b);case "LogicalExpression":return(m=r(a.left,b))?m:m=r(a.right,b);case "ConditionalExpression":return m;case "ObjectExpression":for(c=0;c<a.properties.length;c++)r(a.properties[c],b)&&(m=!0);return m;case "Property":return m=r(a.value,b);case "Array":return m;default:return m}}catch(J){throw J;}}function a(c,b){var m,k=[];try{switch(c.type){case "VariableDeclarator":return null!==
c.init?a(c.init,b):k;case "FunctionDeclaration":return a(c.body,b);case "VariableDeclaration":for(var d=0;d<c.declarations.length;d++)m=a(c.declarations[d],b),k=k.concat(m);return k;case "ForInStatement":return m=a(c.left,b),k=k.concat(m),m=a(c.right,b),k=k.concat(m),m=a(c.body,b),k=k.concat(m);case "ForStatement":return null!==c.init&&(m=a(c.init,b),k=k.concat(m)),null!==c.test&&(m=a(c.test,b),k=k.concat(m)),null!==c.body&&(m=a(c.body,b),k=k.concat(m)),null!==c.update&&(m=a(c.update,b),k=k.concat(m)),
k;case "IfStatement":return m=a(c.test,b),k=k.concat(m),null!==c.consequent&&(m=a(c.consequent,b),k=k.concat(m)),null!==c.alternate&&(m=a(c.alternate,b),k=k.concat(m)),k;case "EmptyStatement":return k;case "BlockStatement":for(d=0;d<c.body.length;d++)m=a(c.body[d],b),k=k.concat(m);return k;case "ReturnStatement":return null!==c.argument?a(c.argument,b):k;case "UpdateExpression":return a(c.argument,b);case "AssignmentExpression":return k=a(c.left,b),k=k.concat(a(c.right,b));case "ExpressionStatement":return a(c.expression,
b);case "BreakStatement":return k;case "ContinueStatement":return k;case "Compound":return k;case "Identifier":return k;case "MemberExpression":if("Identifier"!==c.object.type)return k;if(!1===c.computed)k.push(c.object.name.toLowerCase()+"."+c.property.name.toLowerCase());else try{"Literal"===c.property.type&&"string"==typeof c.property.value&&k.push(c.object.name.toLowerCase()+"."+c.property.value.toString().toLowerCase())}catch(G){}return k;case "Literal":return k;case "ThisExpression":return k;
case "CallExpression":for(d=0;d<c.arguments.length;d++)m=a(c.arguments[d],b),k=k.concat(m);return k;case "ArrayExpression":for(d=0;d<c.elements.length;d++)m=a(c.elements[d],b),k=k.concat(m);return k;case "UnaryExpression":return a(c.argument,b);case "ObjectExpression":for(d=0;d<c.properties.length;d++)m=a(c.properties[d],b),k=k.concat(m);return k;case "Property":return a(c.value,b);case "BinaryExpression":return m=a(c.left,b),k=k.concat(m),m=a(c.right,b),k=k.concat(m);case "LogicalExpression":return m=
a(c.left,b),k=k.concat(m),m=a(c.right,b),k=k.concat(m);case "ConditionalExpression":return k;case "Array":return k;default:return k}}catch(G){throw G;}}function k(a,b,m){m=[];if(void 0!==b.params&&null!==b.params)for(var c=0;c<b.params.length;c++)m.push("any");return{name:a,"return":"any",params:m}}function c(a,b){b={globalScope:b.globalScope,localScope:{}};for(var m=0;m<a.params.length;m++)b.localScope[a.params[m].name.toLowerCase()]={type:"any"};return d(a.body,b)}function t(a,b,m,c){var k={};void 0!==
a&&null!==a||(a={});void 0!==m&&null!==m||(m={});k.infinity={type:"any"};k.textformatting={type:"any"};k.pi={type:"any"};for(var d in b)("simple"!==c||"simple"===c&&"a"===b[d].av)&&(k[d]={type:"FormulaFunction",signature:{min:b[d].min,max:b[d].max}},"simple"!==c&&(void 0!==b[d].fmin&&(k[d].signature.min=b[d].fmin),void 0!==b[d].fmax&&(k[d].signature.max=b[d].fmax)));for(b=0;b<m.length;b++)d=m[b],k[d.name]={type:"FormulaFunction",signature:d};for(d in a)k[d]=a[d],k[d].type="any";return k}function C(a,
b,m){var c="";switch(b){case "SYNTAX":c="Syntax Error: ";break;case "RUNTIME":c="Runtime Error: ";break;default:c="Syntax Error: "}try{switch(a.type){case "IfStatement":switch(m){case "CANNOT_USE_ASSIGNMENT_IN_CONDITION":c+=" Assignments not be made in logical tests";break;case "CANNOT_USE_NONBOOLEAN_IN_CONDITION":c+=" Non Boolean used as Condition"}break;case "UpdateExpression":case "AssignmentExpression":switch(m){case "CANNOT_USE_ASSIGNMENT_IN_CONDITION":c+=" Assignments not be made in logical tests";
break;case "ASSIGNMENTTOVARSONLY":c+=" Assignments can only be made to identifiers"}break;case "ExpressionStatement":c+=" Assignments can only be made to identifiers";break;case "FunctionDeclaration":switch(m){case "GLOBALFUNCTIONSONLY":c+=" Functions cannot be declared as variables";break;case "FUNCTIONMUSTHAVEIDENTIFIER":c+=" Function Definition must have an identifier"}break;case "VariableDeclaration":c+=" Only 1 variable can be declared at a time";break;case "VariableDeclarator":switch(m){case "FUNCTIONVARIABLEDECLARATOR":c+=
" Functions cannot be declared as variables";break;case "VARIABLEMUSTHAVEIDENTIFIER":c+=" Variable Definition must have an identifier"}break;case "Identifier":c+=" Identifier Not Found. ";c+=a.name;break;case "ObjectExpression":switch(m){case "OBJECTPROPERTYMUSTBESTRING":c+=" Property name must be a string"}break;case "ForStatement":switch(m){case "CANNOT_USE_NONBOOLEAN_IN_CONDITION":c+=" Non Boolean used as Condition"}break;case "ForInStatement":switch(m){case "ONLY1VAR":c+=" Can only declare 1 var for use with IN";
break;case "CANNOTDECLAREVAL":c+=" Can only declare value for use with IN";break;case "LEFTNOVAR":c+="Must provide a variable to iterate with.";break;case "VARIABLENOTDECLARED":c+="Variable must be declared before it is used..";break;case "CANNOTITERATETHISTYPE":c+="This type cannot be used in an IN loop"}break;case "MemberExpression":switch(m){case "PROPERTYNOTFOUND":c+="Cannot find member property. ";c+=!1===a.computed?a.property.name:"";break;case "OUTOFBOUNDS":c+="Out of Bounds. ";c+=!1===a.computed?
a.property.name:"";break;case "NOTFOUND":c+="Cannot call member method on null. ";c+=!1===a.computed?a.property.name:"";break;case "INVALIDTYPE":c+="Cannot call member property on object of this type. ",c+=!1===a.computed?a.property.name:""}break;case "Property":switch(m){case "ONLYLITERAL":c+="Property names must be literals or identifiers"}break;case "Literal":break;case "ThisExpression":c+="THIS construct is not supported.";case "CallExpression":switch(m){case "WRONGSIGNATURE":c+="Function signature does not match: ";
c+=a.callee.name;break;case "ONLYNODESUPPORTED":c+="Functions must be declared.";c+=a.callee.name;break;case "NOTAFUNCTION":c+="Not a Function: ";c+=a.callee.name;break;case "NOTFOUND":c+="Function Not Found: "+a.callee.name}break;case "UnaryExpression":switch(m){case "NOTSUPPORTEDUNARYOPERATOR":c+="Operator "+a.operator+" not allowed in this context. Only ! can be used with boolean, and - with a number";break;case "NOTSUPPORTEDTYPE":c+="Unary operator "+a.operator+" cannot be used with this argument."}case "BinaryExpression":switch(m){case "OPERATORNOTRECOGNISED":c+=
"Binary Operator not recognised "+a.operator}break;case "LogicalExpression":switch(m){case "ONLYBOOLEAN":c+="Operator "+a.operator+" cannot be used. Only || or \x26\x26 are allowed values";break;case "ONLYORORAND":c+="Logical Expression "+a.operator+" being applied to parameters that are not boolean."}break;case "ConditionalExpression":c+="Conditional statements not supported.";break;case "ArrayExpression":switch(m){case "FUNCTIONCONTEXTILLEGAL":c+=" Cannot Put Function inside Array."}break;case "Array":c+=
"Expression contains unrecognised array structure.";break;default:c+="Expression contains unrecognised code structures."}}catch(J){throw J;}return c}function q(a,b,m){return{line:a.loc.start.line,character:a.loc.start.column,reason:C(a,b,m)}}function v(a,b,m,c,k){void 0===k&&(k=!0);b={globalScope:b.globalScope,localScope:{}};for(k=0;k<a.params.length;k++)b.localScope[a.params[k].name.toLowerCase()]={type:"any"};y(a.body,b,m,c,!1)}function y(a,b,m,c,d){if(void 0===d&&(d=!0),null===a)throw Error("Unnexpexted Expression Syntax");
var t=null;try{switch(a.type){case "VariableDeclarator":return null!==a.init&&"FunctionExpression"===a.init.type?void c.push(q(a,"SYNTAX","FUNCTIONVARIABLEDECLARATOR")):("Identifier"!==a.id.type?c.push(q(a,"SYNTAX","VARIABLEMUSTHAVEIDENTIFIER")):(null!==b.localScope?void 0!==b.localScope[a.id.name.toLowerCase()]:void 0!==b.globalScope[a.id.name.toLowerCase()],null===b.localScope?b.globalScope[a.id.name.toLowerCase()]={type:"any"}:b.localScope[a.id.name.toLowerCase()]={type:"any"}),void(null===a.init?
"":y(a.init,b,m,c,d)));case "FunctionDeclaration":return!1===d&&c.push(q(a,"SYNTAX","GLOBALFUNCTIONSONLY")),"Identifier"!==a.id.type&&c.push(q(a,"SYNTAX","FUNCTIONMUSTHAVEIDENTIFIER")),t=k("",a,b),v(a,b,m,c,d),null!==b.localScope&&c.push(q(a,"SYNTAX","GLOBALFUNCTIONSONLY")),t.isnative=!1,void("Identifier"===a.id.type&&(b.globalScope[a.id.name.toLowerCase()]={type:"FormulaFunction",signature:[t]}));case "VariableDeclaration":for(var E=0;E<a.declarations.length;E++)y(a.declarations[E],b,m,c,d);break;
case "IfStatement":return null!==a.test&&(y(a.test,b,m,c,d),("AssignmentExpression"===a.test.type||"UpdateExpression"===a.test.type)&&c.push(q(a.test,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))),null!==a.consequent&&y(a.consequent,b,m,c,d),void(null!==a.alternate&&y(a.alternate,b,m,c,d));case "EmptyStatement":break;case "BlockStatement":if(null!==a.body)for(E=0;E<a.body.length;E++)y(a.body[E],b,m,c,d);break;case "ReturnStatement":return void(null!==a.argument&&y(a.argument,b,m,c,d));case "ForInStatement":return"VariableDeclaration"===
a.left.type?(1<a.left.declarations.length&&c.push(q(a,"SYNTAX","ONLY1VAR")),null!==a.left.declarations[0].init&&c.push(q(a,"SYNTAX","CANNOTDECLAREVAL"))):"Identifier"!==a.left.type&&c.push(q(a,"SYNTAX","LEFTNOTVAR")),y(a.left,b,m,c,d),y(a.right,b,m,c,d),void y(a.body,b,m,c,d);case "ForStatement":return null!==a.init&&y(a.init,b,m,c,d),null!==a.test&&y(a.test,b,m,c,d),null!==a.body&&y(a.body,b,m,c,d),void(null!==a.update&&y(a.update,b,m,c,d));case "BreakStatement":break;case "ContinueStatement":break;
case "UpdateExpression":"Identifier"!==a.argument.type&&"MemberExpression"!==a.argument.type?c.push(q(a,"SYNTAX","ASSIGNMENTTOVARSONLY")):("Identifier"===a.argument.type&&(t=!1,!1===m&&(null!==b.localScope&&void 0!==b.localScope[a.argument.name.toLowerCase()]&&(t=!0),void 0!==b.globalScope[a.argument.name.toLowerCase()]&&(t=!0),!1===t&&c.push({line:null===a?0:a.loc.start.line,character:null===a?0:a.loc.start.column,reason:"Identifier "+a.argument.name+" has not been declared."}))),"MemberExpression"===
a.argument.type&&y(a.argument,b,m,c,d));break;case "AssignmentExpression":switch("Identifier"!==a.left.type&&"MemberExpression"!==a.left.type&&c.push(q(a,"SYNTAX","ASSIGNMENTTOVARSONLY")),a.operator){case "\x3d":case "/\x3d":case "*\x3d":case "%\x3d":case "+\x3d":case "-\x3d":break;default:c.push(q(a,"SYNTAX","OPERATORNOTRECOGNISED"))}y(a.right,b,m,c,d);t=!1;return"Identifier"===a.left.type&&(null!==b.localScope&&void 0!==b.localScope[a.left.name.toLowerCase()]&&(t=!0),void 0!==b.globalScope[a.left.name.toLowerCase()]&&
(t=!0),!1===m&&!1===t&&c.push({line:null===a?0:a.loc.start.line,character:null===a?0:a.loc.start.column,reason:"Identifier "+a.argument.name+" has not been declared."})),void("MemberExpression"===a.left.type&&y(a.left,b,m,c,d));case "ExpressionStatement":return void y(a.expression,b,m,c,d);case "Identifier":var B=a.name.toLowerCase();if(null!==b.localScope&&void 0!==b.localScope[B])break;if(void 0!==b.globalScope[B])break;!1===m&&c.push(q(a,"SYNTAX","VARIABLENOTFOUND"));break;case "MemberExpression":return y(a.object,
b,m,c,d),void(!0===a.computed&&y(a.property,b,m,c,d));case "Literal":return"";case "ThisExpression":c.push(q(a,"SYNTAX","NOTSUPPORTED"));break;case "CallExpression":"Identifier"!==a.callee.type&&c.push(q(a,"SYNTAX","ONLYNODESSUPPORTED"));for(E=0;E<a.arguments.length;E++)y(a.arguments[E],b,m,c,d);var h=l(a.callee.name,a.arguments,b);return!1===m&&-1===h&&c.push(q(a,"SYNTAX","NOTFOUND")),void(-2===h&&c.push(q(a,"SYNTAX","WRONGSIGNATURE")));case "UnaryExpression":return void y(a.argument,b,m,c,d);case "BinaryExpression":switch(y(a.left,
b,m,c,d),y(a.right,b,m,c,d),a.operator){case "\x3d\x3d":case "!\x3d":case "\x3c":case "\x3c\x3d":case "\x3e":case "\x3e\x3d":case "+":case "-":case "*":case "/":case "%":break;default:c.push(q(a,"SYNTAX","OPERATORNOTRECOGNISED"))}break;case "LogicalExpression":switch(a.operator){case "\x26\x26":case "||":break;default:c.push(q(a,"SYNTAX","OPERATORNOTRECOGNISED"))}return y(a.left,b,m,c,d),("AssignmentExpression"===a.left.type||"UpdateExpression"===a.left.type)&&c.push(q(a,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION")),
y(a.right,b,m,c,d),void(("AssignmentExpression"===a.right.type||"UpdateExpression"===a.right.type)&&c.push(q(a,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION")));case "ConditionalExpression":c.push(q(a,"SYNTAX","NOTSUPPORTED"));break;case "ArrayExpression":for(E=0;E<a.elements.length;E++)y(a.elements[E],b,m,c,d);break;case "Array":c.push(q(a,"SYNTAX","NOTSUPPORTED"));case "ObjectExpression":for(E=0;E<a.properties.length;E++)y(a.properties[E],b,m,c,d);break;case "Property":return"Literal"!==a.key.type&&
"Identifier"!==a.key.type&&c.push(q(a,"SYNTAX","ONLYLITERAL")),"Literal"===a.key.type&&y(a.key,b,m,c,d),void y(a.value,b,m,c,d);default:c.push(q(a,"SYNTAX","UNRECOGNISED"))}}catch(N){c.push({line:null===a?0:a.loc.start.line,character:null===a?0:a.loc.start.column,reason:"Unnexpected Syntax"})}}function B(a,b){var m,c=[];try{switch(a.type){case "VariableDeclarator":return null!==a.init?B(a.init,b):c;case "FunctionDeclaration":return B(a.body,b);case "VariableDeclaration":for(var k=0;k<a.declarations.length;k++)m=
B(a.declarations[k],b),c=c.concat(m);return c;case "ForInStatement":return m=B(a.left,b),c=c.concat(m),m=B(a.right,b),c=c.concat(m),m=B(a.body,b),c=c.concat(m);case "ForStatement":return null!==a.init&&(m=B(a.init,b),c=c.concat(m)),null!==a.test&&(m=B(a.test,b),c=c.concat(m)),null!==a.body&&(m=B(a.body,b),c=c.concat(m)),null!==a.update&&(m=B(a.update,b),c=c.concat(m)),c;case "IfStatement":return m=B(a.test,b),c=c.concat(m),null!==a.consequent&&(m=B(a.consequent,b),c=c.concat(m)),null!==a.alternate&&
(m=B(a.alternate,b),c=c.concat(m)),c;case "EmptyStatement":return c;case "BlockStatement":for(k=0;k<a.body.length;k++)m=B(a.body[k],b),c=c.concat(m);return c;case "ReturnStatement":return null!==a.argument?B(a.argument,b):c;case "UpdateExpression":return B(a.argument,b);case "AssignmentExpression":return c=B(a.left,b),c=c.concat(B(a.right,b));case "ExpressionStatement":return B(a.expression,b);case "BreakStatement":return c;case "ContinueStatement":return c;case "Compound":return c;case "Identifier":return c;
case "MemberExpression":return c;case "Literal":return c;case "ThisExpression":return c;case "CallExpression":for(k=0;k<a.arguments.length;k++)m=B(a.arguments[k],b),c=c.concat(m);return c.push(a.callee.name.toLowerCase()),c;case "ArrayExpression":for(k=0;k<a.elements.length;k++)m=B(a.elements[k],b),c=c.concat(m);return c;case "UnaryExpression":return B(a.argument,b);case "ObjectExpression":for(k=0;k<a.properties.length;k++)m=B(a.properties[k],b),c=c.concat(m);return c;case "Property":return B(a.value,
b);case "BinaryExpression":return m=B(a.left,b),c=c.concat(m),m=B(a.right,b),c=c.concat(m);case "LogicalExpression":return m=B(a.left,b),c=c.concat(m),m=B(a.right,b),c=c.concat(m);case "ConditionalExpression":return c;case "Array":return c;default:return c}}catch(G){throw G;}}Object.defineProperty(p,"__esModule",{value:!0});p.functionDecls={concatenate:{min:"0",max:"*",av:"a"},split:{min:"2",max:"4",av:"a"},guid:{min:"0",max:"1",av:"a"},today:{min:"0",max:"0",av:"a"},now:{min:"0",max:"0",av:"a"},
timestamp:{min:"0",max:"0",av:"a"},day:{min:"1",max:"1",av:"a"},month:{min:"1",max:"1",av:"a"},year:{min:"1",max:"1",av:"a"},hour:{min:"1",max:"1",av:"a"},second:{min:"1",max:"1",av:"a"},millisecond:{min:"1",max:"1",av:"a"},minute:{min:"1",max:"1",av:"a"},weekday:{min:"1",max:"1",av:"a"},toutc:{min:"1",max:"1",av:"a"},tolocal:{min:"1",max:"1",av:"a"},date:{min:"0",max:"7",av:"a"},datediff:{min:"2",max:"3",av:"a"},dateadd:{min:"2",max:"3",av:"a"},trim:{min:"1",max:"1",av:"a"},text:{min:"1",max:"2",
av:"a"},left:{min:"2",max:"2",av:"a"},right:{min:"2",max:"2",av:"a"},mid:{min:"2",max:"3",av:"a"},upper:{min:"1",max:"1",av:"a"},proper:{min:"1",max:"2",av:"a"},lower:{min:"1",max:"1",av:"a"},find:{min:"2",max:"3",av:"a"},iif:{min:"3",max:"3",av:"a"},decode:{min:"2",max:"*",av:"a"},when:{min:"2",max:"*",av:"a"},defaultvalue:{min:"2",max:"2",av:"a"},isempty:{min:"1",max:"1",av:"a"},domaincode:{min:"3",max:"4",av:"a"},domainname:{min:"2",max:"4",av:"a"},polygon:{min:"1",max:"1",av:"a"},point:{min:"1",
max:"1",av:"a"},polyline:{min:"1",max:"1",av:"a"},extent:{min:"1",max:"1",av:"a"},multipoint:{min:"1",max:"1",av:"a"},geometry:{min:"1",max:"1",av:"a"},count:{min:"0",max:"*",av:"a"},number:{min:"1",max:"2",av:"a"},acos:{min:"1",max:"1",av:"a"},asin:{min:"1",max:"1",av:"a"},atan:{min:"1",max:"1",av:"a"},atan2:{min:"2",max:"2",av:"a"},ceil:{min:"1",max:"2",av:"a"},floor:{min:"1",max:"2",av:"a"},round:{min:"1",max:"2",av:"a"},cos:{min:"1",max:"1",av:"a"},exp:{min:"1",max:"1",av:"a"},log:{min:"1",max:"1",
av:"a"},min:{min:"0",max:"*",av:"a"},constrain:{min:"3",max:"3",av:"a"},console:{min:"0",max:"*",av:"a"},max:{min:"0",max:"*",av:"a"},pow:{min:"2",max:"2",av:"a"},random:{min:"0",max:"0",av:"a"},sqrt:{min:"1",max:"1",av:"a"},sin:{min:"1",max:"1",av:"a"},tan:{min:"1",max:"1",av:"a"},abs:{min:"1",max:"1",av:"a"},isnan:{min:"1",max:"1",av:"a"},stdev:{min:"0",max:"*",av:"a"},average:{min:"0",max:"*",av:"a"},mean:{min:"0",max:"*",av:"a"},sum:{min:"0",max:"*",av:"a"},variance:{min:"0",max:"*",av:"a"},distinct:{min:"0",
max:"*",av:"a"},first:{min:"1",max:"1",av:"a"},top:{min:"2",max:"2",av:"a"},"boolean":{min:"1",max:"1",av:"a"},dictionary:{min:"0",max:"*",av:"a"},"typeof":{min:"1",max:"1",av:"a"},reverse:{min:"1",max:"1",av:"a"},replace:{min:"3",max:"4",av:"a"},sort:{min:"1",max:"2",av:"a"},feature:{min:"1",max:"*",av:"a"},haskey:{min:"2",max:"2",av:"a"},indexof:{min:"2",max:"2",av:"a"},disjoint:{min:"2",max:"2",av:"a"},intersects:{min:"2",max:"2",av:"a"},touches:{min:"2",max:"2",av:"a"},crosses:{min:"2",max:"2",
av:"a"},within:{min:"2",max:"2",av:"a"},contains:{min:"2",max:"2",av:"a"},overlaps:{min:"2",max:"2",av:"a"},equals:{min:"2",max:"2",av:"a"},relate:{min:"3",max:"3",av:"a"},intersection:{min:"2",max:"2",av:"a"},union:{min:"1",max:"2",av:"a"},difference:{min:"2",max:"2",av:"a"},symmetricdifference:{min:"2",max:"2",av:"a"},clip:{min:"2",max:"2",av:"a"},cut:{min:"2",max:"2",av:"a"},area:{min:"1",max:"2",av:"a"},areageodetic:{min:"1",max:"2",av:"a"},length:{min:"1",max:"2",av:"a"},lengthgeodetic:{min:"1",
max:"2",av:"a"},distance:{min:"2",max:"3",av:"a"},densify:{min:"2",max:"3",av:"a"},densifygeodetic:{min:"2",max:"3",av:"a"},generalize:{min:"2",max:"4",av:"a"},buffer:{min:"2",max:"3",av:"a"},buffergeodetic:{min:"2",max:"3",av:"a"},offset:{min:"2",max:"6",av:"a"},rotate:{min:"2",max:"3",av:"a"},issimple:{min:"1",max:"1",av:"a"},simplify:{min:"1",max:"1",av:"a"},centroid:{min:"1",max:"1",av:"a"},multiparttosinglepart:{min:"1",max:"1",av:"a"},setgeometry:{min:"2",max:"2",av:"a"}};p.addFunctionDeclaration=
function(a,b){var c=p.functionDecls[a.name.toLowerCase()];void 0===c?p.functionDecls[a.name.toLowerCase()]={min:a.min,max:a.max,av:b}:"a"===c.av&&"f"===b?(void 0!==c.fmin&&delete c.fmin,void 0!==c.fmax&&delete c.fmax,c.fmin=a.min,c.fmax=a.max):"f"===c.av&&"a"===b?(void 0===c.fmin&&(c.fmin=c.min),void 0===c.fmax&&(c.fmax=c.max),c.min=a.min,c.max=a.max,c.av="a"):"f"===b?(c.fmin=a.min,c.fmax=a.max):"a"===b&&(c.min=a.min,c.max=a.max)};p.checkFunctionSignature=w;p.findFunction=l;p.validateLanguageNode=
h;p.testValidityOfExpression=d;p.referencesMemberImpl=u;p.referencesMember=function(a,b){return!0===u(a.body[0].body,b.toLowerCase())?!0:!1};p.referencesFunctionImpl=r;p.referencesFunction=function(a,b){return!0===r(a.body[0].body,b)?!0:!1};p.findFieldLiteralsImpl=a;p.findFieldLiterals=function(c,b){return a(c.body[0].body,b)};p.extractFunctionDeclaration=k;p.validateFunction=c;p.constructGlobalScope=t;p.validateScript=function(a,b,c){void 0===c&&(c="full");b={globalScope:t(b.vars,p.functionDecls,
b.customFunctions,c),localScope:null};return d(a.body[0].body,b)};p.validateLanguage=function(a){return"BlockStatement"!==a.body[0].body.type?"Invalid formula content.":h(a.body[0].body)};p.nodeErrorMessage=C;p.makeError=q;p.extractAllIssuesInFunction=v;p.extractAllIssues=y;p.checkScript=function(a,b,c,k){void 0===k&&(k="full");var m=[];if("BlockStatement"!==a.body[0].body.type)return[{line:0,character:0,reason:"Invalid Body"}];null!==b&&void 0!==b||(b={vars:{},customFunctions:[]});b={globalScope:t(b.vars,
p.functionDecls,b.customFunctions,k),localScope:null};try{y(a.body[0].body,b,c,m)}catch(G){}return m};p.findFunctionCallsImpl=B;p.findFunctionCalls=function(a,b){return B(a.body[0].body,b)}})},"esri/arcade/Dictionary":function(){define(["require","exports","./languageUtils","../geometry/Geometry","./ImmutableArray"],function(A,p,w,l,h){return function(){function d(h){this.attributes=null;this.plain=!1;this.immutable=!0;h instanceof d?this.attributes=h.attributes:void 0===h?this.attributes={}:null===
h?this.attributes={}:this.attributes=h}return d.prototype.field=function(d){var h=d.toLowerCase();d=this.attributes[d];if(void 0!==d)return d;for(var a in this.attributes)if(a.toLowerCase()===h)return this.attributes[a];throw Error("Field not Found");},d.prototype.setField=function(d,h){if(this.immutable)throw Error("Dictionary is Immutable");var a=d.toLowerCase();if(void 0!==this.attributes[d])return void(this.attributes[d]=h);for(var k in this.attributes)if(k.toLowerCase()===a)return void(this.attributes[k]=
h);this.attributes[d]=h},d.prototype.hasField=function(d){var h=d.toLowerCase();if(void 0!==this.attributes[d])return!0;for(var a in this.attributes)if(a.toLowerCase()===h)return!0;return!1},d.prototype.keys=function(){var d=[],h;for(h in this.attributes)d.push(h);return d=d.sort()},d.prototype.castToText=function(){var d="",r;for(r in this.attributes){""!==d&&(d+=",");var a=this.attributes[r];null==a?d+=JSON.stringify(r)+":null":w.isBoolean(a)||w.isNumber(a)||w.isString(a)?d+=JSON.stringify(r)+":"+
JSON.stringify(a):a instanceof l?d+=JSON.stringify(r)+":"+w.toStringExplicit(a):a instanceof h?d+=JSON.stringify(r)+":"+w.toStringExplicit(a):a instanceof Array?d+=JSON.stringify(r)+":"+w.toStringExplicit(a):a instanceof Date?d+=JSON.stringify(r)+":"+JSON.stringify(a):null!==a&&"object"==typeof a&&void 0!==a.castToText&&(d+=JSON.stringify(r)+":"+a.castToText())}return"{"+d+"}"},d}()})},"esri/arcade/Feature":function(){define("require exports dojo/_base/lang ../geometry/Geometry ../geometry/support/jsonUtils ./Dictionary ./languageUtils ./ImmutableArray ../geometry/Point".split(" "),
function(A,p,w,l,h,d,u,r,a){return function(){function k(a,t,r){(this.geometry=null,this.attributes=null,this._layer=null,this._datesfixed=!0,this.immutable=!0,a instanceof k)?(this.attributes=a.attributes,this.geometry=a.geometry,a._layer&&(this._layer=a._layer)):a&&"esri.Graphic"===a.declaredClass?(this.geometry=a.geometry,void 0===a.attributes?this.attributes={}:null===a.attributes?this.attributes={}:this.attributes=a.attributes,a._sourceLayer?(this._layer=a._sourceLayer,this._datesfixed=!1):a._layer?
(this._layer=a._layer,this._datesfixed=!1):a.layer&&(this._layer=a.layer,this._datesfixed=!1)):a instanceof d?(this.attributes=a.field("attributes"),null!==this.attributes&&(this.attributes instanceof d?this.attributes=this.attributes.attributes:this.attributes=null),this.geometry=a.field("geometry"),null!==this.geometry&&(this.geometry instanceof d?this.geometry=k.parseGeometryFromDictionary(this.geometry):this.geometry instanceof l||(this.geometry=null))):(t instanceof l||null===t?(this.geometry=
t,void 0===a?this.attributes={}:null===a?this.attributes={}:this.attributes=a):"string"==typeof a?(a=JSON.parse(a),null!==a.geometry&&void 0!==a.geometry&&(this.geometry=h.fromJSON(a.geometry)),void 0===a.attributes?this.attributes={}:null===a.attributes?this.attributes={}:this.attributes=a.attributes):(void 0===a?this.attributes={}:null===a&&(this.attributes={}),this.geometry=null),void 0!==r&&(this._layer=r))}return k.prototype.castToText=function(){var a="",k;for(k in this.attributes){""!==a&&
(a+=",");var d=this.attributes[k];null==d?a+=JSON.stringify(k)+":null":u.isBoolean(d)||u.isNumber(d)||u.isString(d)?a+=JSON.stringify(k)+":"+JSON.stringify(d):d instanceof l?a+=JSON.stringify(k)+":"+u.toStringExplicit(d):d instanceof r?a+=JSON.stringify(k)+":"+u.toStringExplicit(d):d instanceof Array?a+=JSON.stringify(k)+":"+u.toStringExplicit(d):d instanceof Date?a+=JSON.stringify(k)+":"+JSON.stringify(d):null!==d&&"object"==typeof d&&void 0!==d.castToText&&(a+=JSON.stringify(k)+":"+d.castToText())}return'{"geometry":'+
(null===this.geometry?"null":u.toStringExplicit(this.geometry))+',"attributes":{'+a+"}}"},k.prototype._fixDates=function(){for(var a=[],k=0;k<this._layer.fields.length;k++){var d=this._layer.fields[k];"date"!==d.type&&"esriFieldTypeDate"!==d.type||a.push(d.name)}0<a.length&&this._fixDateFields(a);this._datesfixed=!0},k.prototype._fixDateFields=function(a){this.attributes=w.mixin({},this.attributes);for(var c=0;c<a.length;c++){var k=this.attributes[a[c]];if(null!==k)if(void 0===k)for(var d in this.attributes){if(d.toLowerCase()===
a[c]){k=this.attributes[d];null!==k&&(k instanceof Date||(this.attributes[d]=new Date(k)));break}}else k instanceof Date||(this.attributes[a[c]]=new Date(k))}},k.prototype.field=function(a){!1===this._datesfixed&&this._fixDates();var c=a.toLowerCase();a=this.attributes[a];if(void 0!==a)return a;for(var k in this.attributes)if(k.toLowerCase()===c)return this.attributes[k];if(this._hasFieldDefinition(c))return null;throw Error("Field not Found");},k.prototype._hasFieldDefinition=function(a){if(null===
this._layer)return!1;for(var c=0;c<this._layer.fields.length;c++)if(this._layer.fields[c].name.toLowerCase()===a)return!0;return!1},k.prototype._field=function(a){!1===this._datesfixed&&this._fixDates();var c=a.toLowerCase();a=this.attributes[a];if(void 0!==a)return a;for(var k in this.attributes)if(k.toLowerCase()===c)return this.attributes[k];return null},k.prototype.setField=function(a,k){if(this.immutable)throw Error("Feature is Immutable");if(!1===u.isSimpleType(k))throw Error("Illegal Value Assignment to Feature");
var c=a.toLowerCase();if(void 0!==this.attributes[a])return void(this.attributes[a]=k);for(var d in this.attributes)if(d.toLowerCase()===c)return void(this.attributes[d]=k);this.attributes[a]=k},k.prototype.hasField=function(a){var c=a.toLowerCase();if(void 0!==this.attributes[a])return!0;for(var k in this.attributes)if(k.toLowerCase()===c)return!0;return this._hasFieldDefinition(c)?!0:!1},k.prototype.keys=function(){var a=[],k={},d;for(d in this.attributes)a.push(d),k[d.toLowerCase()]=1;if(null!==
this._layer)for(d=0;d<this._layer.fields.length;d++){var q=this._layer.fields[d];1!==k[q.name.toLowerCase()]&&a.push(q.name)}return a=a.sort()},k.fromFeature=function(a){return new k(a)},k.parseGeometryFromDictionary=function(a){a=k.convertDictionaryToJson(a,!0);return void 0!==a.spatialreference&&(a.spatialReference=a.spatialreference,delete a.spatialreference),void 0!==a.rings&&(a.rings=this.fixPathArrays(a.rings,!0===a.hasZ,!0===a.hasM)),void 0!==a.paths&&(a.paths=this.fixPathArrays(a.paths,!0===
a.hasZ,!0===a.hasM)),void 0!==a.points&&(a.points=this.fixPointArrays(a.points,!0===a.hasZ,!0===a.hasM)),h.fromJSON(a)},k.fixPathArrays=function(a,k,d){var c=[];if(a instanceof Array)for(var t=0;t<a.length;t++)c.push(this.fixPointArrays(a[t],k,d));else if(a instanceof r)for(t=0;t<a.length();t++)c.push(this.fixPointArrays(a.get(t),k,d));return c},k.fixPointArrays=function(c,k,d){var q=[];if(c instanceof Array)for(var t=0;t<c.length;t++){var y=c[t];y instanceof a?k&&d?q.push([y.x,y.y,y.z,y.m]):k?q.push([y.x,
y.y,y.z]):d?q.push([y.x,y.y,y.m]):q.push([y.x,y.y]):q.push(y)}else if(c instanceof r)for(t=0;t<c.length();t++)y=c.get(t),y instanceof a?k&&d?q.push([y.x,y.y,y.z,y.m]):k?q.push([y.x,y.y,y.z]):d?q.push([y.x,y.y,y.m]):q.push([y.x,y.y]):q.push(y);return q},k.convertDictionaryToJson=function(a,t){void 0===t&&(t=!1);var c={},q;for(q in a.attributes){var v=a.attributes[q];v instanceof d&&(v=k.convertDictionaryToJson(v));t?c[q.toLowerCase()]=v:c[q]=v}return c},k.parseAttributesFromDictionary=function(a){var c=
{},k;for(k in a.attributes){var d=a.attributes[k];if(!u.isSimpleType(d))throw Error("Illegal Argument");c[k]=d}return c},k.fromJson=function(a){var c=null;null!==a.geometry&&void 0!==a.geometry&&(c=h.fromJSON(a.geometry));var d={};if(null!==a.attributes&&void 0!==a.attributes)for(var q in a.attributes){var v=a.attributes[q];if(!(u.isString(v)||u.isNumber(v)||u.isBoolean(v)||u.isDate(v)))throw Error("Illegal Argument");d[q]=v}return new k(d,c)},k.prototype.domainValueLookup=function(a,k,d){if(null===
this._layer||!this._layer.fields)return null;d=u.getDomain(a,this._layer,this,d);if(void 0===k)try{k=this.field(a)}catch(q){return null}return u.getDomainValue(d,k)},k.prototype.domainCodeLookup=function(a,k,d){if(null===this._layer||!this._layer.fields)return null;a=u.getDomain(a,this._layer,this,d);return u.getDomainCode(a,k)},k}()})},"esri/geometry/support/jsonUtils":function(){define("require exports ../Extent ../Multipoint ../Point ../Polygon ../Polyline".split(" "),function(A,p,w,l,h,d,u){function r(a){return a?
void 0!==a.x&&void 0!==a.y?h.fromJSON(a):void 0!==a.paths?u.fromJSON(a):void 0!==a.rings?d.fromJSON(a):void 0!==a.points?l.fromJSON(a):void 0!==a.xmin&&void 0!==a.ymin&&void 0!==a.xmax&&void 0!==a.ymax?w.fromJSON(a):null:null}Object.defineProperty(p,"__esModule",{value:!0});p.fromJson=function(a){try{throw Error("fromJson is deprecated, use fromJSON instead");}catch(c){console.warn(c.stack)}return r(a)};p.fromJSON=r;p.getJsonType=function(a){return a instanceof h?"esriGeometryPoint":a instanceof u?
"esriGeometryPolyline":a instanceof d?"esriGeometryPolygon":a instanceof w?"esriGeometryEnvelope":a instanceof l?"esriGeometryMultipoint":null};var a={esriGeometryPoint:h,esriGeometryPolyline:u,esriGeometryPolygon:d,esriGeometryEnvelope:w,esriGeometryMultipoint:l};p.getGeometryType=function(k){return k&&a[k]||null}})},"esri/arcade/functions/date":function(){define(["require","exports","../../moment","../languageUtils"],function(A,p,w,l){function h(d){return null===d?d:isNaN(d.getTime())?null:d}Object.defineProperty(p,
"__esModule",{value:!0});p.registerFunctions=function(d,u){d.today=function(d,a){return u(d,a,function(a,c,d){l.pcCheck(d,0,0);a=new Date;return a.setHours(0,0,0,0),a})};d.now=function(d,a){return u(d,a,function(a,c,d){l.pcCheck(d,0,0);return new Date})};d.timestamp=function(d,a){return u(d,a,function(a,c,d){l.pcCheck(d,0,0);a=new Date;return a=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds())})};d.toutc=function(d,
a){return u(d,a,function(a,c,d){l.pcCheck(d,1,1);a=l.toDate(d[0]);return null===a?null:new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds())})};d.tolocal=function(d,a){return u(d,a,function(a,c,d){l.pcCheck(d,1,1);a=l.toDate(d[0]);return null===a?null:w.utc([a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()]).toDate()})};d.day=function(d,a){return u(d,a,function(a,
c,d){l.pcCheck(d,1,1);a=l.toDate(d[0]);return null===a?NaN:a.getDate()})};d.month=function(d,a){return u(d,a,function(a,c,d){l.pcCheck(d,1,1);a=l.toDate(d[0]);return null===a?NaN:a.getMonth()})};d.year=function(d,a){return u(d,a,function(a,c,d){l.pcCheck(d,1,1);a=l.toDate(d[0]);return null===a?NaN:a.getFullYear()})};d.hour=function(d,a){return u(d,a,function(a,c,d){l.pcCheck(d,1,1);a=l.toDate(d[0]);return null===a?NaN:a.getHours()})};d.second=function(d,a){return u(d,a,function(a,c,d){l.pcCheck(d,
1,1);a=l.toDate(d[0]);return null===a?NaN:a.getSeconds()})};d.millisecond=function(d,a){return u(d,a,function(a,c,d){l.pcCheck(d,1,1);a=l.toDate(d[0]);return null===a?NaN:a.getMilliseconds()})};d.minute=function(d,a){return u(d,a,function(a,c,d){l.pcCheck(d,1,1);a=l.toDate(d[0]);return null===a?NaN:a.getMinutes()})};d.weekday=function(d,a){return u(d,a,function(a,c,d){l.pcCheck(d,1,1);a=l.toDate(d[0]);return null===a?NaN:a.getDay()})};d.date=function(d,a){return u(d,a,function(a,c,d){if(l.pcCheck(d,
0,7),3===d.length)return h(new Date(l.toNumber(d[0]),l.toNumber(d[1]),l.toNumber(d[2]),0,0,0,0));if(4===d.length)return h(new Date(l.toNumber(d[0]),l.toNumber(d[1]),l.toNumber(d[2]),l.toNumber(d[3]),0,0,0));if(5===d.length)return h(new Date(l.toNumber(d[0]),l.toNumber(d[1]),l.toNumber(d[2]),l.toNumber(d[3]),l.toNumber(d[4]),0,0));if(6===d.length)return h(new Date(l.toNumber(d[0]),l.toNumber(d[1]),l.toNumber(d[2]),l.toNumber(d[3]),l.toNumber(d[4]),l.toNumber(d[5]),0));if(7===d.length)return h(new Date(l.toNumber(d[0]),
l.toNumber(d[1]),l.toNumber(d[2]),l.toNumber(d[3]),l.toNumber(d[4]),l.toNumber(d[5]),l.toNumber(d[6])));if(2===d.length){a=l.toString(d[1]);if(""===a)return null;a=l.standardiseDateFormat(a);d=w(l.toString(d[0]),a,!0);return!0===d.isValid()?d.toDate():null}if(1===d.length){if(l.isString(d[0])&&""===d[0].replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""))return null;a=l.toNumber(d[0]);return!1===isNaN(a)?h(new Date(a)):l.toDate(d[0])}return 0===d.length?new Date:void 0})};d.datediff=function(d,a){return u(d,
a,function(a,c,d){l.pcCheck(d,2,3);a=l.toDateM(d[0]);c=l.toDateM(d[1]);if(null===a||null===c)return NaN;switch(l.toString(d[2]).toLowerCase()){case "days":case "day":case "d":return a.diff(c,"days",!0);case "months":case "month":return a.diff(c,"months",!0);case "minutes":case "minute":case "m":return"M"===d[2]?a.diff(c,"months",!0):a.diff(c,"minutes",!0);case "seconds":case "second":case "s":return a.diff(c,"seconds",!0);case "milliseconds":case "millisecond":case "ms":return a.diff(c);case "hours":case "hour":case "h":return a.diff(c,
"hours",!0);case "years":case "year":case "y":return a.diff(c,"years",!0);default:return a.diff(c)}})};d.dateadd=function(d,a){return u(d,a,function(a,c,d){l.pcCheck(d,2,3);a=l.toDateM(d[0]);if(null===a)return null;c="milliseconds";switch(l.toString(d[2]).toLowerCase()){case "days":case "day":case "d":c="days";break;case "months":case "month":c="months";break;case "minutes":case "minute":case "m":c="M"===d[2]?"months":"minutes";break;case "seconds":case "second":case "s":c="seconds";break;case "milliseconds":case "millisecond":case "ms":c=
"milliseconds";break;case "hours":case "hour":case "h":c="hours";break;case "years":case "year":case "y":c="years"}return a.add(l.toNumber(d[1]),c),a.toDate()})}}})},"esri/arcade/functions/string":function(){define(["require","exports","../languageUtils","../Feature"],function(A,p,w,l){Object.defineProperty(p,"__esModule",{value:!0});p.registerFunctions=function(h,d){h.trim=function(h,l){return d(h,l,function(a,d,c){return w.pcCheck(c,1,1),w.toString(c[0]).trim()})};h.upper=function(h,l){return d(h,
l,function(a,d,c){return w.pcCheck(c,1,1),w.toString(c[0]).toUpperCase()})};h.proper=function(h,l){return d(h,l,function(a,d,c){w.pcCheck(c,1,2);a=1;2===c.length&&"firstword"===w.toString(c[1]).toLowerCase()&&(a=2);d=/\s/;c=w.toString(c[0]);for(var k="",h=!0,q=0;q<c.length;q++){var v=c[q];d.test(v)?1===a&&(h=!0):v.toUpperCase()!==v.toLowerCase()&&(h?(v=v.toUpperCase(),h=!1):v=v.toLowerCase());k+=v}return k})};h.lower=function(h,l){return d(h,l,function(a,d,c){return w.pcCheck(c,1,1),w.toString(c[0]).toLowerCase()})};
h.guid=function(h,l){return d(h,l,function(a,d,c){if(w.pcCheck(c,0,1),0<c.length)switch(w.toString(c[0]).toLowerCase()){case "digits":return w.generateUUID().replace("-","").replace("-","").replace("-","").replace("-","");case "digits-hyphen":return w.generateUUID();case "digits-hyphen-parentheses":return"("+w.generateUUID()+")"}return"{"+w.generateUUID()+"}"})};h.console=function(h,l){return d(h,l,function(a,d,c){return 0===c.length||(1===c.length?h.console(w.toString(c[0])):h.console(w.toString(c))),
w.voidOperation})};h.mid=function(h,l){return d(h,l,function(a,d,c){w.pcCheck(c,2,3);a=w.toNumber(c[1]);if(isNaN(a))return"";if(0>a&&(a=0),2===c.length)return w.toString(c[0]).substr(a);d=w.toNumber(c[2]);return isNaN(d)?"":(0>d&&(d=0),w.toString(c[0]).substr(a,d))})};h.find=function(h,l){return d(h,l,function(a,d,c){w.pcCheck(c,2,3);a=0;if(2<c.length){if(a=w.toNumber(w.defaultUndefined(c[2],0)),isNaN(a))return-1;0>a&&(a=0)}return w.toString(c[1]).indexOf(w.toString(c[0]),a)})};h.left=function(h,
l){return d(h,l,function(a,d,c){w.pcCheck(c,2,2);a=w.toNumber(c[1]);return isNaN(a)?"":(0>a&&(a=0),w.toString(c[0]).substr(0,a))})};h.right=function(h,l){return d(h,l,function(a,d,c){w.pcCheck(c,2,2);a=w.toNumber(c[1]);return isNaN(a)?"":(0>a&&(a=0),w.toString(c[0]).substr(-1*a,a))})};h.split=function(h,l){return d(h,l,function(a,d,c){w.pcCheck(c,2,4);var k;a=w.toNumber(w.defaultUndefined(c[2],-1));d=w.toBoolean(w.defaultUndefined(c[3],!1));if(-1===a||null===a||!0===d?k=w.toString(c[0]).split(w.toString(c[1])):
(isNaN(a)&&(a=-1),-1>a&&(a=-1),k=w.toString(c[0]).split(w.toString(c[1]),a)),!1===d)return k;c=[];for(d=0;d<k.length&&!(-1!==a&&c.length>=a);d++)""!==k[d]&&void 0!==k[d]&&c.push(k[d]);return c})};h.text=function(h,l){return d(h,l,function(a,d,c){return w.pcCheck(c,1,2),w.toStringExplicit(c[0],c[1])})};h.concatenate=function(h,l){return d(h,l,function(a,d,c){a=[];if(1>c.length)return"";if(w.isArray(c[0])){d=w.defaultUndefined(c[2],"");for(var k=0;k<c[0].length;k++)a[k]=w.toStringExplicit(c[0][k],d);
return 1<c.length?a.join(c[1]):a.join("")}if(w.isImmutableArray(c[0])){d=w.defaultUndefined(c[2],"");for(k=0;k<c[0].length();k++)a[k]=w.toStringExplicit(c[0].get(k),d);return 1<c.length?a.join(c[1]):a.join("")}for(k=0;k<c.length;k++)a[k]=w.toStringExplicit(c[k]);return a.join("")})};h.reverse=function(h,l){return d(h,l,function(a,d,c){if(w.pcCheck(c,1,1),w.isArray(c[0]))return a=c[0].slice(0),a.reverse(),a;if(w.isImmutableArray(c[0]))return a=c[0].toArray().slice(0),a.reverse(),a;throw Error("Invalid Parameter");
})};h.replace=function(h,l){return d(h,l,function(a,d,c){w.pcCheck(c,3,4);a=w.toString(c[0]);d=w.toString(c[1]);var k=w.toString(c[2]);return(4===c.length?w.toBoolean(c[3]):1)?w.multiReplace(a,d,k):a.replace(d,k)})};h.domainname=function(h,r){return d(h,r,function(a,d,c){if(w.pcCheck(c,2,4),c[0]instanceof l)return c[0].domainValueLookup(w.toString(c[1]),c[2],void 0===c[3]?void 0:w.toNumber(c[3]));throw Error("Invalid Parameter");})};h.domaincode=function(h,r){return d(h,r,function(a,d,c){if(w.pcCheck(c,
3,4),c[0]instanceof l)return c[0].domainCodeLookup(w.toString(c[1]),c[2],void 0===c[3]?void 0:w.toNumber(c[3]));throw Error("Invalid Parameter");})}}})},"esri/arcade/functions/maths":function(){define(["require","exports","../languageUtils","dojo/number"],function(A,p,w,l){function h(d,h,l){return"undefined"==typeof l||0===+l?Math[d](h):(h=+h,l=+l,isNaN(h)||"number"!=typeof l||0!==l%1?NaN:(h=h.toString().split("e"),h=Math[d](+(h[0]+"e"+(h[1]?+h[1]-l:-l))),h=h.toString().split("e"),+(h[0]+"e"+(h[1]?
+h[1]+l:l))))}Object.defineProperty(p,"__esModule",{value:!0});p.registerFunctions=function(d,u){function r(a,d,c){a=w.toNumber(a);return isNaN(a)?a:isNaN(d)||isNaN(c)?NaN:d>c?NaN:d>a?d:a>c?c:a}d.number=function(a,d){return u(a,d,function(a,d,k){w.pcCheck(k,1,2);a=k[0];return w.isNumber(a)?a:null===a?0:w.isDate(a)||w.isBoolean(a)?Number(a):w.isArray(a)?NaN:""===a||void 0===a?Number(a):w.isString(a)?void 0!==k[1]?(k=w.multiReplace(k[1],"\u2030",""),k=w.multiReplace(k,"\u00a4",""),l.parse(a,{pattern:k})):
Number(a.trim()):Number(a)})};d.abs=function(a,d){return u(a,d,function(a,d,k){return w.pcCheck(k,1,1),Math.abs(w.toNumber(k[0]))})};d.acos=function(a,d){return u(a,d,function(a,d,k){return w.pcCheck(k,1,1),Math.acos(w.toNumber(k[0]))})};d.asin=function(a,d){return u(a,d,function(a,d,k){return w.pcCheck(k,1,1),Math.asin(w.toNumber(k[0]))})};d.atan=function(a,d){return u(a,d,function(a,d,k){return w.pcCheck(k,1,1),Math.atan(w.toNumber(k[0]))})};d.atan2=function(a,d){return u(a,d,function(a,d,k){return w.pcCheck(k,
2,2),Math.atan2(w.toNumber(k[0]),w.toNumber(k[1]))})};d.ceil=function(a,d){return u(a,d,function(a,d,k){return(w.pcCheck(k,1,2),2===k.length)?(a=w.toNumber(k[1]),isNaN(a)&&(a=0),h("ceil",w.toNumber(k[0]),-1*a)):Math.ceil(w.toNumber(k[0]))})};d.round=function(a,d){return u(a,d,function(a,d,k){return(w.pcCheck(k,1,2),2===k.length)?(a=w.toNumber(k[1]),isNaN(a)&&(a=0),h("round",w.toNumber(k[0]),-1*a)):Math.round(w.toNumber(k[0]))})};d.floor=function(a,d){return u(a,d,function(a,d,k){return(w.pcCheck(k,
1,2),2===k.length)?(a=w.toNumber(k[1]),isNaN(a)&&(a=0),h("floor",w.toNumber(k[0]),-1*a)):Math.floor(w.toNumber(k[0]))})};d.cos=function(a,d){return u(a,d,function(a,d,k){return w.pcCheck(k,1,1),Math.cos(w.toNumber(k[0]))})};d.isnan=function(a,d){return u(a,d,function(a,d,k){return w.pcCheck(k,1,1),"number"==typeof k[0]&&isNaN(k[0])})};d.exp=function(a,d){return u(a,d,function(a,d,k){return w.pcCheck(k,1,1),Math.exp(w.toNumber(k[0]))})};d.log=function(a,d){return u(a,d,function(a,d,k){return w.pcCheck(k,
1,1),Math.log(w.toNumber(k[0]))})};d.pow=function(a,d){return u(a,d,function(a,d,k){return w.pcCheck(k,2,2),Math.pow(w.toNumber(k[0]),w.toNumber(k[1]))})};d.random=function(a,d){return u(a,d,function(a,d,k){return w.pcCheck(k,0,0),Math.random()})};d.sin=function(a,d){return u(a,d,function(a,d,k){return w.pcCheck(k,1,1),Math.sin(w.toNumber(k[0]))})};d.sqrt=function(a,d){return u(a,d,function(a,d,k){return w.pcCheck(k,1,1),Math.sqrt(w.toNumber(k[0]))})};d.tan=function(a,d){return u(a,d,function(a,d,
k){return w.pcCheck(k,1,1),Math.tan(w.toNumber(k[0]))})};d.defaultvalue=function(a,d){return u(a,d,function(a,d,k){return w.pcCheck(k,2,2),null===k[0]?k[1]:""===k[0]?k[1]:void 0===k[0]?k[1]:k[0]})};d.isempty=function(a,d){return u(a,d,function(a,d,k){return w.pcCheck(k,1,1),null===k[0]?!0:""===k[0]?!0:void 0===k[0]?!0:!1})};d["boolean"]=function(a,d){return u(a,d,function(a,d,k){w.pcCheck(k,1,1);return w.toBoolean(k[0])})};d.constrain=function(a,d){return u(a,d,function(a,d,k){w.pcCheck(k,3,3);a=
w.toNumber(k[1]);d=w.toNumber(k[2]);if(w.isArray(k[0])){var c=[],h=0;for(k=k[0];h<k.length;h++)c.push(r(k[h],a,d));return c}if(w.isImmutableArray(k[0])){c=[];for(h=0;h<k[0].length();h++)c.push(r(k[0].get(h),a,d));return c}return r(k[0],a,d)})}}})},"esri/arcade/functions/geometry":function(){define("require exports ../../geometry/Geometry ../../geometry/Polygon ../../geometry/Polyline ../../geometry/Point ../../geometry/Extent ../../geometry/Multipoint ../../geometry/support/jsonUtils ../languageUtils ../Dictionary ../Feature".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t){Object.defineProperty(p,"__esModule",{value:!0});p.registerFunctions=function(C,q){C.polygon=function(d,h){return q(d,h,function(q,h,b){k.pcCheck(b,1,1);q=null;if(b[0]instanceof c){if(q=k.fixSpatialReference(t.parseGeometryFromDictionary(b[0]),d.spatialReference),0==q instanceof l)throw Error("Illegal Parameter");}else q=b[0]instanceof l?a.fromJSON(b[0].toJSON()):k.fixSpatialReference(new l(JSON.parse(b[0])),d.spatialReference);if(null!==q&&!1===q.spatialReference.equals(d.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");
return k.fixNullGeometry(q)})};C.polyline=function(d,y){return q(d,y,function(q,y,b){k.pcCheck(b,1,1);q=null;if(b[0]instanceof c){if(q=k.fixSpatialReference(t.parseGeometryFromDictionary(b[0]),d.spatialReference),0==q instanceof h)throw Error("Illegal Parameter");}else q=b[0]instanceof h?a.fromJSON(b[0].toJSON()):k.fixSpatialReference(new h(JSON.parse(b[0])),d.spatialReference);if(null!==q&&!1===q.spatialReference.equals(d.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");
return k.fixNullGeometry(q)})};C.point=function(h,y){return q(h,y,function(q,y,b){k.pcCheck(b,1,1);q=null;if(b[0]instanceof c){if(q=k.fixSpatialReference(t.parseGeometryFromDictionary(b[0]),h.spatialReference),0==q instanceof d)throw Error("Illegal Parameter");}else q=b[0]instanceof d?a.fromJSON(b[0].toJSON()):k.fixSpatialReference(new d(JSON.parse(b[0])),h.spatialReference);if(null!==q&&!1===q.spatialReference.equals(h.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");
return k.fixNullGeometry(q)})};C.multipoint=function(d,h){return q(d,h,function(q,h,b){k.pcCheck(b,1,1);q=null;if(b[0]instanceof c){if(q=k.fixSpatialReference(t.parseGeometryFromDictionary(b[0]),d.spatialReference),0==q instanceof r)throw Error("Illegal Parameter");}else q=b[0]instanceof r?a.fromJSON(b[0].toJSON()):k.fixSpatialReference(new r(JSON.parse(b[0])),d.spatialReference);if(null!==q&&!1===q.spatialReference.equals(d.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");
return k.fixNullGeometry(q)})};C.extent=function(v,y){return q(v,y,function(q,y,b){k.pcCheck(b,1,1);q=null;b[0]instanceof c?q=k.fixSpatialReference(t.parseGeometryFromDictionary(b[0]),v.spatialReference):b[0]instanceof d?(q={xmin:b[0].x,ymin:b[0].y,xmax:b[0].x,ymax:b[0].y,spatialReference:b[0].spatialReference.toJSON()},b[0].hasZ?(q.zmin=b[0].z,q.zmax=b[0].z):b[0].hasM&&(q.mmin=b[0].m,q.mmax=b[0].m),q=a.fromJSON(q)):q=b[0]instanceof l?a.fromJSON(b[0].extent.toJSON()):b[0]instanceof h?a.fromJSON(b[0].extent.toJSON()):
b[0]instanceof r?a.fromJSON(b[0].extent.toJSON()):b[0]instanceof u?a.fromJSON(b[0].toJSON()):k.fixSpatialReference(new u(JSON.parse(b[0])),v.spatialReference);if(null!==q&&!1===q.spatialReference.equals(v.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return k.fixNullGeometry(q)})};C.geometry=function(d,h){return q(d,h,function(q,h,b){k.pcCheck(b,1,1);q=null;if(q=b[0]instanceof t?k.fixSpatialReference(b[0].geometry,
d.spatialReference):b[0]instanceof c?k.fixSpatialReference(t.parseGeometryFromDictionary(b[0]),d.spatialReference):k.fixSpatialReference(a.fromJSON(JSON.parse(b[0])),d.spatialReference),null!==q&&!1===q.spatialReference.equals(d.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return k.fixNullGeometry(q)})};C.setgeometry=function(a,c){return q(a,c,function(a,c,b){if(k.pcCheck(b,2,2),!(b[0]instanceof t))throw Error("Illegal Argument");
if(!0===b[0].immutable)throw Error("Feature is Immutable");if(!(b[1]instanceof w||null===b[1]))throw Error("Illegal Argument");return b[0].geometry=b[1],k.voidOperation})};C.feature=function(a,d){return q(a,d,function(d,q,b){if(0===b.length)throw Error("Missing Parameters");d=null;if(1===b.length)if(k.isString(b[0]))d=t.fromJson(JSON.parse(b[0]));else if(b[0]instanceof t)d=new t(b[0]);else if(b[0]instanceof w)d=new t(null,b[0]);else{if(!(b[0]instanceof c))throw Error("Illegal Argument");d=b[0].hasField("geometry")?
b[0].field("geometry"):null;q=b[0].hasField("attributes")?b[0].field("attributes"):null;null!==d&&d instanceof c&&(d=t.parseGeometryFromDictionary(d));null!==q&&(q=t.parseAttributesFromDictionary(q));d=new t(q,d)}else{if(2===b.length){q=d=null;if(null!==b[0])if(b[0]instanceof w)d=b[0];else{if(!(d instanceof c))throw Error("Illegal Argument");d=t.parseGeometryFromDictionary(b[0])}if(null!==b[1]){if(!(b[1]instanceof c))throw Error("Illegal Argument");q=t.parseAttributesFromDictionary(b[1])}}else{d=
null;q={};if(null!==b[0])if(b[0]instanceof w)d=b[0];else{if(!(d instanceof c))throw Error("Illegal Argument");d=t.parseGeometryFromDictionary(b[0])}for(var m=1;m<b.length;m+=2){var h=k.toString(b[m]),y=b[m+1];if(!(null===y||void 0===y||k.isString(y)||isNaN(y)||k.isDate(y)||k.isNumber(y)||k.isBoolean(y)))throw Error("Illegal Argument");if(k.isFunctionParameter(y)||!1===k.isSimpleType(y))throw Error("Illegal Argument");y===k.voidOperation?q[h]=null:q[h]=y}}d=new t(q,d)}return d.geometry=k.fixSpatialReference(d.geometry,
a.spatialReference),d.immutable=!1,d})};C.dictionary=function(a,d){return q(a,d,function(a,d,b){if(0===b.length)throw Error("Missing Parameters");if(0!==b.length%2)throw Error("Missing Parameters");a={};for(d=0;d<b.length;d+=2){var m=k.toString(b[d]),q=b[d+1];if(!(null===q||void 0===q||k.isString(q)||isNaN(q)||k.isDate(q)||k.isNumber(q)||k.isBoolean(q)||k.isArray(q)||k.isImmutableArray(q)))throw Error("Illegal Argument");if(k.isFunctionParameter(q))throw Error("Illegal Argument");q===k.voidOperation?
a[m]=null:a[m]=q}b=new c(a);return b.immutable=!1,b})};C.haskey=function(a,d){return q(a,d,function(a,d,b){k.pcCheck(b,2,2);a=k.toString(b[1]);if(b[0]instanceof t||b[0]instanceof c)return b[0].hasField(a);throw Error("Illegal Argument");})};C.indexof=function(a,c){return q(a,c,function(a,c,b){k.pcCheck(b,2,2);a=b[1];if(k.isArray(b[0])){for(c=0;c<b[0].length;c++)if(k.equalityTest(a,b[0][c]))return c;return-1}if(k.isImmutableArray(b[0])){var m=b[0].length();for(c=0;m>c;c++)if(k.equalityTest(a,b[0].get(c)))return c;
return-1}throw Error("Illegal Argument");})}}})},"esri/arcade/functions/geomsync":function(){define("require exports ../../geometry/Geometry ../../geometry/Polygon ../../geometry/Polyline ../../geometry/Point ../../geometry/Extent ../../geometry/Multipoint ../../geometry/support/jsonUtils ./centroid ../languageUtils ../kernel ../../kernel".split(" "),function(A,p,w,l,h,d,u,r,a,k,c,t,C){function q(c){return B?c.clone():a.fromJSON(c.toJSON())}function v(a){return 0===C.version.indexOf("4.")?l.fromExtent(a):
new l({spatialReference:a.spatialReference,rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]]})}Object.defineProperty(p,"__esModule",{value:!0});var y=null,B=0===C.version.indexOf("4.");p.setGeometryEngine=function(a){y=a};p.registerFunctions=function(D,b){function m(a){if(!((c.pcCheck(a,2,2),a[0]instanceof w&&a[1]instanceof w)||a[0]instanceof w&&null===a[1]||a[1]instanceof w&&null===a[0]||null===a[0]&&null===a[1]))throw Error("Illegal Argument");}D.disjoint=
function(a,c){return b(a,c,function(a,b,c){return m(c),null===c[0]||null===c[1]?!0:y.disjoint(c[0],c[1])})};D.intersects=function(a,c){return b(a,c,function(a,b,c){return m(c),null===c[0]||null===c[1]?!1:y.intersects(c[0],c[1])})};D.touches=function(a,c){return b(a,c,function(a,b,c){return m(c),null===c[0]||null===c[1]?!1:y.touches(c[0],c[1])})};D.crosses=function(a,c){return b(a,c,function(a,b,c){return m(c),null===c[0]||null===c[1]?!1:y.crosses(c[0],c[1])})};D.within=function(a,c){return b(a,c,
function(a,b,c){return m(c),null===c[0]||null===c[1]?!1:y.within(c[0],c[1])})};D.contains=function(a,c){return b(a,c,function(a,b,c){return m(c),null===c[0]||null===c[1]?!1:y.contains(c[0],c[1])})};D.overlaps=function(a,c){return b(a,c,function(a,b,c){return m(c),null===c[0]||null===c[1]?!1:y.overlaps(c[0],c[1])})};D.equals=function(a,m){return b(a,m,function(a,b,m){return c.pcCheck(m,2,2),m[0]===m[1]?!0:m[0]instanceof w&&m[1]instanceof w?y.equals(m[0],m[1]):c.isDate(m[0])&&c.isDate(m[1])?m[0].getTime()===
m[1].getTime():!1})};D.relate=function(a,m){return b(a,m,function(a,b,m){if(c.pcCheck(m,3,3),m[0]instanceof w&&m[1]instanceof w)return y.relate(m[0],m[1],c.toString(m[2]));if(m[0]instanceof w&&null===m[1]||m[1]instanceof w&&null===m[0]||null===m[0]&&null===m[1])return!1;throw Error("Illegal Argument");})};D.intersection=function(a,c){return b(a,c,function(a,b,c){return m(c),null===c[0]||null===c[1]?null:y.intersect(c[0],c[1])})};D.union=function(a,m){return b(a,m,function(b,m,d){b=[];if(0===d.length)throw Error("Function called with wrong number of Parameters");
if(1===d.length)if(c.isArray(d[0]))for(m=0;m<d[0].length;m++){if(null!==d[0][m]){if(!(d[0][m]instanceof w))throw Error("Illegal Argument");b.push(d[0][m])}}else{if(!c.isImmutableArray(d[0])){if(d[0]instanceof w)return c.fixSpatialReference(q(d[0]),a.spatialReference);if(null===d[0])return null;throw Error("Illegal Argument");}d=d[0].toArray();for(m=0;m<d.length;m++)if(null!==d[m]){if(!(d[m]instanceof w))throw Error("Illegal Argument");b.push(d[m])}}else for(m=0;m<d.length;m++)if(null!==d[m]){if(!(d[m]instanceof
w))throw Error("Illegal Argument");b.push(d[m])}return 0===b.length?null:y.union(b)})};D.difference=function(a,c){return b(a,c,function(a,b,c){return m(c),null!==c[0]&&null===c[1]?q(c[0]):null===c[0]?null:y.difference(c[0],c[1])})};D.symmetricdifference=function(a,c){return b(a,c,function(a,b,c){return m(c),null===c[0]&&null===c[1]?null:null===c[0]?q(c[1]):null===c[1]?q(c[0]):y.symmetricDifference(c[0],c[1])})};D.clip=function(a,m){return b(a,m,function(a,b,m){if(c.pcCheck(m,2,2),!(m[1]instanceof
u)&&null!==m[1])throw Error("Illegal Argument");if(null===m[0])return null;if(!(m[0]instanceof w))throw Error("Illegal Argument");return null===m[1]?null:y.clip(m[0],m[1])})};D.cut=function(a,m){return b(a,m,function(a,b,m){if(c.pcCheck(m,2,2),!(m[1]instanceof h)&&null!==m[1])throw Error("Illegal Argument");if(null===m[0])return[];if(!(m[0]instanceof w))throw Error("Illegal Argument");return null===m[1]?[q(m[0])]:y.cut(m[0],m[1])})};D.area=function(a,m){return b(a,m,function(a,b,m){if(c.pcCheck(m,
1,2),null===m[0])return 0;if(!(m[0]instanceof w))throw Error("Illegal Argument");return y.planarArea(m[0],t.convertSquareUnitsToCode(c.defaultUndefined(m[1],-1)))})};D.areageodetic=function(a,m){return b(a,m,function(a,b,m){if(c.pcCheck(m,1,2),null===m[0])return 0;if(!(m[0]instanceof w))throw Error("Illegal Argument");return y.geodesicArea(m[0],t.convertSquareUnitsToCode(c.defaultUndefined(m[1],-1)))})};D.length=function(a,m){return b(a,m,function(a,b,m){if(c.pcCheck(m,1,2),null===m[0])return 0;if(!(m[0]instanceof
w))throw Error("Illegal Argument");return y.planarLength(m[0],t.convertLinearUnitsToCode(c.defaultUndefined(m[1],-1)))})};D.lengthgeodetic=function(a,m){return b(a,m,function(a,b,m){if(c.pcCheck(m,1,2),null===m[0])return 0;if(!(m[0]instanceof w))throw Error("Illegal Argument");return y.geodesicLength(m[0],t.convertLinearUnitsToCode(c.defaultUndefined(m[1],-1)))})};D.distance=function(a,m){return b(a,m,function(a,b,m){if(c.pcCheck(m,2,3),!(m[0]instanceof w))throw Error("Illegal Argument");if(!(m[1]instanceof
w))throw Error("Illegal Argument");return y.distance(m[0],m[1],t.convertLinearUnitsToCode(c.defaultUndefined(m[2],-1)))})};D.densify=function(a,m){return b(a,m,function(a,b,m){if(c.pcCheck(m,2,3),null===m[0])return null;if(!(m[0]instanceof w))throw Error("Illegal Argument");a=c.toNumber(m[1]);if(isNaN(a))throw Error("Illegal Argument");if(0>=a)throw Error("Illegal Argument");return m[0]instanceof l||m[0]instanceof h?y.densify(m[0],a,t.convertLinearUnitsToCode(c.defaultUndefined(m[2],-1))):m[0]instanceof
u?y.densify(v(m[0]),a,t.convertLinearUnitsToCode(c.defaultUndefined(m[2],-1))):m[0]})};D.densifygeodetic=function(a,m){return b(a,m,function(a,b,m){if(c.pcCheck(m,2,3),null===m[0])return null;if(!(m[0]instanceof w))throw Error("Illegal Argument");a=c.toNumber(m[1]);if(isNaN(a))throw Error("Illegal Argument");if(0>=a)throw Error("Illegal Argument");return m[0]instanceof l||m[0]instanceof h?y.geodesicDensify(m[0],a,t.convertLinearUnitsToCode(c.defaultUndefined(m[2],-1))):m[0]instanceof u?y.geodesicDensify(v(m[0]),
a,t.convertLinearUnitsToCode(c.defaultUndefined(m[2],-1))):m[0]})};D.generalize=function(a,m){return b(a,m,function(a,b,m){if(c.pcCheck(m,2,4),null===m[0])return null;if(!(m[0]instanceof w))throw Error("Illegal Argument");a=c.toNumber(m[1]);if(isNaN(a))throw Error("Illegal Argument");return y.generalize(m[0],a,c.toBoolean(c.defaultUndefined(m[2],!0)),t.convertLinearUnitsToCode(c.defaultUndefined(m[3],-1)))})};D.buffer=function(a,m){return b(a,m,function(a,b,m){if(c.pcCheck(m,2,3),null===m[0])return null;
if(!(m[0]instanceof w))throw Error("Illegal Argument");a=c.toNumber(m[1]);if(isNaN(a))throw Error("Illegal Argument");return 0===a?q(m[0]):y.buffer(m[0],a,t.convertLinearUnitsToCode(c.defaultUndefined(m[2],-1)))})};D.buffergeodetic=function(a,m){return b(a,m,function(a,b,m){if(c.pcCheck(m,2,3),null===m[0])return null;if(!(m[0]instanceof w))throw Error("Illegal Argument");a=c.toNumber(m[1]);if(isNaN(a))throw Error("Illegal Argument");return 0===a?q(m[0]):y.geodesicBuffer(m[0],a,t.convertLinearUnitsToCode(c.defaultUndefined(m[2],
-1)))})};D.offset=function(a,m){return b(a,m,function(a,b,m){if(c.pcCheck(m,2,6),null===m[0])return null;if(!(m[0]instanceof l||m[0]instanceof h))throw Error("Illegal Argument");a=c.toNumber(m[1]);if(isNaN(a))throw Error("Illegal Argument");b=c.toNumber(c.defaultUndefined(m[4],10));if(isNaN(b))throw Error("Illegal Argument");var d=c.toNumber(c.defaultUndefined(m[5],0));if(isNaN(d))throw Error("Illegal Argument");return y.offset(m[0],a,t.convertLinearUnitsToCode(c.defaultUndefined(m[2],-1)),c.toString(c.defaultUndefined(m[3],
"round")).toLowerCase(),b,d)})};D.rotate=function(a,m){return b(a,m,function(a,b,m){c.pcCheck(m,2,3);a=m[0];if(null===a)return null;if(!(a instanceof w))throw Error("Illegal Argument");a instanceof u&&(a=l.fromExtent(a));b=c.toNumber(m[1]);if(isNaN(b))throw Error("Illegal Argument");m=c.defaultUndefined(m[2],null);if(null===m)return y.rotate(a,b);if(m instanceof d)return y.rotate(a,b,m);throw Error("Illegal Argument");})};D.centroid=function(a,m){return b(a,m,function(b,m,y){if(c.pcCheck(y,1,1),null===
y[0])return null;if(!(y[0]instanceof w))throw Error("Illegal Argument");return y[0]instanceof d?c.fixSpatialReference(q(y[0]),a.spatialReference):y[0]instanceof l?B?y[0].centroid:y[0].getCentroid():y[0]instanceof h?k.centroidPolyline(y[0]):y[0]instanceof r?k.centroidMultiPoint(y[0]):y[0]instanceof u?B?y[0].center:y[0].getExtent().getCenter():null})};D.multiparttosinglepart=function(m,k){return b(m,k,function(b,k,v){c.pcCheck(v,1,1);k=[];if(null===v[0])return null;if(!(v[0]instanceof w))throw Error("Illegal Argument");
if(v[0]instanceof d||v[0]instanceof u)return[c.fixSpatialReference(q(v[0]),m.spatialReference)];b=y.simplify(v[0]);if(b instanceof l){k=[];var t=[];for(v=0;v<b.rings.length;v++)if(b.isClockwise(b.rings[v])){var E=a.fromJSON({rings:[b.rings[v]],hasZ:b.hasZ,hasM:b.hasM,spatialReference:B?b.spatialReference.toJSON():b.spatialReference.toJson()});k.push(E)}else t.push({ring:b.rings[v],pt:b.getPoint(v,0)});for(b=0;b<t.length;b++)for(v=0;v<k.length;v++)if(k[v].contains(t[b].pt)){k[v].addRing(t[b].ring);
break}return k}if(b instanceof h){k=[];for(v=0;v<b.paths.length;v++)t=a.fromJSON({paths:[b.paths[v]],hasZ:b.hasZ,hasM:b.hasM,spatialReference:B?b.spatialReference.toJSON():b.spatialReference.toJson()}),k.push(t);return k}if(v[0]instanceof r){b=c.fixSpatialReference(q(v[0]),m.spatialReference);for(v=0;v<b.points.length;v++)k.push(b.getPoint(v));return k}return null})};D.issimple=function(a,m){return b(a,m,function(a,b,m){if(c.pcCheck(m,1,1),null===m[0])return!0;if(m[0]instanceof w)return y.isSimple(m[0]);
throw Error("Illegal Argument");})};D.simplify=function(a,m){return b(a,m,function(a,b,m){if(c.pcCheck(m,1,1),null===m[0])return null;if(m[0]instanceof w)return y.simplify(m[0]);throw Error("Illegal Argument");})}}})},"esri/arcade/functions/centroid":function(){define(["require","exports","../../geometry/Point","../../kernel"],function(A,p,w,l){function h(h,a,k){var c={x:0,y:0};a&&(c.z=0);k&&(c.m=0);for(var t=0,l=h[0],q=0;q<h.length;q++){var v=h[q],y;a:if(v.length!==l.length)y=!1;else{for(y=0;y<v.length;y++)if(v[y]!==
l[y]){y=!1;break a}y=!0}if(!1===y){y=d(l,v,a);var B=v,r=a,b=k,m={x:(l[0]+B[0])/2,y:(l[1]+B[1])/2},l=(r&&(m.z=(l[2]+B[2])/2),r&&b?m.m=(l[3]+B[3])/2:b&&(m.m=(l[2]+B[2])/2),m);l.x*=y;l.y*=y;c.x+=l.x;c.y+=l.y;a&&(l.z*=y,c.z+=l.z);k&&(l.m*=y,c.m+=l.m);t+=y;l=v}}return 0<t?(c.x/=t,c.y/=t,a&&(c.z/=t),k&&(c.m/=t)):(c.x=h[0][0],c.y=h[0][1],a&&(c.z=h[0][2]),k&&a?c.m=h[0][3]:k&&(c.m=h[0][2])),c}function d(d,a,k){var c=a[0]-d[0];d=a[1]-d[1];return k?(a=a[2]-a[2],Math.sqrt(c*c+d*d+a*a)):Math.sqrt(c*c+d*d)}Object.defineProperty(p,
"__esModule",{value:!0});var u=0===l.version.indexOf("4.");p.centroidPolyline=function(l){for(var a={x:0,y:0,spatialReference:u?l.spatialReference.toJSON():l.spatialReference.toJson()},k={x:0,y:0,spatialReference:u?l.spatialReference.toJSON():l.spatialReference.toJson()},c=0,t=0,r=0;r<l.paths.length;r++)if(0!==l.paths[r].length){var q;q=l.paths[r];var v=!0===l.hasZ;if(1>=q.length)q=0;else{for(var y=0,B=1;B<q.length;B++)y+=d(q[B-1],q[B],v);q=y}0===q?(v=h(l.paths[r],!0===l.hasZ,!0===l.hasM),a.x+=v.x,
a.y+=v.y,!0===l.hasZ&&(a.z+=v.z),!0===l.hasM&&(a.m+=v.m),++c):(v=h(l.paths[r],!0===l.hasZ,!0===l.hasM),k.x+=v.x*q,k.y+=v.y*q,!0===l.hasZ&&(k.z+=v.z*q),!0===l.hasM&&(k.m+=v.m*q),t+=q)}return 0<t?(k.x/=t,k.y/=t,!0===l.hasZ&&(k.z/=t),!0===l.hasM&&(k.m/=t),new w(k)):0<c?(a.x/=c,a.y/=c,!0===l.hasZ&&(k.z/=c),!0===l.hasM&&(a.m/=c),new w(a)):null};p.centroidMultiPoint=function(d){if(0===d.points.length)return null;for(var a=0,k=0,c=0,h=0,l=0;l<d.points.length;l++){var q=d.getPoint(l);!0===q.hasZ&&(c+=q.z);
!0===q.hasM&&(h+=q.m);a+=q.x;k+=q.y;h+=q.m}a={x:a/d.points.length,y:k/d.points.length,spatialReference:null};return a.spatialReference=u?d.spatialReference.toJSON():d.spatialReference.toJson(),!0===d.hasZ&&(a.z=c/d.points.length),!0===d.hasM&&(a.m=h/d.points.length),new w(a)}})},"esri/arcade/kernel":function(){define(["require","exports","../geometry/Extent"],function(A,p,w){Object.defineProperty(p,"__esModule",{value:!0});p.errback=function(l){return function(h){l.reject(h)}};p.callback=function(l,
h){return function(){try{l.apply(null,arguments)}catch(d){h.reject(d)}}};p.convertSquareUnitsToCode=function(l){if(void 0===l)return null;if("number"==typeof l)return l;switch(l.toLowerCase()){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":case "square-meter":case "square_meters":return 109404;case "miles":case "mile":case "squaremile":case "squaremiles":case "square-miles":case "square-mile":return 109413;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "square-kilometers":case "square-kilometer":case "km":return 109414;
case "acres":case "acre":case "ac":return 109402;case "hectares":case "hectare":case "ha":return 109401;case "yard":case "yd":case "yards":case "square-yards":case "square-yard":case "squareyards":case "squareyard":return 109442;case "feet":case "ft":case "foot":case "square-feet":case "square-foot":case "squarefeet":case "squarefoot":return 109405}return null};p.shapeExtent=function(l){if(null===l)return null;switch(l.type){case "polygon":case "multipoint":case "polyline":return l.extent;case "point":return new w({xmin:l.x,
ymin:l.y,xmax:l.x,ymax:l.y,spatialReference:l.spatialReference});case "extent":return l}return null};p.convertLinearUnitsToCode=function(l){if(void 0===l)return null;if("number"==typeof l||"number"==typeof l)return l;switch(l.toLowerCase()){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":case "square-meter":case "square-meters":return 9001;case "miles":case "mile":case "squaremile":case "squaremiles":case "square-miles":case "square-mile":return 9035;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "square-kilometers":case "square-kilometer":case "km":return 9036;
case "yard":case "yd":case "yards":case "square-yards":case "square-yard":case "squareyards":case "squareyard":return 9096;case "feet":case "ft":case "foot":case "square-feet":case "square-foot":case "squarefeet":case "squarefoot":return 9002}return null};p.sameGeomType=function(l,h){return l===h?!0:"point"===l&&"esriGeometryPoint"===h?!0:"polyline"===l&&"esriGeometryPolyline"===h?!0:"polygon"===l&&"esriGeometryPolygon"===h?!0:"extent"===l&&"esriGeometryEnvelope"===h?!0:"multipoint"===l&&"esriGeometryMultipoint"===
h?!0:"point"===h&&"esriGeometryPoint"===l?!0:"polyline"===h&&"esriGeometryPolyline"===l?!0:"polygon"===h&&"esriGeometryPolygon"===l?!0:"extent"===h&&"esriGeometryEnvelope"===l?!0:"multipoint"===h&&"esriGeometryMultipoint"===l?!0:!1}})},"esri/arcade/functions/stats":function(){define(["require","exports","../languageUtils","./fieldStats"],function(A,p,w,l){function h(d,h,r,a){if(1===a.length){if(w.isArray(a[0]))return l.calculateStat(d,a[0],-1);if(w.isImmutableArray(a[0]))return l.calculateStat(d,
a[0].toArray(),-1)}return l.calculateStat(d,a,-1)}Object.defineProperty(p,"__esModule",{value:!0});p.registerFunctions=function(d,l){d.stdev=function(d,a){return l(d,a,function(a,c,d){return h("stdev",a,c,d)})};d.variance=function(d,a){return l(d,a,function(a,c,d){return h("variance",a,c,d)})};d.average=function(d,a){return l(d,a,function(a,c,d){return h("mean",a,c,d)})};d.mean=function(d,a){return l(d,a,function(a,c,d){return h("mean",a,c,d)})};d.sum=function(d,a){return l(d,a,function(a,c,d){return h("sum",
a,c,d)})};d.min=function(d,a){return l(d,a,function(a,c,d){return h("min",a,c,d)})};d.max=function(d,a){return l(d,a,function(a,c,d){return h("max",a,c,d)})};d.distinct=function(d,a){return l(d,a,function(a,c,d){return h("distinct",a,c,d)})};d.count=function(d,a){return l(d,a,function(a,c,d){if(w.pcCheck(d,1,1),w.isArray(d[0])||w.isString(d[0]))return d[0].length;if(w.isImmutableArray(d[0]))return d[0].length();throw Error("Invalid Parameters for Count");})}}})},"esri/arcade/functions/fieldStats":function(){define(["require",
"exports","../languageUtils"],function(A,p,w){function l(d){for(var h=0,l=0;l<d.length;l++)h+=d[l];return h/d.length}function h(d){for(var h=l(d),r=0,a=0;a<d.length;a++)r+=Math.pow(h-d[a],2);return r/d.length}Object.defineProperty(p,"__esModule",{value:!0});p.decodeStatType=function(d){switch(d.toLowerCase()){case "distinct":return"distinct";case "avg":case "mean":return"avg";case "min":return"min";case "sum":return"sum";case "max":return"max";case "stdev":case "stddev":return"stddev";case "var":case "variance":return"var";
case "count":return"count"}return""};p.calculateStat=function(d,u,r){switch(void 0===r&&(r=1E3),d.toLowerCase()){case "distinct":a:{d=r;r=[];for(var a={},k=[],c=0;c<u.length;c++){if(void 0!==u[c]&&null!==u[c]&&u[c]!==w.voidOperation){var t=u[c];if(w.isNumber(t)||w.isString(t))void 0===a[t]&&(r.push(t),a[t]=1);else{for(var C=!1,q=0;q<k.length;q++)!0===w.equalityTest(k[q],t)&&(C=!0);!1===C&&(k.push(t),r.push(t))}}if(r.length>=d&&-1!==d){u=r;break a}}u=r}return u;case "avg":case "mean":return l(w.toNumberArray(u));
case "min":return Math.min.apply(Math,w.toNumberArray(u));case "sum":u=w.toNumberArray(u);for(r=d=0;r<u.length;r++)d+=u[r];return d;case "max":return Math.max.apply(Math,w.toNumberArray(u));case "stdev":case "stddev":return Math.sqrt(h(w.toNumberArray(u)));case "var":case "variance":return h(w.toNumberArray(u));case "count":return u.length}return 0}})},"esri/arcade/parser":function(){define(["require","exports","./treeAnalysis","./lib/esprima"],function(A,p,w,l){Object.defineProperty(p,"__esModule",
{value:!0});p.parseScript=function(h){h=l.parse("function _() { "+h+"\n}");if(null===h.body||void 0===h.body)throw Error("No formula provided.");if(0===h.body.length)throw Error("No formula provided.");if(0===h.body.length)throw Error("No formula provided.");if("BlockStatement"!==h.body[0].body.type)throw Error("Invalid formula content.");var d=w.validateLanguage(h);if(""!==d)throw Error(d);return h};p.scriptCheck=function(h,d,u,r){var a=[];try{var k=l.parse("function _() { "+h+"\n}",{tolerant:!0,
loc:!0}),c=k.errors;if(0<c.length)for(var t=0;t<c.length;t++)a.push({line:c[t].lineNumber,character:c[t].column,reason:c[t].description});var C=w.checkScript(k,d,u,r);for(d=0;d<C.length;d++)a.push(C[d])}catch(q){try{"Unexpected token }"===q.description?(q.index=("function _() { "+h+"\n}").length-1,a.push({line:q.lineNumber,character:q.column,reason:"Unexpected end of script"})):a.push({line:q.lineNumber,character:q.column,reason:q.description})}catch(v){}}return a};p.extractFieldLiterals=function(h,
d){return void 0===d&&(d=!1),w.findFieldLiterals(h,d)};p.validateScript=function(h,d,l){return void 0===l&&(l="full"),w.validateScript(h,d,l)};p.referencesMember=function(h,d){return w.referencesMember(h,d)};p.referencesFunction=function(h,d){return w.referencesFunction(h,d)}})},"esri/arcade/lib/esprima":function(){!function(A,p){"function"==typeof define&&define.amd?define(["exports"],p):p("undefined"!=typeof exports?exports:A.esprima={})}(this,function(A){function p(e,f){if(!e)throw Error("ASSERT: "+
f);}function w(e){return 48<=e&&57>=e}function l(e){return 0<="0123456789abcdefABCDEF".indexOf(e)}function h(e){return 0<="01234567".indexOf(e)}function d(e){return 10===e||13===e||8232===e||8233===e}function u(e){return 36===e||95===e||65<=e&&90>=e||97<=e&&122>=e||92===e||128<=e&&bb.NonAsciiIdentifierStart.test(String.fromCharCode(e))}function r(e){return 36===e||95===e||65<=e&&90>=e||97<=e&&122>=e||48<=e&&57>=e||92===e||128<=e&&bb.NonAsciiIdentifierPart.test(String.fromCharCode(e))}function a(e){switch(e=
e.toLowerCase(),e.length){case 2:return"if"===e||"in"===e;case 3:return"var"===e||"for"===e;case 4:return"else"===e;case 5:return"break"===e;case 6:return"return"===e;case 8:return"function"===e.toLowerCase()||"continue"===e;default:return!1}}function k(e,f,n,g,x){var I;p("number"==typeof n,"Comment must have valid position");pa.lastCommentStart>=n||(pa.lastCommentStart=n,I={type:e,value:f},ca.range&&(I.range=[n,g]),ca.loc&&(I.loc=x),ca.comments.push(I),ca.attachComment&&(ca.leadingComments.push(I),
ca.trailingComments.push(I)))}function c(e){var f,n,g,x;f=T-e;for(n={start:{line:ra,column:T-ua-e}};Aa>T;)if(g=da.charCodeAt(T),++T,d(g))return ca.comments&&(x=da.slice(f+e,T-1),n.end={line:ra,column:T-ua-1},k("Line",x,f,T-1,n)),13===g&&10===da.charCodeAt(T)&&++T,++ra,void(ua=T);ca.comments&&(x=da.slice(f+e,T),n.end={line:ra,column:T-ua},k("Line",x,f,T,n))}function t(){var e,f;for(f=0===T;Aa>T;)if(e=da.charCodeAt(T),32===e||9===e||11===e||12===e||160===e||5760<=e&&0<=[5760,6158,8192,8193,8194,8195,
8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e))++T;else if(d(e))++T,13===e&&10===da.charCodeAt(T)&&++T,++ra,ua=T,f=!0;else if(47===e)if(e=da.charCodeAt(T+1),47===e)++T,++T,c(2),f=!0;else{if(42!==e)break;++T;++T;a:{var n=void 0,g=void 0,x=void 0,I=void 0;for(ca.comments&&(n=T-2,g={start:{line:ra,column:T-ua-2}});Aa>T;)if(x=da.charCodeAt(T),d(x))13===x&&10===da.charCodeAt(T+1)&&++T,++ra,++T,ua=T,T>=Aa&&z();else{if(42===x&&47===da.charCodeAt(T+1)){++T;++T;ca.comments&&(I=da.slice(n+
2,T-2),g.end={line:ra,column:T-ua},k("Block",I,n,T,g));break a}++T}z()}}else if(f&&45===e){if(45!==da.charCodeAt(T+1)||62!==da.charCodeAt(T+2))break;T+=3;c(3)}else{if(60!==e)break;if("!--"!==da.slice(T+1,T+4))break;++T;++T;++T;++T;c(4)}}function C(e){var f,n,g=0;f="u"===e?4:2;for(e=0;f>e;++e){if(!(Aa>T&&l(da[T])))return"";n=da[T++];g=16*g+"0123456789abcdef".indexOf(n.toLowerCase())}return String.fromCharCode(g)}function q(){var e,f;e=da.charCodeAt(T++);f=String.fromCharCode(e);for(92===e&&(117!==
da.charCodeAt(T)&&z(),++T,e=C("u"),e&&"\\"!==e&&u(e.charCodeAt(0))||z(),f=e);Aa>T&&(e=da.charCodeAt(T),r(e));)++T,f+=String.fromCharCode(e),92===e&&(f=f.substr(0,f.length-1),117!==da.charCodeAt(T)&&z(),++T,e=C("u"),e&&"\\"!==e&&r(e.charCodeAt(0))||z(),f+=e);return f}function v(){var e,f,n,g,x=T,I=da.charCodeAt(T),a=da[T];switch(I){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++T,ca.tokenize&&(40===I?ca.openParenToken=ca.tokens.length:123===
I&&(ca.openCurlyToken=ca.tokens.length)),{type:ha.Punctuator,value:String.fromCharCode(I),lineNumber:ra,lineStart:ua,start:x,end:T};default:if(e=da.charCodeAt(T+1),61===e)switch(I){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return T+=2,{type:ha.Punctuator,value:String.fromCharCode(I)+String.fromCharCode(e),lineNumber:ra,lineStart:ua,start:x,end:T};case 33:case 61:return T+=2,61===da.charCodeAt(T)&&++T,{type:ha.Punctuator,value:da.slice(x,T),lineNumber:ra,lineStart:ua,
start:x,end:T}}}return g=da.substr(T,4),"\x3e\x3e\x3e\x3d"===g?(T+=4,{type:ha.Punctuator,value:g,lineNumber:ra,lineStart:ua,start:x,end:T}):(n=g.substr(0,3),"\x3e\x3e\x3e"===n||"\x3c\x3c\x3d"===n||"\x3e\x3e\x3d"===n?(T+=3,{type:ha.Punctuator,value:n,lineNumber:ra,lineStart:ua,start:x,end:T}):(f=n.substr(0,2),a===f[1]&&0<="+-\x3c\x3e\x26|".indexOf(a)||"\x3d\x3e"===f?(T+=2,{type:ha.Punctuator,value:f,lineNumber:ra,lineStart:ua,start:x,end:T}):0<="\x3c\x3e\x3d!+-*%\x26|^/".indexOf(a)?(++T,{type:ha.Punctuator,
value:a,lineNumber:ra,lineStart:ua,start:x,end:T}):void z()))}function y(){var e,f,n;if(n=da[T],p(w(n.charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),f=T,e="","."!==n){if(e=da[T++],n=da[T],"0"===e){if("x"===n||"X"===n){++T;for(var g="";Aa>T&&l(da[T]);)g+=da[T++];return 0===g.length&&z(),u(da.charCodeAt(T))&&z(),{type:ha.NumericLiteral,value:parseInt("0x"+g,16),lineNumber:ra,lineStart:ua,start:f,end:T}}if("b"===n||"B"===n){++T;for(e="";Aa>T&&(g=da[T],"0"===
g||"1"===g);)e+=da[T++];return 0===e.length&&z(),Aa>T&&(g=da.charCodeAt(T),(u(g)||w(g))&&z()),{type:ha.NumericLiteral,value:parseInt(e,2),lineNumber:ra,lineStart:ua,start:f,end:T}}if("o"===n||"O"===n||h(n)){var x,I;for(h(n)?(I=!0,x="0"+da[T++]):(I=!1,++T,x="");Aa>T&&h(da[T]);)x+=da[T++];return I||0!==x.length||z(),(u(da.charCodeAt(T))||w(da.charCodeAt(T)))&&z(),{type:ha.NumericLiteral,value:parseInt(x,8),octal:I,lineNumber:ra,lineStart:ua,start:f,end:T}}n&&w(n.charCodeAt(0))&&z()}for(;w(da.charCodeAt(T));)e+=
da[T++];n=da[T]}if("."===n){for(e+=da[T++];w(da.charCodeAt(T));)e+=da[T++];n=da[T]}if("e"===n||"E"===n)if(e+=da[T++],n=da[T],("+"===n||"-"===n)&&(e+=da[T++]),w(da.charCodeAt(T)))for(;w(da.charCodeAt(T));)e+=da[T++];else z();return u(da.charCodeAt(T))&&z(),{type:ha.NumericLiteral,value:parseFloat(e),lineNumber:ra,lineStart:ua,start:f,end:T}}function B(){ma=null;t();Q("Regular Expression language structures not supported")}function D(){t();B()}function b(){var e,f;if(e=ca.tokens[ca.tokens.length-1],
!e)return D();if("Punctuator"===e.type){if("]"===e.value)return v();if(")"===e.value)return f=ca.tokens[ca.openParenToken-1],!f||"Keyword"!==f.type||"if"!==f.value.toLowerCase()&&"while"!==f.value.toLowerCase()&&"for"!==f.value.toLowerCase()&&"with"!==f.value.toLowerCase()?v():D();if("}"===e.value){if(ca.tokens[ca.openCurlyToken-3]&&"Keyword"===ca.tokens[ca.openCurlyToken-3].type){if(f=ca.tokens[ca.openCurlyToken-4],!f)return v()}else{if(!ca.tokens[ca.openCurlyToken-4]||"Keyword"!==ca.tokens[ca.openCurlyToken-
4].type)return v();if(f=ca.tokens[ca.openCurlyToken-5],!f)return D()}return 0<=Ma.indexOf(f.value)?v():D()}return D()}return"Keyword"===e.type&&"this"!==e.value?D():v()}function m(){var e;t();var f;if(T>=Aa)f={type:ha.EOF,lineNumber:ra,lineStart:ua,start:T,end:T};else if(e=da.charCodeAt(T),u(e)){var n,g;f=T;var x;if(92===da.charCodeAt(T))x=q();else a:{var I;for(x=T++;Aa>T;){if(I=da.charCodeAt(T),92===I){x=(T=x,q());break a}if(!r(I))break;++T}x=da.slice(x,T)}f=(n=x,g=1===n.length?ha.Identifier:a(n)?
ha.Keyword:"null"===n.toLowerCase()?ha.NullLiteral:"true"===n.toLowerCase()||"false"===n.toLowerCase()?ha.BooleanLiteral:ha.Identifier,{type:g,value:n,lineNumber:ra,lineStart:ua,start:f,end:T})}else if(40===e||41===e||59===e)f=v();else if(39===e||34===e){var L,m,c="",P=!1;I=ra;e=ua;n=da[T];p("'"===n||'"'===n,"String literal must starts with a quote");g=T;for(++T;Aa>T;){if(f=da[T++],f===n){n="";break}if("\\"===f)if(f=da[T++],f&&d(f.charCodeAt(0)))++ra,"\r"===f&&"\n"===da[T]&&++T,ua=T;else switch(f){case "u":case "x":if("{"===
da[T]){++T;L=c;var Y,k=Y=void 0,c=m=void 0;Y=da[T];k=0;for("}"===Y&&z();Aa>T&&(Y=da[T++],l(Y));)k=16*k+"0123456789abcdef".indexOf(Y.toLowerCase());Y=((1114111<k||"}"!==Y)&&z(),65535>=k?String.fromCharCode(k):(m=(k-65536>>10)+55296,c=(k-65536&1023)+56320,String.fromCharCode(m,c)));c=L+Y}else m=T,(L=C(f))?c+=L:(T=m,c+=f);break;case "n":c+="\n";break;case "r":c+="\r";break;case "t":c+="\t";break;case "b":c+="\b";break;case "f":c+="\f";break;case "v":c+="\x0B";break;default:h(f)?(x="01234567".indexOf(f),
0!==x&&(P=!0),Aa>T&&h(da[T])&&(P=!0,x=8*x+"01234567".indexOf(da[T++]),0<="0123".indexOf(f)&&Aa>T&&h(da[T])&&(x=8*x+"01234567".indexOf(da[T++]))),c+=String.fromCharCode(x)):c+=f}else{if(d(f.charCodeAt(0)))break;c+=f}}f=(""!==n&&z(),{type:ha.StringLiteral,value:c,octal:P,startLineNumber:I,startLineStart:e,lineNumber:ra,lineStart:ua,start:g,end:T})}else f=46===e?w(da.charCodeAt(T+1))?y():v():w(e)?y():ca.tokenize&&47===e?b():v();return f}function E(){var e,f,n,g;return t(),e={start:{line:ra,column:T-
ua}},f=m(),e.end={line:ra,column:T-ua},f.type!==ha.EOF&&(n=da.slice(f.start,f.end),g={type:Ua[f.type],value:n,range:[f.start,f.end],loc:e},f.regex&&(g.regex={pattern:f.regex.pattern,flags:f.regex.flags}),ca.tokens.push(g)),f}function J(){var e;return e=ma,T=e.end,ra=e.lineNumber,ua=e.lineStart,ma="undefined"!=typeof ca.tokens?E():m(),T=e.end,ra=e.lineNumber,ua=e.lineStart,e}function G(){var e,f,n;e=T;f=ra;n=ua;ma="undefined"!=typeof ca.tokens?E():m();T=e;ra=f;ua=n}function K(){this.line=ra;this.column=
T-ua}function M(){this.start=new K;this.end=null}function U(e){e.type===ha.StringLiteral?this.start={line:e.startLineNumber,column:e.start-e.startLineStart}:this.start={line:e.lineNumber,column:e.start-e.lineStart};this.end=null}function N(){T=ma.start;ma.type===ha.StringLiteral?(ra=ma.startLineNumber,ua=ma.startLineStart):(ra=ma.lineNumber,ua=ma.lineStart);ca.range&&(this.range=[T,0]);ca.loc&&(this.loc=new M)}function W(e){ca.range&&(this.range=[e.start,0]);ca.loc&&(this.loc=new U(e))}function R(){var e,
f,n,g;return e=T,f=ra,n=ua,t(),g=ra!==f,T=e,ra=f,ua=n,g}function V(e,f,n){var g=Error("Line "+e+": "+n);return g.index=f,g.lineNumber=e,g.column=f-ua+1,g.description=n,g}function Q(e){var f,n;throw f=Array.prototype.slice.call(arguments,1),n=e.replace(/%(\d)/g,function(e,n){return p(n<f.length,"Message reference must be in range"),f[n]}),V(ra,T,n);}function S(e){var f,n,g;if(f=Array.prototype.slice.call(arguments,1),n=e.replace(/%(\d)/g,function(e,n){return p(n<f.length,"Message reference must be in range"),
f[n]}),g=V(ra,T,n),!ca.errors)throw g;ca.errors.push(g)}function X(e,f){var n=va.UnexpectedToken;e&&(n=f?f:e.type===ha.EOF?va.UnexpectedEOS:e.type===ha.Identifier?va.UnexpectedIdentifier:e.type===ha.NumericLiteral?va.UnexpectedNumber:e.type===ha.StringLiteral?va.UnexpectedString:va.UnexpectedToken);return n=n.replace("%0",e?e.value:"ILLEGAL"),e&&"number"==typeof e.lineNumber?V(e.lineNumber,e.start,n):V(ra,T,n)}function z(e,f){throw X(e,f);}function Z(e,f){e=X(e,f);if(!ca.errors)throw e;ca.errors.push(e)}
function O(e){var f=J();f.type===ha.Punctuator&&f.value===e||z(f)}function g(){var e;ca.errors?(e=ma,e.type===ha.Punctuator&&","===e.value?J():e.type===ha.Punctuator&&";"===e.value?(J(),Z(e)):Z(e,va.UnexpectedToken)):O(",")}function e(e){var f=J();f.type===ha.Keyword&&f.value.toLowerCase()===e.toLowerCase()||z(f)}function f(e){return ma.type===ha.Punctuator&&ma.value===e}function n(e){return ma.type===ha.Keyword&&ma.value.toLowerCase()===e.toLowerCase()}function x(){var e;return 59===da.charCodeAt(T)||
f(";")?void J():(e=ra,t(),void(ra===e&&(ma.type===ha.EOF||f("}")||z(ma))))}function I(e){return e.type===qa.Identifier||e.type===qa.MemberExpression}function L(e,f){var n,g;f=new N;return n=Ba,g=Pa(),Ba=n,f.finishFunctionExpression(null,e,[],g)}function P(){var e,f,n;return e=Ba,Ba=!0,f=Na(),n=L(f.params),Ba=e,n}function Y(){var e,f=new N;return e=J(),e.type===ha.StringLiteral||e.type===ha.NumericLiteral?(Ba&&e.octal&&Z(e,va.StrictOctalLiteral),f.finishLiteral(e)):f.finishIdentifier(e.value)}function fa(){var e,
n,g,x,I,a=new N;if(e=ma,e.type===ha.Identifier)return g=Y(),"get"!==e.value||f(":")||f("(")?"set"!==e.value||f(":")||f("(")?f(":")?(J(),x=za(),a.finishProperty("init",g,x,!1,!1)):f("(")?(x=P(),a.finishProperty("init",g,x,!0,!1)):(x=g,a.finishProperty("init",g,x,!1,!0)):(n=Y(),O("("),e=ma,e.type!==ha.Identifier?(O(")"),Z(e),x=L([])):(I=[F()],O(")"),x=L(I,e)),a.finishProperty("set",n,x,!1,!1)):(n=Y(),O("("),O(")"),x=L([]),a.finishProperty("get",n,x,!1,!1));if(e.type===ha.EOF||e.type===ha.Punctuator)z(e);
else{if(n=Y(),f(":"))return J(),x=za(),a.finishProperty("init",n,x,!1,!1);if(f("("))return x=P(),a.finishProperty("init",n,x,!0,!1);z(J())}}function ga(e){var n,x,I=[],a={},z=String,b=new N;for(!0!==e&&O("{");!f("}");)e=fa(),n=e.key.type===qa.Identifier?e.key.name:z(e.key.value),x="init"===e.kind?Va.Data:"get"===e.kind?Va.Get:Va.Set,n="$"+n,Object.prototype.hasOwnProperty.call(a,n)?(a[n]===Va.Data?Ba&&x===Va.Data?S(va.StrictDuplicateProperty):x!==Va.Data&&S(va.AccessorDataProperty):x===Va.Data?S(va.AccessorDataProperty):
a[n]&x&&S(va.AccessorGetSet),a[n]|=x):a[n]=x,I.push(e),f("}")||g();return O("}"),b.finishObjectExpression(I)}function ia(){var g,x,I,a;if(f("("))return O("("),f(")")?(J(),db.ArrowParameterPlaceHolder):(++pa.parenthesisCount,a=oa(),O(")"),a);if(f("[")){var b=[],L=new N;for(O("[");!f("]");)f(",")?(J(),b.push(null)):(b.push(za()),f("]")||O(","));return J(),L.finishArrayExpression(b)}if(f("{"))return ga();if(g=ma.type,a=new N,g===ha.Identifier)I=a.finishIdentifier(J().value);else if(g===ha.StringLiteral||
g===ha.NumericLiteral)Ba&&ma.octal&&Z(ma,va.StrictOctalLiteral),I=a.finishLiteral(J());else if(g===ha.Keyword){if(n("function")){var m,c,P,d;g=null;x=[];I=[];a=new N;return e("function"),f("(")||(g=F()),c=Na(L),x=c.params,I=c.defaults,b=c.stricted,L=c.firstRestricted,c.message&&(m=c.message),d=Ba,P=Pa(),Ba&&L&&z(L,m),Ba&&b&&Z(b,m),Ba=d,a.finishFunctionExpression(g,x,I,P)}n("this")?(J(),I=a.finishThisExpression()):z(J())}else g===ha.BooleanLiteral?(x=J(),x.value="true"===x.value.toLowerCase(),I=a.finishLiteral(x)):
g===ha.NullLiteral?(x=J(),x.value=null,I=a.finishLiteral(x)):f("/")||f("/\x3d")?(I="undefined"!=typeof ca.tokens?a.finishLiteral(D()):a.finishLiteral(B()),G()):z(J());return I}function na(){var e=[];if(O("("),!f(")"))for(;Aa>T&&(e.push(za()),!f(")"));)g();return O(")"),e}function ka(){var e,f=new N;return e=J(),e.type===ha.Identifier||e.type===ha.Keyword||e.type===ha.BooleanLiteral||e.type===ha.NullLiteral||z(e),f.finishIdentifier(e.value)}function wa(){var e;return O("["),e=oa(),O("]"),e}function ta(){var g,
x,I=new N;e("new");var a,z,b;p(pa.allowIn,"callee of new expression always allow in keyword.");b=ma;for(a=n("new")?ta():ia();;)if(f("["))z=wa(),a=(new W(b)).finishMemberExpression("[",a,z);else{if(!f("."))break;z=(O("."),ka());a=(new W(b)).finishMemberExpression(".",a,z)}return g=a,x=f("(")?na():[],I.finishNewExpression(g,x)}function sa(){var e,g,x=ma,a,z,b,L=pa.allowIn;b=ma;pa.allowIn=!0;for(a=n("new")?ta():ia();;)if(f("."))z=(O("."),ka()),a=(new W(b)).finishMemberExpression(".",a,z);else if(f("("))z=
na(),a=(new W(b)).finishCallExpression(a,z);else{if(!f("["))break;z=wa();a=(new W(b)).finishMemberExpression("[",a,z)}return e=(pa.allowIn=L,a),ma.type===ha.Punctuator&&(!f("++")&&!f("--")||R()||(I(e)||S(va.InvalidLHSInAssignment),g=J(),e=(new W(x)).finishPostfixExpression(g.value,e))),e}function aa(){var e,g,x;return ma.type!==ha.Punctuator&&ma.type!==ha.Keyword?g=sa():f("++")||f("--")?(x=ma,e=J(),g=aa(),I(g)||S(va.InvalidLHSInAssignment),g=(new W(x)).finishUnaryExpression(e.value,g)):f("+")||f("-")||
f("~")||f("!")?(x=ma,e=J(),g=aa(),g=(new W(x)).finishUnaryExpression(e.value,g)):n("delete")||n("void")||n("typeof")?(x=ma,e=J(),g=aa(),g=(new W(x)).finishUnaryExpression(e.value,g),Ba&&"delete"===g.operator&&g.argument.type===qa.Identifier&&S(va.StrictDelete)):g=sa(),g}function ya(e,f){var n=0;if(e.type!==ha.Punctuator&&e.type!==ha.Keyword)return 0;switch(e.value){case "||":n=1;break;case "\x26\x26":n=2;break;case "|":n=3;break;case "^":n=4;break;case "\x26":n=5;break;case "\x3d\x3d":case "!\x3d":case "\x3d\x3d\x3d":case "!\x3d\x3d":n=
6;break;case "\x3c":case "\x3e":case "\x3c\x3d":case "\x3e\x3d":case "instanceof":n=7;break;case "in":n=f?7:0;break;case "\x3c\x3c":case "\x3e\x3e":case "\x3e\x3e\x3e":n=8;break;case "+":case "-":n=9;break;case "*":case "/":case "%":n=11}return n}function la(e){var f,n,g,x,I,a,b,L;x=[];I=[];a=0;b={paramSet:{}};f=0;for(n=e.length;n>f;f+=1)if(g=e[f],g.type===qa.Identifier)x.push(g),I.push(null),Fa(b,g,g.name);else{if(g.type!==qa.AssignmentExpression)return null;x.push(g.left);I.push(g.right);++a;Fa(b,
g.left,g.left.name)}return b.message===va.StrictParamDupe&&(L=Ba?b.stricted:b.firstRestricted,z(L,b.message)),0===a&&(I=[]),{params:x,defaults:I,rest:null,stricted:b.stricted,firstRestricted:b.firstRestricted,message:b.message}}function za(){var e,n,g,x,a,b;e=pa.parenthesisCount;n=b=ma;var L,m,c,P;g=ma;var d;var Y,k,q,h,y;if((d=ma,Y=aa(),Y!==db.ArrowParameterPlaceHolder)&&(k=ma,q=ya(k,pa.allowIn),0!==q)){k.prec=q;J();d=[d,ma];y=aa();for(h=[Y,k,y];0<(q=ya(ma,pa.allowIn));){for(;2<h.length&&q<=h[h.length-
2].prec;)y=h.pop(),k=h.pop().value,Y=h.pop(),d.pop(),Y=(new W(d[d.length-1])).finishBinaryExpression(k,Y,y),h.push(Y);k=J();k.prec=q;h.push(k);d.push(ma);Y=aa();h.push(Y)}q=h.length-1;Y=h[q];for(d.pop();1<q;)Y=(new W(d.pop())).finishBinaryExpression(h[q-1].value,h[q-2],Y),q-=2}d=Y;g=(L=d,L===db.ArrowParameterPlaceHolder?L:(f("?")&&(J(),m=pa.allowIn,pa.allowIn=!0,c=za(),pa.allowIn=m,O(":"),P=za(),L=(new W(g)).finishConditionalExpression(L,c,P)),L));if(g!==db.ArrowParameterPlaceHolder&&!f("\x3d\x3e")||
pa.parenthesisCount!==e&&pa.parenthesisCount!==e+1||(g.type===qa.Identifier?a=la([g]):g.type===qa.AssignmentExpression?a=la([g]):g.type===qa.SequenceExpression?a=la(g.expressions):g===db.ArrowParameterPlaceHolder&&(a=la([])),!a)){var v;b=((ma.type!==ha.Punctuator?!1:(v=ma.value,"\x3d"===v||"*\x3d"===v||"/\x3d"===v||"%\x3d"===v||"+\x3d"===v||"-\x3d"===v||"\x3c\x3c\x3d"===v||"\x3e\x3e\x3d"===v||"\x3e\x3e\x3e\x3d"===v||"\x26\x3d"===v||"^\x3d"===v||"|\x3d"===v))&&(I(g)||S(va.InvalidLHSInAssignment),n=
J(),x=za(),g=(new W(b)).finishAssignmentExpression(n.value,g,x)),g)}else{n=a;x=new W(b);var l,t;b=(O("\x3d\x3e"),l=Ba,t=f("{")?Pa():za(),Ba&&n.firstRestricted&&z(n.firstRestricted,n.message),Ba&&n.stricted&&Z(n.stricted,n.message),Ba=l,x.finishArrowFunctionExpression(n.params,n.defaults,t,t.type!==qa.BlockStatement))}return b}function oa(){var e,n=ma;if(e=za(),f(",")){for(e=[e];Aa>T&&f(",");)J(),e.push(za());e=(new W(n)).finishSequenceExpression(e)}return e}function F(){var e,f=new N;return e=J(),
e.type!==ha.Identifier&&z(e),f.finishIdentifier(e.value)}function Ia(e){var n,g=null,x=new N;return n=F(),"const"===e?(O("\x3d"),g=za()):f("\x3d")&&(J(),g=za()),x.finishVariableDeclarator(n,g)}function Ea(e){var n=[];do{if(n.push(Ia(e)),!f(","))break;J()}while(Aa>T);return n}function Qa(g){var a,b,L,m,c=ma.type;if(c===ha.EOF&&z(ma),c===ha.Punctuator&&"{"===ma.value){if(g){O("{");var P,d,Y,k,q;P=ma;P=(d=T,Y=ra,k=ua,J(),q=f(":"),ma=P,T=d,ra=Y,ua=k,q);if(ma.type!==ha.Identifier&&ma.type!==ha.StringLiteral||
!P){P=new N;for(var h=[];Aa>T&&!f("}")&&(m=La(),"undefined"!=typeof m);)h.push(m);P=(O("}"),P.finishBlockStatement(h))}else P=ga(!0);return P}return ga()}if(m=new N,c===ha.Punctuator)switch(ma.value){case ";":return P=new N,O(";"),P.finishEmptyStatement();case "(":return P=oa(),x(),m.finishExpressionStatement(P)}else if(c===ha.Keyword)switch(ma.value.toLowerCase()){case "break":var y;P=null;return e("break"),59===da.charCodeAt(T)?(J(),pa.inIteration||pa.inSwitch||Q(va.IllegalBreak),m.finishBreakStatement(null)):
R()?(pa.inIteration||pa.inSwitch||Q(va.IllegalBreak),m.finishBreakStatement(null)):(ma.type===ha.Identifier&&(P=F(),y="$"+P.name,Object.prototype.hasOwnProperty.call(pa.labelSet,y)||Q(va.UnknownLabel,P.name)),x(),null!==P||pa.inIteration||pa.inSwitch||Q(va.IllegalBreak),m.finishBreakStatement(P));case "continue":var v;P=null;return e("continue"),59===da.charCodeAt(T)?(J(),pa.inIteration||Q(va.IllegalContinue),m.finishContinueStatement(null)):R()?(pa.inIteration||Q(va.IllegalContinue),m.finishContinueStatement(null)):
(ma.type===ha.Identifier&&(P=F(),v="$"+P.name,Object.prototype.hasOwnProperty.call(pa.labelSet,v)||Q(va.UnknownLabel,P.name)),x(),null!==P||pa.inIteration||Q(va.IllegalContinue),m.finishContinueStatement(P));case "for":var l,t;k=pa.allowIn;q=d=Y=null;e("for");O("(");if(f(";"))J();else{if(n("var")){pa.allowIn=!1;var B,E;q=new N;q=(B=J(),E=Ea(),q.finishVariableDeclaration(E,B.value));pa.allowIn=k;1===q.declarations.length&&n("in")&&(J(),P=q,h=oa(),q=null)}else pa.allowIn=!1,q=oa(),pa.allowIn=k,n("in")&&
(I(q)||S(va.InvalidLHSInForIn),J(),P=q,h=oa(),q=null);"undefined"==typeof P&&O(";")}return"undefined"==typeof P&&(f(";")||(d=oa()),O(";"),f(")")||(Y=oa())),O(")"),t=pa.inIteration,pa.inIteration=!0,l=Qa(!0),pa.inIteration=t,"undefined"==typeof P?m.finishForStatement(q,d,Y,l):m.finishForInStatement(P,h,l);case "function":return Ga(m);case "if":var D,r,C;return e("if"),O("("),D=oa(),O(")"),r=Qa(!0),n("else")?(J(),C=Qa(!0)):C=null,m.finishIfStatement(D,r,C);case "return":return P=null,e("return"),pa.inFunctionBody||
S(va.IllegalReturn),32===da.charCodeAt(T)&&u(da.charCodeAt(T+1))?(P=oa(),x(),m.finishReturnStatement(P)):R()?m.finishReturnStatement(null):(f(";")||f("}")||ma.type===ha.EOF||(P=oa()),x(),m.finishReturnStatement(P));case "var":var fa;return e("var"),fa=Ea(),x(),m.finishVariableDeclaration(fa,"var")}return a=oa(),a.type===qa.Identifier&&f(":")?(J(),L="$"+a.name,Object.prototype.hasOwnProperty.call(pa.labelSet,L)&&Q(va.Redeclaration,"Label",a.name),pa.labelSet[L]=!0,b=Qa(!1),delete pa.labelSet[L],m.finishLabeledStatement(a,
b)):(x(),m.finishExpressionStatement(a))}function Pa(){var e,n,g,x,I,a,z=[],b=new N;for(O("{");Aa>T&&ma.type===ha.StringLiteral&&(n=ma,e=La(),z.push(e),e.expression.type===qa.Literal);)g=da.slice(n.start+1,n.end-1),"use strict"===g?(Ba=!0,x&&Z(x,va.StrictOctalLiteral)):!x&&n.octal&&(x=n);n=pa.labelSet;g=pa.inIteration;x=pa.inSwitch;I=pa.inFunctionBody;a=pa.parenthesizedCount;pa.labelSet={};pa.inIteration=!1;pa.inSwitch=!1;pa.inFunctionBody=!0;for(pa.parenthesizedCount=0;Aa>T&&!f("}")&&(e=La(),"undefined"!=
typeof e);)z.push(e);return O("}"),pa.labelSet=n,pa.inIteration=g,pa.inSwitch=x,pa.inFunctionBody=I,pa.parenthesizedCount=a,b.finishBlockStatement(z)}function Fa(e,f,n){n="$"+n;Ba?Object.prototype.hasOwnProperty.call(e.paramSet,n)&&(e.stricted=f,e.message=va.StrictParamDupe):e.firstRestricted||Object.prototype.hasOwnProperty.call(e.paramSet,n)&&(e.firstRestricted=f,e.message=va.StrictParamDupe);e.paramSet[n]=!0}function ea(e){var n,g,x;return n=ma,g=F(),Fa(e,n,n.value),f("\x3d")&&(J(),x=za(),++e.defaultCount),
e.params.push(g),e.defaults.push(x),!f(")")}function Na(e){if(e={params:[],defaultCount:0,defaults:[],firstRestricted:e},O("("),!f(")"))for(e.paramSet={};Aa>T&&ea(e);)O(",");return O(")"),0===e.defaultCount&&(e.defaults=[]),{params:e.params,defaults:e.defaults,stricted:e.stricted,firstRestricted:e.firstRestricted,message:e.message}}function Ga(){var f,n,g,x,I,a,b,L=[],m=[],c=new N;return e("function"),f=F(),x=Na(I),L=x.params,m=x.defaults,g=x.stricted,I=x.firstRestricted,x.message&&(a=x.message),
b=Ba,n=Pa(),Ba&&I&&z(I,a),Ba&&g&&Z(g,a),Ba=b,c.finishFunctionDeclaration(f,L,m,n)}function La(){return ma.type===ha.Keyword?"function"===ma.value.toLowerCase()?Ga():Qa(!1):ma.type!==ha.EOF?Qa(!1):void 0}function ib(){var e,f,n,g=[];for(e=0;e<ca.tokens.length;++e)f=ca.tokens[e],n={type:f.type,value:f.value},f.regex&&(n.regex={pattern:f.regex.pattern,flags:f.regex.flags}),ca.range&&(n.range=f.range),ca.loc&&(n.loc=f.loc),g.push(n);ca.tokens=g}var ha,Ua,Ma,qa,db,Va,va,bb,da,Ba,T,ra,ua,Aa,ma,pa,ca;ha=
{BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9};Ua={};Ua[ha.BooleanLiteral]="Boolean";Ua[ha.EOF]="\x3cend\x3e";Ua[ha.Identifier]="Identifier";Ua[ha.Keyword]="Keyword";Ua[ha.NullLiteral]="Null";Ua[ha.NumericLiteral]="Numeric";Ua[ha.Punctuator]="Punctuator";Ua[ha.StringLiteral]="String";Ua[ha.RegularExpression]="RegularExpression";Ma="( { [ in typeof instanceof new return case delete throw void \x3d +\x3d -\x3d *\x3d /\x3d %\x3d \x3c\x3c\x3d \x3e\x3e\x3d \x3e\x3e\x3e\x3d \x26\x3d |\x3d ^\x3d , + - * / % ++ -- \x3c\x3c \x3e\x3e \x3e\x3e\x3e \x26 | ^ ! ~ \x26\x26 || ? : \x3d\x3d\x3d \x3d\x3d \x3e\x3d \x3c\x3d \x3c \x3e !\x3d !\x3d\x3d".split(" ");
qa={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",
FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator"};db={ArrowParameterPlaceHolder:{type:"ArrowParameterPlaceHolder"}};
Va={Data:1,Get:2,Set:4};va={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",
MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",
StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",
AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"};bb={NonAsciiIdentifierStart:/[\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u037f\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u052f\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0-\u08b2\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f8\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191e\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua69d\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua7ad\ua7b0\ua7b1\ua7f7-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\ua9e0-\ua9e4\ua9e6-\ua9ef\ua9fa-\ua9fe\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa7e-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uab30-\uab5a\uab5c-\uab5f\uab64\uab65\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]/,
NonAsciiIdentifierPart:/[\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0300-\u0374\u0376\u0377\u037a-\u037d\u037f\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u0483-\u0487\u048a-\u052f\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u05d0-\u05ea\u05f0-\u05f2\u0610-\u061a\u0620-\u0669\u066e-\u06d3\u06d5-\u06dc\u06df-\u06e8\u06ea-\u06fc\u06ff\u0710-\u074a\u074d-\u07b1\u07c0-\u07f5\u07fa\u0800-\u082d\u0840-\u085b\u08a0-\u08b2\u08e4-\u0963\u0966-\u096f\u0971-\u0983\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bc-\u09c4\u09c7\u09c8\u09cb-\u09ce\u09d7\u09dc\u09dd\u09df-\u09e3\u09e6-\u09f1\u0a01-\u0a03\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a59-\u0a5c\u0a5e\u0a66-\u0a75\u0a81-\u0a83\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abc-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ad0\u0ae0-\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3c-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b5c\u0b5d\u0b5f-\u0b63\u0b66-\u0b6f\u0b71\u0b82\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd0\u0bd7\u0be6-\u0bef\u0c00-\u0c03\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c39\u0c3d-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c58\u0c59\u0c60-\u0c63\u0c66-\u0c6f\u0c81-\u0c83\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbc-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0cde\u0ce0-\u0ce3\u0ce6-\u0cef\u0cf1\u0cf2\u0d01-\u0d03\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d-\u0d44\u0d46-\u0d48\u0d4a-\u0d4e\u0d57\u0d60-\u0d63\u0d66-\u0d6f\u0d7a-\u0d7f\u0d82\u0d83\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0de6-\u0def\u0df2\u0df3\u0e01-\u0e3a\u0e40-\u0e4e\u0e50-\u0e59\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb9\u0ebb-\u0ebd\u0ec0-\u0ec4\u0ec6\u0ec8-\u0ecd\u0ed0-\u0ed9\u0edc-\u0edf\u0f00\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e-\u0f47\u0f49-\u0f6c\u0f71-\u0f84\u0f86-\u0f97\u0f99-\u0fbc\u0fc6\u1000-\u1049\u1050-\u109d\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u135d-\u135f\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f8\u1700-\u170c\u170e-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176c\u176e-\u1770\u1772\u1773\u1780-\u17d3\u17d7\u17dc\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u1820-\u1877\u1880-\u18aa\u18b0-\u18f5\u1900-\u191e\u1920-\u192b\u1930-\u193b\u1946-\u196d\u1970-\u1974\u1980-\u19ab\u19b0-\u19c9\u19d0-\u19d9\u1a00-\u1a1b\u1a20-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1aa7\u1ab0-\u1abd\u1b00-\u1b4b\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1bf3\u1c00-\u1c37\u1c40-\u1c49\u1c4d-\u1c7d\u1cd0-\u1cd2\u1cd4-\u1cf6\u1cf8\u1cf9\u1d00-\u1df5\u1dfc-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u200c\u200d\u203f\u2040\u2054\u2071\u207f\u2090-\u209c\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d7f-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2de0-\u2dff\u2e2f\u3005-\u3007\u3021-\u302f\u3031-\u3035\u3038-\u303c\u3041-\u3096\u3099\u309a\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua62b\ua640-\ua66f\ua674-\ua67d\ua67f-\ua69d\ua69f-\ua6f1\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua7ad\ua7b0\ua7b1\ua7f7-\ua827\ua840-\ua873\ua880-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f7\ua8fb\ua900-\ua92d\ua930-\ua953\ua960-\ua97c\ua980-\ua9c0\ua9cf-\ua9d9\ua9e0-\ua9fe\uaa00-\uaa36\uaa40-\uaa4d\uaa50-\uaa59\uaa60-\uaa76\uaa7a-\uaac2\uaadb-\uaadd\uaae0-\uaaef\uaaf2-\uaaf6\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uab30-\uab5a\uab5c-\uab5f\uab64\uab65\uabc0-\uabea\uabec\uabed\uabf0-\uabf9\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe00-\ufe0f\ufe20-\ufe2d\ufe33\ufe34\ufe4d-\ufe4f\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff3f\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]/};
W.prototype=N.prototype={processComment:function(){var e,f,n,g,x,I=ca.bottomRightStack,a=I[I.length-1];if(!(this.type===qa.Program&&0<this.body.length)){if(0<ca.trailingComments.length){n=[];for(g=ca.trailingComments.length-1;0<=g;--g)x=ca.trailingComments[g],x.range[0]>=this.range[1]&&(n.unshift(x),ca.trailingComments.splice(g,1));ca.trailingComments=[]}else a&&a.trailingComments&&a.trailingComments[0].range[0]>=this.range[1]&&(n=a.trailingComments,delete a.trailingComments);if(a)for(;a&&a.range[0]>=
this.range[0];)e=a,a=I.pop();if(e)e.leadingComments&&e.leadingComments[e.leadingComments.length-1].range[1]<=this.range[0]&&(this.leadingComments=e.leadingComments,e.leadingComments=void 0);else if(0<ca.leadingComments.length)for(f=[],g=ca.leadingComments.length-1;0<=g;--g)x=ca.leadingComments[g],x.range[1]<=this.range[0]&&(f.unshift(x),ca.leadingComments.splice(g,1));f&&0<f.length&&(this.leadingComments=f);n&&0<n.length&&(this.trailingComments=n);I.push(this)}},finish:function(){ca.range&&(this.range[1]=
T);ca.loc&&(this.loc.end=new K,ca.source&&(this.loc.source=ca.source));ca.attachComment&&this.processComment()},finishArrayExpression:function(e){return this.type=qa.ArrayExpression,this.elements=e,this.finish(),this},finishAssignmentExpression:function(e,f,n){return this.type=qa.AssignmentExpression,this.operator=e,this.left=f,this.right=n,this.finish(),this},finishBinaryExpression:function(e,f,n){return this.type="||"===e||"\x26\x26"===e?qa.LogicalExpression:qa.BinaryExpression,this.operator=e,
this.left=f,this.right=n,this.finish(),this},finishBlockStatement:function(e){return this.type=qa.BlockStatement,this.body=e,this.finish(),this},finishBreakStatement:function(e){return this.type=qa.BreakStatement,this.label=e,this.finish(),this},finishCallExpression:function(e,f){return this.type=qa.CallExpression,this.callee=e,this.arguments=f,this.finish(),this},finishConditionalExpression:function(e,f,n){return this.type=qa.ConditionalExpression,this.test=e,this.consequent=f,this.alternate=n,this.finish(),
this},finishContinueStatement:function(e){return this.type=qa.ContinueStatement,this.label=e,this.finish(),this},finishEmptyStatement:function(){return this.type=qa.EmptyStatement,this.finish(),this},finishExpressionStatement:function(e){return this.type=qa.ExpressionStatement,this.expression=e,this.finish(),this},finishForStatement:function(e,f,n,g){return this.type=qa.ForStatement,this.init=e,this.test=f,this.update=n,this.body=g,this.finish(),this},finishForInStatement:function(e,f,n){return this.type=
qa.ForInStatement,this.left=e,this.right=f,this.body=n,this.each=!1,this.finish(),this},finishFunctionDeclaration:function(e,f,n,g){return this.type=qa.FunctionDeclaration,this.id=e,this.params=f,this.defaults=n,this.body=g,this.rest=null,this.generator=!1,this.expression=!1,this.finish(),this},finishFunctionExpression:function(e,f,n,g){return this.type=qa.FunctionExpression,this.id=e,this.params=f,this.defaults=n,this.body=g,this.rest=null,this.generator=!1,this.expression=!1,this.finish(),this},
finishIdentifier:function(e){return this.type=qa.Identifier,this.name=e,this.finish(),this},finishIfStatement:function(e,f,n){return this.type=qa.IfStatement,this.test=e,this.consequent=f,this.alternate=n,this.finish(),this},finishLiteral:function(e){return this.type=qa.Literal,this.value=e.value,this.raw=da.slice(e.start,e.end),e.regex&&(this.regex=e.regex),this.finish(),this},finishMemberExpression:function(e,f,n){return this.type=qa.MemberExpression,this.computed="["===e,this.object=f,this.property=
n,this.finish(),this},finishObjectExpression:function(e){return this.type=qa.ObjectExpression,this.properties=e,this.finish(),this},finishPostfixExpression:function(e,f){return this.type=qa.UpdateExpression,this.operator=e,this.argument=f,this.prefix=!1,this.finish(),this},finishProgram:function(e){return this.type=qa.Program,this.body=e,this.finish(),this},finishProperty:function(e,f,n,g,x){return this.type=qa.Property,this.key=f,this.value=n,this.kind=e,this.method=g,this.shorthand=x,this.finish(),
this},finishReturnStatement:function(e){return this.type=qa.ReturnStatement,this.argument=e,this.finish(),this},finishUnaryExpression:function(e,f){return this.type="++"===e||"--"===e?qa.UpdateExpression:qa.UnaryExpression,this.operator=e,this.argument=f,this.prefix=!0,this.finish(),this},finishVariableDeclaration:function(e,f){return this.type=qa.VariableDeclaration,this.declarations=e,this.kind=f,this.finish(),this},finishVariableDeclarator:function(e,f){return this.type=qa.VariableDeclarator,this.id=
e,this.init=f,this.finish(),this}};A.version="2.0.0-dev";A.tokenize=function(e,f){var n,g;n=String;"string"==typeof e||e instanceof String||(e=n(e));da=e;T=0;ra=0<da.length?1:0;ua=0;Aa=da.length;ma=null;pa={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1};ca={};f=f||{};f.tokens=!0;ca.tokens=[];ca.tokenize=!0;ca.openParenToken=-1;ca.openCurlyToken=-1;ca.range="boolean"==typeof f.range&&f.range;ca.loc="boolean"==typeof f.loc&&f.loc;"boolean"==typeof f.comment&&
f.comment&&(ca.comments=[]);"boolean"==typeof f.tolerant&&f.tolerant&&(ca.errors=[]);try{if(G(),ma.type===ha.EOF)return ca.tokens;for(J();ma.type!==ha.EOF;)try{J()}catch(tb){if(ca.errors){ca.errors.push(tb);break}throw tb;}ib();g=ca.tokens;"undefined"!=typeof ca.comments&&(g.comments=ca.comments);"undefined"!=typeof ca.errors&&(g.errors=ca.errors)}catch(tb){throw tb;}finally{ca={}}return g};A.parse=function(e,f){var n,g;g=String;"string"==typeof e||e instanceof String||(e=g(e));da=e;T=0;ra=0<da.length?
1:0;ua=0;Aa=da.length;ma=null;pa={allowIn:!0,labelSet:{},parenthesisCount:0,inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1};ca={};"undefined"!=typeof f&&(ca.range="boolean"==typeof f.range&&f.range,ca.loc="boolean"==typeof f.loc&&f.loc,ca.attachComment="boolean"==typeof f.attachComment&&f.attachComment,ca.loc&&null!==f.source&&void 0!==f.source&&(ca.source=g(f.source)),"boolean"==typeof f.tokens&&f.tokens&&(ca.tokens=[]),"boolean"==typeof f.comment&&f.comment&&(ca.comments=[]),"boolean"==
typeof f.tolerant&&f.tolerant&&(ca.errors=[]),ca.attachComment&&(ca.range=!0,ca.comments=[],ca.bottomRightStack=[],ca.trailingComments=[],ca.leadingComments=[]));try{var x;t();G();x=new N;Ba=!1;var I,a,z,b;for(e=[];Aa>T&&(a=ma,a.type===ha.StringLiteral)&&(I=La(),e.push(I),I.expression.type===qa.Literal);)z=da.slice(a.start+1,a.end-1),"use strict"===z?(Ba=!0,b&&Z(b,va.StrictOctalLiteral)):!b&&a.octal&&(b=a);for(;Aa>T&&(I=La(),"undefined"!=typeof I);)e.push(I);n=x.finishProgram(e);"undefined"!=typeof ca.comments&&
(n.comments=ca.comments);"undefined"!=typeof ca.tokens&&(ib(),n.tokens=ca.tokens);"undefined"!=typeof ca.errors&&(n.errors=ca.errors)}catch(eb){throw eb;}finally{ca={}}return n};A.Syntax=function(){var e,f={};"function"==typeof Object.create&&(f=Object.create(null));for(e in qa)qa.hasOwnProperty(e)&&(f[e]=qa[e]);return"function"==typeof Object.freeze&&Object.freeze(f),f}()})},"esri/arcade/arcadeCompiler":function(){define("require exports ../geometry/Polygon ../geometry/Polyline ../geometry/Point ../geometry/Extent ../geometry/Multipoint ../geometry/SpatialReference ./languageUtils ./treeAnalysis ./Dictionary ./Feature ./functions/date ./functions/string ./functions/maths ./functions/geometry ./functions/geomsync ./functions/stats ./ImmutablePathArray ./ImmutablePointArray ../geometry/Geometry".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E){function J(e,f,n){try{return n(e,null,f)}catch(ga){throw ga;}}function G(e,f){try{switch(f.type){case "EmptyStatement":return"lc.voidOperation";case "VariableDeclarator":return W(e,f);case "VariableDeclaration":for(var n=[],g=0;g<f.declarations.length;g++)n.push(G(e,f.declarations[g]));return n.join("\n")+" \n lastStatement\x3d  lc.voidOperation; \n";case "BlockStatement":return N(e,f);case "FunctionDeclaration":var x=f.id.name.toLowerCase(),I={applicationCache:void 0===
e.applicationCache?null:e.applicationCache,spatialReference:e.spatialReference,console:e.console,symbols:e.symbols,localScope:{_SymbolsMap:{}},depthCounter:e.depthCounter+1,globalScope:e.globalScope};if(64<I.depthCounter)throw Error("Exceeded maximum function depth");for(var n="new lc.SizzleFunction( lang.functionDepthchecker(function() { var lastStatement \x3d lc.voidOperation; var lscope \x3d [];\n ",a=0;a<f.params.length;a++){var z=f.params[a].name.toLowerCase(),b=Z(z,e);I.localScope._SymbolsMap[z]=
b;n+="lscope['"+b+"']\x3darguments["+a.toString()+"];\n"}(n+=N(I,f.body)+"\n return lastStatement; }, runtimeCtx))",n+="\n lastStatement \x3d lc.voidOperation; \n",void 0!==e.globalScope[x])?g="gscope['"+x+"']\x3d"+n:void 0!==e.globalScope._SymbolsMap[x]?g="gscope['"+e.globalScope._SymbolsMap[x]+"']\x3d"+n:(b=Z(x,e),g=(e.globalScope._SymbolsMap[x]=b,"gscope['"+b+"']\x3d"+n));return g;case "ReturnStatement":var L;L=null===f.argument?"return lc.voidOperation;":"return "+G(e,f.argument)+";";return L;
case "IfStatement":if("AssignmentExpression"===f.test.type||"UpdateExpression"===f.test.type)throw Error(k.nodeErrorMessage(f.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));var m=G(e,f.test),c=O(e),P="var "+c+" \x3d "+m+";\n if ("+c+" \x3d\x3d\x3d true) {\n"+U(e,f.consequent)+"\n }\n";return P+=null!==f.alternate?"else if ("+c+"\x3d\x3d\x3dfalse)   { \n"+U(e,f.alternate)+"}\n":"else if ("+c+"\x3d\x3d\x3dfalse) { \n lastStatement \x3d lc.voidOperation;\n }\n",P+="else { lang.error({type: '"+
f.type+"'},'RUNTIME','CANNOT_USE_NONBOOLEAN_IN_CONDITION'); \n}\n";case "ExpressionStatement":return"AssignmentExpression"===f.expression.type?"lastStatement \x3d lc.voidOperation; "+G(e,f.expression)+" \n ":"lastStatement \x3d "+G(e,f.expression)+";";case "AssignmentExpression":return M(e,f);case "UpdateExpression":return K(e,f);case "BreakStatement":return"break;";case "ContinueStatement":return"continue;";case "ForStatement":n="lastStatement \x3d lc.voidOperation; \n";null!==f.init&&(n+=G(e,f.init));
var d=O(e),Y=O(e);return n+="var "+d+" \x3d true;",n+="\n do { ",null!==f.update&&(n+=" if ("+d+"\x3d\x3d\x3dfalse) {\n "+G(e,f.update)+"  \n}\n "+d+"\x3dfalse; \n"),null!==f.test&&(n+="var "+Y+" \x3d "+G(e,f.test)+";",n+="if ("+Y+"\x3d\x3d\x3dfalse) { break; } else if ("+Y+"!\x3d\x3dtrue) { lang.error({type: '"+f.type+"'},'RUNTIME','CANNOT_USE_NONBOOLEAN_IN_CONDITION');   }\n"),n+=G(e,f.body),null!==f.update&&(n+="\n "+G(e,f.update)),n+="\n"+d+" \x3d true; \n} while(true);  lastStatement \x3d lc.voidOperation;";
case "ForInStatement":var q=O(e),h=O(e),y=O(e),v="var "+q+" \x3d "+G(e,f.right)+";\n";"VariableDeclaration"===f.left.type&&(v+=G(e,f.left));var l="VariableDeclaration"===f.left.type?f.left.declarations[0].id.name:f.left.name,l=l.toLowerCase(),n="";return null!==e.localScope&&(void 0!==e.localScope[l]?n="lscope['"+l+"']":void 0!==e.localScope._SymbolsMap[l]&&(n="lscope['"+e.localScope._SymbolsMap[l]+"']")),""===n&&(void 0!==e.globalScope[l]?n="gscope['"+l+"']":void 0!==e.globalScope._SymbolsMap[l]&&
(n="gscope['"+e.globalScope._SymbolsMap[l]+"']")),v+="if ("+q+"\x3d\x3d\x3dnull) {  lastStatement \x3d lc.voidOperation; }\n ",v+="else if (lc.isArray("+q+") || lc.isString("+q+")) {",v+="var "+h+"\x3d"+q+".length; \n",v+="for(var "+y+"\x3d0; "+y+"\x3c"+h+"; "+y+"++) {\n",v+=n+"\x3d"+y+";\n",v+=G(e,f.body),v+="\n}\n",v+=" lastStatement \x3d lc.voidOperation; \n",v+=" \n}\n",v+="else if (lc.isImmutableArray("+q+")) {",v+="var "+h+"\x3d"+q+".length(); \n",v+="for(var "+y+"\x3d0; "+y+"\x3c"+h+"; "+y+
"++) {\n",v+=n+"\x3d"+y+";\n",v+=G(e,f.body),v+="\n}\n",v+=" lastStatement \x3d lc.voidOperation; \n",v+=" \n}\n",v+="else if (( "+q+" instanceof lang.Dictionary) || ( "+q+" instanceof lang.Feature)) {",v+="var "+h+"\x3d"+q+".keys(); \n",v+="for(var "+y+"\x3d0; "+y+"\x3c"+h+".length; "+y+"++) {\n",v+=n+"\x3d"+h+"["+y+"];\n",v+=G(e,f.body),v+="\n}\n",v+=" lastStatement \x3d lc.voidOperation; \n",v+=" \n}\n",v+="else { lastStatement \x3d lc.voidOperation; } \n";case "Identifier":return V(e,f);case "MemberExpression":var t;
try{n=void 0,t=(n=!0===f.computed?G(e,f.property):"'"+f.property.name+"'","lang.member("+G(e,f.object)+","+n+")")}catch(Ma){throw Ma;}return t;case "Literal":return null===f.value||void 0===f.value?"null":JSON.stringify(f.value);case "ThisExpression":throw Error(k.nodeErrorMessage(f,"RUNTIME","NOTSUPPORTED"));case "CallExpression":try{if("Identifier"!==f.callee.type)throw Error(k.nodeErrorMessage(f,"RUNTIME","ONLYNODESSUPPORTED"));var B=f.callee.name.toLowerCase(),g="";if(null!==e.localScope&&(void 0!==
e.localScope[B]?g="lscope['"+B+"']":void 0!==e.localScope._SymbolsMap[B]&&(g="lscope['"+e.localScope._SymbolsMap[B]+"']")),""===g&&(void 0!==e.globalScope[B]?g="gscope['"+B+"']":void 0!==e.globalScope._SymbolsMap[B]&&(g="gscope['"+e.globalScope._SymbolsMap[B]+"']")),""!==g){x="[";for(I=0;I<f.arguments.length;I++)0<I&&(x+=", "),x+=G(e,f.arguments[I]);n=(x+="]","lang.callfunc("+g+","+x+",runtimeCtx)")}else throw Error(k.nodeErrorMessage(f,"RUNTIME","NOTFOUND"));}catch(Ma){throw Ma;}return n;case "UnaryExpression":var E;
try{E="lang.unary("+G(e,f.argument)+",'"+f.operator+"')"}catch(Ma){throw Ma;}return E;case "BinaryExpression":var D;try{D="lang.binary("+G(e,f.left)+","+G(e,f.right)+",'"+f.operator+"')"}catch(Ma){throw Ma;}return D;case "LogicalExpression":var r;try{if("AssignmentExpression"===f.left.type||"UpdateExpression"===f.left.type)throw Error(k.nodeErrorMessage(f.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("AssignmentExpression"===f.right.type||"UpdateExpression"===f.right.type)throw Error(k.nodeErrorMessage(f.right,
"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("\x26\x26"===f.operator||"||"===f.operator)r="(lang.logicalCheck("+G(e,f.left)+") "+f.operator+" lang.logicalCheck("+G(e,f.right)+"))";else throw Error(k.nodeErrorMessage("LogicalExpression","RUNTIME","ONLYORORAND"));}catch(Ma){throw Ma;}return r;case "ConditionalExpression":throw Error(k.nodeErrorMessage(f,"RUNTIME","NOTSUPPORTED"));case "ArrayExpression":try{n=[];for(g=0;g<f.elements.length;g++)"Literal"===f.elements[g].type?n.push(G(e,f.elements[g])):
n.push("lang.aCheck("+G(e,f.elements[g])+",'ArrayExpression')");a="["+n.join(",")+"]"}catch(Ma){throw Ma;}return a;case "ObjectExpression":n="lang.dictionary([";for(g=0;g<f.properties.length;g++){var C=f.properties[g],u="Identifier"===C.key.type?"'"+C.key.name+"'":G(e,C.key),J=G(e,C.value);0<g&&(n+=",");n+="lang.strCheck("+u+",'ObjectExpression'),lang.aCheck("+J+", 'ObjectExpression')"}return n+="])";case "Property":throw Error("Should not get here");case "Array":throw Error(k.nodeErrorMessage(f,
"RUNTIME","NOTSUPPORTED"));default:throw Error(k.nodeErrorMessage(f,"RUNTIME","UNREOGNISED"));}}catch(Ma){throw Ma;}}function K(e,f){var n=null,g="";if("MemberExpression"===f.argument.type)return n=G(e,f.argument.object),g=!0===f.argument.computed?G(e,f.argument.property):"'"+f.argument.property.name+"'","lang.memberupdate("+n+","+g+",'"+f.operator+"',"+f.prefix+")";if(n=f.argument.name.toLowerCase(),null!==e.localScope){if(void 0!==e.localScope[n])return"lang.update(lscope, '"+n+"','"+f.operator+
"',"+f.prefix+")";if(void 0!==e.localScope._SymbolsMap[n])return"lang.update(lscope, '"+e.localScope._SymbolsMap[n]+"','"+f.operator+"',"+f.prefix+")"}if(void 0!==e.globalScope[n])return"lang.update(gscope, '"+n+"','"+f.operator+"',"+f.prefix+")";if(void 0!==e.globalScope._SymbolsMap[n])return"lang.update(gscope, '"+e.globalScope._SymbolsMap[n]+"','"+f.operator+"',"+f.prefix+")";throw Error("Variable not recognised");}function M(e,f){var n=G(e,f.right),g=null,x="";if("MemberExpression"===f.left.type)return g=
G(e,f.left.object),x=!0===f.left.computed?G(e,f.left.property):"'"+f.left.property.name+"'","lang.assignmember("+g+","+x+",'"+f.operator+"',"+n+");";if(g=f.left.name.toLowerCase(),null!==e.localScope){if(void 0!==e.localScope[g])return"lscope['"+g+"']\x3dlang.assign("+n+",'"+f.operator+"', lscope['"+g+"']); ";if(void 0!==e.localScope._SymbolsMap[g])return"lscope['"+e.localScope._SymbolsMap[g]+"']\x3dlang.assign("+n+",'"+f.operator+"', lscope['"+e.localScope._SymbolsMap[g]+"']); "}if(void 0!==e.globalScope[g])return"gscope['"+
g+"']\x3dlang.assign("+n+",'"+f.operator+"', gscope['"+g+"']); ";if(void 0!==e.globalScope._SymbolsMap[g])return"gscope['"+e.globalScope._SymbolsMap[g]+"']\x3dlang.assign("+n+",'"+f.operator+"', gscope['"+e.globalScope._SymbolsMap[g]+"']); ";throw Error("Variable not recognised");}function U(e,f){return"BlockStatement"===f.type?G(e,f):"ReturnStatement"===f.type?G(e,f):"BreakStatement"===f.type?G(e,f):"ContinueStatement"===f.type?G(e,f):"UpdateExpression"===f.type?"lastStatement \x3d "+G(e,f)+";":
"ExpressionStatement"===f.type?G(e,f):"ObjectExpression"===f.type?"lastStatement \x3d "+G(e,f)+";":G(e,f)}function N(e,f){for(var n="",g=0;g<f.body.length;g++)n+="ReturnStatement"===f.body[g].type?G(e,f.body[g])+" \n":"BreakStatement"===f.body[g].type?G(e,f.body[g])+" \n":"ContinueStatement"===f.body[g].type?G(e,f.body[g])+" \n":"UpdateExpression"===f.body[g].type?"lastStatement \x3d "+G(e,f.body[g])+"; \n":"ObjectExpression"===f.body[g].type?"lastStatement \x3d "+G(e,f.body[g])+"; \n":G(e,f.body[g])+
" \n";return n}function W(e,f){var n=null===f.init?null:G(e,f.init);n===a.voidOperation&&(n=null);f=f.id.name.toLowerCase();if(null!==e.localScope){if(void 0!==e.localScope[f])return"lscope['"+f+"']\x3d"+n+";";if(void 0!==e.localScope._SymbolsMap[f])return"lscope['"+e.localScope._SymbolsMap[f]+"']\x3d"+n+";";var g=Z(f,e);return e.localScope._SymbolsMap[f]=g,"lscope['"+g+"']\x3d"+n+";"}if(void 0!==e.globalScope[f])return"gscope['"+f+"']\x3d"+n+";";if(void 0!==e.globalScope._SymbolsMap[f])return"gscope['"+
e.globalScope._SymbolsMap[f]+"']\x3d"+n+";";g=Z(f,e);return e.globalScope._SymbolsMap[f]=g,"gscope['"+g+"']\x3d"+n+";"}function R(e,n,g){switch(n=n.toLowerCase()){case "hasz":return e=e.hasZ,void 0===e?!1:e;case "hasm":return e=e.hasM,void 0===e?!1:e;case "spatialreference":return n=e.spatialReference._arcadeCacheId,void 0===n&&(g=!0,Object.freeze&&Object.isFrozen(e.spatialReference)&&(g=!1),g&&(f++,e.spatialReference._arcadeCacheId=f,n=f)),e=new c({wkt:e.spatialReference.wkt,wkid:e.spatialReference.wkid}),
void 0!==n&&(e._arcadeCacheId="SPREF"+n.toString()),e}switch(e.type){case "extent":switch(n){case "xmin":case "xmax":case "ymin":case "ymax":case "zmin":case "zmax":case "mmin":case "mmax":return e=e[n],void 0!==e?e:null;case "type":return"Extent"}break;case "polygon":switch(n){case "rings":return n=a.isVersion4?e.cache._arcadeCacheId:e.getCacheValue("_arcadeCacheId"),void 0===n&&(f++,n=f,a.isVersion4?e.cache._arcadeCacheId=n:e.setCacheValue("_arcadeCacheId",n)),e=new b(e.rings,e.spatialReference,
!0===e.hasZ,!0===e.hasM,n);case "type":return"Polygon"}break;case "point":switch(n){case "x":case "y":case "z":case "m":return void 0!==e[n]?e[n]:null;case "type":return"Point"}break;case "polyline":switch(n){case "paths":return n=a.isVersion4?e.cache._arcadeCacheId:e.getCacheValue("_arcadeCacheId"),void 0===n&&(f++,n=f,a.isVersion4?e.cache._arcadeCacheId=n:e.setCacheValue("_arcadeCacheId",n)),e=new b(e.paths,e.spatialReference,!0===e.hasZ,!0===e.hasM,n);case "type":return"Polyline"}break;case "multipoint":switch(n){case "points":return n=
a.isVersion4?e.cache._arcadeCacheId:e.getCacheValue("_arcadeCacheId"),void 0===n&&(f++,n=f,a.isVersion4?e.cache._arcadeCacheId=n:e.setCacheValue("_arcadeCacheId",n)),e=new m(e.points,e.spatialReference,!0===e.hasZ,!0===e.hasM,n,1);case "type":return"Multipoint"}}throw Error(k.nodeErrorMessage(g,"RUNTIME","PROPERTYNOTFOUND"));}function V(e,f){try{var n=f.name.toLowerCase();if(null!==e.localScope){if(void 0!==e.localScope[n])return"lscope['"+n+"']";if(void 0!==e.localScope._SymbolsMap[n])return"lscope['"+
e.localScope._SymbolsMap[n]+"']"}if(void 0!==e.globalScope[n])return"gscope['"+n+"']";if(void 0!==e.globalScope._SymbolsMap[n])return"gscope['"+e.globalScope._SymbolsMap[n]+"']";throw Error(k.nodeErrorMessage(f,"RUNTIME","VARIABLENOTFOUND"));}catch(ga){throw ga;}}function Q(e){return null===e?"":a.isArray(e)?"Array":a.isImmutableArray(e)?"Array":a.isDate(e)?"Date":a.isString(e)?"String":a.isBoolean(e)?"Boolean":a.isNumber(e)?"Number":e instanceof c?"Dictionary":e instanceof t?"Feature":e instanceof
h?"Point":e instanceof w?"Polygon":e instanceof l?"Polyline":e instanceof u?"Multipoint":e instanceof d?"Extent":a.isFunctionParameter(e)?"Function":e===a.voidOperation?"":"number"==typeof e&&isNaN(e)?"Number":"Unrecognised Type"}function S(e,f,n,g){try{if(a.equalityTest(f[n],g))return f[n+1];var x=f.length-n;return 1===x?f[n]:2===x?null:3===x?f[n+2]:S(e,f,n+2,g)}catch(na){throw na;}}function X(e,f,n,g){try{if(!0===g)return f[n+1];if(3===f.length-n)return f[n+2];var x=f[n+2];if(!1===a.isBoolean(x))throw Error("WHEN needs boolean test conditions");
return X(e,f,n+2,x)}catch(na){throw na;}}function z(e,f){var n=e.length,g=Math.floor(n/2);if(0===n)f=[];else if(1===n)f=[e[0]];else{var x=z(e.slice(0,g),f);e=z(e.slice(g,n),f);for(n=[];0<x.length||0<e.length;)0<x.length&&0<e.length?(g=f(x[0],e[0]),isNaN(g)&&(g=0),0>=g?(n.push(x[0]),x=x.slice(1)):(n.push(e[0]),e=e.slice(1))):0<x.length?(n.push(x[0]),x=x.slice(1)):0<e.length&&(n.push(e[0]),e=e.slice(1));f=n}return f}function Z(e,f){return f.symbols.symbolCounter++,"_T"+f.symbols.symbolCounter.toString()}
function O(e){return e.symbols.symbolCounter++,"_Tvar"+e.symbols.symbolCounter.toString()}function g(e,f,n){var g={};e||(e={});n||(n={});g._SymbolsMap={};g.textformatting=1;g.infinity=1;g.pi=1;for(var x in f)g[x]=1;for(x in n)g[x]=1;for(x in e)g[x]=1;return g}function e(e){console.log(e)}Object.defineProperty(p,"__esModule",{value:!0});var f=0,n={};C.registerFunctions(n,J);q.registerFunctions(n,J);v.registerFunctions(n,J);y.registerFunctions(n,J);D.registerFunctions(n,J);B.registerFunctions(n,J);
n["typeof"]=function(e,f){return J(e,f,function(e,f,n){a.pcCheck(n,1,1);e=Q(n[0]);if("Unrecognised Type"===e)throw Error("Unrecognised Type");return e})};n.iif=function(e,f){try{return J(e,f,function(e,f,n){if(a.pcCheck(n,3,3),!1===a.isBoolean(n[0]))throw Error("IF Function must have a boolean test condition");return n[0]?n[1]:n[2]})}catch(fa){throw fa;}};n.decode=function(e,f){try{return J(e,f,function(f,n,g){if(2>g.length)throw Error("Missing Parameters");if(2===g.length)return g[1];if(0===(g.length-
1)%2)throw Error("Must have a default value result.");return S(e,g,1,g[0])})}catch(fa){throw fa;}};n.when=function(e,f){try{return J(e,f,function(f,n,g){if(3>g.length)throw Error("Missing Parameters");if(0===g.length%2)throw Error("Must have a default value result.");f=g[0];if(!1===a.isBoolean(f))throw Error("WHEN needs boolean test conditions");return X(e,g,0,f)})}catch(fa){throw fa;}};n.top=function(e,f){return J(e,f,function(e,f,n){if(a.pcCheck(n,2,2),a.isArray(n[0]))return a.toNumber(n[1])>=n[0].length?
n[0].slice(0):n[0].slice(0,a.toNumber(n[1]));if(a.isImmutableArray(n[0]))return a.toNumber(n[1])>=n[0].length()?n[0].slice(0):n[0].slice(0,a.toNumber(n[1]));throw Error("Top cannot accept this parameter type");})};n.first=function(e,f){return J(e,f,function(e,f,n){return a.pcCheck(n,1,1),a.isArray(n[0])?0===n[0].length?null:n[0][0]:a.isImmutableArray(n[0])?0===n[0].length()?null:n[0].get(0):null})};n.sort=function(e,f){return J(e,f,function(e,f,n){a.pcCheck(n,1,2);f=n[0];if(a.isImmutableArray(f)&&
(f=f.toArray()),!1===a.isArray(f))throw Error("Illegal Argument");if(1<n.length){if(!1===a.isFunctionParameter(n[1]))throw Error("Illegal Argument");return f=z(f,function(f,g){return L.callfunc(n[1],[f,g],e)})}if(0===f.length)return[];for(var g={},x=0;x<f.length;x++){var I=Q(f[x]);""!==I&&(g[I]=!0)}if(!0===g.Array||!0===g.Dictionary||!0===g.Feature||!0===g.Point||!0===g.Polygon||!0===g.Polyline||!0===g.Multipoint||!0===g.Extent||!0===g.Function)return f.slice(0);var x=0,I="",b;for(b in g)x++,I=b;
return f=1<x||"String"===I?z(f,function(e,f){if(null===e||void 0===e||e===a.voidOperation)return null===f||void 0===f||f===a.voidOperation?0:1;if(null===f||void 0===f||f===a.voidOperation)return-1;e=a.toString(e);f=a.toString(f);return f>e?-1:e===f?0:1}):"Number"===I?z(f,function(e,f){return e-f}):"Boolean"===I?z(f,function(e,f){return e===f?0:f?-1:1}):"Date"===I?z(f,function(e,f){return f-e}):f.slice(0)})};for(var x in n)n[x]=new a.NativeFunction(n[x]);var I=function(){};I.prototype=n;p.functionHelper=
{fixSpatialReference:a.fixSpatialReference,parseArguments:function(e,f){for(var n=[],g=0;g<f.arguments.length;g++)n.push(G(e,f.arguments[g]));return n},standardFunction:J};p.extend=function(e){for(var f={mode:"sync",compiled:!0,functions:{},signatures:[],standardFunction:J},g=0;g<e.length;g++)e[g].registerFunctions(f);for(var x in f.functions)n[x]=new a.NativeFunction(f.functions[x]),I.prototype[x]=n[x];for(g=0;g<f.signatures.length;g++)k.addFunctionDeclaration(f.signatures[g],"f")};p.executeScript=
function(e,f,n){return e(f,n)};p.extractFieldLiterals=function(e,f){return void 0===f&&(f=!1),k.findFieldLiterals(e,f)};p.validateScript=function(e,f){return k.validateScript(e,f,"simple")};p.referencesMember=function(e,f){return k.referencesMember(e,f)};p.referencesFunction=function(e,f){return k.referencesFunction(e,f)};var L={error:function(e,f,n){throw Error(k.nodeErrorMessage(e,f,n));},functionDepthchecker:function(e,f){return function(){if(f.depthCounte++,64<f.depthCounter)throw Error("Exceeded maximum function depth");
var n=e.apply(this,arguments);return f.depthCounte--,n}},aCheck:function(e,f){if(a.isFunctionParameter(e))throw Error(k.nodeErrorMessage({type:f},"RUNTIME","FUNCTIONCONTEXTILLEGAL"));return e===a.voidOperation?null:e},Dictionary:c,Feature:t,dictionary:function(e){for(var f={},n=0;n<e.length;n+=2){if(a.isFunctionParameter(e[n+1]))throw Error("Illegal Argument");if(!1===a.isString(e[n]))throw Error("Illegal Argument");e[n+1]===a.voidOperation?f[e[n].toString()]=null:f[e[n].toString()]=e[n+1]}e=new c(f);
return e.immutable=!1,e},strCheck:function(e,f){if(!1===a.isString(e))throw Error("Illegal Argument");return e},unary:function(e,f){if(a.isBoolean(e)){if("!"===f)return!e;if("-"===f)return-1*a.toNumber(e);if("+"===f)return 1*a.toNumber(e);throw Error(k.nodeErrorMessage({type:"UnaryExpression"},"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"));}if("-"===f)return-1*a.toNumber(e);if("+"===f)return 1*a.toNumber(e);throw Error(k.nodeErrorMessage({type:"UnaryExpression"},"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"));},
logicalCheck:function(e){if(!1===a.isBoolean(e))throw Error(k.nodeErrorMessage("LogicalExpression","RUNTIME","ONLYORORAND"));return e},logical:function(e,f,n){if(!a.isBoolean(e)||!a.isBoolean(f))throw Error(k.nodeErrorMessage("LogicalExpression","RUNTIME","ONLYORORAND"));switch(n){case "||":return e||f;case "\x26\x26":return e&&f;default:throw Error(k.nodeErrorMessage("LogicalExpression","RUNTIME","ONLYORORAND"));}},binary:function(e,f,n){switch(n){case "\x3d\x3d":return a.equalityTest(e,f);case "\x3d":return a.equalityTest(e,
f);case "!\x3d":return!a.equalityTest(e,f);case "\x3c":return a.greaterThanLessThan(e,f,n);case "\x3e":return a.greaterThanLessThan(e,f,n);case "\x3c\x3d":return a.greaterThanLessThan(e,f,n);case "\x3e\x3d":return a.greaterThanLessThan(e,f,n);case "+":return a.isString(e)||a.isString(f)?a.toString(e)+a.toString(f):a.toNumber(e)+a.toNumber(f);case "-":return a.toNumber(e)-a.toNumber(f);case "*":return a.toNumber(e)*a.toNumber(f);case "/":return a.toNumber(e)/a.toNumber(f);case "%":return a.toNumber(e)%
a.toNumber(f);default:throw Error(k.nodeErrorMessage({type:"BinaryExpression"},"RUNTIME","OPERATORNOTRECOGNISED"));}},assign:function(e,f,n){switch(f){case "\x3d":return e===a.voidOperation?null:e;case "/\x3d":return a.toNumber(n)/a.toNumber(e);case "*\x3d":return a.toNumber(n)*a.toNumber(e);case "-\x3d":return a.toNumber(n)-a.toNumber(e);case "+\x3d":return a.isString(n)||a.isString(e)?a.toString(n)+a.toString(e):a.toNumber(n)+a.toNumber(e);case "%\x3d":return a.toNumber(n)%a.toNumber(e);default:throw Error(k.nodeErrorMessage("AssignmentExpression",
"RUNTIME","OPERATORNOTRECOGNISED"));}},update:function(e,f,n,g){var x=a.toNumber(e[f]);return e[f]="++"===n?x+1:x-1,!1===g?x:"++"===n?x+1:x-1},memberupdate:function(e,f,n,g){var x;if(a.isArray(e)){if(!a.isNumber(f))throw Error("Invalid Parameter");if(0>f&&(f=e.length+f),0>f||f>=e.length)throw Error("Assignment outside of array bounds");x=a.toNumber(e[f]);e[f]="++"===n?x+1:x-1}else{if(e instanceof c){if(!1===a.isString(f))throw Error("Dictionary accessor must be a string");}else{if(!(e instanceof t))throw a.isImmutableArray(e)?
Error("Array is Immutable"):Error("Invalid Parameter");if(!1===a.isString(f))throw Error("Feature accessor must be a string");}if(!0!==e.hasField(f))throw Error("Invalid Parameter");x=a.toNumber(e.field(f));e.setField(f,"++"===n?x+1:x-1)}return!1===g?x:"++"===n?x+1:x-1},assignmember:function(e,f,n,g){if(a.isArray(e)){if(!a.isNumber(f))throw Error("Invalid Parameter");if(0>f&&(f=e.length+f),0>f||f>e.length)throw Error("Assignment outside of array bounds");if(f===e.length&&"\x3d"!==n)throw Error("Invalid Parameter");
e[f]=this.assign(g,n,e[f])}else{if(e instanceof c){if(!1===a.isString(f))throw Error("Dictionary accessor must be a string");}else{if(!(e instanceof t))throw a.isImmutableArray(e)?Error("Array is Immutable"):Error("Invalid Parameter");if(!1===a.isString(f))throw Error("Feature accessor must be a string");}if(!0===e.hasField(f))e.setField(f,this.assign(g,n,e.field(f)));else{if("\x3d"!==n)throw Error("Invalid Parameter");e.setField(f,this.assign(g,n,null))}}},member:function(e,f){if(null===e)throw Error(k.nodeErrorMessage("MemberExpression",
"RUNTIME","NOTFOUND"));if(e instanceof c||e instanceof t){if(a.isString(f))return e.field(f);throw Error(k.nodeErrorMessage("MemberExpression","RUNTIME","INVALIDTYPE"));}if(e instanceof E){if(a.isString(f))return R(e,f,"MemberExpression");throw Error(k.nodeErrorMessage("MemberExpression","RUNTIME","INVALIDTYPE"));}if(a.isArray(e)){if(a.isNumber(f)&&isFinite(f)&&Math.floor(f)===f){if(0>f&&(f=e.length+f),f>=e.length||0>f)throw Error(k.nodeErrorMessage("MemberExpression","RUNTIME","OUTOFBOUNDS"));return e[f]}throw Error(k.nodeErrorMessage("MemberExpression",
"RUNTIME","INVALIDTYPE"));}if(a.isString(e)){if(a.isNumber(f)&&isFinite(f)&&Math.floor(f)===f){if(0>f&&(f=e.length+f),f>=e.length||0>f)throw Error(k.nodeErrorMessage("MemberExpression","RUNTIME","OUTOFBOUNDS"));return e[f]}throw Error(k.nodeErrorMessage("MemberExpression","RUNTIME","INVALIDTYPE"));}if(a.isImmutableArray(e)&&a.isNumber(f)&&isFinite(f)&&Math.floor(f)===f){if(0>f&&(f=e.length()+f),f>=e.length()||0>f)throw Error(k.nodeErrorMessage("MemberExpression","RUNTIME","OUTOFBOUNDS"));return e.get(f)}throw Error(k.nodeErrorMessage("MemberExpression",
"RUNTIME","INVALIDTYPE"));},callfunc:function(e,f,n){return e instanceof a.NativeFunction?e.fn(n,f):e instanceof a.SizzleFunction?e.fn.apply(this,f):e.apply(this,f)}};p.compileScript=function(f,x){void 0===x&&(x=null);null===x&&(x={vars:{},customfunctions:{}});x={globalScope:g(x.vars,n,x.customfunctions),localScope:null,console:e,symbols:{symbolCounter:0}};f=G(x,f.body[0].body);""===f&&(f="lc.voidOperation;");x={lc:a,lang:L,postProcess:function(e){if(e instanceof a.ReturnResult&&(e=e.value),e instanceof
a.ImplicitResult&&(e=e.value),e===a.voidOperation&&(e=null),e===a.breakResult)throw Error("Cannot return BREAK");if(e===a.continueResult)throw Error("Cannot return CONTINUE");if(a.isFunctionParameter(e))throw Error("Cannot return FUNCTION");return e},prepare:function(f,n){n||(n=new r({wkid:102100}));var g=f.vars,x=f.customfunctions,a=new I;g||(g={});x||(x={});var z=new c({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});z.immutable=!1;a._SymbolsMap={textformatting:1,
infinity:1,pi:1};a.textformatting=z;a.infinity=Number.POSITIVE_INFINITY;a.pi=Math.PI;for(var b in x)a[b]=x[b],a._SymbolsMap[b]=1;for(b in g)a._SymbolsMap[b]=1,g[b]&&"esri.Graphic"===g[b].declaredClass?a[b]=new t(g[b]):a[b]=g[b];return{spatialReference:n,globalScope:a,localScope:null,console:f.console?f.console:e,symbols:{symbolCounter:0},depthCounter:1,applicationCache:void 0===f.applicationCache?null:f.applicationCache}}};return(new Function("context","spatialReference","var runtimeCtx\x3dthis.prepare(context, spatialReference);\n var lc \x3d this.lc;  var lang \x3d this.lang; var gscope\x3druntimeCtx.globalScope; \n function mainBody() {\n var lastStatement\x3dlc.voidOperation;\n "+
f+"\n return lastStatement; } \n return this.postProcess(mainBody());")).bind(x)}})},"esri/layers/support/fieldUtils":function(){define(["require","exports","dojo/_base/lang"],function(A,p,w){function l(d,l,r){if(d)for(var a=0;a<d.length;a++){var k=d[a],c=w.getObject(k,!1,l);(c=c&&"function"!=typeof c&&h(c,r))&&w.setObject(k,c.name,l)}}function h(d,h){if(null!=h){d=d.toLowerCase();for(var l=0;l<h.length;l++){var a=h[l];if(a&&a.name.toLowerCase()===d)return a}}return null}Object.defineProperty(p,"__esModule",
{value:!0});p.extractFieldNames=function(d){if(!d||"string"!=typeof d)return[];d=d.match(/{[^}]*}/g);if(!d)return[];var h=/\{(\w+):.+\}/;return(d=d.filter(function(d){return!(0===d.indexOf("{relationships/")||0===d.indexOf("{expression/"))}).map(function(d){return d.replace(h,"{$1}")}))?d.map(function(d){return d.slice(1,-1)}):[]};p.fixRendererFields=function(d,h){if(null!=d&&null!=h){var r=0;for(d=Array.isArray(d)?d:[d];r<d.length;r++){var a=d[r];if(l(p.rendererFields,a,h),a.visualVariables)for(var k=
0,a=a.visualVariables;k<a.length;k++)l(p.visualVariableFields,a[k],h)}}};p.getField=h;p.rendererFields="field field2 field3 normalizationField rotationInfo.field proportionalSymbolInfo.field proportionalSymbolInfo.normalizationField colorInfo.field colorInfo.normalizationField".split(" ");p.visualVariableFields=["field","normalizationField"];p.numericTypes=["integer","small-integer","single","double"];p.isNumericField=function(d,h){return d?-1<p.numericTypes.indexOf(d.type)&&d.name!==h.objectIdField:
!1};p.isStringField=function(d,h){return d?"string"===d.type&&d.name!==h.objectIdField:!1};p.isDateField=function(d){return d?"date"===d.type:!1}})},"esri/symbols/support/typeUtils":function(){define("require exports ../../core/accessorSupport/ensureType ../Symbol ../PictureFillSymbol ../PictureMarkerSymbol ../SimpleFillSymbol ../SimpleLineSymbol ../SimpleMarkerSymbol ../TextSymbol ../WebStyleSymbol ../LabelSymbol3D ../LineSymbol3D ../MeshSymbol3D ../PointSymbol3D ../PolygonSymbol3D".split(" "),function(A,
p,w,l,h,d,u,r,a,k,c,t,C,q,v,y){Object.defineProperty(p,"__esModule",{value:!0});p.types={base:l,key:"type",typeMap:{"simple-fill":u,"picture-fill":h,"picture-marker":d,"simple-line":r,"simple-marker":a,text:k,"label-3d":t,"line-3d":C,"mesh-3d":q,"point-3d":v,"polygon-3d":y,"web-style":c}};p.types3D={base:l,key:"type",typeMap:{"label-3d":t,"line-3d":C,"mesh-3d":q,"point-3d":v,"polygon-3d":y,"web-style":c}};p.ensureType=w.ensureOneOfType(p.types)})},"esri/symbols/Symbol":function(){define(["../core/lang",
"../core/kebabDictionary","../core/JSONSupport","../Color"],function(A,p,w,l){var h=p({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d"}),d=0;return w.createSubclass({declaredClass:"esri.symbols.Symbol",constructor:function(){this.id="sym"+d++},properties:{type:{type:String,
value:null,json:{read:h.fromJSON,write:{ignoreOrigin:!0,writer:function(d,l){l.type=h.toJSON(this.type)}}}},color:{type:l,value:new l([0,0,0,1]),json:{read:function(d){return d&&A.isDefined(d[0])?[d[0],d[1],d[2],d[3]/255]:d},write:!0}}}})})},"esri/symbols/PictureFillSymbol":function(){define("../core/declare dojo/_base/lang ../core/lang ../core/screenUtils ./FillSymbol ./support/urlUtils".split(" "),function(A,p,w,l,h,d){var u={xscale:1,yscale:1,xoffset:0,yoffset:0,width:12,height:12},r=A(h,{declaredClass:"esri.symbols.PictureFillSymbol",
properties:{type:"picture-fill",url:d.urlPropertyDefinition,xscale:{value:1,json:{write:!0}},yscale:{value:1,json:{write:!0}},width:{value:12,cast:l.toPt,json:{write:!0}},height:{value:12,cast:l.toPt,json:{write:!0}},xoffset:{value:0,cast:l.toPt,json:{write:!0}},yoffset:{value:0,cast:l.toPt,json:{write:!0}},source:d.sourcePropertyDefinition},getDefaults:function(){return p.mixin(this.inherited(arguments),u)},normalizeCtorArgs:function(a,d,c,h){if(a&&"string"!=typeof a&&null==a.imageData)return a;
var k={};return a&&(k.url=a),d&&(k.outline=d),null!=c&&(k.width=l.toPt(c)),null!=h&&(k.height=l.toPt(h)),k},clone:function(){var a=new r({color:w.clone(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return a._set("source",w.clone(this.source)),a}});return r.defaultProps=u,r})},"esri/core/screenUtils":function(){define(["require","exports"],function(A,p){function w(h){return h?
72*h/p.DPI:0}Object.defineProperty(p,"__esModule",{value:!0});var l=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i;p.DPI=96;p.pt2px=function(h){return h?h/72*p.DPI:0};p.px2pt=w;p.toPt=function(h){if("string"==typeof h){if(l.test(h)){var d=h.match(l),u=Number(d[1]),d=d[3]&&d[3].toLowerCase();h="-"===h.charAt(0);u="px"===d?w(u):u;return h?-u:u}return console.warn("screenUtils.toPt: input not recognized!"),null}return h}})},"esri/symbols/FillSymbol":function(){define(["dojo/_base/lang","./Symbol","./SimpleLineSymbol"],
function(A,p,w){return p.createSubclass({declaredClass:"esri.symbols.FillSymbol",properties:{outline:{type:w,json:{write:!0}},type:null},read:function h(d,u){return this.getInherited(h,arguments).call(this,A.mixin({outline:null},d),u)}})})},"esri/symbols/SimpleLineSymbol":function(){define(["../core/declare","dojo/_base/lang","../core/lang","../core/screenUtils","./LineSymbol"],function(A,p,w,l,h){var d={STYLE_SOLID:"solid",STYLE_DASH:"dash",STYLE_DOT:"dot",STYLE_DASHDOT:"dash-dot",STYLE_DASHDOTDOT:"long-dash-dot-dot",
STYLE_NULL:"none",STYLE_SHORTDASH:"short-dash",STYLE_SHORTDOT:"short-dot",STYLE_SHORTDASHDOT:"short-dash-dot",STYLE_SHORTDASHDOTDOT:"short-dash-dot-dot",STYLE_LONGDASH:"long-dash",STYLE_LONGDASHDOT:"long-dash-dot",CAP_BUTT:"butt",CAP_ROUND:"round",CAP_SQUARE:"square",JOIN_MITER:"miter",JOIN_ROUND:"round",JOIN_BEVEL:"bevel"},u={color:[0,0,0,1],style:d.STYLE_SOLID,width:.75,cap:d.CAP_BUTT,join:d.JOIN_MITER,miterLimit:7.5},r=A(h,{declaredClass:"esri.symbols.SimpleLineSymbol",properties:{type:"simple-line",
style:{value:d.STYLE_SOLID,json:{read:function(a,d){return w.valueOf(this._jsonStyles,a)||void 0},write:function(a,d){d.style=this._jsonStyles[a]}}},cap:{value:d.CAP_BUTT,json:{read:!1,write:!1}},join:{value:d.JOIN_MITER,json:{read:!1,write:!1}},miterLimit:{value:7.5,cast:l.toPt,json:{read:!1,write:!1}}},_jsonStyles:{solid:"esriSLSSolid",dash:"esriSLSDash",dot:"esriSLSDot","dash-dot":"esriSLSDashDot","long-dash-dot-dot":"esriSLSDashDotDot",none:"esriSLSNull","inside-frame":"esriSLSInsideFrame","short-dash":"esriSLSShortDash",
"short-dot":"esriSLSShortDot","short-dash-dot":"esriSLSShortDashDot","short-dash-dot-dot":"esriSLSShortDashDotDot","long-dash":"esriSLSLongDash","long-dash-dot":"esriSLSLongDashDot"},getDefaults:function(){return p.mixin(this.inherited(arguments),u)},normalizeCtorArgs:function(a,d,c,h,r,q){if(a&&"string"!=typeof a)return a;var k={};return null!=a&&(k.style=a),null!=d&&(k.color=d),null!=c&&(k.width=l.toPt(c)),null!=h&&(k.cap=h),null!=r&&(k.join=r),null!=q&&(k.miterLimit=l.toPt(q)),k},clone:function(){return new r({color:w.clone(this.color),
style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit})}});return p.mixin(r,d),r.defaultProps=u,r})},"esri/symbols/LineSymbol":function(){define(["../core/declare","../core/screenUtils","./Symbol"],function(A,p,w){return A(w,{declaredClass:"esri.symbols.LineSymbol",properties:{color:{},type:"simple-line",width:{value:.75,cast:p.toPt,json:{write:!0}}}})})},"esri/symbols/support/urlUtils":function(){define(["require","exports","../../core/urlUtils"],function(A,p,w){function l(d,
a,k){return a.imageData?w.makeData({mediaType:a.contentType||"image/png",isBase64:!0,data:a.imageData}):h(a.url,k)}function h(d,a){return!a||"service"!==a.origin&&"portal-item"!==a.origin||!a.layer||"feature"!==a.layer.type&&"stream"!==a.layer.type||w.isAbsolute(d)||!a.layer.parsedUrl?w.read(d,a):w.join(a.layer.parsedUrl.path,"images",d)}function d(d,a,k,c){w.isDataProtocol(d)?(d=w.dataComponents(d),a.contentType=d.mediaType,a.imageData=d.data,k&&k.imageData===a.imageData&&k.url&&(a.url=u(k.url,c))):
a.url=u(d,c)}function u(d,a){return w.write(d,a)}Object.defineProperty(p,"__esModule",{value:!0});p.readImageDataOrUrl=l;p.read=h;p.writeImageDataAndUrl=d;p.write=u;p.urlPropertyDefinition={json:{read:{source:["imageData","url"],reader:l},write:{writer:function(h,a,k,c){d(h,a,this.source,c)}}}};p.sourcePropertyDefinition={readOnly:!0,json:{read:{source:["imageData","url"],reader:function(d,a,k){d={};return a.imageData&&(d.imageData=a.imageData),a.contentType&&(d.contentType=a.contentType),a.url&&
(d.url=h(a.url,k)),d}}}}})},"esri/symbols/PictureMarkerSymbol":function(){define("../core/declare dojo/_base/lang ../core/lang ../core/screenUtils ./MarkerSymbol ./support/urlUtils".split(" "),function(A,p,w,l,h,d){var u={width:12,height:12,angle:0,xoffset:0,yoffset:0},r=A(h,{declaredClass:"esri.symbols.PictureMarkerSymbol",properties:{color:{json:{write:!1}},type:"picture-marker",url:d.urlPropertyDefinition,source:d.sourcePropertyDefinition,height:{json:{read:{source:["height","size"],reader:function(a,
d){return d.size||a}},write:!0},cast:l.toPt},width:{json:{read:{source:["width","size"],reader:function(a,d){return d.size||a}},write:!0},cast:l.toPt},size:{json:{write:!1}}},getDefaults:function(){return p.mixin(this.inherited(arguments),u)},normalizeCtorArgs:function(a,d,c){if(a&&"string"!=typeof a&&null==a.imageData)return a;var k={};return a&&(k.url=a),null!=d&&(k.width=l.toPt(d)),null!=c&&(k.height=l.toPt(c)),k},clone:function(){var a=new r({angle:this.angle,height:this.height,url:this.url,width:this.width,
xoffset:this.xoffset,yoffset:this.yoffset});return a._set("source",w.clone(this.source)),a}});return r.defaultProps=u,r})},"esri/symbols/MarkerSymbol":function(){define(["../core/declare","../core/screenUtils","./Symbol"],function(A,p,w){return A(w,{declaredClass:"esri.symbols.MarkerSymbol",properties:{angle:{value:0,json:{read:function(l){return l&&-1*l},write:function(l,h){h.angle=l&&-1*l}}},type:{},xoffset:{value:0,cast:p.toPt,json:{write:!0}},yoffset:{value:0,cast:p.toPt,json:{write:!0}},size:{value:9,
cast:function(l){return"auto"===l?l:p.toPt(l)},json:{write:!0}}}})})},"esri/symbols/SimpleFillSymbol":function(){define(["../core/declare","dojo/_base/lang","../core/lang","./FillSymbol","./SimpleLineSymbol"],function(A,p,w,l,h){var d={style:"solid",outline:new h,color:[0,0,0,.25]},u=A(l,{declaredClass:"esri.symbols.SimpleFillSymbol",properties:{color:{},type:"simple-fill",style:{value:"solid",type:String,json:{read:function(d){return w.valueOf(this._styles,d)||void 0},write:function(d,a){a.style=
this._styles[d]}}}},_styles:{solid:"esriSFSSolid",none:"esriSFSNull",horizontal:"esriSFSHorizontal",vertical:"esriSFSVertical","forward-diagonal":"esriSFSForwardDiagonal","backward-diagonal":"esriSFSBackwardDiagonal",cross:"esriSFSCross","diagonal-cross":"esriSFSDiagonalCross"},getDefaults:function(){return p.mixin(this.inherited(arguments),d)},normalizeCtorArgs:function(d,a,k){if(d&&"string"!=typeof d)return d;var c={};return d&&(c.style=d),a&&(c.outline=a),k&&(c.color=k),c},clone:function(){return new u({color:w.clone(this.color),
outline:this.outline&&this.outline.clone(),style:this.style})}});return p.mixin(u,{STYLE_SOLID:"solid",STYLE_NULL:"none",STYLE_HORIZONTAL:"horizontal",STYLE_VERTICAL:"vertical",STYLE_FORWARD_DIAGONAL:"forward-diagonal",STYLE_BACKWARD_DIAGONAL:"backward-diagonal",STYLE_CROSS:"cross",STYLE_DIAGONAL_CROSS:"diagonal-cross"}),u.defaultProps=d,u})},"esri/symbols/SimpleMarkerSymbol":function(){define("../core/declare dojo/_base/lang ../core/lang ../core/screenUtils ./MarkerSymbol ./SimpleLineSymbol".split(" "),
function(A,p,w,l,h,d){var u={style:"circle",color:[255,255,255,.25],outline:new d,size:12,angle:0,xoffset:0,yoffset:0},r=A(h,{declaredClass:"esri.symbols.SimpleMarkerSymbol",properties:{color:{json:{write:function(a,d){a&&"x"!==this.style&&"cross"!==this.style&&(d.color=a.toJSON())}}},type:"simple-marker",size:{value:12},style:{type:String,value:"circle",json:{read:function(a){return w.valueOf(this._styles,a)},write:function(a,d){d.style=this._styles[a]}}},path:{type:String,value:null,set:function(a){this.style=
"path";this._set("path",a)},json:{write:!0}},outline:{type:d,json:{write:!0}}},_styles:{circle:"esriSMSCircle",square:"esriSMSSquare",cross:"esriSMSCross",x:"esriSMSX",diamond:"esriSMSDiamond",path:"esriSMSPath"},getDefaults:function(){return p.mixin(this.inherited(arguments),u)},normalizeCtorArgs:function(a,d,c,h){if(a&&"string"!=typeof a)return a;var k={};return a&&(k.style=a),null!=d&&(k.size=l.toPt(d)),c&&(k.outline=c),h&&(k.color=h),k},clone:function(){return new r({angle:this.angle,color:w.clone(this.color),
outline:this.outline&&this.outline.clone(),size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})},read:function k(c,d){return this.getInherited(k,arguments).call(this,p.mixin({outline:null},c),d)}});return p.mixin(r,{STYLE_CIRCLE:"circle",STYLE_SQUARE:"square",STYLE_CROSS:"cross",STYLE_X:"x",STYLE_DIAMOND:"diamond",STYLE_PATH:"path",STYLE_TARGET:"target"}),r.defaultProps=u,r})},"esri/symbols/TextSymbol":function(){define("../core/declare dojo/_base/lang ../core/lang ../core/screenUtils ../Color ./Symbol ./Font".split(" "),
function(A,p,w,l,h,d,u){var r={text:"",rotated:!1,kerning:!0,color:[0,0,0,1],font:{},angle:0,xoffset:0,yoffset:0,horizontalAlignment:"center"},a=A(d,{declaredClass:"esri.symbols.TextSymbol",properties:{backgroundColor:{type:h,json:{write:!0}},borderLineColor:{type:h,json:{write:!0}},borderLineSize:{type:Number,json:{write:!0}},color:{},font:{type:u,json:{write:!0}},horizontalAlignment:{value:"center",json:{write:!0}},kerning:{value:!0,json:{write:!0}},haloColor:{type:h,json:{write:!0}},haloSize:{type:Number,
cast:l.toPt,json:{write:!0}},rightToLeft:{json:{write:!0}},rotated:{value:!1,json:{write:!0}},text:{type:String,json:{write:!0}},type:"text",verticalAlignment:{type:String,json:{write:!0}},xoffset:{value:0,type:Number,cast:l.toPt,json:{write:!0}},yoffset:{value:0,type:Number,cast:l.toPt,json:{write:!0}},angle:{type:Number,value:0,json:{read:function(a){return a&&-1*a},write:function(a,c){c.angle=a&&-1*a}}},width:{json:{write:!0}}},getDefaults:function(){return p.mixin(this.inherited(arguments),r)},
normalizeCtorArgs:function(a,c,d){if(a&&"string"!=typeof a)return a;var k={};return a&&(k.text=a),c&&(k.font=c),d&&(k.color=d),k},clone:function(){return new a({angle:this.angle,backgroundColor:w.clone(this.backgroundColor),borderLineColor:w.clone(this.borderLineColor),borderLineSize:this.borderLineSize,color:w.clone(this.color),font:this.font&&this.font.clone(),haloColor:w.clone(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,rightToLeft:this.rightToLeft,
rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}});return p.mixin(a,{ALIGN_START:"start",ALIGN_MIDDLE:"middle",ALIGN_END:"end",DECORATION_NONE:"none",DECORATION_UNDERLINE:"underline",DECORATION_OVERLINE:"overline",DECORATION_LINETHROUGH:"line-through"}),a.defaultProps=r,a})},"esri/symbols/Font":function(){define(["dojo/_base/lang","../core/JSONSupport","../core/lang","../core/screenUtils"],function(A,p,w,l){var h=
{style:"normal",weight:"normal",size:9,family:"serif",decoration:"none"},d=p.createSubclass({declaredClass:"esri.symbols.Font",properties:{decoration:{},family:{},size:{cast:l.toPt},style:{},weight:{}},getDefaults:function(){return h},normalizeCtorArgs:function(d,h,a,k){if(d&&"string"!=typeof d)return d;var c={};return null!=d&&(c.size=l.toPt(d)),null!=h&&(c.style=h),null!=a&&(c.weight=a),k&&(c.family=k),c},toJSON:function(){return w.fixJson({size:this.size,style:this.style,decoration:this.decoration,
weight:this.weight,family:this.family})},clone:function(){return new d({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}});return d.defaultProps=h,A.mixin(d,{STYLE_NORMAL:"normal",STYLE_ITALIC:"italic",STYLE_OBLIQUE:"oblique",WEIGHT_NORMAL:"normal",WEIGHT_BOLD:"bold",WEIGHT_BOLDER:"bolder",WEIGHT_LIGHTER:"lighter"}),d})},"esri/symbols/WebStyleSymbol":function(){define("require exports ../core/tsSupport/extendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ../core/urlUtils ../core/Logger ../core/requireUtils ./Symbol ../portal/Portal ./support/Thumbnail".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c){var t=u.getLogger("esri.symbols.WebStyleSymbol");return function(a){function q(c){c=a.call(this,c)||this;return c.styleName=null,c.portal=null,c.styleUrl=null,c.thumbnail=null,c.name=null,c.type="web-style",c}return w(q,a),v=q,q.prototype._readStyleUrl=function(a,c,k){return d.read(a,k)},q.prototype._writeStyleUrl=function(a,c,k,b){c.styleUrl=d.write(a,b);d.isAbsolute(c.styleUrl)&&(c.styleUrl=d.normalize(c.styleUrl))},q.prototype._writeType=function(a,c,d,b){c.type=
"styleSymbolReference"},q.prototype.read=function(a,c){return this.portal=c?c.portal:void 0,this.inherited(arguments,[a,c]),this},q.prototype.clone=function(){return new v({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})},q.prototype.fetchSymbol=function(){var a=this;return r.when(A,"./support/styleUtils").then(function(c){c=c.resolveWebStyleSymbol(a,{portal:a.portal});return c.otherwise(function(a){t.error("#fetchSymbol()","Failed to create symbol from style",
a)}),c})},l([h.property({json:{write:!1}})],q.prototype,"color",void 0),l([h.property({type:String,json:{write:!0}})],q.prototype,"styleName",void 0),l([h.property({type:k,json:{write:!1}})],q.prototype,"portal",void 0),l([h.property({type:String,json:{write:!0}})],q.prototype,"styleUrl",void 0),l([h.reader("styleUrl")],q.prototype,"_readStyleUrl",null),l([h.writer("styleUrl")],q.prototype,"_writeStyleUrl",null),l([h.property({type:c["default"],json:{read:!1}})],q.prototype,"thumbnail",void 0),l([h.property({type:String,
json:{write:!0}})],q.prototype,"name",void 0),l([h.property({type:String,readOnly:!0,json:{read:!1}})],q.prototype,"type",void 0),l([h.writer("type")],q.prototype,"_writeType",null),q=v=l([h.subclass("esri.symbols.WebStyleSymbol")],q);var v}(h.declared(a))})},"esri/symbols/support/Thumbnail":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor".split(" "),function(A,p,w,l,h,d){Object.defineProperty(p,
"__esModule",{value:!0});A=function(d){function r(){return null!==d&&d.apply(this,arguments)||this}return w(r,d),a=r,r.prototype.clone=function(){return new a({url:this.url})},l([h.property({type:String})],r.prototype,"url",void 0),r=a=l([h.subclass("esri.symbols.support.Thumbnail")],r);var a}(h.declared(d));p.Thumbnail=A;p["default"]=A})},"esri/symbols/LabelSymbol3D":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/Collection ./Symbol3D ./TextSymbol3DLayer ./support/Symbol3DVerticalOffset ./callouts/calloutUtils ../core/accessorSupport/decorators".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c){var t=d.ofType({base:null,key:"type",typeMap:{text:r}});return function(d){function q(a){a=d.call(this)||this;return a.verticalOffset=null,a.callout=null,a.symbolLayers=new t,a.type="label-3d",a}return w(q,d),v=q,q.prototype.supportsCallout=function(){return!0},q.prototype.hasVisibleCallout=function(){return k.hasVisibleCallout(this)},q.prototype.hasVisibleVerticalOffset=function(){return k.hasVisibleVerticalOffset(this)},q.prototype.clone=function(){return new v({styleOrigin:h.clone(this.styleOrigin),
symbolLayers:h.clone(this.symbolLayers),thumbnail:h.clone(this.thumbnail),callout:h.clone(this.callout),verticalOffset:h.clone(this.verticalOffset)})},l([c.property({type:a["default"],json:{write:!0}})],q.prototype,"verticalOffset",void 0),l([c.property(k.calloutProperty)],q.prototype,"callout",void 0),l([c.property({type:t})],q.prototype,"symbolLayers",void 0),l([c.property()],q.prototype,"type",void 0),q=v=l([c.subclass("esri.symbols.LabelSymbol3D")],q);var v}(c.declared(u))})},"esri/symbols/Symbol3D":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Collection ../core/Logger ../core/collectionUtils ../core/Warning ../core/urlUtils ../core/accessorSupport/metadata ./Symbol ./Symbol3DLayer ./IconSymbol3DLayer ./ObjectSymbol3DLayer ./LineSymbol3DLayer ./PathSymbol3DLayer ./FillSymbol3DLayer ./ExtrudeSymbol3DLayer ./TextSymbol3DLayer ./support/Thumbnail ./support/StyleOrigin ../portal/Portal ../core/accessorSupport/decorators".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E,J,G){var K={icon:C,object:q,line:v,path:y,fill:B,extrude:D,text:b},M=h.ofType({base:t,key:"type",typeMap:K}),U=d.getLogger("esri.symbols.Symbol3D");return function(b){function c(a){a=b.call(this)||this;a.styleOrigin=null;a.thumbnail=null;a.type=null;var m=k.getMetadata(a).properties.symbolLayers.type;return a._set("symbolLayers",new m),a}return w(c,b),Object.defineProperty(c.prototype,"color",{get:function(){return null},set:function(a){U.error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")},
enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"symbolLayers",{set:function(a){u.referenceSetter(a,this._get("symbolLayers"))},enumerable:!0,configurable:!0}),c.prototype.readSymbolLayers=function(a,b,m){b=[];for(var c=0;c<a.length;c++){var d=a[c],z=t.typeJSONDictionary.read(d.type),k=K[z];k?(d=new k,d.read(a[c],m),b.push(d)):(U.warn("Unknown symbol layer type: "+z),m&&m.messages&&m.messages.push(new r("symbol-layer:unsupported","Symbol layers of type '"+(z||"unknown")+"' are not supported",
{definition:d,context:m})))}return b},c.prototype.readStyleOrigin=function(b,m,c){return b.styleUrl&&b.name?(m=a.read(b.styleUrl,c),new E({styleUrl:m,name:b.name})):b.styleName&&b.name?new E({portal:c&&c.portal||J.getDefault(),styleName:b.styleName,name:b.name}):void(c&&c.messages&&c.messages.push(new r("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:c,definition:b})))},c.prototype.writeStyleOrigin=function(b,m,c,d){b.styleUrl&&
b.name?(c=a.write(b.styleUrl,d),a.isAbsolute(c)&&(c=a.normalize(c)),m.styleOrigin={styleUrl:c,name:b.name}):b.styleName&&b.name&&(b.portal&&d&&d.portal&&!a.hasSamePortal(b.portal.restUrl,d.portal.restUrl)?d&&d.messages&&d.messages.push(new r("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):m.styleOrigin={styleName:b.styleName,name:b.name})},c.prototype.normalizeCtorArgs=function(a){return a instanceof
t||a&&K[a.type]?{symbolLayers:[a]}:Array.isArray(a)?{symbolLayers:a}:a},l([G.property({json:{read:!1,write:!1}})],c.prototype,"color",null),l([G.property({type:M,nonNullable:!0,json:{write:!0}}),G.cast(u.castForReferenceSetter)],c.prototype,"symbolLayers",null),l([G.reader("symbolLayers")],c.prototype,"readSymbolLayers",null),l([G.property({type:E})],c.prototype,"styleOrigin",void 0),l([G.reader("styleOrigin")],c.prototype,"readStyleOrigin",null),l([G.writer("styleOrigin",{"styleOrigin.styleUrl":{type:String},
"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],c.prototype,"writeStyleOrigin",null),l([G.property({type:m["default"],json:{read:!1}})],c.prototype,"thumbnail",void 0),l([G.property({type:String,readOnly:!0,json:{read:!1}})],c.prototype,"type",void 0),c=l([G.subclass("esri.symbols.Symbol3D")],c)}(G.declared(c))})},"esri/core/collectionUtils":function(){define(["require","exports","./Collection"],function(A,p,w){Object.defineProperty(p,"__esModule",{value:!0});p.referenceSetter=
function(l,h,d){void 0===d&&(d=w);h||(h=new d);h.removeAll();return l&&(Array.isArray(l)||l.isInstanceOf&&l.isInstanceOf(w))?h.addMany(l):h.add(l),h};p.castForReferenceSetter=function(l){return l}})},"esri/symbols/Symbol3DLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/kebabDictionary ./support/Symbol3DMaterial ./support/ElevationInfo ../core/accessorSupport/decorators".split(" "),function(A,p,w,l,h,d,u,
r,a){var k=d({Icon:"icon",Object:"object",Line:"line",Path:"path",Fill:"fill",Extrude:"extrude",Text:"text"});A=function(c){function d(a){a=c.call(this)||this;return a.enabled=!0,a.material=null,a.type=null,a}return w(d,c),d.prototype.writeEnabled=function(a,c,d){a||(c[d]=a)},l([a.property({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],d.prototype,"enabled",void 0),l([a.writer("enabled")],d.prototype,"writeEnabled",null),l([a.property({type:r,json:{read:!1,write:!1}})],d.prototype,
"elevationInfo",void 0),l([a.property({type:u["default"],json:{write:!0}})],d.prototype,"material",void 0),l([a.property({type:String,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:k.write}}})],d.prototype,"type",void 0),d=l([a.subclass("esri.symbols.Symbol3DLayer")],d)}(a.declared(h));(A||(A={})).typeJSONDictionary=k;return A})},"esri/symbols/support/Symbol3DMaterial":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ./materialUtils ../../core/accessorSupport/decorators".split(" "),
function(A,p,w,l,h,d,u){Object.defineProperty(p,"__esModule",{value:!0});A=function(h){function a(){return null!==h&&h.apply(this,arguments)||this}return w(a,h),k=a,a.prototype.clone=function(){return new k({color:this.color?this.color.clone():null})},l([u.property(d.colorAndTransparencyProperty)],a.prototype,"color",void 0),a=k=l([u.subclass("esri.symbols.support.Symbol3DMaterial")],a);var k}(u.declared(h));p.Symbol3DMaterial=A;p["default"]=A})},"esri/symbols/support/materialUtils":function(){define(["require",
"exports","../../Color","../../core/screenUtils"],function(A,p,w,l){function h(a){return Math.max(0,Math.min(Math.round(100*(1-a)),100))}function d(a){return Math.max(0,Math.min(1-a/100,1))}function u(a,k){a=null!=k.transparency?d(k.transparency):1;return(k=k.color)&&Array.isArray(k)?new w([k[0]||0,k[1]||0,k[2]||0,a]):void 0}function r(a,d){d.color=a.toJSON().slice(0,3);a=h(a.a);0!==a&&(d.transparency=a)}Object.defineProperty(p,"__esModule",{value:!0});p.opacityToTransparency=h;p.transparencyToOpacity=
d;p.readColorAndTransparency=u;p.writeColorAndTransparency=r;p.colorAndTransparencyProperty={type:w,json:{type:[Number],read:{source:["color","transparency"],reader:u},write:{target:{color:{type:[Number]},transparency:{type:Number}},writer:r}}};p.screenSizeProperty={type:Number,cast:l.toPt,json:{write:!0}}})},"esri/symbols/support/ElevationInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/JSONSupport ../../core/kebabDictionary ../../support/arcadeUtils".split(" "),
function(A,p,w,l,h,d,u,r){var a=u({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),k=u({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"}),c=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return w(c,a),d=c,Object.defineProperty(c.prototype,"requiredFields",{get:function(){return r.extractFieldNames(this.expression)},enumerable:!0,configurable:!0}),
c.prototype.clone=function(){return new d({expression:this.expression})},l([h.property({type:String,json:{write:!0}})],c.prototype,"expression",void 0),l([h.property({readOnly:!0,dependsOn:["expression"]})],c.prototype,"requiredFields",null),c=d=l([h.subclass("esri.layers.support.FeatureExpressionInfo")],c);var d}(h.declared(d));return function(d){function t(){return null!==d&&d.apply(this,arguments)||this}return w(t,d),q=t,t.prototype.readFeatureExpressionInfo=function(a,c){return null!=a?a:c.featureExpression&&
0===c.featureExpression.value?{expression:"0"}:void 0},t.prototype.writeFeatureExpressionInfo=function(a,c,d,k){c[d]=a.write(null,k);"0"===a.expression&&(c.featureExpression={value:0})},Object.defineProperty(t.prototype,"mode",{get:function(){var a=this._get("mode");return a?a:null!=this.offset||this.featureExpressionInfo?"relative-to-ground":"on-the-ground"},set:function(a){this._set("mode",a)},enumerable:!0,configurable:!0}),t.prototype.write=function(a,c){return this.offset||this.mode||this.featureExpressionInfo||
this.unit?this.inherited(arguments):null},t.prototype.clone=function(){return new q({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})},l([h.property({type:c,json:{write:!0}})],t.prototype,"featureExpressionInfo",void 0),l([h.reader("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],t.prototype,"readFeatureExpressionInfo",null),l([h.writer("featureExpressionInfo")],t.prototype,"writeFeatureExpressionInfo",
null),l([h.property({type:String,dependsOn:["offset","featureExpressionInfo"],json:{read:a.read,write:{writer:a.write,isRequired:!0}}})],t.prototype,"mode",null),l([h.property({type:Number,json:{write:!0}})],t.prototype,"offset",void 0),l([h.property({type:String,json:{read:k.read,write:k.write}})],t.prototype,"unit",void 0),t=q=l([h.subclass("esri.layers.support.ElevationInfo")],t);var q}(h.declared(d))})},"esri/symbols/IconSymbol3DLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/kebabDictionary ../core/urlUtils ../core/accessorSupport/decorators ./Symbol3DLayer ./support/Symbol3DOutline ./support/Symbol3DResource ./support/materialUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c){var t=h({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right"},{ignoreUnknown:!0}),C=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return w(c,a),k=c,c.prototype.readHref=function(a,c,b){return a?d.read(a,b):c.dataURI},c.prototype.writeHref=function(a,c,b,m){a&&(d.isDataProtocol(a)?c.dataURI=a:(c.href=d.write(a,m),d.isAbsolute(c.href)&&
(c.href=d.normalize(c.href))))},c.prototype.clone=function(){return new k({href:this.href,primitive:this.primitive})},l([u.property({json:{write:!0,read:{source:["href","dataURI"]}}})],c.prototype,"href",void 0),l([u.reader("href")],c.prototype,"readHref",null),l([u.writer("href")],c.prototype,"writeHref",null),c=k=l([u.subclass("esri.symbols.support.IconSymbol3DLayerResource")],c);var k}(u.declared(k["default"]));return function(d){function k(a){a=d.call(this)||this;return a.material=null,a.resource=
null,a.type="icon",a.size=12,a.anchor=void 0,a.outline=void 0,a}return w(k,d),q=k,k.prototype.clone=function(){return new q({anchor:this.anchor,enabled:this.enabled,elevationInfo:this.elevationInfo&&this.elevationInfo.clone(),material:this.material&&this.material.clone(),outline:this.outline&&this.outline.clone(),resource:this.resource&&this.resource.clone(),size:this.size})},l([u.property()],k.prototype,"material",void 0),l([u.property({type:C,json:{write:!0}})],k.prototype,"resource",void 0),l([u.property()],
k.prototype,"type",void 0),l([u.property(c.screenSizeProperty)],k.prototype,"size",void 0),l([u.property({type:String,json:{read:t.read,write:t.write}})],k.prototype,"anchor",void 0),l([u.property({type:a["default"],json:{write:!0}})],k.prototype,"outline",void 0),k=q=l([u.subclass("esri.symbols.IconSymbol3DLayer")],k);var q}(u.declared(r))})},"esri/symbols/support/Symbol3DOutline":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../Color ./materialUtils ../../core/accessorSupport/decorators".split(" "),
function(A,p,w,l,h,d,u,r){Object.defineProperty(p,"__esModule",{value:!0});A=function(a){function k(){var c=null!==a&&a.apply(this,arguments)||this;return c.color=new d([0,0,0,1]),c.size=1,c}return w(k,a),c=k,k.prototype.clone=function(){return new c({color:this.color?this.color.clone():null,size:this.size})},l([r.property(u.colorAndTransparencyProperty)],k.prototype,"color",void 0),l([r.property(u.screenSizeProperty)],k.prototype,"size",void 0),k=c=l([r.subclass("esri.symbols.support.Symbol3DOutline")],
k);var c}(r.declared(h));p.Symbol3DOutline=A;p["default"]=A})},"esri/symbols/support/Symbol3DResource":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/urlUtils ../../core/JSONSupport ../../core/kebabDictionary ../../core/accessorSupport/decorators".split(" "),function(A,p,w,l,h,d,u,r){Object.defineProperty(p,"__esModule",{value:!0});var a=u({invertedCone:"inverted-cone"});A=function(d){function c(){return null!==d&&d.apply(this,
arguments)||this}return w(c,d),k=c,c.prototype.readHref=function(a,c,d){return h.read(a,d)},c.prototype.writeHref=function(a,c,d,k){a&&(c.href=h.write(a,k),h.isAbsolute(c.href)&&(c.href=h.normalize(c.href)))},c.prototype.readPrimitive=function(c){return a.fromJSON(c)},c.prototype.writePrimitive=function(c,d){d.primitive=a.toJSON(c)},c.prototype.clone=function(){return new k({href:this.href,primitive:this.primitive})},l([r.property({type:String,json:{write:!0}})],c.prototype,"href",void 0),l([r.reader("href")],
c.prototype,"readHref",null),l([r.writer("href")],c.prototype,"writeHref",null),l([r.property({type:String,json:{write:!0}})],c.prototype,"primitive",void 0),l([r.reader("primitive")],c.prototype,"readPrimitive",null),l([r.writer("primitive")],c.prototype,"writePrimitive",null),c=k=l([r.subclass("esri.symbols.support.Symbol3DResource")],c);var k}(r.declared(d));p.Symbol3DResource=A;p["default"]=A})},"esri/symbols/ObjectSymbol3DLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/kebabDictionary ./Symbol3DLayer ./support/Symbol3DMaterial ./support/Symbol3DResource ../core/accessorSupport/decorators".split(" "),
function(A,p,w,l,h,d,u,r,a){var k=h({center:"center",top:"top",bottom:"bottom",origin:"origin"},{ignoreUnknown:!0});return function(c){function d(a){a=c.call(this)||this;return a.material=null,a.resource=null,a.type="object",a.width=void 0,a.height=void 0,a.depth=void 0,a.anchor=void 0,a.heading=void 0,a.tilt=void 0,a.roll=void 0,a}return w(d,c),h=d,d.prototype.clone=function(){return new h({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,depth:this.depth,enabled:this.enabled,
elevationInfo:this.elevationInfo&&this.elevationInfo.clone(),height:this.height,material:this.material&&this.material.clone(),resource:this.resource&&this.resource.clone(),width:this.width})},Object.defineProperty(d.prototype,"isPrimitive",{get:function(){return!this.resource||"string"!=typeof this.resource.href},enumerable:!0,configurable:!0}),l([a.property({type:u["default"]})],d.prototype,"material",void 0),l([a.property({type:r["default"],json:{write:!0}})],d.prototype,"resource",void 0),l([a.property()],
d.prototype,"type",void 0),l([a.property({type:Number,json:{write:!0}})],d.prototype,"width",void 0),l([a.property({type:Number,json:{write:!0}})],d.prototype,"height",void 0),l([a.property({type:Number,json:{write:!0}})],d.prototype,"depth",void 0),l([a.property({type:String,json:{read:k.read,write:k.write}})],d.prototype,"anchor",void 0),l([a.property({type:Number,json:{write:!0}})],d.prototype,"heading",void 0),l([a.property({type:Number,json:{write:!0}})],d.prototype,"tilt",void 0),l([a.property({type:Number,
json:{write:!0}})],d.prototype,"roll",void 0),l([a.property({readOnly:!0,dependsOn:["resource","resource.href"]})],d.prototype,"isPrimitive",null),d=h=l([a.subclass("esri.symbols.ObjectSymbol3DLayer")],d);var h}(a.declared(d))})},"esri/symbols/LineSymbol3DLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ./Symbol3DLayer ./support/materialUtils ../core/accessorSupport/decorators".split(" "),function(A,p,w,l,h,d,u){return function(h){function a(a){a=
h.call(this)||this;return a.material=null,a.type="line",a.size=1,a}return w(a,h),k=a,a.prototype.clone=function(){return new k({enabled:this.enabled,elevationInfo:this.elevationInfo&&this.elevationInfo.clone(),material:this.material&&this.material.clone(),size:this.size})},l([u.property()],a.prototype,"material",void 0),l([u.property()],a.prototype,"type",void 0),l([u.property(d.screenSizeProperty)],a.prototype,"size",void 0),a=k=l([u.subclass("esri.symbols.LineSymbol3DLayer")],a);var k}(u.declared(h))})},
"esri/symbols/PathSymbol3DLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ./Symbol3DLayer ../core/accessorSupport/decorators".split(" "),function(A,p,w,l,h,d){return function(h){function r(a){a=h.call(this)||this;return a.material=null,a.type="path",a.size=void 0,a}return w(r,h),a=r,r.prototype.readSize=function(a,c){return a||c.width||0},r.prototype.clone=function(){return new a({enabled:this.enabled,elevationInfo:this.elevationInfo&&
this.elevationInfo.clone(),material:this.material&&this.material.clone(),size:this.size})},l([d.property()],r.prototype,"material",void 0),l([d.property()],r.prototype,"type",void 0),l([d.property({type:Number,json:{write:!0}})],r.prototype,"size",void 0),l([d.reader("size",["size","width"])],r.prototype,"readSize",null),r=a=l([d.subclass("esri.symbols.PathSymbol3DLayer")],r);var a}(d.declared(h))})},"esri/symbols/FillSymbol3DLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ./Symbol3DLayer ./support/Symbol3DOutline ./support/Symbol3DFillMaterial ../core/accessorSupport/decorators".split(" "),
function(A,p,w,l,h,d,u,r){return function(a){function k(c){c=a.call(this)||this;return c.type="fill",c.material=null,c.outline=null,c}return w(k,a),c=k,k.prototype.clone=function(){return new c({enabled:this.enabled,elevationInfo:this.elevationInfo&&this.elevationInfo.clone(),material:this.material&&this.material.clone(),outline:this.outline&&this.outline.clone()})},l([r.property()],k.prototype,"type",void 0),l([r.property({type:u["default"]})],k.prototype,"material",void 0),l([r.property({type:d["default"],
json:{write:!0}})],k.prototype,"outline",void 0),k=c=l([r.subclass("esri.symbols.FillSymbol3DLayer")],k);var c}(r.declared(h))})},"esri/symbols/support/Symbol3DFillMaterial":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ./Symbol3DMaterial ../../core/accessorSupport/decorators".split(" "),function(A,p,w,l,h,d){Object.defineProperty(p,"__esModule",{value:!0});A=function(h){function r(){return null!==h&&h.apply(this,arguments)||this}
return w(r,h),a=r,r.prototype.clone=function(){return new a({color:this.color?this.color.clone():null,colorMixMode:this.colorMixMode})},l([d.property({type:String,json:{read:!0,write:!0}})],r.prototype,"colorMixMode",void 0),r=a=l([d.subclass("esri.symbols.support.Symbol3DFillMaterial")],r);var a}(d.declared(h["default"]));p.Symbol3DFillMaterial=A;p["default"]=A})},"esri/symbols/ExtrudeSymbol3DLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ./Symbol3DLayer ../core/accessorSupport/decorators".split(" "),
function(A,p,w,l,h,d){return function(h){function r(a){a=h.call(this)||this;return a.type="extrude",a.size=void 0,a.material=null,a}return w(r,h),a=r,r.prototype.clone=function(){return new a({enabled:this.enabled,elevationInfo:this.elevationInfo&&this.elevationInfo.clone(),material:this.material&&this.material.clone(),size:this.size})},l([d.property()],r.prototype,"type",void 0),l([d.property({type:Number,json:{write:!0}})],r.prototype,"size",void 0),l([d.property()],r.prototype,"material",void 0),
r=a=l([d.subclass("esri.symbols.ExtrudeSymbol3DLayer")],r);var a}(d.declared(h))})},"esri/symbols/TextSymbol3DLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ./Symbol3DLayer ./support/Symbol3DHalo ./support/materialUtils ../core/accessorSupport/decorators".split(" "),function(A,p,w,l,h,d,u,r,a){return function(d){function c(a){a=d.call(this)||this;return a.font=null,a.halo=null,a.material=null,a.size=void 0,a.text=void 0,
a.type="text",a}return w(c,d),k=c,c.prototype.writeFont=function(a,c){a&&(c.font=h.clone(a))},c.prototype.clone=function(){return new k({enabled:this.enabled,elevationInfo:this.elevationInfo&&this.elevationInfo.clone(),font:this.font&&h.clone(this.font),halo:this.halo&&h.clone(this.halo),material:this.material&&this.material.clone(),size:this.size,text:this.text})},l([a.property()],c.prototype,"font",void 0),l([a.writer("font",{"font.family":{type:String},"font.weight":{type:String},"font.style":{type:String}})],
c.prototype,"writeFont",null),l([a.property({type:u["default"],json:{write:!0}})],c.prototype,"halo",void 0),l([a.property()],c.prototype,"material",void 0),l([a.property(r.screenSizeProperty)],c.prototype,"size",void 0),l([a.property({type:String,json:{write:!0}})],c.prototype,"text",void 0),l([a.property()],c.prototype,"type",void 0),c=k=l([a.subclass("esri.symbols.TextSymbol3DLayer")],c);var k}(a.declared(d))})},"esri/symbols/support/Symbol3DHalo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Color ../../core/JSONSupport ../../core/lang ./materialUtils ../../core/accessorSupport/decorators".split(" "),
function(A,p,w,l,h,d,u,r,a){Object.defineProperty(p,"__esModule",{value:!0});A=function(d){function c(){var a=null!==d&&d.apply(this,arguments)||this;return a.color=new h([0,0,0,1]),a.size=0,a}return w(c,d),k=c,c.prototype.clone=function(){return new k({color:u.clone(this.color),size:this.size})},l([a.property(r.colorAndTransparencyProperty)],c.prototype,"color",void 0),l([a.property(r.screenSizeProperty)],c.prototype,"size",void 0),c=k=l([a.subclass("esri.symbols.support.Symbol3DHalo")],c);var k}(a.declared(d));
p.Symbol3DHalo=A;p["default"]=A})},"esri/symbols/support/StyleOrigin":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor ../../portal/Portal".split(" "),function(A,p,w,l,h,d,u){return function(d){function a(){var a=null!==d&&d.apply(this,arguments)||this;return a.portal=null,a}return w(a,d),k=a,a.prototype.clone=function(){return new k({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,
portal:this.portal})},l([h.property({type:String})],a.prototype,"name",void 0),l([h.property({type:String})],a.prototype,"styleUrl",void 0),l([h.property({type:String})],a.prototype,"styleName",void 0),l([h.property({type:u})],a.prototype,"portal",void 0),a=k=l([h.subclass("esri.symbols.support.StyleOrigin")],a);var k}(h.declared(d))})},"esri/symbols/support/Symbol3DVerticalOffset":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ./materialUtils".split(" "),
function(A,p,w,l,h,d,u){Object.defineProperty(p,"__esModule",{value:!0});A=function(h){function a(){var a=null!==h&&h.apply(this,arguments)||this;return a.screenLength=0,a.minWorldLength=0,a}return w(a,h),k=a,a.prototype.writeMinWorldLength=function(a,d,k){a&&(d[k]=a)},a.prototype.clone=function(){return new k({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})},l([d.property(u.screenSizeProperty)],a.prototype,"screenLength",void 0),l([d.property({type:Number,
json:{write:!0}})],a.prototype,"minWorldLength",void 0),l([d.writer("minWorldLength")],a.prototype,"writeMinWorldLength",null),l([d.property({type:Number,json:{write:!0}})],a.prototype,"maxWorldLength",void 0),a=k=l([d.subclass("esri.symbols.support.Symbol3DVerticalOffset")],a);var k}(d.declared(h));p.Symbol3DVerticalOffset=A;p["default"]=A})},"esri/symbols/callouts/calloutUtils":function(){define(["require","exports","./Callout3D","./LineCallout3D"],function(A,p,w,l){function h(d){return d?(d=d.verticalOffset)?
0>=d.screenLength||0>=d.maxWorldLength?!1:!0:!1:!1}function d(d,h,a){if(!d)return d;switch(d.type){case "line":return h=new l,h.read(d,a),h}}Object.defineProperty(p,"__esModule",{value:!0});p.hasVisibleVerticalOffset=h;p.hasVisibleCallout=function(d){if(!d||!d.supportsCallout||!d.supportsCallout())return!1;var l=d.callout;return l&&l.visible&&h(d)?!0:!1};p.isCalloutSupport=function(d){return"point-3d"===d.type||"label-3d"===d.type};p.read=d;p.calloutProperty={types:{key:"type",base:w,typeMap:{line:l}},
json:{read:d,write:!0}}})},"esri/symbols/callouts/Callout3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/_base/lang ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(A,p,w,l,h,d,u){return function(d){function a(a){a=d.call(this)||this;return a.visible=!0,a}return w(a,d),a.prototype.normalizeCtorArgs=function(a){return a&&a.type?(a=h.mixin({},a),delete a.type,a):a},a.prototype.clone=function(){},
l([u.property({type:String,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],a.prototype,"type",void 0),l([u.property({readOnly:!0})],a.prototype,"visible",void 0),a=l([u.subclass("esri.symbols.callouts.Callout3D")],a)}(u.declared(d))})},"esri/symbols/callouts/LineCallout3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Color ../../core/lang ../../core/screenUtils ../../core/accessorSupport/decorators ./Callout3D ../support/materialUtils ./LineCallout3DBorder".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c){return function(a){function t(c){c=a.call(this)||this;return c.type="line",c.color=new h([0,0,0,1]),c.size=u.px2pt(1),c.border=null,c}return w(t,a),q=t,Object.defineProperty(t.prototype,"visible",{get:function(){return 0<this.size&&0<this.color.a},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new q({color:d.clone(this.color),size:this.size,border:d.clone(this.border)})},l([r.property({type:String})],t.prototype,"type",void 0),l([r.property(k.colorAndTransparencyProperty)],
t.prototype,"color",void 0),l([r.property(k.screenSizeProperty)],t.prototype,"size",void 0),l([r.property({type:c["default"],json:{write:!0}})],t.prototype,"border",void 0),l([r.property({dependsOn:["size","color"],readOnly:!0})],t.prototype,"visible",null),t=q=l([r.subclass("esri.symbols.callouts.LineCallout3D")],t);var q}(r.declared(a))})},"esri/symbols/callouts/LineCallout3DBorder":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Color ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../support/materialUtils".split(" "),
function(A,p,w,l,h,d,u,r,a){Object.defineProperty(p,"__esModule",{value:!0});A=function(d){function c(){var a=null!==d&&d.apply(this,arguments)||this;return a.color=new h("white"),a}return w(c,d),k=c,c.prototype.clone=function(){return new k({color:u.clone(this.color)})},l([r.property(a.colorAndTransparencyProperty)],c.prototype,"color",void 0),c=k=l([r.subclass("esri.symbols.support.LineCallout3DBorder")],c);var k}(r.declared(d));p.LineCallout3DBorder=A;p["default"]=A})},"esri/symbols/LineSymbol3D":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/Collection ./Symbol3D ./LineSymbol3DLayer ./PathSymbol3DLayer ./TextSymbol3DLayer ../core/accessorSupport/decorators".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c){var t=d.ofType({base:null,key:"type",typeMap:{line:r,text:k,path:a}});return function(a){function d(c){c=a.call(this)||this;return c.symbolLayers=new t,c.type="line-3d",c}return w(d,a),k=d,d.prototype.clone=function(){return new k({styleOrigin:h.clone(this.styleOrigin),symbolLayers:h.clone(this.symbolLayers),thumbnail:h.clone(this.thumbnail)})},l([c.property({type:t})],d.prototype,"symbolLayers",void 0),l([c.property()],d.prototype,"type",void 0),d=k=l([c.subclass("esri.symbols.LineSymbol3D")],
d);var k}(c.declared(u))})},"esri/symbols/MeshSymbol3D":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/Collection ./Symbol3D ./FillSymbol3DLayer ../core/accessorSupport/decorators".split(" "),function(A,p,w,l,h,d,u,r,a){var k=d.ofType({base:null,key:"type",typeMap:{fill:r}});return function(c){function d(a){a=c.call(this)||this;return a.symbolLayers=new k,a.type="mesh-3d",a}return w(d,c),r=d,d.prototype.clone=function(){return new r({styleOrigin:h.clone(this.styleOrigin),
symbolLayers:h.clone(this.symbolLayers),thumbnail:h.clone(this.thumbnail)})},l([a.property({type:k})],d.prototype,"symbolLayers",void 0),l([a.property()],d.prototype,"type",void 0),d=r=l([a.subclass("esri.symbols.MeshSymbol3D")],d);var r}(a.declared(u))})},"esri/symbols/PointSymbol3D":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/Collection ./Symbol3D ./IconSymbol3DLayer ./ObjectSymbol3DLayer ./TextSymbol3DLayer ./support/Symbol3DVerticalOffset ./callouts/calloutUtils ../core/accessorSupport/decorators".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C){var q=d.ofType({base:null,key:"type",typeMap:{icon:r,object:a,text:k}});return function(a){function d(c){c=a.call(this)||this;return c.verticalOffset=null,c.callout=null,c.symbolLayers=new q,c.type="point-3d",c}return w(d,a),k=d,d.prototype.supportsCallout=function(){if(1!==(this.symbolLayers?this.symbolLayers.length:0))return!1;switch(this.symbolLayers.getItemAt(0).type){case "icon":case "text":case "object":return!0}return!1},d.prototype.hasVisibleCallout=function(){return t.hasVisibleCallout(this)},
d.prototype.hasVisibleVerticalOffset=function(){return t.hasVisibleVerticalOffset(this)},d.prototype.clone=function(){return new k({verticalOffset:h.clone(this.verticalOffset),callout:h.clone(this.callout),styleOrigin:h.clone(this.styleOrigin),symbolLayers:h.clone(this.symbolLayers),thumbnail:h.clone(this.thumbnail)})},l([C.property({type:c["default"],json:{write:!0}})],d.prototype,"verticalOffset",void 0),l([C.property(t.calloutProperty)],d.prototype,"callout",void 0),l([C.property({type:q})],d.prototype,
"symbolLayers",void 0),l([C.property()],d.prototype,"type",void 0),d=k=l([C.subclass("esri.symbols.PointSymbol3D")],d);var k}(C.declared(u))})},"esri/symbols/PolygonSymbol3D":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/Collection ./Symbol3D ./ExtrudeSymbol3DLayer ./FillSymbol3DLayer ./IconSymbol3DLayer ./LineSymbol3DLayer ./ObjectSymbol3DLayer ./TextSymbol3DLayer ../core/accessorSupport/decorators".split(" "),function(A,
p,w,l,h,d,u,r,a,k,c,t,C,q){var v=d.ofType({base:null,key:"type",typeMap:{extrude:r,fill:a,icon:k,line:c,object:t,text:C}});return function(a){function c(b){b=a.call(this)||this;return b.type="polygon-3d",b}return w(c,a),d=c,c.prototype.clone=function(){return new d({styleOrigin:h.clone(this.styleOrigin),symbolLayers:h.clone(this.symbolLayers),thumbnail:h.clone(this.thumbnail)})},c.fromJSON=function(a){var b=new d;if(b.read(a),2===b.symbolLayers.length&&"fill"===b.symbolLayers.getItemAt(0).type&&"line"===
b.symbolLayers.getItemAt(1).type){var c=b.symbolLayers.getItemAt(0),k=b.symbolLayers.getItemAt(1);!k.enabled||a.symbolLayers&&a.symbolLayers[1]&&!1===a.symbolLayers[1].enable||(c.outline={size:k.size,color:k.material.color});b.symbolLayers.removeAt(1)}return b},l([q.property({type:v})],c.prototype,"symbolLayers",void 0),l([q.property()],c.prototype,"type",void 0),c=d=l([q.subclass("esri.symbols.PolygonSymbol3D")],c);var d}(q.declared(u))})},"esri/symbols/support/jsonUtils":function(){define("require exports ../../core/Error ../../core/Warning ../Symbol3D ../SimpleLineSymbol ../SimpleMarkerSymbol ../PictureMarkerSymbol ../PictureFillSymbol ../SimpleFillSymbol ../TextSymbol ../PointSymbol3D ../LineSymbol3D ../PolygonSymbol3D ../MeshSymbol3D ../LabelSymbol3D ../WebStyleSymbol ../callouts/LineCallout3D ./symbolConversion".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b){function m(a,m,c){if(!a)return null;if(!c||"web-scene"!==c.origin||a.isInstanceOf(h)||a.isInstanceOf(B))return a.write(m,c);var d=b.to3D(a);return d.symbol?d.symbol.write(m,c):(c.messages&&c.messages.push(new w("symbol:unsupported","Symbols of type '"+a.declaredClass+"' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView",{symbol:a,context:c,error:d.error})),null)}Object.defineProperty(p,"__esModule",{value:!0});
var E={esriSMS:u,esriPMS:r,esriTS:c,esriSLS:d,esriSFS:k,esriPFS:a,PointSymbol3D:t,LineSymbol3D:C,PolygonSymbol3D:q,MeshSymbol3D:v,LabelSymbol3D:y,styleSymbolReference:B};p.read=function(a,b,m){return(b=a?E[a.type]||null:null)?(b=new b,b.read(a,m),b):(m&&m.messages&&a&&m.messages.push(new l("symbol:unsupported","Symbols of type '"+(a.type||"unknown")+"' are not supported",{definition:a,context:m})),null)};p.writeTarget=function(a,b,c,d){(a=m(a,{},d))&&(b[c]=a)};p.write=m;p.fromJSON=function(a,b){var m=
a?E[a.type]||null:null;return m?m.fromJSON(a,b):null};p.readCallout3D=function(a,b){if(!a||!a.type)return null;var m=null;switch(a.type){case "line":m=new D}return m&&m.read(a,b),m}})},"esri/symbols/support/symbolConversion":function(){define("require exports dojo/_base/lang ../../core/lang ../../core/Error ../Font ../SimpleLineSymbol ../SimpleMarkerSymbol ../PictureMarkerSymbol ../SimpleFillSymbol ../TextSymbol ../WebStyleSymbol ../Symbol3D ../LineSymbol3D ../PointSymbol3D ../PolygonSymbol3D ../LabelSymbol3D ../LineSymbol3DLayer ../IconSymbol3DLayer ../FillSymbol3DLayer ../TextSymbol3DLayer ../../Color".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E,J){function G(m){var c,d,k,q=m.color?m.color.clone():new J([255,255,255]);m instanceof a?(m.color&&0===m.color.r&&0===m.color.g&&0===m.color.b&&(q=new J([255,255,255])),c={href:m.url},d=m.width<=m.height?m.height:m.width):(c=m.style,c={primitive:c in K?K[c]:(console.log(c+' cannot be mapped to Icon symbol. Fallback to "circle"'),"circle")},d=m.size,m.outline&&m.outline.color&&0<m.outline.width&&(k={size:m.outline.width,color:m.outline.color.clone()}));
return new v(new b({size:d,resource:c,material:{color:q},outline:k}))}Object.defineProperty(p,"__esModule",{value:!0});var K={};K[r.STYLE_CIRCLE]="circle";K[r.STYLE_CROSS]="cross";K[r.STYLE_DIAMOND]="kite";K[r.STYLE_SQUARE]="square";K[r.STYLE_X]="x";p.to3D=function(b,J,K,p){if(void 0===J&&(J=!1),void 0===K&&(K=!1),void 0===p&&(p=!0),!b)return{symbol:null};if(b instanceof C||b instanceof t)p=b.clone();else if(b instanceof u)p=new q(new D({size:b.width||1,material:{color:b.color?b.color.clone():[255,
255,255]}}));else if(b instanceof r)p=G(b);else if(b instanceof a)p=G(b);else if(b instanceof k)p=new m({material:{color:b.color?b.color.clone():[255,255,255]}}),p=(b.outline&&b.outline.color&&(p.outline={size:b.outline.width||0,color:b.outline.color}),new y(p));else{if(!(b instanceof c))return{error:new h("symbol-conversion:unsupported-2d-symbol","2D symbol of type '"+(b.type||b.declaredClass)+"' is unsupported in 3D",{symbol:b})};var M=w.clone(d.defaultProps);b.font&&w.mixin(M,b.font);var U;U=b.haloColor;
var N=b.haloSize;U=U&&0<N?{color:l.clone(U),size:N}:null;p=new (p?B:v)(new E({size:M.size,font:{family:M.family,weight:M.weight,style:M.style},halo:U,material:{color:b.color.clone()},text:b.text}))}if(J&&(p.id=b.id),K&&p.isInstanceOf(C))for(b=0;b<p.symbolLayers.length;++b)p.symbolLayers.getItemAt(b)._ignoreDrivers=!0;return{symbol:p}}})},"esri/geometry":function(){define("require exports ./geometry/Extent ./geometry/Multipoint ./geometry/Point ./geometry/Polygon ./geometry/Polyline ./geometry/SpatialReference ./geometry/ScreenPoint ./geometry/Geometry ./geometry/support/jsonUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c){Object.defineProperty(p,"__esModule",{value:!0});p.Extent=w;p.Multipoint=l;p.Point=h;p.Polygon=d;p.Polyline=u;p.SpatialReference=r;p.ScreenPoint=a;p.BaseGeometry=k;p.isGeometry=function(a){return a instanceof p.BaseGeometry};p.fromJSON=c.fromJSON})},"esri/geometry/ScreenPoint":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/accessorSupport/decorators".split(" "),function(A,p,w,l,h,d){return function(h){function r(){for(var a=
[],c=0;c<arguments.length;c++)a[c]=arguments[c];a=h.apply(this,a)||this;return a.x=0,a.y=0,a.z=void 0,a}return w(r,h),a=r,r.prototype.normalizeCtorArgs=function(a,c){return"number"==typeof a?{x:a,y:c}:Array.isArray(a)?{x:a[0],y:a[1]}:a},r.prototype.clone=function(){return new a({x:this.x,y:this.y,z:this.z})},r.prototype.toArray=function(){return null==this.z?[this.x,this.y]:[this.x,this.y,this.z]},l([d.property({type:Number})],r.prototype,"x",void 0),l([d.property({type:Number})],r.prototype,"y",
void 0),l([d.property({type:Number})],r.prototype,"z",void 0),r=a=l([d.subclass("esri.geometry.ScreenPoint")],r);var a}(d.declared(h))})},"esri/geometry/support/typeUtils":function(){define("require exports ../../core/accessorSupport/ensureType ../Geometry ../Extent ../Multipoint ../Point ../Polyline ../Polygon".split(" "),function(A,p,w,l,h,d,u,r,a){Object.defineProperty(p,"__esModule",{value:!0});p.types={base:l,key:"type",typeMap:{extent:h,multipoint:d,point:u,polyline:r,polygon:a}};p.ensureType=
w.ensureOneOfType(p.types)})},"esri/core/CollectionFlattener":function(){define("require exports ./tsSupport/declareExtendsHelper ./tsSupport/decorateHelper ./accessorSupport/decorators ./Collection ./HandleRegistry".split(" "),function(A,p,w,l,h,d,u){return function(r){function a(a){a=r.call(this)||this;return a._handles=new u,a.root=null,a.refresh=a.refresh.bind(a),a.updateCollections=a.updateCollections.bind(a),a}return w(a,r),a.prototype.initialize=function(){var a=this;this._handles.add(this.rootCollectionNames.map(function(c){return a.watch("root."+
c,a.updateCollections,!0)}));this.updateCollections()},a.prototype.destroy=function(){this.root=null;this.refresh();this._handles.destroy();this._handles=null},a.prototype.updateCollections=function(){var a=this;this._collections=this.rootCollectionNames.map(function(c){return a.get("root."+c)}).filter(function(a){return null!=a});this.refresh()},a.prototype.refresh=function(){var a=this._handles;a.remove("collections");this.removeAll();for(var c=this._collections.slice(),d=0,h=this._collections;d<
h.length;d++)this._processCollection(c,this,h[d]);for(d=0;d<c.length;d++)a.add(c[d].on("after-changes",this.refresh),"collections")},a.prototype._createNewInstance=function(a){return new d(a)},a.prototype._processCollection=function(a,c,d){var k=this;d&&(a.push(d),d.forEach(function(d){d&&(c.push(d),k._processCollection(a,c,k.getChildrenFunction(d)))}))},l([h.property()],a.prototype,"rootCollectionNames",void 0),l([h.property()],a.prototype,"root",void 0),l([h.property()],a.prototype,"getChildrenFunction",
void 0),a=l([h.subclass("esri.core.CollectionFlattener")],a)}(h.declared(d))})},"esri/views/LayerViewManager":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ../core/Accessor ../core/Error ../core/HandleRegistry ../core/Scheduler ../core/promiseUtils ../core/watchUtils ./LayerViewFactory".split(" "),function(A,p,w,l,h,d,u,r,a,k,c,t){return function(d){function q(){var a=d.call(this)||this;return a._promisesMap=
new Map,a._layerViewsMap=new Map,a._handles=new r,a.factory=new t,a.ready=!1,a.layersToLayerViews=function(){var a=new Map;return a.set("view.map.basemap.baseLayers","view.basemapView.baseLayerViews"),a.set("view.map.ground.layers","view.groundView.layerViews"),a.set("view.map.layers","view.layerViews"),a.set("view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"),a}(),a._doWork=a._doWork.bind(a),a.refresh=a.refresh.bind(a),a._handles.add(c.init(a,"view.ready",function(c){return a.ready=
c})),a._handles.add(a.watch(["view.map.basemap","view.map.ground","view.map.layers","ready"],a.refresh),"watcher"),a}return w(q,d),q.prototype.destroy=function(){this._handles&&(this.empty(),this.view=null,this.factory.destroy(),this.factory=null,this._handles.destroy(),this._handles=null,this._promisesMap=null,this._layerViewsMap=null,this._map=null)},q.prototype.empty=function(){this._layerViewsMap.forEach(this._disposeLayerView,this);this._promisesMap.forEach(function(a){return a.cancel()});this._layerViewsMap.clear();
this._promisesMap.clear();this._refreshCollections()},q.prototype.refresh=function(){var c=this._handles;c.remove("refresh");c.add(a.schedule(this._doWork),"refresh")},q.prototype.whenLayerView=function(a){return this.refresh(),this._doWork(),this._promisesMap.has(a)?this._promisesMap.get(a):k.reject(new u("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:a}))},q.prototype._doWork=function(){var a=this,c=this._handles,d=this.get("view.map");if(this._map!==d&&(this.empty(),
this._map=d),c.has("refresh")){c.remove("refresh");c.remove("collection-change");this.factory.paused=!this.ready;var k=this._map&&this._map.allLayers;k&&(k.forEach(this._createLayerView,this),this._refreshCollections(),this._promisesMap.forEach(function(b,m){k.includes(m)||a._disposeLayerView(a._layerViewsMap.get(m),m)}),c.add(k.on("change",this.refresh),"collection-change"))}},q.prototype._refreshCollections=function(){var a=this;this.layersToLayerViews.forEach(function(c,d){a._populateLayerViewsOwners(a.get(d),
a.get(c),a.view)})},q.prototype._populateLayerViewsOwners=function(a,c,d){var k=this;if(!a||!c)return void(c&&c.removeAll());var b=0;a.forEach(function(a){var m=k._layerViewsMap.get(a);m&&(m.layer=a,m.parent=d,c.getItemAt(b)!==m&&c.splice(b,0,m),a.layers&&k._populateLayerViewsOwners(a.layers,m.layerViews,m),b+=1)});b<c.length&&c.splice(b,c.length)},q.prototype._createLayerView=function(a){var c=this,d=this.view,k=this.factory,b=this._layerViewsMap,m=this._promisesMap;if(b.has(a))return void a.load();
m.has(a)||(k=k.create(d,a).then(function(m){if(!c._map||!c._map.allLayers.some(function(b){return a===b}))throw new u("view:no-layerview-for-layer","The layer has been removed from the map",{layer:a});return b.set(a,m),c._refreshCollections(),a.emit("layerview-create",{view:d,layerView:m}),d.emit("layerview-create",{layer:a,layerView:m}),m.when()}),m.set(a,k),k.always(this.refresh))},q.prototype._disposeLayerView=function(a,c){if(this._promisesMap.has(c)&&(this._promisesMap.get(c).cancel(),this._promisesMap["delete"](c),
a)){c=a.layer;var d=a.view;this.factory.dispose(a);a.layer=a.parent=a.view=null;this._layerViewsMap["delete"](c);c.emit("layerview-destroy",{view:d,layerView:a});d.emit("layerview-destroy",{layer:c,layerView:a})}},l([h.property()],q.prototype,"ready",void 0),l([h.property()],q.prototype,"view",void 0),q=l([h.subclass("esri.views.LayerViewManager")],q)}(h.declared(d))})},"esri/views/LayerViewFactory":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators dojo/Deferred dojo/when ../core/Accessor ../core/Collection ../core/Error ../core/watchUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c){return function(t){function r(){var c=null!==t&&t.apply(this,arguments)||this;return c.creationRequests=new a,c.paused=!0,c}return w(r,t),r.prototype.initialize=function(){var a=this;c.whenFalse(this,"paused",function(){a.creationRequests.toArray().forEach(a._processRequest,a)},!0)},r.prototype.destroy=function(){this.creationRequests.drain(function(a){return a.deferred.cancel(void 0)})},Object.defineProperty(r.prototype,"working",{get:function(){return 0<this.creationRequests.length},
enumerable:!0,configurable:!0}),r.prototype.create=function(a,c){var q=this.getLayerViewPromise(c);if(q)return q;var h=this.creationRequests,l={deferred:new d(function(){var a=new k("cancelled:layerview-create","layerview creation cancelled",{layer:c});return h.remove(l),l.creationPromise&&l.creationPromise.cancel(a),a}),view:a,layer:c,started:!1,creationPromise:null};return h.push(l),this.paused||this._processRequest(l),l.deferred.promise},r.prototype.dispose=function(a){a.layer.destroyLayerView(a)},
r.prototype.getLayerViewPromise=function(a){var c=this.creationRequests&&this.creationRequests.find(function(c){return c.layer===a});return c&&c.deferred.promise},r.prototype._processRequest=function(a){var c=this;if(!a.started){a.started=!0;var d=a.deferred,q=a.layer,h=a.view;q.load().then(function(b){return d.isCanceled()?void 0:(a.creationPromise=b.createLayerView(h),a.creationPromise)}).then(function(b){return d.isCanceled()?b:a.creationPromise=u(b.when())})["catch"](function(a){d.isCanceled()||
d.reject(new k("layerview:create-error","layerview creation failed",{layer:q,error:a}))}).then(function(b){return c.creationRequests&&c.creationRequests.remove(a),d.isFulfilled()?b&&c.dispose(b):d.resolve(b),b})}},l([h.property()],r.prototype,"creationRequests",void 0),l([h.property()],r.prototype,"paused",void 0),l([h.property()],r.prototype,"view",void 0),l([h.property({dependsOn:["paused","creationRequests.length"],readOnly:!0})],r.prototype,"working",null),r=l([h.subclass("esri.views.LayerViewFactory")],
r)}(h.declared(r))})},"esri/views/RefreshManager":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ../core/Accessor ../core/HandleRegistry".split(" "),function(A,p,w,l,h,d,u){return function(d){function a(){var a=null!==d&&d.apply(this,arguments)||this;return a._handles=new u,a._currentTick=0,a}return w(a,d),a.prototype.initialize=function(){var a=this;this.view.allLayerViews.on("after-changes",function(){a.notifyChange("tickInterval");
a._handles.remove("layerViewsUpdating");a._handles.add(a._getLayerViewHandles(),"layerViewsUpdating")});this.watch("tickInterval",function(){return a._restartTicking()});this.watch("view.ready",function(){return a._restartTicking()});this._restartTicking()},a.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null,this._intervalID&&clearInterval(this._intervalID),this._currentTick=0)},Object.defineProperty(a.prototype,"tickInterval",{get:function(){var a=this.view.allLayerViews.filter(function(a){return!!a.refresh});
return this._getCommonInterval(a)},enumerable:!0,configurable:!0}),a.prototype._restartTicking=function(){var a=this;this._currentTick=0;this._intervalID&&clearInterval(this._intervalID);this.get("view.ready")&&(this._intervalID=setInterval(function(){var c=Date.now();a._currentTick+=a.tickInterval;a.view.allLayerViews.forEach(function(d){if(d.refresh){var k=Math.round(6E4*d.refreshInterval),q=0===a._currentTick%k,h=6E3>c-d.refreshTimestamp;k&&q&&!h&&d.refresh(c)}})},this.tickInterval))},a.prototype._getLayerViewHandles=
function(){var a=this,c=[];return this.view.allLayerViews.forEach(function(d){if(d.refresh){var k=d.watch("refreshInterval",function(){return a.notifyChange("tickInterval")});if(c.push(k),d.layer)k=d.layer.on("refresh",function(){var a=Date.now();6E3>a-d.refreshTimestamp||d.refresh(a)}),c.push(k)}}),c},a.prototype._getCommonInterval=function(a){var c=function(a,d){return isNaN(a)||isNaN(d)?0:0>=d?a:c(d,a%d)};return a.toArray().reduce(function(a,d){return c(Math.round(6E4*d.refreshInterval),a)},0)},
l([h.property()],a.prototype,"view",void 0),l([h.property({readOnly:!0})],a.prototype,"tickInterval",null),a=l([h.subclass("esri.views.RefreshManager")],a)}(h.declared(d))})},"esri/views/BasemapView":function(){define(["../core/Accessor","../core/Collection","../core/watchUtils"],function(A,p,w){return A.createSubclass({declaredClass:"esri.views.BasemapView",properties:{view:{},baseLayerViews:{type:p},referenceLayerViews:{type:p}},constructor:function(){this._loadingHdl=w.init(this,"view.map.basemap",
this._loadBasemap)},getDefaults:function(){return{baseLayerViews:[],referenceLayerViews:[]}},destroy:function(){this.view=null;this._loadingHdl&&(this._loadingHdl.remove(),this._loadingHdl=null)},_suspendedGetter:function(){return this.view?this.view.suspended:!0},_loadBasemap:function(l){l&&l.load()}})})},"esri/views/GroundView":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ../core/Accessor ../core/Collection ../core/watchUtils ../core/HandleRegistry".split(" "),
function(A,p,w,l,h,d,u,r,a){return function(d){function c(){var c=null!==d&&d.apply(this,arguments)||this;return c.handles=new a,c.layerViews=new u,c}return w(c,d),c.prototype.initialize=function(){this.handles.add(r.when(this,"view.map.ground",function(a){return a.load()}))},c.prototype.destroy=function(){this.view=null;this.handles&&(this.handles.destroy(),this.handles=null)},Object.defineProperty(c.prototype,"suspended",{get:function(){return!this.view||this.view.suspended},enumerable:!0,configurable:!0}),
l([h.property()],c.prototype,"view",void 0),l([h.property({type:u})],c.prototype,"layerViews",void 0),l([h.property()],c.prototype,"suspended",null),c=l([h.subclass("esri.views.GroundView")],c)}(h.declared(d))})},"esri/views/support/DefaultsFromMap":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/arrayUtils ../../core/watchUtils ../../core/Accessor ../../core/HandleRegistry ../../portal/support/geometryServiceUtils ../../geometry/support/webMercatorUtils ../../geometry/support/heightModelInfoUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t){return function(r){function q(){var c=null!==r&&r.apply(this,arguments)||this;return c._handles=new a,c._waitTask=null,c._isStarted=!1,c._spatialReferenceCandidates=null,c._extentCandidates=null,c.isSpatialReferenceDone=!1,c.isTileInfoDone=!1,c.isHeightModelInfoSearching=!1,c.spatialReference=null,c.extent=null,c.heightModelInfo=null,c.vcsWkid=null,c.latestVcsWkid=null,c.mapCollectionPaths=v.DefaultMapCollectionPaths.slice(),c.tileInfo=null,c}return w(q,r),v=q,q.prototype.initialize=
function(){var a=this;this.watch("mapCollectionPaths",function(){a._isStarted&&(a.reset(),a.start())})},q.prototype.destroy=function(){this._set("view",null);this._handles&&(this._handles.destroy(),this._handles=null,this._isStarted=!1);this._cancelLoading()},q.prototype.reset=function(){this._handles.removeAll();this._isStarted=!1;this._set("isSpatialReferenceDone",!1);this._set("isTileInfoDone",!1);this._set("isHeightModelInfoSearching",!1);this._set("spatialReference",null);this._set("extent",
null);this._set("heightModelInfo",null);this._set("vcsWkid",null);this._set("latestVcsWkid",null);this._set("tileInfo",null);this._extentCandidates=this._spatialReferenceCandidates=null},q.prototype.start=function(){this._handles.removeAll();this._isStarted=!0;for(var a=this._updateLayerChange.bind(this),c=0,d=this.mapCollectionPaths;c<d.length;c++)this._handles.add(u.on(this.view,"map."+d[c],"change",a,a,a,!0))},q.prototype._ownerNameFromCollectionName=function(a){var c=a.lastIndexOf(".");return-1===
c?"view":"view."+a.slice(0,c)},q.prototype._ensureLoadedOwnersFromCollectionName=function(a){var c;a=this._ownerNameFromCollectionName(a).split(".");for(var d=0;d<a.length&&(c=this.get(a.slice(0,d+1).join(".")),c);d++)if(c.load&&!c.isFulfilled())return{owner:null,loading:c.load()};return{owner:c}},q.prototype._cancelLoading=function(){this._waitTask=null;this._extentProjectTask&&(this._extentProjectTask.cancel(),this._extentProjectTask=null)},q.prototype._updateWhen=function(a){var c=this,d=!0,b=
!1,m=a.always(function(){d?b=!0:m===c._waitTask&&c._update()});return d=!1,b||(this._waitTask=m),b},q.prototype._updateLayerChange=function(){this.isSpatialReferenceDone&&!this.spatialReference&&this._set("isSpatialReferenceDone",!1);this._update()},q.prototype._update=function(){var a=this;if(this._cancelLoading(),this.view){if(!this.isSpatialReferenceDone&&0!==this._processMapCollections(function(b){return a._processSpatialReferenceSource(b)})){var c=null,k=this._spatialReferenceCandidates;!k||
1>k.length?c=this.defaultSpatialReference:(this.defaultSpatialReference&&1<k.length&&-1<d.findIndex(k,function(b){return b.equals(a.defaultSpatialReference)})&&(k=[this.defaultSpatialReference]),c=k[0]);this._set("spatialReference",c);this._set("isSpatialReferenceDone",!0);c&&(this._processMapCollections(function(b){return a._findExtent(b,c)}),this.extent||this._projectExtentCandidate())}null==this.heightModelInfo&&this.view.isHeightModelInfoRequired&&(k=this._processMapCollections(function(b){return a._processHeightModelInfoSource(b)},
function(a){return t.mayHaveHeightModelInfo(a)}),this._set("isHeightModelInfoSearching",0===k));null==this.tileInfo&&(k=!1,this.view.isTileInfoRequired()&&(k=this._deriveTileInfo()),k||this._set("isTileInfoDone",!0))}},q.prototype._processMapCollections=function(a,c){for(var d=0,b=this.mapCollectionPaths;d<b.length;d++){var m="map."+b[d],k=this._ensureLoadedOwnersFromCollectionName(m);if(k.loading&&!this._updateWhen(k.loading))return 0;k=k.owner;if(!(!k||k.isRejected&&k.isRejected())&&(m=this.view.get(m))&&
(m=this._processMapCollection(m,a,c),2!==m))return m}return 2},q.prototype._processMapCollection=function(a,c,d){for(var b=0;b<a.length;b++){var m=a.getItemAt(b),k=null!=d&&!d(m);if(!k&&m.load&&!m.isFulfilled()&&!this._updateWhen(m.load()))return 0;if(!k&&(!m.load||m.isResolved())){if(c(m))return 1;if(m.layers&&(m=this._processMapCollection(m.layers,c),2!==m))return m}}return 2},q.prototype._processSpatialReferenceSource=function(a){a=this._getSupportedSpatialReferences(a);return 0===a.length?!1:
(this._spatialReferenceCandidates?(a=d.intersect(a,this._spatialReferenceCandidates,function(a,c){return a.equals(c)}),0<a.length&&(this._spatialReferenceCandidates=a)):this._spatialReferenceCandidates=a,1===this._spatialReferenceCandidates.length)},q.prototype._findExtent=function(a,c){var k=a.fullExtents||(a.fullExtent?[a.fullExtent]:[]),b=d.find(k,function(a){return a.spatialReference.equals(c)});if(b)return this._set("extent",b),!0;0<this._getSupportedSpatialReferences(a).length&&(k=k.map(function(b){return{extent:b,
layer:a}}),this._extentCandidates=(this._extentCandidates||[]).concat(k));return!1},q.prototype._projectExtentCandidate=function(){var a=this;if(this._extentCandidates&&this._extentCandidates.length){var q=this.spatialReference,h=d.find(this._extentCandidates,function(a){return c.canProject(a.extent.spatialReference,q)});h?this._set("extent",c.project(h.extent,q)):(h=this._extentCandidates[0],this._extentProjectTask=k.projectGeometry(h.extent,q,h.layer.portalItem).then(function(b){a._set("extent",
b)}))}},q.prototype._getSupportedSpatialReferences=function(a){var c=this;return(a.supportedSpatialReferences||(a.spatialReference?[a.spatialReference]:[])).filter(function(d){return c.view.isSpatialReferenceSupported(d,a)})},q.prototype._processHeightModelInfoSource=function(a){var c=t.deriveHeightModelInfoFromLayer(a);return c?(this._set("heightModelInfo",c),this._set("isHeightModelInfoSearching",!1),a.spatialReference&&(this._set("vcsWkid",a.spatialReference.vcsWkid),this._set("latestVcsWkid",
a.spatialReference.latestVcsWkid)),!0):!1},q.prototype._deriveTileInfo=function(){if(!this.isSpatialReferenceDone)return!0;var a=this.get("view.map");if(!a)return!0;var c=a.basemap,d=c&&c.get("baseLayers.0"),a=a.get("layers.0"),b=!1,m=null;return c&&"failed"!==c.loadStatus?c.loaded?d&&"failed"!==d.loadStatus?d.loaded?m=d.tileInfo:(this._updateWhen(d.load()),b=!0):a&&"failed"!==a.loadStatus?a.loaded?m=a.tileInfo:(this._updateWhen(a.load()),b=!0):b=!0:(this._updateWhen(c.load()),b=!0):a&&"failed"!==
a.loadStatus&&(a.loaded?m=a.tileInfo:(this._updateWhen(a.load()),b=!0)),m&&!m.spatialReference.equals(this.spatialReference)&&(m=null),b||this._set("tileInfo",m),b},q.DefaultMapCollectionPaths=["basemap.baseLayers","layers","ground.layers","basemap.referenceLayers"],l([h.property({readOnly:!0})],q.prototype,"isSpatialReferenceDone",void 0),l([h.property({readOnly:!0})],q.prototype,"isTileInfoDone",void 0),l([h.property({readOnly:!0})],q.prototype,"isHeightModelInfoSearching",void 0),l([h.property({constructOnly:!0})],
q.prototype,"view",void 0),l([h.property({readOnly:!0})],q.prototype,"spatialReference",void 0),l([h.property({readOnly:!0})],q.prototype,"extent",void 0),l([h.property({readOnly:!0})],q.prototype,"heightModelInfo",void 0),l([h.property({readOnly:!0})],q.prototype,"vcsWkid",void 0),l([h.property({readOnly:!0})],q.prototype,"latestVcsWkid",void 0),l([h.property()],q.prototype,"mapCollectionPaths",void 0),l([h.property()],q.prototype,"defaultSpatialReference",void 0),l([h.property({readOnly:!0})],q.prototype,
"tileInfo",void 0),q=v=l([h.subclass("esri.views.support.DefaultsFromMap")],q);var v}(h.declared(r))})},"esri/core/arrayUtils":function(){define([],function(){function A(l,h){return-1===l.indexOf(h)}function p(l,h,d){return!l.some(h.bind(null,d))}var w={findIndex:function(l,h,d){for(var u,r=l.length,a=0;r>a;a++)if(u=l[a],h.call(d,u,a,l))return a;return-1},find:function(l,h,d){for(var u,r=l.length,a=0;r>a;a++)if(u=l[a],h.call(d,u,a,l))return u},equals:function(l,h,d){if(!l&&!h)return!0;if(!l||!h||
l.length!=h.length)return!1;if(d)for(var u=0;u<l.length;u++){if(!d(l[u],h[u]))return!1}else for(d=0;d<l.length;d++)if(l[d]!==h[d])return!1;return!0},difference:function(l,h,d){var u,r;return d?(u=h.filter(p.bind(null,l,d)),r=l.filter(p.bind(null,h,d))):(u=h.filter(A.bind(null,l)),r=l.filter(A.bind(null,h))),{added:u,removed:r}},intersect:function(l,h,d){return l&&h?d?l.filter(function(l){return-1<w.findIndex(h,function(h){return d(l,h)})}):l.filter(function(d){return-1<h.indexOf(d)}):[]},range:function(l,
h){null==h&&(h=l,l=0);for(var d=Array(h-l),u=l;h>u;u++)d[u-l]=u;return d},constant:function(l,h){for(var d=Array(l),u=0;l>u;u++)d[u]=h;return d},binaryIndexOf:function(l,h,d){for(var u=l.length,r=0,a=u-1;a>r;){var k=r+Math.floor((a-r)/2);h>l[k]?r=k+1:a=k}a=l[r];return d?h>=l[u-1]?-1:a===h?r:r-1:a===h?r:-1}};return w})},"esri/portal/support/geometryServiceUtils":function(){define("require exports ../Portal ../PortalItem ../../config ../../tasks/GeometryService ../../tasks/support/ProjectParameters ../../core/promiseUtils ../../core/Error".split(" "),
function(A,p,w,l,h,d,u,r,a){function k(c){if(void 0===c&&(c=null),h.geometryServiceUrl)return r.resolve(new d({url:h.geometryServiceUrl}));if(!c)return r.reject(new a("internal:geometry-service-url-not-configured"));var k;return c.isInstanceOf(l)?k=c.portal||w.getDefault():c.isInstanceOf(w)&&(k=c),k.load().then(function(c){if(c.helperServices&&c.helperServices.geometry&&c.helperServices.geometry.url)return r.resolve(new d({url:c.helperServices.geometry.url}));throw new a("internal:geometry-service-url-not-configured");
})}Object.defineProperty(p,"__esModule",{value:!0});p.create=k;p.projectGeometry=function(a,d,h){return void 0===h&&(h=null),k(h).then(function(c){var k=new u;return k.geometries=[a],k.outSpatialReference=d,c.project(k)}).then(function(a){return a&&Array.isArray(a)&&1===a.length?a[0]:r.reject()})}})},"esri/tasks/GeometryService":function(){define("../core/kebabDictionary ../core/accessorSupport/ensureType ../geometry/Extent ../geometry/Multipoint ../geometry/Polyline ../geometry/Polygon ../geometry/support/jsonUtils ../request ./Task ./support/ProjectParameters dojo/_base/lang".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c){var t=A({MGRS:"mgrs",USNG:"usng",UTM:"utm",GeoRef:"geo-ref",GARS:"gars",DMS:"dms",DDM:"ddm",DD:"dd"}),C=p.ensureType(k);A=a.createSubclass({declaredClass:"esri.tasks.GeometryService",areasAndLengths:function(a,d){a={query:c.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON()),callbackParamName:"callback"};return(this.requestOptions||d)&&(a=c.mixin({},this.requestOptions,d,a)),r(this.parsedUrl.path+"/areasAndLengths",a).then(function(a){return a.data})},autoComplete:function(a,
k,h){var q=a[0].spatialReference;a={query:c.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(q.toJSON()),polygons:JSON.stringify(this._encodeGeometries(a).geometries),polylines:JSON.stringify(this._encodeGeometries(k).geometries)}),callbackParamName:"callback"};return(this.requestOptions||h)&&(a=c.mixin({},this.requestOptions,h,a)),r(this.parsedUrl.path+"/autoComplete",a).then(function(a){return(a.data.geometries||[]).map(function(a){return new d({spatialReference:q,rings:a.rings})})})},
buffer:function(a,k){var q=c.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON()),h=a.outSpatialReference||a.geometries[0].spatialReference;a={query:q,callbackParamName:"callback"};return(this.requestOptions||k)&&(a=c.mixin({},this.requestOptions,k,a)),r(this.parsedUrl.path+"/buffer",a).then(function(a){return(a.data.geometries||[]).map(function(a){return new d({spatialReference:h,rings:a.rings})})})},cut:function(a,d,k){var q=a[0].spatialReference,h=a.map(function(a){return a.toJSON()});a={query:c.mixin({},
this.parsedUrl.query,{f:"json",sr:JSON.stringify(q.toJSON()),target:JSON.stringify({geometryType:u.getJsonType(a[0]),geometries:h}),cutter:JSON.stringify(d.toJSON())}),callbackParamName:"callback"};return(this.requestOptions||k)&&(a=c.mixin({},this.requestOptions,k,a)),r(this.parsedUrl.path+"/cut",a).then(function(a){a=a.data;return{cutIndexes:a.cutIndexes,geometries:(a.geometries||[]).map(function(a){return u.fromJSON(a).set("spatialReference",q)})}})},convexHull:function(a,d){var k=a[0].spatialReference;
a={query:c.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(k.toJSON()),geometries:JSON.stringify(this._encodeGeometries(a))}),callbackParamName:"callback"};return(this.requestOptions||d)&&(a=c.mixin({},this.requestOptions,d,a)),r(this.parsedUrl.path+"/convexHull",a).then(function(a){return u.fromJSON(a.data.geometry).set("spatialReference",k)})},densify:function(a,d){var k=c.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON()),q=a.geometries[0].spatialReference;a={query:k,callbackParamName:"callback"};
return(this.requestOptions||d)&&(a=c.mixin({},this.requestOptions,d,a)),r(this.parsedUrl.path+"/densify",a).then(function(a){return(a.data.geometries||[]).map(function(a){return u.fromJSON(a).set("spatialReference",q)})})},difference:function(a,d,k){var q=a[0].spatialReference;a={query:c.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(q.toJSON()),geometries:JSON.stringify(this._encodeGeometries(a)),geometry:JSON.stringify({geometryType:u.getJsonType(d),geometry:d.toJSON()})}),callbackParamName:"callback"};
return(this.requestOptions||k)&&(a=c.mixin({},this.requestOptions,k,a)),r(this.parsedUrl.path+"/difference",a).then(function(a){return(a.data.geometries||[]).map(function(a){return u.fromJSON(a).set("spatialReference",q)})})},distance:function(a,d){a={query:c.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON()),callbackParamName:"callback"};return(this.requestOptions||d)&&(a=c.mixin({},this.requestOptions,d,a)),r(this.parsedUrl.path+"/distance",a).then(this._handleDistanceResponse)},fromGeoCoordinateString:function(a,
d){var k={};c.isObject(a.sr)?k.sr=a.sr.wkid||JSON.stringify(a.sr.toJSON()):k.sr=a.sr;k.strings=JSON.stringify(a.strings);k.conversionType=t.toJSON(a.conversionType||"mgrs");k.conversionMode=a.conversionMode;a={query:c.mixin({},this.parsedUrl.query,{f:"json"},k),callbackParamName:"callback"};return(this.requestOptions||d)&&(a=c.mixin({},this.requestOptions,d,a)),r(this.parsedUrl.path+"/fromGeoCoordinateString",a).then(this._handleFromGeoCoordinateResponse)},generalize:function(a,d){var k=c.mixin({},
this.parsedUrl.query,{f:"json"},a.toJSON()),q=a.geometries[0].spatialReference;a={query:k,callbackParamName:"callback"};return(this.requestOptions||d)&&(a=c.mixin({},this.requestOptions,d,a)),r(this.parsedUrl.path+"/generalize",a).then(function(a){return(a.data.geometries||[]).map(function(a){return u.fromJSON(a).set("spatialReference",q)})})},intersect:function(a,d,k){var q=a[0].spatialReference;a={query:c.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(q.toJSON()),geometries:JSON.stringify(this._encodeGeometries(a)),
geometry:JSON.stringify({geometryType:u.getJsonType(d),geometry:d.toJSON()})}),callbackParamName:"callback"};return(this.requestOptions||k)&&(a=c.mixin({},this.requestOptions,k,a)),r(this.parsedUrl.path+"/intersect",a).then(function(a){return(a.data.geometries||[]).map(function(a){return u.fromJSON(a).set("spatialReference",q)})})},lengths:function(a,d){a={query:c.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON()),callbackParamName:"callback"};return(this.requestOptions||d)&&(a=c.mixin({},this.requestOptions,
d,a)),r(this.parsedUrl.path+"/lengths",a).then(function(a){return a.data})},labelPoints:function(a,d){var k=a.map(function(a){return a.toJSON()}),h=a[0].spatialReference;a={query:c.mixin({},this.parsedUrl.query,{f:"json",sr:h.wkid?h.wkid:JSON.stringify(h.toJSON()),polygons:JSON.stringify(k)}),callbackParamName:"callback"};return(this.requestOptions||d)&&(a=c.mixin({},this.requestOptions,d,a)),r(this.parsedUrl.path+"/labelPoints",a).then(function(a){return(a.data.labelPoints||[]).map(function(a){return u.fromJSON(a).set("spatialReference",
h)})})},offset:function(a,d){var k=c.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON()),h=a.geometries[0].spatialReference;a={query:k,callbackParamName:"callback"};return(this.requestOptions||d)&&(a=c.mixin({},this.requestOptions,d,a)),r(this.parsedUrl.path+"/offset",a).then(function(a){return(a.data.geometries||[]).map(function(a){return u.fromJSON(a).set("spatialReference",h)})})},project:function(a,d){a=C(a);var k=c.mixin({},a.toJSON(),this.parsedUrl.query,{f:"json"}),h=a.outSpatialReference,
q=u.getJsonType(a.geometries[0]),b=this._decodeGeometries;a={query:k,callbackParamName:"callback"};return(this.requestOptions||d)&&(a=c.mixin({},this.requestOptions,d,a)),r(this.parsedUrl.path+"/project",a).then(function(a){return b(a.data,q,h)})},relation:function(a,d){a={query:c.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON()),callbackParamName:"callback"};return(this.requestOptions||d)&&(a=c.mixin({},this.requestOptions,d,a)),r(this.parsedUrl.path+"/relation",a).then(this._handleRelationResponse)},
reshape:function(a,d,k){var h=a.spatialReference;a={query:c.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(h.toJSON()),target:JSON.stringify({geometryType:u.getJsonType(a),geometry:a.toJSON()}),reshaper:JSON.stringify(d.toJSON())}),callbackParamName:"callback"};return(this.requestOptions||k)&&(a=c.mixin({},this.requestOptions,k,a)),r(this.parsedUrl.path+"/reshape",a).then(function(a){return u.fromJSON(a.data.geometry).set("spatialReference",h)})},simplify:function(a,d){var k=a[0].spatialReference,
h=c.mixin({},this.parsedUrl.query,{f:"json",sr:k.wkid?k.wkid:JSON.stringify(k.toJSON()),geometries:JSON.stringify(this._encodeGeometries(a))}),q=u.getJsonType(a[0]),b=this._decodeGeometries;a={query:h,callbackParamName:"callback"};return(this.requestOptions||d)&&(a=c.mixin({},this.requestOptions,d,a)),r(this.parsedUrl.path+"/simplify",a).then(function(a){return b(a.data,q,k)})},toGeoCoordinateString:function(a,d){var k={};c.isObject(a.sr)?k.sr=a.sr.wkid||JSON.stringify(a.sr.toJSON()):k.sr=a.sr;k.coordinates=
JSON.stringify(a.coordinates);k.conversionType=t.toJSON(a.conversionType||"mgrs");k.conversionMode=a.conversionMode;k.numOfDigits=a.numOfDigits;k.rounding=a.rounding;k.addSpaces=a.addSpaces;a={query:c.mixin({},this.parsedUrl.query,{f:"json"},k),callbackParamName:"callback"};return(this.requestOptions||d)&&(a=c.mixin({},this.requestOptions,d,a)),r(this.parsedUrl.path+"/toGeoCoordinateString",a).then(this._handleToGeoCoordinateResponse)},trimExtend:function(a,d){var k=c.mixin({},this.parsedUrl.query,
{f:"json"},a.toJSON()),q=a.sr;a={query:k,callbackParamName:"callback"};return(this.requestOptions||d)&&(a=c.mixin({},this.requestOptions,d,a)),r(this.parsedUrl.path+"/trimExtend",a).then(function(a){return(a.data.geometries||[]).map(function(a){return new h({spatialReference:q,paths:a.paths})})})},union:function(a,d){var k=a[0].spatialReference;a={query:c.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(k.toJSON()),geometries:JSON.stringify(this._encodeGeometries(a))}),callbackParamName:"callback"};
return(this.requestOptions||d)&&(a=c.mixin({},this.requestOptions,d,a)),r(this.parsedUrl.path+"/union",a).then(function(a){return u.fromJSON(a.data.geometry).set("spatialReference",k)})},_handleRelationResponse:function(a){return a.data.relations},_handleDistanceResponse:function(a){return a=a.data,a&&a.distance},_handleToGeoCoordinateResponse:function(a){return a.data.strings},_handleFromGeoCoordinateResponse:function(a){return a.data.coordinates},_encodeGeometries:function(a){var c,d=[],k=a.length;
for(c=0;k>c;c++)d.push(a[c].toJSON());return{geometryType:u.getJsonType(a[0]),geometries:d}},_decodeGeometries:function(a,d,k){var h=u.getGeometryType(d);a=a.geometries;var q=[],b={spatialReference:k.toJSON()},m=c.mixin;return a.forEach(function(a,c){q[c]=new h(m(a,b))}),q},_toProjectGeometry:function(a){var c=a.spatialReference.toJSON();return a instanceof w?new d({rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]],spatialReference:c}):new h({paths:[[].concat(a.points)],
spatialReference:c})},_fromProjectedGeometry:function(a,c,d){return"extent"===c?(a=a.rings[0],new w(a[0][0],a[0][1],a[2][0],a[2][1],d)):new l({points:a.paths[0],spatialReference:d.toJSON()})}});return c.mixin(A,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,
UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,
UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,
UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",
UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"}),A})},"esri/tasks/Task":function(){define(["dojo/_base/lang","../core/Accessor","../core/urlUtils"],function(A,p,w){return p.createSubclass({declaredClass:"esri.tasks.Task",normalizeCtorArgs:function(l,h){if("string"!=typeof l)return l;var d={};return l&&(d.url=l),h&&A.mixin(d,h),d},properties:{normalization:{value:!0},parsedUrl:{value:null,readOnly:!0,dependsOn:["url"],
get:function(){return this._parseUrl(this.url)}},requestOptions:{value:null},url:{value:null,type:String}},_parseUrl:function(l){return l?w.urlToObject(l):null},_useSSL:function(){var l=this.parsedUrl,h=/^http:/i;this.url&&this.set("url",this.url.replace(h,"https:"));l&&l.path&&(l.path=l.path.replace(h,"https:"))},_encode:function(l,h,d){var u,r,a,k,c,t={};for(a in l)if("declaredClass"!==a&&(u=l[a],r=typeof u,null!==u&&void 0!==u&&"function"!==r))if(A.isArray(u))for(t[a]=[],c=u.length,k=0;c>k;k++)t[a][k]=
this._encode(u[k]);else"object"===r?u.toJSON&&(k=u.toJSON(d&&d[a]),"esri.tasks.support.FeatureSet"===u.declaredClass&&k.spatialReference&&(k.sr=k.spatialReference,delete k.spatialReference),t[a]=h?k:JSON.stringify(k)):t[a]=u;return t}})})},"esri/tasks/support/ProjectParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/lang ../../geometry/support/jsonUtils ../../core/JSONSupport ../../core/Logger".split(" "),
function(A,p,w,l,h,d,u,r,a){var k=a.getLogger("esri.tasks.support.ProjectParameters");return function(a){function c(c){c=a.call(this)||this;return c.geometries=null,c.outSpatialReference=null,c.transformation=null,c.transformForward=null,c}return w(c,a),Object.defineProperty(c.prototype,"outSR",{get:function(){return k.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead."),this.outSpatialReference},set:function(a){k.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");
this.outSpatialReference=a},enumerable:!0,configurable:!0}),c.prototype.toJSON=function(){var a=this.geometries.map(function(a){return a.toJSON()}),c=this.geometries[0],k={};return k.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),k.inSR=c.spatialReference.wkid||JSON.stringify(c.spatialReference.toJSON()),k.geometries=JSON.stringify({geometryType:u.getJsonType(c),geometries:a}),this.transformation&&(k.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),
d.isDefined(this.transformForward)&&(k.transformForward=this.transformForward),k},l([h.property()],c.prototype,"geometries",void 0),l([h.property({json:{read:{source:"outSR"}}})],c.prototype,"outSpatialReference",void 0),l([h.property({json:{read:!1}})],c.prototype,"outSR",null),l([h.property()],c.prototype,"transformation",void 0),l([h.property()],c.prototype,"transformForward",void 0),c=l([h.subclass("esri.tasks.support.ProjectParameters")],c)}(h.declared(r))})},"esri/views/BreakpointsOwner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../core/accessorSupport/decorators ../core/watchUtils ./DOMContainer ../core/Accessor ../core/ArrayPool ../core/HandleRegistry dojo/dom-class".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t){var C={widthBreakpoint:{getValue:function(a){var c=a.viewSize[0];a=a.breakpoints;var d=this.values;return c<=a.xsmall?d.xsmall:c<=a.small?d.small:c<=a.medium?d.medium:c<=a.large?d.large:d.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},
heightBreakpoint:{getValue:function(a){var c=a.viewSize[1];a=a.breakpoints;var d=this.values;return c<=a.xsmall?d.xsmall:c<=a.small?d.small:c<=a.medium?d.medium:c<=a.large?d.large:d.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},
orientation:{getValue:function(a){a=a.viewSize;var c=this.values;return a[1]>=a[0]?c.portrait:c.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},q={xsmall:544,small:768,medium:992,large:1200};return function(a){function v(){var d=null!==a&&a.apply(this,arguments)||this;return d._breakpointsHandles=new c,d.breakpoints=q,d.orientation=null,d.widthBreakpoint=null,d.heightBreakpoint=
null,d}return w(v,a),v.prototype.initialize=function(){this._breakpointsHandles.add([u.init(this,["breakpoints","size"],this._updateClassNames)])},v.prototype.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)},v.prototype._updateClassNames=function(){if(this.container){var a,c,b,d=k.acquire(),h=k.acquire(),q=!1;for(a in C)c=this[a],b=C[a].getValue({viewSize:this.size,breakpoints:this.breakpoints}),c!==b&&(q=!0,this[a]=
b,h.push(C[a].valueToClassName[c]),d.push(C[a].valueToClassName[b]));q&&(this._applyClassNameChanges(d,h),k.release(d),k.release(h))}},v.prototype._applyClassNameChanges=function(a,c){var b=this.container;b&&(t.remove(b,c),t.add(b,a))},v.prototype._removeActiveClassNames=function(){var a=this.container;if(a)for(var c in C)t.remove(a,C[c].valueToClassName[this[c]])},l([d.property({set:function(a){var c=this._get("breakpoints");if(a!==c){c=(c=a)&&c.xsmall<c.small&&c.small<c.medium&&c.medium<c.large;
if(!c){var b=JSON.stringify(q,null,2);console.warn("provided breakpoints are not valid, using defaults:"+b)}a=c?a:q;this._set("breakpoints",h({},a))}}})],v.prototype,"breakpoints",void 0),l([d.property()],v.prototype,"orientation",void 0),l([d.property()],v.prototype,"widthBreakpoint",void 0),l([d.property()],v.prototype,"heightBreakpoint",void 0),v=l([d.subclass("esri.views.BreakpointsOwner")],v)}(d.declared(a,r))})},"esri/views/DOMContainer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/_base/lang dojo/on dojo/dom dojo/dom-construct ../core/Accessor ../core/Evented ../core/HandleRegistry ../core/Scheduler ../core/watchUtils ../widgets/Popup ./PopupManager ./overlay/ViewOverlay ./ui/DefaultUI ../core/accessorSupport/decorators".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D){var b=[0,0];return function(a){function m(){var b=a.call(this)||this;return b._domHandles=new c,b._freqInfo={freq:16,time:750},b._overlayRenderTaskHandle=null,b.height=0,b.position=null,b.resizing=!1,b.root=null,b.surface=null,b.suspended=!0,b.width=0,b.watch("cursor",function(a){var c=b.surface;c&&c.setAttribute("data-cursor",a)}),b.watch("interacting",function(a){var c=b.surface;c&&c.setAttribute("data-interacting",a.toString())}),b}return w(m,a),m.prototype.getDefaults=
function(){return h.mixin(this.inherited(arguments),{popup:{},ui:{}})},m.prototype.destroy=function(){this.ui.destroy();this.popup&&this.popup.destroy();this.container=null;this._domHandles.destroy()},Object.defineProperty(m.prototype,"container",{set:function(a){var b=this,c=this._get("container");if(c!==a)if(this._stopMeasuring(),c&&(c.classList.remove("esri-view"),this.popupManager.destroy(),this._set("popupManager",null),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=
null),this.overlay.destroy(),this._set("overlay",null),r.destroy(this.root),this._set("root",null)),a){a.classList.add("esri-view");c=document.createElement("div");c.className="esri-view-root";a.insertBefore(c,a.firstChild);this._set("root",c);var d=document.createElement("div");d.className="esri-view-surface";u.setSelectable(d,!1);c.appendChild(d);this._set("surface",d);d=new y;c.appendChild(d.surface);this._set("overlay",d);d.watch("needsRender",function(a){a&&!b._overlayRenderTaskHandle?b._overlayRenderTaskHandle=
t.addFrameTask({render:function(){b.overlay.render()}}):b._overlayRenderTaskHandle&&(b._overlayRenderTaskHandle.remove(),b._overlayRenderTaskHandle=null)});this._forceReadyCycle();this._set("container",a);this._startMeasuring();a=new v({enabled:!0,view:this});this._set("popupManager",a)}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,
"popup",{set:function(a){var b=this._get("popup");a!==b&&(a||(a=new q({container:document.createElement("div")})),this._domHandles.remove("view-popup"),b&&b.destroy(),a&&(a.viewModel.view=this,this._domHandles.add([C.init(this,"root",function(b,c){var d=a.container;d||(a.container=document.createElement("div"));var m=d&&d.parentNode;u.isDescendant(m,c)&&m.removeChild(d);b&&!m&&r.place(a.container,b)})],"view-popup")),this._set("popup",a))},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,
"size",{get:function(){return[this.width,this.height]},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"ui",{set:function(a){var b=this._get("ui");a!==b&&(this._domHandles.remove("ui"),b&&b.destroy(),a&&(a.view=this,this._domHandles.add([C.init(this,"root",function(b){a.container=b?r.create("div",null,b):null})],"ui")),this._set("ui",a))},enumerable:!0,configurable:!0}),m.prototype.focus=function(){this.surface&&this.surface.focus()},m.prototype.pageToContainer=function(a,b,c){var d=
this.position;return a-=d[0],b-=d[1],c?(c[0]=a,c[1]=b):c=[a,b],c},m.prototype.containerToPage=function(a,b,c){var d=this.position;return a+=d[0],b+=d[1],c?(c[0]=a,c[1]=b):c=[a,b],c},m.prototype._stopMeasuring=function(){this._domHandles.remove("measuring");this._get("resizing")&&this._set("resizing",!1)},m.prototype._startMeasuring=function(){var a=this,b=this._freqInfo;b.freq=16;b.time=750;this._domHandles.add([d(window,"resize",function(){b.freq=16;b.time=750}),t.addFrameTask({prepare:function(b){var c=
a._measure(),d=a._freqInfo;(d.time+=b.deltaTime,c&&(d.freq=16,a._get("resizing")||a._set("resizing",!0)),d.time<d.freq)||(d.time=0,a._position()||c?d.freq=16:d.freq=Math.min(750,2*d.freq),!c&&512<=d.freq&&a._get("resizing")&&a._set("resizing",!1))}})],"measuring");this._measure();this._position()},m.prototype._measure=function(){var a=this.container,b=a?a.clientWidth:0,c=a?a.clientHeight:0;if(0===b||0===c||"hidden"===window.getComputedStyle(a).visibility)return this.suspended||this._set("suspended",
!0),!1;var a=this.width,d=this.height;return b===a&&c===d?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",b),this._set("height",c),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:a,oldHeight:d,width:b,height:c}),!0)},m.prototype._position=function(){var a=this.container,c=this.position,d;d=(a.ownerDocument||window.document).defaultView;a=a.getBoundingClientRect();d=(b[0]=a.left+d.pageXOffset,b[1]=a.top+d.pageYOffset,b);return c&&d[0]===c[0]&&d[1]===c[1]?!1:
(this._set("position",d.slice()),!0)},l([D.property({value:null,cast:function(a){return u.byId(a)}})],m.prototype,"container",null),l([D.property({readOnly:!0})],m.prototype,"height",void 0),l([D.property({type:q})],m.prototype,"popup",null),l([D.property({type:v})],m.prototype,"popupManager",void 0),l([D.property({type:y})],m.prototype,"overlay",void 0),l([D.property({readOnly:!0})],m.prototype,"position",void 0),l([D.property({readOnly:!0})],m.prototype,"resizing",void 0),l([D.property({readOnly:!0})],
m.prototype,"root",void 0),l([D.property({value:null,dependsOn:["width","height"],readOnly:!0})],m.prototype,"size",null),l([D.property({readOnly:!0})],m.prototype,"surface",void 0),l([D.property({readOnly:!0})],m.prototype,"suspended",void 0),l([D.property({type:B})],m.prototype,"ui",null),l([D.property({readOnly:!0})],m.prototype,"width",void 0),m=l([D.subclass("esri.views.DOMContainer")],m)}(D.declared(a,k))})},"esri/widgets/Popup":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ./support/widget ../core/accessorSupport/decorators ../core/lang ../core/Logger ../core/HandleRegistry ../core/watchUtils ./Widget ../widgets/support/widgetUtils ./Popup/PopupRenderer ./Popup/PopupViewModel dojo/i18n!./Popup/nls/Popup ./Spinner dojo/dom-geometry dojo/keys".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b){function m(a,b){return void 0===b?G+"__"+a:G+"__"+a+"-"+b}var E=A.toUrl("./Popup/images/default-action.svg"),J={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},G="esri-popup",K=a.getLogger("esri.widgets.Popup");return function(a){function G(b){b=a.call(this)||this;return b._blurContainer=!1,b._containerNode=null,b._mainContainerNode=null,b._featureMenuNode=null,b._focusContainer=!1,b._focusDockButton=!1,b._focusFeatureMenuButton=!1,b._focusFirstFeature=
!1,b._handleRegistry=new k,b._displayActionTextLimit=2,b._pointerOffsetInPx=16,b._spinner=null,b._closeFeatureMenuHandle=null,b.actions=null,b.alignment="auto",b.autoCloseEnabled=null,b.content=null,b.collapsed=!1,b.collapseEnabled=!0,b.dockEnabled=!1,b.featureCount=null,b.featureMenuOpen=!1,b.features=null,b.featureNavigationEnabled=!0,b.highlightEnabled=null,b.location=null,b.popupRenderers=[],b.promises=null,b.selectedFeature=null,b.selectedFeatureIndex=null,b.selectedPopupRenderer=null,b.spinnerEnabled=
!0,b.title=null,b.updateLocationEnabled=null,b.view=null,b.viewModel=new v,b.visible=null,b}return w(G,a),G.prototype.postInitialize=function(){var a=this,b=c.pausable(this,"\n      viewModel.visible,\n      dockEnabled,\n      viewModel.selectedFeature\n    ",function(){return a._closeFeatureMenu()});this._closeFeatureMenuHandle=b;this.own(c.watch(this,"viewModel.screenLocation",function(){return a._positionContainer()}),c.watch(this,["viewModel.visible","dockEnabled"],function(){return a._toggleScreenLocationEnabled()}),
c.watch(this,"viewModel.screenLocation",function(b,c){!!b!=!!c&&a.reposition()}),c.watch(this,"viewModel.features",function(b){return a._createPopupRenderers(b)}),c.watch(this,"viewModel.view.padding viewModel.view.size viewModel.visible viewModel.waitingForResult viewModel.location alignment".split(" "),function(){return a.reposition()}),b,c.watch(this,"spinnerEnabled",function(b){return a._spinnerEnabledChange(b)}),c.watch(this,["title","content"],function(){return a._hasFeatureUpdated()}),c.watch(this,
"viewModel.view.size",function(b,c){return a._updateDockEnabledForViewSize(b,c)}),c.watch(this,"viewModel.view",function(b,c){return a._viewChange(b,c)}),c.watch(this,"viewModel.view.ready",function(b,c){return a._viewReadyChange(b,c)}),c.watch(this,["viewModel.waitingForResult","viewModel.location"],function(){return a._displaySpinner()}),c.watch(this,["popupRenderers","viewModel.selectedFeatureIndex"],function(){return a._updatePopupRenderer()}),c.watch(this,"selectedPopupRenderer.viewModel.title",
function(b){return a._setTitleFromPopupRenderer(b)}),c.watch(this,["selectedPopupRenderer.viewModel.content","selectedPopupRenderer.viewModel.waitingForContent"],function(){return a._setContentFromPopupRenderer()}),c.watch(this,"featureMenuOpen",function(b){return a._featureMenuOpenChanged(b)}),c.watch(this,"visible",function(b){return a._visibleChanged(b)}),c.on(this,"viewModel","trigger-action",function(b){return a._zoomToAction(b)}))},G.prototype.destroy=function(){this._destroyPopupRenderers();
this._destroySpinner();this._handleRegistry.destroy();this._handleRegistry=null},Object.defineProperty(G.prototype,"currentAlignment",{get:function(){return this._getCurrentAlignment()},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"currentDockPosition",{get:function(){return this._getCurrentDockPosition()},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"dockOptions",{get:function(){return this._get("dockOptions")||J},set:function(a){var b=h({},J),c=this.get("viewModel.view.breakpoints"),
d={};c&&(d.width=c.xsmall,d.height=c.xsmall);a=h({},b,a);b=h({},b.breakpoint,d);d=a.breakpoint;!0===d?a.breakpoint=b:"object"==typeof d&&(a.breakpoint=h({},b,d));this._set("dockOptions",a);this._setCurrentDockPosition();this.reposition()},enumerable:!0,configurable:!0}),G.prototype.blur=function(){this.visible||K.warn("Popup cannot be blurred while visible is false");this._blurContainer=!0;this.scheduleRender()},G.prototype.clear=function(){},G.prototype.close=function(){this.visible=!1},G.prototype.focus=
function(){this.visible||K.warn("Popup cannot be focused while visible is false");this._focusContainer=!0;this.scheduleRender()},G.prototype.next=function(){return null},G.prototype.open=function(a){a=h({visible:!0},{featureMenuOpen:!1,updateLocationEnabled:!1,promises:[]},a);a.featureMenuOpen&&this._closeFeatureMenuHandle.pause();this.set(a);this._visibleChanged(!0)},G.prototype.previous=function(){return null},G.prototype.reposition=function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()},
G.prototype.triggerAction=function(a){return null},G.prototype.render=function(){var a=this.collapsed,b=this.collapseEnabled,c=this.dockEnabled,k=this.actions,h=this.featureMenuOpen,q=this.featureNavigationEnabled,l=this.popupRenderers,z=this.visible,v=this.viewModel,O=v.featureCount,g=v.promiseCount,e=v.pendingPromisesCount,f=v.selectedFeatureIndex,n=v.title,v=v.waitingForResult,x=1<O&&q,q=1<O&&h,I=b&&!q&&a,L=k&&k.length,P=x&&this._getPageText(O,f),Y=this._renderContent(),E=C.isRtl(),t=this.get("selectedPopupRenderer")?
this.get("selectedPopupRenderer.viewModel.waitingForContent")||this.get("selectedPopupRenderer.viewModel.content"):Y,B=c?y.undock:y.dock,k=this.currentAlignment,a=this.currentDockPosition,e=e?d.tsx("div",{key:m("loading-container"),role:"presentation","class":"esri-popup__loading-container","aria-label":y.loading,title:y.loading},d.tsx("span",{"aria-hidden":"true","class":d.join("esri-popup__icon","esri-icon-loading-indicator","esri-rotating")})):null,D=(u={},u["esri-icon-layer-list"]=!q,u["esri-icon-close"]=
q,u),u=d.tsx("span",{"aria-hidden":"true","class":"esri-popup__icon",classes:D}),D=(G={},G["esri-icon-right-triangle-arrow"]=E,G["esri-popup__pagination-previous-icon--rtl"]=E,G["esri-icon-left-triangle-arrow"]=!E,G["esri-popup__pagination-previous-icon"]=!E,G),G=d.tsx("span",{"aria-hidden":"true","class":"esri-popup__icon",classes:D}),G=d.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,"class":d.join("esri-popup__button","esri-popup__pagination-previous"),
"aria-label":y.previous,title:y.previous},G),E=(J={},J["esri-icon-left-triangle-arrow"]=E,J["esri-popup__pagination-next-icon--rtl"]=E,J["esri-icon-right-triangle-arrow"]=!E,J["esri-popup__pagination-next-icon"]=!E,J),J=d.tsx("span",{"aria-hidden":"true","class":"esri-popup__icon",classes:E}),E=d.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,"class":d.join("esri-popup__button","esri-popup__pagination-next"),"aria-label":y.next,title:y.next},J),J=this.id+"-feature-menu",
h=d.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,"class":d.join("esri-popup__button","esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":J,"aria-expanded":h,"aria-label":y.menu,title:y.menu},u),P=d.tsx("div",{"class":"esri-popup__pagination-page-text"},P),h=x?d.tsx("div",{"class":"esri-popup__navigation-buttons"},G,P,E,h):
null,P=this._wouldDockTo(),P=(M={},M["esri-icon-minimize"]=c,M["esri-popup__icon--dock-icon"]=!c,M["esri-icon-dock-right"]=!c&&("top-right"===P||"bottom-right"===P),M["esri-icon-dock-left"]=!c&&("top-left"===P||"bottom-left"===P),M["esri-icon-maximize"]=!c&&"top-center"===P,M["esri-icon-dock-bottom"]=!c&&"bottom-center"===P,M),M=d.tsx("span",{"aria-hidden":"true",classes:P,"class":"esri-popup__icon"}),M=this.get("dockOptions.buttonEnabled")?d.tsx("div",{role:"button","aria-label":B,title:B,tabIndex:0,
bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,"class":d.join("esri-popup__button","esri-popup__button--dock")},M):null,b=b&&(t||L||x),B=(K={},K["esri-popup__header-title--button"]=b,K),P=b?I?y.expand:y.collapse:"",K=this.id+"-popup-title",n=n?d.tsx("h1",{"class":"esri-popup__header-title",id:K,role:b?"button":"heading","aria-label":P,title:P,classes:B,bind:this,tabIndex:b?0:-1,onclick:this._toggleCollapsed,
onkeydown:this._toggleCollapsed,innerHTML:n}):null,b=d.tsx("span",{"aria-hidden":"true","class":d.join("esri-popup__icon","esri-icon-close")}),b=d.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,"class":"esri-popup__button","aria-label":y.close,title:y.close},b),b=d.tsx("header",{"class":"esri-popup__header"},n,d.tsx("div",{"class":"esri-popup__header-buttons"},M,b)),M=this.id+"-popup-content",Y=t&&!I?d.tsx("article",{key:m("content-container"),id:M,"class":"esri-popup__content"},
Y):null,t=!I&&("bottom-left"===k||"bottom-center"===k||"bottom-right"===k||"top-left"===a||"top-center"===a||"top-right"===a),I=!I&&("top-left"===k||"top-center"===k||"top-right"===k||"bottom-left"===a||"bottom-center"===a||"bottom-right"===a),B=q?null:d.tsx("div",{key:m("actions"),"class":"esri-popup__actions"},this._renderActions()),e=d.tsx("section",{key:m("navigation"),"class":"esri-popup__navigation"},e,h),x=x||L?d.tsx("div",{key:m("feature-buttons"),"class":"esri-popup__feature-buttons"},B,
e):null;(f=this._renderFeatureMenuNode(l,f,q,J))&&this._closeFeatureMenuHandle.resume();l=r.substitute({total:l.length},y.selectedFeatures);f=d.tsx("section",{key:m("menu"),"class":"esri-popup__feature-menu"},d.tsx("h2",{"class":"esri-popup__feature-menu-header"},l),d.tsx("nav",{"class":"esri-popup__feature-menu-viewport",afterCreate:this._featureMenuViewportNodeUpdated,afterUpdate:this._featureMenuViewportNodeUpdated},f));l=c?null:d.tsx("div",{key:m("pointer"),"class":"esri-popup__pointer",role:"presentation"},
d.tsx("div",{"class":d.join("esri-popup__pointer-direction","esri-popup--shadow")}));q=(p={},p["esri-popup--aligned-top-center"]="top-center"===k,p["esri-popup--aligned-bottom-center"]="bottom-center"===k,p["esri-popup--aligned-top-left"]="top-left"===k,p["esri-popup--aligned-bottom-left"]="bottom-left"===k,p["esri-popup--aligned-top-right"]="top-right"===k,p["esri-popup--aligned-bottom-right"]="bottom-right"===k,p["esri-popup--is-docked"]=c,p["esri-popup--shadow"]=!c,p["esri-popup--feature-updated"]=
z,p["esri-popup--is-docked-top-left"]="top-left"===a,p["esri-popup--is-docked-top-center"]="top-center"===a,p["esri-popup--is-docked-top-right"]="top-right"===a,p["esri-popup--is-docked-bottom-left"]="bottom-left"===a,p["esri-popup--is-docked-bottom-center"]="bottom-center"===a,p["esri-popup--is-docked-bottom-right"]="bottom-right"===a,p["esri-popup--feature-menu-open"]=q,p);p=this.get("selectedFeature.layer.title");k=this.get("selectedFeature.layer.id");c=(w={},w["esri-popup--shadow"]=c,w);w=t?f:
null;f=I?f:null;a=t?x:null;x=I?x:null;z=z&&!v&&(g?O:1)?d.tsx("div",{key:m("container"),"class":"esri-popup__position-container",classes:q,"data-layer-title":p,"data-layer-id":k,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},d.tsx("div",{"class":d.join("esri-popup__main-container","esri-widget"),classes:c,tabIndex:-1,"aria-role":"dialog","aria-labelledby":n?K:"","aria-describedby":Y?M:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,
afterUpdate:this._mainContainerNodeUpdated},a,w,b,Y,x,f),l):null;return d.tsx("div",{key:m("base"),"class":"esri-popup",role:"presentation"},z);var u,G,J,M,K,p,w},G.prototype._visibleChanged=function(a){a&&(this._focusContainer=!0,this.scheduleRender())},G.prototype._featureMenuOpenChanged=function(a){a?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0;this.scheduleRender()},G.prototype._setTitleFromPopupRenderer=function(a){this.viewModel.title=a||""},G.prototype._setContentFromPopupRenderer=
function(){this.viewModel.content=this.selectedPopupRenderer||null;this.scheduleRender()},G.prototype._handleFeatureMenuKeyup=function(a){a.keyCode===b.ESCAPE&&(a.stopPropagation(),this.featureMenuOpen=!1)},G.prototype._handleFeatureMenuItemKeyup=function(a){var c=a.keyCode,d=this._featureMenuNode,m=this.get("features.length"),k=a.currentTarget["data-feature-index"];if(d){d=d.querySelectorAll("li");if(c===b.UP_ARROW)return a.stopPropagation(),void d[(k-1+m)%m].focus();if(c===b.DOWN_ARROW)return a.stopPropagation(),
void d[(k+1+m)%m].focus();if(c===b.HOME)return a.stopPropagation(),void d[0].focus();if(c===b.END)return a.stopPropagation(),void d[d.length-1].focus()}},G.prototype._handleMainKeyup=function(a){var c=a.keyCode;c===b.LEFT_ARROW&&(a.stopPropagation(),this.previous());c===b.RIGHT_ARROW&&(a.stopPropagation(),this.next())},G.prototype._zoomToAction=function(a){a.action&&"zoom-to"===a.action.id&&this.viewModel.zoomToLocation()},G.prototype._spinnerEnabledChange=function(a){if(this._destroySpinner(),a)a=
this.get("viewModel.view"),this._createSpinner(a)},G.prototype._displaySpinner=function(){var a=this._spinner;if(a){var b=this.viewModel,c=b.location;return b.waitingForResult?void a.show({location:c}):void a.hide()}},G.prototype._getIconStyles=function(a){return{"background-image":a?"url("+a+")":""}},G.prototype._renderAction=function(a,b,k,h){var q=this,l=c.watch(a,["id","className","title","image","visible"],function(){return q.scheduleRender()});this._handleRegistry.add(l,h);l=this.get("selectedFeature.attributes");
"zoom-to"===a.id&&(a.title=y.zoom,this._handleRegistry.add(c.init(this,"view.animation.state",function(g){a.className="waiting-for-target"===g?d.join("esri-popup__icon","esri-icon-loading-indicator","esri-rotating"):d.join("esri-popup__icon","esri-icon-zoom-in-magnifying-glass")}),h));h=a.title;var v=a.className,z=a.image||v?a.image:E;h=h&&l?r.substitute(l,h):h;v=v&&l?r.substitute(l,v):v;l=z&&l?r.substitute(l,z):z;z=v||"esri-popup__icon";v=(t={},t["esri-popup__action-image"]=!!l,t);t=(O={},O["esri-disabled"]=
-1!==z.indexOf("esri-icon-loading-indicator"),O);k=k<=this._displayActionTextLimit?d.tsx("span",{key:m("action-text-"+b+"-"+a.uid),"class":"esri-popup__action-text"},h):null;return a.visible?d.tsx("div",{key:m("action-"+b+"-"+a.uid),role:"button",tabIndex:0,title:h,"aria-label":h,classes:t,"class":d.join("esri-popup__button","esri-popup__action"),bind:this,"data-action-index":b,onclick:this._triggerAction,onkeydown:this._triggerAction},d.tsx("span",{key:m("action-icon-"+b+"-"+a.uid+"-"+z),"aria-hidden":"true",
"class":z,classes:v,styles:this._getIconStyles(l)}),k):null;var t,O},G.prototype._renderActions=function(){var a=this;this._handleRegistry.remove("actions");var b=this.actions;if(b){var c=b.length;return b.toArray().map(function(b,d){return a._renderAction(b,d,c,"actions")})}},G.prototype._updatePopupRenderer=function(){var a=this.popupRenderers[this.viewModel.selectedFeatureIndex]||null;a&&!a.contentEnabled&&(a.contentEnabled=!0);this._set("selectedPopupRenderer",a)},G.prototype._destroyPopupRenderers=
function(){this.popupRenderers.forEach(function(a){return a.destroy()});this._set("popupRenderers",[])},G.prototype._createPopupRenderers=function(a){var b=this;this._destroyPopupRenderers();var c=[];a&&a.forEach(function(a){a=new q({contentEnabled:!1,graphic:a,view:b.get("viewModel.view")});c.push(a)});this._set("popupRenderers",c)},G.prototype._isScreenLocationWithinView=function(a,b){return-1<a.x&&-1<a.y&&a.x<=b.width&&a.y<=b.height},G.prototype._isOutsideView=function(a){var b=a.popupHeight,c=
a.popupWidth,d=a.screenLocation,m=a.side;a=a.view;if(isNaN(c)||isNaN(b)||!a||!d)return!1;var k=a.padding;return"right"===m&&d.x+c/2>a.width-k.right?!0:"left"===m&&d.x-c/2<k.left?!0:"top"===m&&d.y-b<k.top?!0:"bottom"===m&&d.y+b>a.height-k.bottom?!0:!1},G.prototype._determineCurrentAlignment=function(){var a=this._pointerOffsetInPx,b=this._containerNode,c=this._mainContainerNode,d=this.viewModel,m=d.screenLocation,d=d.view;if(!m||!d||!b)return"top-center";if(!this._isScreenLocationWithinView(m,d))return this._get("currentAlignment")||
"top-center";var k=c?window.getComputedStyle(c,null):null,c=k?parseInt(k.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,k=k?parseInt(k.getPropertyValue("height").replace(/[^-\d\.]/g,""),10):0,h=D.getContentBox(b),b=h.w+a,h=Math.max(h.h,c,k)+a,a=this._isOutsideView({popupHeight:h,popupWidth:b,screenLocation:m,side:"right",view:d}),c=this._isOutsideView({popupHeight:h,popupWidth:b,screenLocation:m,side:"left",view:d}),k=this._isOutsideView({popupHeight:h,popupWidth:b,screenLocation:m,
side:"top",view:d}),m=this._isOutsideView({popupHeight:h,popupWidth:b,screenLocation:m,side:"bottom",view:d});return c?k?"bottom-right":"top-right":a?k?"bottom-left":"top-left":k?m?"top-center":"bottom-center":"top-center"},G.prototype._getCurrentAlignment=function(){var a=this.alignment;return this.dockEnabled?null:"auto"===a?this._determineCurrentAlignment():"function"==typeof a?a.call(this):a},G.prototype._setCurrentAlignment=function(){this._set("currentAlignment",this._getCurrentAlignment())},
G.prototype._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())},G.prototype._getDockPosition=function(){var a=this.get("dockOptions.position");return"auto"===a?this._determineCurrentDockPosition():"function"==typeof a?a.call(this):a},G.prototype._getCurrentDockPosition=function(){return this.dockEnabled?this._getDockPosition():null},G.prototype._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()},G.prototype._renderFeatureMenuItemNode=
function(a,b,c,k){var h=b===c;k=(q={},q["esri-popup__feature-menu-item--selected"]=h,q);a=a.title||y.untitled;h=h?d.tsx("span",{key:m("feature-menu-selected-feature-"+c),title:y.selectedFeature,"aria-label":y.selectedFeature,"class":"esri-icon-check-mark"}):null;return d.tsx("li",{role:"menuitem",tabIndex:-1,key:m("feature-menu-feature-"+c),classes:k,"class":"esri-popup__feature-menu-item",title:a,"aria-label":a,bind:this,"data-feature-index":b,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,
onkeydown:this._selectFeature},d.tsx("span",{"class":"esri-popup__feature-menu-title"},a,h));var q},G.prototype._renderFeatureMenuNode=function(a,b,c,m){var k=this;return 1<a.length?d.tsx("ol",{"class":"esri-popup__feature-menu-list",id:m,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},a.map(function(a,d){return k._renderFeatureMenuItemNode(a,d,b,c)})):null},G.prototype._determineCurrentDockPosition=function(){var a=
this.get("viewModel.view"),b=C.isRtl()?"top-left":"top-right";if(!a)return b;var c=a.padding||{left:0,right:0,top:0,bottom:0},c=a.width-c.left-c.right;return(a=a.get("breakpoints"))&&c<=a.xsmall?"bottom-center":b},G.prototype._renderContent=function(){var a=this.get("viewModel.content");return"string"==typeof a?d.tsx("div",{key:m("content-string"),innerHTML:a}):a&&a.isInstanceOf&&a.isInstanceOf(t)?d.tsx("div",{key:m("content-widget")},a.render()):a instanceof HTMLElement?d.tsx("div",{key:m("content-html-element"),
bind:a,afterUpdate:this._attachToNode,afterCreate:this._attachToNode}):a&&"function"==typeof a.postMixInProperties&&"function"==typeof a.buildRendering&&"function"==typeof a.postCreate&&"function"==typeof a.startup?d.tsx("div",{key:m("content-dijit"),bind:a.domNode,afterUpdate:this._attachToNode,afterCreate:this._attachToNode}):void 0},G.prototype._attachToNode=function(a){a.appendChild(this)},G.prototype._positionContainer=function(a){if(void 0===a&&(a=this._containerNode),a&&(this._containerNode=
a),a){var b=this.viewModel.screenLocation,c=D.getContentBox(a);(b=this._calculatePositionStyle(b,c))&&(a.style.top=b.top,a.style.left=b.left,a.style.bottom=b.bottom,a.style.right=b.right)}},G.prototype._calculateFullWidth=function(a){var b=this.currentAlignment,c=this._pointerOffsetInPx;return"top-left"===b||"bottom-left"===b||"top-right"===b||"bottom-right"===b?a+c:a},G.prototype._calculateAlignmentPosition=function(a,b,c,d){var m=this.currentAlignment,k=this._pointerOffsetInPx;d/=2;var h=c.height-
b;c=c.width-a;return"bottom-center"===m?{top:b+k,left:a-d}:"top-left"===m?{bottom:h+k,right:c+k}:"bottom-left"===m?{top:b+k,right:c+k}:"top-right"===m?{bottom:h+k,left:a+k}:"bottom-right"===m?{top:b+k,left:a+k}:"top-center"===m?{bottom:h+k,left:a-d}:void 0},G.prototype._calculatePositionStyle=function(a,b){var c=this.dockEnabled,d=this.view;if(d){var m=d.padding;if(c)return{left:m.left?m.left+"px":"",top:m.top?m.top+"px":"",right:m.right?m.right+"px":"",bottom:m.bottom?m.bottom+"px":""};if(a&&b&&
(b=this._calculateFullWidth(b.w),a=this._calculateAlignmentPosition(a.x,a.y,d,b)))return{top:void 0!==a.top?a.top+"px":"auto",left:void 0!==a.left?a.left+"px":"auto",bottom:void 0!==a.bottom?a.bottom+"px":"auto",right:void 0!==a.right?a.right+"px":"auto"}}},G.prototype._viewChange=function(a,b){a&&b&&(this.close(),this.clear())},G.prototype._viewReadyChange=function(a,b){if(a)return a=this.get("viewModel.view"),void this._wireUpView(a);b&&(this.close(),this.clear())},G.prototype._wireUpView=function(a){if(this._destroySpinner(),
a)this.spinnerEnabled&&this._createSpinner(a),this._setDockEnabledForViewSize(this.dockOptions)},G.prototype._dockingThresholdCrossed=function(a,b,c){var d=a[0];a=a[1];var m=b[0];b=b[1];var k=c.width;c=c.height;return k>=d&&m>k||d>k&&k>=m||c>=a&&b>c||a>c&&c>=b},G.prototype._updateDockEnabledForViewSize=function(a,b){if(a&&b){var c=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},d=c.left+c.right,m=c.top+c.bottom,c=[],k=[];c[0]=a[0]-d;c[1]=a[1]-m;k[0]=b[0]-d;k[1]=b[1]-m;a=this.dockOptions;
this._dockingThresholdCrossed(c,k,a.breakpoint)&&this._setDockEnabledForViewSize(a);this._setCurrentDockPosition()}},G.prototype._hasFeatureUpdated=function(){var a=this._containerNode,b=this.viewModel.pendingPromisesCount,c=this.get("selectedPopupRenderer.viewModel.waitingForContent");!a||b||c||(a.classList.remove("esri-popup--feature-updated"),a.offsetHeight,a.classList.add("esri-popup--feature-updated"))},G.prototype._focusDockButtonNode=function(a){this._focusDockButton&&(this._focusDockButton=
!1,a.focus())},G.prototype._mainContainerNodeUpdated=function(a){return this._mainContainerNode=a,this._focusContainer?(this._focusContainer=!1,void a.focus()):this._blurContainer?(this._blurContainer=!1,void a.blur()):void 0},G.prototype._featureMenuNodeUpdated=function(a){if(this._featureMenuNode=a,a&&this._focusFirstFeature)this._focusFirstFeature=!1,a=a.querySelectorAll("li"),a.length&&a[0].focus()},G.prototype._focusFeatureMenuButtonNode=function(a){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=
!1,a.focus())},G.prototype._featureMenuViewportNodeUpdated=function(a){a&&(a.scrollTop=0)},G.prototype._toggleScreenLocationEnabled=function(){var a=this.dockEnabled,b=this.visible,c=this.viewModel;c&&(c.screenLocationEnabled=b&&!a)},G.prototype._shouldDockAtCurrentViewSize=function(a){a=a.breakpoint;var b=this.get("viewModel.view.ui"),c=b.width,b=b.height;if(isNaN(c)||isNaN(b))return!1;c=a.hasOwnProperty("width")&&c<=a.width;a=a.hasOwnProperty("height")&&b<=a.height;return c||a},G.prototype._setDockEnabledForViewSize=
function(a){a.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(a))},G.prototype._getPageText=function(a,b){return r.substitute({index:b+1,total:a},y.pageText)},G.prototype._destroySpinner=function(){this._spinner&&(this._spinner.destroy(),this._spinner=null)},G.prototype._createSpinner=function(a){a&&(this._spinner=new B({container:document.createElement("div"),view:a}),a.root.appendChild(this._spinner.container))},G.prototype._closeFeatureMenu=function(){this.featureMenuOpen=!1},G.prototype._toggleCollapsed=
function(){this.collapsed=!this.collapsed},G.prototype._close=function(){this.close();this.view&&this.view.focus()},G.prototype._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled;this._focusDockButton=!0;this.scheduleRender()},G.prototype._toggleFeatureMenu=function(){this.featureMenuOpen=!this.featureMenuOpen},G.prototype._triggerAction=function(a){this.viewModel.triggerAction(a.currentTarget["data-action-index"])},G.prototype._selectFeature=function(a){a=a.currentTarget["data-feature-index"];
isNaN(a)||(this.viewModel.selectedFeatureIndex=a);this._closeFeatureMenu()},G.prototype._next=function(){this.next()},G.prototype._previous=function(){this.previous()},l([u.aliasOf("viewModel.actions"),d.renderable()],G.prototype,"actions",void 0),l([u.property()],G.prototype,"alignment",void 0),l([u.aliasOf("viewModel.autoCloseEnabled")],G.prototype,"autoCloseEnabled",void 0),l([u.aliasOf("viewModel.content"),d.renderable()],G.prototype,"content",void 0),l([u.property(),d.renderable()],G.prototype,
"collapsed",void 0),l([u.property(),d.renderable()],G.prototype,"collapseEnabled",void 0),l([u.property({readOnly:!0,dependsOn:["dockEnabled","alignment"]}),d.renderable()],G.prototype,"currentAlignment",null),l([u.property({readOnly:!0,dependsOn:["dockEnabled","dockOptions"]}),d.renderable()],G.prototype,"currentDockPosition",null),l([u.property(),d.renderable()],G.prototype,"dockOptions",null),l([u.property(),d.renderable()],G.prototype,"dockEnabled",void 0),l([u.aliasOf("viewModel.featureCount"),
d.renderable()],G.prototype,"featureCount",void 0),l([u.property(),d.renderable()],G.prototype,"featureMenuOpen",void 0),l([u.aliasOf("viewModel.features"),d.renderable()],G.prototype,"features",void 0),l([u.property(),d.renderable()],G.prototype,"featureNavigationEnabled",void 0),l([u.aliasOf("viewModel.highlightEnabled")],G.prototype,"highlightEnabled",void 0),l([u.aliasOf("viewModel.location"),d.renderable()],G.prototype,"location",void 0),l([u.property({readOnly:!0}),d.renderable()],G.prototype,
"popupRenderers",void 0),l([u.aliasOf("viewModel.promises")],G.prototype,"promises",void 0),l([u.aliasOf("viewModel.selectedFeature"),d.renderable()],G.prototype,"selectedFeature",void 0),l([u.aliasOf("viewModel.selectedFeatureIndex"),d.renderable()],G.prototype,"selectedFeatureIndex",void 0),l([u.property({readOnly:!0}),d.renderable()],G.prototype,"selectedPopupRenderer",void 0),l([u.property()],G.prototype,"spinnerEnabled",void 0),l([u.aliasOf("viewModel.title"),d.renderable()],G.prototype,"title",
void 0),l([u.aliasOf("viewModel.updateLocationEnabled")],G.prototype,"updateLocationEnabled",void 0),l([u.aliasOf("viewModel.view")],G.prototype,"view",void 0),l([u.property({type:v}),d.renderable("viewModel.screenLocation viewModel.screenLocationEnabled viewModel.state viewModel.pendingPromisesCount viewModel.promiseCount viewModel.waitingForResult".split(" ")),d.vmEvent(["triggerAction","trigger-action"])],G.prototype,"viewModel",void 0),l([u.aliasOf("viewModel.visible"),d.renderable()],G.prototype,
"visible",void 0),l([u.aliasOf("viewModel.clear")],G.prototype,"clear",null),l([u.aliasOf("viewModel.next")],G.prototype,"next",null),l([u.aliasOf("viewModel.previous")],G.prototype,"previous",null),l([u.aliasOf("viewModel.triggerAction")],G.prototype,"triggerAction",null),l([d.accessibleHandler()],G.prototype,"_toggleCollapsed",null),l([d.accessibleHandler()],G.prototype,"_close",null),l([d.accessibleHandler()],G.prototype,"_toggleDockEnabled",null),l([d.accessibleHandler()],G.prototype,"_toggleFeatureMenu",
null),l([d.accessibleHandler()],G.prototype,"_triggerAction",null),l([d.accessibleHandler()],G.prototype,"_selectFeature",null),l([d.accessibleHandler()],G.prototype,"_next",null),l([d.accessibleHandler()],G.prototype,"_previous",null),G=l([u.subclass("esri.widgets.Popup")],G)}(u.declared(t))})},"esri/widgets/Widget":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ../core/Accessor ../core/Evented ../core/HandleRegistry ../core/Logger ../core/watchUtils dojo/_base/lang dojo/dom ./libs/maquette/maquette ../core/Collection".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q){var v=a.getLogger("esri.widgets.Widget"),y=0;return function(a){function d(b,c){b=a.call(this)||this;return b._attached=!1,b.className="",b.destroyed=!1,b.domNode=null,b.visible=!0,b._handles=new r,b.render=b.render.bind(b),b}return w(d,a),d.prototype.normalizeCtorArgs=function(a,d){a=c.mixin({},a);return d&&(a.container=d),a},d.prototype.initialize=function(){var a=this;this._handles.add(this._renderableProps.map(function(b){return k.init(a,b,function(a,c){var d=
this;if(q.isCollection(c)&&this._handles.remove(this.declaredClass+":"+b+"-collection-change-event-listener"),q.isCollection(a))a=a.on("change",function(){return d.scheduleRender()}),this._handles.add(a,this.declaredClass+":"+b+"-collection-change-event-listener");this.scheduleRender()})}));this._delegatedEventNames.length&&this._handles.add(k.init(this,"viewModel",function(){a._get("viewModel")&&a._handles.remove("delegated-events");a._delegatedEventNames.map(function(b){return a.viewModel.on(b,
function(c){a.emit(b,c)})})}),"delegated-events");this.postInitialize();this._handles.add(k.whenOnce(this,"container",function(b){return a._attach(b)}))},d.prototype.postInitialize=function(){},d.prototype.destroy=function(){this.destroyed||(this.viewModel&&this.viewModel.destroy(),this._detach(this.container),this._handles.destroy(),this._set("destroyed",!0))},d.prototype.startup=function(){v.warn("Widget.startup() is deprecated and no longer needed")},Object.defineProperty(d.prototype,"container",
{set:function(a){this._get("container")||this._set("container",a)},enumerable:!0,configurable:!0}),d.prototype.castContainer=function(a){return t.byId(a)},Object.defineProperty(d.prototype,"id",{get:function(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+y++},set:function(a){a&&this._set("id",a)},enumerable:!0,configurable:!0}),d.prototype.scheduleRender=function(){this._projector.scheduleRender()},d.prototype.on=function(a,c){var b=this.inherited(arguments);
return this._handles.add(b),b},d.prototype.own=function(a){1<arguments.length&&(a=Array.prototype.slice.call(arguments));this._handles.add(a)},d.prototype.renderNow=function(){this._projector.renderNow()},d.prototype._attach=function(a){a&&(this._projector.merge(a,this.render),this._attached=!0)},d.prototype._detach=function(a){a&&this._attached&&(this._projector.detach(this.render),a.parentNode&&a.parentNode.removeChild(a),this._attached=!1)},l([h.shared(C.createProjector())],d.prototype,"_projector",
void 0),l([h.shared([])],d.prototype,"_renderableProps",void 0),l([h.shared([])],d.prototype,"_delegatedEventNames",void 0),l([h.property({value:null})],d.prototype,"container",null),l([h.cast("container")],d.prototype,"castContainer",null),l([h.property({readOnly:!0})],d.prototype,"destroyed",void 0),l([h.property({aliasOf:"container"})],d.prototype,"domNode",void 0),l([h.property({dependsOn:["container"]})],d.prototype,"id",null),l([h.property()],d.prototype,"viewModel",void 0),l([h.property()],
d.prototype,"visible",void 0),d=l([h.subclass("esri.widgets.Widget")],d)}(h.declared(d,u))})},"esri/widgets/Popup/PopupRenderer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../support/widget ../Widget ./PopupRendererViewModel ../../core/requireUtils ../support/uriUtils dojo/i18n!./nls/PopupRenderer ../../core/watchUtils dojo/keys".split(" "),function(A,p,w,l,h,d,u,r,a,k,c,t,C){function q(a,c){return void 0===
c?v+"__"+a:v+"__"+a+"-"+c}var v="esri-popup-renderer";return function(v){function y(a){a=v.call(this)||this;return a._chartMap=new Map,a._activeMediaMap=new Map,a._chartRequirePromise=null,a._refreshTimers=new Map,a._mediaInfo=new Map,a.contentEnabled=null,a.graphic=null,a.title=null,a.view=null,a.viewModel=new r,a}return w(y,v),y.prototype.postInitialize=function(){var a=this;this.own(t.init(this,"viewModel.content",function(){return a._setupMediaRefreshTimers()}))},y.prototype.destroy=function(){this._clearMediaRefreshTimers();
this._activeMediaMap.clear();this._activeMediaMap=null;this._cancelChartModules();this._destroyCharts()},y.prototype.render=function(){var a=d.tsx("div",{key:q("loading-container"),"class":"esri-popup-renderer__loading-container"},d.tsx("span",{"class":d.join("esri-icon-loading-indicator esri-rotating","esri-popup-renderer__loading-spinner")})),a=this.viewModel.waitingForContent?a:this._renderContent();return d.tsx("div",{"class":"esri-popup-renderer"},d.tsx("div",{"class":"esri-popup-renderer__size-container"},
d.tsx("div",{"class":"esri-popup-renderer__main-container"},a)))},y.prototype.goToMedia=function(a,b){this._setContentElementMedia(a,b)},y.prototype.nextMedia=function(a){this._pageContentElementMedia(a,"next")},y.prototype.previousMedia=function(a){this._pageContentElementMedia(a,"previous")},y.prototype._cancelChartModules=function(){this._chartRequirePromise&&this._chartRequirePromise.cancel()},y.prototype._destroyChart=function(a){var b=this._chartMap.get(a);b&&(b.chart.destroy(),b.tooltip.destroy());
this._chartMap["delete"](a)},y.prototype._destroyCharts=function(){this._chartMap.forEach(function(a){a.chart.destroy();a.tooltip.destroy()});this._chartMap.clear()},y.prototype._renderContent=function(){this._destroyCharts();var a=this.viewModel.content;return"string"==typeof a?d.tsx("div",{key:q("content-string"),innerHTML:a}):a&&a.isInstanceOf&&a.isInstanceOf(u)?d.tsx("div",{key:q("content-widget")},a.render()):a instanceof HTMLElement?d.tsx("div",{key:q("content-html-element"),bind:a,afterUpdate:this._attachToNode,
afterCreate:this._attachToNode}):a&&"function"==typeof a.postMixInProperties&&"function"==typeof a.buildRendering&&"function"==typeof a.postCreate&&"function"==typeof a.startup?d.tsx("div",{key:q("content-dijit"),bind:a.domNode,afterUpdate:this._attachToNode,afterCreate:this._attachToNode}):Array.isArray(a)?a.length?d.tsx("div",{key:q("content-content-elements")},a.map(this._renderContentElement,this)):null:void 0},y.prototype._renderContentElement=function(a,b){var c=this.viewModel.contentTypes;
switch(a.type){case c.attachments:return this._renderAttachments(a,b);case c.fields:return this._renderFields(a,b);case c.media:return this._renderMedia(a,b);case c.text:return this._renderText(a,b);default:return null}},y.prototype._renderAttachmentInfo=function(a,b){return d.tsx("li",{"class":"esri-popup-renderer__attachments-item",key:q("attachment",b)},d.tsx("a",{"class":"esri-popup-renderer__attachments-item-link",href:a.url,target:"_blank"},d.tsx("span",{"class":d.join("esri-icon-download",
"esri-popup-renderer__attachments-item-icon")}),d.tsx("span",{"class":"esri-popup-renderer__attachments-item-title"},a.name||c.noTitle)))},y.prototype._renderAttachments=function(a,b){return(a=a.attachmentInfos)&&a.length?d.tsx("div",{key:q("attachments-element"),"class":d.join("esri-popup-renderer__attachments","esri-popup-renderer__content-element")},d.tsx("div",{"class":"esri-popup-renderer__attachments-title"},c.attach),d.tsx("ul",{"class":"esri-popup-renderer__attachments-items"},a.map(this._renderAttachmentInfo))):
null},y.prototype._renderFieldInfo=function(a,b){var c=this.viewModel,h=c.formattedAttributes.content[b]||c.formattedAttributes.global,l=a.fieldName,c=a.label||l;a=!(!a.format||!a.format.dateFormat);h=k.autoLink(null==h[l]?"":h[l]);a=(v={},v["esri-popup-renderer__field-data--date"]=a,v);return d.tsx("tr",{key:q("fields-element-info-row",b)},d.tsx("th",{key:q("fields-element-info-row-header",b),"class":"esri-popup-renderer__field-header",innerHTML:c}),d.tsx("td",{key:q("fields-element-info-row-data",
b),"class":"esri-popup-renderer__field-data",classes:a,innerHTML:h}));var v},y.prototype._renderFields=function(a,b){var m=this;return(a=a.fieldInfos)?d.tsx("div",{key:q("fields-element",b),"class":d.join("esri-popup-renderer__fields","esri-popup-renderer__content-element")},d.tsx("table",{summary:c.fieldsSummary,key:q("fields-element-table",b)},d.tsx("tbody",{key:q("fields-element-table-body",b)},a.map(function(a){return m._renderFieldInfo(a,b)})))):null},y.prototype._shouldOpenInNewTab=function(a){void 0===
a&&(a="");return!/^(?:mailto:|tel:)/.test(a.trim().toLowerCase())},y.prototype._clearMediaRefreshTimers=function(){this._refreshTimers.forEach(function(a){return clearTimeout(a)});this._refreshTimers.clear()},y.prototype._clearMediaRefreshTimer=function(a){var b=this._refreshTimers.get(a);b&&(clearTimeout(b),this._refreshTimers["delete"](a))},y.prototype._getImageSource=function(a,b){var c=-1!==a.indexOf("?")?"\x26":"?";a=a.split("#");var d=a[1],d=void 0===d?"":d;return""+a[0]+c+"timestamp\x3d"+b+
(d?"#":"")+d},y.prototype._setupMediaRefreshTimer=function(a){var b=this.get("viewModel.content");if(Array.isArray(b)&&(b=b[a])&&"media"===b.type){var c=this._activeMediaMap.get(a);isNaN(c)&&(c=0);(b=b.mediaInfos[c])&&"image"===b.type&&b.refreshInterval&&this._setRefreshTimeout(a,b)}},y.prototype._setupMediaRefreshTimers=function(){var a=this;this._clearMediaRefreshTimers();var b=this.get("viewModel.content");Array.isArray(b)&&b.forEach(function(b,c){return a._setupMediaRefreshTimer(c)})},y.prototype._updateMediaInfoTimestamp=
function(a,b){var c=Date.now();this._mediaInfo.set(b,{timestamp:c,sourceURL:this._getImageSource(a,c)});this.scheduleRender()},y.prototype._setRefreshTimeout=function(a,b){var c=this,d=b.refreshInterval,k=b.value;d&&(b=6E4*d,this._updateMediaInfoTimestamp(k.sourceURL,a),b=setInterval(function(){c._updateMediaInfoTimestamp(k.sourceURL,a)},b),this._refreshTimers.set(a,b))},y.prototype._renderMediaInfoType=function(a,b){var c=a.value,k=a.title,k=void 0===k?"":k,h=a.type,l=a.refreshInterval,v=c.sourceURL,
c=c.linkURL;return"image"===h?(a=this._shouldOpenInNewTab(c)?"_self":"_blank",v=(l=l?this._mediaInfo.get(b):null)?l.sourceURL:v,b=d.tsx("img",{alt:k,key:q("media-image-"+(l?l.timestamp:0),b),src:v}),(k=c?d.tsx("a",{title:k,href:c,target:a},b):null)?k:b):-1!==h.indexOf("chart")?d.tsx("div",{key:q("chart",b),bind:this,"data-media-info":a,"data-content-element-index":b,"class":"esri-popup-renderer__media-chart",afterCreate:this._getChartDependencies,afterUpdate:this._getChartDependencies}):void 0},y.prototype._getChartDependencies=
function(c){var b=this,d=c["data-media-info"],k=c["data-content-element-index"],h=d.value,q=h.theme||"Claro",l=d.type,d=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],v=q;"string"==typeof q&&(v=q.replace(/\./g,"/"),-1===v.indexOf("/")&&(v="dojox/charting/themes/"+v));d.push(v);this._cancelChartModules();this._chartRequirePromise=a.when(A,d).then(function(a){b._renderChart(c,k,l,h,a[0],a[1],a[2]);b._chartRequirePromise=null})},y.prototype._renderChart=function(a,b,c,d,k,h,q){a=new k(a,
{margins:{l:4,t:4,r:4,b:4}});switch(q&&a.setTheme(q),c){case "pie-chart":a.addPlot("default",{type:"Pie",labels:!1});a.addSeries("Series A",d.fields);break;case "line-chart":a.addPlot("default",{type:"Markers"});a.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});a.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});d.fields.forEach(function(a,b){a.x=b+1});a.addSeries("Series A",d.fields);break;case "column-chart":a.addPlot("default",{type:"Columns",gap:3});a.addAxis("y",
{includeZero:!0,vertical:!0,fixUpper:"minor"});a.addSeries("Series A",d.fields);break;case "bar-chart":a.addPlot("default",{type:"Bars",gap:3}),a.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),a.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),a.addSeries("Series A",d.fields)}c=new h(a);a.render();this._chartMap.set(b,{chart:a,tooltip:c})},y.prototype._renderMediaInfo=function(a,b){this._destroyChart(b);var c=this._renderMediaInfoType(a,b),k=a.title?
d.tsx("div",{key:q("media-title",b),"class":"esri-popup-renderer__media-item-title",innerHTML:a.title}):null;a=a.caption?d.tsx("div",{key:q("media-caption",b),"class":"esri-popup-renderer__media-item-caption",innerHTML:a.caption}):null;return d.tsx("div",{key:q("media-container",b),"class":"esri-popup-renderer__media-item-container"},d.tsx("div",{key:q("media-item-container",b),"class":"esri-popup-renderer__media-item"},c),k,a)},y.prototype._renderMediaStatsItem=function(a,b,c){c="chart"===c?d.join("esri-popup-renderer__media-chart-icon",
"esri-icon-chart"):d.join("esri-popup-renderer__media-image-icon","esri-icon-media");return d.tsx("li",{"class":"esri-popup-renderer__media-image-summary"},d.tsx("span",{"class":"esri-popup-renderer__media-count","aria-label":a},"("+b+")"),d.tsx("span",{"aria-hidden":"true","class":c}))},y.prototype._renderMediaPageButton=function(a,b){var m=(a="previous"===a)?c.previous:c.next,k=a?d.join("esri-popup-renderer__button","esri-popup-renderer__media-previous"):d.join("esri-popup-renderer__button","esri-popup-renderer__media-next"),
h=a?d.join("esri-popup-renderer__icon","esri-popup-renderer__media-previous-icon","esri-icon-left-triangle-arrow"):d.join("esri-popup-renderer__icon","esri-popup-renderer__media-next-icon","esri-icon-right-triangle-arrow"),l=a?d.join("esri-popup-renderer__icon","esri-popup-renderer__media-previous-icon--rtl","esri-icon-right-triangle-arrow"):d.join("esri-popup-renderer__icon","esri-popup-renderer__media-next-icon--rtl","esri-icon-left-triangle-arrow"),v=a?this._previousClick:this._nextClick;return d.tsx("div",
{key:q(a?"previous":"next",b),title:m,tabIndex:0,role:"button","class":k,"data-content-element-index":b,bind:this,onkeydown:v,onclick:v},d.tsx("span",{"aria-hidden":"true","class":h}),d.tsx("span",{"aria-hidden":"true","class":l}),d.tsx("span",{"class":"esri-icon-font-fallback-text"},m))},y.prototype._handleMediaKeyup=function(a){var b=a.currentTarget["data-content-element-index"],c=a.keyCode;c===C.LEFT_ARROW&&(a.stopPropagation(),this.previousMedia(b));c===C.RIGHT_ARROW&&(a.stopPropagation(),this.nextMedia(b))},
y.prototype._renderMedia=function(a,b){a=a.mediaInfos;var m=this._getMediaStats(a),k=m.total,h=(l={},l["esri-popup-renderer--media-pagination-visible"]=1<m.total,l),l=this._renderMediaStatsItem(c.numImages,m.images,"image"),m=this._renderMediaStatsItem(c.numCharts,m.charts,"chart"),v=this._renderMediaPageButton("previous",b),t=this._renderMediaPageButton("next",b),y=this._activeMediaMap.get(b);return isNaN(y)&&(this._activeMediaMap.set(b,0),y=0),k?d.tsx("div",{key:q("media-element",b),"data-content-element-index":b,
bind:this,onkeyup:this._handleMediaKeyup,"class":d.join("esri-popup-renderer__media","esri-popup-renderer__content-element"),classes:h},d.tsx("ul",{"class":"esri-popup-renderer__media-summary"},l,m),d.tsx("div",{key:q("media-element-container",b),"class":"esri-popup-renderer__media-container"},v,this._renderMediaInfo(a[y],b),t)):null;var l},y.prototype._renderText=function(a,b){return a.text?d.tsx("div",{key:q("text-element",b),innerHTML:a.text,"class":d.join("esri-popup-renderer__text","esri-popup-renderer__content-element")}):
null},y.prototype._attachToNode=function(a){a.appendChild(this)},y.prototype._getMediaStats=function(a){var b=0,c=0;return a.forEach(function(a){a=a.type;"image"===a?b++:-1!==a.indexOf("chart")&&c++}),{total:c+b,images:b,charts:c}},y.prototype._setContentElementMedia=function(a,b){this._clearMediaRefreshTimer(a);var c=this.viewModel.content;(c=(c=c&&c[a])&&c.mediaInfos)&&c.length&&(this._activeMediaMap.set(a,(b+c.length)%c.length),this._setupMediaRefreshTimer(a),this.scheduleRender())},y.prototype._pageContentElementMedia=
function(a,b){b="previous"===b?-1:1;b=this._activeMediaMap.get(a)+b;this._setContentElementMedia(a,b)},y.prototype._previousClick=function(a){this.previousMedia(a.currentTarget["data-content-element-index"])},y.prototype._nextClick=function(a){this.nextMedia(a.currentTarget["data-content-element-index"])},l([h.aliasOf("viewModel.contentEnabled")],y.prototype,"contentEnabled",void 0),l([h.aliasOf("viewModel.graphic")],y.prototype,"graphic",void 0),l([h.aliasOf("viewModel.title")],y.prototype,"title",
void 0),l([h.aliasOf("viewModel.view")],y.prototype,"view",void 0),l([h.property({type:r}),d.renderable(["viewModel.waitingForContent","viewModel.content"])],y.prototype,"viewModel",void 0),l([d.accessibleHandler()],y.prototype,"_previousClick",null),l([d.accessibleHandler()],y.prototype,"_nextClick",null),y=l([h.subclass("esri.widgets.Popup.PopupRenderer")],y)}(h.declared(u))})},"esri/widgets/Popup/PopupRendererViewModel":function(){define("../Widget ../../core/Accessor ../../core/date ../../core/Error ../../core/HandleRegistry ../../core/lang ../../core/Logger ../../core/urlUtils ../../core/promiseUtils ../../core/watchUtils ../../request ../../support/arcadeUtils ../../tasks/support/StatisticDefinition ../../tasks/support/Query ../../tasks/QueryTask dojo/promise/all dojo/i18n!dojo/cldr/nls/number dojox/html/entities".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D){var b=/\'/g,m=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,E=/^\s*expression\//i,J=/(\{([^\{\r\n]+)\})/g,G={attachments:"attachments",fields:"fields",media:"media",text:"text"},K=u.getLogger("esri.widgets.Popup.PopupRendererViewModel");return p.createSubclass({declaredClass:"esri.widgets.Popup.PopupRendererViewModel",properties:{content:{readOnly:!0},contentEnabled:!0,contentTypes:{readOnly:!0},formattedAttributes:{readOnly:!0},graphic:{},title:{readOnly:!0},
view:{},waitingForContent:{readOnly:!0}},constructor:function(){this._handles=new h},initialize:function(){this._handles.add([k.watch(this,["graphic","graphic.popupTemplate.title","graphic.popupTemplate.content","graphic.popupTemplate.fieldInfos","contentEnabled"],function(){this._updateGraphic(this.graphic,this.contentEnabled)}.bind(this))]);this._updateGraphic(this.graphic,this.contentEnabled)},destroy:function(){this._handles.destroy();this._handles=null;this._clearRelatedInfo();this._cancelPromises();
this.graphic=null;this._set("title",null);this._set("content",null);this._set("waitingForContent",null)},content:null,contentEnabled:!0,contentTypes:G,formattedAttributes:null,graphic:null,title:"",view:null,waitingForContent:!1,_handles:null,_contentPromise:null,_contentElementPromises:null,_relatedRecordsPromise:null,_relatedRecordsQueryPromises:[],_relatedLayersInfo:null,_relatedInfo:null,_addValuesToHref:function(a,b,c,m){return b=this._trimString(b),d.substitute((b?"{"!==b[0]:1)?m:c,a)},_cancelPromises:function(){this._contentElementPromises&&
(this._contentElementPromises.forEach(function(a){a.cancel()},this),this._contentElementPromises=null);this._contentPromise&&(this._contentPromise.cancel(),this._contentPromise=null);this._relatedRecordsQueryPromises.forEach(function(a){a.cancel()});this._relatedRecordsQueryPromises.length=0;this._relatedRecordsPromise&&(this._relatedRecordsPromise.cancel(),this._relatedRecordsPromise=null)},_clearRelatedInfo:function(){this._relatedInfo=this._relatedLayersInfo=null},_compileContent:function(a,b){var c=
a.content;if(c&&(c.nodeName||c&&c&&"function"==typeof c.postMixInProperties&&"function"==typeof c.buildRendering&&"function"==typeof c.postCreate&&"function"==typeof c.startup||c&&c.isInstanceOf&&c.isInstanceOf(A)))return c;if("string"==typeof c)return this._compileText(a,{type:G.text,text:c}).text;if(Array.isArray(c))return c.map(function(c,d){d=(d=b&&b[d])&&d.value;switch(c.type){case G.attachments:return this._proxyAttachments(c,d);case G.fields:return this._compileFields(a,c);case G.media:return this._compileMedia(a,
c);case G.text:return this._compileText(a,c)}},this);if(c)try{throw new l(this.declaredClass+"::invalid content type.");}catch(W){K.warn(W.stack)}},_compileFields:function(a,b){b=d.clone(b);var c=(a=a.template)&&a.expressionInfos;a=a&&d.clone(a.fieldInfos);a=b.fieldInfos||a;var m=[];return a&&a.forEach(function(a){var b=a.fieldName.toLowerCase();if(a.hasOwnProperty("visible")?a.visible:1)b=this._isExpressionField(b)?this._getExpressionInfo(c,b):null,a.label=b?b.title:a.label,m.push(a)},this),b.fieldInfos=
m,b},_compileMedia:function(a,b){var c,m;b=d.clone(b);var k=b.mediaInfos,h=a.attributes,q=a.layer,l=this.formattedAttributes.global,v=a.substOptions;return k&&(c=[],k.forEach(function(z){m=0;var b=z.value;switch(z.type){case "image":var k=b.sourceURL,k=k&&this._trimString(d.substitute(h,this._fixTokens(k,q)));m=!!k;break;case "pie-chart":case "line-chart":case "column-chart":case "bar-chart":var g,k=b.normalizeField;b.fields=b.fields.map(function(e){return g=this._getLayerFieldInfo(q,e),g?g.name:
e},this);k&&(g=this._getLayerFieldInfo(q,k),b.normalizeField=g?g.name:k);m=b.fields.some(function(e){return d.isDefined(h[e])||-1!==e.indexOf("relationships/")&&this._relatedInfo},this);break;default:return}if(m){z=d.clone(z);var b=z.value,k=z.title?this._processFieldsInLinks(this._fixTokens(z.title,q),h):"",e=z.caption?this._processFieldsInLinks(this._fixTokens(z.caption,q),h):"";if(z.title=k?this._trimString(d.substitute(l,k,v)):"",z.caption=e?this._trimString(d.substitute(l,e,v)):"","image"===
z.type)b.sourceURL=d.substitute(h,this._fixTokens(b.sourceURL,q)),b.linkURL&&(b.linkURL=this._trimString(d.substitute(h,this._fixTokens(b.linkURL,q))));else{var f,n=(k=a.template)&&k.fieldInfos;b.fields.forEach(function(e,g){if(-1!==e.indexOf("relationships/"))e=this._getRelatedChartInfos(q,n,e,b,h,v),Array.isArray(e)?b.fields=e:b.fields[g]=e;else{var a=h[e],a=void 0===a?null:a;f=h[b.normalizeField]||0;a&&f&&(a/=f);var x=n&&this._getFieldInfo(n,e);b.fields[g]={y:a,tooltip:(x&&x.label||e)+":"+this._formatValue(a,
{fieldInfos:n,fieldName:e,layer:q,substOptions:v,preventPlacesFormatting:!!f})}}},this)}c.push(z)}},this)),b.mediaInfos=c,b},_compileText:function(a,b){if((b=d.clone(b))&&b.text){var c=a.attributes,m=this.formattedAttributes.global,k=a.substOptions;a=this._processFieldsInLinks(this._fixTokens(b.text,a.layer),c);b.text=this._trimString(d.substitute(m,a,k))}return b},_compileTitle:function(a){var b="",c=a.title,m=a.layer,k=a.attributes,h=a.substOptions,q=this.formattedAttributes.global;c&&("function"==
typeof c&&(c=c.call(null,{graphic:a.graphic})),"string"==typeof c)&&(a=this._processFieldsInLinks(this._fixTokens(c,m),k),b=this._trimString(d.substitute(q,a,h)));return b},_getExpressionInfo:function(a,b){if(this._isExpressionField(b)){b=b.replace(E,"");b=b.toLowerCase();var c;return a.some(function(a){return a.name.toLowerCase()===b&&(c=a),!!c}),c}},_createGraphicInfo:function(a,b){var c=a.popupTemplate,m=c&&c.title,k=c&&c.content,h=a.layer,q=h&&h._getDateOpts&&h._getDateOpts().properties,l=d.clone(a.attributes)||
{},v={dateFormat:{properties:q,formatter:"DateFormat"+w.getFormat("short-date-short-time")}};return{graphic:a,template:c,title:m,content:k,contentEnabled:b,layer:h,attributes:l,properties:q,substOptions:v}},_fixTokens:function(a,b){return a.replace(J,function(a,c,d){return(a=this._getLayerFieldInfo(b,d))?"{"+a.name+"}":c}.bind(this))},_encodeAttributes:function(a){var c=d.clone(a)||{};return Object.keys(c).forEach(function(a){var d=c[a];"string"==typeof d&&(d=encodeURIComponent(d).replace(b,"\x26apos;"),
c[a]=d)}),c},_formatAttributesToFieldInfos:function(a,b,c,d,m){a.forEach(function(k){var h=k.fieldName,q=this._getLayerFieldInfo(b,h);q&&(h=k.fieldName=q.name);if(m[h]=this._formatValue(m[h],{fieldInfos:a,fieldName:h,layer:b,substOptions:c}),d&&k.format&&k.format.dateFormat)k=d.indexOf(h),-1<k&&d.splice(k,1)},this)},_getArcadeViewingMode:function(a){return a&&"local"===a.viewingMode?"localScene":"globalScene"},_formatAttributes:function(a,b,c,m,k,h,q,l){var v=d.clone(k);if(q&&q.forEach(function(a){var z=
"expression/"+a.name;a=l[a.name];var g=this.view,g=g&&t.getViewInfo({viewingMode:"3d"===g.type?this._getArcadeViewingMode(g):"map",scale:g.scale,spatialReference:g.spatialReference});a=t.executeFunction(a&&a.compiledFunc,t.createExecContext(h,g));"string"==typeof a&&(a=D.encode(a));v[z]=a},this),this._relatedInfo&&Object.keys(this._relatedInfo).forEach(function(a){var z=this._relatedInfo[a];a=this._relatedLayersInfo[a];z&&(z.relatedFeatures.forEach(this._relatedFeaturesAttributes.bind(this,a,k,v)),
z.relatedStatsFeatures.forEach(this._relatedStatsAttributes.bind(this,a,k,v)))},this),a&&this._formatAttributesToFieldInfos(a,b,c,m,v),b){var z=b.typeIdField;Object.keys(k).forEach(function(a){if(-1===a.indexOf("relationships/")){var c=k[a];if(d.isDefined(c)){var g=this._getDomainName(b,h,a,c);d.isDefined(g)?v[a]=g:a===z&&(c=this._getTypeName(b,h,c),d.isDefined(c)&&(v[a]=c))}}},this)}return v},_formatValue:function(a,b){var c=b.fieldInfos,m=b.fieldName,k=b.substOptions,c=c&&this._getFieldInfo(c,m),
h=d.clone(c),c=b.preventPlacesFormatting;(b=this._getLayerFieldInfo(b.layer,m))&&"date"===b.type&&(b=h.format||{},b.dateFormat=b.dateFormat||"short-date-short-time",h.format=b);b=h&&h.format;m="number"==typeof a&&k.dateFormat.properties&&-1===k.dateFormat.properties.indexOf(m)&&(!b||!b.dateFormat);if(!d.isDefined(a)||!h||!d.isDefined(b))return m?this._forceLTR(a):a;var q="",l=[],h=b.hasOwnProperty("places")||b.hasOwnProperty("digitSeparator"),v=b.hasOwnProperty("digitSeparator")?b.digitSeparator:
!0;if(h)q="NumberFormat",d.isDefined(b.places)&&(!c||0<b.places)&&(l.push("places: "+Number(b.places)),q+="("+l.join(",")+")");else{if(!b.dateFormat)return m?this._forceLTR(a):a;q="DateFormat"+w.getFormat(b.dateFormat)||w.getFormat("short-date-short-time")}a=d.substitute({myKey:a},"{myKey:"+q+"}",k)||"";return h&&!v&&B.group&&(a=a.replace(new RegExp("\\"+B.group,"g"),"")),m?this._forceLTR(a):a},_forceLTR:function(a){return"\x26lrm;"+a},_getDomainName:function(a,b,c,d){return(a=a.getFieldDomain&&a.getFieldDomain(c,
{feature:b}))&&a.codedValues?a.getName(d):null},_getFieldInfo:function(a,b){var c;b=b.toLowerCase();for(var d=0;d<a.length;d++){var m=a[d];if(m.fieldName&&m.fieldName.toLowerCase()===b){c=m;break}}return c},_getLayerFieldInfo:function(a,b){return b&&a&&a.getField?a.getField(b):null},_getTypeName:function(a,b){return(a=a.getType&&a.getType(b))&&a.name},_processFieldsInLinks:function(a,b){var c=this._encodeAttributes(b);return a&&(a=a.replace(m,function(a,d,m){return this._addValuesToHref(a,d||m,b,
c)}.bind(this))),a},_proxyAttachments:function(a,b){a=d.clone(a);b&&!(b instanceof l)&&b.attachmentInfos&&b.attachmentInfos.length&&(b=b.attachmentInfos.map(function(a){return a.url=r.addProxy(a.url),a},this),a.attachmentInfos=b);return a},_queryAttachments:function(b){var c=b.layer;if(!c)return a.resolve();"scene"===c.type&&c.associatedLayer&&(c=c.associatedLayer);var d=b.attributes;b=c&&c.objectIdField;d=d&&b&&d[b];return b&&c.get("capabilities.data.supportsAttachment")&&d?this._queryAttachmentInfos(c,
d):void 0},_queryAttachmentInfos:function(a,b){var d=a.url+"/"+a.layerId+"/"+b+"/attachments",m=a.token||"";return c(d,{query:{f:"json",token:m},callbackParamName:"callback"}).then(function(a){a=a.data;return a.attachmentInfos.forEach(function(a){a.url=d+"/"+a.id;m&&(a.url+="?token\x3d"+m);a.objectId=b}),a})},_queryContentElements:function(b){var c=b.content;if(!c||!Array.isArray(c))return a.resolve();var d=[],m={};return c.forEach(function(a,c){a.type===G.attachments&&(a=this._queryAttachments(b))&&
(m[c]=a,d.push(a))},this),this._contentElementPromises=d,0===d.length?a.resolve():a.eachAlways(m).always(function(a){return this._contentElementPromises=null,a}.bind(this))},_trimString:function(a){return(a||"").trim()},_getContent:function(b){var c=b.template,c=c&&c.content;return"function"==typeof c&&(c=c.call(null,{graphic:b.graphic})),c&&"function"==typeof c.then?c:a.resolve(c)},_updateContent:function(b){var c;return b.contentEnabled?(c=this._getContent(b).then(function(a){return b.content=a,
this._queryContentElements(b)}.bind(this)).then(function(a){this._set("content",this._compileContent(b,a))}.bind(this)).otherwise(function(a){K.log("error loading template",a)}.bind(this)).then(function(){this._contentPromise=null}.bind(this)),this._contentPromise=c,c):c=a.resolve()},_isExpressionField:function(a){return E.test(a)},_compileExpressions:function(a){if(a){var b={};return a.forEach(function(a){b[a.name]={compiledFunc:t.createFunction(a.expression)}}),b}},_createFormattedAttributes:function(a){var b=
a.graphic,c=a.attributes,d=a.layer,m=a.template,k=m&&m.fieldInfos,h=m&&m.expressionInfos,q=this._compileExpressions(h),l=a.substOptions,z=a.properties,v={global:this._formatAttributes(k,d,l,z,c,b,h,q),content:[]};a=m&&m.content;return Array.isArray(a)&&a.forEach(function(a,g){a.type===G.fields&&a.fieldInfos&&(v.content[g]=this._formatAttributes(a.fieldInfos,d,l,z,c,b,h,q))},this),v},_queryGraphicInfo:function(a,b){var c=this._createGraphicInfo(a,b);return this._checkForRelatedRecords(c).then(function(){return this._set("formattedAttributes",
this._createFormattedAttributes(c)),this._set("title",this._compileTitle(c)),this._updateContent(c)}.bind(this))},_updateGraphic:function(a,b){this._handles&&(this._clearRelatedInfo(),this._cancelPromises(),this._set("title",""),this._set("content",null),this._set("formattedAttributes",null),this._set("waitingForContent",!1),a)&&(this._set("waitingForContent",!0),this._relatedRecordsPromise=this._queryGraphicInfo(a,b).always(function(){this._relatedRecordsPromise=null;this._relatedRecordsQueryPromises.length=
0;this._set("waitingForContent",!1)}.bind(this)))},_getAllFieldInfos:function(a){var b=[],c=a.template,d=c&&c.fieldInfos;a=a.contentEnabled;if(d&&(b=b.concat(d)),a)c=c&&c.content,Array.isArray(c)&&c.forEach(function(a){b=b.concat(a&&a.fieldInfos)},this);return b},_checkForRelatedRecords:function(b){var c=this._getAllFieldInfos(b).filter(function(a){return a&&a.fieldName&&-1!==a.fieldName.indexOf("relationships/")},this);return b.layer&&c&&0<c.length?this._getRelatedRecords({graphic:b.graphic,fieldsInfo:c}):
a.resolve()},_relatedFeaturesAttributes:function(a,b,c,d){Object.keys(d.attributes).forEach(function(m){if("esriRelCardinalityOneToOne"===a.relation.cardinality){var k=this._toRelatedFieldName([a.relation.id,m]);b[k]=c[k]=d.attributes[m]}},this)},_relatedStatsAttributes:function(a,b,c,d){Object.keys(d.attributes).forEach(function(m){var k=this._toRelatedFieldName([a.relation.id,m]);b[k]=c[k]=d.attributes[m]},this)},_getRelatedChartInfos:function(a,b,c,d,m,k){var h,q,l,z,v,t,g;return h=[],g=this._fromRelatedFieldName(c),
v=g[0],q=this._relatedInfo[v],t=this._relatedLayersInfo[v],q&&q.relatedFeatures.forEach(function(e){var f,n=e.attributes;Object.keys(n).forEach(function(e){e===g[1]&&((f={},z=n[e],d.normalizeField&&(l=-1!==d.normalizeField.indexOf("relationships/")?n[this._fromRelatedFieldName(d.normalizeField)[1]]:m[d.normalizeField]),z&&l&&(z/=l),d.tooltipField)?-1!==d.tooltipField.indexOf("relationships/")?(e=this._fromRelatedFieldName(d.tooltipField)[1],e=n[e],f.tooltip=e+": "+this._formatValue(z,{fieldInfos:b,
fieldName:e,layer:a,substOptions:k,preventPlacesFormatting:!!l})):((e=this._getLayerFieldInfo(a,c))&&(c=e.name),f.tooltip=c+": "+this._formatValue(z,{fieldInfos:b,fieldName:d.tooltipField,layer:a,substOptions:k,preventPlacesFormatting:!!l})):f.tooltip=z,f.y=z,h.push(f))},this)},this),"esriRelCardinalityOneToMany"===t.relation.cardinality||"esriRelCardinalityManyToMany"===t.relation.cardinality?h:h[0]},_getRelatedRecords:function(a){var b=a.graphic;return this._relatedLayersInfo?this._queryRelatedLayers(b).then(function(a){return this._setRelatedRecords(a),
a}.bind(this)):this._getRelatedLayersInfo(a).then(function(a){return Object.keys(a).forEach(function(b){a[b]&&(this._relatedLayersInfo[b].relatedLayerInfo=a[b].data)},this),this._queryRelatedLayers(b).then(function(a){return this._setRelatedRecords(a),a}.bind(this))}.bind(this))},_getRelatedLayersInfo:function(a){var b,d=a.fieldsInfo,m={};return b=a.graphic.layer,this._relatedLayersInfo||(this._relatedLayersInfo={}),d.forEach(function(a){var c,d,m,k,z;if(c=this._fromRelatedFieldName(a.fieldName),
d=c[0],m=c[1],d)this._relatedLayersInfo[d]||((c=b&&b.relationships)&&c.some(function(a){return a.id==d?(z=a,!0):void 0}),z&&(this._relatedLayersInfo[d]={relation:z,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[d]&&(this._relatedLayersInfo[d].relatedFields.push(m),a.statisticType&&(k=new C({statisticType:a.statisticType,onStatisticField:m,outStatisticFieldName:m}),this._relatedLayersInfo[d].outStatistics.push(k)))},this),Object.keys(this._relatedLayersInfo).forEach(function(a){var d,
k;this._relatedLayersInfo[a]&&(d=this._relatedLayersInfo[a].relation,k=b.url+"/"+d.relatedTableId,this._relatedLayersInfo[a].relatedLayerUrl=k,m[a]=c(k,{query:{f:"json"},callbackParamName:"callback"}))},this),y(m)},_queryRelatedLayers:function(a){var b={};return Object.keys(this._relatedLayersInfo).forEach(function(c){b[c]=this._queryRelatedLayer({graphic:a,relatedInfo:this._relatedLayersInfo[c]})},this),y(b)},_queryRelatedLayer:function(a){var b,c,d,m,k,h,l,t,z,E,O,g,e,f;return b=a.graphic,c=b.layer,
d=c.layerId,g=a.relatedInfo,m=g.relatedLayerInfo,e=g.relatedLayerUrl,f=g.relation,m&&m.relationships&&m.relationships.some(function(e){return e.relatedTableId===parseInt(d,10)?(k=e,!0):void 0}),k&&(m.fields.some(function(e){if(e.name===k.keyField)return h=-1!==["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(e.type)?"number":"string",!0}),E="string"===h?k.keyField+"\x3d'"+b.attributes[f.keyField]+"'":k.keyField+"\x3d"+b.attributes[f.keyField],
l=new q({where:E,outFields:g.relatedFields}),g.outStatistics&&0<g.outStatistics.length&&m.supportsStatistics&&(O=new q({where:l.where,outFields:l.outFields,outStatistics:g.outStatistics})),t=new v({url:e}),z=[t.execute(l)],O&&z.push(t.execute(O))),this._relatedRecordsQueryPromises=this._relatedRecordsQueryPromises.concat(z),y(z)},_setRelatedRecords:function(a){this._relatedInfo=[];Object.keys(a).forEach(function(b){if(a[b]){var c=a[b];this._relatedInfo[b]={relatedFeatures:c[0].features};d.isDefined(c[1])&&
(this._relatedInfo[b].relatedStatsFeatures=c[1].features)}},this)},_fromRelatedFieldName:function(a){return-1!==a.indexOf("relationships/")?a.split("/").slice(1):[]},_toRelatedFieldName:function(a){return a&&0<a.length?"relationships/"+a[0]+"/"+a[1]:""}})})},"esri/tasks/support/StatisticDefinition":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/JSONSupport".split(" "),function(A,p,w,
l,h,d){return function(d){function r(a){a=d.call(this)||this;return a.maxPointCount=void 0,a.maxRecordCount=void 0,a.maxVertexCount=void 0,a.onStatisticField=null,a.outStatisticFieldName=null,a.statisticType=null,a}return w(r,d),a=r,r.prototype.clone=function(){return new a({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType})},
l([h.property({type:Number,json:{write:!0}})],r.prototype,"maxPointCount",void 0),l([h.property({type:Number,json:{write:!0}})],r.prototype,"maxRecordCount",void 0),l([h.property({type:Number,json:{write:!0}})],r.prototype,"maxVertexCount",void 0),l([h.property({type:String,json:{write:!0}})],r.prototype,"onStatisticField",void 0),l([h.property({type:String,json:{write:!0}})],r.prototype,"outStatisticFieldName",void 0),l([h.property({type:String,json:{write:!0}})],r.prototype,"statisticType",void 0),
r=a=l([h.subclass("esri.tasks.support.StatisticDefinition")],r);var a}(h.declared(d))})},"esri/tasks/support/Query":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../TimeExtent ../../core/accessorSupport/decorators ../../core/JSONSupport ../../core/lang ../../core/kebabDictionary ../../geometry/SpatialReference ../../geometry/support/typeUtils ../../geometry/support/jsonUtils ../../symbols/support/typeUtils ../../symbols/support/jsonUtils ./QuantizationParameters ./StatisticDefinition".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y){var B=a({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),D=a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",
esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});return function(a){function b(b){b=a.call(this,b)||this;return b.distance=void 0,b.geometry=null,b.geometryPrecision=void 0,b.groupByFieldsForStatistics=null,b.maxAllowableOffset=void 0,b.multipatchOption=null,b.num=void 0,b.objectIds=null,b.orderByFields=null,b.outFields=null,b.outSpatialReference=null,b.outStatistics=null,b.pixelSize=null,b.quantizationParameters=null,b.relationParameter=null,b.resultType=null,
b.returnDistinctValues=!1,b.returnGeometry=!1,b.returnCentroid=!1,b.returnExceededLimitFeatures=!0,b.returnJSON=!1,b.returnM=!1,b.returnZ=!1,b.spatialRelationship="intersects",b.start=void 0,b.sqlFormat=null,b.text=null,b.timeExtent=null,b.units="meters",b.where=null,b}return w(b,a),E=b,b.prototype.writeStart=function(a,b,c){b.resultOffset=this.start;b.resultRecordCount=this.num||10;b.where="1\x3d1"},b.prototype.writeWhere=function(a,b,c){b.where=a||"1\x3d1"},b.prototype.clone=function(){return new E(r.clone({distance:this.distance,
geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,maxAllowableOffset:this.maxAllowableOffset,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,relationParameter:this.relationParameter,resultType:this.resultType,
returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnJSON:this.returnJSON,returnM:this.returnM,returnZ:this.returnZ,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.text,text:this.text,timeExtent:this.timeExtent,units:this.units,where:this.where}))},l([d.property({type:Number,json:{write:!0}})],b.prototype,"distance",void 0),l([d.property({types:c.types,
json:{read:t.fromJSON,write:!0}})],b.prototype,"geometry",void 0),l([d.property({type:Number,json:{write:!0}})],b.prototype,"geometryPrecision",void 0),l([d.property({type:[String],json:{write:!0}})],b.prototype,"groupByFieldsForStatistics",void 0),l([d.property({type:Number,json:{write:!0}})],b.prototype,"maxAllowableOffset",void 0),l([d.property({type:String,json:{write:!0}})],b.prototype,"multipatchOption",void 0),l([d.property({type:Number,json:{read:{source:"resultRecordCount"}}})],b.prototype,
"num",void 0),l([d.property({type:[Number],json:{write:!0}})],b.prototype,"objectIds",void 0),l([d.property({type:[String],json:{write:!0}})],b.prototype,"orderByFields",void 0),l([d.property({type:[String],json:{write:!0}})],b.prototype,"outFields",void 0),l([d.property({type:k,json:{read:{source:"outSR"},write:{target:"outSR"}}})],b.prototype,"outSpatialReference",void 0),l([d.property({type:[y],json:{write:!0}})],b.prototype,"outStatistics",void 0),l([d.property({types:C.types,json:{read:q.read,
write:!0}})],b.prototype,"pixelSize",void 0),l([d.property({type:v,json:{write:!0}})],b.prototype,"quantizationParameters",void 0),l([d.property({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy:function(a){return{enabled:"relation"===this.spatialRelationship}}}}})],b.prototype,"relationParameter",void 0),l([d.property({type:String,json:{write:!0}})],b.prototype,"resultType",void 0),l([d.property({type:Boolean,json:{write:{overridePolicy:function(a){return{enabled:a}}}}})],
b.prototype,"returnDistinctValues",void 0),l([d.property({type:Boolean,json:{write:!0}})],b.prototype,"returnGeometry",void 0),l([d.property({type:Boolean,json:{write:{overridePolicy:function(a){return{enabled:a}}}}})],b.prototype,"returnCentroid",void 0),l([d.property({type:Boolean,json:{write:{overridePolicy:function(a){return{enabled:!a}}}}})],b.prototype,"returnExceededLimitFeatures",void 0),l([d.property({type:Boolean,json:{read:!1,write:!1}})],b.prototype,"returnJSON",void 0),l([d.property({type:Boolean,
json:{write:{overridePolicy:function(a){return{enabled:a}}}}})],b.prototype,"returnM",void 0),l([d.property({type:Boolean,json:{write:{overridePolicy:function(a){return{enabled:a}}}}})],b.prototype,"returnZ",void 0),l([d.property({type:String,json:{read:{source:"spatialRel",reader:B.read},write:{target:"spatialRel",writer:B.write}}})],b.prototype,"spatialRelationship",void 0),l([d.property({type:Number})],b.prototype,"start",void 0),l([d.writer("start"),d.writer("num")],b.prototype,"writeStart",null),
l([d.property({type:String,json:{write:!0}})],b.prototype,"sqlFormat",void 0),l([d.property({type:String,json:{write:!0}})],b.prototype,"text",void 0),l([d.property({type:h,json:{write:!0}})],b.prototype,"timeExtent",void 0),l([d.property({type:String,json:{read:D.read,write:{writer:D.write,overridePolicy:function(a){return{enabled:0<this.distance}}}}})],b.prototype,"units",void 0),l([d.property({type:String,json:{write:{overridePolicy:function(a){return{enabled:null!=a||0<this.start}}}}})],b.prototype,
"where",void 0),l([d.writer("where")],b.prototype,"writeWhere",null),b=E=l([d.subclass("esri.tasks.support.Query")],b);var E}(d.declared(u))})},"esri/TimeExtent":function(){define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/accessorSupport/decorators ./core/JSONSupport".split(" "),function(A,p,w,l,h,d){var u={milliseconds:{getter:"getUTCMilliseconds",setter:"setUTCMilliseconds",multiplier:1},seconds:{getter:"getUTCSeconds",setter:"setUTCSeconds",multiplier:1},
minutes:{getter:"getUTCMinutes",setter:"setUTCMinutes",multiplier:1},hours:{getter:"getUTCHours",setter:"setUTCHours",multiplier:1},days:{getter:"getUTCDate",setter:"setUTCDate",multiplier:1},weeks:{getter:"getUTCDate",setter:"setUTCDate",multiplier:7},months:{getter:"getUTCMonth",setter:"setUTCMonth",multiplier:1},years:{getter:"getUTCFullYear",setter:"setUTCFullYear",multiplier:1},decades:{getter:"getUTCFullYear",setter:"setUTCFullYear",multiplier:10},centuries:{getter:"getUTCFullYear",setter:"setUTCFullYear",
multiplier:100}};return function(d){function a(a,k){a=d.call(this)||this;return a.endTime=null,a.startTime=null,a}return w(a,d),k=a,a.prototype.normalizeCtorArgs=function(a,d){return!a||a instanceof Date?{startTime:a,endTime:d}:a},a.prototype.readEndTime=function(a,d){return null!=d.endTime?new Date(d.endTime):null},a.prototype.writeEndTime=function(a,d,k){d.endTime=a?a.getTime():null},a.prototype.readStartTime=function(a,d){return null!=d.startTime?new Date(d.startTime):null},a.prototype.writeStartTime=
function(a,d,k){d.startTime=a?a.getTime():null},a.prototype.clone=function(){return new k({endTime:this.endTime,startTime:this.startTime})},a.prototype.intersection=function(a){if(!a)return null;var c,d,h=this.startTime?this.startTime.getTime():-(1/0),l=this.endTime?this.endTime.getTime():1/0,y=a.startTime?a.startTime.getTime():-(1/0);a=a.endTime?a.endTime.getTime():1/0;if(y>=h&&l>=y?c=y:h>=y&&a>=h&&(c=h),l>=y&&a>=l?d=l:a>=h&&l>=a&&(d=a),isNaN(c)||isNaN(d))return null;h=new k;return h.startTime=c===
-(1/0)?null:new Date(c),h.endTime=d===1/0?null:new Date(d),h},a.prototype.offset=function(a,d){var c=new k,h=this.startTime,l=this.endTime;return h&&(c.startTime=this._offsetDate(h,a,d)),l&&(c.endTime=this._offsetDate(l,a,d)),c},a.prototype._offsetDate=function(a,d,k){a=new Date(a.getTime());d&&k&&(k=u[k],a[k.setter](a[k.getter]()+d*k.multiplier));return a},l([h.property({type:Date,json:{write:{allowNull:!0}}})],a.prototype,"endTime",void 0),l([h.reader("endTime")],a.prototype,"readEndTime",null),
l([h.writer("endTime")],a.prototype,"writeEndTime",null),l([h.property({type:Date,json:{write:{allowNull:!0}}})],a.prototype,"startTime",void 0),l([h.reader("startTime")],a.prototype,"readStartTime",null),l([h.writer("startTime")],a.prototype,"writeStartTime",null),a=k=l([h.subclass("esri.TimeExtent")],a);var k}(h.declared(d))})},"esri/tasks/support/QuantizationParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/JSONSupport ../../core/kebabDictionary ../../core/lang ../../geometry/Extent".split(" "),
function(A,p,w,l,h,d,u,r,a){var k=u({upperLeft:"upper-left",lowerLeft:"lower-left"});return function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;return a.extent=null,a.mode="view",a.originPosition="upper-left",a}return w(d,c),u=d,d.prototype.clone=function(){return new u(r.clone({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))},l([h.property({type:a,json:{write:!0}})],d.prototype,"extent",void 0),l([h.property({type:String,json:{write:!0}})],
d.prototype,"mode",void 0),l([h.property({type:String,json:{read:k.read,write:k.write}})],d.prototype,"originPosition",void 0),l([h.property({type:Number,json:{write:!0}})],d.prototype,"tolerance",void 0),d=u=l([h.subclass("esri.tasks.support.QuantizationParameters")],d);var u}(h.declared(d))})},"esri/tasks/QueryTask":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/accessorSupport/decorators dojo/_base/lang ../request ./Task ./support/FeatureSet ./support/Query ../geometry ../geometry/support/jsonUtils ../geometry/support/normalizeUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q){return function(a){function v(c){c=a.call(this,c)||this;return c.gdbVersion=null,c.source=null,c}return w(v,a),B=v,v.queryToQueryStringParameters=function(a){var b=a.geometry;a=a.toJSON();if(b&&(a.geometry=JSON.stringify(b),a.geometryType=C.getJsonType(b),a.inSR=b.spatialReference.wkid||JSON.stringify(b.spatialReference)),a.groupByFieldsForStatistics&&(a.groupByFieldsForStatistics=a.groupByFieldsForStatistics.join(",")),a.objectIds&&(a.objectIds=a.objectIds.join(",")),
a.orderByFields&&(a.orderByFields=a.orderByFields.join(",")),a.outFields&&(a.outFields=a.outFields.join(",")),a.outSR?a.outSR=a.outSR.wkid||JSON.stringify(a.outSR):b&&(a.returnGeometry||a.returnCentroid)&&(a.outSR=a.inSR),a.returnGeometry&&delete a.returnGeometry,a.outStatistics&&(a.outStatistics=JSON.stringify(a.outStatistics)),a.pixelSize&&(a.pixelSize=JSON.stringify(a.pixelSize)),a.quantizationParameters&&(a.quantizationParameters=JSON.stringify(a.quantizationParameters)),a.timeExtent)b=a.timeExtent,
a.time=[null!=b.startTime?b.startTime:"null",null!=b.endTime?b.endTime:"null"],delete a.timeExtent;return a},v.prototype.execute=function(a,b){var c=this;return this.rawExecute(a,b).then(function(a){return c._handleExecuteResponse(a)})},v.prototype.rawExecute=function(a,b){var c=this;return q.normalizeCentralMeridian(a.geometry?[a.geometry]:[]).then(function(d){d=c._encode(u.mixin({},c.parsedUrl.query,{f:"json"},c._normalizeQuery(a,d&&d[0])));if(c.source){var m={source:c.source.toJSON()};d.layer=
JSON.stringify(m)}c.gdbVersion&&(d.gdbVersion=c.gdbVersion);d={query:d,callbackParamName:"callback"};return(c.requestOptions||b)&&(d=u.mixin({},c.requestOptions,b,d)),r(c.parsedUrl.path+"/query",d)})},v.prototype.executeRelationshipQuery=function(a,b){a=this._encode(u.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON()));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);a={query:a,callbackParamName:"callback"};return(this.requestOptions||b)&&(a=u.mixin({},this.requestOptions,b,a)),r(this.parsedUrl.path+
"/queryRelatedRecords",a).then(this._handleExecuteRelationshipQueryResponse)},v.prototype.executeForIds=function(a,b){var c=this;return q.normalizeCentralMeridian(a.geometry?[a.geometry]:[]).then(function(d){d=c._encode(u.mixin({},c.parsedUrl.query,{f:"json",returnIdsOnly:!0},c._normalizeQuery(a,d&&d[0])));if(c.source){var m={source:c.source.toJSON()};d.layer=JSON.stringify(m)}c.gdbVersion&&(d.gdbVersion=c.gdbVersion);d={query:d,callbackParamName:"callback"};return(c.requestOptions||b)&&(d=u.mixin({},
c.requestOptions,b,d)),r(c.parsedUrl.path+"/query",d)}).then(this._handleExecuteForIdsResponse)},v.prototype.executeForCount=function(a,b){var c=this;return q.normalizeCentralMeridian(a.geometry?[a.geometry]:[]).then(function(d){d=c._encode(u.mixin({},c.parsedUrl.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},c._normalizeQuery(a,d&&d[0])));if(c.source){var m={source:c.source.toJSON()};d.layer=JSON.stringify(m)}c.gdbVersion&&(d.gdbVersion=c.gdbVersion);d={query:d,callbackParamName:"callback"};
return(c.requestOptions||b)&&(d=u.mixin({},c.requestOptions,b,d)),r(c.parsedUrl.path+"/query",d)}).then(this._handleExecuteForCountResponse)},v.prototype.executeForExtent=function(a,b){var c=this;return q.normalizeCentralMeridian(a.geometry?[a.geometry]:[]).then(function(d){d=c._encode(u.mixin({},c.parsedUrl.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},c._normalizeQuery(a,d&&d[0])));if(c.source){var m={source:c.source.toJSON()};d.layer=JSON.stringify(m)}c.gdbVersion&&(d.gdbVersion=c.gdbVersion);
d={query:d,callbackParamName:"callback"};return(c.requestOptions||b)&&(d=u.mixin({},c.requestOptions,b,d)),r(c.parsedUrl.path+"/query",d)}).then(this._handleExecuteForExtentResponse)},v.prototype._handleExecuteResponse=function(a){return k.fromJSON(a.data)},v.prototype._handleExecuteRelationshipQueryResponse=function(a){a=a.data;var b=a.geometryType,c=a.spatialReference,d={};return a.relatedRecordGroups.forEach(function(a){var m=k.fromJSON({geometryType:b,spatialReference:c,features:a.relatedRecords});
if(null!=a.objectId)d[a.objectId]=m;else for(var h in a)a.hasOwnProperty(h)&&"relatedRecords"!==h&&(d[a[h]]=m)}),d},v.prototype._handleExecuteForIdsResponse=function(a){return a.data.objectIds},v.prototype._handleExecuteForCountResponse=function(a){a=a.data;var b=a.features,c=a.objectIds;if(c)a=c.length;else{if(b)throw Error("Unable to perform query. Please check your parameters.");a=a.count}return a},v.prototype._handleExecuteForExtentResponse=function(a){a=a.data;if(a.hasOwnProperty("extent"))a.extent=
t.Extent.fromJSON(a.extent);else{if(a.features)throw Error("Layer does not support extent calculation.");if(a.hasOwnProperty("count"))throw Error("Layer does not support extent calculation.");}return a},v.prototype._normalizeQuery=function(a,b){return b&&(a=a.clone(),a.geometry=b),B.queryToQueryStringParameters(a)},l([d.property()],v.prototype,"gdbVersion",void 0),l([d.property()],v.prototype,"source",void 0),l([h(0,d.cast(c))],v.prototype,"execute",null),l([h(0,d.cast(c))],v.prototype,"rawExecute",
null),l([h(0,d.cast(c))],v.prototype,"executeForIds",null),l([h(0,d.cast(c))],v.prototype,"executeForCount",null),l([h(0,d.cast(c))],v.prototype,"executeForExtent",null),v=B=l([d.subclass("esri.tasks.QueryTask")],v);var B}(d.declared(a))})},"esri/tasks/support/FeatureSet":function(){define("../../core/kebabDictionary ../../core/JSONSupport ../../core/lang ../../Graphic ../../layers/support/Field ../../geometry/SpatialReference ../../geometry/support/graphicsUtils ../../geometry/support/jsonUtils dojo/_base/lang".split(" "),
function(A,p,w,l,h,d,u,r,a){A=A({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent"});return p.createSubclass({declaredClass:"esri.tasks.support.FeatureSet",getDefaults:function(){return a.mixin(this.inherited(arguments),{features:[]})},properties:{displayFieldName:null,exceededTransferLimit:null,features:{value:null,json:{read:function(a,c){var k,h=d.fromJSON(c.spatialReference);return k=a.map(function(a){var c=
l.fromJSON(a);a=a.geometry&&a.geometry.spatialReference;return c.geometry&&!a&&(c.geometry.spatialReference=h),c}),c.transform&&this._hydrate(c.transform,c.geometryType,k),k}}},fields:{value:null,type:[h]},geometryType:{value:null,json:{read:A.fromJSON}},spatialReference:{type:d}},toJSON:function(a){var c={hasZ:this.hasZ,hasM:this.hasM};return this.displayFieldName&&(c.displayFieldName=this.displayFieldName),this.fields&&(c.fields=this.fields.map(function(a){return a.toJSON()})),this.spatialReference?
c.spatialReference=this.spatialReference.toJSON():this.features[0]&&this.features[0].geometry&&(c.spatialReference=this.features[0].geometry.spatialReference.toJSON()),this.features[0]&&(this.features[0].geometry&&(c.geometryType=r.getJsonType(this.features[0].geometry)),c.features=u._encodeGraphics(this.features,a)),c.exceededTransferLimit=this.exceededTransferLimit,c.transform=this.transform,w.fixJson(c)},quantize:function(a){var c,d,k=a.translate[0],h=a.translate[1],l=a.scale[0],y=a.scale[1],r=
this.features,u=function(a,b,c){var d,m,k,h,q,l,v,t=[];d=0;for(m=a.length;m>d;d++)k=a[d],0<d?(l=b(k[0]),v=c(k[1]),(l!==h||v!==q)&&(t.push([l-h,v-q]),h=l,q=v)):(h=b(k[0]),q=c(k[1]),t.push([h,q]));return 0<t.length?t:null},b=function(a,b,c){return"point"===a?function(a){return a.x=b(a.x),a.y=c(a.y),a}:"polyline"===a||"polygon"===a?function(a){var d,m,k,h,q;k=a.rings||a.paths;q=[];d=0;for(m=k.length;m>d;d++)h=k[d],(h=u(h,b,c))&&q.push(h);return 0<q.length?(a.rings?a.rings=q:a.paths=q,a):null}:"multipoint"===
a?function(a){var d;return d=u(a.points,b,c),0<d.length?(a.points=d,a):null}:"extent"===a?function(a){return a}:void 0}(this.geometryType,function(a){return Math.round((a-k)/l)},function(a){return Math.round((h-a)/y)});c=0;for(d=r.length;d>c;c++)b(r[c].geometry)||(r.splice(c,1),c--,d--);return this.transform=a,this},_hydrate:function(a,c,d){if(a){var k=a.translate[0],h=a.translate[1],l=a.scale[0],t=a.scale[1],r=function(a,b,c){return"esriGeometryPoint"===a?function(a){a.x=b(a.x);a.y=c(a.y)}:"esriGeometryPolyline"===
a||"esriGeometryPolygon"===a?function(a){var d,m,k,h,q,l,v,t=a.rings||a.paths;a=0;for(d=t.length;d>a;a++)for(h=t[a],m=0,k=h.length;k>m;m++)q=h[m],0<m?(l+=q[0],v+=q[1]):(l=q[0],v=q[1]),q[0]=b(l),q[1]=c(v)}:"esriGeometryEnvelope"===a?function(a){a.xmin=b(a.xmin);a.ymin=c(a.ymin);a.xmax=b(a.xmax);a.ymax=c(a.ymax)}:"esriGeometryMultipoint"===a?function(a){var d,m,k,h,q=a.points;a=0;for(d=q.length;d>a;a++)m=q[a],0<a?(k+=m[0],h+=m[1]):(k=m[0],h=m[1]),m[0]=b(k),m[1]=c(h)}:void 0}(c,function(a){return a*
l+k},function(a){return h-a*t});a=0;for(c=d.length;c>a;a++)d[a].geometry&&r(d[a].geometry)}}})})},"esri/layers/support/Field":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/JSONSupport ../../core/kebabDictionary ./domains".split(" "),function(A,p,w,l,h,d,u,r){var a=u({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",
esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});return function(d){function c(a){a=d.call(this)||this;return a.alias=null,a.domain=null,a.editable=!1,a.length=-1,a.name=null,a.nullable=!0,a.type=null,a}return w(c,d),k=c,c.prototype.readDomain=function(a){var c=a&&a.type;return"range"===
c?r.RangeDomain.fromJSON(a):"codedValue"===c?r.CodedValueDomain.fromJSON(a):null},c.prototype.clone=function(){return new k({alias:this.alias,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type})},l([h.property({type:String,json:{write:!0}})],c.prototype,"alias",void 0),l([h.property({types:r.types,json:{write:!0}})],c.prototype,"domain",void 0),l([h.reader("domain")],c.prototype,"readDomain",null),l([h.property({type:Boolean,
json:{write:!0}})],c.prototype,"editable",void 0),l([h.property({type:Number,json:{write:!0}})],c.prototype,"length",void 0),l([h.property({type:String,json:{write:!0}})],c.prototype,"name",void 0),l([h.property({type:Boolean,json:{write:!0}})],c.prototype,"nullable",void 0),l([h.property({type:String,json:{read:a.read,write:a.write}})],c.prototype,"type",void 0),c=k=l([h.subclass("esri.layers.support.Field")],c);var k}(h.declared(d))})},"esri/layers/support/domains":function(){define("require exports ./Domain ./RangeDomain ./CodedValueDomain ./InheritedDomain".split(" "),
function(A,p,w,l,h,d){Object.defineProperty(p,"__esModule",{value:!0});p.DomainBase=w;p.RangeDomain=l;p.CodedValueDomain=h;p.InheritedDomain=d;p.types={key:"type",base:p.DomainBase,typeMap:{range:p.RangeDomain,"coded-value":p.CodedValueDomain}}})},"esri/layers/support/Domain":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/JSONSupport ../../core/kebabDictionary".split(" "),function(A,
p,w,l,h,d,u){var r=u({inherited:"inherited",codedValue:"coded-value",range:"range"});return function(a){function d(c){c=a.call(this,c)||this;return c.name=null,c.type=null,c}return w(d,a),l([h.property({json:{write:!0}})],d.prototype,"name",void 0),l([h.property({json:{read:r.read,write:r.write}})],d.prototype,"type",void 0),d=l([h.subclass("esri.layers.support.Domain")],d)}(h.declared(d))})},"esri/layers/support/RangeDomain":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ./Domain".split(" "),
function(A,p,w,l,h,d){return function(d){function r(a){a=d.call(this,a)||this;return a.maxValue=null,a.minValue=null,a.type="range",a}return w(r,d),a=r,r.prototype.clone=function(){return new a({maxValue:this.maxValue,minValue:this.minValue,name:this.name})},l([h.property({json:{read:{source:"range",reader:function(a,c){return c.range&&c.range[1]}},write:{target:"range",writer:function(a,c,d){c[d]=[this.minValue,a]}}}})],r.prototype,"maxValue",void 0),l([h.property({json:{read:{source:"range",reader:function(a,
c){return c.range&&c.range[0]}},write:{target:"range",writer:function(a,c,d){c[d]=[a,this.maxValue]}}}})],r.prototype,"minValue",void 0),l([h.property()],r.prototype,"type",void 0),r=a=l([h.subclass("esri.layers.support.RangeDomain")],r);var a}(h.declared(d))})},"esri/layers/support/CodedValueDomain":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ./Domain ../../core/lang".split(" "),function(A,
p,w,l,h,d,u){return function(d){function a(a){a=d.call(this,a)||this;return a.codedValues=null,a.type="coded-value",a}return w(a,d),k=a,a.prototype.writeCodedValues=function(a,d){var c=null;a&&(c=a.map(function(a){return u.fixJson(u.clone(a))}));d.codedValues=c},a.prototype.getName=function(a){var c=null;if(this.codedValues){var d=String(a);this.codedValues.some(function(a){return String(a.code)===d&&(c=a.name),!!c})}return c},a.prototype.clone=function(){return new k({codedValues:u.clone(this.codedValues),
name:this.name})},l([h.property({json:{write:!0}})],a.prototype,"codedValues",void 0),l([h.writer("codedValues")],a.prototype,"writeCodedValues",null),l([h.property()],a.prototype,"type",void 0),a=k=l([h.subclass("esri.layers.support.CodedValueDomain")],a);var k}(h.declared(d))})},"esri/layers/support/InheritedDomain":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ./Domain".split(" "),function(A,
p,w,l,h,d){return function(d){function r(a){a=d.call(this,a)||this;return a.type="inherited",a}return w(r,d),a=r,r.prototype.clone=function(){return new a},l([h.property()],r.prototype,"type",void 0),r=a=l([h.subclass("esri.layers.support.InheritedDomain")],r);var a}(h.declared(d))})},"esri/geometry/support/graphicsUtils":function(){define(["require","exports","dojo/_base/array","../Extent","../../core/Collection"],function(A,p,w,l,h){Object.defineProperty(p,"__esModule",{value:!0});p.graphicsExtent=
function(d){if(!d||!d.length)return null;var u=h.isCollection(d)?d.getItemAt(0).geometry:d[0].geometry,r=u.extent,a=u;null===r&&(r=new l(a.x,a.y,a.x,a.y,u.spatialReference));for(var k=1;k<d.length;k++){var a=u=h.isCollection(d)?d.getItemAt(k).geometry:d[k].geometry,c=u.extent;null===c&&(c=new l(a.x,a.y,a.x,a.y,u.spatialReference));r=r.clone().union(c)}return 0>r.width&&0>r.height?null:r};p.getGeometries=function(d){return w.map(d,function(d){return d.geometry})};p._encodeGraphics=function(d,h){var l=
[];return w.forEach(d,function(a,d){a=a.toJSON();var c={};if(a.geometry){var k=h&&h[d];c.geometry=k&&k.toJSON()||a.geometry}a.attributes&&(c.attributes=a.attributes);l[d]=c}),l}})},"esri/geometry/support/normalizeUtils":function(){define("require exports ../../core/Error ../../core/Logger ../../core/promiseUtils ../../config ../../tasks/GeometryService ../Polygon ../Polyline ../SpatialReference ./webMercatorUtils ./spatialReferenceUtils".split(" "),function(A,p,w,l,h,d,u,r,a,k,c,t){function C(a){return"polygon"===
a.type?a.rings:a.paths}function q(a,b){return Math.ceil((a-b)/(2*b))}function v(a,b){for(var c=C(a),d=0;d<c.length;d++)for(var m=c[d],k=0;k<m.length;k++){var h=a.getPoint(d,k);a.setPoint(d,k,h.clone().offset(b,0))}return a}function y(a){for(var b=[],c=0,d=0,m=0;m<a.length;m++){for(var k=a[m],h=null,q=0;q<k.length;q++)h=k[q],b.push(h),0===q?(c=h[0],d=c):(c=Math.min(c,h[0]),d=Math.max(d,h[0]));h&&b.push([(c+d)/2,0])}return b}function B(b,c){if(!(b instanceof a||b instanceof r))throw E.error("straightLineDensify: the input geometry is neither polyline nor polygon"),
new w("straightLineDensify: the input geometry is neither polyline nor polygon");for(var d=[],m=0,k=C(b);m<k.length;m++){var h=k[m],q=[];d.push(q);q.push([h[0][0],h[0][1]]);for(var l=0;l<h.length-1;l++){var v=h[l][0],y=h[l][1],t=h[l+1][0],z=h[l+1][1],B=Math.sqrt((t-v)*(t-v)+(z-y)*(z-y)),O=(z-y)/B,g=(t-v)/B,e=B/c;if(1<e){for(var f=1;e-1>=f;f++){var n=f*c;q.push([g*n+v,O*n+y])}B=(B+Math.floor(e-1)*c)/2;q.push([g*B+v,O*B+y])}q.push([t,z])}}return"polygon"===b.type?new r({rings:d,spatialReference:b.spatialReference}):
new a({paths:d,spatialReference:b.spatialReference})}function D(a,b,d){b&&(a=B(a,1E6),a=c.webMercatorToGeographic(a,!0));return d&&(a=v(a,d)),a}function b(a,b,c){if(Array.isArray(a)){var d=a[0];if(d>b){var m=q(d,b);a[0]=d+-2*m*b}else c>d&&(m=q(d,c),a[0]=d+-2*m*c)}else d=a.x,d>b?(m=q(d,b),a=a.clone().offset(-2*m*b,0)):c>d&&(m=q(d,c),a=a.clone().offset(-2*m*c,0));return a}function m(a,b){var c=-1;return b.cutIndexes.forEach(function(d,m){var k=b.geometries[m];if(C(k).forEach(function(a,b){a.some(function(c){if(180>
c[0])return!0;for(var d=c=0;d<a.length;d++){var z=a[d][0];c=z>c?z:c}c=Number(c.toFixed(9));c=-360*q(c,180);for(d=0;d<a.length;d++)z=k.getPoint(b,d),k.setPoint(b,d,z.clone().offset(c,0));return!0})}),d===c)if("polygon"===a[0].type){m=0;for(var h=C(k);m<h.length;m++)a[d]=a[d].addRing(h[m])}else{if("polyline"===a[0].type)for(m=0,h=C(k);m<h.length;m++)a[d]=a[d].addPath(h[m])}else c=d,a[d]=k}),a}Object.defineProperty(p,"__esModule",{value:!0});var E=l.getLogger("esri.geometry.support.normalizeUtils");
p.straightLineDensify=B;var J;p.normalizeCentralMeridian=function(l,y){y||(y=(J||(J=new u({url:d.geometryServiceUrl})),J));for(var E,B,C,G,p,w,K,A,X=0,z=[],Z=l.map(function(e){if(!e||(E||(E=e.spatialReference,B=t.getInfo(E),C=E.isWebMercator,G=C?2.0037508342788905E7:180,p=C?-2.0037508342788905E7:-180,w=C?102100:4326,K=new a({paths:[[[G,p],[G,G]]],spatialReference:new k({wkid:w})}),A=new a({paths:[[[p,p],[p,G]]],spatialReference:new k({wkid:w})})),!B))return e;if("point"===e.type)return b(e.clone(),
G,p);if("multipoint"===e.type){var f=e.clone();return f.points=f.points.map(function(e){return b(e,G,p)}),f}if("extent"===e.type)return f=e.clone(),f=f._normalize(!1,!1,B),f.rings?new r(f):f;if(e.extent){var f=e.extent,n=2*q(f.xmin,p)*G;e=0===n?e.clone():v(e.clone(),n);return f.offset(n,0),f.intersects(K)&&f.xmax!==G?(X=f.xmax>X?f.xmax:X,e=D(e,C),z.push(e),"cut"):f.intersects(A)&&f.xmin!==p?(X=2*f.xmax*G>X?2*f.xmax*G:X,e=D(e,C,360),z.push(e),"cut"):e}return e.clone()}),O=q(X,G),g=-90,e=O,f=new a;0<
O;){var n=-180+360*O;f.addPath([[n,g],[n,-1*g]]);g*=-1;O--}return 0<z.length&&0<e?y.cut(z,f).then(function(e){return m(z,e)}).then(function(e){var f=[],n=Z.map(function(n,a){if("cut"!==n)return n;n=e.shift();a=l[a];return"polygon"===a.type&&a.rings&&1<a.rings.length&&n.rings.length>=a.rings.length?(f.push(n),"simplify"):C?c.geographicToWebMercator(n):n});return f.length?y.simplify(f).then(function(e){return n.map(function(f){return"simplify"!==f?f:C?c.geographicToWebMercator(e.shift()):e.shift()})}):
Z}):h.resolve(Z.map(function(e){if("cut"!==e)return e;e=z.shift();return!0===C?c.geographicToWebMercator(e):e}))};p.getDenormalizedExtent=function(a){if(!a)return null;var b=a.extent;if(!b)return null;var c=a.spatialReference&&t.getInfo(a.spatialReference);if(!c)return b;var c=c.valid,d=c[0],c=c[1],m=b.width,k=b.xmin,h=b.xmax;if(l=[h,k],k=l[0],h=l[1],"extent"===a.type||0===m||c>=m||m>2*c||d>k||h>c)return b;var q;switch(a.type){case "polygon":if(!(1<a.rings.length))return b;q=y(a.rings);break;case "polyline":if(!(1<
a.paths.length))return b;q=y(a.paths);break;case "multipoint":q=a.points}a=b.clone();for(l=0;l<q.length;l++)d=q[l][0],0>d?(d+=c,h=Math.max(d,h)):(d-=c,k=Math.min(d,k));return a.xmin=k,a.xmax=h,a.width<m?(a.xmin-=c,a.xmax-=c,a):b;var l}})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(A){var p=A.getObject("dojox.html.entities",!0),w=function(h,d){var l,r;if(d._encCache&&d._encCache.regexp&&d._encCache.mapper&&d.length==d._encCache.length)l=d._encCache.mapper,r=d._encCache.regexp;
else{l={};r=["["];var a;for(a=0;a<d.length;a++)l[d[a][0]]="\x26"+d[a][1]+";",r.push(d[a][0]);r.push("]");r=new RegExp(r.join(""),"g");d._encCache={mapper:l,regexp:r,length:d.length}}return h=h.replace(r,function(a){return l[a]})},l=function(h,d){var l,r;if(d._decCache&&d._decCache.regexp&&d._decCache.mapper&&d.length==d._decCache.length)l=d._decCache.mapper,r=d._decCache.regexp;else{l={};r=["("];var a;for(a=0;a<d.length;a++){var k="\x26"+d[a][1]+";";a&&r.push("|");l[k]=d[a][0];r.push(k)}r.push(")");
r=new RegExp(r.join(""),"g");d._decCache={mapper:l,regexp:r,length:d.length}}return h=h.replace(r,function(a){return l[a]})};p.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];p.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],
["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca",
"Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4",
"auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe",
"thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2",
"beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],
["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],
["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295",
"oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e",
"lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];p.encode=function(h,d){h&&(d?h=w(h,d):(h=w(h,p.html),h=w(h,p.latin)));return h};p.decode=function(h,d){h&&(d?h=l(h,d):(h=l(h,p.html),h=l(h,p.latin)));return h};return p})},"esri/widgets/support/uriUtils":function(){define(["require",
"exports","../../core/lang","dojo/i18n!./nls/uriUtils"],function(A,p,w,l){function h(h){var l=null;return d.some(function(a){return a.pattern.test(h)&&(l=a),!!l}),l}Object.defineProperty(p,"__esModule",{value:!0});var d=[{id:"http",pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:l.view},{id:"tel",pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"mailto",pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"arcgis-appstudio-player",pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,
label:l.openInApp,appName:"App Studio Player"},{id:"arcgis-collector",pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:l.openInApp,appName:"Collector"},{id:"arcgis-explorer",pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:l.openInApp,appName:"Explorer"},{id:"arcgis-navigator",pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:l.openInApp,appName:"Navigator"},{id:"arcgis-survey123",pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:l.openInApp,appName:"Survey123"},{id:"arcgis-trek2there",
pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:l.openInApp,appName:"Trek2There"},{id:"arcgis-workforce",pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:l.openInApp,appName:l.workforce},{id:"iform",pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:l.openInApp,appName:"iForm"},{id:"flow",pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:l.openInApp,appName:"FlowFinity"},{id:"lfmobile",pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:l.openInApp,appName:"Laserfische"},{id:"mspbi",pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,
label:l.openInApp,appName:"Microsoft Power Bi"}];p.autoLink=function(d){if("string"!=typeof d||!d)return d;var l=h(d);if(!l)return d;var a=d.match(l.pattern),a=w.substitute({appName:l.appName,hierPart:a&&a[2]},l.label);return d.replace(l.pattern,"\x3ca "+(l.target?'target\x3d"'+l.target+'"':"")+'" href\x3d"$1"\x3e'+a+"\x3c/a\x3e")}})},"esri/widgets/Popup/PopupViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/Collection ../../core/Error ../../core/HandleRegistry ../../core/promiseUtils ../../core/watchUtils ../../geometry/geometryEngine ../../geometry/support/webMercatorUtils ../../support/Action ../support/AnchorElementViewModel ../../core/accessorSupport/decorators".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v){function y(a,b){return b.allLayerViews.find(function(b){return b.layer===a})}A=new C({id:"zoom-to"});var B=new (d.ofType(C))([A]);return function(h){function b(a){a=h.call(this)||this;return a._handles=new r,a._originalActions=null,a.actions=B,a.goToOptions=null,a.autoCloseEnabled=!1,a.content=null,a.highlightEnabled=!0,a.title=null,a.updateLocationEnabled=!0,a.view=null,a.visible=!1,a.zoomFactor=4,a}return w(b,h),b.prototype.initialize=function(){this._handles.add([this.on("view-change",
this._autoClose),k.watch(this,["highlightEnabled","selectedFeature","visible","view"],this._highlightFeature),k.watch(this,"selectedFeature.popupTemplate.actions",this._getSelectedFeatureActions),k.watch(this,"selectedFeature.popupTemplate.overwriteActions",this._getSelectedFeatureActions)])},b.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null},Object.defineProperty(b.prototype,"featureCount",{get:function(){return this.features.length},enumerable:!0,configurable:!0}),
Object.defineProperty(b.prototype,"features",{get:function(){return this._get("features")||[]},set:function(a){a=a||[];this._set("features",a);var b=this.pendingPromisesCount,c=this.selectedFeatureIndex,d=this.promiseCount&&a.length;return d&&b&&-1===c?void(this.selectedFeatureIndex=0):void(d&&-1!==c||(this.selectedFeatureIndex=a.length?0:-1))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"location",{get:function(){return this._get("location")||null},set:function(a){var b=this.get("location"),
c=this.get("view.spatialReference.isWebMercator");a&&a.get("spatialReference.isWGS84")&&c&&(a=t.geographicToWebMercator(a));this._set("location",a);a!==b&&this._centerAtLocation()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"pendingPromisesCount",{get:function(){return this.promises.filter(function(a){return a&&!a.isFulfilled()}).length},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"waitingForResult",{get:function(){return 0<this.pendingPromisesCount&&0===
this.featureCount},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"promiseCount",{get:function(){return this.promises.length},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"promises",{get:function(){return this._get("promises")||[]},set:function(b){var c=this;this._get("promises").forEach(function(a){a.cancel()});this.features=[];this._set("promises",b);b.length&&(b=b.slice(0),b.forEach(function(a){a.always(function(b){c.notifyChange("pendingPromisesCount");
c._updateFeatures(a,b)})}),a.eachAlways(b).then(function(){c.featureCount||(c.visible=!1)}))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"selectedFeature",{get:function(){var a=this.selectedFeatureIndex,b=this.updateLocationEnabled;return-1===a?null:(a=this.features[a])?(b&&(this.location=this._getPointFromGeometry(a.geometry)),a):null},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"selectedFeatureIndex",{get:function(){var a=this._get("selectedFeatureIndex");
return"number"==typeof a?a:-1},set:function(a){var b=this.featureCount;a=isNaN(a)||-1>a||!b?-1:(a+b)%b;this._set("selectedFeatureIndex",a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0}),b.prototype.centerAtLocation=function(){var b=this.location,c=this.view;return b&&c?c.goTo({target:b,scale:c.scale},this.goToOptions):a.reject(new u(this.declaredClass+"::Cannot center at location without a location and view."))},
b.prototype.clear=function(){this.set({promises:[],features:[],content:null,title:null,location:null})},b.prototype.triggerAction=function(a){(a=this.actions.getItemAt(a))&&this.emit("trigger-action",{action:a})},b.prototype.next=function(){return this.selectedFeatureIndex+=1,this},b.prototype.previous=function(){return--this.selectedFeatureIndex,this},b.prototype.zoomToLocation=function(){var b=this,c=this.location,d=this.selectedFeature,k=this.view,h=this.zoomFactor;if(!c||!k)return a.reject(new u(this.declaredClass+
"::Cannot zoom to location without a location and view."));var h=k.scale/h,q=this.get("selectedFeature.geometry"),l=d&&"3d"===k.type,c=(l=q||l)?d:c,v=l&&q&&"point"===q.type&&this._isScreenSize(d);return k.goTo({target:c,scale:v?h:void 0},this.goToOptions).then(function(){v&&"point"===q.type&&(b.location=q)})},b.prototype._autoClose=function(){this.autoCloseEnabled&&(this.visible=!1)},b.prototype._isScreenSize=function(a){var b=this.view;return"3d"!==b.type||"esri.Graphic"!==a.declaredClass?!0:(b=
b.getViewForGraphic(a))&&b.whenGraphicBounds?b.whenGraphicBounds(a).then(function(a){return!a||a[0]===a[3]&&a[1]===a[4]&&a[2]===a[5]}):!0},b.prototype._getSelectedFeatureActions=function(){this._originalActions&&(this.actions=this._originalActions,this._originalActions=null);var a=this.actions.filter(function(a){return!a.temporary}),b=this.get("selectedFeature.popupTemplate");b&&b.overwriteActions&&(this._originalActions=a);this.actions=this._getNewActions(b,a)},b.prototype._getNewActions=function(a,
b){if(!a||!a.actions)return b;var c=a.actions;return c.forEach(function(a){a.temporary=!0}),a.overwriteActions?c:b.concat(c)},b.prototype._getPointFromGeometry=function(a){return a?"point"===a.type?a:"extent"===a.type?a.center:"polygon"===a.type?a.centroid:"multipoint"===a.type?a.extent.center:"polyline"===a.type?a.extent.center:null:null},b.prototype._centerAtLocation=function(){var a=this.location,b=this.updateLocationEnabled,d=this.get("view.extent");b&&d&&a&&!c.contains(d,a)&&this.centerAtLocation()},
b.prototype._highlightFeature=function(){this._handles.remove("highlight");var a=this.selectedFeature,b=this.highlightEnabled,c=this.view,d=this.visible;a&&c&&b&&d&&(b=a.layer)&&(c=y(b,c))&&"function"==typeof c.highlight&&(b=b.objectIdField,d=a.attributes,a=c.highlight(d&&d[b]||a,{}),this._handles.add(a,"highlight"))},b.prototype._updateFeatures=function(a,b){var c=this.features;if(a&&b&&b.length&&!(!this._validatePromise(a)||b instanceof u||b instanceof Error)){if(!c.length)return void(this.features=
b);a=b.filter(function(a){return-1===c.indexOf(a)});this.features=c.concat(a)}},b.prototype._validatePromise=function(a){return!a.isCanceled()&&-1<this.promises.indexOf(a)},l([v.property({type:d.ofType(C)})],b.prototype,"actions",void 0),l([v.property()],b.prototype,"goToOptions",void 0),l([v.property()],b.prototype,"autoCloseEnabled",void 0),l([v.property()],b.prototype,"content",void 0),l([v.property({readOnly:!0,dependsOn:["features"]})],b.prototype,"featureCount",null),l([v.property()],b.prototype,
"features",null),l([v.property()],b.prototype,"highlightEnabled",void 0),l([v.property()],b.prototype,"location",null),l([v.property({readOnly:!0,dependsOn:["promises"]})],b.prototype,"pendingPromisesCount",null),l([v.property({readOnly:!0,dependsOn:["featureCount","pendingPromisesCount"]})],b.prototype,"waitingForResult",null),l([v.property({readOnly:!0,dependsOn:["promises"]})],b.prototype,"promiseCount",null),l([v.property()],b.prototype,"promises",null),l([v.property({value:null,readOnly:!0,dependsOn:["features",
"selectedFeatureIndex","updateLocationEnabled"]})],b.prototype,"selectedFeature",null),l([v.property({value:-1})],b.prototype,"selectedFeatureIndex",null),l([v.property({readOnly:!0,dependsOn:["view.ready"]})],b.prototype,"state",null),l([v.property()],b.prototype,"title",void 0),l([v.property()],b.prototype,"updateLocationEnabled",void 0),l([v.property()],b.prototype,"view",void 0),l([v.property()],b.prototype,"visible",void 0),l([v.property()],b.prototype,"zoomFactor",void 0),l([v.property()],b.prototype,
"centerAtLocation",null),l([v.property()],b.prototype,"clear",null),l([v.property()],b.prototype,"triggerAction",null),l([v.property()],b.prototype,"next",null),l([v.property()],b.prototype,"previous",null),l([v.property()],b.prototype,"zoomToLocation",null),b=l([v.subclass("esri.widgets.Popup.PopupViewModel")],b)}(v.declared(q))})},"esri/geometry/geometryEngine":function(){define("require exports ../kernel ./Geometry ./Polygon ./Polyline ./Point ./Extent ./Multipoint dojo/_base/lang".split(" "),
function(A,p,w,l,h,d,u,r,a,k){function c(b){if(void 0===u.fromJson){if(void 0!==b.x&&void 0!==b.y)return new u(b);if(void 0!==b.paths)return new d(b);if(void 0!==b.rings)return new h(b);if(void 0!==b.points)return new a(b);if(void 0!==b.xmin&&void 0!==b.ymin&&void 0!==b.xmax&&void 0!==b.ymax)return new r(b)}else{if(void 0!==b.x&&void 0!==b.y)return u.fromJson(b);if(void 0!==b.paths)return d.fromJson(b);if(void 0!==b.rings)return h.fromJson(b);if(void 0!==b.points)return a.fromJson(b);if(void 0!==
b.xmin&&void 0!==b.ymin&&void 0!==b.xmax&&void 0!==b.ymax)return r.fromJson(b)}}function t(b){if(void 0===u.fromJson){if(void 0!==b.x&&void 0!==b.y)return new u(b);if(void 0!==b.paths)return new d(b);if(void 0!==b.rings)return new h(b);if(void 0!==b.points)return new a(b);if(void 0!==b.xmin&&void 0!==b.ymin&&void 0!==b.xmax&&void 0!==b.ymax)return new r(b)}else{if(void 0!==b.x&&void 0!==b.y)return u.fromJSON(b);if(void 0!==b.paths)return d.fromJSON(b);if(void 0!==b.rings)return h.fromJSON(b);if(void 0!==
b.points)return a.fromJSON(b);if(void 0!==b.xmin&&void 0!==b.ymin&&void 0!==b.xmax&&void 0!==b.ymax)return r.fromJSON(b)}}function C(a,b){var z;if(null==a||void 0===a||"number"===typeof a)return a;var g=a.toString();if(""===g)return null;if(2==b){if(z=V[g],void 0!==z)return z}else if(0==b){z=R[g];if(void 0!==z)return z;z=Q[a];if(void 0!==z)return z}else if(3==b&&(z=R[g],void 0!==z))return z;if(1==b&&(z=Q[a],void 0!==z))return z;if(!0===/^\d+$/.test(g))return parseInt(g);throw Error("Unrecognised Unit Type");
}function q(a){if(void 0!==a&&null!==a)switch(a){case "loxodrome":return 1;case "great-elliptic":return 2;case "normal-section":return 3;case "shape-preserving":return 4}return 0}function v(b,c){if(null===b||void 0===b||b.s())return null;switch(b.D()){case E.Xn.Point:var z=new u(b.lk(),b.mk(),c);if(N){var g=b.hasAttribute(E.xf.M);b.hasAttribute(E.xf.Z)&&z.set("z",b.lO());g&&z.set("m",b.NN())}return z;case E.Xn.Polygon:var z=b.hasAttribute(E.xf.Z),g=b.hasAttribute(E.xf.M),e=y(b,z,g),z=new h({rings:e,
hasZ:z,hasM:g});N?z.set("spatialReference",c):z.setSpatialReference(c);z.setCacheValue("_geVersion",b);return z;case E.Xn.Polyline:return z=b.hasAttribute(E.xf.Z),g=b.hasAttribute(E.xf.M),e=y(b,z,g),z=new d({paths:e,hasZ:z,hasM:g}),N?z.set("spatialReference",c):z.setSpatialReference(c),z.setCacheValue("_geVersion",b),z;case E.Xn.MultiPoint:var z=b.hasAttribute(E.xf.Z),g=b.hasAttribute(E.xf.M),f=e=null;z&&(e=b.mc(E.xf.Z));g&&(f=b.mc(E.xf.M));var n=new E.b,x=b.F();c=new a(c);N&&(c.set("hasZ",z),c.set("hasM",
g));for(var I=0;I<x;I++){b.w(I,n);var L=[n.x,n.y];z&&L.push(e.get(I));g&&L.push(f.get(I));c.addPoint(L)}c.setCacheValue("_geVersion",b);return c;case E.Xn.Envelope:return e=b.hasAttribute(E.xf.Z),z=b.hasAttribute(E.xf.M),g=new r(b.R.v,b.R.C,b.R.B,b.R.G,c),N&&(e&&(e=b.Ah(E.xf.Z,0),g.set("zmin",e.qa),g.set("zmax",e.va)),z&&(e=b.Ah(E.xf.M,0),g.set("mmin",e.qa),g.set("mmax",e.va))),g.setCacheValue("_geVersion",b),g}return null}function y(a,b,c){var g=[],e=a.ea(),f=null,n=null;b&&(f=a.mc(E.xf.Z));c&&(n=
a.mc(E.xf.M));for(var x=new E.b,I=0;I<e;I++){for(var z=a.Ea(I),d=a.Ha(I),m=0,k=0,h=NaN,q=NaN,l=NaN,v=NaN,y=a.vc(I),t=[],O=z;O<z+d;O++){a.w(O,x);var v=l=NaN,r=[x.x,x.y];b&&(l=f.get(O),r.push(l));c&&(v=n.get(O),r.push(v));O==z&&y&&(m=x.x,k=x.y,h=l,q=v);t.push(r)}!y||m==x.x&&k==x.y&&(!b||isNaN(h)&&isNaN(l)||h==l)&&(!c||isNaN(q)&&isNaN(v)||q==v)||t.push(t[0].slice(0));g.push(t)}return g}function B(a){var b=a._geVersion;if(null==b||void 0==b){if(Object.freeze&&Object.isFrozen(a))return 102100===a.wkid?
X:4326===a.wkid?S:b=E.Nf.create(a.wkid);-1!=a.wkid&&null!==a.wkid&&void 0!==a.wkid?(b=E.Nf.create(a.wkid),a._geVersion=b):""!==a.wkt&&void 0!==a.wkt&&null!==a.wkt&&(b=E.Nf.NL(a.wkt),a._geVersion=b)}return b}function D(a){if(null==a)return null;var b=a.getCacheValue("_geVersion");if(null==b||void 0==b)b=E.Pb.IL(a),a.setCacheValue("_geVersion",b);return b}function b(a){return null===a.spatialReference?null:B(a.spatialReference)}var m=this&&this.__extends||function(a,b){function z(){this.constructor=
a}for(var g in b)b.hasOwnProperty(g)&&(a[g]=b[g]);a.prototype=null===b?Object.create(b):(z.prototype=b.prototype,new z)},E;(function(a){var b=function(){function a(){}a.Sk=!1;a.it=!1;a.$v="";return a}();a.ah=b;if("undefined"!==typeof window)a.ah.$v="browser","Float64Array"in window&&(a.ah.it=!0),"ArrayBuffer"in window&&(a.ah.Sk=!0);else if("undefined"!==typeof process)b.$v="node",a.ah.Sk=!0,a.ah.it=!0;else{b.$v="browser";try{var z=new ArrayBuffer(0);new Uint8Array(z);a.ah.Sk=!0;a.ah.it=!0}catch(g){a.ah.Sk=
!1}}})(E||(E={}));(function(a){(function(a){a[a.Unknown=0]="Unknown";a[a.Point=33]="Point";a[a.Line=322]="Line";a[a.Envelope=197]="Envelope";a[a.MultiPoint=550]="MultiPoint";a[a.Polyline=1607]="Polyline";a[a.Polygon=1736]="Polygon"})(a.Xn||(a.Xn={}));(function(a){a[a.enumMild=0]="enumMild";a[a.enumMedium=1]="enumMedium";a[a.enumHot=2]="enumHot"})(a.rH||(a.rH={}));var b=function(){function b(){this.description=null;this.Ux=0}b.prototype.D=function(){return 0};b.prototype.fb=function(){return-1};b.prototype.Qf=
function(a){this.qc();a!=this.description&&this.nm(a)};b.prototype.nm=function(){};b.prototype.Ik=function(g){this.qc();g!=this.description&&(g=a.Od.QN(this.description,g),g!=this.description&&this.nm(g))};b.prototype.hasAttribute=function(a){return this.description.hasAttribute(a)};b.prototype.Ne=function(g){this.qc();this.description.hasAttribute(g)||(g=a.Od.PN(this.description,g),this.nm(g))};b.prototype.Ah=function(){return null};b.prototype.Fp=function(){};b.prototype.o=function(){};b.prototype.Cn=
function(){};b.prototype.dd=function(a){this.o(a)};b.prototype.s=function(){return!0};b.prototype.Ja=function(){};b.prototype.Oe=function(){};b.prototype.Pa=function(){return null};b.prototype.copyTo=function(){};b.prototype.Mh=function(){return 0};b.prototype.$b=function(){return 0};b.prototype.WC=function(){return this.hasAttribute(1)};b.ve=function(a){return((a&192)>>6)+1>>1};b.Km=function(a){return 0!=(a&32)};b.qT=function(a){return 0!=(a&64)};b.SO=function(a){return 0!=(a&128)};b.Lc=function(a){return 0!=
(a&256)};b.Th=function(a){return 0!=(a&512)};b.Kc=function(a){return 0!=(a&1024)};b.prototype.vm=function(){var a=this.Pa();this.copyTo(a);return a};b.prototype.Rf=function(){return null};b.Yj=function(a){var e=a.Pa();a.copyTo(e);return e};b.prototype.qc=function(){0<=this.Ux&&(this.Ux+=2147483649)};b.Vu=function(g){var e=g.D();if(b.Th(e))return g.F();if(g.s())return 0;if(197==e)return 4;if(33==e)return 1;if(b.Lc(e))return 2;throw a.g.ra("missing type");};return b}();a.T=b})(E||(E={}));(function(a){var b=
function(){function b(){this.y=this.x=0}b.Oa=function(a,e){var f=new b;f.x=a;f.y=e;return f};b.prototype.ma=function(a,e){this.x=a;this.y=e};b.prototype.J=function(a){this.x=a.x;this.y=a.y};b.prototype.Cq=function(a,e){return this.x===a&&this.y===e};b.prototype.Ww=function(a){return 2.220446049250313E-16>=Math.abs(this.x-a.x)&&2.220446049250313E-16>=Math.abs(this.y-a.y)};b.prototype.ub=function(a){return this.x===a.x&&this.y===a.y};b.prototype.lc=function(a){return a==this?!0:a instanceof b?this.x==
a.x&&this.y==a.y:!1};b.prototype.sub=function(a){this.x-=a.x;this.y-=a.y};b.prototype.pc=function(a,e){this.x=a.x-e.x;this.y=a.y-e.y};b.prototype.add=function(a,e){void 0!==e?(this.x=a.x+e.x,this.y=a.y+e.y):(this.x+=a.x,this.y+=a.y)};b.prototype.Bp=function(){this.x=-this.x;this.y=-this.y};b.prototype.qr=function(a){this.x=-a.x;this.y=-a.y};b.prototype.OO=function(a,e,f){this.x=a.x*(1-f)+e.x*f;this.y=a.y*(1-f)+e.y*f};b.prototype.Fr=function(a,e){this.x=this.x*a+e.x;this.y=this.y*a+e.y};b.prototype.DR=
function(a,e,f){this.x=e.x*a+f.x;this.y=e.y*a+f.y};b.prototype.scale=function(a){this.x*=a;this.y*=a};b.prototype.compare=function(a){return this.y<a.y?-1:this.y>a.y?1:this.x<a.x?-1:this.x>a.x?1:0};b.prototype.normalize=function(){var a=this.length();0==a&&(this.x=1,this.y=0);this.x/=a;this.y/=a};b.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};b.prototype.Up=function(){return this.x*this.x+this.y*this.y};b.Fb=function(a,e){return Math.sqrt(this.Zb(a,e))};b.Yv=function(a,
e,f,n){a-=f;e-=n;return Math.sqrt(a*a+e*e)};b.prototype.ml=function(a){return this.x*a.x+this.y*a.y};b.prototype.uA=function(a){return Math.abs(this.x*a.x)+Math.abs(this.y*a.y)};b.prototype.Ai=function(a){return this.x*a.y-this.y*a.x};b.prototype.Er=function(a,e){var f=-this.x*e+this.y*a;this.x=this.x*a+this.y*e;this.y=f};b.prototype.tt=function(){var a=this.x;this.x=-this.y;this.y=a};b.prototype.zD=function(a){this.x=-a.y;this.y=a.x};b.prototype.Kp=function(){var a=this.x;this.x=this.y;this.y=-a};
b.prototype.FA=function(){this.y=this.x=NaN};b.prototype.pv=function(){return isNaN(this.x)};b.prototype.ps=function(){return 0<this.x?0<=this.y?1:4:0<this.y?2:0==this.x?4:3};b.cq=function(a,e){var f=a.ps(),n=e.ps();return n==f?(f=a.Ai(e),0>f?1:0<f?-1:0):f<n?-1:1};b.HT=function(a,e){return b.cq(a,e)};b.Zb=function(a,e){var f=a.x-e.x;a=a.y-e.y;return f*f+a*a};b.prototype.toString=function(){return"("+this.x+" , "+this.y+")"};b.prototype.Eh=function(){this.y=this.x=NaN};b.prototype.yJ=function(){return this.pv()?
NaN:Math.abs(this.x)>=Math.abs(this.y)?Math.abs(this.x):Math.abs(this.y)};b.prototype.offset=function(a,e){var f=b.Fb(a,e),n=b.Oa(this.x,this.y);if(0==f)return b.Fb(n,a);var g=new b;g.J(e);g.sub(a);n.sub(a);return n.Ai(g)/f};b.yn=function(g,e,f){var n=new a.$k;n.set(e.x);n.sub(g.x);var x=new a.$k;x.set(f.y);x.sub(g.y);var b=new a.$k;b.set(e.y);b.sub(g.y);var z=new a.$k;z.set(f.x);z.sub(g.x);n.Ap(x);b.Ap(z);n.sub(b);if(!n.Dq())return f=n.value(),0>f?-1:0<f?1:0;n=new a.Tn(e.x);x=new a.Tn(g.x);b=new a.Tn(g.y);
n=n.nr(x);g=new a.Tn(f.y);g=g.nr(b);e=new a.Tn(e.y);e=e.nr(b);f=new a.Tn(f.x);f=f.nr(x);n=n.Wp(g);e=e.Wp(f);n=n.Wp(e);return n.vP()?-1:n.nO()?1:0};b.prototype.hc=function(){return a.I.Rh(a.I.Rh())};return b}();a.b=b})(E||(E={}));(function(a){var b=function(){function a(a){this.Ov=this.Or=0;this.ES=a}a.prototype.reset=function(){this.Ov=this.Or=0};a.prototype.add=function(a){a-=this.Ov;var e=this.Or+a;this.Ov=e-this.Or-a;this.Or=e};a.prototype.sub=function(a){this.add(-a)};a.prototype.rl=function(){return this.ES+
this.Or};return a}();a.av=b;b=function(){function a(){}a.LT=function(a,e){return 0<=e?Math.abs(a):-Math.abs(a)};a.sign=function(a){return 0>a?-1:0<a?1:0};a.gH=function(a){return a-360*Math.floor(a/360)};a.round=function(a){return Math.floor(a+.5)};a.Ty=function(a){return a*a};a.ut=function(a,e,f){var n;.5>=f?n=a+(e-a)*f:n=e-(e-a)*(1-f);return n};a.BD=function(a,e,f,n){.5>=f?(n.x=a.x+(e.x-a.x)*f,n.y=a.y+(e.y-a.y)*f):(n.x=e.x-(e.x-a.x)*(1-f),n.y=e.y-(e.y-a.y)*(1-f))};a.tP=function(a,e,f,n,x,b){.5>=
x?(b.x=a+(f-a)*x,b.y=e+(n-e)*x):(b.x=f-(f-a)*(1-x),b.y=n-(n-e)*(1-x))};return a}();a.vi=b})(E||(E={}));(function(a){var b=function(b){function g(){b.call(this);this.ha=this.la=this.ja=this.na=0;this.fa=null}m(g,b);g.prototype.Mb=function(){return a.b.Oa(this.na,this.ja)};g.prototype.ht=function(e){e.x=this.na;e.y=this.ja};g.prototype.ed=function(e){this.gl(0,e)};g.prototype.Ny=function(e,f){this.gl(0,a.b.Oa(e,f))};g.prototype.En=function(e){this.wA(0,e)};g.prototype.setStart=function(e){this.CA(0,
e)};g.prototype.gt=function(e,f){return this.yd(0,e,f)};g.prototype.My=function(e,f,a){this.om(0,e,f,a)};g.prototype.oc=function(){return a.b.Oa(this.la,this.ha)};g.prototype.uw=function(e){e.x=this.la;e.y=this.ha};g.prototype.vd=function(e){this.gl(1,e)};g.prototype.Ok=function(e,f){this.gl(1,a.b.Oa(e,f))};g.prototype.Bn=function(e){this.wA(1,e)};g.prototype.setEnd=function(e){this.CA(1,e)};g.prototype.Ws=function(e,f){return this.yd(1,e,f)};g.prototype.Cy=function(e,f,a){this.om(1,e,f,a)};g.prototype.fb=
function(){return 1};g.prototype.s=function(){return this.sc()};g.prototype.Ja=function(){};g.prototype.Mh=function(){return 0};g.prototype.Ga=function(e,f,a,g,b){return this.wJ(e,f,a,g,b)};g.prototype.jc=function(e,f){return 0!=this.fq(e,f,!1)};g.prototype.Eq=function(e,f){return this.qs(e,f,!1)};g.prototype.qs=function(){return null};g.prototype.sc=function(){return!1};g.prototype.rv=function(e){this.qc();if(null==this.fa&&0<e)this.fa=a.I.Lh(2*e);else if(null!=this.fa&&this.fa.length<2*e){for(var f=
this.fa.slice(0),n=this.fa.length;n<2*e;n++)f[n]=0;this.fa=f}};g.KI=function(e,f,a){if(0<a)var n=0;for(var g=0;g<a;g++)f[0+n]=e[0],n++};g.prototype.gl=function(e,f){0!=e?(this.la=f.x,this.ha=f.y):(this.na=f.x,this.ja=f.y)};g.prototype.nm=function(e){if(null!=this.fa){for(var f=a.Od.iu(e,this.description),n=[],x=g.Xk(this.description,0),b=g.Xk(this.description,1),z=g.Xk(e,0),c=g.Xk(e,1),d=0,m=1,k=e.Aa;m<k;m++){var h=e.Hd(m),q=a.pa.Wa(h);if(-1==f[m])for(var l=a.pa.ue(h),h=0;h<q;h++)n[z+d]=l,n[c+d]=
l,d++;else for(l=this.description.fj(f[m])-2,h=0;h<q;h++)n[z+d]=this.fa[x+l],n[c+d]=this.fa[b+l],d++,l++}this.fa=n}this.description=e};g.prototype.wA=function(e,f){if(this.sc())throw a.g.ra("empty geometry");f.Qf(this.description);f.sc()&&f.ko();for(var n=0;n<this.description.Aa;n++)for(var g=this.description.Fd(n),b=0,z=a.pa.Wa(g);b<z;b++){var c=this.yd(e,g,b);f.setAttribute(g,b,c)}};g.prototype.CA=function(e,f){this.qc();if(f.sc())throw a.g.ra("empty geometry");for(var n=f.description,g=0,b=n.Aa;g<
b;g++)for(var z=n.Fd(g),c=a.pa.Wa(z),d=0;d<c;d++){var m=f.ld(z,d);this.om(e,z,d,m)}};g.prototype.yd=function(e,f,n){if(this.sc())throw a.g.ra("This operation was performed on an Empty Geometry.");if(0==f)return 0!=e?0!=n?this.ha:this.la:0!=n?this.ja:this.na;if(n>=a.pa.Wa(f))throw a.g.Uc();var x=this.description.zf(f);return 0<=x?(null!=this.fa&&this.rv(this.description.le.length-2),this.fa[g.Xk(this.description,e)+this.description.fj(x)-2+n]):a.pa.ue(f)};g.prototype.om=function(e,f,n,x){this.qc();
if(n>=a.pa.Wa(f))throw a.g.Uc();var b=this.description.zf(f);0>b&&(this.Ne(f),b=this.description.zf(f));0==f?0!=e?0!=n?this.ha=x:this.la=x:0!=n?this.ja=x:this.na=x:(null==this.fa&&this.rv(this.description.le.length-2),this.fa[g.Xk(this.description,e)+this.description.fj(b)-2+n]=x)};g.prototype.copyTo=function(e){if(e.D()!=this.D())throw a.g.N();e.description=this.description;e.rv(this.description.le.length-2);g.KI(this.fa,e.fa,2*(this.description.le.length-2));e.na=this.na;e.ja=this.ja;e.la=this.la;
e.ha=this.ha;e.qc();this.eo(e)};g.prototype.Ah=function(e,f){var n=new a.Nd;if(this.sc())return n.Ja(),n;n.qa=this.yd(0,e,f);n.va=n.qa;n.Oj(this.yd(1,e,f));return n};g.prototype.XE=function(e){this.sc()?e.Ja():(e.qa=this.yd(0,0,0),e.va=e.qa,e.Oj(this.yd(1,0,0)))};g.prototype.uu=function(e,f){f.Qf(this.description);f.ic(this.Kb(e));for(var n=1,g=this.description.Aa;n<g;n++)for(var b=this.description.Fd(n),z=a.pa.Wa(b),c=0;c<z;c++){var d=this.ld(e,b,c);f.setAttribute(b,c,d)}};g.prototype.sJ=function(e){if(this.description!=
e.description||this.na!=e.na||this.la!=e.la||this.ja!=e.ja||this.ha!=e.ha)return!1;for(var f=0;f<2*(this.description.le.length-2);f++)if(this.fa[f]!=e.fa[f])return!1;return!0};g.prototype.kD=function(){return this.na==this.la&&this.ja==this.ha};g.prototype.reverse=function(){var e=this.na;this.na=this.la;this.la=e;e=this.ja;this.ja=this.ha;this.ha=e;for(var e=1,f=this.description.Aa;e<f;e++)for(var n=this.description.Hd(e),g=0,b=a.pa.Wa(n);g<b;g++){var z=this.yd(0,n,g),c=this.yd(1,n,g);this.om(0,
n,g,c);this.om(1,n,g,z)}};g.prototype.fq=function(e,f,n){var g=e.D();switch(this.D()){case 322:if(322==g)return a.yb.xJ(this,e,f,n);throw a.g.wa();default:throw a.g.wa();}};g.prototype.wJ=function(e,f,n,g,b){var x=e.D();switch(this.D()){case 322:if(322==x)return a.yb.ov(this,e,f,n,g,b);throw a.g.wa();default:throw a.g.wa();}};g.prototype.kv=function(){return null};g.Xk=function(e,f){return f*(e.le.length-2)};g.prototype.Kb=function(e,f){if(void 0===f)return f=new a.b,this.Kb(e,f),f;a.vi.tP(this.na,
this.ja,this.la,this.ha,e,f)};g.prototype.Gd=function(){return null};g.prototype.TC=function(){return null};g.prototype.nt=function(){return null};g.prototype.mg=function(){return null};g.prototype.mD=function(){return null};g.prototype.Pf=function(){return null};g.prototype.rA=function(e,f){return void 0!==f?this.Ru(f)-this.Ru(e):this.Ru(e)};g.prototype.eo=function(){};g.prototype.xm=function(){return null};g.prototype.Bi=function(){};g.prototype.ld=function(){return null};g.prototype.xe=function(){return null};
g.prototype.Ru=function(){return null};g.prototype.AD=function(){return null};g.prototype.Fb=function(e,f){if(!f&&0!=this.fq(e,0,!1))return 0;f=1.7976931348623157E308;var a,g;a=this.Mb();g=e.Gd(a,!1);a.sub(e.Kb(g));a=a.length();a<f&&(f=a);a=this.oc();g=e.Gd(a,!1);a.sub(e.Kb(g));a=a.length();a<f&&(f=a);a=e.Mb();g=this.Gd(a,!1);a.sub(this.Kb(g));a=a.length();a<f&&(f=a);a=e.oc();g=this.Gd(a,!1);a.sub(this.Kb(g));a=a.length();a<f&&(f=a);return f};g.prototype.Rf=function(){return a.Hh.il(this,null)};return g}(a.T);
a.fA=b})(E||(E={}));new E.b;(function(a){(function(a){a[a.Unknown=-1]="Unknown";a[a.Not=0]="Not";a[a.Weak=1]="Weak";a[a.Strong=2]="Strong"})(a.tH||(a.tH={}));(function(a){a[a.DirtyIsKnownSimple=1]="DirtyIsKnownSimple";a[a.IsWeakSimple=2]="IsWeakSimple";a[a.IsStrongSimple=4]="IsStrongSimple";a[a.DirtyOGCFlags=8]="DirtyOGCFlags";a[a.DirtyVerifiedStreams=32]="DirtyVerifiedStreams";a[a.DirtyExactIntervals=64]="DirtyExactIntervals";a[a.DirtyLooseIntervals=128]="DirtyLooseIntervals";a[a.DirtyIntervals=
192]="DirtyIntervals";a[a.DirtyIsEnvelope=256]="DirtyIsEnvelope";a[a.DirtyLength2D=512]="DirtyLength2D";a[a.DirtyRingAreas2D=1024]="DirtyRingAreas2D";a[a.DirtyCoordinates=1993]="DirtyCoordinates";a[a.DirtyAllInternal=65535]="DirtyAllInternal";a[a.DirtyAll=16777215]="DirtyAll"})(a.cH||(a.cH={}));var b=function(b){function g(){b.call(this);this.El=65535;this.ta=0;this.rg=-1;this.pb=null}m(g,b);g.prototype.eo=function(){};g.prototype.qv=function(){};g.prototype.xv=function(){};g.prototype.F=function(){return this.ta};
g.prototype.s=function(){return this.sc()};g.prototype.sc=function(){return 0==this.ta};g.prototype.gj=function(e){return 0!=(this.El&e)};g.prototype.yf=function(e,f){this.El=f?this.El|e:this.El&~e};g.prototype.kc=function(){this.gj(32)&&this.FJ()};g.prototype.Su=function(){if(this.sc())throw a.g.ra("This operation was performed on an Empty Geometry.");};g.prototype.Sd=function(e,f){if(0>e||e>=this.ta)throw a.g.ra("index out of bounds");this.kc();f.Qf(this.description);f.s()&&f.ko();for(var n=0;n<
this.description.Aa;n++)for(var g=this.description.Fd(n),b=0,z=a.pa.Wa(g);b<z;b++){var c=this.Ba[n].Bh(z*e+b);f.setAttribute(g,b,c)}};g.prototype.Iu=function(e,f){this.kc();for(var n=f.description,g=0;g<n.Aa;g++)for(var b=n.Fd(g),z=a.pa.Wa(b),c=0;c<z;c++){var d=f.ld(b,c);this.setAttribute(b,e,c,d)}};g.prototype.w=function(e,f){if(0>e||e>=this.F())throw a.g.Uc();this.kc();this.Ba[0].ec(2*e,f)};g.prototype.Fa=function(e){var f=new a.b;this.w(e,f);return f};g.prototype.uc=function(e,f){this.Ba[0].ec(2*
e,f)};g.prototype.ic=function(e,f,n){if(0>e||e>=this.ta)throw a.g.Uc();this.kc();var g=this.Ba[0];void 0!==n?(g.write(2*e,f),g.write(2*e+1,n)):g.Rn(2*e,f);this.ce(1993)};g.prototype.Lw=function(e){if(0>e||e>=this.F())throw a.g.Uc();this.kc();var f=this.Ba[0],n=new a.ee;n.x=f.read(2*e);n.y=f.read(2*e+1);n.z=this.hasAttribute(1)?this.Ba[1].Bh(e):a.pa.ue(1);return n};g.prototype.Py=function(e,f){if(0>e||e>=this.F())throw a.g.Uc();this.Ne(1);this.kc();this.ce(1993);var n=this.Ba[0];n.write(2*e,f.x);n.write(2*
e+1,f.y);this.Ba[1].Uk(e,f.z)};g.prototype.ld=function(e,f,n){if(0>f||f>=this.ta)throw a.g.Uc();var g=a.pa.Wa(e);if(n>=g)throw a.g.Uc();this.kc();var b=this.description.zf(e);return 0<=b?this.Ba[b].Bh(f*g+n):a.pa.ue(e)};g.prototype.nC=function(e,f,a){return this.ld(e,f,a)};g.prototype.setAttribute=function(e,f,n,g){if(0>f||f>=this.ta)throw a.g.Uc();var x=a.pa.Wa(e);if(n>=x)throw a.g.Uc();this.Ne(e);this.kc();e=this.description.zf(e);this.ce(1993);this.Ba[e].Uk(f*x+n,g)};g.prototype.mc=function(e){this.Su();
this.Ne(e);this.kc();return this.Ba[this.description.zf(e)]};g.prototype.bm=function(e,f){if(null!=f&&a.pa.Qh(e)!=f.Qh())throw a.g.N();this.Ne(e);e=this.description.zf(e);null==this.Ba&&(this.Ba=a.Ac.ay(this.description.Aa));this.Ba[e]=f;this.ce(16777215)};g.prototype.nm=function(e){var f=null;if(null!=this.Ba)for(var n=a.Od.iu(e,this.description),f=[],g=0,b=e.Aa;g<b;g++)-1!=n[g]&&(f[g]=this.Ba[n[g]]);this.description=e;this.Ba=f;this.rg=-1;this.ce(16777215)};g.prototype.IA=function(e){this.ss(!0);
e instanceof a.i?this.R.o(e):this.R.Cn(e)};g.prototype.EJ=function(e){this.ss(!1);e instanceof a.i?this.R.o(e):this.R.Cn(e)};g.prototype.Fp=function(e){this.ss(!0);this.R.copyTo(e)};g.prototype.o=function(e){this.IA(e)};g.prototype.Cn=function(e){this.IA(e)};g.prototype.dd=function(e){this.EJ(e)};g.prototype.Ah=function(e,f){var n=new a.Nd;if(this.sc())return n.Ja(),n;this.ss(!0);return this.R.Ah(e,f)};g.prototype.hc=function(){var e=this.description.hc();if(!this.sc())for(var f=this.F(),n=0,g=this.description.Aa;n<
g;n++)e=this.Ba[n].jj(e,0,f*a.pa.Wa(this.description.Fd(n)));return e};g.prototype.lc=function(e){if(e==this)return!0;if(!(e instanceof g&&this.description.lc(e.description))||this.sc()!=e.sc())return!1;if(this.sc())return!0;var f=this.F();if(f!=e.F())return!1;for(var n=0;n<this.description.Aa;n++){var x=this.description.Hd(n),b=this.mc(x),z=e.mc(x);if(!b.lc(z,0,f*a.pa.Wa(x)))return!1}return!0};g.prototype.copyTo=function(e){if(e.D()!=this.D())throw a.g.N();this.tA(e)};g.prototype.tA=function(e){this.kc();
e.description=this.description;e.Ba=null;var f=this.description.Aa,n=null;if(null!=this.Ba)for(var n=[],g=0;g<f;g++)null!=this.Ba[g]&&(n[g]=this.Ba[g].Ip(this.F()*a.pa.Wa(this.description.Fd(g))));null!=this.R?(e.R=this.R.Pa(),this.R.copyTo(e.R)):e.R=null;e.ta=this.ta;e.El=this.El;e.Ba=n;try{this.eo(e)}catch(I){throw e.Ja(),a.g.BI();}};g.prototype.EA=function(){this.ta=0;this.rg=-1;this.Ba=null;this.ce(16777215)};g.prototype.ce=function(e){16777215==e&&(this.rg=-1,this.qv());this.El|=e;this.kJ();
this.qc()};g.prototype.ss=function(e){this.kc();if(this.gj(192))if(null==this.R?this.R=new a.Vj(this.description):this.R.Qf(this.description),this.s())this.R.Ja();else{this.wv(e);for(var f=1;f<this.description.Aa;f++)for(var n=this.description.Fd(f),g=a.pa.Wa(n),b=this.Ba[f],z=0;z<g;z++){var c=new a.Nd;c.Ja();for(var d=0;d<this.ta;d++){var m=b.Bh(d*g+z);c.Db(m)}this.R.setInterval(n,z,c)}e&&this.yf(192,!1)}};g.prototype.wv=function(){this.R.Ja();for(var e=this.Ba[0],f=new a.b,n=0;n<this.ta;n++)e.ec(2*
n,f),this.R.Db(f)};g.prototype.tm=function(e){e.Ja();for(var f=this.Ba[0],n=new a.b,g=0;g<this.ta;g++)f.ec(2*g,n),e.Db(n)};g.prototype.FJ=function(){if(this.rg<this.ta){null==this.Ba&&(this.Ba=a.Ac.ay(this.description.Aa));this.rg=2147483647;for(var e=0;e<this.description.Aa;e++){var f=this.description.Fd(e);if(null!=this.Ba[e]){var n=a.pa.Wa(f),g=a.I.truncate(this.Ba[e].size/n);g<this.ta&&(g=a.I.truncate(this.rg>this.ta+5?(5*this.ta+3)/4:this.ta),this.Ba[e].resize(g*n,a.pa.ue(f)));g<this.rg&&(this.rg=
g)}else this.Ba[e]=a.Ac.Tv(f,this.ta),this.rg=this.ta}}this.xv();this.yf(32,!1)};g.prototype.jo=function(e){if(0>e)throw a.g.N();e!=this.ta&&(this.ta=e,this.ce(65535))};g.prototype.rj=function(e){if(!this.gj(1)){if(!this.gj(2))return 0;if(this.TP>=e)return this.gj(8)?1:2}return-1};g.prototype.hg=function(e,f){this.TP=f;if(-1==e)this.yf(1,!0),this.yf(8,!0);else if(this.yf(1,!1),this.yf(8,!0),0==e)this.yf(2,!1),this.yf(4,!1);else if(1==e)this.yf(2,!0),this.yf(4,!1);else if(2==e)this.yf(2,!0),this.yf(4,
!0);else throw a.g.ra("internal error.");};g.prototype.kJ=function(){null!=this.pb&&(this.pb=null)};g.prototype.vJ=function(e,f,n,g){if(0>e||e>=this.ta)throw a.g.ra("index out of bounds");if(0>f||f>=this.ta)throw a.g.ra("index out of bounds");this.kc();g.Qf(this.description);g.s()&&g.ko();for(var x=0;x<this.description.Aa;x++)for(var b=this.description.Fd(x),z=0,c=a.pa.Wa(b);z<c;z++){var d=this.Ba[x].Bh(c*e+z),m=this.Ba[x].Bh(c*f+z);g.setAttribute(b,z,a.vi.ut(d,m,n))}};g.prototype.mv=function(e,f){var a=
this.Ba[0].f,g=a[2*e]-a[2*f],a=a[2*e+1]-a[2*f+1];return Math.sqrt(g*g+a*a)};g.prototype.bh=function(e,f){if(0>e||e>=this.ta)throw a.g.Uc();if(f.s())throw a.g.N();this.kc();for(var n=f.description,g=0;g<n.Aa;g++)for(var b=n.Hd(g),z=a.pa.Wa(b),c=0;c<z;c++){var d=f.ld(b,c);this.setAttribute(b,e,c,d)}};g.prototype.jv=function(){return null};g.prototype.dj=function(){return null};return g}(a.T);a.Wr=b})(E||(E={}));(function(a){var b=function(){function b(){this.cb=this.Qm=null;this.Ol=124234251;this.Ct=
!0;this.Ae=-1;this.cb=new a.Fc(7);this.Qm=null}b.prototype.Hn=function(a){this.Qm=a};b.prototype.lM=function(){this.Ct=!1};b.prototype.de=function(a){this.cb.de(a)};b.prototype.nq=function(a){var e=this.cb.be();this.mS(e);this.oS(a,e);return e};b.prototype.fM=function(a){this.cb.Jc(a)};b.prototype.addElement=function(a,e){var f;-1==e?(-1==this.Ae&&(this.Ae=this.nq(-1)),f=this.Ae):f=e;return this.MA(a,0,f)};b.prototype.PA=function(a){-1==this.Ae&&(this.Ae=this.nq(-1));return this.MA(a,1,this.Ae)};
b.prototype.qm=function(a){var e;-1==this.Ae&&(this.Ae=this.nq(-1));e=this.Ae;var f=this.cb.f;if(-1==e||-1==f[7*e])return a=this.cb.Pj([-1,-1,-1,a,this.ck(),-1,-1]),f=this.cb.f,f[7*e]=a,this.mo(-1,a,e,f),a;var n=-1==e?-1:f[7*e+2];a=this.cb.Pj([-1,-1,n,a,this.ck(),-1,-1]);f=this.cb.f;f[7*n+1]=a;this.Fv(a,f);-1===f[7*a+2]&&(f[7*e]=a);this.mo(-1,a,e,f);return a};b.prototype.vs=function(g,e,f,n){var x=-1;-1==x&&(-1==this.Ae&&(this.Ae=this.nq(-1)),x=this.Ae);var b=this.cb.f;if(-1==x||-1==b[7*x])return f=
this.cb.Pj([-1,-1,-1,f,this.ck(),-1,-1]),b=this.cb.f,b[7*x]=f,this.mo(-1,f,x,b),f;var z;n?(n=-1!=e?this.Qm.compare(this,f,e):-1,z=-1!=g?this.Qm.compare(this,f,g):1):(n=-1,z=1);if(0==n||0==z)return b[7*x+3]=0==n?e:g,-1;(-1!=e&&-1!=g?this.Ol>a.I.$x(this.Ol)>>1:-1!=e)?g=e:n=z;for(e=!0;;){if(0>n)if(z=b[7*g],-1!=z)g=z;else{n=g;f=this.cb.Pj([-1,-1,g,f,this.ck(),-1,-1]);b=this.cb.f;b[7*g]=f;break}else if(z=b[7*g+1],-1!=z)g=z;else{n=b[7*g+6];f=this.cb.Pj([-1,-1,g,f,this.ck(),-1,-1]);b=this.cb.f;b[7*g+1]=
f;break}e&&(n*=-1,e=!1)}this.Fv(f,b);-1===b[7*f+2]&&(b[7*x]=f);this.mo(n,f,x,b);return f};b.prototype.tC=function(){return this.xN(this.Ae)};b.prototype.kd=function(a,e){e=-1==e?this.Ae:e;this.Ct?this.eM(a,e):this.$S(a,e)};b.prototype.search=function(a,e){for(e=this.dt(e);-1!=e;){var f=this.Qm.compare(this,a,e);if(0==f)return e;e=0>f?this.ik(e):this.Jo(e)}return-1};b.prototype.GR=function(a){for(var e=this.dt(-1),f=-1;-1!=e;){var n=a.compare(this,e);if(0==n)return e;0>n?e=this.ik(e):(f=e,e=this.Jo(e))}return f};
b.prototype.sF=function(a){for(var e=this.dt(-1),f=-1;-1!=e;){var n=a.compare(this,e);if(0==n)return e;0>n?(f=e,e=this.ik(e)):e=this.Jo(e)}return f};b.prototype.da=function(a){return this.cb.O(a,3)};b.prototype.ik=function(a){return this.cb.O(a,0)};b.prototype.Jo=function(a){return this.cb.O(a,1)};b.prototype.getParent=function(a){return this.cb.O(a,2)};b.prototype.bb=function(a){return this.cb.O(a,6)};b.prototype.ge=function(a){return this.cb.O(a,5)};b.prototype.gc=function(a){return-1==a?this.gk(this.Ae):
this.gk(a)};b.prototype.tc=function(a){return-1==a?this.uq(this.Ae):this.uq(a)};b.prototype.hO=function(a){return-1==a?this.QC(this.Ae):this.QC(a)};b.prototype.Vi=function(a,e){this.By(a,e)};b.prototype.dt=function(a){return-1==a?this.MC(this.Ae):this.MC(a)};b.prototype.clear=function(){this.cb.Nh(!1);this.Ae=-1};b.prototype.size=function(a){return-1==a?this.OC(this.Ae):this.OC(a)};b.prototype.pK=function(a,e){for(var f=e[7*a],n=e[7*a+1],g=e[7*a+4];-1!=f||-1!=n;){var b=-1!=f?e[7*f+4]:2147483647,n=
-1!=n?e[7*n+4]:2147483647;if(g<=Math.min(b,n))break;b<=n?this.oF(f,e):this.nF(a,e);f=e[7*a];n=e[7*a+1]}};b.prototype.Fv=function(a,e){if(this.Ct)for(var f=e[7*a+4],n=e[7*a+2];-1!=n&&e[7*n+4]>f;)e[7*n]==a?this.oF(a,e):this.nF(n,e),n=e[7*a+2]};b.prototype.nF=function(a,e){var f=e[7*a+1],n;e[7*f+2]=e[7*a+2];e[7*a+2]=f;n=e[7*f];e[7*a+1]=n;-1!=n&&(e[7*n+2]=a);e[7*f]=a;n=e[7*f+2];-1!=n&&(e[7*n]==a?e[7*n]=f:e[7*n+1]=f)};b.prototype.oF=function(a,e){var f=e[7*a+2],n;e[7*a+2]=e[7*f+2];e[7*f+2]=a;n=e[7*a+1];
e[7*f]=n;-1!=n&&(e[7*n+2]=f);e[7*a+1]=f;n=e[7*a+2];-1!=n&&(e[7*n]===f?e[7*n]=a:e[7*n+1]=a)};b.prototype.Tj=function(a,e){this.cb.L(a,2,e)};b.prototype.Gy=function(a,e){this.cb.L(a,0,e)};b.prototype.Ky=function(a,e){this.cb.L(a,1,e)};b.prototype.Jy=function(a,e){this.cb.L(a,5,e)};b.prototype.Gu=function(a,e){this.cb.L(a,6,e)};b.prototype.VF=function(a,e){this.cb.L(e,0,a)};b.prototype.mS=function(a){this.cb.L(a,4,0)};b.prototype.oS=function(a,e){this.cb.L(e,5,a)};b.prototype.MC=function(a){return-1==
a?-1:this.cb.O(a,0)};b.prototype.gk=function(a){return-1==a?-1:this.cb.O(a,1)};b.prototype.uq=function(a){return-1==a?-1:this.cb.O(a,2)};b.prototype.xN=function(a){return-1==a?-1:this.cb.O(a,3)};b.prototype.OC=function(a){return-1==a?0:this.cb.O(a,4)};b.prototype.QC=function(a){return this.cb.O(a,5)};b.prototype.ou=function(a){return this.cb.Pj([-1,-1,-1,a,this.ck(),-1,-1])};b.prototype.bk=function(a){-1!=a&&this.cb.Jc(a)};b.prototype.ck=function(){this.Ol=a.I.$x(this.Ol);return this.Ol&1073741823};
b.prototype.MA=function(a,e,f){var n=this.cb.f;if(-1==f||-1==n[7*f])return a=this.cb.Pj([-1,-1,-1,a,this.ck(),-1,-1]),n=this.cb.f,n[7*f]=a,this.mo(-1,a,f,n),a;for(var g=-1==f?-1:n[7*f];;){var b=-1==e?1:this.Qm.compare(this,a,g);if(0>b)if(b=this.ik(g),-1!=b)g=b;else{e=g;a=this.cb.Pj([-1,-1,g,a,this.ck(),-1,-1]);n=this.cb.f;n[7*g]=a;break}else{if(1==e&&0==b)return n[7*f+3]=g,-1;b=n[7*g+1];if(-1!=b)g=b;else{e=n[7*g+6];a=this.cb.Pj([-1,-1,g,a,this.ck(),-1,-1]);n=this.cb.f;n[7*g+1]=a;break}}}this.Fv(a,
n);-1===n[7*a+2]&&(n[7*f]=a);this.mo(e,a,f,n);return a};b.prototype.mo=function(a,e,f,n){var g;-1!=a?(g=n[7*a+5],n[7*a+5]=e):g=-1==f?-1:n[7*f+2];n[7*e+5]=g;-1!=g&&(n[7*g+6]=e);n[7*e+6]=a;a==(-1==f?-1:n[7*f+1])&&(n[7*f+1]=e);-1==a&&(n[7*f+2]=e);n[7*f+4]=(-1==f?0:n[7*f+4])+1};b.prototype.ry=function(a,e){var f=this.cb.f,n=f[7*a+5];a=f[7*a+6];-1!=n?f[7*n+6]=a:f[7*e+1]=a;-1!=a?f[7*a+5]=n:f[7*e+2]=n;f[7*e+4]=-1===e?-1:f[7*e+4]-1};b.prototype.$S=function(g,e){this.ry(g,e);var f=this.ik(g),n=this.Jo(g),
x=this.getParent(g),b=g;if(-1!=f&&-1!=n){this.Ol=a.I.$x(this.Ol);var z;z=1073741823<this.Ol?this.bb(g):this.ge(g);var c=this.getParent(z)==g;this.cb.Pu(g,z,0);this.cb.Pu(g,z,1);this.cb.Pu(g,z,2);-1!=x?this.ik(x)==g?this.Gy(x,z):this.Ky(x,z):this.VF(z,e);c?(f==z?(this.Gy(z,g),this.Tj(n,z)):n==z&&(this.Ky(z,g),this.Tj(f,z)),this.Tj(g,z),x=z):(this.Tj(f,z),this.Tj(n,z),x=this.getParent(g),b=z);f=this.ik(g);n=this.Jo(g);-1!=f&&this.Tj(f,g);-1!=n&&this.Tj(n,g)}f=-1!=f?f:n;-1==x?this.VF(f,e):this.ik(x)==
b?this.Gy(x,f):this.Ky(x,f);-1!=f&&this.Tj(f,x);this.bk(g,e)};b.prototype.eM=function(a,e){var f=this.cb.f;f[7*a+4]=2147483647;var n=-1,g=-1,b=-1===e?-1:f[7*e],z=b==a;z&&(n=f[7*b],g=f[7*b+1],-1==n&&-1==g)?(this.ry(b,e),this.bk(b,e),f[7*e]=-1):(this.pK(a,f),b=f[7*a+2],-1!=b&&(f[7*b]==a?f[7*b]=-1:f[7*b+1]=-1),this.ry(a,e),this.bk(a,e),z&&(f[7*e]=-1==n||-1!=f[7*n+2]?g:n))};b.prototype.By=function(a,e){this.cb.L(a,3,e)};return b}();a.bj=b})(E||(E={}));(function(a){var b=function(){function b(a,e){void 0!==
a&&this.K(a,e)}b.prototype.K=function(a,e){this.qa=a;this.va=e;this.normalize()};b.prototype.normalize=function(){if(!isNaN(this.qa)){if(this.qa>this.va){var a=this.qa;this.qa=this.va;this.va=a}isNaN(this.va)&&this.Ja()}};b.prototype.Ja=function(){this.va=this.qa=NaN};b.prototype.s=function(){return isNaN(this.qa)};b.prototype.Db=function(a){"number"===typeof a?this.s()?this.va=this.qa=a:this.Oj(a):a.s()||(this.s()?(this.qa=a.qa,this.va=a.va):(this.qa>a.qa&&(this.qa=a.qa),this.va<a.va&&(this.va=a.va),
this.qa>this.va&&this.Ja()))};b.prototype.Oj=function(a){a<this.qa?this.qa=a:a>this.va&&(this.va=a)};b.prototype.contains=function(a){return"number"===typeof a?a>=this.qa&&a<=this.va:a.qa>=this.qa&&a.va<=this.va};b.prototype.Ga=function(a){this.s()||a.s()?this.Ja():(this.qa<a.qa&&(this.qa=a.qa),this.va>a.va&&(this.va=a.va),this.qa>this.va&&this.Ja())};b.prototype.P=function(a){this.s()||(this.qa-=a,this.va+=a,this.va<this.qa&&this.Ja())};b.prototype.lv=function(){return this.s()?2.220446049250313E-14:
2.220446049250313E-14*(Math.abs(this.qa)+Math.abs(this.va)+1)};b.prototype.yy=function(a,e){a>e?(this.qa=e,this.va=a):(this.qa=a,this.va=e)};b.prototype.Sy=function(g){return a.I.Kr(g,this.qa,this.va)};b.prototype.aa=function(){return this.va-this.qa};b.prototype.Af=function(){return.5*(this.qa+this.va)};b.prototype.lc=function(a){return a==this?!0:a instanceof b?this.s()&&a.s()?!0:this.qa!=a.qa||this.va!=a.va?!1:!0:!1};b.prototype.hc=function(){return a.I.Rh(a.I.Rh())};return b}();a.Nd=b})(E||(E=
{}));(function(a){var b=new a.Nd,z=new a.Nd,g=function(){return function(){this.Zd=null;this.Lf=-1;this.ib=new a.yb;this.ux=55555555;this.Et=this.Ft=!1;this.$h=new a.Nd;this.$h.yy(0,0)}}();a.XT=g;var e=function(){function e(e,f,b){this.a=e;this.Mj=NaN;this.mE=this.sp=0;this.nE=NaN;this.ka=f;this.tp=10*f;this.oE=this.pE=NaN;this.Zf=!1;this.Cl=this.mr=this.un=this.gr=this.fr=-1;this.lx=b;this.Rx=new g;this.vE=new g;a.I.truncate(3*e.pd/2)}e.prototype.$C=function(e,f,a,g){e.Zd=null===g?null:g[a[5*f]];
e.Et=null!=e.Zd;e.Et||(g=a[5*f+2],-1!==g&&this.a.gR(a[5*f],a[5*g],e.ib),e.Zd=e.ib,e.$h.yy(e.ib.na,e.ib.la),e.$h.va+=this.ka,e.ib.KE(),e.Ft=e.ib.ha==e.ib.ja,e.Ft||(e.ux=(e.ib.la-e.ib.na)/(e.ib.ha-e.ib.ja)))};e.prototype.tL=function(e,f){var a=e.fq(f,this.ka,!0);if(0!=a)return 2==a?this.aw():this.Oh();e.ht(G);e.uw(K);f.ht(M);f.uw(U);J.ma(this.sp,this.Mj);G.ub(M)&&this.Mj==G.y?0>K.compare(U)?J.J(K):J.J(U):G.ub(U)&&this.Mj==G.y?0>K.compare(M)?J.J(K):J.J(M):M.ub(K)&&this.Mj==M.y?0>G.compare(U)?J.J(G):
J.J(U):K.ub(U)&&this.Mj==K.y&&(0>G.compare(M)?J.J(G):J.J(M));return e.xe(J.y,J.x)<f.xe(J.y,J.x)?-1:1};e.prototype.rL=function(e,f){if(e.ib.ja==f.ib.ja&&e.ib.na==f.ib.na)return e.ib.ha==f.ib.ha&&e.ib.la==f.ib.la?this.lx?this.aw():0:this.HB(e,f);if(e.ib.ha==f.ib.ha&&e.ib.la==f.ib.la)return this.GB(e,f);var a=this.GB(e,f);e=this.HB(e,f);return 0>a&&0>e?-1:0<a&&0<e?1:this.Oh()};e.prototype.mL=function(e,f){if(e.la>f.la){if(f.la>f.na&&f.ha-f.ja<2*this.ka&&e.Kh(f.la,f.ha,this.ka))return this.Oh()}else if((f.ha-
f.ja)/(f.la-f.na)*(e.la-e.na)<this.tp&&f.Kh(e.la,e.ha,this.ka))return this.Oh();return 1};e.prototype.nL=function(e,f){if(e.na<f.na){if(f.la>f.na&&f.ha-f.ja<2*this.ka&&e.Kh(f.la,f.ha,this.ka))return this.Oh()}else if((f.ha-f.ja)/(f.la-f.na)*(e.na-e.la)<this.tp&&f.Kh(e.na,e.ja,this.ka))return this.Oh();return-1};e.prototype.oL=function(e,f){var n=new a.b;n.pc(f.oc(),f.Mb());n.Kp();n.normalize();var g=new a.b;g.pc(e.Mb(),f.Mb());var x=new a.b;x.pc(e.oc(),f.Mb());var g=g.ml(n),n=x.ml(n),x=Math.abs(g),
b=Math.abs(n);if(x<b){if(x<this.tp&&f.Kh(e.na,e.ja,this.ka))return this.Oh()}else if(b<this.tp&&f.Kh(e.la,e.ha,this.ka))return this.Oh();return 0>g&&0>n?-1:0<g&&0<n?1:this.Oh()};e.prototype.FB=function(e,f){return e.ja==f.ja&&e.na==f.na?this.mL(e,f):e.ha==f.ha&&e.la==f.la?this.nL(e,f):this.oL(e,f)};e.prototype.qL=function(e,f){return e.ha==f.ha&&e.la==f.la&&e.ja==f.ja&&e.na==f.na?this.lx?this.aw():0:this.Oh()};e.prototype.GB=function(e,f){var a=1;if(e.ib.ja<f.ib.ja){var a=-1,n=e;e=f;f=n}n=e.ib;e=
f.ib;var g=n.na-e.na;f=f.ux*(n.ja-e.ja);var x=this.tp;return g<f-x?-a:g>f+x?a:e.Kh(n.na,n.ja,this.ka)?this.Oh():g<f?-a:a};e.prototype.HB=function(e,f){var a=1;if(f.ib.ha<e.ib.ha){var a=-1,n=e;e=f;f=n}n=e.ib;e=f.ib;var g=n.la-e.na;f=f.ux*(n.ha-e.ja);var x=this.tp;return g<f-x?-a:g>f+x?a:e.Kh(n.la,n.ha,this.ka)?this.Oh():g<f?-a:a};e.prototype.aw=function(){this.Zf=!0;this.ei=new a.wd(5,this.un,this.mr);return-1};e.prototype.Oh=function(){this.Zf=!0;this.lx?this.ei=new a.wd(4,this.un,this.mr):this.mr=
this.un=this.gr=this.fr=-1;return-1};e.prototype.sL=function(e,f,a,g){if(this.Zf)return-1;var n=this.nE==this.Mj&&this.mE==this.sp,x;n&&e==this.fr?x=this.oE:(x=NaN,this.fr=-1);n&&f==this.gr?n=this.pE:(n=NaN,this.gr=-1);a.Zd.XE(b);g.Zd.XE(z);if(b.va<z.qa)return-1;if(z.va<b.qa)return 1;this.nE=this.Mj;this.mE=this.sp;isNaN(x)&&(this.fr=e,this.oE=x=e=a.Zd.xe(this.Mj,this.sp));isNaN(n)&&(this.gr=f,this.pE=n=e=g.Zd.xe(this.Mj,this.sp));return Math.abs(x-n)<=this.ka?this.tL(a.Zd,g.Zd):x<n?-1:x>n?1:0};e.prototype.lq=
function(){this.Zf=!1};e.prototype.rl=function(){return this.ei};e.prototype.XF=function(e,f){this.Mj=e;this.sp=f;this.mr=this.un=this.gr=this.fr=-1};e.prototype.compare=function(e,f,a){if(this.Zf)return-1;e=e.da(a);this.Cl=a;return this.JB(f,f,e,e)};e.prototype.JB=function(e,f,a,g){var n;this.un==f?n=this.Rx:(this.un=f,n=this.Rx,this.Rx.Lf=e,this.$C(n,f,this.a.cd.f,this.a.Ge));var x;null==x&&(this.mr=g,x=this.vE,this.vE.Lf=a,this.$C(x,g,this.a.cd.f,this.a.Ge));if(n.Et||x.Et)return this.sL(f,g,n,
x);if(n.$h.va<x.$h.qa)return-1;if(x.$h.va<n.$h.qa)return 1;e=n.Ft?1:0;e|=x.Ft?2:0;return 0==e?this.rL(n,x):1==e?this.FB(n.ib,x.ib):2==e?-1*this.FB(x.ib,n.ib):this.qL(n.ib,x.ib)};return e}();a.hA=e})(E||(E={}));(function(a){var b=function(){function b(g,e){this.a=g;this.ka=e;this.Zf=!1;this.un=-1;this.$h=new a.Nd;this.pp=new a.b;this.pp.Eh();this.Vd=new a.yb;this.Cl=-1;this.Cx=1.7976931348623157E308}b.prototype.lq=function(){this.Zf=!1;this.Cx=1.7976931348623157E308};b.prototype.bh=function(a){this.pp.J(a)};
b.prototype.compare=function(a,e){return this.KB(e,a.da(e))};b.prototype.KB=function(g,e){var f=null!=this.a.cc(e);f||(this.a.Oc(e,this.Vd),this.$h.yy(this.Vd.na,this.Vd.la));if(f)throw a.g.ra("not implemented");if(this.pp.x+this.ka<this.$h.qa)return-1;if(this.pp.x-this.ka>this.$h.va)return 1;if(this.Vd.ja==this.Vd.ha)return this.Cl=g,this.Zf=!0,0;this.Vd.KE();e=this.Vd.Mb();f=new a.b;f.pc(this.Vd.oc(),e);f.Kp();var n=new a.b;n.pc(this.pp,e);e=f.ml(n);e/=f.length();return e<10*-this.ka?-1:e>10*this.ka?
1:this.Vd.Eq(this.pp,this.ka)&&(f=Math.abs(e),f<this.Cx&&(this.Cl=g,this.Cx=f),this.Zf=!0,f<.25*this.ka)?0:0>e?-1:1};return b}();a.JI=b})(E||(E={}));(function(a){function b(a,e,f,n){f=new Float64Array(a.subarray(f,n));a.set(f,e)}var c=function(){function g(e){this.Sa=this.Xf=!1;this.f=[];var f=e;2>f&&(f=2);this.f=a.I.Lh(f,g.ob);this.size=e}g.Yc=function(e,f){g.ob=f;e=new g(e);g.ob=0;return e};g.lj=function(e){var f=new g(0);f.f=e.f.slice(0);f.size=e.size;return f};g.V=function(e,f){var a=new g(0);
a.size=e.size;a.size>f&&(a.size=f);a.f=e.f.slice(0,a.size);return a};g.prototype.xb=function(){};g.prototype.read=function(e){return this.f[e]};g.prototype.ec=function(e,f){f.x=this.f[e];f.y=this.f[e+1]};g.prototype.get=function(e){return this.f[e]};g.prototype.write=function(e,f){if(this.Sa)throw a.g.xa();this.f[e]=f};g.prototype.set=function(e,f){if(this.Sa)throw a.g.xa();this.f[e]=f};g.prototype.Rn=function(e,f){if(this.Sa)throw a.g.xa();this.f[e]=f.x;this.f[e+1]=f.y};g.prototype.add=function(e){this.resize(this.size+
1);this.f[this.size-1]=e};g.prototype.Ip=function(e){return g.V(this,e)};g.prototype.Bh=function(e){return this.read(e)};g.prototype.resize=function(e,f){void 0===f&&(f=0);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");if(e<=this.size){if(a.I.truncate(5*e/4)<this.f.length){var n=this.f.slice(0,e);this.f=n}}else if(e>this.f.length){a.I.truncate(64>e?Math.max(2*e,4):5*e/4);for(var n=this.f.slice(0),g=this.f.length;g<e;g++)n[g]=f;this.f=n}this.size=e};g.prototype.cf=
function(e){(null==this.f||e>this.f.length)&&this.resize(e);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");this.size=e};g.prototype.Uk=function(e,f){this.write(e,f)};g.prototype.jj=function(e,f,n){for(var g=this.size;f<g&&f<n;f++)e=a.I.Rh(this.read(f));return e};g.prototype.lc=function(e,f,a){if(null==e||!(e instanceof g))return!1;var n=this.size,b=e.size;if(a>n||a>b&&n!=b)return!1;for(a>n&&(a=n);f<a;f++)if(this.read(f)!=e.read(f))return!1;return!0};g.prototype.nk=
function(e,f,n,g,b,c,z){if(this.Sa)throw a.g.xa();if(!b&&(1>c||0!=g%c))throw a.g.N();var x=this.size-z;x<g&&this.resize(this.size+g-x);for(x=0;x<z-e;x++)this.f[e+g+x]=this.f[e+x];this.f==f.f&&e<n&&(n+=g);if(b)for(x=0;x<g;x++)this.f[x+e]=f.f[n+x];else for(b=g,z=0;z<g;z+=c)for(b-=c,x=0;x<c;x++)this.f[e+z+x]=f.f[n+b+x]};g.prototype.ul=function(e,f,n,g){if(this.Sa)throw a.g.xa();g-=e;for(var x=this.f.slice(e,e+g),b=0;b<g;b++)this.f[e+n+b]=x[b];for(g=0;g<n;g++)this.f[e+g]=f};g.prototype.lg=function(e,
f,n){if(this.Sa)throw a.g.xa();for(var g=this.f.slice(e,e+(n-e)),b=0;b<n-e;b++)this.f[b+e+2]=g[b];this.f[e]=f.x;this.f[e+1]=f.y};g.prototype.km=function(e,f,n,g,b,c){if(0>e||0>f||0>g)throw a.g.N();if(!b&&(0>=c||0!=f%c))throw a.g.N();if(n.size<g+f)throw a.g.N();if(0!=f)if(this.size<f+e&&this.resize(f+e),n==this)this.xi(e,f,g,b,c);else if(b)for(b=0;b<f;b++)this.f[e]=n.f[g],e++,g++;else if(g=g+f-c,1==c)for(b=0;b<f;b++)this.f[e]=n.f[g],e++,g--;else for(b=0,f=a.I.truncate(f/c);b<f;b++){for(var x=0;x<c;x++)this.f[e+
x]=n.f[g+x];e+=c;g-=c}};g.prototype.oj=function(e,f,n){if(this.Sa)throw a.g.xa();if(e+f>this.size)throw a.g.xa();if(0<n-(e+f)){n-=e+f;for(var g=this.f.slice(e+f,e+n+f),b=0;b<n;b++)this.f[e+b]=g[b]}this.size-=f};g.prototype.Jp=function(e,f,n){if(this.Sa)throw a.g.xa();if(1>n||0!=f%n)throw a.g.xa();for(var g=f>>1,b=0;b<g;b+=n){f-=n;for(var c=0;c<n;c++){var z=this.f[e+b+c];this.f[e+b+c]=this.f[e+f+c];this.f[e+f+c]=z}}};g.prototype.dh=function(e,f,n){if(0>f||0>n||0>f||n+f>this.size)throw a.g.N();for(var g=
f;g<f+n;g++)this.f[g]=e};g.prototype.xi=function(e,f,n,g,b){if(!g||e!=n){for(var x=0;x<f;x++)this.f[e+x]=this.f[n+x];if(!g)for(n=e,e=e+f-b,g=0,f=a.I.truncate(f/2);g<f;g++){for(x=0;x<b;x++){var I=this.f[n+x];this.f[n+x]=this.f[e+x];this.f[e+x]=I}n+=b;e-=b}}};g.prototype.$p=function(e,f,n,g,b){if(0>e||0>f||0>g)throw a.g.N();if(0!=f)for(this.size<(f<<1)+e&&this.resize((f<<1)+e),b||(e+=f-1<<1),b=b?2:-2,f+=g;g<f;g++)this.f[e]=n[g].x,this.f[e+1]=n[g].y,e+=b};g.prototype.Hp=function(e,f,n,g,b){if(0>e||0>
f||0>g||this.size<f+e)throw a.g.N();if(b)for(b=0;b<f;b++)n[g+b]=this.f[e+b];else for(g=g+f-1;e<f;e++)n[g]=this.f[e],g--};g.prototype.clear=function(e){e?this.resize(0):this.cf(0)};g.prototype.xd=function(e,f,a){var n=this.f.slice(0,e),g=this.f.slice(f);e=this.f.slice(e,f).sort(a);this.f.length=0;this.f.push.apply(this.f,n.concat(e).concat(g))};g.prototype.Qh=function(){return 1};g.ob=0;return g}();a.qd=c;c=function(){function g(e){this.Sa=this.Xf=!1;this.f=null;var f=e;2>f&&(f=2);this.f=new Float64Array(f);
this.size=e}g.Yc=function(e,f){var a=new g(e),x=a.f;2>e&&(e=2);if(0!==f)for(var b=0;b<e;b++)x[b]=f;return a};g.lj=function(e){var f=new g(0);f.f=new Float64Array(e.f);f.size=e.size;return f};g.V=function(e,f){var a=new g(0);a.size=e.size;a.size>f&&(a.size=f);f=a.size;2>f&&(f=2);a.f=new Float64Array(f);a.f.set(e.f.length<=f?e.f:e.f.subarray(0,f),0);return a};g.prototype.xb=function(e){0>=e||(null==this.f?this.f=new Float64Array(e):e<=this.f.length||(0<this.f.length?(e=new Float64Array(e),e.set(this.f),
this.f=e):this.f=new Float64Array(e)))};g.prototype.read=function(e){return this.f[e]};g.prototype.ec=function(e,f){f.x=this.f[e];f.y=this.f[e+1]};g.prototype.get=function(e){return this.f[e]};g.prototype.write=function(e,f){if(this.Sa)throw a.g.xa();this.f[e]=f};g.prototype.set=function(e,f){if(this.Sa)throw a.g.xa();this.f[e]=f};g.prototype.Rn=function(e,f){if(this.Sa)throw a.g.xa();this.f[e]=f.x;this.f[e+1]=f.y};g.prototype.add=function(e){this.resize(this.size+1);this.f[this.size-1]=e};g.prototype.Ip=
function(e){return g.V(this,e)};g.prototype.Bh=function(e){return this.read(e)};g.prototype.resize=function(e,f){void 0===f&&(f=0);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");if(e<=this.size){if(30<this.f.length&&5*e/4<this.f.length){var n=new Float64Array(this.f,0,e);this.f=n}}else{e>this.f.length&&(n=a.I.truncate(64>e?Math.max(2*e,4):5*e/4),n=new Float64Array(n),n.set(this.f),this.f=n);for(var n=this.f,g=this.size;g<e;g++)n[g]=f}this.size=e};g.prototype.cf=
function(e){(null==this.f||e>this.f.length)&&this.resize(e);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");this.size=e};g.prototype.Uk=function(e,f){this.write(e,f)};g.prototype.jj=function(e,f,n){for(var g=this.size;f<g&&f<n;f++)e=a.I.Rh(this.read(f));return e};g.prototype.lc=function(e,f,a){if(null==e||!(e instanceof g))return!1;var n=this.size,b=e.size;if(a>n||a>b&&n!=b)return!1;for(a>n&&(a=n);f<a;f++)if(this.read(f)!=e.read(f))return!1;return!0};g.prototype.nk=
function(e,f,n,g,I,c,z){if(this.Sa)throw a.g.xa();if(!I&&(1>c||0!=g%c))throw a.g.N();var x=this.size-z;x<g&&this.resize(this.size+g-x);b(this.f,e+g,e,e+(z-e));this.f==f.f&&e<n&&(n+=g);if(I)this.f.set(f.f.subarray(n,n+g),e);else for(I=g,z=0;z<g;z+=c)for(I-=c,x=0;x<c;x++)this.f[e+z+x]=f.f[n+I+x]};g.prototype.ul=function(e,f,n,g){if(this.Sa)throw a.g.xa();g-=e;b(this.f,e+g,e,e+g);for(g=0;g<n;g++)this.f[e+g]=f};g.prototype.lg=function(e,f,n){if(this.Sa)throw a.g.xa();b(this.f,e+2,e,e+(n-e));this.f[e]=
f.x;this.f[e+1]=f.y};g.prototype.km=function(e,f,n,g,b,c){if(0>e||0>f||0>g)throw a.g.N();if(!b&&(0>=c||0!=f%c))throw a.g.N();if(n.size<g+f)throw a.g.N();if(0!=f)if(this.size<f+e&&this.resize(f+e),n==this)this.xi(e,f,g,b,c);else if(b)for(b=0;b<f;b++)this.f[e]=n.f[g],e++,g++;else if(g=g+f-c,1==c)for(b=0;b<f;b++)this.f[e]=n.f[g],e++,g--;else for(b=0,f=a.I.truncate(f/c);b<f;b++){for(var x=0;x<c;x++)this.f[e+x]=n.f[g+x];e+=c;g-=c}};g.prototype.oj=function(e,f,n){if(this.Sa)throw a.g.xa();if(e+f>this.size)throw a.g.xa();
0<n-(e+f)&&b(this.f,e,e+f,e+(n-(e+f))+f);this.size-=f};g.prototype.Jp=function(e,f,n){if(this.Sa)throw a.g.xa();if(1>n||0!=f%n)throw a.g.xa();for(var g=f>>1,b=0;b<g;b+=n){f-=n;for(var c=0;c<n;c++){var z=this.f[e+b+c];this.f[e+b+c]=this.f[e+f+c];this.f[e+f+c]=z}}};g.prototype.dh=function(e,f,n){if(0>f||0>n||0>f||n+f>this.size)throw a.g.N();for(var g=f;g<f+n;g++)this.f[g]=e};g.prototype.xi=function(e,f,n,g,b){if(!g||e!=n)if(this.f.set(this.f.subarray(n,n+f),e),!g)for(n=e,e=e+f-b,g=0,f=a.I.truncate(f/
2);g<f;g++){for(var x=0;x<b;x++){var I=this.f[n+x];this.f[n+x]=this.f[e+x];this.f[e+x]=I}n+=b;e-=b}};g.prototype.$p=function(e,f,n,g,b){if(0>e||0>f||0>g)throw a.g.N();if(0!=f)for(this.size<(f<<1)+e&&this.resize((f<<1)+e),b||(e+=f-1<<1),b=b?2:-2,f+=g;g<f;g++)this.f[e]=n[g].x,this.f[e+1]=n[g].y,e+=b};g.prototype.Hp=function(e,f,n,g,b){if(0>e||0>f||0>g||this.size<f+e)throw a.g.N();if(b)for(b=0;b<f;b++)n[g+b]=this.f[e+b];else for(g=g+f-1;e<f;e++)n[g]=this.f[e],g--};g.prototype.clear=function(e){e?this.resize(0):
this.cf(0)};g.prototype.xd=function(e,f,a){Array.prototype.sort.call(this.f.subarray(e,f),a)};g.prototype.Qh=function(){return 1};return g}();a.QG=c})(E||(E={}));!0===E.ah.Sk&&!0===E.ah.it&&(E.qd=E.QG);(function(a){function b(a,e,f,n){f=new Int32Array(a.subarray(f,n));a.set(f,e)}a.tT=function(){return function(){this.random=1973}}();var c=function(){function g(e){this.Sa=this.Xf=!1;this.f=[];var f=e;2>f&&(f=2);this.f=this.f=a.I.Lh(f,g.ob);this.size=e}g.Yc=function(e,f){g.ob=f;e=new g(e);g.ob=0;return e};
g.lj=function(e){var f=new g(0);f.f=e.f.slice(0);f.size=e.size;return f};g.V=function(e,f){var a=new g(0);a.size=e.size;a.size>f&&(a.size=f);a.f=e.f.slice(0,a.size);return a};g.prototype.xb=function(){};g.prototype.read=function(e){return this.f[e]};g.prototype.ec=function(e,f){f.x=this.f[e];f.y=this.f[e+1]};g.prototype.get=function(e){return this.f[e]};g.prototype.write=function(e,f){if(this.Sa)throw a.g.xa();this.f[e]=f};g.prototype.set=function(e,f){if(this.Sa)throw a.g.xa();this.f[e]=f};g.prototype.Rn=
function(e,f){if(this.Sa)throw a.g.xa();this.f[e]=f.x;this.f[e+1]=f.y};g.prototype.add=function(e){this.resize(this.size+1);this.f[this.size-1]=e};g.prototype.Ip=function(e){return g.V(this,e)};g.prototype.Bh=function(e){return this.read(e)};g.prototype.resize=function(e,f){void 0===f&&(f=0);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");if(e<=this.size){if(a.I.truncate(5*e/4)<this.f.length){var n=this.f.slice(0,e);this.f=n}}else if(e>this.f.length){a.I.truncate(64>
e?Math.max(2*e,4):5*e/4);for(var n=this.f.slice(0),g=this.f.length;g<e;g++)n[g]=f;this.f=n}this.size=e};g.prototype.cf=function(e){(null==this.f||e>this.f.length)&&this.resize(e);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");this.size=e};g.prototype.Uk=function(e,f){this.write(e,f)};g.prototype.jj=function(e,f,n){for(var g=this.size;f<g&&f<n;f++)e=a.I.kg(this.read(f),e);return e};g.prototype.lc=function(e,f,a){if(null==e||!(e instanceof g))return!1;var n=
this.size,b=e.size;if(a>n||a>b&&n!=b)return!1;for(a>n&&(a=n);f<a;f++)if(this.read(f)!=e.read(f))return!1;return!0};g.prototype.nk=function(e,f,n,g,b,c,z){if(this.Sa)throw a.g.xa();if(!b&&(1>c||0!=g%c))throw a.g.N();for(var x=0;x<z-e;x++)this.f[e+g+x]=this.f[e+x];this.f==f.f&&e<n&&(n+=g);if(b)for(x=0;x<g;x++)this.f[x+e]=f.f[n+x];else for(b=g,z=0;z<g;z+=c)for(b-=c,x=0;x<c;x++)this.f[e+z+x]=f.f[n+b+x]};g.prototype.ul=function(e,f,n,g){if(this.Sa)throw a.g.xa();g-=e;for(var x=this.f.slice(e,e+g),b=0;b<
g;b++)this.f[e+n+b]=x[b];for(g=0;g<n;g++)this.f[e+g]=f};g.prototype.lg=function(e,f,n){if(this.Sa)throw a.g.xa();for(var g=this.f.slice(e,e+(n-e)),b=0;b<n-e;b++)this.f[b+e+2]=g[b];this.f[e]=f.x;this.f[e+1]=f.y};g.prototype.km=function(e,f,n,g,b,c){if(0>e||0>f||0>g)throw a.g.N();if(!b&&(0>=c||0!=f%c))throw a.g.N();if(n.size<g+f)throw a.g.N();if(0!=f)if(this.size<f+e&&this.resize(f+e),n==this)this.xi(e,f,g,b,c);else if(b)for(b=0;b<f;b++)this.f[e]=n.f[g],e++,g++;else if(g=g+f-c,1==c)for(b=0;b<f;b++)this.f[e]=
n.f[g],e++,g--;else for(b=0,f=a.I.truncate(f/c);b<f;b++){for(var x=0;x<c;x++)this.f[e+x]=n.f[g+x];e+=c;g-=c}};g.prototype.oj=function(e,f,n){if(this.Sa)throw a.g.xa();if(e+f>this.size)throw a.g.xa();if(0<n-(e+f)){n-=e+f;for(var g=this.f.slice(e+f,e+n+f),b=0;b<n;b++)this.f[e+b]=g[b]}this.size-=f};g.prototype.Jp=function(e,f,n){if(this.Sa)throw a.g.xa();if(1>n||0!=f%n)throw a.g.xa();for(var g=f>>1,b=0;b<g;b+=n){f-=n;for(var c=0;c<n;c++){var z=this.f[e+b+c];this.f[e+b+c]=this.f[e+f+c];this.f[e+f+c]=
z}}};g.prototype.dh=function(e,f,n){if(0>f||0>n||0>f||n+f>this.size)throw a.g.N();for(var g=f;g<f+n;g++)this.f[g]=e};g.prototype.xi=function(e,f,n,g,b){if(!g||e!=n){for(var x=0;x<f;x++)this.f[e+x]=this.f[n+x];if(!g)for(n=e,e=e+f-b,g=0,f=a.I.truncate(f/2);g<f;g++){for(x=0;x<b;x++){var I=this.f[n+x];this.f[n+x]=this.f[e+x];this.f[e+x]=I}n+=b;e-=b}}};g.prototype.$p=function(e,f,n,g,b){if(0>e||0>f||0>g)throw a.g.N();if(0!=f)for(this.size<(f<<1)+e&&this.resize((f<<1)+e),b||(e+=f-1<<1),b=b?2:-2,f+=g;g<
f;g++)this.f[e]=n[g].x,this.f[e+1]=n[g].y,e+=b};g.prototype.Hp=function(e,f,n,g,b){if(0>e||0>f||0>g||this.size<f+e)throw a.g.N();if(b)for(b=0;b<f;b++)n[g+b]=this.f[e+b];else for(g=g+f-1;e<f;e++)n[g]=this.f[e],g--};g.prototype.clear=function(e){e?this.resize(0):this.cf(0)};g.prototype.xd=function(e,f,a){var n=this.f.slice(0,e),g=this.f.slice(f);e=this.f.slice(e,f).sort(a);this.f.length=0;this.f.push.apply(this.f,n.concat(e).concat(g))};g.prototype.Qh=function(){return 2};g.prototype.tc=function(){return this.f[this.size-
1]};g.prototype.af=function(){this.resize(this.size-1)};g.prototype.JF=function(e){this.f[this.size-1]=e};g.prototype.QE=function(e){e<this.size-1&&(this.f[e]=this.f[this.size-1]);this.resize(this.size-1)};g.prototype.Qs=function(e){for(var f=0,a=this.size;f<a;f++)if(this.f[f]==e)return f;return-1};g.prototype.Nw=function(e){return 0<=this.Qs(e)};g.ob=0;return g}();a.ga=c;c=function(){function g(e){this.Sa=this.Xf=!1;this.f=null;var f=e;2>f&&(f=2);this.f=new Int32Array(f);this.size=e}g.Yc=function(e,
f){var a=new g(e),x=a.f;2>e&&(e=2);if(0!==f)for(var b=0;b<e;b++)x[b]=f;return a};g.lj=function(e){var f=new g(0);f.f=new Int32Array(e.f);f.size=e.size;return f};g.V=function(e,f){var a=new g(0);a.size=e.size;a.size>f&&(a.size=f);f=a.size;2>f&&(f=2);a.f=new Int32Array(f);a.f.set(e.f.length<=f?e.f:e.f.subarray(0,f),0);return a};g.prototype.xb=function(e){0>=e||(null==this.f?this.f=new Int32Array(e):e<=this.f.length||(0<this.f.length?(e=new Int32Array(e),e.set(this.f),this.f=e):this.f=new Int32Array(e)))};
g.prototype.read=function(e){return this.f[e]};g.prototype.ec=function(e,f){f.x=this.f[e];f.y=this.f[e+1]};g.prototype.get=function(e){return this.f[e]};g.prototype.write=function(e,f){if(this.Sa)throw a.g.xa();this.f[e]=f};g.prototype.set=function(e,f){if(this.Sa)throw a.g.xa();this.f[e]=f};g.prototype.Rn=function(e,f){if(this.Sa)throw a.g.xa();this.f[e]=f.x;this.f[e+1]=f.y};g.prototype.add=function(e){this.resize(this.size+1);this.f[this.size-1]=e};g.prototype.Ip=function(e){return g.V(this,e)};
g.prototype.Bh=function(e){return this.read(e)};g.prototype.resize=function(e,f){void 0===f&&(f=0);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");if(e<=this.size){if(30<this.f.length&&5*e/4<this.f.length){var n=new Int32Array(this.f,0,e);this.f=n}}else{e>this.f.length&&(n=a.I.truncate(64>e?Math.max(2*e,4):5*e/4),n=new Int32Array(n),n.set(this.f),this.f=n);for(var n=this.f,g=this.size;g<e;g++)n[g]=f}this.size=e};g.prototype.cf=function(e){(null==this.f||
e>this.f.length)&&this.resize(e);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");this.size=e};g.prototype.Uk=function(e,f){this.write(e,f)};g.prototype.jj=function(e,f,n){for(var g=this.size;f<g&&f<n;f++)e=a.I.kg(this.read(f),e);return e};g.prototype.lc=function(e,f,a){if(null==e||!(e instanceof g))return!1;var n=this.size,b=e.size;if(a>n||a>b&&n!=b)return!1;for(a>n&&(a=n);f<a;f++)if(this.read(f)!=e.read(f))return!1;return!0};g.prototype.nk=function(e,f,
n,g,I,c,z){if(this.Sa)throw a.g.xa();if(!I&&(1>c||0!=g%c))throw a.g.N();b(this.f,e+g,e,e+(z-e));this.f==f.f&&e<n&&(n+=g);if(I)this.f.set(f.f.subarray(n,n+g),e);else for(I=g,z=0;z<g;z+=c){I-=c;for(var x=0;x<c;x++)this.f[e+z+x]=f.f[n+I+x]}};g.prototype.ul=function(e,f,n,g){if(this.Sa)throw a.g.xa();g-=e;b(this.f,e+g,e,e+g);for(g=0;g<n;g++)this.f[e+g]=f};g.prototype.lg=function(e,f,n){if(this.Sa)throw a.g.xa();b(this.f,e+2,e,e+(n-e));this.f[e]=f.x;this.f[e+1]=f.y};g.prototype.km=function(e,f,n,g,b,c){if(0>
e||0>f||0>g)throw a.g.N();if(!b&&(0>=c||0!=f%c))throw a.g.N();if(n.size<g+f)throw a.g.N();if(0!=f)if(this.size<f+e&&this.resize(f+e),n==this)this.xi(e,f,g,b,c);else if(b)for(b=0;b<f;b++)this.f[e]=n.f[g],e++,g++;else if(g=g+f-c,1==c)for(b=0;b<f;b++)this.f[e]=n.f[g],e++,g--;else for(b=0,f=a.I.truncate(f/c);b<f;b++){for(var x=0;x<c;x++)this.f[e+x]=n.f[g+x];e+=c;g-=c}};g.prototype.oj=function(e,f,n){if(this.Sa)throw a.g.xa();if(e+f>this.size)throw a.g.xa();0<n-(e+f)&&b(this.f,e,e+f,e+(n-(e+f))+f);this.size-=
f};g.prototype.Jp=function(e,f,n){if(this.Sa)throw a.g.xa();if(1>n||0!=f%n)throw a.g.xa();for(var g=f>>1,b=0;b<g;b+=n){f-=n;for(var c=0;c<n;c++){var z=this.f[e+b+c];this.f[e+b+c]=this.f[e+f+c];this.f[e+f+c]=z}}};g.prototype.dh=function(e,f,n){if(0>f||0>n||0>f||n+f>this.size)throw a.g.N();for(var g=f;g<f+n;g++)this.f[g]=e};g.prototype.xi=function(e,f,n,g,b){if(!g||e!=n)if(this.f.set(this.f.subarray(n,n+f),e),!g)for(n=e,e=e+f-b,g=0,f=a.I.truncate(f/2);g<f;g++){for(var x=0;x<b;x++){var I=this.f[n+x];
this.f[n+x]=this.f[e+x];this.f[e+x]=I}n+=b;e-=b}};g.prototype.$p=function(e,f,n,g,b){if(0>e||0>f||0>g)throw a.g.N();if(0!=f)for(this.size<(f<<1)+e&&this.resize((f<<1)+e),b||(e+=f-1<<1),b=b?2:-2,f+=g;g<f;g++)this.f[e]=n[g].x,this.f[e+1]=n[g].y,e+=b};g.prototype.Hp=function(e,f,n,g,b){if(0>e||0>f||0>g||this.size<f+e)throw a.g.N();if(b)for(b=0;b<f;b++)n[g+b]=this.f[e+b];else for(g=g+f-1;e<f;e++)n[g]=this.f[e],g--};g.prototype.clear=function(e){e?this.resize(0):this.cf(0)};g.prototype.xd=function(e,f,
a){10>f-e?g.$i(this.f,e,f,a):g.$g(this.f,e,f-1,a)};g.prototype.Qh=function(){return 2};g.prototype.tc=function(){return this.f[this.size-1]};g.prototype.af=function(){this.resize(this.size-1)};g.prototype.JF=function(e){this.f[this.size-1]=e};g.prototype.QE=function(e){e<this.size-1&&(this.f[e]=this.f[this.size-1]);this.resize(this.size-1)};g.prototype.Qs=function(e){for(var f=0,a=this.size;f<a;f++)if(this.f[f]==e)return f;return-1};g.prototype.Nw=function(e){return 0<=this.Qs(e)};g.$i=function(e,
f,a,g){for(var n=f;n<a;n++){for(var x=e[n],b=n-1;b>=f&&0<g(e[b],x);)e[b+1]=e[b],b--;e[b+1]=x}};g.Wf=function(e,f,a){var n=e[a];e[a]=e[f];e[f]=n};g.$g=function(e,f,a,x){if(!(f>=a))for(;;){if(9>a-f){g.$i(e,f,a+1,x);break}var n=e[f];g.Wf(e,f,a);for(var b=f,c=f;c<a;c++)0>=x(e[c],n)&&(g.Wf(e,b,c),b+=1);g.Wf(e,b,a);b-f<a-b?(g.$g(e,f,b-1,x),f=b+1):(g.$g(e,b+1,a,x),a=b-1)}};return g}();a.Xu=c})(E||(E={}));!0===E.ah.Sk&&(E.ga=E.Xu);(function(a){function b(a,e,f,n){f=new Int8Array(a.subarray(f,n));a.set(f,
e)}var c=function(){function g(e){this.Sa=this.Xf=!1;this.f=[];var f=e;2>f&&(f=2);this.f=a.I.Lh(f,g.ob);this.size=e}g.Yc=function(e,f){g.ob=f;e=new g(e);g.ob=0;return e};g.lj=function(e){var f=new g(0);f.f=e.f.slice(0);f.size=e.size;return f};g.V=function(e,f){var a=new g(0);a.size=e.size;a.size>f&&(a.size=f);a.f=e.f.slice(0,a.size);return a};g.prototype.xb=function(){};g.prototype.read=function(e){return this.f[e]};g.prototype.ec=function(e,f){f.x=this.f[e];f.y=this.f[e+1]};g.prototype.get=function(e){return this.f[e]};
g.prototype.write=function(e,f){if(this.Sa)throw a.g.xa();this.f[e]=f};g.prototype.set=function(e,f){if(this.Sa)throw a.g.xa();this.f[e]=f};g.prototype.Rn=function(e,f){if(this.Sa)throw a.g.xa();this.f[e]=f.x;this.f[e+1]=f.y};g.prototype.add=function(e){this.resize(this.size+1);this.f[this.size-1]=e};g.prototype.Ip=function(e){return g.V(this,e)};g.prototype.Bh=function(e){return this.read(e)};g.prototype.resize=function(e,f){void 0===f&&(f=0);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");
if(e<=this.size){if(a.I.truncate(5*e/4)<this.f.length){var n=this.f.slice(0,e);this.f=n}}else if(e>this.f.length){a.I.truncate(64>e?Math.max(2*e,4):5*e/4);for(var n=this.f.slice(0),g=this.f.length;g<e;g++)n[g]=f;this.f=n}this.size=e};g.prototype.cf=function(e){(null==this.f||e>this.f.length)&&this.resize(e);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");this.size=e};g.prototype.Uk=function(e,f){this.write(e,f)};g.prototype.jj=function(e,f,n){for(var g=this.size;f<
g&&f<n;f++)e=a.I.kg(this.read(f),e);return e};g.prototype.lc=function(e,f,a){if(null==e||!(e instanceof g))return!1;var n=this.size,b=e.size;if(a>n||a>b&&n!=b)return!1;for(a>n&&(a=n);f<a;f++)if(this.read(f)!=e.read(f))return!1;return!0};g.prototype.nk=function(e,f,n,g,b,c,z){if(this.Sa)throw a.g.xa();if(!b&&(1>c||0!=g%c))throw a.g.N();for(var x=0;x<z-e;x++)this.f[e+g+x]=this.f[e+x];this.f==f.f&&e<n&&(n+=g);if(b)for(x=0;x<g;x++)this.f[x+e]=f.f[n+x];else for(b=g,z=0;z<g;z+=c)for(b-=c,x=0;x<c;x++)this.f[e+
z+x]=f.f[n+b+x]};g.prototype.ul=function(e,f,n,g){if(this.Sa)throw a.g.xa();g-=e;for(var x=this.f.slice(e,e+g),b=0;b<g;b++)this.f[e+n+b]=x[b];for(g=0;g<n;g++)this.f[e+g]=f};g.prototype.lg=function(e,f,n){if(this.Sa)throw a.g.xa();for(var g=this.f.slice(e,e+(n-e)),b=0;b<n-e;b++)this.f[b+e+2]=g[b];this.f[e]=f.x;this.f[e+1]=f.y};g.prototype.km=function(e,f,n,g,b,c){if(0>e||0>f||0>g)throw a.g.N();if(!b&&(0>=c||0!=f%c))throw a.g.N();if(n.size<g+f)throw a.g.N();if(0!=f)if(this.size<f+e&&this.resize(f+e),
n==this)this.xi(e,f,g,b,c);else if(b)for(b=0;b<f;b++)this.f[e]=n.f[g],e++,g++;else if(g=g+f-c,1==c)for(b=0;b<f;b++)this.f[e]=n.f[g],e++,g--;else for(b=0,f=a.I.truncate(f/c);b<f;b++){for(var x=0;x<c;x++)this.f[e+x]=n.f[g+x];e+=c;g-=c}};g.prototype.oj=function(e,f,n){if(this.Sa)throw a.g.xa();if(e+f>this.size)throw a.g.xa();if(0<n-(e+f)){n-=e+f;for(var g=this.f.slice(e+f,e+n+f),b=0;b<n;b++)this.f[e+b]=g[b]}this.size-=f};g.prototype.Jp=function(e,f,n){if(this.Sa)throw a.g.xa();if(1>n||0!=f%n)throw a.g.xa();
for(var g=f>>1,b=0;b<g;b+=n){f-=n;for(var c=0;c<n;c++){var z=this.f[e+b+c];this.f[e+b+c]=this.f[e+f+c];this.f[e+f+c]=z}}};g.prototype.dh=function(e,f,n){if(0>f||0>n||0>f||n+f>this.size)throw a.g.N();for(var g=f;g<f+n;g++)this.f[g]=e};g.prototype.xi=function(e,f,n,g,b){if(!g||e!=n){for(var x=0;x<f;x++)this.f[e+x]=this.f[n+x];if(!g)for(n=e,e=e+f-b,g=0,f=a.I.truncate(f/2);g<f;g++){for(x=0;x<b;x++){var I=this.f[n+x];this.f[n+x]=this.f[e+x];this.f[e+x]=I}n+=b;e-=b}}};g.prototype.$p=function(e,f,n,g,b){if(0>
e||0>f||0>g)throw a.g.N();if(0!=f)for(this.size<(f<<1)+e&&this.resize((f<<1)+e),b||(e+=f-1<<1),b=b?2:-2,f+=g;g<f;g++)this.f[e]=n[g].x,this.f[e+1]=n[g].y,e+=b};g.prototype.Hp=function(e,f,n,g,b){if(0>e||0>f||0>g||this.size<f+e)throw a.g.N();if(b)for(b=0;b<f;b++)n[g+b]=this.f[e+b];else for(g=g+f-1;e<f;e++)n[g]=this.f[e],g--};g.prototype.clear=function(e){e?this.resize(0):this.cf(0)};g.prototype.xd=function(e,f,a){var n=this.f.slice(0,e),g=this.f.slice(f);e=this.f.slice(e,f).sort(a);this.f.length=0;
this.f.push.apply(this.f,n.concat(e).concat(g))};g.prototype.Qh=function(){return 1};g.prototype.xy=function(e,f){if(this.Sa)throw a.g.ra("invalid call. Attribute Stream is read only.");this.f[e]|=f};g.prototype.BB=function(e,f){if(this.Sa)throw a.g.ra("invalid call. Attribute Stream is read only.");this.f[e]&=~f};g.ob=0;return g}();a.Wk=c;c=function(){function g(e){this.f=null;var f=e;2>f&&(f=2);this.f=new Int8Array(f);this.size=e}g.Yc=function(e,f){var a=new g(e),b=a.f;2>e&&(e=2);if(0!==f)for(var c=
0;c<e;c++)b[c]=f;return a};g.lj=function(e){var f=new g(0);f.f=new Int8Array(e.f);f.size=e.size;return f};g.V=function(e,f){var a=new g(0);a.size=e.size;a.size>f&&(a.size=f);f=a.size;2>f&&(f=2);a.f=new Int8Array(f);a.f.set(e.f.length<=f?e.f:e.f.subarray(0,f),0);return a};g.prototype.xb=function(e){0>=e||(null==this.f?this.f=new Int8Array(e):e<=this.f.length||(0<this.f.length?(e=new Int8Array(e),e.set(this.f),this.f=e):this.f=new Int8Array(e)))};g.prototype.read=function(e){return this.f[e]};g.prototype.ec=
function(e,f){f.x=this.f[e];f.y=this.f[e+1]};g.prototype.get=function(e){return this.f[e]};g.prototype.write=function(e,f){if(this.Sa)throw a.g.xa();this.f[e]=f};g.prototype.set=function(e,f){if(this.Sa)throw a.g.xa();this.f[e]=f};g.prototype.Rn=function(e,f){if(this.Sa)throw a.g.xa();this.f[e]=f.x;this.f[e+1]=f.y};g.prototype.add=function(e){this.resize(this.size+1);this.f[this.size-1]=e};g.prototype.Ip=function(e){return g.V(this,e)};g.prototype.Bh=function(e){return this.read(e)};g.prototype.resize=
function(e,f){void 0===f&&(f=0);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");if(e<=this.size){if(30<this.f.length&&5*e/4<this.f.length){var n=new Int8Array(this.f,0,e);this.f=n}}else{e>this.f.length&&(n=a.I.truncate(64>e?Math.max(2*e,4):5*e/4),n=new Int8Array(n),n.set(this.f),this.f=n);for(var n=this.f,g=this.size;g<e;g++)n[g]=f}this.size=e};g.prototype.cf=function(e){(null==this.f||e>this.f.length)&&this.resize(e);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");
this.size=e};g.prototype.Uk=function(e,f){this.write(e,f)};g.prototype.jj=function(e,f,n){for(var g=this.size;f<g&&f<n;f++)e=a.I.kg(this.read(f),e);return e};g.prototype.lc=function(e,f,a){if(null==e||!(e instanceof g))return!1;var n=this.size,b=e.size;if(a>n||a>b&&n!=b)return!1;for(a>n&&(a=n);f<a;f++)if(this.read(f)!=e.read(f))return!1;return!0};g.prototype.nk=function(e,f,n,g,c,z,d){if(this.Sa)throw a.g.xa();if(!c&&(1>z||0!=g%z))throw a.g.N();b(this.f,e+g,e,e+(d-e));this.f==f.f&&e<n&&(n+=g);if(c)this.f.set(f.f.subarray(n,
n+g),e);else for(c=g,d=0;d<g;d+=z){c-=z;for(var x=0;x<z;x++)this.f[e+d+x]=f.f[n+c+x]}};g.prototype.ul=function(e,f,n,g){if(this.Sa)throw a.g.xa();g-=e;b(this.f,e+g,e,e+g);for(g=0;g<n;g++)this.f[e+g]=f};g.prototype.lg=function(e,f,n){if(this.Sa)throw a.g.xa();b(this.f,e+2,e,e+(n-e));this.f[e]=f.x;this.f[e+1]=f.y};g.prototype.km=function(e,f,n,g,b,c){if(0>e||0>f||0>g)throw a.g.N();if(!b&&(0>=c||0!=f%c))throw a.g.N();if(n.size<g+f)throw a.g.N();if(0!=f)if(this.size<f+e&&this.resize(f+e),n==this)this.xi(e,
f,g,b,c);else if(b)for(b=0;b<f;b++)this.f[e]=n.f[g],e++,g++;else if(g=g+f-c,1==c)for(b=0;b<f;b++)this.f[e]=n.f[g],e++,g--;else for(b=0,f=a.I.truncate(f/c);b<f;b++){for(var x=0;x<c;x++)this.f[e+x]=n.f[g+x];e+=c;g-=c}};g.prototype.oj=function(e,f,n){if(this.Sa)throw a.g.xa();if(e+f>this.size)throw a.g.xa();0<n-(e+f)&&b(this.f,e,e+f,e+(n-(e+f))+f);this.size-=f};g.prototype.Jp=function(e,f,n){if(this.Sa)throw a.g.xa();if(1>n||0!=f%n)throw a.g.xa();for(var g=f>>1,b=0;b<g;b+=n){f-=n;for(var c=0;c<n;c++){var z=
this.f[e+b+c];this.f[e+b+c]=this.f[e+f+c];this.f[e+f+c]=z}}};g.prototype.dh=function(e,f,n){if(0>f||0>n||0>f||n+f>this.size)throw a.g.N();for(var g=f;g<f+n;g++)this.f[g]=e};g.prototype.xi=function(e,f,n,g,b){if(!g||e!=n)if(this.f.set(this.f.subarray(n,n+f),e),!g)for(n=e,e=e+f-b,g=0,f=a.I.truncate(f/2);g<f;g++){for(var x=0;x<b;x++){var c=this.f[n+x];this.f[n+x]=this.f[e+x];this.f[e+x]=c}n+=b;e-=b}};g.prototype.$p=function(e,f,n,g,b){if(0>e||0>f||0>g)throw a.g.N();if(0!=f)for(this.size<(f<<1)+e&&this.resize((f<<
1)+e),b||(e+=f-1<<1),b=b?2:-2,f+=g;g<f;g++)this.f[e]=n[g].x,this.f[e+1]=n[g].y,e+=b};g.prototype.Hp=function(e,f,n,g,b){if(0>e||0>f||0>g||this.size<f+e)throw a.g.N();if(b)for(b=0;b<f;b++)n[g+b]=this.f[e+b];else for(g=g+f-1;e<f;e++)n[g]=this.f[e],g--};g.prototype.clear=function(e){e?this.resize(0):this.cf(0)};g.prototype.xd=function(e,f,a){f=this.f.subarray(e,f);Array.prototype.sort.call(f,a);this.f.set(f,e)};g.prototype.xy=function(e,f){if(this.Sa)throw a.g.ra("invalid call. Attribute Stream is read only.");
this.f[e]|=f};g.prototype.BB=function(e,f){if(this.Sa)throw a.g.ra("invalid call. Attribute Stream is read only.");this.f[e]&=~f};g.prototype.Qh=function(){return 1};return g}();a.Yu=c})(E||(E={}));!0===E.ah.Sk&&(E.Wk=E.Yu);(function(a){var b=function(){function b(){}b.to=function(g,e){return a.Wk.Yc(g,e)};b.kl=function(g,e){return a.qd.Yc(g,e)};b.Sv=function(g,e,f){switch(g){case 1:g=a.qd.Yc(e,f);break;case 2:g=a.ga.Yc(e,f);break;case 4:g=a.Wk.Yc(e,f);break;default:throw a.g.wa();}return g};b.Tv=
function(g,e){return b.Sv(a.pa.Qh(g),e*a.pa.Wa(g),a.pa.ue(g))};b.Dg=function(g,e){return a.ga.Yc(g,e)};b.ay=function(a){var e,f=[];for(e=0;e<a;e++)f.push(null);return f};return b}();a.Ac=b})(E||(E={}));(function(a){var b=function(){function b(){}b.to=function(g,e){return a.Yu.Yc(g,e)};b.kl=function(g,e){return a.qd.Yc(g,e)};b.Sv=function(g,e,f){switch(g){case 1:g=a.qd.Yc(e,f);break;case 2:g=a.Xu.Yc(e,f);break;case 4:g=a.Yu.Yc(e,f);break;default:throw a.g.wa();}return g};b.Tv=function(g,e){return a.Ac.Sv(a.pa.Qh(g),
e*a.pa.Wa(g),a.pa.ue(g))};b.Dg=function(g,e){return a.Xu.Yc(g,e)};b.ay=function(a){var e,f=[];for(e=0;e<a;e++)f.push(null);return f};return b}();a.RG=b})(E||(E={}));!0===E.ah.Sk&&(E.Ac=E.RG);(function(a){a.ca=function(){return function(a){void 0===a&&(a=0);this.l=a}}()})(E||(E={}));(function(a){var b=function(){function a(){}a.nb=function(e,f){return 0<=f?a.H(e):-a.H(e)};a.H=function(e){return 0>e?-e:e};a.Ih=function(e){return 3.552713678800501E-15>e};a.Xz=function(e,f,n){return a.H(e-f)<=n*(1+(a.H(e)+
a.H(f))/2)};a.S=function(e,f){return a.Xz(e,f,3.552713678800501E-15)};a.wI=function(e){return 3.552713678800501E-15>=a.H(e)};a.Vc=function(e){return a.wI(e)};return a}();a.j=b;var c=function(){function g(){}g.Sn=function(e,f){e=b.H(e);f=b.H(f);var a=0;0!=e+f&&(e>f?(a=f/e,a=e*Math.sqrt(1+a*a)):(a=e/f,a=f*Math.sqrt(1+a*a)));return a};g.Ep=function(e,f,a,x,c){for(var n=[0,0,0],I=[0,0,0],z=0;2>=z;z++)f[z]-=e[z],a[z]-=f[z];a=n[1]*I[2]-n[2]*I[1];f=n[2]*I[0]-n[0]*I[2];n=n[0]*I[1]-n[1]*I[0];e=-1*(a*e[0]+
f*e[1]+n*e[2]);x[0]=a;x[1]=f;x[2]=n;x[3]=e;I=g.jm(x);x[0]/=I;x[1]/=I;x[2]/=I;x[3]/=I;0!=c&&(I=b.Vc(n)?b.Vc(e)?b.nb(1,f):-b.nb(1,e):b.nb(1,n),I*=b.nb(1,c),x[0]*=I,x[1]*=I,x[2]*=I,x[3]*=I)};g.Uu=function(e,f,a){a[0]=e[1]*f[2]-f[1]*e[2];a[1]=e[2]*f[0]-f[2]*e[0];a[2]=e[0]*f[1]-f[0]*e[1]};g.Qr=function(e,f){return e[0]*f[0]+e[1]*f[1]+e[2]*f[2]};g.jm=function(e){return g.Sn(g.Sn(e[0],e[1]),e[2])};g.wm=function(e,f,a,b,c,z){var n=g.n(1,e,f),x=Math.cos(f);b.l=(n+0)*x*Math.cos(a);c.l=(n+0)*x*Math.sin(a);z.l=
(n*(1-e)+0)*Math.sin(f)};g.JK=function(e,f,a,x,c,z,d){var n=g.Sn(f,a),I=1*Math.sqrt(1-e),L=I/1;if(b.S(n,0))z.l=0,c.l=b.nb(1.570796326794897,x),d.l=b.H(x)-I;else{z.l=Math.atan2(a,f);a=Math.atan2(1*x,I*n);z=Math.cos(a);var m=Math.sin(a);f=I*e/(1-e);e*=1;a=Math.atan2(x+f*m*m*m,n-e*z*z*z);3.141592653589793<b.H(a)&&(a=b.nb(3.141592653589793,a)-a);a=Math.atan(L*Math.tan(a));m=Math.sin(a);z=Math.cos(a);c.l=Math.atan2(x+f*m*m*m,n-e*z*z*z);1.570796326794897<b.H(c.l)&&(c.l=b.nb(3.141592653589793,c.l)-c.l);
a=Math.atan(L*Math.tan(c.l));m=Math.sin(a);z=Math.cos(a);d.l=(x-I*m)*Math.sin(c.l)+(n-1*z)*Math.cos(c.l)}};g.n=function(e,f,a){a=Math.sin(a);return e/Math.sqrt(1-f*a*a)};g.sr=function(e,f){return Math.atan2(Math.sin(f)*(1-e),Math.cos(f))};g.Si=function(e,f){return Math.atan2(Math.sin(f),Math.cos(f)*(1-e))};g.xn=function(e,f){if(b.Ih(e)||0==f||b.S(b.H(f),1.570796326794897))return f;var a,x,c,z,d,m,k,h,q;if(.006884661117170036>e){z=Math.sqrt(1-e);d=(1-z)/(1+z);m=d*d;k=d*m;h=d*k;a=d*h;q=d*a;x=d*q;c=
1.572916666666667*k-3.2578125*a+4.295068359375*x;z=2.142578125*h-6.071484375*q;e=3.129296875*a-11.249837239583334*x;var l=4.775276692708333*q,v=7.958636765252976*x,y=Math.cos(2*f);return f+Math.sin(2*f)*(1.5*d-.84375*k+.525390625*a-.2688395182291667*x-c+e-v+y*(2*(1.3125*m-1.71875*h+1.650146484375*q)-4*z+6*l+y*(4*c-12*e+24*v+y*(8*z-32*l+y*(16*e-80*v+y*(32*l+64*y*v))))))}z=1-e;d=e/2;m=b.H(f);k=m*g.Yr(e)/(1.570796326794897*z);h=9999;q=m;for(m=0;1E-16<h&&50>m;m++)x=g.Tk(e,q),a=(g.Lz(q,e)-d*Math.sin(2*
q)/x)/z-k,x=1/(x*x*x),c=a/x,a=q-c,h=b.H(c),q=a;return 0<=f?q:-q};g.nR=function(e,f){return b.Ih(f)?e:e*g.Yr(f)/1.570796326794897};g.W=function(e){e=g.Hz(e,6.283185307179586);return 0>e?e+6.283185307179586:3.141592653589793>b.H(e)||b.S(b.H(e),3.141592653589793)?e:e-6.283185307179586};g.Hz=function(e,f){return e-Math.floor(e/f)*f};g.gg=function(e,f){if(.006884661117170036>f){f=Math.sqrt(1-f);f=(1-f)/(1+f);var a=f*f,b=a*a;return e/(1+f)*(1+.25*a+.015625*b+.00390625*a*b)*1.570796326794897}return e*g.Yr(f)};
g.Dp=function(e,f){var a=b.nb(1,Math.sin(f));f=b.H(g.Hz(f,3.141592653589793));f=1.570796326794897>=f?f:3.141592653589793-f;var x;b.S(f,1.570796326794897)?x=f:x=Math.atan(Math.sqrt(1-e)*Math.tan(f));return x*a};g.q=function(e,f,a){if(.006884661117170036>f){f=Math.sqrt(1-f);f=(1-f)/(1+f);var n=f*f,b=f*n,c=f*b,z=f*c,d=f*z,m=f*d,k=-.7291666666666666*b+.2278645833333333*z+.03987630208333334*m,h=.615234375*c-.21533203125*d,q=-.54140625*z+.20302734375*m,l=.48876953125*d,v=-.4488699776785715*m,y=Math.cos(2*
a);return e/(1+f)*((1+.25*n+.015625*c+.00390625*d)*a+Math.sin(2*a)*(-1.5*f+.1875*b+.0234375*z+.00732421875*m-k+q-v+y*(2*(.9375*n-.234375*c-.03662109375*d)-4*h+6*l+y*(4*k-12*q+24*v+y*(8*h-32*l+y*(16*q-80*v+y*(32*l+64*y*v)))))))}return e*(g.Lz(a,f)-.5*f*Math.sin(2*a)/g.Tk(f,a))};g.Tk=function(e,f){f=Math.sin(f);return Math.sqrt(1-e*f*f)};g.Yr=function(e){return b.Xz(e,1,2.220446049250313E-16)?1:1>e?g.js(0,1-e)-e/3*g.hs(0,1-e):NaN};g.Lz=function(e,f){var n=b.nb(1,e);e=b.H(e);var x=Math.floor(e/1.570796326794897),
c;if(1<f)c=0==e?0:NaN;else if(b.Vc(x))c=g.sin(e),c=c*g.js(1-c*c,1-f*c*c)-f/3*c*c*c*g.hs(1-c*c,1-f*c*c);else{c=a.I.truncate(x%2);var z=g.Yr(f);0<c?(c=Math.sin(1.570796326794897*(x+1)-e),c=c*g.js(1-c*c,1-f*c*c)-f/3*c*c*c*g.hs(1-c*c,1-f*c*c),c=z*(x+1)-c):(c=Math.sin(e-1.570796326794897*x),c=c*g.js(1-c*c,1-f*c*c)-f/3*c*c*c*g.hs(1-c*c,1-f*c*c),c=z*x+c)}return c*n};g.sin=function(e){e=g.W(e);var f=b.nb(1,e);e=b.H(e);return b.S(e,3.141592653589793)?0:b.S(e,1.570796326794897)?1*f:Math.sin(e)*f};g.hs=function(e,
f){for(var a=1,g=0,c=1,z,d,m,k;;){z=.2*(e+f+3*a);d=(z-e)/z;m=(z-f)/z;k=(z-a)/z;if(1E-4>b.H(d)&&1E-4>b.H(m)&&1E-4>b.H(k))break;k=Math.sqrt(f);z=Math.sqrt(a);k=Math.sqrt(e)*(k+z)+k*z;g+=c/(z*(a+k));c*=.25;e=.25*(e+k);f=.25*(f+k);a=.25*(a+k)}e=d*m;a=k*k;f=e-a;a=e-6*a;d=a+f+f;return 3*g+c*(1+a*(-.2142857142857143+.10227272727272728*a-.1730769230769231*k*d)+k*(.1666666666666667*d+k*(-.4090909090909091*f+.1153846153846154*k*e)))/(z*Math.sqrt(z))};g.js=function(e,f){for(var a,g,c,z,d=1;;d=.25*(d+a)){a=(e+
f+d)/3;g=2-(a+e)/a;c=2-(a+f)/a;z=2-(a+d)/a;if(1E-4>b.H(g)&&1E-4>b.H(c)&&1E-4>b.H(z))break;a=Math.sqrt(f);g=Math.sqrt(d);a=Math.sqrt(e)*(a+g)+a*g;e=.25*(e+a);f=.25*(f+a)}e=g*c-z*z;f=g*c*z;return(1+(.04166666666666666*e-.1-.06818181818181818*f)*e+.07142857142857142*f)/Math.sqrt(a)};g.qu=function(e,f){if(b.Ih(e)||0==f||b.S(b.H(f),1.570796326794897))return f;var a,g,c;if(.006884661117170036>e){a=e*e;g=e*a;c=e*g;var z=e*c,d=e*z,m=e*d,k=-(.02708333333333333*g+.03430059523809524*c+.03149181547619048*z+.02634359154541446*
d+.02156896735835538*m),h=.007669890873015873*c+.01299603174603175*z+.0148051353064374*d+.01454454953803912*m,q=-(.002275545634920635*z+.004830845032667949*d+.006558395368616723*m),l=6.957236677288761E-4*d+.001775193002406544*m,v=-(2.17324089394402E-4*m),y=Math.cos(2*f);return f+Math.sin(2*f)*(-(.5*e+.2083333333333333*a+.09375*g+.04878472222222222*c+.02916666666666667*z+.01938905423280423*d+.01388255931712963*m)-k+q-v+y*(2*(.1041666666666667*a+.0875*g+.06050347222222222*c+.04151785714285714*z+.02958958540013228*
d+.02203667534722222*m)-4*h+6*l+y*(4*k-12*q+24*v+y*(8*h-32*l+y*(16*q-80*v+y*(32*l+64*y*v))))))}0==f||b.S(b.H(f),1.570796326794897)?a=f:(g=Math.sqrt(e),c=g*Math.sin(f),a=Math.tan(.7853981633974483+f/2)*Math.pow((1-c)/(1+c),g/2),a=2*Math.atan(a)-1.570796326794897);return a};g.$K=function(e,f){if(b.Ih(e)||0==f||b.S(b.H(f),1.570796326794897))return f;var a,g;if(.006884661117170036>e){y=e*e;q=e*y;l=e*q;a=e*l;v=e*a;g=e*v;var c=.05833333333333333*q+.07232142857142858*l+.05634300595238095*a+.0355325796406526*
v+.020235546186067*g,z=.02653149801587302*l+.04379960317460317*a+.0429211791776896*v+.03255384637546096*g,d=.01294022817460318*a+.02668104344536636*v+.03155651254609588*g,m=.00659454790965208*v+.0163075268674227*g,k=.003463473736911237*g,h=Math.cos(2*f);return f+Math.sin(2*f)*(.5*e+.2083333333333333*y+.08333333333333333*q+.03611111111111111*l+.01875*a+.01195601851851852*v+.008863673941798942*g-c+d-k+h*(2*(.1458333333333333*y+.1208333333333333*q+.07039930555555556*l+.03616071428571429*a+.01839451058201058*
v+.01017113095238095*g)-4*z+6*m+h*(4*c-12*d+24*k+h*(8*z-32*m+h*(16*d-80*k+h*(32*m+64*h*k))))))}for(var q=Math.sqrt(e),l=q/2,v=Math.tan(.7853981633974483+f/2),c=0,z=1,y=f;0!=z;y=g)if(a=q*Math.sin(y),g=v*Math.pow((1+a)/(1-a),l),g=2*Math.atan(g)-1.570796326794897,c++,b.S(g,y)||3E4<c)z=0;return y};return g}();a.u=c})(E||(E={}));(function(a){var b=function(){function b(){}b.Fb=function(g,e,f,n,b,c,z,d){if(null!=c||null!=z||null!=d){n=a.u.W(n);e=a.u.W(e);f=a.u.W(f);b=a.u.W(b);1.570796326794897<a.j.H(f)&&
(f=a.j.nb(3.141592653589793,f)-f,e=a.u.W(e+3.141592653589793));1.570796326794897<a.j.H(b)&&(b=a.j.nb(3.141592653589793,b)-b,n=a.u.W(n+3.141592653589793));var x=a.u.W(n-e);if(a.j.S(f,b)&&(a.j.S(e,n)||a.j.S(a.j.H(f),1.570796326794897)))null!=c&&(c.l=0),null!=z&&(z.l=0),null!=d&&(d.l=0);else{if(a.j.S(f,-b)){if(a.j.S(a.j.H(f),1.570796326794897)){null!=c&&(c.l=3.141592653589793*g);null!=z&&(z.l=0<f?a.u.W(3.141592653589793-a.u.W(n)):a.u.W(n));null!=d&&(d.l=0<f?a.u.W(n):a.u.W(3.141592653589793-a.u.W(n)));
return}if(a.j.S(a.j.H(x),3.141592653589793)){null!=c&&(c.l=3.141592653589793*g);null!=z&&(z.l=0);null!=d&&(d.l=0);return}}var I=1.570796326794897==a.j.H(f)?0:Math.cos(f),m=Math.sin(f),L=1.570796326794897==a.j.H(b)?0:Math.cos(b),k=Math.sin(b),h=1.570796326794897==a.j.H(x)?0:Math.cos(x),P=3.141592653589793==a.j.H(x)?0:Math.sin(x);if(null!=c){var q=Math.sin((b-f)/2),x=Math.sin(x/2);c.l=2*Math.asin(Math.sqrt(q*q+I*L*x*x))*g}null!=z&&(a.j.S(a.j.H(f),1.570796326794897)?z.l=0>f?n:a.u.W(3.141592653589793-
n):z.l=Math.atan2(L*P,I*k-m*L*h));null!=d&&(a.j.S(a.j.H(b),1.570796326794897)?d.l=0>b?e:a.u.W(3.141592653589793-e):(d.l=Math.atan2(I*P,k*I*h-L*m),d.l=a.u.W(d.l+3.141592653589793)))}}};b.gf=function(g,e,f,n,b,c,z){if(null!=c||null!=z){e=a.u.W(e);f=a.u.W(f);1.570796326794897<a.j.H(f)&&(f=a.j.nb(3.141592653589793,f)-f,e=a.u.W(e+3.141592653589793));a.j.S(a.j.H(f),1.570796326794897)&&(e=0);b=a.u.W(b);var x=a.j.S(a.j.H(b),1.570796326794897)?0:Math.cos(b),I=a.j.S(a.j.H(b),3.141592653589793)?0:Math.sin(b),
d=a.j.S(a.j.H(f),1.570796326794897)?0:Math.cos(f),m=Math.sin(f);g=n/g;n=a.j.S(a.j.H(g),1.570796326794897)?0:Math.cos(g);var L=a.j.S(a.j.H(g),3.141592653589793)?0:Math.sin(g),k=Math.asin(m*n+d*L*x);null!=z&&(z.l=k);null!=c&&(c.l=a.j.S(a.j.H(k),1.570796326794897)?a.j.S(f,-k)?0>k?b:a.u.W(3.141592653589793-b):e:a.j.S(a.j.H(f),1.570796326794897)&&a.j.S(g,3.141592653589793)?0>f?b:a.u.W(3.141592653589793-b):a.u.W(e+Math.atan2(L*I,d*n-m*L*x)))}};return b}();a.zg=b})(E||(E={}));(function(a){var b=function(){function b(){}
b.Fb=function(g,e,f,n,b,c,d,z,m){var x=new a.ca(0),I=new a.ca(0),L=[0,0,0],k=[0,0,0],h=[0,0,0],P=new a.ca(0),q=new a.ca(0),l=new a.ca(0),Y=new a.ca(0),v=new a.ca(0);if(null!=d||null!=z||null!=m)if(a.j.Ih(e))a.zg.Fb(g,f,n,b,c,d,z,m);else{b=a.u.W(b);f=a.u.W(f);var y=a.u.W(b-f);if(a.j.S(n,c)&&(a.j.S(f,b)||a.j.S(a.j.H(n),1.570796326794897)))null!=d&&(d.l=0),null!=z&&(z.l=0),null!=m&&(m.l=0);else{if(a.j.S(n,-c)){if(a.j.S(a.j.H(n),1.570796326794897)){null!=d&&(d.l=2*a.u.gg(g,e));null!=z&&(z.l=0<n?a.u.W(3.141592653589793-
a.u.W(b)):a.u.W(b));null!=m&&(m.l=0<n?a.u.W(b):a.u.W(3.141592653589793-a.u.W(b)));return}a.j.S(a.j.H(y),3.141592653589793)&&(null!=d&&(d.l=2*a.u.gg(g,e)),null!=z&&(z.l=0),null!=m&&(m.l=0))}else if(a.j.S(a.j.H(n),1.570796326794897)||a.j.S(a.j.H(c),1.570796326794897))a.j.S(a.j.H(n),1.570796326794897)?f=b:b=f;var t=0,r;0>y&&(t=1,r=f,f=b,b=r,r=n,n=c,c=r);var y=a.u.sr(e,n),B=a.u.sr(e,c);if(null!=z||null!=m)a.zg.Fb(g,f,y,b,B,null,x,I),x=Math.atan2(Math.sin(x.l)*Math.cos(n-y),Math.cos(x.l)),I=Math.atan2(Math.sin(I.l)*
Math.cos(c-B),Math.cos(I.l)),0!=t&&(r=x,x=I,I=r),null!=z&&(z.l=x),null!=m&&(m.l=I);null!=d&&(a.u.wm(e,n,f,l,Y,v),L[0]=l.l,L[1]=Y.l,L[2]=v.l,a.u.wm(e,c,b,l,Y,v),k[0]=l.l,k[1]=Y.l,k[2]=v.l,h[0]=L[1]*k[2]-k[1]*L[2],h[1]=-(L[0]*k[2]-k[0]*L[2]),h[2]=L[0]*k[1]-k[0]*L[1],e=1-a.u.Tk(e,a.u.Dp(e,a.u.Si(e,Math.acos(h[2]/Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]))))),e*=2-e,z=Math.atan2(-h[1],-h[0]),h=a.u.W(z-1.570796326794897),z=a.u.W(z+1.570796326794897),h=a.j.H(a.u.W(f-h))<=a.j.H(a.u.W(f-z))?h:z,a.zg.Fb(1,h,
0,f,y,P,null,null),a.zg.Fb(1,h,0,b,B,q,null,null),3.141592653589793<P.l+q.l&&(h=a.u.W(h+3.141592653589793),a.zg.Fb(1,h,0,f,y,P,null,null),a.zg.Fb(1,h,0,b,B,q,null,null)),P.l*=a.j.nb(1,n),q.l*=a.j.nb(1,c),P.l=a.u.Si(e,P.l),q.l=a.u.Si(e,q.l),f=a.u.q(g,e,P.l),g=a.u.q(g,e,q.l),d.l=a.j.H(g-f))}}};b.gf=function(g,e,f,n,b,c,d,z){var x=0,I=new a.ca(0),m=new a.ca(0),L=[0,0,0],k=[0,0,0],h=new a.ca(0),P=new a.ca(0),q=new a.ca(0);if(null!=d||null!=z)if(a.j.Ih(e))a.zg.gf(g,f,n,b,c,d,z);else if(a.j.Vc(b))null!=
d&&(d.l=f),null!=z&&(z.l=n);else{c=a.u.W(c);0>b&&(b=a.j.H(b),c=a.u.W(c+3.141592653589793));f=a.u.W(f);n=a.u.W(n);1.570796326794897<a.j.H(n)&&(f=a.u.W(f+3.141592653589793),n=a.j.nb(3.141592653589793,n)-n);a.j.S(a.j.H(n),1.570796326794897)&&(f=0);var l;if(a.j.Vc(n))l=a.j.H(1.570796326794897-a.j.H(c)),l=a.u.Si(e,l),l=1-a.u.Tk(e,a.u.Dp(e,l)),l*=2-l,g=b/a.u.gg(g,l)*1.570796326794897,g=a.u.xn(l,g),g=a.u.sr(l,g),a.zg.gf(1,f,n,g,c,d,I),null!=z&&(x=I.l),null!=z&&(z.l=a.u.Si(e,x));else if(a.j.S(a.j.H(n),1.570796326794897))x=
a.u.gg(g,e),I=2*x,g=a.j.nb(1.570796326794897,n),c=0<g?a.u.W(3.141592653589793-c):c,n=x-b,a.j.H(n)<=x?null!=d&&(d.l=c):(n=Math.floor(b/I),0==a.I.truncate(n%2)?(null!=d&&(d.l=c),n=x-(b-n*I)):(null!=d&&(d.l=a.u.W(c+3.141592653589793)),n=x-((n+1)*I-b))),null!=z&&(z.l=a.u.xn(e,n/x*g));else{l=a.u.sr(e,n);c=Math.atan2(Math.sin(c),Math.cos(c)*Math.cos(n-l));var v=a.I.truncate(a.j.nb(1,l))*(1.570796326794897>=a.j.H(c)?1:-1);c=a.u.W(f+Math.atan(Math.tan(c)*-Math.sin(l)));a.zg.Fb(g,c,0,f,l,null,m,null);l=a.j.H(1.570796326794897-
a.j.H(m.l));l=a.u.Si(e,l);l=1-a.u.Tk(e,a.u.Dp(e,l));l*=2-l;a.u.wm(e,0,c,h,P,q);L[0]=h.l;L[1]=P.l;L[2]=q.l;a.u.wm(e,n,f,h,P,q);k[0]=h.l;k[1]=P.l;k[2]=q.l;n=Math.acos((L[0]*k[0]+L[1]*k[1]+L[2]*k[2])/Math.sqrt(k[0]*k[0]+k[1]*k[1]+k[2]*k[2]));n=a.u.Si(l,n);n=a.u.q(g,l,n)+b*v;b=0<n?m.l:a.u.W(m.l+3.141592653589793);g=a.j.H(n)/a.u.gg(g,l)*1.570796326794897;g=a.u.xn(l,g);g=a.u.sr(l,g);a.zg.gf(1,c,0,g,b,d,I);null!=z&&(x=I.l);null!=z&&(z.l=a.u.Si(e,x))}}};return b}();a.Xj=b})(E||(E={}));(function(a){var b=
function(){function b(){}b.Fb=function(g,e,f,n,b,c,d,z,m){var x=0,I=0,L=0;if(null!=d||null!=z||null!=m)if(a.j.Ih(e))a.zg.Fb(g,f,n,b,c,d,z,m);else{var k=a.u.W(b-f);if(a.j.S(n,c)&&(a.j.Vc(k)||a.j.S(a.j.H(n),1.570796326794897)))null!=d&&(d.l=0),null!=z&&(z.l=0),null!=m&&(m.l=0);else{if(a.j.S(n,-c)){if(a.j.S(a.j.H(n),1.570796326794897)){null!=d&&(d.l=2*a.u.gg(g,e));null!=z&&(z.l=0<n?a.u.W(3.141592653589793-a.u.W(b)):a.u.W(b));null!=m&&(m.l=0<n?a.u.W(b):a.u.W(3.141592653589793-a.u.W(b)));return}a.j.S(a.j.H(k),
3.141592653589793)&&(null!=d&&(d.l=2*a.u.gg(g,e)),null!=z&&(z.l=0),null!=m&&(m.l=0))}else{if(a.j.S(a.j.H(n),1.570796326794897)||a.j.S(a.j.H(c),1.570796326794897)){a.Xj.Fb(g,e,f,n,b,c,d,z,m);return}if(a.j.Vc(k)||a.j.S(a.j.H(k),3.141592653589793)){a.Xj.Fb(g,e,f,n,b,c,d,z,m);return}}var h=1-Math.sqrt(1-e),P=e/(1-e),q=g*(1-h);g=a.u.Dp(e,n);var l=a.u.Dp(e,c);e=1.570796326794897==a.j.H(g)?0:Math.cos(g);var Y=Math.sin(g),v=1.570796326794897==a.j.H(l)?0:Math.cos(l),y=Math.sin(l),t=k,r=Math.cos(t),B=Math.sin(t),
E=1,u=0,C,O,D,G,J;do{C=t;O=Math.sqrt(Math.pow(v*B,2)+Math.pow(e*y-Y*v*r,2));D=Y*y+e*v*r;G=Math.atan2(O,D);if(0==O){E=0;break}J=e*v*B/O;x=Math.cos(Math.asin(J));x*=x;I=D-2*Y*y/x;1<a.j.H(I)&&(I=a.j.nb(1,I));L=I*I;t=h/16*x*(4+h*(4-3*x));t=k+(1-t)*h*J*(G+t*O*(I+t*D*(2*L-1)));r=Math.cos(t);B=Math.sin(t);u++;if(3.141592653589793<a.j.H(t)&&30<u){E=0;break}}while(5E3>=u&&!a.j.S(C,t));if(0!=E)P*=x,h=P*(256+P*(-128+P*(74-47*P)))/1024,null!=d&&(d.l=q*(1+P*(4096+P*(-768+P*(320-175*P)))/16384)*(G-h*O*(I+h/4*(D*
(2*L-1)-h/6*I*(4*O*O-3)*(4*L-3))))),null!=z&&(a.j.S(a.j.H(n),1.570796326794897)?z.l=0>n?b:a.u.W(3.141592653589793-b):z.l=Math.atan2(v*B,e*y-Y*v*r)),null!=m&&(a.j.S(a.j.H(c),1.570796326794897)?m.l=0>c?f:a.u.W(3.141592653589793-f):(m.l=Math.atan2(e*B,e*y*r-Y*v),m.l=a.u.W(m.l+3.141592653589793)));else{t=a.j.nb(3.141592653589793,k);D=Y*y-e*v;G=Math.acos(D);O=Math.sin(G);x=1;u=J=0;do L=J,x*=x,r=x*x,J=h*x*(1+h+h*h),I=h*h*r*(1+2.25*h),E=h*h*h*r*x,r=1-.25*J+.1875*I-.1953125*E,J=.25*J-.25*I+.29296875*E,B=
.03125*I-.05859375*E,E*=.00651041666666667,I=D-2*Y*y/x,1<a.j.H(I)&&(I=a.j.nb(1,I)),x=Math.acos(I),D=Math.cos(2*x),C=Math.cos(3*x),J=a.j.S(n,-c)?a.u.W(3.141592653589793-k)/(3.141592653589793*h*r):a.u.W(t-k)/(h*(r*G+J*O*I+B*Math.sin(2*G)*D+E*Math.sin(3*G)*C)),B=J*O/(e*v),t=1.570796326794897<a.j.H(k)?a.j.nb(3.141592653589793,B)-Math.asin(B):Math.asin(B),r=Math.cos(t),O=Math.sqrt(Math.pow(v*B,2)+Math.pow(e*y-Y*v*r,2)),G=3.141592653589793-Math.asin(a.j.H(O)),D=Math.cos(G),x=Math.cos(Math.asin(J)),u++;
while(70>=u&&!a.j.S(L,J));null!=d&&(x*=x,P*=x,r=1+P*(4096+P*(-768+P*(320-175*P)))/16384,a.j.S(n,-c)?d.l=3.141592653589793*q*r:(I=D-2*Y*y/x,x=Math.acos(I),D=Math.cos(2*x),C=Math.cos(3*x),d.l=q*(r*G+P*(-512+P*(128+P*(-60+35*P)))/2048*O*I+P*(-4+5*P)/6144*P*P*Math.sin(2*G)*D+E*Math.sin(3*G)*C+-7.62939453125E-5*P*P*P*P*Math.sin(4*G)*Math.cos(4*x))));null!=z&&(a.j.Vc(n)&&a.j.Vc(c)?(x=Math.sqrt(1-J*J),z.l=Math.acos(x),0>k&&(z.l*=-1)):a.j.S(a.j.H(n),1.570796326794897)?z.l=0>n?b:a.u.W(3.141592653589793-b):
(d=J/e,q=Math.sqrt(1-d*d),0>e*y-Y*v*Math.cos(t)&&(q*=-1),z.l=Math.atan2(d,q),a.j.S(n,-c)&&a.j.H(a.u.W(f-b))>3.141592653589793*(1-h*Math.cos(n))&&(0<n&&1.570796326794897>a.j.H(z.l)||0>n&&1.570796326794897<a.j.H(z.l))&&(z.l=a.j.nb(3.141592653589793,z.l)-z.l)));if(null!=m)if(a.j.Vc(n)&&a.j.Vc(c))x=Math.sqrt(1-J*J),m.l=Math.acos(x),0<=k&&(m.l*=-1);else if(a.j.S(a.j.H(c),1.570796326794897))m.l=0>c?f:a.u.W(3.141592653589793-f);else if(k=J/v,d=Math.sqrt(1-k*k),q=Math.sin(t/2),0>Math.sin(l-g)-2*e*y*q*q&&
(d*=-1),m.l=Math.atan2(k,d),m.l=a.u.W(m.l+3.141592653589793),a.j.S(n,-c)&&!a.j.Vc(n)&&!a.j.S(a.j.H(n),1.570796326794897)&&a.j.H(a.u.W(f-b))>3.141592653589793*(1-h*Math.cos(n))&&(null!=z?q=z.l:(d=J/e,q=Math.sqrt(1-d*d),0>e*y-Y*v*Math.cos(t)&&(q*=-1),q=Math.atan2(d,q),a.j.S(n,-c)&&a.j.H(a.u.W(f-b))>3.141592653589793*(1-h*Math.cos(n))&&(0<n&&1.570796326794897>a.j.H(q)||0>n&&1.570796326794897<a.j.H(q))&&(q=a.j.nb(3.141592653589793,q)-q)),1.570796326794897>=a.j.H(q)&&1.570796326794897<a.j.H(m.l)||1.570796326794897<=
a.j.H(q)&&1.570796326794897>a.j.H(m.l)))m.l=-1*a.u.W(m.l+3.141592653589793)}}}};b.gf=function(g,e,f,n,b,c,d,z){if(null!=d||null!=z)if(a.j.Ih(e))a.zg.gf(g,f,n,b,c,d,z);else if(c=a.u.W(c),a.j.S(a.j.H(n),1.570796326794897)||a.j.Vc(c)||a.j.S(a.j.H(c),3.141592653589793))a.Xj.gf(g,e,f,n,b,c,d,z);else{var x=1.570796326794897==a.j.H(c)?0:Math.cos(c),I=3.141592653589793==a.j.H(c)?0:Math.sin(c);a.j.S(a.j.H(n),1.570796326794897)&&(f=0);c=1-Math.sqrt(1-e);var m=a.u.Dp(e,n);n=1.570796326794897==a.j.H(m)?0:Math.cos(m);
var L=Math.sin(m),m=Math.atan2(Math.tan(m),x),k=n*I,h=k*k,P=1-h,q=e/(1-e)*P;e=q*(256+q*(-128+q*(74-47*q)))/1024;var l=e/4,v=e/6,y=b/(g*(1-c)*(1+q*(4096+q*(-768+q*(320-175*q)))/16384)),t=y,r;do{r=t;b=1.570796326794897==a.j.H(t)?0:Math.cos(t);var q=3.141592653589793==a.j.H(t)?0:Math.sin(t),B=q*q;g=Math.cos(2*m+t);t=g*g;t=e*q*(g+l*(b*(2*t-1)-v*g*(4*B-3)*(4*t-3)))+y}while(!a.j.S(r,t));b=1.570796326794897==a.j.H(t)?0:Math.cos(t);q=3.141592653589793==a.j.H(t)?0:Math.sin(t);null!=d&&(I=Math.atan2(q*I,n*
b-L*q*x),P=c/16*P*(4+c*(4-3*P)),g=Math.cos(2*m+t),d.l=a.u.W(f+(I-(1-P)*c*k*(t+P*q*(g+P*b*(2*g*g-1))))));null!=z&&(P=L*q-n*b*x,P=(1-c)*Math.sqrt(h+P*P),z.l=Math.atan2(L*b+n*q*x,P))}};return b}();a.cs=b})(E||(E={}));(function(a){var b=function(){function b(){}b.Fb=function(g,e,f,n,b,c,d,z,m){var x=a.u.W(b-f),I=a.j.S(a.j.H(n),1.570796326794897),L=a.j.S(a.j.H(c),1.570796326794897);if(a.j.S(n,c)&&(a.j.Vc(x)||I))null!=d&&(d.l=0),null!=z&&(z.l=0),null!=m&&(m.l=0);else{var k,h;a.j.Ih(e)?(k=Math.sin(n),h=
Math.sin(c),k=Math.sqrt((1+k)/(1-k)),h=Math.sqrt((1+h)/(1-h)),k=Math.log(h)-Math.log(k),k=Math.atan2(x,k),null!=d&&(d.l=a.j.S(n,c)?a.j.H(g*Math.cos(n)*x):a.j.H((g*c-g*n)/Math.cos(k)))):(h=a.u.qu(e,c),k=Math.sin(a.u.qu(e,n)),h=Math.sin(h),k=Math.sqrt((1+k)/(1-k)),h=Math.sqrt((1+h)/(1-h)),k=Math.log(h)-Math.log(k),k=Math.atan2(x,k),null!=d&&(a.j.S(n,c)?d.l=a.j.H(g*x*Math.cos(n)/a.u.Tk(e,n)):(x=a.u.q(g,e,n),g=a.u.q(g,e,c),d.l=a.j.H((g-x)/Math.cos(k)))));if(null!=z||null!=m)d=a.u.W(k+3.141592653589793),
I&&L||!I&&!L||(I?k=0>n?b:a.u.W(3.141592653589793-b):L&&(d=0>c?f:a.u.W(3.141592653589793-f))),null!=z&&(z.l=k),null!=m&&(m.l=d)}};b.gf=function(g,e,f,n,b,c,d,z){c=a.u.W(c);0>b&&(b=a.j.H(b),c=a.u.W(c+3.141592653589793));a.j.Ih(e)?a.j.S(a.j.H(n),1.570796326794897)?(f=0>n?c:a.u.W(3.141592653589793-c),c=b/g%6.283185307179586,3.141592653589793>=c?g=n-a.j.nb(c,n):(f=a.u.W(f+3.141592653589793),g=-n+a.j.nb(c-3.141592653589793,n))):a.j.S(a.j.H(c),1.570796326794897)?(f=a.u.W(f+a.j.nb(b,c)/(g*Math.cos(n))),g=
n):(g=n+b*Math.cos(c)/g,1.570796326794897<a.j.H(g)&&(g=1.570796326794897),a.j.S(a.j.H(g),1.570796326794897)&&(a.j.Vc(c)||a.j.S(a.j.H(c),3.141592653589793))||(1.570796316258184<a.j.H(g)&&(g=a.j.nb(1.570796316258184,g)),e=Math.sin(n),n=Math.sin(g),e=Math.sqrt((1+e)/(1-e)),n=Math.sqrt((1+n)/(1-n)),e=Math.log(n)-Math.log(e),f=a.u.W(f+Math.tan(c)*e))):a.j.S(a.j.H(n),1.570796326794897)?(f=0>n?c:a.u.W(3.141592653589793-c),c=b/a.u.nR(g,e),c%=6.283185307179586,3.141592653589793>=c?(g=n-a.j.nb(c,n),g=a.u.xn(e,
g)):(f=a.u.W(f+3.141592653589793),g=-n+a.j.nb(c-3.141592653589793,n),g=a.u.xn(e,g))):a.j.S(a.j.H(c),1.570796326794897)?(f=a.u.W(f+a.j.nb(b,c)*a.u.Tk(e,n)/(g*Math.cos(n))),g=n):(g=1.570796326794897*(b*Math.cos(c)+a.u.q(g,e,n))/a.u.gg(g,e),1.570796326794897<a.j.H(g)&&(g=a.j.nb(1.570796326794897,g)),g=a.u.xn(e,g),a.j.S(a.j.H(g),1.570796326794897)&&(a.j.Vc(c)||a.j.S(a.j.H(c),3.141592653589793))||(b=a.u.qu(e,n),n=a.u.qu(e,g),1.570796316258184<a.j.H(n)&&(n=a.j.nb(1.570796316258184,g),g=a.u.$K(e,n)),e=Math.sin(b),
n=Math.sin(n),e=Math.sqrt((1+e)/(1-e)),n=Math.sqrt((1+n)/(1-n)),e=Math.log(n)-Math.log(e),f=a.u.W(f+Math.tan(c)*e)));null!=d&&(d.l=f);null!=z&&(z.l=g)};return b}();a.Zz=b})(E||(E={}));(function(a){var b=function(){function b(){}b.gw=function(g,e,f,n,b,c,d){a.cs.Fb(g,e,f,n,b,c,null,d,null)};b.Ph=function(g,e,f,n,b,c,d,z){a.cs.gf(g,e,f,n,b,c,d,z)};b.Rd=function(g,e,f,n,b,c,d,z,m,k){switch(k){case 2:a.Xj.Fb(g,e,f,n,b,c,d,z,m);break;case 3:a.$z.Fb(g,e,f,n,b,c,d,z,m);break;case 1:a.Zz.Fb(g,e,f,n,b,c,d,
z,m);break;default:a.cs.Fb(g,e,f,n,b,c,d,z,m)}};b.dk=function(g,e,f,n,b,c,d,z,m){switch(m){case 2:a.Xj.gf(g,e,f,n,b,c,d,z);break;case 3:a.$z.gf(g,e,f,n,b,c,d,z);break;case 1:a.Zz.gf(g,e,f,n,b,c,d,z);break;default:a.cs.gf(g,e,f,n,b,c,d,z)}};return b}();a.zb=b})(E||(E={}));(function(a){var b=function(){function b(){}b.QS=function(g,e){var f=8;0>f&&(f=8);var n=[0,0,0,0],x=new a.b;x.J(e);x.scale(9102==a.Ya.Em(g).Se().Qc()?1:a.Ya.Em(g).Se().Dj/3.141592653589793*180);-180>x.x?(x.x-=x.x%360,-180>x.x&&(x.x+=
360)):180<x.x&&(x.x-=x.x%360,180<x.x&&(x.x-=360));90<x.y&&(x.y=90);-90>x.y&&(x.y=-90);g=5*f;e=(g+31)/32;for(var c=-180,d=180,z=g-1,m=e-1;0<=m;m--)for(var k=z-32*m,h=Math.min(32,g-32*m),q=1;q<h;q+=2){var l=.5*(d+c);x.x>=l?(n[m]|=1<<k,c=l):d=l;k-=2;z-=2}c=-90;d=90;z=g-2;for(m=e-1;0<=m;m--)for(k=z-32*m,h=Math.min(32,g-32*m),q=0;q<h;q+=2)l=.5*(d+c),x.y>=l?(n[m]|=1<<k,c=l):d=l,k-=2,z-=2;return b.XS(n,f,f)};b.XS=function(a,e,f){for(var n=[],g=0;g<e;g++)n[g]="";for(var b=g=0,c=0;c<e;c++){var d=a[g]>>b&31,
b=b+5;if(31<b){var z=37-b,d=d&(1<<z)-1,b=b-32;g++;d|=(a[g]&(1<<b)-1)<<z}n[e-1-c]="0123456789bcdefghjkmnpqrstuvwxyz".split("")[d]}if(f>e)for(c=0;c<f-e;c++)n.push("0");else f<e&&(n.length=f);return n.join("")};return b}();a.qH=b})(E||(E={}));(function(a){var b={gcstol:[0,1E-8,1,1.11111E-8,2,1.68845E-8,3,2.17661E-8,4,2.22508E-8,5,2.34848E-8,6,2.37811E-8,7,2.88455E-8,8,3.1456E-8,9,3.29779E-8,10,3.66789E-8,11,4.23597E-8,12,4.79463E-8,13,6.45223E-8,14,7.26274E-8,15,7.49945E-8,16,7.52506E-8,17,7.97991E-8,
18,9.66202E-8,19,9.79918E-8,20,9.89735E-8,21,1.02314E-7,22,1.08146E-7,23,2.29734E-7,24,2.42985E-7,25,2.7546E-7,26,3.37034E-7,27,4.30795E-7,28,5.20871E-7,29,5.50921E-7,30,6.74068E-7,31,6.86177E-7,32,7.25263E-7,33,7.44101E-7,34,7.74267E-7,35,9.62954E-7,36,1.06103E-6,37,1.14363E-6,38,1.16219E-6,39,1.36419E-6,40,1.36744E-6,41,1.43239E-6,42,1.73624E-6,43,1.84825E-6,44,1.90986E-6,45,1.97572E-6,46,2.12207E-6,47,2.72837E-6,48,3.1831E-6,49,3.58099E-6,50,3.81972E-6,51,4.09256E-6,52,4.40737E-6,53,4.77465E-6,
54,5.16178E-6,55,5.20871E-6,56,5.72958E-6,57,6.03113E-6,58,6.98729E-6,59,9.24125E-6,60,1.14592E-5],pcstol:[0,6.66667E-9,1,2E-8,2,4.97098E-5,3,.001,4,.00109362,5,.00328087,6,.00497101],newtoold:[2154,102110,2195,102200,2204,32036,2205,26979,2225,102641,2226,102642,2227,102643,2228,102644,2229,102645,2230,102646,2231,102653,2232,102654,2233,102655,2234,102656,2235,102657,2236,102658,2237,102659,2238,102660,2239,102666,2240,102667,2241,102668,2242,102669,2243,102670,2246,102679,2247,102680,2248,102685,
2249,102686,2250,102687,2254,102694,2255,102695,2257,102712,2258,102713,2259,102714,2260,102715,2261,102716,2262,102717,2263,102718,2264,102719,2267,102724,2268,102725,2271,102728,2272,102729,2274,102736,2275,102737,2276,102738,2277,102739,2278,102740,2279,102741,2283,102746,2284,102747,2285,102748,2286,102749,2287,102752,2288,102753,2289,102754,2312,23433,2326,102140,2395,2091,2396,2092,2397,2166,2398,2167,2399,2168,2759,102229,2760,102230,2761,102248,2762,102249,2763,102250,2764,102251,2765,102252,
2766,102241,2767,102242,2768,102243,2769,102244,2770,102245,2771,102246,2772,102253,2773,102254,2774,102255,2775,102256,2776,102257,2777,102258,2778,102259,2779,102260,2780,102266,2781,102267,2782,102261,2783,102262,2784,102263,2785,102264,2786,102265,2787,102268,2788,102269,2789,102270,2790,102271,2791,102272,2792,102273,2793,102274,2794,102275,2795,102276,2796,102277,2797,102278,2798,102279,2799,102280,2800,102281,2801,102282,2802,102283,2803,102284,2804,102285,2805,102286,2806,102287,2807,102288,
2808,102289,2809,102290,2810,102291,2811,102292,2812,102293,2813,102294,2814,102295,2815,102296,2816,102297,2817,102298,2818,102300,2819,102304,2820,102307,2821,102308,2822,102309,2823,102310,2824,102311,2825,102312,2826,102313,2827,102314,2828,102315,2829,102316,2830,102317,2831,102318,2832,102320,2833,102321,2834,102322,2835,102323,2836,102324,2837,102325,2838,102326,2839,102327,2840,102330,2841,102334,2842,102335,2843,102336,2844,102337,2845,102338,2846,102339,2847,102340,2848,102341,2849,102342,
2850,102343,2851,102344,2852,102345,2853,102346,2854,102347,2855,102348,2856,102349,2857,102350,2858,102351,2859,102352,2860,102353,2861,102354,2862,102355,2863,102356,2864,102357,2865,102358,2866,102361,2942,102167,2943,102169,2944,2139,2945,2140,2946,2141,2947,2142,2948,2143,2949,2144,2950,2145,2951,2146,2952,2147,2953,2036,2954,2291,2955,2153,2956,2152,2957,2151,2958,2150,2959,2149,2960,2037,2961,2038,2962,2148,2965,2244,2966,2245,3003,102091,3004,102092,3005,102190,3060,2982,3067,102139,3072,
102606,3074,102608,3075,102208,3077,102210,3078,102123,3080,102119,3081,102603,3082,102602,3083,102601,3088,65163,3089,102763,3090,102363,3092,102151,3093,102152,3094,102153,3095,102154,3096,102155,3097,102145,3098,102146,3099,102147,3100,102148,3101,102149,3102,2155,3107,102172,3110,102170,3111,102171,3119,2214,3158,102234,3159,102235,3160,102236,3336,2979,3338,102006,3346,2600,3370,102126,3371,102127,3372,102130,3373,102131,3400,102184,3401,102185,3404,3359,3407,3366,3417,102675,3418,102676,3419,
102677,3420,102678,3421,102707,3422,102708,3423,102709,3424,102711,3433,102651,3434,102652,3435,102671,3436,102672,3437,102710,3438,102730,3448,102095,3451,102681,3452,102682,3455,102735,3461,2063,3462,2064,3463,3073,3464,3076,3560,102742,3566,102743,3567,102744,3734,102722,3735,102723,3736,102755,3737,102756,3738,102757,3739,102758,3741,102205,3742,102206,3743,102207,3748,102211,3750,102202,3751,102203,3759,102663,3760,102463,3764,102112,3770,102090,3771,102180,3772,102181,3773,102182,3775,102186,
3776,102187,3777,102188,3800,102183,3801,102189,3812,102199,3814,102609,3815,102469,3819,104990,3821,104136,3824,104137,3825,102444,3826,102443,3827,102442,3828,102441,3857,102100,3889,104991,3906,104992,4048,103201,4049,103202,4050,103203,4051,103204,4056,103205,4057,103206,4058,103207,4059,103208,4060,103209,4061,103210,4062,103211,4063,103212,4071,103213,4082,103214,4083,103215,4093,103216,4094,103217,4095,103218,4096,103219,4167,104108,4169,37252,4171,104107,4189,104110,4197,4234,4223,37223,4304,
104304,4414,102201,4415,102762,4417,102764,4434,102765,4437,102647,4455,32029,4456,32018,4457,3454,4462,102439,4463,4466,4470,4469,4484,103794,4485,103795,4486,103796,4487,103797,4488,103798,4489,103799,4611,104104,4612,104111,4613,37255,4615,37247,4616,37250,4617,4140,4618,4291,4620,37211,4626,37235,4647,102362,4658,37204,4668,37201,4669,4126,4672,37217,4673,104125,4675,37220,4684,37232,4698,4631,4707,37213,4708,37231,4709,37212,4710,37238,4711,37214,4712,37237,4713,37208,4714,37215,4715,37253,4716,
37216,4717,37239,4719,37219,4722,37242,4724,37233,4725,37222,4727,37224,4728,37246,4729,37226,4730,37227,4731,37228,4732,37229,4733,37230,4734,37251,4735,37259,4736,37254,4739,37205,4758,104133,4760,37001,4762,104114,4826,102214,5013,104142,5014,102331,5015,102332,5016,102333,5173,102085,5174,102086,5175,102087,5176,102088,5177,102089,5178,102040,5179,102080,5185,102081,5186,102082,5187,102083,5188,102084,5221,102066,5246,104100,5247,102490,5324,104144,5325,102420,5329,2934,5365,104143,5367,102305,
5451,104132,5513,102065,5514,102067,5519,102111,5520,31461,5646,102745,5839,5388,5858,5532,5879,4474,21896,21891,21897,21892,21898,21893,21899,21894,26701,102124,26702,102125,26799,26747,26847,102683,26848,102684,26849,102691,26850,102692,26851,102693,26852,102704,26853,102750,26854,102751,26857,102466,26858,102467,26859,102468,26901,102128,26902,102129,27493,27492,29101,29100,29168,29118,29169,29119,29170,29120,29171,29121,29172,29122,29187,29177,29188,29178,29189,29179,29190,29180,29191,29181,29192,
29182,29193,29183,29194,29184,29195,29185,29902,29900,31279,31278,31281,31291,31282,31292,31283,31293,31284,31294,31285,31295,31286,31296,31287,31297,31466,31462,31467,31463,31468,31464,31469,31465,31986,31917,31987,31918,31988,31919,31989,31920,31990,31921,31991,31922,32064,32074,32065,32075,32066,32076,32067,32077],pcsid:[2066,6,2136,5,2155,5,2157,3,2158,3,2159,5,2160,5,2219,3,2220,3,2244,5,2245,5,2256,5,2265,5,2266,5,2269,5,2270,5,2273,5,2290,3,2291,3,2294,3,2295,3,2313,3,2314,5,2964,5,2967,5,
2968,5,2991,3,2992,5,2993,3,2994,5,3073,3,3076,3,3079,3,3091,5,3106,3,3108,3,3109,3,3141,3,3142,3,3167,2,3337,3,3347,3,3348,3,3359,5,3360,3,3361,5,3362,3,3363,5,3364,3,3365,5,3366,5,3402,3,3403,3,3405,3,3406,3,3439,3,3440,3,3447,3,3449,3,3450,3,3453,5,3454,5,3460,3,3479,5,3480,3,3481,5,3482,3,3483,5,3484,3,3485,5,3486,3,3487,5,3488,3,3489,3,3490,5,3491,3,3492,5,3493,3,3494,5,3495,3,3496,5,3497,3,3498,5,3499,3,3500,5,3501,3,3502,5,3503,3,3504,5,3505,3,3506,5,3507,3,3508,5,3509,3,3510,5,3511,3,3512,
5,3513,3,3514,3,3515,5,3516,3,3517,5,3518,3,3519,5,3520,3,3521,5,3522,3,3523,5,3524,3,3525,5,3526,3,3527,5,3528,3,3529,5,3530,3,3531,5,3532,3,3533,5,3534,3,3535,5,3536,3,3537,5,3538,3,3539,5,3540,3,3541,5,3542,3,3543,5,3544,3,3545,5,3546,3,3547,5,3548,3,3549,5,3550,3,3551,5,3552,3,3553,5,3582,5,3583,3,3584,5,3585,3,3586,5,3587,3,3588,5,3589,3,3590,5,3591,3,3592,3,3593,5,3598,5,3599,3,3600,5,3605,5,3606,3,3607,3,3608,5,3609,3,3610,5,3611,3,3612,5,3613,3,3614,5,3615,3,3616,5,3617,3,3618,5,3619,3,3620,
5,3621,3,3622,5,3623,3,3624,5,3625,3,3626,5,3627,3,3628,5,3629,3,3630,5,3631,3,3632,5,3633,3,3634,5,3635,3,3636,5,3640,5,3641,3,3642,5,3643,3,3644,5,3645,3,3646,5,3647,3,3648,5,3649,3,3650,5,3651,3,3652,5,3653,3,3654,5,3655,3,3656,5,3657,3,3658,5,3659,3,3660,5,3661,3,3662,5,3663,3,3664,5,3668,5,3669,3,3670,5,3671,3,3672,5,3673,3,3674,5,3675,3,3676,5,3677,5,3678,3,3679,5,3680,5,3681,3,3682,5,3683,5,3684,3,3685,3,3686,5,3687,3,3688,5,3689,3,3690,5,3691,3,3692,5,3696,5,3697,3,3698,5,3699,3,3700,5,3740,
3,3749,3,3783,3,3784,3,3793,3,3794,3,3802,3,3816,3,3829,3,3854,3,3920,3,3978,3,3979,3,3991,5,3992,5,4026,3,4037,3,4038,3,4217,5,4438,5,4439,5,4467,3,4471,3,4474,3,4559,3,4839,3,5018,3,5048,3,5167,3,5168,3,5223,3,5234,3,5235,3,5243,3,5266,3,5316,3,5320,3,5321,3,5330,3,5331,3,5337,3,5361,3,5362,3,5382,3,5383,3,5396,3,5456,3,5457,3,5469,3,5472,4,5490,3,5518,3,5523,3,5559,3,5588,5,5589,5,5596,3,5627,3,5629,3,5641,3,5643,3,5644,3,5654,5,5655,5,5659,3,5700,3,5825,3,5836,3,5837,3,5842,3,5844,3,5880,3,5887,
3,5890,3,20499,3,20538,3,20539,3,20790,3,20791,3,21291,3,21292,3,21500,3,21817,3,21818,3,22032,3,22033,3,22091,3,22092,3,22332,3,22391,3,22392,3,22700,3,22770,3,22780,3,22832,3,23090,3,23095,3,23239,3,23240,3,23433,3,23700,3,24047,3,24048,3,24100,5,24200,3,24305,3,24306,3,24382,4,24383,3,24500,3,24547,3,24548,3,24571,2,24600,3,25E3,3,25231,3,25884,3,25932,3,26237,3,26331,3,26332,3,26591,3,26592,3,26632,3,26692,3,26855,5,26856,5,27120,3,27200,3,27291,4,27292,4,27429,3,27492,3,27500,3,27700,3,28232,
3,28600,3,28991,3,28992,3,29100,3,29220,3,29221,3,29333,3,29635,3,29636,3,29701,3,29738,3,29739,3,29849,3,29850,3,29871,2,29872,5,29873,3,29900,3,29901,3,29903,3,30200,6,30339,3,30340,3,30591,3,30592,3,30791,3,30792,3,31028,3,31121,3,31154,3,31170,3,31171,3,31370,3,31528,3,31529,3,31600,3,31700,3,31838,3,31839,3,31901,3,32061,3,32062,3,32098,3,32099,5,32100,3,32104,3,32161,3,32766,3,53034,3,53048,3,53049,3,54034,3,65061,5,65062,5,65161,3,65163,3,102041,5,102064,4,102068,1,102069,0,102217,5,102218,
3,102219,5,102220,5,102378,5,102379,5,102380,3,102381,5,102589,5,102599,5,102600,5,102604,5,102605,3,102606,3,102647,3,102704,5,102705,5,102733,5,102761,5,102762,3,102763,5,102764,3,102765,3,102766,5,102970,5,102974,5,102993,3,102994,3,102995,5,102996,5,103015,3,103016,5,103017,3,103018,5,103025,3,103026,3,103027,5,103028,5,103035,3,103036,3,103037,5,103038,5,103039,3,103040,3,103041,5,103042,5,103043,3,103044,3,103045,5,103046,5,103047,3,103048,3,103049,5,103050,5,103051,3,103052,5,103053,3,103054,
5,103055,3,103056,5,103057,3,103058,3,103059,5,103060,5,103061,3,103062,3,103063,5,103064,5,103069,5,103070,3,103071,3,103072,5,103073,5,103086,3,103087,3,103088,5,103089,5,103094,5,103095,3,103096,5,103103,3,103104,5,103105,3,103106,5,103121,3,103122,5,103123,3,103124,3,103125,5,103126,5,103127,3,103128,3,103129,5,103130,5,103131,3,103132,3,103133,5,103134,5,103135,3,103136,3,103137,5,103138,5,103139,3,103140,5,103141,3,103142,5,103143,3,103144,5,103145,3,103146,5,103147,3,103148,3,103149,5,103150,
5,103151,3,103152,5,103172,3,103173,5,103174,3,103175,3,103176,5,103177,5,103178,3,103179,3,103180,5,103181,5,103182,3,103183,3,103184,5,103185,5,103228,3,103229,3,103230,5,103231,5,103250,3,103251,5,103252,3,103253,5,103260,3,103261,3,103262,5,103263,5,103270,3,103271,3,103272,5,103273,5,103274,3,103275,3,103276,5,103277,5,103278,3,103279,3,103280,5,103281,5,103282,3,103283,3,103284,5,103285,5,103286,3,103287,5,103288,3,103289,5,103290,3,103291,5,103292,3,103293,3,103294,5,103295,5,103296,3,103297,
3,103298,5,103299,5,103376,5,103377,3,103378,3,103379,5,103380,5,103393,3,103394,3,103395,5,103396,5,103472,3,103473,5,103474,3,103475,5,103482,3,103483,5,103484,3,103485,5,103500,3,103501,5,103502,3,103503,3,103504,5,103505,5,103506,3,103507,3,103508,5,103509,5,103510,3,103511,3,103512,5,103513,5,103514,3,103515,5,103516,3,103517,5,103518,3,103519,5,103520,3,103521,5,103522,3,103523,3,103524,5,103525,5,103526,3,103527,5,103561,5,103562,5,103563,3,103564,3,103565,5,103566,5,103567,3,103568,3,103569,
5,103570,5,103585,5,103695,5],pcsidc:[[2E3,2045,3],[2056,2065,3],[2067,2135,3],[2137,2153,3],[2161,2170,3],[2172,2193,3],[2196,2198,3],[2200,2203,3],[2206,2217,3],[2222,2224,5],[2251,2253,5],[2280,2282,5],[2308,2311,3],[2315,2325,3],[2327,2394,3],[2400,2462,3],[2523,2576,3],[2578,2693,3],[2695,2758,3],[2867,2888,5],[2891,2930,5],[2931,2941,3],[2969,2973,3],[2975,2982,3],[2984,2988,3],[2995,3002,3],[3006,3051,3],[3054,3059,3],[3061,3066,3],[3068,3071,3],[3084,3087,3],[3112,3118,3],[3120,3138,3],[3146,
3151,3],[3153,3157,3],[3161,3166,3],[3168,3172,3],[3174,3203,3],[3294,3313,3],[3315,3335,3],[3339,3345,3],[3350,3358,3],[3367,3369,3],[3374,3399,3],[3408,3416,3],[3425,3432,5],[3441,3446,5],[3456,3459,5],[3465,3478,3],[3554,3559,3],[3561,3565,5],[3568,3570,5],[3571,3581,3],[3594,3597,3],[3601,3604,3],[3637,3639,3],[3665,3667,3],[3693,3695,3],[3701,3727,3],[3728,3733,5],[3744,3747,3],[3753,3758,5],[3761,3763,3],[3765,3769,3],[3779,3781,3],[3788,3791,3],[3797,3799,3],[3832,3841,3],[3844,3852,3],[3873,
3885,3],[3890,3893,3],[3907,3912,3],[3942,3950,3],[3968,3970,3],[3973,3976,3],[3986,3989,3],[3994,3997,3],[4399,4413,5],[4418,4433,5],[4491,4554,3],[5069,5072,3],[5105,5130,3],[5180,5184,3],[5253,5259,3],[5269,5275,3],[5292,5311,3],[5343,5349,3],[5355,5357,3],[5387,5389,3],[5459,5463,3],[5479,5482,3],[5530,5539,3],[5550,5552,3],[5562,5583,3],[5623,5625,5],[5631,5639,3],[5649,5653,3],[5663,5680,3],[5682,5685,3],[5875,5877,3],[20002,20032,3],[20062,20092,3],[20135,20138,3],[20248,20258,3],[20348,20358,
3],[20436,20440,3],[20822,20824,3],[20934,20936,3],[21035,21037,3],[21095,21097,3],[21148,21150,3],[21413,21423,3],[21473,21483,3],[21780,21782,3],[21891,21894,3],[22171,22177,3],[22181,22187,3],[22191,22197,3],[22234,22236,3],[22521,22525,3],[22991,22994,3],[23028,23038,3],[23830,23853,3],[23866,23872,3],[23877,23884,3],[23886,23894,3],[23946,23948,3],[24311,24313,3],[24342,24347,3],[24370,24374,4],[24375,24381,3],[24718,24721,3],[24817,24821,3],[24877,24882,3],[24891,24893,3],[25391,25395,3],[25828,
25838,3],[26191,26195,3],[26391,26393,3],[26703,26722,3],[26729,26760,5],[26766,26798,5],[26860,26870,5],[26891,26899,3],[26903,26923,3],[26929,26946,3],[26948,26998,3],[27037,27040,3],[27205,27232,3],[27258,27260,3],[27391,27398,3],[27561,27564,3],[27571,27574,3],[27581,27584,3],[27591,27594,3],[28191,28193,3],[28348,28358,3],[28402,28432,3],[28462,28492,3],[29118,29122,3],[29177,29185,3],[30161,30179,3],[30491,30494,3],[30729,30732,3],[31251,31259,3],[31265,31268,3],[31275,31278,3],[31288,31297,
3],[31461,31465,3],[31491,31495,3],[31917,31922,3],[31965,31985,3],[31992,32E3,3],[32001,32003,5],[32005,32031,5],[32033,32060,5],[32074,32077,5],[32081,32086,3],[32107,32130,3],[32133,32158,3],[32164,32167,5],[32180,32199,3],[32201,32260,3],[32301,32360,3],[32601,32662,3],[32664,32667,5],[32701,32761,3],[53001,53004,3],[53008,53019,3],[53021,53032,3],[53042,53046,3],[54001,54004,3],[54008,54019,3],[54021,54032,3],[54042,54046,3],[54048,54053,3],[102001,102040,3],[102042,102063,3],[102065,102067,
3],[102070,102112,3],[102114,102117,3],[102118,102121,5],[102122,102208,3],[102210,102216,3],[102221,102300,3],[102304,102377,3],[102382,102388,3],[102389,102391,5],[102401,102444,3],[102450,102452,3],[102461,102468,5],[102469,102492,3],[102500,102519,5],[102530,102549,3],[102570,102588,3],[102590,102598,3],[102601,102603,3],[102608,102628,3],[102629,102646,5],[102648,102672,5],[102675,102700,5],[102701,102703,3],[102707,102730,5],[102735,102758,5],[102767,102798,3],[102962,102969,3],[102971,102973,
3],[102975,102989,3],[102990,102992,5],[102997,103002,3],[103003,103008,5],[103009,103011,3],[103012,103014,5],[103019,103021,3],[103022,103024,5],[103029,103031,3],[103032,103034,5],[103065,103068,3],[103074,103076,3],[103077,103079,5],[103080,103082,3],[103083,103085,5],[103090,103093,3],[103097,103099,3],[103100,103102,5],[103107,103109,3],[103110,103112,5],[103113,103116,3],[103117,103120,5],[103153,103157,3],[103158,103162,5],[103163,103165,3],[103166,103171,5],[103186,103188,3],[103189,103191,
5],[103192,103195,3],[103196,103199,5],[103200,103224,3],[103225,103227,5],[103232,103237,3],[103238,103243,5],[103244,103246,3],[103247,103249,5],[103254,103256,3],[103257,103259,5],[103264,103266,3],[103267,103269,5],[103300,103375,3],[103381,103383,3],[103384,103386,5],[103387,103389,3],[103390,103392,5],[103397,103399,3],[103400,103471,5],[103476,103478,3],[103479,103481,5],[103486,103488,3],[103489,103491,5],[103492,103495,3],[103496,103499,5],[103539,103543,3],[103544,103548,5],[103549,103551,
3],[103552,103557,5],[103558,103560,3],[103571,103573,3],[103574,103576,5],[103577,103580,3],[103581,103583,5],[103600,103694,3],[103700,103793,5],[103794,103799,3]],gcsid:[4042,0,4075,0,4081,0,4168,0,4170,0,4188,0,4261,1,4262,0,4263,0,4288,0,4289,0,4305,1,4322,0,4324,0,4326,0,4466,0,4469,0,4475,0,4483,0,4490,0,4555,0,4558,0,4614,0,4619,0,4657,0,4670,0,4671,0,4674,0,4682,0,4683,0,4718,0,4720,0,4721,0,4723,0,4726,0,4737,0,4738,0,4759,0,4761,0,4807,1,4808,0,4809,0,4816,1,4817,0,4818,0,4819,1,4820,0,
4821,1,4823,0,4824,0,4901,1,4902,1,4903,0,4904,0,5228,0,5229,0,5233,0,5252,0,5264,0,5340,0,5354,0,5360,0,5371,0,5373,0,5381,0,5393,0,5464,0,5467,0,5489,0,5524,0,5527,0,5546,0,5561,0,5593,0,5681,0,5886,0,37225,1,37235,0,37257,0,37259,0,37260,0,104020,0,104139,1,104140,1,104223,0,104286,0,104287,0,104304,0,104305,0,104896,0,104900,5,104901,0,104902,0,104903,9,104904,2,104905,2,104906,59,104907,54,104908,0,104909,58,104910,31,104911,56,104912,6,104913,50,104914,41,104915,10,104916,3,104917,30,104918,
8,104919,60,104920,53,104921,44,104922,48,104923,51,104924,38,104925,0,104926,49,104927,57,104928,21,104929,23,104930,35,104931,49,104932,27,104933,17,104934,13,104935,7,104936,56,104937,40,104938,28,104939,37,104940,15,104941,55,104942,22,104943,4,104944,0,104945,20,104946,42,104947,47,104948,52,104949,43,104950,46,104951,39,104952,24,104953,16,104954,50,104955,36,104956,33,104957,46,104958,14,104959,19,104960,0,104961,34,104962,32,104963,29,104964,45,104965,26,104966,25,104967,41,104968,11,104969,
12,104970,18],gcsidc:[[4001,4016,0],[4018,4025,0],[4027,4029,0],[4031,4036,0],[4044,4047,0],[4052,4054,0],[4120,4166,0],[4172,4176,0],[4178,4185,0],[4190,4196,0],[4198,4216,0],[4218,4222,0],[4224,4232,0],[4234,4260,0],[4265,4267,0],[4269,4286,0],[4291,4303,0],[4306,4319,0],[4600,4610,0],[4621,4625,0],[4627,4633,0],[4636,4639,0],[4641,4646,0],[4659,4667,0],[4676,4680,0],[4686,4697,0],[4699,4706,0],[4740,4757,0],[4763,4765,0],[4801,4806,0],[4810,4812,1],[4813,4815,0],[37001,37008,0],[37201,37208,0],
[37211,37224,0],[37226,37233,0],[37237,37243,0],[37245,37247,0],[37249,37255,0],[104100,104138,0],[104141,104145,0],[104256,104261,0],[104700,104786,0],[104990,104992,0]]},c={c:[[2E3,2045,9001],[2056,2065,9001],[2067,2135,9001],[2137,2153,9001],[2161,2170,9001],[2172,2193,9001],[2196,2198,9001],[2200,2203,9001],[2206,2217,9001],[2222,2224,9002],[2251,2253,9002],[2280,2282,9002],[2308,2311,9001],[2315,2325,9001],[2327,2394,9001],[2400,2462,9001],[2523,2576,9001],[2578,2693,9001],[2695,2758,9001],[2867,
2869,9002],[2870,2888,9003],[2891,2895,9003],[2896,2898,9002],[2902,2908,9003],[2915,2920,9003],[2921,2923,9002],[2924,2930,9003],[2931,2941,9001],[2969,2973,9001],[2975,2982,9001],[2984,2988,9001],[2995,3002,9001],[3006,3051,9001],[3054,3059,9001],[3061,3066,9001],[3068,3071,9001],[3084,3087,9001],[3112,3118,9001],[3120,3138,9001],[3146,3151,9001],[3153,3157,9001],[3161,3166,9001],[3168,3172,9001],[3174,3203,9001],[3294,3313,9001],[3315,3335,9001],[3339,3345,9001],[3350,3358,9001],[3367,3369,9001],
[3374,3399,9001],[3408,3416,9001],[3425,3432,9003],[3441,3446,9003],[3456,3459,9003],[3465,3478,9001],[3554,3559,9001],[3561,3565,9003],[3568,3570,9003],[3571,3581,9001],[3594,3597,9001],[3601,3604,9001],[3637,3639,9001],[3665,3667,9001],[3693,3695,9001],[3701,3727,9001],[3728,3733,9003],[3744,3747,9001],[3753,3758,9003],[3761,3763,9001],[3765,3769,9001],[3779,3781,9001],[3788,3791,9001],[3797,3799,9001],[3832,3841,9001],[3844,3852,9001],[3873,3885,9001],[3890,3893,9001],[3907,3912,9001],[3942,3950,
9001],[3968,3970,9001],[3973,3976,9001],[3986,3989,9001],[3994,3997,9001],[4001,4016,9102],[4018,4025,9102],[4027,4029,9102],[4031,4036,9102],[4044,4047,9102],[4052,4054,9102],[4120,4166,9102],[4172,4176,9102],[4178,4185,9102],[4190,4196,9102],[4198,4216,9102],[4218,4222,9102],[4224,4232,9102],[4234,4260,9102],[4265,4267,9102],[4269,4286,9102],[4291,4303,9102],[4306,4319,9102],[4399,4413,9003],[4418,4433,9003],[4491,4554,9001],[4600,4610,9102],[4621,4625,9102],[4627,4633,9102],[4636,4639,9102],[4641,
4646,9102],[4659,4667,9102],[4676,4680,9102],[4686,4697,9102],[4699,4706,9102],[4740,4757,9102],[4763,4765,9102],[4801,4806,9102],[4810,4812,9105],[4813,4815,9102],[5069,5072,9001],[5105,5130,9001],[5180,5184,9001],[5253,5259,9001],[5269,5275,9001],[5292,5311,9001],[5343,5349,9001],[5355,5357,9001],[5387,5389,9001],[5459,5463,9001],[5479,5482,9001],[5530,5539,9001],[5550,5552,9001],[5562,5583,9001],[5623,5625,9003],[5631,5639,9001],[5649,5653,9001],[5663,5680,9001],[5682,5685,9001],[5875,5877,9001],
[20002,20032,9001],[20062,20092,9001],[20135,20138,9001],[20248,20258,9001],[20348,20358,9001],[20436,20440,9001],[20822,20824,9001],[20934,20936,9001],[21035,21037,9001],[21095,21097,9001],[21148,21150,9001],[21413,21423,9001],[21473,21483,9001],[21780,21782,9001],[21891,21894,9001],[22171,22177,9001],[22181,22187,9001],[22191,22197,9001],[22234,22236,9001],[22521,22525,9001],[22991,22994,9001],[23028,23038,9001],[23830,23853,9001],[23866,23872,9001],[23877,23884,9001],[23886,23894,9001],[23946,
23948,9001],[24311,24313,9001],[24342,24347,9001],[24370,24374,9084],[24375,24381,9001],[24718,24721,9001],[24817,24821,9001],[24877,24882,9001],[24891,24893,9001],[25391,25395,9001],[25828,25838,9001],[26191,26195,9001],[26391,26393,9001],[26703,26722,9001],[26729,26760,9003],[26766,26798,9003],[26860,26870,9003],[26891,26899,9001],[26903,26923,9001],[26929,26946,9001],[26948,26998,9001],[27037,27040,9001],[27205,27232,9001],[27258,27260,9001],[27391,27398,9001],[27561,27564,9001],[27571,27574,9001],
[27581,27584,9001],[27591,27594,9001],[28191,28193,9001],[28348,28358,9001],[28402,28432,9001],[28462,28492,9001],[29118,29122,9001],[29177,29185,9001],[30161,30179,9001],[30491,30494,9001],[30729,30732,9001],[31251,31259,9001],[31265,31268,9001],[31275,31278,9001],[31288,31297,9001],[31461,31465,9001],[31491,31495,9001],[31917,31922,9001],[31965,31985,9001],[31992,32E3,9001],[32001,32003,9003],[32005,32031,9003],[32033,32060,9003],[32074,32077,9003],[32081,32086,9001],[32107,32130,9001],[32133,32158,
9001],[32164,32167,9003],[32180,32199,9001],[32201,32260,9001],[32301,32360,9001],[32601,32662,9001],[32664,32667,9003],[32701,32761,9001],[37001,37008,9102],[37201,37208,9102],[37211,37224,9102],[37226,37233,9102],[37237,37243,9102],[37245,37247,9102],[37249,37255,9102],[53001,53004,9001],[53008,53019,9001],[53021,53032,9001],[53042,53046,9001],[54001,54004,9001],[54008,54019,9001],[54021,54032,9001],[54042,54046,9001],[54048,54053,9001],[102001,102040,9001],[102042,102063,9001],[102065,102067,9001],
[102070,102112,9001],[102114,102117,9001],[102122,102208,9001],[102210,102216,9001],[102221,102300,9001],[102304,102377,9001],[102382,102388,9001],[102389,102391,9003],[102401,102444,9001],[102450,102452,9001],[102461,102468,9003],[102469,102492,9001],[102500,102519,9002],[102530,102549,9001],[102570,102588,9001],[102590,102598,9001],[102601,102603,9001],[102608,102628,9001],[102629,102646,9003],[102648,102672,9003],[102675,102700,9003],[102701,102703,9001],[102707,102730,9003],[102735,102758,9003],
[102767,102798,9001],[102962,102969,9001],[102971,102973,9001],[102975,102989,9001],[102990,102992,9002],[102997,103002,9001],[103003,103008,9003],[103009,103011,9001],[103012,103014,9003],[103019,103021,9001],[103022,103024,9003],[103029,103031,9001],[103032,103034,9003],[103065,103068,9001],[103074,103076,9001],[103077,103079,9002],[103080,103082,9001],[103083,103085,9003],[103090,103093,9001],[103097,103099,9001],[103100,103102,9003],[103107,103109,9001],[103110,103112,9003],[103113,103116,9001],
[103117,103120,9003],[103153,103157,9001],[103158,103162,9003],[103163,103165,9001],[103166,103168,9002],[103169,103171,9003],[103186,103188,9001],[103189,103191,9003],[103192,103195,9001],[103196,103199,9003],[103200,103224,9001],[103225,103227,9002],[103232,103237,9001],[103238,103243,9003],[103244,103246,9001],[103247,103249,9003],[103254,103256,9001],[103257,103259,9003],[103264,103266,9001],[103267,103269,9003],[103300,103375,9001],[103381,103383,9001],[103384,103386,9002],[103387,103389,9001],
[103390,103392,9003],[103397,103399,9001],[103400,103471,9003],[103476,103478,9001],[103479,103481,9003],[103486,103488,9001],[103489,103491,9003],[103492,103495,9001],[103496,103499,9003],[103539,103543,9001],[103544,103548,9003],[103549,103551,9001],[103552,103554,9002],[103555,103557,9003],[103558,103560,9001],[103571,103573,9001],[103574,103576,9003],[103577,103580,9001],[103581,103583,9003],[103600,103694,9001],[103700,103793,9003],[103794,103799,9001],[104100,104138,9102],[104141,104145,9102],
[104256,104261,9102],[104700,104786,9102],[104900,104970,9102],[104990,104992,9102]],nc:[2066,9039,2136,9094,2155,9003,2157,9001,2158,9001,2159,9094,2160,9094,2219,9001,2220,9001,2244,9003,2245,9003,2256,9002,2265,9002,2266,9002,2269,9002,2270,9002,2273,9002,2290,9001,2291,9001,2294,9001,2295,9001,2313,9001,2314,9005,2899,9003,2900,9003,2901,9002,2909,9002,2910,9002,2911,9003,2912,9003,2913,9002,2914,9002,2964,9003,2967,9003,2968,9003,2991,9001,2992,9002,2993,9001,2994,9002,3073,9001,3076,9001,3079,
9001,3091,9003,3106,9001,3108,9001,3109,9001,3141,9001,3142,9001,3167,9301,3337,9001,3347,9001,3348,9001,3359,9003,3360,9001,3361,9002,3362,9001,3363,9003,3364,9001,3365,9003,3366,9005,3402,9001,3403,9001,3405,9001,3406,9001,3439,9001,3440,9001,3447,9001,3449,9001,3450,9001,3453,9003,3454,9003,3460,9001,3479,9002,3480,9001,3481,9002,3482,9001,3483,9002,3484,9001,3485,9003,3486,9001,3487,9003,3488,9001,3489,9001,3490,9003,3491,9001,3492,9003,3493,9001,3494,9003,3495,9001,3496,9003,3497,9001,3498,9003,
3499,9001,3500,9003,3501,9001,3502,9003,3503,9001,3504,9003,3505,9001,3506,9003,3507,9001,3508,9003,3509,9001,3510,9003,3511,9001,3512,9003,3513,9001,3514,9001,3515,9003,3516,9001,3517,9003,3518,9001,3519,9003,3520,9001,3521,9003,3522,9001,3523,9003,3524,9001,3525,9003,3526,9001,3527,9003,3528,9001,3529,9003,3530,9001,3531,9003,3532,9001,3533,9003,3534,9001,3535,9003,3536,9001,3537,9003,3538,9001,3539,9003,3540,9001,3541,9003,3542,9001,3543,9003,3544,9001,3545,9003,3546,9001,3547,9003,3548,9001,3549,
9003,3550,9001,3551,9003,3552,9001,3553,9003,3582,9003,3583,9001,3584,9003,3585,9001,3586,9003,3587,9001,3588,9002,3589,9001,3590,9002,3591,9001,3592,9001,3593,9002,3598,9003,3599,9001,3600,9003,3605,9002,3606,9001,3607,9001,3608,9003,3609,9001,3610,9003,3611,9001,3612,9003,3613,9001,3614,9003,3615,9001,3616,9003,3617,9001,3618,9003,3619,9001,3620,9003,3621,9001,3622,9003,3623,9001,3624,9003,3625,9001,3626,9003,3627,9001,3628,9003,3629,9001,3630,9003,3631,9001,3632,9003,3633,9001,3634,9002,3635,9001,
3636,9002,3640,9003,3641,9001,3642,9003,3643,9001,3644,9002,3645,9001,3646,9002,3647,9001,3648,9002,3649,9001,3650,9003,3651,9001,3652,9003,3653,9001,3654,9003,3655,9001,3656,9002,3657,9001,3658,9003,3659,9001,3660,9003,3661,9001,3662,9003,3663,9001,3664,9003,3668,9003,3669,9001,3670,9003,3671,9001,3672,9003,3673,9001,3674,9003,3675,9001,3676,9002,3677,9003,3678,9001,3679,9002,3680,9003,3681,9001,3682,9002,3683,9003,3684,9001,3685,9001,3686,9003,3687,9001,3688,9003,3689,9001,3690,9003,3691,9001,3692,
9003,3696,9003,3697,9001,3698,9003,3699,9001,3700,9003,3740,9001,3749,9001,3783,9001,3784,9001,3793,9001,3794,9001,3802,9001,3816,9001,3829,9001,3854,9001,3920,9001,3978,9001,3979,9001,3991,9003,3992,9003,4026,9001,4037,9001,4038,9001,4042,9102,4075,9102,4081,9102,4168,9102,4170,9102,4188,9102,4217,9003,4261,9105,4262,9102,4263,9102,4288,9102,4289,9102,4305,9105,4322,9102,4324,9102,4326,9102,4438,9003,4439,9003,4466,9102,4467,9001,4469,9102,4471,9001,4474,9001,4475,9102,4483,9102,4490,9102,4555,9102,
4558,9102,4559,9001,4614,9102,4619,9102,4657,9102,4670,9102,4671,9102,4674,9102,4682,9102,4683,9102,4718,9102,4720,9102,4721,9102,4723,9102,4726,9102,4737,9102,4738,9102,4759,9102,4761,9102,4807,9105,4808,9102,4809,9102,4816,9105,4817,9102,4818,9102,4819,9105,4820,9102,4821,9105,4823,9102,4824,9102,4839,9001,4901,9105,4902,9105,4903,9102,4904,9102,5018,9001,5048,9001,5167,9001,5168,9001,5223,9001,5228,9102,5229,9102,5233,9102,5234,9001,5235,9001,5243,9001,5252,9102,5264,9102,5266,9001,5316,9001,5320,
9001,5321,9001,5330,9001,5331,9001,5337,9001,5340,9102,5354,9102,5360,9102,5361,9001,5362,9001,5371,9102,5373,9102,5381,9102,5382,9001,5383,9001,5393,9102,5396,9001,5456,9001,5457,9001,5464,9102,5467,9102,5469,9001,5472,9037,5489,9102,5490,9001,5518,9001,5523,9001,5524,9102,5527,9102,5546,9102,5559,9001,5561,9102,5588,9002,5589,9005,5593,9102,5596,9001,5627,9001,5629,9001,5641,9001,5643,9001,5644,9001,5654,9003,5655,9003,5659,9001,5681,9102,5700,9001,5825,9001,5836,9001,5837,9001,5842,9001,5844,9001,
5880,9001,5886,9102,5887,9001,5890,9001,20499,9001,20538,9001,20539,9001,20790,9001,20791,9001,21291,9001,21292,9001,21500,9001,21817,9001,21818,9001,22032,9001,22033,9001,22091,9001,22092,9001,22332,9001,22391,9001,22392,9001,22700,9001,22770,9001,22780,9001,22832,9001,23090,9001,23095,9001,23239,9001,23240,9001,23433,9001,23700,9001,24047,9001,24048,9001,24100,9005,24200,9001,24305,9001,24306,9001,24382,9084,24383,9001,24500,9001,24547,9001,24548,9001,24571,9062,24600,9001,25E3,9001,25231,9001,
25884,9001,25932,9001,26237,9001,26331,9001,26332,9001,26591,9001,26592,9001,26632,9001,26692,9001,26855,9003,26856,9003,27120,9001,27200,9001,27291,9040,27292,9040,27429,9001,27492,9001,27500,9001,27700,9001,28232,9001,28600,9001,28991,9001,28992,9001,29100,9001,29220,9001,29221,9001,29333,9001,29635,9001,29636,9001,29701,9001,29738,9001,29739,9001,29849,9001,29850,9001,29871,9042,29872,9041,29873,9001,29900,9001,29901,9001,29903,9001,30200,9039,30339,9001,30340,9001,30591,9001,30592,9001,30791,
9001,30792,9001,31028,9001,31121,9001,31154,9001,31170,9001,31171,9001,31370,9001,31528,9001,31529,9001,31600,9001,31700,9001,31838,9001,31839,9001,31901,9001,32061,9001,32062,9001,32098,9001,32099,9003,32100,9001,32104,9001,32161,9001,32766,9001,37225,9105,37235,9102,37257,9102,37259,9102,37260,9102,53034,9001,53048,9001,53049,9001,54034,9001,65061,9003,65062,9003,65161,9001,65163,9001,102041,9003,102064,9085,102068,109030,102069,109031,102118,9003,102119,9002,102120,9003,102121,9003,102217,9003,
102218,9001,102219,9003,102220,9003,102378,9002,102379,9002,102380,9001,102381,9002,102589,9003,102599,9003,102600,9003,102604,9003,102605,9001,102606,9001,102647,9001,102704,9003,102705,9003,102733,9003,102761,9003,102762,9001,102763,9003,102764,9001,102765,9001,102766,9003,102970,9002,102974,9003,102993,9001,102994,9001,102995,9003,102996,9003,103015,9001,103016,9003,103017,9001,103018,9003,103025,9001,103026,9001,103027,9003,103028,9003,103035,9001,103036,9001,103037,9003,103038,9003,103039,9001,
103040,9001,103041,9003,103042,9003,103043,9001,103044,9001,103045,9003,103046,9003,103047,9001,103048,9001,103049,9003,103050,9003,103051,9001,103052,9003,103053,9001,103054,9003,103055,9001,103056,9003,103057,9001,103058,9001,103059,9003,103060,9003,103061,9001,103062,9001,103063,9003,103064,9003,103069,9003,103070,9001,103071,9001,103072,9003,103073,9003,103086,9001,103087,9001,103088,9003,103089,9003,103094,9002,103095,9001,103096,9003,103103,9001,103104,9003,103105,9001,103106,9003,103121,9001,
103122,9003,103123,9001,103124,9001,103125,9002,103126,9002,103127,9001,103128,9001,103129,9003,103130,9003,103131,9001,103132,9001,103133,9003,103134,9003,103135,9001,103136,9001,103137,9002,103138,9002,103139,9001,103140,9003,103141,9001,103142,9003,103143,9001,103144,9003,103145,9001,103146,9002,103147,9001,103148,9001,103149,9003,103150,9003,103151,9001,103152,9003,103172,9001,103173,9003,103174,9001,103175,9001,103176,9003,103177,9003,103178,9001,103179,9001,103180,9003,103181,9003,103182,9001,
103183,9001,103184,9003,103185,9003,103228,9001,103229,9001,103230,9003,103231,9003,103250,9001,103251,9003,103252,9001,103253,9003,103260,9001,103261,9001,103262,9003,103263,9003,103270,9001,103271,9001,103272,9003,103273,9003,103274,9001,103275,9001,103276,9003,103277,9003,103278,9001,103279,9001,103280,9003,103281,9003,103282,9001,103283,9001,103284,9003,103285,9003,103286,9001,103287,9003,103288,9001,103289,9003,103290,9001,103291,9003,103292,9001,103293,9001,103294,9003,103295,9003,103296,9001,
103297,9001,103298,9003,103299,9003,103376,9003,103377,9001,103378,9001,103379,9003,103380,9003,103393,9001,103394,9001,103395,9003,103396,9003,103472,9001,103473,9002,103474,9001,103475,9003,103482,9001,103483,9003,103484,9001,103485,9003,103500,9001,103501,9003,103502,9001,103503,9001,103504,9002,103505,9002,103506,9001,103507,9001,103508,9003,103509,9003,103510,9001,103511,9001,103512,9003,103513,9003,103514,9001,103515,9003,103516,9001,103517,9003,103518,9001,103519,9003,103520,9001,103521,9002,
103522,9001,103523,9001,103524,9003,103525,9003,103526,9001,103527,9003,103561,9003,103562,9003,103563,9001,103564,9001,103565,9003,103566,9003,103567,9001,103568,9001,103569,9003,103570,9003,103585,9003,103695,9003,104020,9102,104139,9105,104140,9105,104223,9102,104286,9102,104287,9102,104304,9102,104305,9102,104896,9102]},g=function(){function e(){}e.cC=function(f){!1===e.ti&&e.bo();var a=e.NG(f);if(-1==a){var g=e.ks(f);g!=f&&(a=e.cC(g))}return a};e.NG=function(f){return void 0!==e.ds[f]?e.ds[f]:
-1};e.SM=function(f){!1===e.ti&&e.bo();var a=e.Fz(f);if(1E38==a){var g=e.ks(f);g!=f&&(a=e.Fz(g));if(1E38==a)return 1E-10}return a};e.WO=function(f){if(void 0!==e.Un[f])return!0;var a=e.ks(f);return a!=f&&void 0!==e.Un[a]?!0:!1};e.ZO=function(f){if(void 0!==e.Gh[f])return!0;var a=e.ks(f);return a!=f&&void 0!==e.Gh[a]?!0:!1};e.Fz=function(f){!1===e.ti&&e.bo();return void 0!==e.Un[f]?e.Un[f]:void 0!==e.Gh[f]?e.Gh[f]:1E38};e.oU=function(f){!1===e.ti&&e.bo();return void 0!==e.ew[f]?e.ew[f]:f};e.ks=function(f){!1===
e.ti&&e.bo();return void 0!==e.Mw[f]?e.Mw[f]:f};e.bo=function(){for(var f=b,a,g=0;g<f.pcsid.length;g+=2)e.Gh[f.pcsid[g]]=f.pcstol[2*f.pcsid[g+1]+1];for(g=0;g<f.pcsidc.length;g+=1){a=f.pcsidc[g];for(var d=a[0];d<=a[1];d++)e.Gh[d]=f.pcstol[2*a[2]+1]}for(g=0;g<f.gcsid.length;g+=2)e.Un[f.gcsid[g]]=f.gcstol[2*f.gcsid[g+1]+1];for(g=0;g<f.gcsidc.length;g+=1)for(a=f.gcsidc[g],d=a[0];d<=a[1];d++)e.Gh[d]=f.gcstol[2*a[2]+1];for(g=0;g<c.c.length;g+=1)for(a=c.c[g],d=a[0];d<=a[1];d++)e.ds[d]=a[2];for(g=0;g<c.nc.length;g+=
2)e.ds[c.nc[g]]=c.nc[g+1];c=null;for(g=0;g<f.newtoold.length;g+=2)e.ew[f.newtoold[g+1]]=f.newtoold[g],e.Mw[f.newtoold[g]]=f.newtoold[g+1];b=null;e.ti=!0};e.ti=!1;e.Un=[];e.Gh=[];e.ew=[];e.Mw=[];e.ds=[];return e}();a.ls=g})(E||(E={}));(function(a){function b(e){return 0===e.length?'""':'"'==e[0]||"."==e[0]||"0"<=e[0]&&"9">=e[0]?e:'"'+e.trim()+'"'}var c=[],g=function(){function e(){}e.UM=function(f){try{for(var n=0;n<c.length;n++)if(c[n].wkttext===f)return c[n].unit;for(var g,d=n="",z=!1,m=0;m<f.length;m++){var k=
f[m];!0===z?'"'==k?'"'==f[m+1]?n+=k:z=!1:n+=k:/[\s]/.test(k)||(","==k?(d=""!==n?d+(b(n)+","):d+",",n=""):")"==k||"]"==k?(d=""!==n?d+(b(n)+"]}"):d+"]}",n=""):"("==k||"["==k?(d+='{ "entity": "'+n.toUpperCase().trim()+'", "values":[',n=""):'"'==k?(z=!0,n=""):n+=k)}g=JSON.parse(d);var h=e.Dz(g);if(null===h)return null;g=null;for(k=0;k<h.values.length;k++)if("object"===typeof h.values[k]&&"UNIT"===h.values[k].entity){g=h.values[k];break}if(null===g)return null;var q=a.Tb.EL("GEOGCS"===h.entity?1:0,g.values[1],
g.values[2]);c.push({wkttext:f,unit:q});10<c.length&&c.shift();return q}catch(ia){return null}};e.Dz=function(f){if(null===f)return null;if("GEOGCS"===f.entity||"PROJCS"===f.entity)return f;for(var a=[],g=0;g<f.values.length;g++)if("object"===typeof f.values[g]&&void 0!==f.values[g].entity){if("GEOGCS"===f.values[g].entity||"PROJCS"==f.values[g].entity)return f.values[g];a.push(f.values[g])}for(f=0;f<a.length;f++)if(g=e.Dz(a[f]),null!==g)return g;return null};e.TM=function(e){var f=-1;if(null!=e&&
0<e.length){var a,g;a=e.indexOf("PROJCS");if(0<=a){var b=0;a=e.lastIndexOf("UNIT");if(0<=a&&(a=e.indexOf(",",a+4),0<a&&(a++,g=e.indexOf("]",a+1),0<g)))try{b=parseFloat(e.substring(a,g))}catch(Y){b=0}0<b&&(f=.001/b)}else if(a=e.indexOf("GEOGCS"),0<=a){var c=0,b=0;a=e.indexOf("SPHEROID",a+6);if(0<a&&(a=e.indexOf(",",a+8),0<a)){a++;g=e.indexOf(",",a+1);if(0<g)try{c=parseFloat(e.substring(a,g))}catch(Y){c=0}if(0<c&&(a=e.indexOf("UNIT",g+1),0<=a&&(a=e.indexOf(",",a+4),0<a&&(a++,g=e.indexOf("]",a+1),0<
g))))try{b=parseFloat(e.substring(a,g))}catch(Y){b=0}}0<c&&0<b&&(f=.001/(c*b))}}return f};return e}();a.mA=g})(E||(E={}));(function(a){(function(a){a[a.NONE=0]="NONE";a[a.LINEAR=1]="LINEAR";a[a.ANGULAR=2]="ANGULAR"})(a.BH||(a.BH={}));(function(a){a[a.enumFloat=0]="enumFloat";a[a.enumDouble=1]="enumDouble";a[a.enumInt32=2]="enumInt32";a[a.enumInt64=3]="enumInt64";a[a.enumInt8=4]="enumInt8";a[a.enumInt16=5]="enumInt16"})(a.oI||(a.oI={}));(function(a){a[a.POSITION=0]="POSITION";a[a.Z=1]="Z";a[a.M=2]=
"M";a[a.ID=3]="ID";a[a.NORMAL=4]="NORMAL";a[a.TEXTURE1D=5]="TEXTURE1D";a[a.TEXTURE2D=6]="TEXTURE2D";a[a.TEXTURE3D=7]="TEXTURE3D";a[a.ID2=8]="ID2";a[a.MAXSEMANTICS=10]="MAXSEMANTICS"})(a.xf||(a.xf={}));var b=function(){function b(a,e){this.er=this.le=null;this.up=this.Aa=0;this.Wg=this.Jf=null;this.tk=0;if(void 0!==e){this.Aa=e.Aa;this.up=e.up;this.Jf=e.Jf.slice(0);this.Wg=e.Wg.slice(0);this.tk=e.tk;this.er=[];for(e=a=0;e<this.Aa;e++)this.er[e]=a,a+=b.Wa(this.Jf[e]);this.up=a;this.le=[];for(e=0;e<
this.Aa;e++){a=b.Wa(this.Hd(e));for(var f=b.ue(this.Hd(e)),g=0;g<a;g++)this.le[this.er[e]+g]=f}}else this.up=this.Aa=0}b.prototype.Hd=function(g){if(0>g||g>this.Aa)throw a.g.N();return this.Jf[g]};b.prototype.zf=function(a){return this.Wg[a]};b.JN=function(a){return b.ac[a]};b.Qh=function(a){return b.Cc[a]};b.ye=function(a){return b.Bd[a]};b.Gh=function(a){return b.ye(b.Qh(a))*b.Wa(a)};b.Wa=function(a){return b.ob[a]};b.Wf=function(a){return 2>a};b.ti=function(a){return b.Wf(b.Qh(a))};b.prototype.hasAttribute=
function(a){return 0<=this.Wg[a]};b.prototype.WC=function(){return this.hasAttribute(1)};b.ue=function(a){return b.V[a]};b.prototype.XN=function(a){return this.er[a]};b.nD=function(a,e){return b.V[a]===e};b.$g=function(g){if(4==g)return 2;if(8==g)return 3;throw a.g.N();};b.prototype.lc=function(a){return this===a};b.prototype.jj=function(){for(var g=a.I.kg(this.Jf[0]),e=1;e<this.Aa;e++)g=a.I.kg(this.Jf[e],g);return g};b.prototype.fj=function(a){return this.er[a]};b.prototype.hc=function(){return this.tk};
b.prototype.Fd=function(a){return this.Jf[a]};b.V=[0,0,NaN,0,0,0,0,0,0];b.ac=[1,1,1,0,2,1,1,1,0];b.Cc=[1,1,1,2,0,0,0,0,2];b.Bd=[4,8,4,8,1,2];b.ob=[2,1,1,1,3,1,2,3,2];return b}();a.pa=b})(E||(E={}));(function(a){function b(e,a,g,b){var f=e.jd,n=e.e+a+1;1===g?b=5<=f[n]:2===g?b=5<f[n]||5==f[n]&&(b||0>n||void 0!==f[n+1]||f[n-1]&1):3===g?b=b||void 0!==f[n]||0>n:(b=!1,0!==g&&c("!Big.RM!"));if(1>n||!f[0])b?(e.e=-a,e.jd=[1]):e.jd=[e.e=0];else{f.length=n--;if(b)for(;9<++f[n];)f[n]=0,n--||(++e.e,f.unshift(1));
for(n=f.length;!f[--n];f.pop());}}function c(e){e=Error(e);e.name="BigError";throw e;}var g=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,e=function(){function e(f){if(f instanceof e)this.Dd=f.Dd,this.e=f.e,this.jd=f.jd.slice();else{var a,n,b;0===f&&0>1/f?f="-0":g.test(f+="")||c(NaN);this.Dd="-"==f.charAt(0)?(f=f.slice(1),-1):1;-1<(a=f.indexOf("."))&&(f=f.replace(".",""));0<(n=f.search(/e/i))?(0>a&&(a=n),a+=+f.slice(n+1),f=f.substring(0,n)):0>a&&(a=f.length);for(n=0;"0"==f.charAt(n);n++);if(n==(b=f.length))this.jd=
[this.e=0];else{for(;"0"==f.charAt(--b););this.e=a-n-1;this.jd=[];for(a=0;n<=b;this.jd[a++]=+f.charAt(n++));}}}e.prototype.abs=function(){var f=new e(this);f.Dd=1;return f};e.prototype.DB=function(){var f=0,a=this.jd,g=(f=new e(f)).jd,b=this.Dd,c=f.Dd,d=this.e,z=f.e;if(!a[0]||!g[0])return a[0]?b:g[0]?-c:0;if(b!=c)return b;f=0>b;if(d!=z)return d>(z^f)?1:-1;b=-1;for(c=(d=a.length)<(z=g.length)?d:z;++b<c;)if(a[b]!=g[b])return a[b]>(g[b]^f)?1:-1;return d==z?0:d>(z^f)?1:-1};e.prototype.VB=function(f){var a=
this.jd,g=(f=new e(f)).jd,n=this.Dd==f.Dd?1:-1,d=e.Cc;(d!==~~d||0>d||1E6<d)&&c("!Big.DP!");if(!a[0]||!g[0])return a[0]==g[0]&&c(NaN),g[0]||c(n/0),new e(0*n);var z,m,k,h,q=g.slice(),l=z=g.length,v=a.length,y=a.slice(0,z),t=y.length,r=f,B=r.jd=[],E=0,u=d+(r.e=this.e-f.e)+1;r.Dd=n;n=0>u?0:u;for(q.unshift(0);t++<z;y.push(0));do{for(m=0;10>m;m++){if(z!=(t=y.length))k=z>t?1:-1;else for(h=-1,k=0;++h<z;)if(g[h]!=y[h]){k=g[h]>y[h]?1:-1;break}if(0>k){for(f=t==z?g:q;t;){if(y[--t]<f[t]){for(h=t;h&&!y[--h];y[h]=
9);--y[h];y[t]+=10}y[t]-=f[t]}for(;!y[0];y.shift());}else break}B[E++]=k?m:++m;y[0]&&k?y[t]=a[l]||0:y=[a[l]]}while((l++<v||void 0!==y[0])&&n--);B[0]||1==E||(B.shift(),r.e--);E>u&&b(r,d,e.ye,void 0!==y[0]);return r};e.prototype.nO=function(){return 0<this.DB()};e.prototype.vP=function(){return 0>this.DB()};e.prototype.nr=function(f){var a,g,n=this.Dd,b=(f=new e(f)).Dd;if(n!=b)return f.Dd=-b,this.NE(f);var c=this.jd.slice();g=this.e;var d=f.jd,z=f.e;if(!c[0]||!d[0])return d[0]?(f.Dd=-b,f):new e(c[0]?
this:0);if(n=g-z){(a=0>n)?(n=-n,g=c):(z=g,g=d);g.reverse();for(b=n;b--;g.push(0));g.reverse()}else for(g=((a=c.length<d.length)?c:d).length,n=b=0;b<g;b++)if(c[b]!=d[b]){a=c[b]<d[b];break}a&&(g=c,c=d,d=g,f.Dd=-f.Dd);if(0<(b=(g=d.length)-(a=c.length)))for(;b--;c[a++]=0);for(b=a;g>n;){if(c[--g]<d[g]){for(a=g;a&&!c[--a];c[a]=9);--c[a];c[g]+=10}c[g]-=d[g]}for(;0==c[--b];c.pop());for(;0==c[0];)c.shift(),--z;c[0]||(f.Dd=1,c=[z=0]);f.jd=c;f.e=z;return f};e.prototype.NE=function(f){var a,g=this.Dd;a=(f=new e(f)).Dd;
if(g!=a)return f.Dd=-a,this.nr(f);a=this.e;var n=this.jd,b=f.e,c=f.jd;if(!n[0]||!c[0])return c[0]?f:new e(n[0]?this:0*g);n=n.slice();if(g=a-b){0<g?(b=a,a=c):(g=-g,a=n);for(a.reverse();g--;a.push(0));a.reverse()}0>n.length-c.length&&(a=c,c=n,n=a);g=c.length;for(a=0;g;)a=(n[--g]=n[g]+c[g]+a)/10|0,n[g]%=10;a&&(n.unshift(a),++b);for(g=n.length;0==n[--g];n.pop());f.jd=n;f.e=b;return f};e.prototype.pow=function(f){var a=this,g=new e(1),n=g,b=0>f;(f!==~~f||-1E6>f||1E6<f)&&c("!pow!");for(f=b?-f:f;;){f&1&&
(n=n.Wp(a));f>>=1;if(!f)break;a=a.Wp(a)}return b?g.VB(n):n};e.prototype.round=function(f,a){var g=this;null==f?f=0:(f!==~~f||0>f||1E6<f)&&c("!round!");b(g=new e(g),f,null==a?e.ye:a);return g};e.prototype.sqrt=function(){var f,a,g;a=this.jd;f=this.Dd;g=this.e;var d=new e("0.5");if(!a[0])return new e(this);0>f&&c(NaN);f=Math.sqrt(this.toString());0==f||f==1/0?(f=a.join(""),f.length+g&1||(f+="0"),a=new e(Math.sqrt(f).toString()),a.e=((g+1)/2|0)-(0>g||g&1)):a=new e(f.toString());f=a.e+(e.Cc+=4);do g=
a,a=d.Wp(g.NE(this.VB(g)));while(g.jd.slice(0,f).join("")!==a.jd.slice(0,f).join(""));b(a,e.Cc-=4,e.ye);return a};e.prototype.Wp=function(f){var a,g=this.jd,n=(f=new e(f)).jd,b=g.length,c=n.length,d=this.e,z=f.e;f.Dd=this.Dd==f.Dd?1:-1;if(!g[0]||!n[0])return new e(0*f.Dd);f.e=d+z;b<c&&(a=g,g=n,n=a,z=b,b=c,c=z);for(a=Array(z=b+c);z--;a[z]=0);for(d=c;d--;){c=0;for(z=b+d;z>d;)c=a[z]+n[d]*g[z-d-1]+c,a[z--]=c%10,c=c/10|0;a[z]=(a[z]+c)%10}c&&++f.e;a[0]||a.shift();for(d=a.length;!a[--d];a.pop());f.jd=a;
return f};e.prototype.toString=function(){var e=this.e,f=this.jd.join(""),a=f.length;if(-7>=e||21<=e)f=f.charAt(0)+(1<a?"."+f.slice(1):"")+(0>e?"e":"e+")+e;else if(0>e){for(;++e;f="0"+f);f="0."+f}else if(0<e)if(++e>a)for(e-=a;e--;f+="0");else e<a&&(f=f.slice(0,e)+"."+f.slice(e));else 1<a&&(f=f.charAt(0)+"."+f.slice(1));return 0>this.Dd&&this.jd[0]?"-"+f:f};e.Cc=20;e.ye=1;return e}();a.Tn=e})(E||(E={}));(function(a){var b=function(){function g(e){this.$e=e}g.prototype.Zp=function(e,f,g){var n=new a.b,
b=new a.b,c=this.$e;g.xd(e,f,function(e,f){c.ec(2*e,n);c.ec(2*f,b);return n.compare(b)})};g.prototype.Mo=function(e){return this.$e.read(2*e+1)};return g}(),c=function(){function g(){}g.No=function(e){if(e.s())return!1;var f=e.D();return 1736==f?0==e.Mh()?!1:!0:1607==f?(f=[!1],g.qz(e,!0,f),f[0]):197==f||a.T.Lc(f)&&!e.kD()?!0:!1};g.il=function(e){var f=e.D();if(1736==f)return f=new a.Xa(e.description),e.s()||e.tA(f),f;if(1607==f)return g.qz(e,!1,null);if(197==f)return f=new a.Xa(e.description),e.s()||
f.Wc(e,!1),f;if(a.T.Lc(f)){f=new a.pe(e.description);if(!e.s()&&!e.kD()){var n=new a.Va;e.En(n);f.add(n);e.Bn(n);f.add(n)}return f}if(a.T.Km(f))return null;throw a.g.N();};g.qz=function(e,f,g){null!=g&&(g[0]=!1);var n=null;f||(n=new a.pe(e.description));if(!e.s()){var c=new a.ga(0);c.xb(2*e.ea());for(var d=0,z=e.ea();d<z;d++)if(0<e.Ha(d)&&!e.Oo(d)){var m=e.Ea(d);c.add(m);m=e.Dc(d)-1;c.add(m)}if(0<c.size){z=new a.Rr;d=e.mc(0);z.sort(c,0,c.size,new b(d));z=new a.b;d.ec(2*c.get(0),z);for(var m=0,k=1,
h=new a.Va,q=new a.b,l=1,v=c.size;l<v;l++)if(d.ec(2*c.get(l),q),q.ub(z))c.get(m)>c.get(l)?(c.set(m,2147483647),m=l):c.set(l,2147483647),k++;else{if(0==(k&1))c.set(m,2147483647);else if(f)return null!=g&&(g[0]=!0),null;z.J(q);m=l;k=1}if(0==(k&1))c.set(m,2147483647);else if(f)return null!=g&&(g[0]=!0),null;if(!f)for(c.xd(0,c.size,function(e,f){return e-f}),l=0,v=c.size;l<v&&2147483647!=c.get(l);l++)e.Sd(c.get(l),h),n.add(h)}}return f?null:n};return g}();a.Hh=c})(E||(E={}));(function(a){var b=function(){function b(){this.lf=
new a.ga(0);this.Lq=new a.ga(0);this.gE=1;this.Qq=NaN}b.prototype.sort=function(a,e,f,n){if(32>f-e)n.Zp(e,f,a);else{var g=!0;try{for(var b=Infinity,c=-Infinity,d=e;d<f;d++){var z=n.Mo(a.get(d));z<b&&(b=z);z>c&&(c=z)}if(this.reset(f-e,b,c,f-e)){for(d=e;d<f;d++){var m=a.get(d),z=n.Mo(m),k=this.oC(z);this.lf.set(k,this.lf.get(k)+1);this.Lq.write(d-e,m)}var h=this.lf.get(0);this.lf.set(0,0);for(var d=1,q=this.lf.size;d<q;d++){var l=this.lf.get(d);this.lf.set(d,h);h+=l}for(d=e;d<f;d++){var m=this.Lq.read(d-
e),z=n.Mo(m),k=this.oC(z),v=this.lf.get(k);a.set(v+e,m);this.lf.set(k,v+1)}g=!1}}catch(ta){this.lf.resize(0),this.Lq.resize(0)}if(g)n.Zp(e,f,a);else{d=f=0;for(q=this.lf.size;d<q;d++)g=f,f=this.lf.get(d),f>g&&n.Zp(e+g,e+f,a);100<this.lf.size&&(this.lf.resize(0),this.Lq.resize(0))}}};b.prototype.reset=function(a,e,f,n){if(2>a||f==e)return!1;a=Math.min(b.tI,a);this.lf.xb(a);this.lf.resize(a);this.lf.dh(0,0,this.lf.size);this.gE=e;this.Lq.resize(n);this.Qq=(f-e)/(a-1);return!0};b.prototype.oC=function(g){return a.I.truncate((g-
this.gE)/this.Qq)};b.tI=65536;return b}();a.Rr=b})(E||(E={}));(function(a){var b;(function(e){e[e.enum_line=1]="enum_line";e[e.enum_arc=2]="enum_arc";e[e.enum_dummy=4]="enum_dummy";e[e.enum_concave_dip=8]="enum_concave_dip";e[e.enum_connection=3]="enum_connection"})(b||(b={}));var c=function(){function e(){}e.Ks=function(f,g,n,b,x,c){var d=new e;d.Fl=new a.b;d.Ql=new a.b;d.Lt=new a.b;d.Fl.J(f);d.Ql.J(g);d.Lt.J(n);d.qn=b;d.Rg=x;d.Ug=c;return d};e.Oa=function(f,g,n,b){var x=new e;x.Fl=new a.b;x.Ql=
new a.b;x.Lt=new a.b;x.Fl.J(f);x.Ql.J(g);x.Lt.Eh();x.qn=4;x.Rg=n;x.Ug=b;return x};return e}(),g=function(){function e(e,f,a,g,n,b){this.It=null;this.ua=0;this.Ex=e;this.yE=this.wE=0;this.Da=f;this.Pi=a;this.Cj=g;this.mp=n;this.Yb=b}e.prototype.next=function(){for(var e=new a.Va;;){if(this.ua==this.Ex.F())return null;this.Ex.Sd(this.ua,e);this.ua++;if(!e.s())break}var f=!1;null==this.It&&(this.wE=e.lk(),this.yE=e.mk(),this.It=n.buffer(e,this.Da,this.Pi,this.Cj,this.mp,this.Yb),f=!0);var g;this.ua<
this.Ex.F()?(g=new a.Ka,this.It.copyTo(g)):g=this.It;if(!f){var f=new a.Bg,b=e.lk()-this.wE,e=e.mk()-this.yE;f.Nn(b,e);g.Oe(f)}return g};e.prototype.ya=function(){return 0};return e}(),e=function(){function e(e,f){this.Ma=e;this.ua=0;this.Yo=f}e.prototype.next=function(){var e=this.Ma.U;if(this.ua<e.ea()){var f=this.ua;this.ua++;if(!e.Oo(f))for(var g=e.Fa(e.Dc(f)-1);this.ua<e.ea();){var n=e.Fa(e.Ea(this.ua));if(e.Oo(this.ua))break;if(n!=g)break;g=e.Fa(e.Dc(this.ua)-1);this.ua++}if(1==this.ua-f)return this.Ma.kB(this.Ma.U,
f,this.Yo);g=new a.Xa(this.Ma.U.description);g.Zj(this.Ma.U,f,!0);for(f+=1;f<this.ua;f++)g.ys(this.Ma.U,f,0,e.ct(f),!1);return this.Ma.kB(g,0,this.Yo)}return null};e.prototype.ya=function(){return 0};return e}(),f=function(){function e(e){this.Ma=e;this.ua=0}e.prototype.next=function(){var e=this.Ma.U;if(this.ua<e.ea()){var f=this.ua;e.oo(this.ua);for(this.ua++;this.ua<e.ea()&&!(0<e.oo(this.ua));)this.ua++;return 0==f&&this.ua==e.ea()?this.Ma.Gv(e,0,e.ea()):this.Ma.Gv(e,f,this.ua)}return null};e.prototype.ya=
function(){return 0};return e}(),n=function(){function n(e){this.Vq=this.Tt=this.Wq=this.sd=null;this.Jd=[];this.Yb=e;this.hb=this.wt=this.OP=this.Da=this.vx=this.jr=this.ka=0;this.sx=this.Cj=-1;this.Yo=!0}n.buffer=function(e,f,g,b,x,c){if(null==e)throw a.g.N();if(0>b)throw a.g.N();if(e.s())return new a.Ka(e.description);var d=new a.i;e.dd(d);0<f&&d.P(f,f);c=new n(c);c.Pi=g;c.U=e;c.ka=a.Ia.zd(g,d,!0);c.jr=a.Ia.zd(null,d,!0);c.Da=f;c.OP=e.D();0>=x&&(x=96);c.hb=Math.abs(c.Da);c.wt=0!=c.hb?1/c.hb:0;
isNaN(b)||0==b?b=1E-5*c.hb:b>.5*c.hb&&(b=.5*c.hb);12>x&&(x=12);e=Math.abs(f)*(1-Math.cos(Math.PI/x));e>b?b=e:(e=Math.PI/Math.acos(1-b/Math.abs(f)),e<x-1&&(x=a.I.truncate(e),12>x&&(x=12,b=Math.abs(f)*(1-Math.cos(Math.PI/x)))));c.Cj=b;c.mp=x;c.vx=Math.min(c.jr,.25*b);return c.lB()};n.prototype.Ss=function(){if(null==this.sd)this.sd=[];else if(0!==this.sd.length)return;var e=this.pB(),e=a.I.truncate((e+3)/4),f=.5*Math.PI/e;this.sx=f;for(var g=0;g<4*e;g++)this.sd.push(null);for(var n=Math.cos(f),f=Math.sin(f),
b=a.b.Oa(0,1),g=0;g<e;g++)this.sd[g+0*e]=a.b.Oa(b.y,-b.x),this.sd[g+1*e]=a.b.Oa(-b.x,-b.y),this.sd[g+2*e]=a.b.Oa(-b.y,b.x),this.sd[g+3*e]=b,b=a.b.Oa(b.x,b.y),b.Er(n,f)};n.prototype.lB=function(){var e=this.U.D();if(a.T.Lc(e))return e=new a.Xa(this.U.description),e.Bc(this.U,!0),this.U=e,this.lB();if(this.Da<=this.ka)if(a.T.SO(e)){if(0>=this.Da&&(e=new a.i,this.U.o(e),e.aa()<=2*-this.Da||e.ba()<=2*this.Da))return new a.Ka(this.U.description)}else return new a.Ka(this.U.description);switch(this.U.D()){case 33:return this.tK();
case 550:return this.sK();case 1607:return this.vK();case 1736:return this.uK();case 197:return this.qK();default:throw a.g.wa();}};n.prototype.vK=function(){if(this.oD(this.U)){var f=new a.Va;this.U.Sd(0,f);var g=new a.i;this.U.o(g);f.ic(g.Af());return this.Es(f)}this.U=this.SQ(this.U);f=new e(this,this.Yo);return a.wi.local().$(f,this.Pi,this.Yb).next()};n.prototype.uK=function(){if(0==this.Da)return this.U;var e=a.as.local();this.Ss();this.U=e.$(this.U,null,!1,this.Yb);if(0>this.Da){var g=this.U,
g=this.Gv(g,0,g.ea());return e.$(g,this.Pi,!1,this.Yb)}if(this.oD(this.U))return e=new a.Va,this.U.Sd(0,e),g=new a.i,this.U.o(g),e.ic(g.Af()),this.Es(e);e=new f(this);return a.wi.local().$(e,this.Pi,this.Yb).next()};n.prototype.Gv=function(e,f,g){for(var b=new a.Ka(e.description);f<g;f++)if(!(1>e.Ha(f))){var x=e.oo(f),c=new a.i;e.Ti(f,c);if(0<this.Da)if(0<x)if(this.pD(e,f))x=new a.Va,e.Sd(e.Ea(f),x),x.ic(c.Af()),this.us(b,x);else{var d=x=new a.Xa(e.description),d=a.Tr.sD(this.U,f)||2==this.sm(this.U,
f,d,!0,1)?this.jB(e,f):this.rm(x);b.add(d,!1)}else{if(!(c.aa()+this.ka<=2*this.hb||c.ba()+this.ka<=2*this.hb||(d=x=new a.Xa(e.description),this.sm(this.U,f,d,!0,1),x.s()))){var I=new a.i;I.K(c);I.P(this.hb,this.hb);d.ws(I);d=this.rm(x);c=1;for(x=d.ea();c<x;c++)b.Zj(d,c,!0)}}else if(0<x){if(!(c.aa()+this.ka<=2*this.hb||c.ba()+this.ka<=2*this.hb||(d=x=new a.Xa(e.description),this.sm(this.U,f,d,!0,-1),x.s())))for(I=new a.i,d.dd(I),I.P(this.hb,this.hb),d.ws(I),d=this.rm(x),c=1,x=d.ea();c<x;c++)b.Zj(d,
c,!0)}else for(d=x=new a.Xa(e.description),this.sm(this.U,f,d,!0,-1),d=this.rm(x),c=0,x=d.ea();c<x;c++)b.Zj(d,c,!0)}if(0<this.Da)return 1<b.ea()?b=this.rm(b):n.Id(b);e=new a.i;b.dd(e);if(b.s())return n.Id(b);e.P(this.hb,this.hb);b.ws(e);b=this.rm(b);e=new a.Ka(b.description);c=1;for(x=b.ea();c<x;c++)e.Zj(b,c,!1);return n.Id(e)};n.prototype.tK=function(){return this.Es(this.U)};n.prototype.Es=function(e){var f=new a.Ka(this.U.description);this.us(f,e);return this.nS(f)};n.prototype.sK=function(){var e=
new g(this.U,this.Da,this.Pi,this.Cj,this.mp,this.Yb);return a.wi.local().$(e,this.Pi,this.Yb).next()};n.prototype.qK=function(){var e=new a.Ka(this.U.description);if(0>=this.Da){if(0==this.Da)e.Wc(this.U,!1);else{var f=new a.Vj;this.U.Fp(f);f.P(this.Da,this.Da);e.Wc(f,!1)}return e}e.Wc(this.U,!1);this.U=e;return this.jB(e,0)};n.prototype.jB=function(e,f){this.Ss();var g=new a.Ka(e.description),b=new a.b,x=new a.b,c=new a.b,d=new a.b,I=new a.b,z=new a.b,m=new a.b,L=new a.b,k=e.Ha(f),h=e.Ea(f),q=0;
for(f=e.Ha(f);q<f;q++){e.w(h+q,x);e.w(h+(q+1)%k,d);e.w(h+(q+2)%k,z);m.pc(d,x);if(0==m.length())throw a.g.wa();m.tt();m.normalize();m.scale(this.hb);b.add(m,x);c.add(m,d);0==q?g.Nr(b):g.Lm(b);g.Lm(c);L.pc(z,d);if(0==L.length())throw a.g.wa();L.tt();L.normalize();L.scale(this.hb);I.add(L,d);this.NA(g,d,c,I,!1)}return n.Id(g)};n.prototype.kB=function(e,f,g){this.Ss();if(1>e.Ha(f))return null;if(this.pD(e,f)&&0<this.Da){g=new a.Va;e.Sd(e.Ea(f),g);var n=new a.i;e.Ti(f,n);g.ic(n.Af());return this.Es(g)}n=
new a.Xa(e.description);if(e.Oo(f))this.sm(e,f,n,g,1),this.sm(e,f,n,g,-1);else{var b=new a.Xa(e.description);b.Zj(e,f,!1);b.ys(e,f,0,e.ct(f),!1);this.sm(b,0,n,g,1)}return this.rm(n)};n.prototype.rm=function(e){return a.Of.Qj(e,this.jr,!0,!0,this.Yb)};n.prototype.pB=function(){if(0==this.Cj)return this.mp;var e=1-this.Cj*Math.abs(this.wt),f;-1>e?f=4:f=2*Math.PI/Math.acos(e)+.5;4>f?f=4:f>this.mp&&(f=this.mp);return a.I.truncate(f)};n.prototype.NA=function(e,f,g,n,b){this.Ss();var x=new a.b;x.pc(g,f);
x.scale(this.wt);var c=new a.b;c.pc(n,f);c.scale(this.wt);x=Math.atan2(x.y,x.x)/this.sx;0>x&&(x=this.sd.length+x);x=this.sd.length-x;c=Math.atan2(c.y,c.x)/this.sx;0>c&&(c=this.sd.length+c);c=this.sd.length-c;c<x&&(c+=this.sd.length);var d=a.I.truncate(c),c=a.I.truncate(Math.ceil(x)),x=new a.b;x.J(this.sd[c%this.sd.length]);x.Fr(this.hb,f);var I=10*this.ka;x.sub(g);x.length()<I&&(c+=1);x.J(this.sd[d%this.sd.length]);x.Fr(this.hb,f);x.sub(n);x.length()<I&&--d;g=d-c;g++;d=0;for(c%=this.sd.length;d<g;d++,
c=(c+1)%this.sd.length)x.J(this.sd[c]),x.Fr(this.hb,f),e.Lm(x);b&&e.Lm(n)};n.prototype.sm=function(e,f,g,n,b){var x=new a.fd,d=x.QJ(e,f);x.xo(this.vx,!1,!1);if(2>x.F(d)){if(0>b)return 1;b=e;x=new a.Va;b.Sd(b.Ea(f),x);this.us(g,x);return 1}var z=x.Fa(x.Cb(x.Vb(d))),I=new a.Bg;I.Nn(-z.x,-z.y);x.Oe(I);if(n&&(this.MM(x,d,b),2>x.F(d))){if(0>b)return 1;b=e;x=new a.Va;b.Sd(b.Ea(f),x);this.us(g,x);return 1}this.Jd.length=0;var m=x.Vb(d);f=x.Cb(m);var k=1==b?x.Ua(f):x.X(f);e=1==b?x.X(f):x.Ua(f);var L=!0;n=
new a.b;for(var d=new a.b,h=new a.b,q=new a.b,l=new a.b,P=new a.b,v=new a.b,y=new a.b,t=new a.b,Y=new a.b,r=this.hb,m=x.Ha(m),B=0;B<m;B++)x.w(e,d),L&&(x.w(f,n),x.w(k,h),y.pc(n,h),y.normalize(),Y.zD(y),Y.scale(r),q.add(Y,n)),v.pc(d,n),v.normalize(),t.zD(v),t.scale(r),l.add(n,t),k=y.Ai(v),L=y.ml(v),0>k||0>L&&0==k?this.Jd.push(c.Ks(q,l,n,2,this.Jd.length+1,this.Jd.length-1)):q.ub(l)||(this.Jd.push(c.Oa(q,n,this.Jd.length+1,this.Jd.length-1,"dummy")),this.Jd.push(c.Oa(n,l,this.Jd.length+1,this.Jd.length-
1,"dummy"))),P.add(d,t),this.Jd.push(c.Ks(l,P,n,1,this.Jd.length+1,this.Jd.length-1)),q.J(P),Y.J(t),h.J(n),n.J(d),y.J(v),k=f,f=e,L=!1,e=1==b?x.X(f):x.Ua(f);this.Jd[this.Jd.length-1].Rg=0;this.Jd[0].Ug=this.Jd.length-1;this.UQ(g);I.Nn(z.x,z.y);g.ZA(I,g.ea()-1);return 1};n.prototype.UQ=function(e){for(var f=this.aL(),a=!0,g=f+1,n=f;g!=f;n=g){var b=this.Jd[n],g=-1!=b.Rg?b.Rg:(n+1)%this.Jd.length;0!=b.qn&&(a&&e.Nr(b.Fl),2==b.qn?this.NA(e,b.Lt,b.Fl,b.Ql,!0):e.Lm(b.Ql),a=!1)}};n.prototype.aL=function(){null==
this.Vq&&(this.Vq=[null,null,null,null,null,null,null,null,null]);for(var e=0,f=0,g=this.Jd.length;f<g;){var n=this.Jd[f];if(0!=(n.qn&3)){e=f;break}f=n.Rg}g=e+1;for(f=e;g!=e;f=g){for(var n=this.Jd[f],g=n.Rg,b=1,x=null;g!=f;){x=this.Jd[g];if(0!=(x.qn&3))break;g=x.Rg;b++}1!=b&&1==(n.qn&x.qn)&&(null==this.Wq&&(this.Wq=new a.yb,this.Tt=new a.yb),this.Wq.ed(n.Fl),this.Wq.vd(n.Ql),this.Tt.ed(x.Fl),this.Tt.vd(x.Ql),1==this.Wq.Ga(this.Tt,this.Vq,null,null,this.jr)&&(n.Ql.J(this.Vq[0]),x.Fl.J(this.Vq[0]),
n.Rg=g,x.Ug=f))}return e};n.prototype.rt=function(e,f,g){var n=new a.b;n.pc(g,e);g=n.length();g=this.hb*this.hb-g*g*.25;if(0<g){g=Math.sqrt(g);n.normalize();n.Kp();var b=new a.b;b.pc(f,e);if(b.ml(n)+g>=this.hb)return!0}return!1};n.prototype.MM=function(e,f,g){for(var n=0;1>n;n++){var b=!1,x=e.Vb(f),c=e.Ha(x);if(0==c)break;var d=c;if(3>c)break;!e.vc(x)&&(d=c-1);for(var x=e.Cb(x),c=0<g?e.Ua(x):e.X(x),z=0<g?e.X(x):e.Ua(x),I=c,m=!0,k=new a.b,L=new a.b,h=new a.b,q=new a.b,l=new a.b,P=a.b.Oa(0,0),v=new a.b,
y=new a.b,t=new a.b,r=new a.b,B=this.hb,E=0,u=0;u<d;){e.w(z,L);m&&(e.w(x,k),e.w(c,h),I=c);y.pc(k,h);y.normalize();v.pc(L,k);v.normalize();if(I==z)break;var C=y.Ai(v),O=y.ml(v),D=!0;0>C||0>O&&0==C||!this.rt(h,k,L)||(P.J(L),D=!1,++E,b=!0);if(D){if(0<E)for(;;){C=0<g?e.Ua(I):e.X(I);if(C==x)break;e.w(C,q);if(this.rt(q,h,P))h.J(q),I=C,D=!1,++E;else{C!=z&&this.rt(q,h,L)&&this.rt(q,k,L)&&(h.J(q),I=C,D=!1,++E);break}}if(!D)continue;if(0<E){I=0<g?e.Ua(c):e.X(c);for(m=1;m<E;m++)D=0<g?e.Ua(I):e.X(I),e.vf(I,!0),
I=D;t.pc(k,h);E=t.length();E=B*B-E*E*.25;E=Math.sqrt(E);B-E>.5*this.Cj?(l.add(h,k),l.scale(.5),t.normalize(),t.Kp(),r.J(t),r.scale(B-E),l.add(r),e.Yi(c,l)):e.vf(c,!0);E=0}h.J(k);I=x}k.J(L);c=x;x=z;z=0<g?e.X(x):e.Ua(x);u++;m=!1}if(0<E){I=0<g?e.Ua(c):e.X(c);for(m=1;m<E;m++)D=0<g?e.Ua(I):e.X(I),e.vf(I,!0),I=D;l.add(h,k);l.scale(.5);t.pc(k,h);E=t.length();E=B*B-E*E*.25;E=Math.sqrt(E);t.normalize();t.Kp();r.J(t);r.scale(B-E);l.add(r);e.Yi(c,l)}e.xo(this.vx,!1,!1);if(!b)break}};n.prototype.pD=function(e,
f){if(1==e.Ha(f))return!0;var g=new a.i;e.Ti(f,g);return Math.max(g.aa(),g.ba())<.5*this.Cj?!0:!1};n.prototype.oD=function(e){var f=new a.i;e.o(f);return Math.max(f.aa(),f.ba())<.5*this.Cj?!0:!1};n.prototype.SQ=function(e){e=a.Sz.local().$(e,.25*this.Cj,!1,this.Yb);for(var f=0,g=0,n=e.ea();g<n;g++)f=Math.max(e.Ha(g),f);if(32>f)return this.Yo=!1,e;this.Yo=!0;return a.Of.Qj(e,this.jr,!1,!0,this.Yb)};n.prototype.us=function(e,f){f=f.w();if(null!=this.sd&&0!==this.sd.length){var g=new a.b;g.J(this.sd[0]);
g.Fr(this.hb,f);e.Nr(g);for(var n=1,b=this.sd.length;n<b;n++)g.J(this.sd[n]),g.Fr(this.hb,f),e.Lm(g)}else for(var n=this.pB(),g=a.I.truncate((n+3)/4),n=.5*Math.PI/g,b=Math.cos(n),x=Math.sin(n),c=new a.b,d=3;0<=d;d--)switch(c.ma(0,this.hb),d){case 0:for(n=0;n<g;n++)e.wj(c.x+f.x,c.y+f.y),c.Er(b,x);break;case 1:for(n=0;n<g;n++)e.wj(-c.y+f.x,c.x+f.y),c.Er(b,x);break;case 2:for(n=0;n<g;n++)e.wj(-c.x+f.x,-c.y+f.y),c.Er(b,x);break;default:for(e.Uy(c.y+f.x,-c.x+f.y),n=1;n<g;n++)c.Er(b,x),e.wj(c.y+f.x,-c.x+
f.y)}};n.Id=function(e){e.hg(1,0);return e};n.prototype.nS=function(e){e.hg(2,this.ka);e.hl();return e};return n}();a.UG=n})(E||(E={}));(function(a){var b=function(){function b(g){this.Qb=g;this.a=new a.fd;this.vg=new a.ga(0)}b.prototype.po=function(a,e,f){switch(e){case 0:if(a.v<f&&a.B<=f)break;else return a.v>=f?1:-1;case 1:if(a.C<f&&a.G<=f)break;else return a.C>=f?1:-1;case 2:if(a.v>=f&&a.B>f)break;else return a.B<=f?1:-1;case 3:if(!(a.C>=f&&a.G>f))return a.G<=f?1:-1}return 0};b.prototype.cL=function(a,
e){return 1736==a.D()?this.dL(a,e):this.eL(a)};b.prototype.dL=function(g,e){if(0==this.Qb.aa()||0==this.Qb.ba())return g.Pa();var f=new a.i;g.dd(f);this.U=this.a.Eb(g);var n=new a.i,b=new a.i,c=new a.b,d=new a.b,z=[0,0,0,0,0,0,0,0,0],m=[0,0,0,0,0,0,0,0,0];new a.Ag;var k=new a.yb,h=new a.ga(0);h.xb(Math.min(100,g.F()));for(var q=!1,l=0;!q&&4>l;l++){var v=!1,y=0!=(l&1),t=0;switch(l){case 0:t=this.Qb.v;v=f.v<=t&&f.B>=t;break;case 1:t=this.Qb.C;v=f.C<=t&&f.G>=t;break;case 2:t=this.Qb.B;v=f.v<=t&&f.B>=
t;break;case 3:t=this.Qb.G,v=f.C<=t&&f.G>=t}if(v)for(q=!0,v=this.a.Vb(this.U);-1!=v;){var r=-1,B=-1,E=this.a.Cb(v),u=E;do{var C=this.a.cc(u);null==C&&(C=k,this.a.w(u,c),C.ed(c),this.a.w(this.a.X(u),d),C.vd(d));C.o(n);var D=this.po(n,l,t),O=0,G=-1;if(-1==D){C=C.nt(y,t,z,m);0<C?O=this.a.Mr(u,m,C):O=0;for(var O=O+1,J=u,p=this.a.X(J),C=0;C<O;C++){this.a.w(J,c);this.a.w(p,d);G=this.a.cc(J);null==G&&(G=k,G.ed(c),G.vd(d));G.o(b);G=this.po(b,l,t);if(-1==G){if(y)G=Math.abs(c.y-t),w=Math.abs(d.y-t),G<w?(c.y=
t,this.a.Yi(J,c)):(d.y=t,this.a.Yi(p,d));else{var G=Math.abs(c.x-t),w=Math.abs(d.x-t);G<w?(c.x=t,this.a.Yi(J,c)):(d.x=t,this.a.Yi(p,d))}G=this.a.cc(J);null==G&&(G=k,G.ed(c),G.vd(d));G.o(b);G=this.po(b,l,t)}w=r;r=G;-1==B&&(B=r);if(0!=w||1!=r)1==w&&0==r||0!=w||0!=r||h.add(J);1==r&&(q=!1);G=J=p;p=this.a.X(p)}}if(0==O){w=r;r=D;-1==B&&(B=r);if(0!=w||1!=r)1==w&&0==r||0!=w||0!=r||h.add(u);1==r&&(q=!1);G=this.a.X(u)}u=G}while(u!=E);0==B&&0==r&&h.add(E);C=0;for(r=h.size;C<r;C++)B=h.get(C),this.a.vf(B,!1);
h.clear(!1);v=3>this.a.Ha(v)?this.a.Cr(v):this.a.bc(v)}}if(q)return g.Pa();this.AR();0<e&&this.gM(e);return this.a.hf(this.U)};b.prototype.eL=function(g){var e=new a.i,f=new a.i,n=[0,0,0,0,0,0,0,0,0],b=[0,0,0,0,0,0,0,0,0],c=new a.Ag,d=g,z=new a.i;g.dd(z);for(var m=0;4>m;m++){var k=!1,h=0!=(m&1),q=0;switch(m){case 0:q=this.Qb.v;k=z.v<=q&&z.B>=q;break;case 1:q=this.Qb.C;k=z.C<=q&&z.G>=q;break;case 2:q=this.Qb.B;k=z.v<=q&&z.B>=q;break;case 3:q=this.Qb.G,k=z.C<=q&&z.G>=q}if(k){k=d;d=g.Pa();k=k.Ca();k.Lk();
for(var l,v=new a.b;k.kb();)for(var y,t=!0;k.La();){var r=k.ia();r.o(e);var B=this.po(e,m,q);if(-1==B){if(B=r.nt(h,q,n,b),0<B){var E=0;l=r.Mb();for(var u=0;u<=B;u++)if(y=u<B?b[u]:1,E!=y){r.Bi(E,y,c);var C=c.get();C.ed(l);u<B&&(h?(v.x=n[u],v.y=q):(v.x=q,v.y=n[u]),C.vd(v));C.o(f);var D=this.po(f,m,q);if(-1==D){l=C.Mb();E=C.oc();if(h)D=Math.abs(l.y-q),O=Math.abs(E.y-q),D<O?(l.y=q,C.ed(l)):(E.y=q,C.vd(E));else{var D=Math.abs(l.x-q),O=Math.abs(E.x-q);D<O?(l.x=q,C.ed(l)):(E.x=q,C.vd(E))}C.o(f);D=this.po(f,
m,q)}l=C.oc();E=y;y=D;1==y?(d.Bc(C,t),t=!1):t=!0}}}else y=B,1==y?(d.Bc(r,t),t=!1):t=!0}}}return d};b.prototype.AR=function(){this.vn=-1;this.Nu(!1,this.Qb.v);this.Nu(!1,this.Qb.B);this.Nu(!0,this.Qb.C);this.Nu(!0,this.Qb.G);this.vg.resize(0);this.vg.xb(100);this.vn=this.a.re();for(var g=new a.b,e=this.a.Vb(this.U);-1!=e;e=this.a.bc(e))for(var f=this.a.Cb(e),n=0,b=this.a.Ha(e);n<b;n++,f=this.a.X(f))if(this.a.w(f,g),this.Qb.v==g.x||this.Qb.B==g.x||this.Qb.C==g.y||this.Qb.G==g.y)this.a.lb(f,this.vn,
this.vg.size),this.vg.add(f);this.zu(!1,this.Qb.v);this.zu(!1,this.Qb.B);this.zu(!0,this.Qb.C);this.zu(!0,this.Qb.G);this.WM()};b.prototype.gM=function(g){for(var e=new a.b,f=new a.b,n=a.I.Lh(2048,0),b=this.a.Vb(this.U);-1!=b;b=this.a.bc(b)){var c=this.a.Cb(b),d=c;do{var z=this.a.X(d);this.a.w(d,e);var m=-1;e.x==this.Qb.v?(this.a.w(z,f),f.x==this.Qb.v&&(m=1)):e.x==this.Qb.B&&(this.a.w(z,f),f.x==this.Qb.B&&(m=1));e.y==this.Qb.C?(this.a.w(z,f),f.y==this.Qb.C&&(m=0)):e.y==this.Qb.G&&(this.a.w(z,f),f.y==
this.Qb.G&&(m=0));if(-1!=m&&(m=a.b.Fb(e,f),m=a.I.truncate(Math.min(Math.ceil(m/g),2048)),!(1>=m))){for(var k=1;k<m;k++)n[k-1]=1*k/m;this.a.Mr(d,n,m-1)}d=z}while(d!=c)}};b.prototype.Nu=function(g,e){var f=this.a.re(),n=new a.b,b=new a.ga(0);b.xb(100);for(var c=this.a.Vb(this.U);-1!=c;c=this.a.bc(c))for(var d=this.a.Cb(c),z=0,m=this.a.Ha(c);z<m;z++){var k=this.a.X(d);this.a.w(d,n);if(g?n.y==e:n.x==e)if(this.a.w(k,n),g?n.y==e:n.x==e)1!=this.a.Ra(d,f)&&(b.add(d),this.a.lb(d,f,1)),1!=this.a.Ra(k,f)&&(b.add(k),
this.a.lb(k,f,1));d=k}this.a.bf(f);if(!(3>b.size)){var h=this;b.xd(0,b.size,function(e,f){return h.kj(e,f)});f=new a.b;c=new a.b;d=new a.b;c.Eh();for(var q=-1,z=new a.ga(0),m=new a.ga(0),k=this.a.re(),l=this.a.re(),v=0,y=b.size;v<y;v++){var t=b.get(v);this.a.w(t,n);if(!n.ub(c)){if(-1!=q){for(var r=q;r<v;r++){var q=b.get(r),B=this.a.X(q),t=this.a.Ua(q),E=!1;0>this.kj(q,B)&&(this.a.w(B,f),g?f.y==e:f.x==e)&&(z.add(q),E=!0,this.a.lb(q,l,1));0>this.kj(q,t)&&(this.a.w(t,f),g?f.y==e:f.x==e)&&(E||z.add(q),
this.a.lb(q,k,1))}r=0;for(E=z.size;r<E;r++){q=z.get(r);t=this.a.Ra(q,k);B=this.a.Ra(q,l);if(1==t){t=this.a.Ua(q);this.a.w(t,d);var u=[0];u[0]=0;if(!d.ub(n)){var C=a.b.Fb(c,d);u[0]=a.b.Fb(d,n)/C;0==u[0]?u[0]=2.220446049250313E-16:1==u[0]&&(u[0]=.9999999999999998);this.a.Mr(t,u,1);t=this.a.Ua(q);this.a.Yi(t,n);m.add(t);this.a.lb(t,k,1);this.a.lb(t,l,-1)}}1==B&&(B=this.a.X(q),this.a.w(B,d),u=[0],u[0]=0,d.ub(n)||(C=a.b.Fb(c,d),u[0]=a.b.Fb(c,n)/C,0==u[0]?u[0]=2.220446049250313E-16:1==u[0]&&(u[0]=.9999999999999998),
this.a.Mr(q,u,1),t=this.a.X(q),this.a.Yi(t,n),m.add(t),this.a.lb(t,k,-1),this.a.lb(t,l,1)))}q=z;z=m;m=q;m.clear(!1)}q=v;c.J(n)}}this.a.bf(k);this.a.bf(l)}};b.prototype.zu=function(g,e){var f=new a.b,n=new a.ga(0);n.xb(100);for(var b=this.a.re(),c=0,d=this.vg.size;c<d;c++){var z=this.vg.get(c);if(-1!=z){var m=this.a.X(z);this.a.w(z,f);if(g?f.y==e:f.x==e)if(this.a.w(m,f),g?f.y==e:f.x==e)-2!=this.a.Ra(z,b)&&(n.add(z),this.a.lb(z,b,-2)),-2!=this.a.Ra(m,b)&&(n.add(m),this.a.lb(m,b,-2))}}if(0!=n.size){var k=
this;n.xd(0,n.size,function(e,f){return k.kj(e,f)});c=0;for(d=n.size;c<d;c++){var h=n.get(c);this.a.lb(h,b,c)}z=new a.b;m=new a.b;m.Eh();for(var q=-1,c=0,d=n.size;c<d;c++)if(h=n.get(c),-1!=h&&(this.a.w(h,f),!f.ub(m))){if(-1!=q)for(;;){for(var h=!1,l=1<c-q?c-1:c,v=q;v<l;v++){var t=n.get(v);if(-1!=t){var y=-1,r=this.a.X(t);0>this.kj(t,r)&&(this.a.w(r,z),g?z.y==e:z.x==e)&&(y=r);var r=-1,B=this.a.Ua(t);0>this.kj(t,B)&&(this.a.w(B,z),g?z.y==e:z.x==e)&&(r=B);if(-1!=y&&-1!=r)this.no(t,n,b),this.a.vf(t,!1),
this.no(y,n,b),this.a.vf(y,!1),h=!0;else if(-1!=y||-1!=r){for(B=v+1;B<c;B++){var E=n.get(B);if(-1!=E){var u=this.a.X(E),C=-1;0>this.kj(E,u)&&(this.a.w(u,z),g?z.y==e:z.x==e)&&(C=u);var u=this.a.Ua(E),D=-1;0>this.kj(E,u)&&(this.a.w(u,z),g?z.y==e:z.x==e)&&(D=u);if(-1!=C&&-1!=D){this.no(E,n,b);this.a.vf(E,!1);this.no(C,n,b);this.a.vf(C,!1);h=!0;break}if(-1!=y&&-1!=D){this.dF(n,t,y,E,D,b);h=!0;break}else if(-1!=r&&-1!=C){this.dF(n,E,C,t,r,b);h=!0;break}}}if(h)break}}}if(!h)break}q=c;m.J(f)}}this.a.bf(b)};
b.prototype.no=function(a,e,f){f=this.a.Ra(a,f);e.set(f,-1);f=this.a.Ra(a,this.vn);this.vg.set(f,-1);e=this.a.rd(a);-1!=e&&this.a.Cb(e)==a&&(this.a.Dh(e,-1),this.a.Wi(e,-1))};b.prototype.dF=function(a,e,f,n,b,c){this.a.Sc(e,n);this.a.Tc(n,e);this.a.Tc(f,b);this.a.Sc(b,f);this.no(n,a,c);this.a.Ui(n,!1);this.no(b,a,c);this.a.Ui(b,!0)};b.prototype.WM=function(){for(var a=0,e=this.vg.size;a<e;a++){var f=this.vg.get(a);-1!=f&&this.a.im(f,-1)}for(var n=0,b=0,c=this.a.Vb(this.U);-1!=c;){var d=this.a.Cb(c);
if(-1==d||c!=this.a.rd(d)){var z=c,c=this.a.bc(c);this.a.Dh(z,-1);this.a.yu(z)}else{f=d;z=0;do this.a.im(f,c),z++,f=this.a.X(f);while(f!=d);2>=z?(f=this.a.Ra(d,this.vn),this.vg.set(f,-1),d=this.a.vf(d,!1),2==z&&(f=this.a.Ra(d,this.vn),this.vg.set(f,-1),this.a.vf(d,!1)),z=c,c=this.a.bc(c),this.a.Dh(z,-1),this.a.yu(z)):(this.a.Jr(c,!1),this.a.Wi(c,this.a.Ua(d)),this.a.hm(c,z),b+=z,n++,c=this.a.bc(c))}}a=0;for(e=this.vg.size;a<e;a++)if(f=this.vg.get(a),-1!=f&&(c=this.a.rd(f),-1==c)){c=this.a.Cf(this.U,
-1);z=0;d=f;do this.a.im(f,c),z++,f=this.a.X(f);while(f!=d);2>=z?(f=this.a.Ra(d,this.vn),this.vg.set(f,-1),d=this.a.vf(d,!1),2==z&&(f=this.a.Ra(d,this.vn),0<=f&&this.vg.set(f,-1),this.a.vf(d,!1)),z=c,this.a.Dh(z,-1),this.a.yu(z)):(this.a.Gn(c,!0),this.a.hm(c,z),this.a.Dh(c,d),this.a.Wi(c,this.a.Ua(d)),this.a.Jr(c,!1),b+=z,n++)}this.a.gm(this.U,n);this.a.Pk(this.U,b);a=0;for(e=this.a.$c;-1!=e;e=this.a.we(e))a+=this.a.F(e);this.a.ZF(a)};b.Xk=function(a,e,f){return(new b(e)).cL(a,f)};b.clip=function(g,
e,f,n){if(g.s())return g;if(e.s())return g.Pa();f=g.D();if(33==f)return n=g.w(),e.contains(n)?g:g.Pa();if(197==f)return n=new a.i,g.o(n),n.Ga(e)?(e=new a.Vj,g.copyTo(e),e.Cu(n),e):g.Pa();var c=new a.i;g.dd(c);if(e.contains(c))return g;if(!e.jc(c))return g.Pa();c=g.pb;if(null!=c&&(c=c.hi,null!=c)){c=c.Dn(e);if(1==c){if(1736!=f)throw a.g.wa();g=new a.Ka(g.description);g.ws(e);return g}if(0==c)return g.Pa()}switch(f){case 550:f=null;for(var c=g.F(),d=g.mc(0),z=0,m=0;m<c;m++)n=new a.b,d.ec(2*m,n),e.contains(n)||
(0==z&&(f=g.Pa()),z<m&&f.Pd(g,z,m),z=m+1);0<z&&f.Pd(g,z,c);return 0==z?g:f;case 1736:case 1607:return b.Xk(g,e,n);default:throw a.g.wa();}};b.prototype.kj=function(g,e){var f=new a.b;this.a.w(g,f);g=new a.b;this.a.w(e,g);return f.compare(g)};return b}();a.Ed=b})(E||(E={}));(function(a){var b=new a.b,c=function(){function e(e,g,b,c,d){this.Ml=new a.b;this.ln=new a.b;this.Ck=new a.b;this.a=e;this.Px=b;this.bn=c;this.Ml=g;this.vk=d;this.ln.Eh();this.Ck.Eh()}e.prototype.sB=function(e){this.a.w(e,this.ln);
e=a.I.truncate((this.ln.x-this.Ml.x)*this.bn+.5);var f=a.I.truncate((this.ln.y-this.Ml.y)*this.bn+.5);return g.XC(e,f)};e.prototype.vw=function(e){return this.a.Ra(e,this.vk)};return e}();a.wT=function(){return function(){}}();var g=function(){function e(){this.Ml=new a.b;this.Zo=[0,0,0,0];this.Kq=[0,0,0,0];this.en=this.vk=-1}e.zM=function(f,a){var g=new e;g.a=f;g.ka=a;g.Px=a*a;g.Kt=2*a;g.bn=1/g.Kt;return g.fL()};e.Vw=function(e,a,g,b,c){e-=g;a-=b;return e*e+a*a<=c};e.XC=function(e,g){return a.I.kg(g,
a.I.kg(e))};e.prototype.hL=function(f,g){this.a.uc(f,b);for(var n=(b.y-this.Ml.y)*this.bn,c=a.I.truncate((b.x-this.Ml.x)*this.bn),d=a.I.truncate(n),z=n=0;1>=z;z+=1)for(var m=0;1>=m;m+=1){var k=e.XC(c+z,d+m),h=this.uk.DN(k);-1!=h&&(this.Zo[n]=h,this.Kq[n]=k,n++)}for(c=n-1;1<=c;c--)for(h=this.Zo[c],d=c-1;0<=d;d--)if(h==this.Zo[d]){this.Kq[d]=-1;n--;c!=n&&(this.Kq[c]=this.Kq[n],this.Zo[c]=this.Zo[n]);break}for(d=0;d<n;d++)this.iL(f,this.Kq[d],b,this.Zo[d],g)};e.prototype.iL=function(f,g,b,c,d){for(var n=
new a.b;-1!=c;c=this.uk.SN(c)){var x=this.uk.da(c);f==x||-1!=g&&this.a.Ra(x,this.vk)!=g||(this.a.uc(x,n),e.Vw(b.x,b.y,n.x,n.y,this.Px)&&d.add(c))}};e.prototype.Tl=function(e,a,g){var f=this.a.Ra(e,this.en),n=this.a.Ra(a,this.en);-1==f&&(f=this.nd.jh(),this.nd.addElement(f,e),this.a.lb(e,this.en,f));-1==n?this.nd.addElement(f,a):this.nd.Qv(f,n);this.a.lb(a,this.en,-2);a=this.aQ(e,a);g&&(g=this.St.sB(e),this.a.lb(e,this.vk,g));return a};e.$P=function(f,g,b){f.lc(g);b=f;var n=new a.b;e.HH(f.w(),g.w(),
n);b.ic(n)};e.HH=function(e,a,g){var f=e.x;e.x!=a.x&&(f=(1*e.x+1*a.x)/2);var n=e.y;e.y!=a.y&&(n=(1*e.y+1*a.y)/2);g.ma(f,n)};e.prototype.aQ=function(e,g){var f=new a.b;this.a.w(e,f);var n=new a.b;this.a.w(g,n);var b=this.a.RC(e);g=this.a.RC(g);var c=b+g,d=0,z=f.x;f.x!=n.x&&(z=(f.x*b+n.x*g)/c,d++);var m=f.y;f.y!=n.y&&(m=(f.y*b+n.y*g)/c,d++);0<d&&this.a.ic(e,z,m);this.a.pS(e,c);return 0!=d};e.prototype.fL=function(){var e=this.a.pd,g=this.a.wC();this.Ml=g.yw();g=Math.max(g.ba(),g.aa())/2147483646;this.Kt<
g&&(this.Kt=g,this.bn=1/this.Kt);this.nd=new a.Ur;this.nd.Dr(a.I.truncate(this.a.pd/3+1));this.nd.$l(a.I.truncate(this.a.pd/3+1));this.vk=this.a.re();this.en=this.a.re();this.St=new c(this.a,this.Ml,this.Px,this.bn,this.vk);this.uk=new a.AH(a.I.truncate(4*e/3),this.St);this.uk.wR(this.a.pd);e=!1;for(g=this.a.$c;-1!=g;g=this.a.we(g))for(var b=this.a.Vb(g);-1!=b;b=this.a.bc(b))for(var d=this.a.Cb(b),z=0,m=this.a.Ha(b);z<m;z++){var k=this.St.sB(d);this.a.lb(d,this.vk,k);this.uk.addElement(d,k);d=this.a.X(d)}var h=
new a.ga(0);h.xb(10);for(g=this.a.$c;-1!=g;g=this.a.we(g))for(b=this.a.Vb(g);-1!=b;b=this.a.bc(b))for(d=this.a.Cb(b),z=0,m=this.a.Ha(b);z<m;z++){if(-2!=this.a.Ra(d,this.en))for(k=this.a.Ra(d,this.vk),this.uk.Jc(d,k);;){this.hL(d,h);if(0==h.size)break;for(var k=!1,q=0,l=h.size;q<l;q++){var v=h.get(q),t=this.uk.da(v);this.uk.kd(v);k=this.Tl(d,t,q+1==l)||k}e=e||k;h.clear(!1);if(!k)break}d=this.a.X(d)}e&&this.ZJ();this.St=this.uk=null;this.a.bf(this.vk);this.a.bf(this.en);return e};e.prototype.ZJ=function(){for(var e=
new a.b,g=this.nd.Wd;-1!=g;g=this.nd.Cw(g)){var b=this.nd.gc(g);this.a.w(this.nd.da(b),e);for(b=this.nd.bb(b);-1!=b;b=this.nd.bb(b))this.a.Yi(this.nd.da(b),e)}};return e}();a.Sr=g})(E||(E={}));(function(a){var b=Math.PI,c=2*Math.PI,g=Math.PI/2,e=function(){function e(){}e.yL=function(f,a){var g=new e;g.x=f;g.y=a;g.type=0;g.mh=0;return g};e.um=function(f){var a=new e;a.x=f.x;a.y=f.y;a.type=0;a.mh=0;return a};e.xL=function(f){var a=new e;a.x=f.x;a.y=f.y;a.type=f.type;a.mh=f.mh;return a};e.Ad=function(f,
a,g){var n=new e;n.x=f.x+a*Math.cos(g);n.y=f.y+a*Math.sin(g);n.type=f.type;n.mh=f.mh;return n};e.Js=function(f,a){var g=new e;g.x=.5*(f.x+a.x);g.y=.5*(f.y+a.y);g.type=f.type;g.mh=f.mh;return g};e.LB=function(f,a){var g=new e;g.x=f.x+.001*(a.x-f.x);g.y=f.y+.001*(a.y-f.y);g.type=f.type;g.mh=f.mh;return g};return e}(),f=function(){return function(){}}();(function(e){e[e.Round=0]="Round";e[e.Bevel=1]="Bevel";e[e.Miter=2]="Miter";e[e.Square=3]="Square"})(a.EH||(a.EH={}));var n=function(){function n(e){this.Kx=
this.Ib=this.dg=null;this.oe=e}n.$=function(e,f,g,b,c,x){if(null==e)throw a.g.N();if(1>e.fb())throw a.g.N();if(0==f||e.s())return e;x=new n(x);x.$m=e;x.Da=f;x.ka=c;x.bi=g;x.Dx=b;return x.hv()};n.prototype.hJ=function(){var e=this.$m,f=e.Mb(),g=e.oc(),n=new a.b;n.pc(g,f);n.normalize();n.tt();n.scale(this.Da);f.add(n);g.add(n);n=e.Pa();e.ed(f);e.vd(g);return n};n.prototype.gJ=function(){var e=this.$m;if(0<this.Da&&2!=this.bi){var f=new a.Ka;f.Wc(e,!1);this.$m=f;return this.hv()}e=new a.Vj(e.R);e.P(this.Da,
this.Da);return e};n.prototype.rF=function(e,f,a,g){return(f.x-e.x)*(g.x-a.x)+(f.y-e.y)*(g.y-a.y)};n.prototype.Ub=function(f,a){if(void 0===a)this.Ib.push(f),this.Xe++;else if(0==this.Xe)this.Ub(f);else{var n=this.eu,b,c;b=this.dg[0==a?n-1:a-1];c=this.dg[a];var x=this.rF(b,c,this.Ib[this.Xe-1],f);0<x?this.Ub(f):0>x&&(0<this.rF(b,c,c,this.Ib[this.Xe-1])?(c=this.dg[0==a?n-2:1==a?n-1:a-2],n=e.Ad(b,this.Da,Math.atan2(b.y-c.y,b.x-c.x)-g),this.Ib[this.Xe-1]=n,1==this.bi||2==this.bi?(n=e.Js(n,b),this.Ub(n),
n=e.Ad(b,this.Da,this.vt+g),b=e.Js(n,b),b.type|=256,this.Ub(b)):(n=e.Ad(b,this.Da,this.vt+g),n.type|=256),this.Ub(n),this.Ub(f,a)):(n=e.Ad(c,this.Da,this.vt+g),this.Ub(n),1==this.bi||2==this.bi?(n=e.Js(n,c),this.Ub(n),n=e.Ad(c,this.Da,this.gx-g),b=e.Js(n,c),b.type|=256,this.Ub(b)):(n=e.Ad(c,this.Da,this.gx-g),n.type|=256),this.Ub(n)))}};n.prototype.mB=function(){var f,n,x,d,z,m,k=this.eu;this.Xe=0;var h=.5*this.ka,q=0,l=0;for(f=0;f<k;f++){d=this.dg[f];z=0==f?this.dg[k-1]:this.dg[f-1];m=f==k-1?this.dg[0]:
this.dg[f+1];var v=z.x-d.x,t=z.y-d.y,y=m.x-d.x,r=m.y-d.y;n=Math.atan2(t,v);x=Math.atan2(r,y);this.vt=n;this.gx=x;0==f&&(q=n,l=x);v=v*r-y*t;t=x;x<n&&(x+=c);if(0<v*this.Da)1==this.bi||2==this.bi?(n=e.Ad(d,this.Da,n+g),this.Ub(n),n=e.LB(d,n),this.Ub(n),n=e.Ad(d,this.Da,x-g),d=e.LB(d,n),d.type|=256,this.Ub(d),this.Ub(n)):(v=.5*(x-n),v=this.Da/Math.abs(Math.sin(v)),n=e.Ad(d,v,.5*(n+x)),this.Ub(n,f));else if(0!=(d.type&512)){v=1-h/Math.abs(this.Da);z=1;m=0>this.Da?-b:b;-1<v&&1>v&&(t=2*Math.acos(v),.017453292519943295>
t&&(t=.017453292519943295),z=a.I.truncate(b/t+1.5),1<z&&(m/=z));t=n+g;n=e.Ad(d,this.Da,t);0==f&&(n.type|=1024);this.Ub(n,f);v=this.Da/Math.cos(m/2);t+=m/2;n=e.Ad(d,v,t);n.type|=1024;for(this.Ub(n);0<--z;)t+=m,n=e.Ad(d,v,t),n.type|=1024,this.Ub(n);n=e.Ad(d,this.Da,x-g);n.type|=1024;this.Ub(n)}else if(1==this.bi)n=e.Ad(d,this.Da,n+g),this.Ub(n,f),n=e.Ad(d,this.Da,x-g),this.Ub(n);else if(0==this.bi)for(v=1-h/Math.abs(this.Da),z=1,m=x-g-(n+g),-1<v&&1>v&&(t=2*Math.acos(v),.017453292519943295>t&&(t=.017453292519943295),
z=a.I.truncate(Math.abs(m)/t+1.5),1<z&&(m/=z)),v=this.Da/Math.cos(.5*m),t=n+g+.5*m,n=e.Ad(d,v,t),this.Ub(n,f);0<--z;)t+=m,n=e.Ad(d,v,t),this.Ub(n);else 2==this.bi?(v=z.x-d.x,t=z.y-d.y,y=m.x-d.x,r=m.y-d.y,z=(v*y+t*r)/Math.sqrt(v*v+t*t)/Math.sqrt(y*y+r*r),.99999999<z?(n=e.Ad(d,1.4142135623730951*this.Da,x-.25*b),this.Ub(n,f),n=e.Ad(d,1.4142135623730951*this.Da,x+.25*b),this.Ub(n)):(z=Math.abs(this.Da/Math.sin(.5*Math.acos(z))),m=Math.abs(this.Dx*this.Da),z>m?(v=.5*(x-n),v=this.Da/Math.abs(Math.sin(v)),
n=e.Ad(d,v,.5*(n+x)),x=a.b.Oa(n.x,n.y),n=a.b.Oa(d.x,d.y),d=new a.b,d.pc(x,n),x=new a.b,x.DR(m/d.length(),d,n),n=(z-m)*Math.abs(this.Da)/Math.sqrt(z*z-this.Da*this.Da),0<this.Da?d.tt():d.Kp(),d.scale(n/d.length()),n=new a.b,n.add(x,d),z=new a.b,z.pc(x,d),n=e.um(n),this.Ub(n,f),n=e.um(z),this.Ub(n)):(v=.5*(x-n),v=this.Da/Math.abs(Math.sin(v)),n=e.Ad(d,v,.5*(n+x)),this.Ub(n,f)))):(x=t,0<this.Da?(x>n&&(x-=c),z=n-x<g):(x<n&&(x+=c),z=x-n<g),z?(v=1.4142135623730951*this.Da,t=0>v?n+.25*b:n+.75*b,n=e.Ad(d,
v,t),this.Ub(n,f),t=0>v?x-.25*b:x-.75*b,n=e.Ad(d,v,t),this.Ub(n)):(v=.5*(x-n),v=this.Da/Math.abs(Math.sin(v)),x<n&&(x+=c),n=e.Ad(d,v,(n+x)/2),this.Ub(n,f)))}this.vt=q;this.gx=l;this.Ub(this.Ib[0],0);d=e.xL(this.Ib[this.Xe-1]);this.Ib[0]=d;return this.sR()};n.prototype.xs=function(e,f){if(!(2>f))for(var g=0;g<f;g++){var n=this.Ib[e+g];0!=g?this.Kx.Lm(a.b.Oa(n.x,n.y)):this.Kx.Nr(a.b.Oa(n.x,n.y))}};n.prototype.iJ=function(f,a,g){var n=f.Ea(a),b=f.Dc(a);this.Ib=[];this.Kx=g;if(f.vc(a)){for(a=f.Fa(n);f.Fa(b-
1).ub(a);)b--;if(2<=b-n){this.eu=b-n;this.dg=[];for(a=n;a<b;a++)this.dg.push(e.um(f.Fa(a)));this.mB()&&this.xs(0,this.Xe-1)}}else{for(a=f.Fa(n);n<b&&f.Fa(n+1).ub(a);)n++;for(a=f.Fa(b-1);n<b&&f.Fa(b-2).ub(a);)b--;if(2<=b-n){this.eu=2*(b-n)-2;this.dg=[];g=e.um(f.Fa(n));g.type|=1536;this.dg.push(g);for(a=n+1;a<b-1;a++)g=e.um(f.Fa(a)),this.dg.push(g);g=e.um(f.Fa(b-1));g.type|=512;this.dg.push(g);for(a=b-2;a>=n+1;a--)g=e.um(f.Fa(a)),g.type|=1024,this.dg.push(g);if(this.mB())if(2<=this.Ib.length){f=-1;
(b=0!=(this.Ib[this.Xe-1].type&1024))||(f=0);for(a=1;a<this.Xe;a++)(n=0!=(this.Ib[a].type&1024))?b||(b=a-1,1<b-f+1&&this.xs(f,b-f+1)):b&&(f=a-1),b=n;b||(b=this.Xe-1,1<b-f+1&&this.xs(f,b-f+1))}else f=0,b=this.Xe-1,0<=f&&1<=b-f&&this.xs(f,b-f+1)}}this.dg=null;this.eu=0;this.Ib=null;this.Xe=0};n.prototype.sR=function(){for(var e=!1,f=0;f<this.Xe;f++){var a=this.Ib[f];a.Rg=f+1;a.Ug=f-1;this.Ib[f]=a}a=this.Ib[0];a.Ug=this.Xe-2;this.Ib[0]=a;a=this.Ib[this.Xe-2];a.Rg=0;this.Ib[this.Xe-2]=a;for(f=a=0;f<this.Xe;f++)if(0!=
(this.Ib[a].type&256)){var g=this.$L(a);if(-1!=g)a=g;else{e=!0;break}}else a=this.Ib[a].Rg;if(e)return!1;this.vL(a);return!0};n.prototype.$L=function(e){for(var f=this.Xe-1,a=e,g,n,b=1;b<=f-2;b++){g=a=this.Ib[a].Rg;n=e;for(var c=1;c<=b;c++){n=this.Ib[n].Ug;if(0==(this.Ib[n].type&256)&&0==(this.Ib[g].type&256)){var x=this.oO(n,g);if(-1!=x)return x}g=this.Ib[g].Ug}}return-1};n.prototype.oO=function(e,g){var n,b,c,x;n=this.Ib[this.Ib[e].Ug];b=this.Ib[e];c=this.Ib[this.Ib[g].Ug];x=this.Ib[g];if(!this.HR(n,
b,c,x))return-1;var d=new f;return this.NM(n,b,c,x,d)&&!d.cB&&a.I.bG((b.x-n.x)*(x.y-c.y)-(b.y-n.y)*(x.x-c.x))!=a.I.bG(this.Da)?(n=this.Ib[e].Ug,d.Xl.type=b.type,d.Xl.Rg=g,d.Xl.Ug=n,this.Ib[e]=d.Xl,d.Xl=this.Ib[g],d.Xl.Ug=e,this.Ib[g]=d.Xl,g):-1};n.prototype.HR=function(e,f,a,g){return Math.max(e.x,f.x)>=Math.min(a.x,g.x)&&Math.max(a.x,g.x)>=Math.min(e.x,f.x)&&Math.max(e.y,f.y)>=Math.min(a.y,g.y)&&Math.max(a.y,g.y)>=Math.min(e.y,f.y)};n.prototype.NM=function(f,a,g,n,b){b.cB=!1;var c,x,d;c=(a.y-f.y)*
(n.x-g.x)-(a.x-f.x)*(n.y-g.y);x=(g.y-f.y)*(a.x-f.x)-(g.x-f.x)*(a.y-f.y);c=0==c?2:x/c;return 0<=c&&1>=c&&(d=c,c=(n.y-g.y)*(a.x-f.x)-(n.x-g.x)*(a.y-f.y),x=(f.y-g.y)*(n.x-g.x)-(f.x-g.x)*(n.y-g.y),c=0==c?2:x/c,0<=c&&1>=c)?(b.Xl=e.yL(f.x+c*(a.x-f.x),f.y+c*(a.y-f.y)),b.Xl.mh=g.mh+d*(n.mh-g.mh),0!=d&&1!=d||0!=c&&1!=c||(b.cB=!0),b.wU=c,b.xU=d,(0==d||1==d)&&0<c&&1>c||(0==c||1==c)&&0<d&&1>d?!1:!0):!1};n.prototype.vL=function(e){for(;this.Ib[e].Ug<e;)e=this.Ib[e].Ug;var f=0,a=e;do a=this.Ib[a],this.Ib[f]=a,
a=a.Rg,f++;while(a!=e);this.Ib[f]=this.Ib[0];this.Xe=f+1};n.prototype.qA=function(e){var f=this.$m,a=f.Ca();if(null!=a){a.Lk();for(var g=-1;a.kb();)g++,this.iJ(f,g,e)}};n.prototype.hv=function(){var e=this.$m.D();return 322==e?this.hJ():197==e?this.gJ():a.T.Lc(e)?(e=new a.Xa,e.Bc(this.$m,!0),this.$m=e,this.hv()):1607==e?(e=new a.Xa,this.qA(e),e):1736==e?(e=new a.Ka,this.qA(e),e):null};return n}();a.XG=n})(E||(E={}));(function(a){var b=function(){function e(e){this.xj=e}e.prototype.w=function(e,f){this.xj.a.w(e,
f)};e.prototype.kd=function(e){var f=this.xj.za.da(e);this.xj.za.kd(e,-1);this.xj.a.vf(f,!1)};return e}(),c=function(){function e(e){this.xj=e}e.prototype.w=function(e,f){this.xj.NP.w(e,f)};e.prototype.kd=function(e){this.xj.za.kd(e,-1)};return e}(),g=function(){function e(e){this.xj=e}e.prototype.w=function(e,f){f.J(this.xj.PP[e])};e.prototype.kd=function(e){this.xj.za.kd(e,-1)};return e}(),e=function(){function e(e){void 0===e?(this.za=new a.bj,this.za.de(20),this.a=new a.fd,this.FP=this.a.jg(550),
this.cr=this.a.Cf(this.FP,-1),this.oh=new b(this)):e instanceof Array?(this.za=new a.bj,this.za.de(20),this.PP=e,this.oh=new g(this)):(this.za=new a.bj,this.za.de(20),this.NP=e,this.oh=new c(this))}e.prototype.Eb=function(e){var f=e.D();if(a.Wr.Th(f))this.OJ(e);else if(a.al.Lc(f))this.SJ(e);else if(197==f)this.LJ(e);else if(33==f)this.RJ(e);else throw a.g.N("invalid shape type");};e.prototype.sN=function(){var e=new a.Va,f=this.za.gc(-1),g=new a.Ka(this.a.wp);this.a.Jk(this.za.da(f),e);g.df(e);for(f=
this.za.bb(f);-1!=f;f=this.za.bb(f))this.a.Jk(this.za.da(f),e),g.lineTo(e);return g};e.wL=function(f){var g=new e(f),n=f.F(),b=1,c=new a.b,d=new a.b,z=new a.b;for(f.w(0,c);;){f.w(b,d);if(!(d.Ww(c)&&b<n-1))break;b++}g.za.addElement(0,-1);g.za.qm(b);for(n=b+1;n<f.F();n++)f.w(n,z),b=g.cz(z),-1!=b&&g.za.Vi(b,n);z=new a.Va;b=g.za.gc(-1);n=new a.Ka(f.description);f.Sd(g.za.da(b),z);n.df(z);for(b=g.za.bb(b);-1!=b;b=g.za.bb(b))f.Sd(g.za.da(b),z),n.lineTo(z);return n};e.Oa=function(f,a,g){for(var n=new e(f),
b=1,c=f[0];f[b].Ww(c)&&b<a-1;)b++;n.za.addElement(0,-1);n.za.qm(b);for(b+=1;b<a;b++)c=n.cz(f[b]),-1!=c&&n.za.Vi(c,b);f=0;for(a=n.za.gc(-1);-1!=a;a=n.za.bb(a))g[f++]=n.za.da(a);return f};e.sD=function(f,g){var n=f.Ea(g),b=f.Dc(g);g=!f.vc(g)&&f.Oo(g);f=f.mc(0);n*=2;b*=2;g&&(b-=2);if(6>b-n)return!0;g=new a.b;var c=new a.b,x=new a.b;f.ec(n,g);f.ec(n+2,c);f.ec(n+4,x);var d=e.Bd(c,x,g);if(d.Dq()||!e.ac(d.value()))return!1;for(var z=a.b.Oa(c.x,c.y),m=new a.b,n=n+6;n<b;n+=2){m.J(c);c.J(x);f.ec(n,x);d=e.Bd(c,
x,g);if(d.Dq()||!e.ac(d.value()))return!1;d=e.Bd(z,x,g);if(d.Dq()||!e.ac(d.value()))return!1;d=e.Bd(c,x,m);if(d.Dq()||!e.ac(d.value()))return!1}return!0};e.prototype.OJ=function(e){for(var f=new a.Va,g=new a.b,n=0;n<e.F();n++){e.w(n,g);var b=this.hq(g);if(-1!=b){e.Sd(n,f);var c=this.a.Ub(this.cr,f);this.za.Vi(b,c)}}};e.prototype.LJ=function(e){for(var f=new a.Va,g=new a.b,n=0;4>n;n++){e.vu(n,g);var b=this.hq(g);if(-1!=b){e.uf(n,f);var c=this.a.Ub(this.cr,f);this.za.Vi(b,c)}}};e.prototype.SJ=function(e){var f=
new a.Va,g=e.Mb(),g=this.hq(g);if(-1!=g){e.En(f);var n=this.a.Ub(this.cr,f);this.za.Vi(g,n)}g=e.oc();g=this.hq(g);-1!=g&&(e.Bn(f),e=this.a.Ub(this.cr,f),this.za.Vi(g,e))};e.prototype.RJ=function(e){var f=e.w(),f=this.hq(f);-1!=f&&(e=this.a.Ub(this.cr,e),this.za.Vi(f,e))};e.prototype.hq=function(e){var f=-1;if(0==this.za.size(-1))return f=this.za.addElement(-4,-1);if(1==this.za.size(-1)){var a=this.a.Fa(this.za.da(this.za.gc(-1)));e.Ww(a)||(f=this.za.qm(-5));return f}return f=this.cz(e)};e.prototype.cz=
function(f){var g=-1,n=this.za.gc(-1),b=this.za.tc(-1),c=this.za.da(n),d=this.za.da(b),z=new a.b,m=new a.b;this.oh.w(c,z);this.oh.w(d,m);c=a.b.yn(m,f,z);if(e.ac(c))g=this.za.qm(-1),z=this.az(f,b,n),z!=n&&this.bz(f,n,this.za.ge(z));else if(e.ti(c)){for(var m=this.za.dt(-1),k=this.za.gc(-1),h=this.za.tc(-1),q,c=new a.b,d=new a.b;k!=this.za.ge(h);)q=this.za.da(m),this.oh.w(q,c),q=a.b.yn(c,f,z),e.ti(q)?(h=m,m=this.za.ik(m)):(k=m,m=this.za.Jo(m));m=h;z=k;q=this.za.da(m);k=this.za.da(z);this.oh.w(q,c);
this.oh.w(k,d);if(z==n||(c=a.b.yn(d,f,c),e.ac(c)))g=this.za.vs(z,m,-2,!1),this.bz(f,m,b),this.az(f,z,n)}else null==this.ib&&(this.ib=new a.yb),this.ib.ed(m),this.ib.vd(z),z=this.ib.Gd(f,!0),0>z?(z=this.za.ge(b),this.za.kd(b,-1),g=this.za.qm(-3),this.az(f,z,n)):1<z&&(z=this.za.bb(n),this.za.kd(n,-1),g=this.za.vs(-1,z,-3,!1),this.bz(f,z,b));return g};e.prototype.bz=function(f,g,b){if(g!=b){var n=this.za.da(g),c=this.za.bb(g),x=new a.b,d=new a.b;for(this.oh.w(n,x);g!=b&&2<this.za.size(-1);){this.oh.w(this.za.da(c),
d);n=a.b.yn(d,f,x);if(e.ac(n))break;n=g;g=c;x.J(d);c=this.za.bb(g);this.oh.kd(n)}}};e.prototype.az=function(f,g,b){if(g==b)return b;var n=this.za.da(g),c=this.za.ge(g),x=new a.b,d=new a.b;for(this.oh.w(n,x);g!=b&&2<this.za.size(-1);){this.oh.w(this.za.da(c),d);n=a.b.yn(x,f,d);if(e.ac(n))break;n=g;g=c;x.J(d);c=this.za.ge(g);this.oh.kd(n)}return g};e.Bd=function(e,f,g){var n=new a.$k;n.set(f.x);n.sub(e.x);var b=new a.$k;b.set(g.y);b.sub(e.y);var c=new a.$k;c.set(f.y);c.sub(e.y);f=new a.$k;f.set(g.x);
f.sub(e.x);n.Ap(b);c.Ap(f);n.sub(c);return n};e.ac=function(e){return 0>e};e.ti=function(e){return 0<e};e.ao=function(e){return 0==e};return e}();a.Tr=e})(E||(E={}));(function(a){var b=function(){function b(a){this.oe=this.a=null;this.WD=!0;this.oe=a}b.HE=function(g,e,f){g=a.Ia.As(g);return a.Sr.Vw(e.lk(),e.mk(),f.lk(),f.mk(),a.vi.Ty(g))};b.gL=function(g,e){var f=new a.Va;a.Sr.$P(g,e,f);return f};b.$=function(a,e,f,n){f=new b(f);f.a=a;f.ka=e;f.WD=n;return f.rJ()};b.prototype.lJ=function(g){return a.Sr.zM(this.a,
g)};b.prototype.oJ=function(g){return a.Zu.$(this.a,g,this.oe)};b.prototype.rJ=function(){for(var g=this.ka,e=a.Ia.As(g),g=a.Ia.UJ(g),f=1.00001*g,g=1.000001*g,n=!1,b=30<this.a.pd+10?1E3:(this.a.pd+10)*(this.a.pd+10),c=0,d=this.a.pO();;c++){if(c>b)throw a.g.ra("Internal Error: max number of iterations exceeded");var z=this.lJ(e),n=n||z;this.WD&&(z=0!=this.a.xo(e,!0,!1),n=n||z);z=!1;if(0==c||d||a.Zu.DE(!0,this.a,g,null,this.oe))z=this.oJ(f),n=n||z;if(!z)break}return n};return b}();a.aj=b})(E||(E={}));
(function(a){var b=function(){function b(a){this.Ld=this.zc=null;this.Yb=a;this.hx=!0}b.prototype.et=function(a,e){var f=this.a.cc(a);if(null==f){if(!this.a.Oc(a,e))return null;f=e}return f};b.prototype.LL=function(){var g=this.a.Gp(!1),e=!1,f=new a.yb,n=new a.yb,b=new a.i;b.Ja();var c=new a.i;c.Ja();for(var d=new a.Va,z=new a.gA,m=g.next();-1!=m;m=g.next()){var k=null,h=!1;if(!a.T.Km(this.a.Lb(g.mj))){k=this.et(m,f);if(null==k)continue;k.o(b);b.P(this.ka,this.ka);if(k.mg(this.ka))if(k.mg(0))h=!0,
k=null;else continue}var q=this.a.Gp(g),l=q.next();for(-1!=l&&(l=q.next());-1!=l;l=q.next()){var v=null,t=!1;if(!a.T.Km(this.a.Lb(q.mj))){v=this.et(l,n);if(null==v)continue;v.o(c);if(v.mg(this.ka))if(v.mg(0))t=!0,v=null;else continue}var y=0,r=0;if(null!=k&&null!=v)b.rD(c)&&(z.zn(k),z.zn(v),z.Ga(this.ka,!1),y=z.kk(0),r=z.kk(1),0<y+r&&(this.a.Tp(m,z,0,!0),this.a.Tp(l,z,1,!0)),z.clear());else if(null!=k){var B=new a.b;this.a.w(l,B);if(b.contains(B)){z.zn(k);this.a.Jk(l,d);z.Tw(this.ka,d,!1);y=z.kk(0);
if(0<y)if(this.a.Tp(m,z,0,!0),t){t=-1;for(B=this.a.X(l);-1!=B&&B!=l&&(v=this.et(B,n),t=B,null!=v&&v.mg(0));B=this.a.X(B));for(B=l;-1!=B&&(this.a.bh(B,z.nf),B!=t);B=this.a.X(B));}else this.a.bh(l,z.nf);z.clear()}}else if(null!=v){if(B=new a.b,this.a.w(m,B),c.P(this.ka,this.ka),c.contains(B)){z.zn(v);this.a.Jk(m,d);z.Tw(this.ka,d,!1);r=z.kk(0);if(0<r)if(this.a.Tp(l,z,0,!0),h){t=-1;for(B=this.a.X(m);-1!=B&&B!=m&&(v=this.et(B,n),t=B,null!=v&&v.mg(0));B=this.a.X(B));for(B=m;-1!=B&&(this.a.bh(B,z.nf),B!=
t);B=this.a.X(B));}else this.a.bh(m,z.nf);z.clear()}}else continue;if(0!=y+r){if(0!=y){k=this.a.cc(m);if(null==k){if(!this.a.Oc(m,f))continue;k=f;f.o(b)}else k.o(b);if(k.mg(this.ka))break}e=!0}}}return e};b.prototype.ML=function(){return this.HQ()};b.prototype.HQ=function(){return(new a.aA).GS(this.a,this.ka)};b.prototype.EE=function(){var g=!1,e,f;null==this.zc&&(this.zc=new a.bj);var n=new a.ga(0);n.xb(this.a.pd+1);for(var b=this.a.Gp(),c=b.next();-1!=c;c=b.next())n.add(c);this.a.Mu(n,n.size);n.add(-1);
b=this.a.re();c=this.a.re();this.Ld=new a.hA(this.a,this.ka,!this.hx);this.zc.Hn(this.Ld);var d=new a.ga(0),z=new a.ga(0),m=0;new a.b;var k=this.a.cd;this.a.wb.kc();for(var h=this.a.wb.Ba[0].f,q,l,v=n.get(m++);-1!=v;){l=k.O(v,0);q=h[2*l];l=h[2*l+1];var t=q,y=l;do{var r=k.O(v,2),B=k.O(v,1);-1!=r&&(e=k.O(r,0),f=h[2*e],e=h[2*e+1],0>(y<e?-1:y>e?1:t<f?-1:t>f?1:0)&&(z.add(v),z.add(r)));-1!=B&&(e=k.O(B,0),f=h[2*e],e=h[2*e+1],0>(y<e?-1:y>e?1:t<f?-1:t>f?1:0)&&(z.add(B),z.add(B)));f=this.a.Ra(v,b);-1!=f&&(d.add(f),
this.a.lb(v,b,-1));f=this.a.Ra(v,c);-1!=f&&(d.add(f),this.a.lb(v,c,-1));v=n.get(m++);-1!==v&&(y=k.O(v,0),t=h[2*y],y=h[2*y+1])}while(-1!=v&&t===q&&y===l);t=1==d.size&&2==z.size;f=y=-1;r=0;for(B=d.size;r<B;r++){e=d.get(r);var E=this.zc.ge(e);-1==E||d.Nw(E)||(y=E);e=this.zc.bb(e);-1==e||d.Nw(e)||(f=e);if(-1!=y&&-1!=f)break}this.Ld.XF(l,q);r=0;for(B=d.size;r<B;r++)e=d.get(r),this.zc.kd(e,-1);d.clear(!1);if(!t&&-1!=y&&-1!=f&&this.SK(y,f)){g=!0;this.ei=this.Ld.rl();break}r=0;for(B=z.size;r<B;r+=2){l=z.get(r);
q=z.get(r+1);t?(l=this.zc.vs(y,f,l,!0),t=!1):l=this.zc.addElement(l,-1);if(this.Ld.Zf){this.ei=this.Ld.rl();g=!0;break}-1==this.a.Ra(q,b)?this.a.lb(q,b,l):this.a.lb(q,c,l)}if(g)break;z.cf(0)}this.a.bf(b);this.a.bf(c);return g};b.prototype.SK=function(a,e){this.Ld.compare(this.zc,this.zc.da(a),e);a=this.Ld.Zf;this.Ld.lq();return a};b.Gh=function(g){for(var e=g.$c;-1!=e;e=g.we(e))if(a.T.Kc(g.Lb(e)))return!0;return!1};b.Yk=function(a,e,f,n){if(!b.Gh(a))return!1;e=new b(n);e.a=a;e.ka=f;if(15>a.pd)a=e.LL();
else return e.ML();return a};b.$=function(a,e,f){return b.Yk(a,a.wC(),e,f)};b.DE=function(g,e,f,n,c){if(!b.Gh(e))return!1;var x=new b(c);x.a=e;x.ka=f;x.hx=g;if(x.EE())return null!=n&&n.aq(x.ei),!0;var d=new a.Bg;d.Oy();e.Oe(d);x=new b(c);x.a=e;x.ka=f;x.hx=g;g=x.EE();d.Oy();e.Oe(d);return g?(null!=n&&n.aq(x.ei),!0):!1};return b}();a.Zu=b})(E||(E={}));(function(a){(function(e){e[e.Left=0]="Left";e[e.Right=1]="Right";e[e.Coincident=2]="Coincident";e[e.Undefined=3]="Undefined";e[e.Uncut=4]="Uncut"})(a.ZG||
(a.ZG={}));var b=function(){return function(e,a,g,b,c,d,z,m,k,h,q){this.U=e;this.cu=a;this.Yq=g;this.ag=b;this.Il=h;this.xk=q}}();a.yT=b;var c=function(){function e(e,f){this.jE=e;this.Zh=f}e.prototype.nJ=function(e,f){var g=new a.b;this.Zh.w(e,g);var n=new a.b;this.Zh.w(f,n);g=g.compare(n);if(0!=g)return g;g=this.Zh.Ra(e,this.jE);n=this.Zh.Ra(f,this.jE);return g<n?-1:g==n?0:1};return e}(),g=function(){return function(e,a,g,b,c,d,z,m,k){this.ag=e;this.Yq=a;this.Lx=g;this.sE=b;this.Wh=c;this.xk=d;
this.Il=z;this.tE=m;this.RP=k}}();a.xT=g;var e=function(){function e(){}e.YG=function(f,g,c,d,z,m){if(g.s())f=new b(g,4,-1,-1,NaN,4,-1,-1,NaN,-1,-1,NaN,-1,-1,NaN),z.push(f);else{var n=new a.fd;n.Eb(g);n.Eb(c);a.aj.$(n,d,m,!0);g=0;c=n.re();for(d=n.$c;-1!=d;d=n.we(d))for(m=n.Vb(d);-1!=m;m=n.bc(m))for(var x=n.Cb(m),I=0,k=n.Ha(m);I<k;x=n.X(x),I++)n.lb(x,c,g++);g=e.qM(c,n);e.CI(f,g,n,z)}};e.qM=function(f,g){for(var n=g.pd,b=new a.ga(0),x=g.$c;-1!=x;x=g.we(x))for(var d=g.Vb(x);-1!=d;d=g.bc(d))for(var z=
g.Cb(d),m=0,k=g.Ha(d);m<k;z=g.X(z),m++)b.add(z);var h=new c(f,g);b.xd(0,n,function(e,f){return h.nJ(e,f)});f=[];var q=[],l=g.re(),v=g.re(),x=g.$c,d=g.we(x),k=new a.b,t=new a.b,y=b.get(0),r=g.rd(y),B=g.Vf(r);g.w(y,k);for(var E=1,z=0;E<n-1;){for(var u=!1,m=E;m<n;m++)if(m!=z){var C=b.get(m),D=g.rd(C),O=g.Vf(D);g.w(C,t);if(k.ub(t))B==x&&O==d&&(u=e.SI(l,v,g,f,q,r,y,D,C));else break}if(u||z==E-1){u&&z==E-1&&E--;if(++z==n)break;y=b.get(z);r=g.rd(y);B=g.Vf(r);g.w(y,k)}u||(E=z+1)}n=[];for(x=g.$c;-1!=x;x=g.we(x))for(d=
g.Vb(x);-1!=d;d=g.bc(d))for(b=g.Cb(d),m=0,k=g.Ha(d);m<k;b=g.X(b),m++){z=g.Ra(b,v);if(0<=z)for(;z<q.length&&q[z].ag==b;)n.push(q[z++]);z=g.Ra(b,l);if(0<=z)for(;z<f.length&&f[z].ag==b;)n.push(f[z++])}g.bf(l);g.bf(v);return n};e.SI=function(f,a,g,b,c,d,z,m,k){var n=g.hk(d),x=g.hk(m),I=g.Cb(d),h=g.Cb(m),L=g.Ua(z),q=g.Ua(k),l=!1,v=!1,t=!1,y=!1;z!=I&&(k!=h&&(l=e.VI(f,g,b,d,L,m,q)),k!=x&&(v=e.YI(f,g,b,d,L,m,k)));z!=n&&(k!=h&&(t=e.aJ(a,g,c,d,z,m,q,I)),k!=x&&(y=e.dJ(a,g,c,d,z,m,k,I)));l&&v&&t?(f=b.length-
1,2==c[y?c.length-2:c.length-1].Wh&&(b[f-1]=b[f],--b.length)):l&&v&&y&&2==c[c.length-1].Wh&&(c=b[b.length-1],--b.length,g.Ra(c.ag,f)==b.length&&g.lb(c.ag,f,-1));return l||v||t||y};e.VI=function(e,f,b,c,d,z,m){var n,x;x=new a.yb;var I=new a.yb,k=[0,0],h=[0,0];n=f.cc(d);null==n&&(f.Oc(d,x),n=x);x=f.cc(m);null==x&&(f.Oc(m,I),x=I);n=n.Ga(x,null,k,h,0);2>n&&(c=new g(d,c,k[0],NaN,n,m,z,h[0],NaN),b.push(c),c=f.Ra(d,e),0>c&&f.lb(d,e,b.length-1));return!0};e.YI=function(e,f,b,c,d,z,m){var n,x;x=new a.yb;var I=
new a.yb,k=[0,0],h=[0,0];n=f.cc(d);null==n&&(f.Oc(d,x),n=x);x=f.cc(m);null==x&&(f.Oc(m,I),x=I);n=n.Ga(x,null,k,h,0);return 2>n?(c=new g(d,c,k[0],NaN,n,m,z,h[0],NaN),b.push(c),c=f.Ra(d,e),0>c&&f.lb(d,e,b.length-1),!0):!1};e.aJ=function(e,f,b,c,d,z,m,k){var n,x;x=new a.yb;var I=new a.yb,h=[0,0],q=[0,0];n=f.cc(d);null==n&&(f.Oc(d,x),n=x);x=f.cc(m);null==x&&(f.Oc(m,I),x=I);n=n.Ga(x,null,h,q,0);if(2==n)return c=new g(d,c,h[0],h[1],n,m,z,q[0],q[1]),b.push(c),c=f.Ra(d,e),0>c&&f.lb(d,e,b.length-1),!0;I=!1;
d==k&&(c=new g(d,c,h[0],NaN,n,m,z,q[0],NaN),b.push(c),c=f.Ra(d,e),0>c&&f.lb(d,e,b.length-1),I=!0);return I};e.dJ=function(e,f,b,c,d,z,m,k){var n,x;x=new a.yb;var I=new a.yb,h=[0,0],q=[0,0];n=f.cc(d);null==n&&(f.Oc(d,x),n=x);x=f.cc(m);null==x&&(f.Oc(m,I),x=I);n=n.Ga(x,null,h,q,0);if(2==n)return c=new g(d,c,h[0],h[1],n,m,z,q[0],q[1]),b.push(c),c=f.Ra(d,e),0>c&&f.lb(d,e,b.length-1),!0;I=!1;d==k&&(c=new g(d,c,h[0],NaN,n,m,z,q[0],NaN),b.push(c),c=f.Ra(d,e),0>c&&f.lb(d,e,b.length-1),I=!0);return I};e.CI=
function(f,g,c,d){var n,x=[];x[0]=new a.b;x[1]=new a.b;x[2]=new a.b;x[3]=new a.b;var z=new a.b,m=new a.b,I=new a.b,k=new a.b,h=null;null!=d&&(h=new a.Ag,h.mq());var q,L=0,l=null,v=new a.yb;new a.yb;for(var t=c.Vb(c.$c);-1!=t;t=c.bc(t)){var y,r=4,B=-1,E,u,C,D=-1,O,G,J,p,w=-1,K=-1,M=NaN;y=!0;var U=!1,Z=!0,W=!0,N=!0,A=0;C=t;O=0;for(var R=c.Cb(t),X=c.Ha(t),S=0;S<X;R=c.X(R),S++){q=c.cc(R);if(null==q){if(!c.Oc(R,v))continue;q=v}-1==D&&(D=R);for(var Q=0;L<g.length&&R==g[L].ag;){B=g[L].Yq;E=g[L].ag;u=g[L].Lx;
G=g[L].Il;J=g[L].xk;p=g[L].tE;if(2==g[L].Wh){if(U||(C=B,D=E,O=u,w=G,K=J,M=p,r=2,null!=d?l=new a.Xa:A=0,N=!1,W=!0),u=g[L].sE,p=g[L].RP,null!=d?(q.Bi(Q,g[L].sE,h),l.Bc(h.get(),W)):A++,Q=u,U=!0,W=y=!1,L+1==g.length||2!=g[L+1].Wh||g[L+1].ag==E&&g[L+1].Lx!=Q)null!=d?(n=new b(l,2,B,E,u,r,C,D,O,G,J,p,w,K,M),d.push(n)):null.add(A),C=B,D=E,O=u,w=G,K=J,M=p,r=2,U=y=!1,W=N=!0}else{var V=c.X(E);if(L<g.length-1&&g[L+1].ag==V&&g[L+1].xk==J&&2==g[L+1].Wh)u!=Q&&(N&&(null!=d?l=new a.Xa:A=0),y=0<L&&g[L-1].Yq==B?1==
r?0:0==r?1:3:3,null!=d?(q.Bi(Q,u,h),l.Bc(h.get(),W),n=new b(l,y,B,E,u,r,C,D,O,G,J,p,w,K,M),d.push(n)):(A++,null.add(A)),Q=u,C=B,D=E,O=u,w=G,K=J,M=p,r=y,y=Z=!1,W=N=!0);else if(!e.KK(f,c,g,L,z,m)){e.KG(c,g,L,t,R,I,k);var T=!1,V=!1;n=!0;if(!(z.ub(I)||m.ub(I)||z.ub(k)||m.ub(k))){x[0].J(z);x[1].J(m);x[2].J(I);x[3].J(k);x.sort(a.b.cq);var ra=x[0],ua=x[1],Aa=x[2],ma=x[3];ra.ub(z)?ua.ub(m)?f?(V=T=!0,n=!1):T=!1:ma.ub(m)?f?n=V=T=!0:T=!1:(T=!0,n=ua.ub(I)):ua.ub(z)?Aa.ub(m)?f?(V=T=!0,n=!1):T=!1:ra.ub(m)?f?n=
V=T=!0:T=!1:(T=!0,n=Aa.ub(I)):Aa.ub(z)?ma.ub(m)?f?(V=T=!0,n=!1):T=!1:ua.ub(m)?f?n=V=T=!0:T=!1:(T=!0,n=ma.ub(I)):ra.ub(m)?f?(V=T=!0,n=!1):T=!1:Aa.ub(m)?f?n=V=T=!0:T=!1:(T=!0,n=ra.ub(I))}if(T){T=R==E;if(u!=Q||T&&0==Q)N&&(null!=d?l=new a.Xa:A=0),null!=d?(q.Bi(Q,u,h),l.Bc(h.get(),W)):A++;if(n)if(1!=r){if(u!=Q||T&&0==Q)null!=d?(n=new b(l,1,B,E,u,r,C,D,O,G,J,p,w,K,M),d.push(n)):null.add(A);if(!V)r=1;else if(L==g.length-2||g[L+2].Yq!=B)r=0}else{if(u!=Q||T&&0==Q)null!=d?(n=new b(l,3,B,E,u,r,C,D,O,G,J,p,w,
K,M),d.push(n)):null.add(A);r=1}else if(0!=r){if(u!=Q||T&&0==Q)null!=d?(n=new b(l,0,B,E,u,r,C,D,O,G,J,p,w,K,M),d.push(n)):null.add(A);if(!V)r=0;else if(L==g.length-2||g[L+2].Yq!=B)r=1}else{if(u!=Q||T&&0==Q)null!=d?(n=new b(l,3,B,E,u,r,C,D,O,G,J,p,w,K,M),d.push(n)):null.add(A);r=0}if(u!=Q||T&&0==Q)Q=u,C=B,D=E,O=u,w=G,K=J,M=p,y=Z=!1,W=N=!0}}}L++}1!=Q&&(N&&(null!=d?l=new a.Xa:A=0),null!=d?(q.Bi(Q,1,h),l.Bc(h.get(),W)):A++,W=N=!1,Z=!0)}Z&&(u=1,E=c.hk(t),E=c.Ua(E),J=G=-1,p=NaN,y?null!=d?(n=new b(l,4,B,
E,u,r,C,D,O,G,J,p,w,K,M),d.push(n)):null.add(A):(y=1==r?0:0==r?1:3,null!=d?(n=new b(l,y,B,E,u,r,C,D,O,G,J,p,w,K,M),d.push(n)):null.add(A)))}};e.KK=function(f,g,b,c,d,z){var n=b[c].tE;if(1==n)return e.GJ(f,g,b,c,d,z);if(0==n)return e.dK(f,g,b,c,d,z);throw a.g.wa();};e.GJ=function(e,f,g,b,c,d){var n=new a.yb,x=g[b].ag,z=g[b].Il,m=g[b].xk,I=-1,k=-1,h=-1,q=-1;if(!e&&0<b)var L=g[b-1],I=L.ag,k=L.Il,h=L.xk,q=L.Wh;var l=-1,v=-1,t=-1,y=-1;b<g.length-1&&(L=g[b+1],l=L.ag,v=L.Il,t=L.xk,y=L.Wh);var r=f.X(x),L=
f.X(m);if(!e)return 0<b&&I==x&&k==z&&h==L&&2==q||b<g.length-1&&l==r&&v==z&&t==L&&2==y?(e=f.cc(m),null==e&&(f.Oc(m,n),e=n),d.J(e.Pf(1)),c.qr(d),d.normalize(),c.normalize(),!1):b<g.length-1&&l==x&&v==z&&t==L?(e=f.cc(m),null==e&&(f.Oc(m,n),e=n),c.J(e.Pf(1)),e=f.cc(L),null==e&&(f.Oc(L,n),e=n),d.J(e.Pf(0)),c.Bp(),d.normalize(),c.normalize(),!1):!0;if(b==g.length-1||l!=x||v!=z||t!=L||2==y)return e=f.cc(m),null==e&&(f.Oc(m,n),e=n),d.J(e.Pf(1)),c.qr(d),d.normalize(),c.normalize(),!1;e=f.cc(m);null==e&&(f.Oc(m,
n),e=n);c.J(e.Pf(1));e=f.cc(L);null==e&&(f.Oc(L,n),e=n);d.J(e.Pf(0));c.Bp();d.normalize();c.normalize();return!1};e.dK=function(e,f,g,b,c,d){var n=new a.yb,x=g[b].ag,z=g[b].Il,m=g[b].xk,I=-1,k=-1,h=-1,q=-1;if(!e&&b<g.length-1)var L=g[b+1],I=L.ag,k=L.Il,h=L.xk,q=L.Wh;var l=-1,v=-1,t=-1,L=-1;0<b&&(L=g[b-1],l=L.ag,v=L.Il,t=L.xk,L=L.Wh);var y=f.X(x),r=f.Ua(m);return e?0==b||l!=x||v!=z||t!=r||2==L?(e=f.cc(m),null==e&&(f.Oc(m,n),e=n),d.J(e.Pf(0)),c.qr(d),d.normalize(),c.normalize(),!1):!0:0<b&&l==x&&v==
z&&t==r&&2==L||b<g.length-1&&I==y&&k==z&&h==r&&2==q?(e=f.cc(m),null==e&&(f.Oc(m,n),e=n),d.J(e.Pf(0)),c.qr(d),d.normalize(),c.normalize(),!1):!0};e.KG=function(e,f,g,b,c,d,z){var n=new a.yb,x=e.cc(c);null==x&&(e.Oc(c,n),x=n);g=f[g];f=g.ag;g=g.Lx;c=e.X(f);if(1==g)d.J(x.Pf(1)),-1!=c&&c!=e.hk(b)?(x=e.cc(c),null==x&&(e.Oc(c,n),x=n),z.J(x.Pf(0)),x=e.cc(f),null==x&&e.Oc(f,n)):z.J(d),d.Bp(),z.normalize(),d.normalize();else if(0==g)z.J(x.Pf(g)),d.qr(z),z.normalize(),d.normalize();else throw a.g.wa();};return e}();
a.$G=e})(E||(E={}));(function(a){(function(e){e[e.Linear=0]="Linear";e[e.Angular=1]="Angular";e[e.Area=2]="Area"})(a.RI||(a.RI={}));var b=function(){function e(e,f,a){this.Nc=f;this.Dj=a;this.wx=e}e.PC=function(f){return 0!==f.Nc?null:-1===f.wx?new e(-1,2,f.Dj*f.Dj):e.Qd(n[f.wx])};e.Qd=function(e){e=f[e];return void 0===e?null:e};e.EL=function(f,a,g){var n=null;if(void 0!==g&&null!==g)try{"EPSG"===g.values[0]&&(n=e.Qd(parseInt(g.values[1])))}catch(ga){}null===n&&(n=new e(-1,f,a));return n};e.prototype.Qc=
function(){return this.wx};e.prototype.rC=function(e){if(e.Nc!=this.Nc)throw a.g.xa();return this.Dj/e.Dj};e.ih=function(e,f,a){return f.rC(a)*e};e.OB=function(e,f,a,g,n){a=a.rC(g);for(g=0;g<f;g++)n[g]=e[g]*a};return e}();a.Tb=b;for(var c=[109402,4046.8564224,109403,4046.87260987425,109463,100,109401,1E4,109461,225E8,109460,25E8,109451,1E-4,109444,404.68564224000005,109424,404.6849341289498,109428,404.68493792602754,109416,404.67838076760535,109420,404.68423895571647,109448,404.683871963536,109411,
404.6872609874253,109450,.01,109408,3.34450944,109405,.09290304,109430,.09290354800069446,109423,.0929028774400711,109427,.09290287831176021,109441,.09290349665192114,109407,.09290137299531805,109440,.09290286332673177,109431,.09290274144751023,109432,.09290207073852812,109433,.09290279616016,109434,.09290273520025,109419,.09290271785025629,109447,.0929026336004445,109406,.09290341161327487,109453,6.4516E-4,109454,6.451625806477421E-4,109414,1E6,109445,.04046856422400001,109425,.04046849341289498,
109429,.04046849379260275,109417,.04046783807676053,109421,.04046842389557164,109449,.0404683871963536,109412,.04046872609874253,109404,1,109410,1.000027193184865,109413,2589998.4703195216,109452,1E-6,109409,3429904,109458,3434290.937856,109457,3434528.1495040003,109464,1.244521604938272E-7,109455,25.292852640000003,109456,25.29295381171408,109459,2.89612324,109439,2589988.110336,109462,.7168473118308245,109442,.83612736,109422,.83612589696064,109426,.836125904805842,109415,.8361123569578626,109435,
.836124673027592,109436,.836118636646753,109437,.8361251654414399,109438,.83612461680225,109418,.8361244606523066,109446,.8361237024040001,109443,.8361307045194736],g=[9103,2.908882086657216E-4,9104,4.84813681109536E-6,9102,.0174532925199433,9106,.01570796326794897,9105,.01570796326794897,9109,1E-6,9114,9.817477042468104E-4,1031,4.84813681109536E-9,9112,1.570796326794897E-4,9101,1,9113,1.570796326794897E-6],e=[109031,15E4,109461,109030,5E4,109460,1033,.01,109451,9097,20.1168,109444,9052,20.1167824,
109424,9062,20.116782494375872,109428,9038,20.1166195164,109416,9042,20.116765121552632,109420,9301,20.116756,109448,9033,20.11684023368047,109411,109005,.1,109450,9014,1.8288,109408,9002,.3048,109405,9070,.3048008333333334,109430,9051,.3047997333333333,109423,9061,.3047997347632708,109427,9095,.3048007491,109441,9005,.3047972654,109407,9094,.3047997101815088,109440,9080,.3047995102481469,109431,9081,.30479841,109432,9082,.3047996,109433,9083,.3047995,109434,9041,.304799471538676,109419,9300,.3047993333333334,
109447,9003,.3048006096012192,109406,109008,.0254,109453,109009,.0254000508001016,109454,9036,1E3,109414,9098,.201168,109445,9053,.201167824,109425,9063,.2011678249437587,109429,9039,.201166195164,109417,9043,.2011676512155263,109421,9302,.20116756,109449,9034,.2011684023368047,109412,9001,1,109404,9031,1.0000135965,109410,9035,1609.3472186944375,109413,1025,.001,109452,9030,1852,109409,109013,1853.184,109458,109012,1853.248,109457,109016,3.527777777777778E-4,109464,109010,5.0292,109455,109011,5.029210058420118,
109456,109014,1.7018,109459,9093,1609.344,109439,109015,.8466683600033867,109462,9096,.9144,109442,9050,.9143992,109422,9060,.9143992042898124,109426,9037,.9143917962000001,109415,9084,.9143985307444408,109435,9085,.91439523,109436,9086,.9143988,109437,9087,.9143985,109438,9040,.9143984146160287,109418,9099,.914398,109446,109002,.9144018288036576,109443,109001,.9144,109442,109003,20.1168,109444,109004,.201168,109445,109006,.01,109451,109007,.001,109452],f=[],n=[],x=0;x<c.length;x+=2)f[c[x]]=new b(c[x],
2,c[x+1]);c=null;for(x=0;x<g.length;x+=2)f[g[x]]=new b(g[x],1,g[x+1]);g=null;for(x=0;x<e.length;x+=3)f[e[x]]=new b(e[x],0,e[x+1]),n[e[x]]=e[x+2];e=null})(E||(E={}));(function(a){var b=function(){function a(){}a.prototype.set=function(a,e){void 0!==e?(this.Lf=a,this.Og=e):"number"===typeof a?(this.Lf=a,this.Og=0):(this.Lf=a.Lf,this.Og=a.Og)};a.prototype.value=function(){return this.Lf};a.prototype.sub=function(a){if("number"===typeof a){var e=this.Lf-a;a=this.Og+2.220446049250313E-16*Math.abs(e)}else e=
this.Lf-a.Lf,a=this.Og+a.Og+2.220446049250313E-16*Math.abs(e);this.Lf=e;this.Og=a};a.prototype.Ap=function(a){var e=this.Lf*a.Lf;this.Og=this.Og*Math.abs(a.Lf)+a.Og*Math.abs(this.Lf)+this.Og*a.Og+2.220446049250313E-16*Math.abs(e);this.Lf=e};a.prototype.eP=function(){return Math.abs(this.Lf)<=this.Og};a.prototype.Dq=function(){return this.eP()&&0!=this.Og};return a}();a.$k=b})(E||(E={}));var J=new E.b,G=new E.b,K=new E.b,M=new E.b,U=new E.b;(function(a){var b;(function(a){a[a.closedPath=1]="closedPath";
a[a.exteriorPath=2]="exteriorPath";a[a.ringAreaValid=4]="ringAreaValid"})(b||(b={}));var c=function(){function g(e,f,a,g,b,c,d){void 0!==f?(this.ab=e,this.mj=f,this.$j=a,this.zh=g,this.ua=c,this.mx=d,this.Pt=b):(this.ab=e.ab,this.mj=e.mj,this.$j=e.$j,this.zh=e.zh,this.ua=e.ua,this.mx=e.mx,this.Pt=e.Pt);this.JD=!0}g.prototype.next=function(){return this.JD?(this.JD=!1,this.zh):-1!=this.zh?(this.zh=this.ab.X(this.zh),this.ua++,-1!=this.zh&&this.zh!=this.Pt?this.zh:this.cQ()):-1};g.prototype.cQ=function(){this.$j=
this.ab.bc(this.$j);for(this.ua=0;-1!=this.mj;){for(;-1!=this.$j;this.$j=this.ab.bc(this.$j))if(this.Pt=this.zh=this.ab.Cb(this.$j),-1!=this.zh)return this.zh;this.mj=this.ab.we(this.mj);if(-1==this.mj)break;if(!this.mx||a.T.Kc(this.ab.Lb(this.mj)))this.$j=this.ab.Vb(this.mj)}return-1};g.UL=function(e,f,a,b,c,d,m){return new g(e,f,a,b,c,d,m)};return g}();a.CT=c;b=function(){function g(){this.Zm=this.Al=this.Ej=this.Mc=this.Jj=this.jn=this.fi=this.Rc=this.sh=this.wg=this.Ge=this.wp=this.zp=this.wb=
this.Hk=null;this.Xt=this.$c=-1;this.pd=0;this.kx=!1;this.wp=this.zp=this.wb=null}g.prototype.Fi=function(e){return null!=this.Ge?this.Ge[e]:null};g.prototype.Fh=function(e,f){if(null==this.Ge){if(null==f)return;this.Ge=[];for(var a=0,g=this.wb.F();a<g;a++)this.Ge.push(null)}this.Ge[e]=f};g.prototype.Mn=function(e,f){this.Rc.L(e,1,f)};g.prototype.Ln=function(e,f){this.Rc.L(e,2,f)};g.prototype.Iy=function(e,f){this.Rc.L(e,6,f)};g.prototype.Ho=function(e){return this.Rc.O(e,6)};g.prototype.Hu=function(e,
f){this.Rc.L(e,7,f)};g.prototype.bt=function(e){return this.Rc.O(e,0)};g.prototype.MF=function(e,f){this.Mc.L(e,1,f)};g.prototype.QF=function(e,f){this.Mc.L(e,0,f)};g.prototype.xC=function(e){return this.Mc.O(e,7)};g.prototype.Jn=function(e,f){this.Mc.L(e,3,f)};g.prototype.Kn=function(e,f){this.Mc.L(e,4,f)};g.prototype.jQ=function(e){null==this.Mc&&(this.Mc=new a.Fc(8));var f=this.Mc.be();this.Mc.L(f,2,e);this.Mc.L(f,5,0);this.Mc.L(f,6,0);this.Mc.L(f,7,f);return f};g.prototype.bN=function(e){this.Mc.Jc(e)};
g.prototype.lQ=function(e){null==this.Rc&&(this.Rc=new a.Fc(8),this.cd=new a.Fc(5),this.fi=new a.qd(0),this.jn=new a.qd(0));var f=this.Rc.be();this.Rc.L(f,0,f);this.Rc.L(f,3,0);this.Rc.L(f,6,0);this.Hu(f,e);f>=this.fi.size&&(e=16>f?16:a.I.truncate(3*f/2),this.fi.resize(e),this.jn.resize(e));this.fi.set(f,0);this.jn.set(f,0);return f};g.prototype.iC=function(e){this.Rc.Jc(e)};g.prototype.dw=function(e){this.cd.Jc(e);this.pd--};g.prototype.mQ=function(e){null==this.Rc&&(this.Rc=new a.Fc(8),this.cd=
new a.Fc(5),this.fi=new a.qd(0),this.jn=new a.qd(0));var f=this.cd.be(),g=0<=e?e:f;this.cd.L(f,0,g);if(0>e){if(g>=this.wb.F()){e=16>g?16:a.I.truncate(3*g/2);this.wb.resize(e);if(null!=this.Ge)for(var b=0;b<e;b++)this.Ge.push(null);null!=this.wg&&this.wg.resize(e);this.zp=this.wb.mc(0)}this.wb.ic(g,-1E38,-1E38);null!=this.Ge&&(this.Ge[g]=null);null!=this.wg&&this.wg.write(g,1)}this.cd.L(f,4,2*g);this.pd++;return f};g.prototype.vl=function(e,f,a){var g=-1!=f?this.Ua(f):this.hk(e),n=-1!=g?this.X(g):
-1,b=this.mQ(null==a?this.pd:-1),c=this.gb(b);null!=a&&this.wb.Iu(c,a);this.im(b,e);this.Sc(b,n);this.Tc(b,g);-1!=n&&this.Tc(n,b);-1!=g&&this.Sc(g,b);a=this.vc(e);g=this.Cb(e);-1==f&&this.Wi(e,b);f==g&&this.Dh(e,b);a&&-1==n&&(this.Sc(b,b),this.Tc(b,b));this.hm(e,this.Ha(e)+1);e=this.Vf(e);this.Pk(e,this.F(e)+1);return b};g.prototype.Fo=function(){null==this.Zm&&(this.Zm=new a.Va(this.wb.description));return this.Zm};g.prototype.Pp=function(e,a){this.Mc.L(e,2,this.Mc.O(e,2)&-134217729||(1==a?134217728:
0))};g.prototype.Cm=function(e){return 0!=(this.Mc.O(e,2)&134217728)?1:0};g.prototype.MJ=function(e){var a=this.jg(e.D(),e.description);1736==e.D()&&this.Pp(a,e.Cm());this.WA(a,e);return a};g.prototype.NJ=function(e){var a=this.jg(e.D(),e.description);this.XA(a,e);return a};g.prototype.TQ=function(e,f){null==this.Rc&&(this.Rc=new a.Fc(8),this.cd=new a.Fc(5),this.fi=new a.qd(0),this.jn=new a.qd(0));this.Rc.de(this.Rc.Xc+e);this.cd.de(this.cd.Xc+f);this.fi.xb(this.fi.size+e);this.jn.xb(this.jn.size+
e)};g.prototype.WA=function(e,f){this.TQ(f.ea(),f.F());this.Hk.Pd(f,0,f.F());this.zp=this.wb.mc(0);for(var g=null!=this.Ge&&null!=f.Fe,b=0,c=f.ea();b<c;b++)if(!(2>f.Ha(b))){var d=this.Cf(e,-1);this.Gn(d,f.vc(b));for(var m=f.Ea(b),z=f.Dc(b);m<z;m++){var k=this.vl(d,-1,null);if(g)if(k=this.gb(k),0!=(f.NC(m)&1))this.Fh(k,null);else{var h=new a.Ag;f.cc(m,h,!0);this.Fh(k,h.get())}}}};g.prototype.XA=function(e,a){this.Hk.Pd(a,0,a.F());this.zp=this.wb.mc(0);e=this.Cf(e,-1);var f=0;for(a=a.F();f<a;f++)this.vl(e,
-1,null)};g.prototype.DS=function(e,f,g){var n=this.X(e);if(-1==n)throw a.g.wa();for(var b=this.Fo(),c=this.rd(e),d=0,m=f.kk(g);d<m;d++){var z=this.gb(e),k=this.X(e),h=f.Io(g,d);0==d&&(h.En(b),this.bh(e,b));322==h.D()?this.Fh(z,null):this.Fh(z,a.T.Yj(h));h.Bn(b);d<m-1?e=this.vl(c,k,b):this.bh(n,b)}};g.prototype.CS=function(e,f,g){var n=this.X(e);if(-1==n)throw a.g.wa();for(var b=this.Fo(),c=this.rd(e),d=0,m=f.kk(g);d<m;d++){var z=this.gb(e),k=this.X(e),h=f.Io(g,m-d-1);0==d&&(h.Bn(b),this.bh(e,b));
322==h.D()?this.Fh(z,null):this.Fh(z,a.T.Yj(h));h.En(b);d<m-1?e=this.vl(c,k,b):this.bh(n,b)}};g.prototype.wC=function(){var e=new a.i;e.Ja();for(var f=this.Gp(),g=new a.b,b=!0,c=f.next();-1!=c;c=f.next())this.w(c,g),b?e.Db(g.x,g.y):e.Oj(g.x,g.y),b=!1;return e};g.prototype.Eb=function(e){var f=e.D();if(a.T.Kc(f))return this.MJ(e);if(550==f)return this.NJ(e);throw a.g.wa();};g.prototype.YJ=function(e,f){var g=f.D();if(a.T.Kc(g))this.WA(e,f);else if(550==g)this.XA(e,f);else throw a.g.wa();};g.prototype.QJ=
function(e,f){var g=this.jg(1736,e.description);if(2>e.Ha(f))return g;this.Hk.Pd(e,e.Ea(f),e.Dc(f));this.zp=this.wb.mc(0);var b=this.Cf(g,-1);this.Gn(b,e.vc(f)||!0);var c=null!=this.Ge&&null!=e.Fe,d=e.Ea(f);for(f=e.Dc(f);d<f;d++){var m=this.vl(b,-1,null);if(c)if(m=this.gb(m),0!=(e.NC(d)&1))this.Fh(m,null);else{var z=new a.Ag;e.cc(d,z,!0);this.Fh(m,z.get())}}return g};g.prototype.hf=function(e){var f=this.Lb(e),g=a.sH.jg(f,this.Hk.description),b=this.F(e);if(0==b)return g;if(a.T.Kc(f)){for(var f=this.ea(e),
c=a.Ac.Dg(f+1),d=a.Ac.to(f+1,0),m=g.description,z=0,k=m.Aa;z<k;z++){for(var h=m.Hd(z),q=a.pa.Wa(h),l=a.Ac.Tv(h,b),v=this.wb.mc(h),t=0,y=0,r=0,B=this.Vb(e);-1!=B;B=this.bc(B)){var E=0;this.vc(B)&&(E|=1);this.VO(B)&&(E|=4);0!=E&&d.xy(y,E);var u=this.Ha(B);c.write(y++,r);r+=u;if(0==h)for(var u=v,C=l,D=new a.b,E=this.Cb(B);t<r;E=this.X(E),t++){var O=this.gb(E);u.ec(2*O,D);C.Rn(2*t,D)}else for(E=this.Cb(B);t<r;E=this.X(E),t++)for(O=this.gb(E),C=0;C<q;C++)D=v.Bh(O*q+C),l.Uk(t*q+C,D)}g.bm(h,l);c.write(f,
b)}g.NF(d);g.OF(c);g.ce(16777215)}else if(550==f){m=g.description;g.resize(b);z=0;for(k=m.Aa;z<k;z++){h=m.Hd(z);q=a.pa.Wa(h);l=g.mc(h);v=this.wb.mc(h);t=0;B=this.Vb(e);u=this.Ha(B);for(E=this.Cb(B);t<u;E=this.X(E),t++)for(O=this.gb(E),C=0;C<q;C++)D=v.Bh(O*q+C),l.Uk(t*q+C,D);g.bm(h,l)}g.ce(16777215)}return g};g.prototype.sy=function(e){for(var a=this.Vb(e);-1!=a;a=this.Cr(a));var a=this.aO(e),g=this.we(e);-1!=a?this.MF(a,g):this.$c=g;-1!=g?this.QF(g,a):this.Xt=a;this.bN(e)};g.prototype.jg=function(e,
f){return void 0===f?this.QB(e,a.Od.Tf()):this.QB(e,f)};g.prototype.QB=function(e,f){e=this.jQ(e);null==this.wb?this.wb=this.Hk=new a.pe(f):this.Hk.Ik(f);this.wp=this.Hk.description;this.kx=1<this.wp.Aa;-1==this.$c?this.$c=e:(this.QF(e,this.Xt),this.MF(this.Xt,e));return this.Xt=e};g.prototype.we=function(e){return this.Mc.O(e,1)};g.prototype.aO=function(e){return this.Mc.O(e,0)};g.prototype.Lb=function(e){return this.Mc.O(e,2)&2147483647};g.prototype.EF=function(e,f,g){f=this.Ej[f];e=this.xC(e);
e>=f.size&&f.resize(Math.max(a.I.truncate(1.25*e),16),-1);f.write(e,g)};g.prototype.yC=function(e,a){e=this.xC(e);a=this.Ej[a];return e<a.size?a.read(e):-1};g.prototype.RB=function(){null==this.Ej&&(this.Ej=[]);for(var e=0;e<this.Ej.length;e++)if(null==this.Ej[e])return this.Ej[e]=a.Ac.Dg(0),e;this.Ej.push(a.Ac.Dg(0));return this.Ej.length-1};g.prototype.tR=function(e){this.Ej[e]=null};g.prototype.Vb=function(e){return this.Mc.O(e,3)};g.prototype.Ys=function(e){return this.Mc.O(e,4)};g.prototype.F=
function(e){return this.Mc.O(e,5)};g.prototype.ea=function(e){return this.Mc.O(e,6)};g.prototype.xo=function(e,f,g){for(var n=0,b=this.$c;-1!=b;b=this.we(b)){var c=this.Lb(b);if(a.T.Kc(c)&&(!g||1736==c))for(var c=1736==this.Lb(b),d=this.Vb(b);-1!=d;){for(var m=0,z=this.Cb(d);m<a.I.truncate(this.Ha(d)/2);){var k=this.X(z);if(-1==k)break;var h=this.gb(z),q=this.Fi(h);null!=q?h=q.$b():(q=this.gb(k),h=this.wb.mv(h,q));h<=e?(0==h?0==n&&(n=-1):n=1,k!=this.hk(d)&&(this.Zy(k,z),this.vf(k,!0))):z=this.X(z);
m++}m=this.Cb(d);for(z=this.vc(d)?m:this.hk(d);0<this.Ha(d);)if(k=this.Ua(z),-1!=k){var l=this.gb(k),q=this.Fi(l);null!=q?h=q.$b():(h=this.gb(z),h=this.wb.mv(h,l));if(h<=e)0==h?0==n&&(n=-1):n=1,this.Zy(k,z),this.vf(k,!1),m==k&&(m=this.Cb(d));else if(z=this.Ua(z),z==m)break}else{this.vf(z,!0);0==n&&(n=-1);break}z=this.Ha(d);f&&(c?3>z:2>z)?(d=this.Cr(d),n=0<z?1:0==n?-1:n):d=this.bc(d)}}return n};g.prototype.Zy=function(e,a){var f=this.gb(e),g=this.gb(a);null!=this.wg&&(f=this.wg.read(f),this.wg.write(g,
f));if(null!=this.sh)for(g=0,f=this.sh.length;g<f;g++)if(null!=this.sh[g]){var b=this.Ra(e,g);-1!=b&&this.lb(a,g,b)}};g.prototype.Mr=function(e,f,g){var n=0,b=this.X(e);if(-1==b)throw a.g.wa();for(var c=this.gb(e),d=this.gb(b),m=this.Fi(c),z=null==m?this.wb.mv(c,d):m.$b(),k=0;k<g;k++){var h=f[k];if(0<h&&1>h){var q=h;null!=m&&(q=0<z?m.rA(h)/z:0);this.wb.vJ(c,d,q,this.Fo());var l=this.vl(this.rd(e),b,this.Fo());n++;if(null!=m){var v=m.xm(0,h),q=this.gb(this.Ua(l));this.Fh(q,v);this.Yi(l,v.oc());if(k==
g-1||1==f[k+1])h=m.xm(h,1),this.Fh(q,h)}}}return n};g.prototype.bh=function(e,a){var f=this.gb(e);this.wb.Iu(f,a);f=this.Fi(f);null!=f&&f.setStart(a);e=this.Ua(e);-1!=e&&(e=this.gb(e),null!=this.Fi(e)&&f.setEnd(a))};g.prototype.Jk=function(e,a){e=this.gb(e);this.wb.Sd(e,a)};g.prototype.Yi=function(e,a){this.ic(e,a.x,a.y)};g.prototype.ic=function(e,a,g){var f=this.gb(e);this.wb.ic(f,a,g);f=this.Fi(f);null!=f&&f.Ny(a,g);e=this.Ua(e);-1!=e&&(e=this.gb(e),null!=this.Fi(e)&&f.Ok(a,g))};g.prototype.w=function(e,
a){this.wb.w(this.cd.O(e,0),a)};g.prototype.uc=function(e,a){this.wb.Ba[0].ec(2*this.cd.O(e,0),a)};g.prototype.Fa=function(e){var f=new a.b;this.wb.w(this.cd.O(e,0),f);return f};g.prototype.SC=function(e,a){this.zp.ec(2*e,a)};g.prototype.ld=function(e,a,g){return this.wb.ld(e,this.gb(a),g)};g.prototype.setAttribute=function(e,a,g,b){this.wb.setAttribute(e,this.gb(a),g,b)};g.prototype.gb=function(e){return this.cd.O(e,0)};g.prototype.mk=function(e){var f=new a.b;this.w(e,f);return f.y};g.prototype.Cq=
function(e,a){e=this.gb(e);a=this.gb(a);var f=this.wb.Ba[0].f;return f[2*e]===f[2*a]&&f[2*e+1]===f[2*a+1]};g.prototype.pt=function(e,a){e=this.gb(e);var f=this.wb.Ba[0].f;return f[2*e]===a.x&&f[2*e+1]===a.y};g.prototype.pS=function(e,f){1>f&&(f=1);if(null==this.wg){if(1==f)return;this.wg=a.Ac.kl(this.wb.F(),1)}e=this.gb(e);e>=this.wg.size&&this.wg.resize(e+1,1);this.wg.write(e,f)};g.prototype.RC=function(e){e=this.gb(e);return null==this.wg||e>=this.wg.size?1:this.wg.read(e)};g.prototype.lb=function(e,
a,g){a=this.sh[a];e=this.gb(e);a.size<this.wb.F()&&a.resize(this.wb.F(),-1);a.write(e,g)};g.prototype.Ra=function(e,a){e=this.gb(e);a=this.sh[a];return e<a.size?a.read(e):-1};g.prototype.re=function(){null==this.sh&&(this.sh=[]);for(var e=0;e<this.sh.length;e++)if(null==this.sh[e])return this.sh[e]=a.Ac.Dg(0,-1),e;this.sh.push(a.Ac.Dg(0,-1));return this.sh.length-1};g.prototype.bf=function(e){this.sh[e]=null};g.prototype.cc=function(e){return null!=this.Ge?(e=this.gb(e),this.Ge[e]):null};g.prototype.Oc=
function(e,f){var g=this.cd.O(e,2);if(-1==g)return!1;if(this.kx){var b=new a.Va;this.Jk(e,b);f.setStart(b);this.Jk(g,b);f.setEnd(b)}else this.wb.uc(this.cd.O(e,0),J),f.gl(0,J),this.wb.uc(this.cd.O(g,0),J),f.gl(1,J);return!0};g.prototype.gR=function(e,f,g){if(this.kx){var n=new a.Va;this.Jk(e,n);g.setStart(n);this.Jk(f,n);g.setEnd(n)}else this.wb.uc(e,J),g.gl(0,J),this.wb.uc(f,J),g.gl(1,J)};g.prototype.Cf=function(e,f){var g;if(-1!=f){if(e!=this.Vf(f))throw a.g.wa();g=this.wq(f)}else g=this.Ys(e);
var b=this.lQ(e);-1!=f&&this.Mn(f,b);this.Ln(b,f);this.Mn(b,g);-1!=g?this.Ln(g,b):this.Jn(e,b);-1==f&&this.Kn(e,b);this.gm(e,this.ea(e)+1);return b};g.prototype.aD=function(e,a,g,b){e=this.Cf(e,-1);for(var f=0,n=a,c=!1;n==g&&(c=!0),this.im(n,e),f++,n=this.X(n),n!=a;);this.Gn(e,!0);this.hm(e,f);c&&(a=g);this.Dh(e,a);this.Wi(e,this.Ua(a));this.Jr(e,!1);null!=b&&(b[0]=c);return e};g.prototype.Cr=function(e){var a=this.wq(e),g=this.bc(e),b=this.Vf(e);-1!=a?this.Ln(a,g):this.Jn(b,g);-1!=g?this.Mn(g,a):
this.Kn(b,a);this.bL(e);this.gm(b,this.ea(b)-1);this.iC(e);return g};g.prototype.bL=function(e){var a=this.Cb(e);if(-1!=a){for(var g=0,b=this.Ha(e);g<b;g++){var c=a,a=this.X(a);this.dw(c)}a=this.Vf(e);this.Pk(a,this.F(a)-this.Ha(e))}this.hm(e,0)};g.prototype.bc=function(e){return this.Rc.O(e,2)};g.prototype.wq=function(e){return this.Rc.O(e,1)};g.prototype.Ha=function(e){return this.Rc.O(e,3)};g.prototype.vc=function(e){return 0!=(this.Ho(e)&1)};g.prototype.Gn=function(e,a){if(this.vc(e)!=a){if(0<
this.Ha(e)){var f=this.Cb(e),g=this.hk(e);a?(this.Sc(g,f),this.Tc(f,g)):(this.Sc(g,-1),this.Tc(f,-1));f=this.gb(g);this.Fh(f,null)}this.Iy(e,(this.Ho(e)|1)-1|(a?1:0))}};g.prototype.Vf=function(e){return this.Rc.O(e,7)};g.prototype.VO=function(e){return 0!=(this.Ho(e)&2)};g.prototype.Dy=function(e,a){this.Iy(e,(this.Ho(e)|2)-2|(a?2:0))};g.prototype.Gw=function(e){if(this.bP(e))return this.fi.get(this.bt(e));var f=new a.yb,g=this.Cb(e);if(-1==g)return 0;var b=new a.b;this.w(g,b);for(var c=0,d=0,m=this.Ha(e);d<
m;d++,g=this.X(g)){var z=this.cc(g);if(null==z){if(!this.Oc(g,f))continue;z=f}c+=z.kv(b.x,b.y)}this.Jr(e,!0);this.fi.set(this.bt(e),c);return c};g.prototype.Rp=function(e,a,g){a=this.Jj[a];e=this.bt(e);a.size<this.fi.size&&a.resize(this.fi.size,-1);a.write(e,g)};g.prototype.Ei=function(e,a){e=this.bt(e);a=this.Jj[a];return e<a.size?a.read(e):-1};g.prototype.Uv=function(){null==this.Jj&&(this.Jj=[]);for(var e=0;e<this.Jj.length;e++)if(null==this.Jj[e])return this.Jj[e]=a.Ac.Dg(0),e;this.Jj.push(a.Ac.Dg(0));
return this.Jj.length-1};g.prototype.ty=function(e){this.Jj[e]=null};g.prototype.bQ=function(e,f,g){if(-1==g)throw a.g.N();if(f!=g){var n=this.bc(g),b=this.wq(g),c=this.Vf(g);-1==b?this.Jn(c,n):this.Ln(b,n);-1==n?this.Kn(c,b):this.Mn(n,b);this.Pk(c,this.F(c)-this.Ha(g));this.gm(c,this.ea(c)-1);b=-1==f?this.Ys(e):this.wq(f);this.Mn(g,b);this.Ln(g,f);-1==f?this.Kn(e,g):this.Mn(f,g);-1==b?this.Jn(e,g):this.Ln(b,g);this.Pk(e,this.F(e)+this.Ha(g));this.gm(e,this.ea(e)+1);this.Hu(g,e)}};g.prototype.zi=
function(e,a){this.wb.Sd(this.gb(a),this.Fo());this.vl(e,-1,this.Fo())};g.prototype.vf=function(e,f){var g=this.rd(e),b=this.Ua(e),c=this.X(e);-1!=b&&this.Sc(b,c);var d=this.Ha(g);e==this.Cb(g)&&this.Dh(g,1<d?c:-1);-1!=c&&this.Tc(c,b);e==this.hk(g)&&this.Wi(g,1<d?b:-1);if(-1!=b&&-1!=c){var b=this.gb(b),m=this.gb(c);f?(f=this.Fi(b),null!=f&&(b=new a.b,this.wb.w(m,b),f.vd(b))):(m=this.gb(e),f=this.Fi(m),this.Fh(b,f),null!=f&&(b=this.wb.Fa(b),f.ed(b)))}this.hm(g,d-1);g=this.Vf(g);this.Pk(g,this.F(g)-
1);this.dw(e);return c};g.prototype.Cb=function(e){return this.Rc.O(e,4)};g.prototype.hk=function(e){return this.Rc.O(e,5)};g.prototype.X=function(e){return this.cd.O(e,2)};g.prototype.Ua=function(e){return this.cd.O(e,1)};g.prototype.rd=function(e){return this.cd.O(e,3)};g.prototype.Ub=function(e,a){return this.vl(e,-1,a)};g.prototype.Gp=function(e){if(void 0===e)return this.Gp(!1);if(e instanceof c)return new c(e);var f,g=-1,b=-1,d=-1,m=0,z=!1;for(f=this.$c;-1!=f;f=this.we(f))if(!e||a.T.Kc(this.Lb(f))){for(g=
this.Vb(f);-1!=g;g=this.bc(g))if(d=b=this.Cb(g),m=0,-1!=b){z=!0;break}if(z)break}return c.UL(this,f,g,b,d,m,e)};g.prototype.Oe=function(e){this.Hk.Oe(e);if(null!=this.Ge)for(var a=0,g=this.Ge.length;a<g;a++)null!=this.Ge[a]&&this.Ge[a].Oe(e)};g.prototype.Tp=function(e,a,g,b){b?this.DS(e,a,g):this.CS(e,a,g)};g.prototype.Tc=function(e,a){this.cd.L(e,1,a)};g.prototype.Sc=function(e,a){this.cd.L(e,2,a)};g.prototype.im=function(e,a){this.cd.L(e,3,a)};g.prototype.hm=function(e,a){this.Rc.L(e,3,a)};g.prototype.Dh=
function(e,a){this.Rc.L(e,4,a)};g.prototype.Wi=function(e,a){this.Rc.L(e,5,a)};g.prototype.gm=function(e,a){this.Mc.L(e,6,a)};g.prototype.Pk=function(e,a){this.Mc.L(e,5,a)};g.prototype.lF=function(e){var a=e;do{var g=this.X(a);this.Sc(a,this.Ua(a));this.Tc(a,g);a=g}while(a!=e)};g.prototype.ZF=function(e){this.pd=e};g.prototype.yu=function(e){var a=this.wq(e),g=this.bc(e),b=this.Vf(e);-1!=a?this.Ln(a,g):this.Jn(b,g);-1!=g?this.Mn(g,a):this.Kn(b,a);this.Dh(e,-1);this.Wi(e,-1);this.iC(e)};g.prototype.Ui=
function(e,f){var g=this.Ua(e),b=this.X(e);-1!=g&&this.Sc(g,b);-1!=b&&this.Tc(b,g);if(-1!=g&&-1!=b)if(g=this.gb(g),b=this.gb(b),f){if(f=this.Fi(g),null!=f){var c=new a.b;this.wb.w(b,c);f.vd(c)}}else b=this.gb(e),f=this.Fi(b),this.Fh(g,f),null!=f&&(c=new a.b,this.wb.w(g,c),f.ed(c));this.dw(e)};g.prototype.bP=function(e){return 0!=(this.Ho(e)&4)};g.prototype.Jr=function(e,a){this.Iy(e,(this.Ho(e)|4)-4|(a?4:0))};g.prototype.Mu=function(e,a){var f=this.cd.f;this.wb.kc();var g=this.wb.Ba[0].f;e.xd(0,a,
function(e,a){e=f[5*e];a=f[5*a];var n=g[2*e];e=g[2*e+1];var b=g[2*a];a=g[2*a+1];return e<a?-1:e>a?1:n<b?-1:n>b?1:0})};g.prototype.pO=function(){for(var e=this.$c;-1!=e;e=this.we(e))if(!a.T.Kc(this.Lb(e)))return!0;return!1};g.prototype.Vy=function(e,a){for(var f=this.Vb(e),g=this.Vb(a),b=this.Ys(e),c=this.Ys(a),d=this.Vb(e);-1!=d;d=this.bc(d))this.Hu(d,a);for(d=this.Vb(a);-1!=d;d=this.bc(d))this.Hu(d,e);this.Jn(e,g);this.Jn(a,f);this.Kn(e,c);this.Kn(a,b);f=this.F(e);g=this.ea(e);b=this.ea(a);this.Pk(e,
this.F(a));this.Pk(a,f);this.gm(e,b);this.gm(a,g);f=this.Mc.O(e,2);this.Mc.L(e,2,this.Mc.O(a,2));this.Mc.L(a,2,f)};return g}();a.fd=b})(E||(E={}));(function(a){var b=function(b){function g(e,f,g,c){b.call(this);this.R=new a.i;void 0===e?this.MB():"number"===typeof e?this.AL(e,f,g,c):e instanceof a.Va?void 0!==f?this.Ks(e,f,g):this.BL(e):e instanceof a.pa?void 0!==f?this.DL(e,f):this.CL(e):e instanceof a.i?this.zL(e):this.MB()}m(g,b);g.prototype.Ks=function(e,f,g){this.description=a.Od.Tf();this.R.Ja();
e.s()||this.sv(e,f,g)};g.prototype.zL=function(e){this.description=a.Od.Tf();this.R.K(e);this.R.normalize()};g.prototype.CL=function(e){if(null==e)throw a.g.N();this.description=e;this.R.Ja()};g.prototype.DL=function(e,f){if(null==e)throw a.g.N();this.description=e;this.R.K(f);this.R.normalize()};g.prototype.MB=function(){this.description=a.Od.Tf();this.R.Ja()};g.prototype.BL=function(e){this.description=a.Od.Tf();this.R.Ja();e.s()||this.sv(e)};g.prototype.AL=function(e,f,g,b){this.description=a.Od.Tf();
this.K(e,f,g,b)};g.prototype.K=function(e,a,g,b){this.qc();if("number"===typeof e)this.R.K(e,a,g,b);else for(this.Ja(),a=0,g=e.length;a<g;a++)this.Db(e[a])};g.prototype.Cu=function(e){this.qc();if(!e.dP())throw a.g.N();this.R.K(e)};g.prototype.Ja=function(){this.qc();this.R.Ja()};g.prototype.s=function(){return this.R.s()};g.prototype.aa=function(){return this.R.aa()};g.prototype.ba=function(){return this.R.ba()};g.prototype.lw=function(){return this.R.lw()};g.prototype.Vs=function(){return this.R.Vs()};
g.prototype.qq=function(){return this.R.Af()};g.prototype.Db=function(e){if(e instanceof a.b)this.qc(),this.R.Db(e);else if(e instanceof a.i)this.qc(),this.R.Db(e);else if(e instanceof a.Va){if(this.qc(),!e.sc()){var f=e.description;this.description!=f&&this.Ik(f);if(this.s())this.sv(e);else{this.R.Db(e.w());for(var n=1,b=f.Aa;n<b;n++)for(var c=f.Fd(n),d=a.pa.Wa(c),m=0;m<d;m++){var z=e.ld(c,m),k=this.Ah(c,m);k.Db(z);setInterval(c,m,k)}}}}else if(e instanceof g&&!e.s())for(f=e.description,f!=this.description&&
this.Ik(f),this.R.Db(e.R),n=1,b=f.Aa;n<b;n++)for(c=f.Hd(n),d=a.pa.Wa(c),m=0;m<d;m++)z=e.Ah(c,m),k=this.Ah(c,m),k.Db(z),setInterval(c,m,k)};g.prototype.sv=function(e,f,g){if(void 0!==f){this.R.K(e.w(),f,g);f=e.description;g=1;for(var n=f.Aa;g<n;g++)for(var b=f.Fd(g),c=a.pa.Wa(b),d=0;d<c;d++){var m=e.ld(b,d);this.setInterval(b,d,m,m)}}else for(this.R.K(e.fa[0],e.fa[1]),f=e.description,g=1,n=f.Aa;g<n;g++)for(b=f.Fd(g),c=a.pa.Wa(b),d=0;d<c;d++)m=e.ld(b,d),this.setInterval(b,d,m,m)};g.prototype.setInterval=
function(e,f,g,b){var n=null;"number"===typeof g?n=new a.Nd(g,b):n=g;this.qc();if(0==e)if(0==f)this.R.v=n.qa,this.R.B=n.va;else if(1==f)this.R.C=n.qa,this.R.G=n.va;else throw a.g.Uc();else this.DA(0,e,f,n.qa),this.DA(1,e,f,n.va)};g.prototype.P=function(e,a){this.qc();this.R.P(e,a)};g.prototype.Oe=function(e){if(e instanceof a.Bg)this.qc(),e.$y(this.R);else if(this.qc(),!this.R.s()){var f=new a.fH;this.Cn(f);f.UO()?f.Ja():e.$y(f)}};g.prototype.copyTo=function(e){if(e.D()!=this.D())throw a.g.N();e.qc();
e.description=this.description;e.R.K(this.R);e.fa=null;if(null!=this.fa){e.ns();for(var f=0;f<2*(this.description.le.length-2);f++)e.fa[f]=this.fa[f]}};g.prototype.Pa=function(){return new g(this.description)};g.prototype.Mh=function(){return this.R.rN()};g.prototype.$b=function(){return this.R.CC()};g.prototype.D=function(){return 197};g.prototype.fb=function(){return 2};g.prototype.Fp=function(e){this.copyTo(e)};g.prototype.o=function(e){e.v=this.R.v;e.C=this.R.C;e.B=this.R.B;e.G=this.R.G};g.prototype.Cn=
function(e){e.v=this.R.v;e.C=this.R.C;e.B=this.R.B;e.G=this.R.G;e.K(this.R.v,this.R.C,this.yd(0,1,0),this.R.B,this.R.G,this.yd(1,1,0))};g.prototype.Ah=function(e,f){var g=new a.Nd;g.K(this.yd(0,e,f),this.yd(1,e,f));return g};g.prototype.uf=function(e,f){f.Qf(this.description);var g=this.description.Aa-1;switch(e){case 0:for(e=0;e<g;e++)for(var b=this.description.Hd(e),c=a.pa.Wa(b),d=0;d<c;d++)f.setAttribute(b,d,this.yd(0,b,d));f.ic(this.R.v,this.R.C);break;case 1:for(e=0;e<g;e++)for(b=this.description.Hd(e),
c=a.pa.Wa(b),d=0;d<c;d++)f.setAttribute(b,d,this.yd(1,b,d));f.ic(this.R.v,this.R.G);break;case 2:for(e=0;e<g;e++)for(b=this.description.Hd(e),c=a.pa.Wa(b),d=0;d<c;d++)f.setAttribute(b,d,this.yd(0,b,d));f.ic(this.R.B,this.R.G);break;case 3:for(e=0;e<g;e++)for(b=this.description.Hd(e),c=a.pa.Wa(b),d=0;d<c;d++)f.setAttribute(b,d,this.yd(1,b,d));f.ic(this.R.B,this.R.C);break;default:throw a.g.Uc();}};g.prototype.vu=function(e,a){e=this.R.vu(e);a.ma(e.x,e.y)};g.prototype.zN=function(e,a){return a*(e.up-
2)};g.prototype.mC=function(e,f,g){if(this.R.s())throw a.g.ra("empty geometry");if(0==f)return 0!=e?0!=g?this.R.G:this.R.B:0!=g?this.R.C:this.R.v;if(g>=a.pa.Wa(f))throw a.g.N();var n=this.description.zf(f);this.ns();return 0<=n?this.fa[this.zN(this.description,e)+this.description.XN(n)-2+g]:a.pa.ue(f)};g.prototype.ns=function(){this.qc();if(null==this.fa&&2<this.description.le.length){this.fa=[];for(var e=g.V(this.description,0),f=g.V(this.description,1),n=0,b=1,c=this.description.Aa;b<c;b++)for(var d=
this.description.Hd(b),m=a.pa.Wa(d),d=a.pa.ue(d),z=0;z<m;z++)this.fa[e+n]=d,this.fa[f+n]=d,n++}};g.prototype.nm=function(e){if(null!=this.fa)if(2<e.le.length){for(var f=a.Od.iu(e,this.description),n=[],b=g.V(this.description,0),c=g.V(this.description,1),d=g.V(e,0),m=g.V(e,1),z=0,k=1,h=e.Aa;k<h;k++){var q=e.Hd(k),l=a.pa.Wa(q);if(-1==f[k])for(var v=a.pa.ue(q),q=0;q<l;q++)n[d+z]=v,n[m+z]=v,z++;else for(v=this.description.fj(f[k])-2,q=0;q<l;q++)n[d+z]=this.fa[b+v],n[m+z]=this.fa[c+v],z++,v++}this.fa=
n}else this.fa=null;this.description=e};g.prototype.yd=function(e,f,n){if(this.R.s())throw a.g.ra("This operation was performed on an Empty Geometry.");if(0==f)return 0!=e?0!=n?this.R.G:this.R.B:0!=n?this.R.C:this.R.v;if(n>=a.pa.Wa(f))throw a.g.Uc();var b=this.description.zf(f);return 0<=b?(this.ns(),this.fa[g.V(this.description,e)+this.description.fj(b)-2+n]):a.pa.ue(f)};g.prototype.DA=function(e,f,n,b){this.qc();if(0==f)0!=e?0!=n?this.R.G=b:this.R.B=b:0!=n?this.R.C=b:this.R.v=b;else{if(n>=a.pa.Wa(f))throw a.g.Uc();
if(!this.hasAttribute(f)){if(a.pa.nD(f,b))return;this.Ne(f)}f=this.description.zf(f);this.ns();this.fa[g.V(this.description,e)+this.description.fj(f)-2+n]=b}};g.V=function(e,a){return a*(e.le.length-2)};g.prototype.Ga=function(e){this.qc();var f=new a.i;e.o(f);return this.R.Ga(f)};g.prototype.jc=function(e){return e instanceof a.i?this.R.jc(e):this.R.jc(e.R)};g.prototype.offset=function(e,a){this.qc();this.R.offset(e,a)};g.prototype.normalize=function(){this.qc();this.R.normalize()};g.prototype.Af=
function(e){if(void 0!==e)if(e.Qf(this.description),this.s())e.Ja();else{for(var f=this.description.Aa,g=1;g<f;g++)for(var b=this.description.Hd(g),c=a.pa.Wa(b),d=0;d<c;d++){var m=.5*(this.mC(0,b,d)+this.mC(1,b,d));e.setAttribute(b,d,m)}e.ic(this.R.Af())}else{e=new a.Va(this.description);if(this.s())return e;f=this.description.Aa;for(g=1;g<f;g++)for(b=this.description.Fd(g),c=a.pa.Wa(b),d=0;d<c;d++)m=.5*(this.yd(0,b,d)+this.yd(1,b,d)),e.setAttribute(b,d,m);e.ic(this.R.lw(),this.R.Vs());return e}};
g.prototype.yw=function(){return new a.Va(this.R.yw())};g.prototype.contains=function(e){return e instanceof a.Va?e.s()?!1:this.R.contains(e.lk(),e.mk()):this.R.contains(e.R)};g.prototype.lc=function(e){if(e==this)return!0;if(!(e instanceof g)||this.description!=e.description)return!1;if(this.s())return e.s()?!0:!1;if(!this.R.lc(e.R))return!1;for(var a=0,n=2*(this.description.le.length-2);a<n;a++)if(this.fa[a]!=e.fa[a])return!1;return!0};g.prototype.hc=function(){var e=this.description.hc(),e=a.I.kg(e,
this.R.hc());if(!this.s()&&null!=this.fa)for(var f=0,g=2*(this.description.le.length-2);f<g;f++)e=a.I.kg(e,this.fa[f]);return e};g.prototype.Rf=function(){return a.Hh.il(this,null)};g.prototype.toString=function(){return this.s()?"Envelope: []":"Envelope: ["+this.R.v+", "+this.R.C+", "+this.R.B+", "+this.R.G+"]"};return g}(a.T);a.Vj=b})(E||(E={}));(function(a){var b=function(){function b(a,e,f,n){void 0===a?this.Ja():(this.v=a,this.C=e,this.B=f,this.G=n)}b.Oa=function(a,e,f,n){var g=new b;g.v=a;g.C=
e;g.B=f;g.G=n;return g};b.prototype.K=function(g,e,f,n){"number"===typeof g?void 0!==f?(this.v=g,this.C=e,this.B=f,this.G=n,this.normalize()):(this.v=g,this.C=e,this.B=g,this.G=e):g instanceof a.b?void 0!==e?(this.v=g.x-.5*e,this.B=this.v+e,this.C=g.y-.5*f,this.G=this.C+f,this.normalize()):(this.v=g.x,this.C=g.y,this.B=g.x,this.G=g.y):g instanceof b?this.K(g.v,g.C,g.B,g.G):g instanceof a.Nd&&(g.s()||e.s()?this.Ja():(this.v=g.qa,this.B=g.va,this.C=e.qa,this.G=e.va))};b.prototype.IN=function(a,e){var f=
new b;f.K(this.v,this.C,this.B,this.G);f.P(a,e);return f};b.prototype.Ey=function(a,e){if(void 0!==e)if(0==e)this.Ja();else{this.v=a[0].x;this.C=a[0].y;this.B=this.v;this.G=this.C;for(var f=1;f<e;f++){var g=a[f];g.x<this.v?this.v=g.x:g.x>this.B&&(this.B=g.x);g.y<this.C?this.C=g.y:g.y>this.G&&(this.G=g.y)}}else if(null==a||0==a.length)this.Ja();else for(g=a[0],this.K(g.x,g.y),f=1;f<a.length;f++)g=a[f],this.Oj(g.x,g.y)};b.prototype.Ja=function(){this.G=this.B=this.C=this.v=NaN};b.prototype.s=function(){return isNaN(this.v)};
b.prototype.Db=function(g,e){"number"===typeof g?this.s()?(this.v=g,this.C=e,this.B=g,this.G=e):(this.v>g?this.v=g:this.B<g&&(this.B=g),this.C>e?this.C=e:this.G<e&&(this.G=e)):g instanceof a.b?this.Db(g.x,g.y):g instanceof a.ee?this.Db(g.x,g.y):g instanceof b&&!g.s()&&(this.Db(g.v,g.C),this.Db(g.B,g.G))};b.prototype.Oj=function(a,e){this.v>a?this.v=a:this.B<a&&(this.B=a);this.C>e?this.C=e:this.G<e&&(this.G=e)};b.prototype.P=function(a,e){this.s()||(this.v-=a,this.B+=a,this.C-=e,this.G+=e,(this.v>
this.B||this.C>this.G)&&this.Ja())};b.prototype.scale=function(a){0>a&&this.Ja();this.s()||(this.v*=a,this.B*=a,this.C*=a,this.G*=a)};b.prototype.jc=function(a){return!this.s()&&!a.s()&&(this.v<=a.v?this.B>=a.v:a.B>=this.v)&&(this.C<=a.C?this.G>=a.C:a.G>=this.C)};b.prototype.rD=function(a){return(this.v<=a.v?this.B>=a.v:a.B>=this.v)&&(this.C<=a.C?this.G>=a.C:a.G>=this.C)};b.prototype.Ga=function(a){if(this.s()||a.s())return!1;a.v>this.v&&(this.v=a.v);a.B<this.B&&(this.B=a.B);a.C>this.C&&(this.C=a.C);
a.G<this.G&&(this.G=a.G);(a=this.v<=this.B&&this.C<=this.G)||this.Ja();return a};b.prototype.vu=function(g){switch(g){case 0:return a.b.Oa(this.v,this.C);case 1:return a.b.Oa(this.v,this.G);case 2:return a.b.Oa(this.B,this.G);case 3:return a.b.Oa(this.B,this.C);default:throw a.g.Uc();}};b.prototype.hy=function(g){if(null==g||4>g.length)throw a.g.N();null!=g[0]?g[0].ma(this.v,this.C):g[0]=a.b.Oa(this.v,this.C);null!=g[1]?g[1].ma(this.v,this.G):g[1]=a.b.Oa(this.v,this.G);null!=g[2]?g[2].ma(this.B,this.G):
g[2]=a.b.Oa(this.B,this.G);null!=g[3]?g[3].ma(this.B,this.C):g[3]=a.b.Oa(this.B,this.C)};b.prototype.rN=function(){return this.s()?0:this.aa()*this.ba()};b.prototype.CC=function(){return this.s()?0:2*(this.aa()+this.ba())};b.prototype.lw=function(){return(this.B+this.v)/2};b.prototype.Vs=function(){return(this.G+this.C)/2};b.prototype.aa=function(){return this.B-this.v};b.prototype.ba=function(){return this.G-this.C};b.prototype.move=function(a,e){this.s()||(this.v+=a,this.C+=e,this.B+=a,this.G+=
e)};b.prototype.offset=function(a,e){this.v+=a;this.B+=a;this.C+=e;this.G+=e};b.prototype.normalize=function(){if(!this.s()){var a=Math.min(this.v,this.B),e=Math.max(this.v,this.B);this.v=a;this.B=e;a=Math.min(this.C,this.G);e=Math.max(this.C,this.G);this.C=a;this.G=e}};b.prototype.Yl=function(a){a.ma(this.v,this.C)};b.prototype.YE=function(a){a.ma(this.B,this.C)};b.prototype.aF=function(a){a.ma(this.v,this.G)};b.prototype.Zl=function(a){a.ma(this.B,this.G)};b.prototype.dP=function(){return this.s()||
this.v<=this.B&&this.C<=this.G};b.prototype.Af=function(){return a.b.Oa((this.B+this.v)/2,(this.G+this.C)/2)};b.prototype.yw=function(){return a.b.Oa(this.v,this.C)};b.prototype.contains=function(g,e){if(void 0!==e)return g>=this.v&&g<=this.B&&e>=this.C&&e<=this.G;if(g instanceof a.Va)return this.contains(g.lk(),g.mk());if(g instanceof a.b)return this.contains(g.x,g.y);if(g instanceof b)return g.v>=this.v&&g.B<=this.B&&g.C>=this.C&&g.G<=this.G;throw a.g.N();};b.prototype.jl=function(g,e){if(void 0!==
e)return g>this.v&&g<this.B&&e>this.C&&e<this.G;if(g instanceof a.b)return this.jl(g.x,g.y);if(g instanceof b)return g.v>this.v&&g.B<this.B&&g.C>this.C&&g.G<this.G;throw a.g.N();};b.prototype.lc=function(a){return a==this?!0:a instanceof b?this.s()&&a.s()?!0:this.v!=a.v||this.C!=a.C||this.B!=a.B||this.G!=a.G?!1:!0:!1};b.prototype.hc=function(){var g=this.v,g=a.I.truncate(g^g>>>32),e=a.I.kg(g),g=this.B,g=a.I.truncate(g^g>>>32),e=a.I.kg(g,e),g=this.C,g=a.I.truncate(g^g>>>32),e=a.I.kg(g,e),g=this.G,
g=a.I.truncate(g^g>>>32);return e=a.I.kg(g,e)};b.prototype.vv=function(g){var e=new a.b;e.J(g);if(e.pv())return e;if(this.s())return e.FA(),e;e.x<this.v?e.x=this.v:e.x>this.B&&(e.x=this.B);e.y<this.C?e.y=this.C:e.y>this.G&&(e.y=this.G);if(!e.lc(g))return e;g=this.Af();(e.x<g.x?e.x-this.v:this.B-e.x)<(e.y<g.y?e.y-this.C:this.G-e.y)?e.x=e.x<g.x?this.v:this.B:e.y=e.y<g.y?this.C:this.G;return e};b.prototype.ms=function(a){if(this.s())return NaN;if(a.x==this.v)return a.y-this.C;var e=this.G-this.C,f=this.B-
this.v;return a.y==this.G?e+a.x-this.v:a.x==this.B?e+f+this.G-a.y:a.y==this.C?2*e+f+this.B-a.x:this.ms(this.vv(a))};b.prototype.vA=function(a){if(this.s())return-1;a=this.ms(a);var e=this.G-this.C,f=this.B-this.v;return a<e?0:(a-=e)<f?1:a-f<e?2:3};b.prototype.lv=function(){return this.s()?2.220446049250313E-14:2.220446049250313E-14*(Math.abs(this.v)+Math.abs(this.B)+Math.abs(this.C)+Math.abs(this.G)+1)};b.prototype.Nv=function(a,e){var f=this.ej(a),g=this.ej(e);if(0!=(f&g))return 0;if(0==(f|g))return 4;
var c=(0!=f?1:0)|(0!=g?2:0);do{var d=e.x-a.x,m=e.y-a.y;d>m?0!=(f&b.Cc)?(0!=(f&b.ob)?(a.y+=m*(this.v-a.x)/d,a.x=this.v):(a.y+=m*(this.B-a.x)/d,a.x=this.B),f=this.ej(a)):0!=(g&b.Cc)?(0!=(g&b.ob)?(e.y+=m*(this.v-e.x)/d,e.x=this.v):(e.y+=m*(this.B-e.x)/d,e.x=this.B),g=this.ej(e)):0!=f?(0!=(f&b.ac)?(a.x+=d*(this.C-a.y)/m,a.y=this.C):(a.x+=d*(this.G-a.y)/m,a.y=this.G),f=this.ej(a)):(0!=(g&b.ac)?(e.x+=d*(this.C-e.y)/m,e.y=this.C):(e.x+=d*(this.G-e.y)/m,e.y=this.G),g=this.ej(e)):0!=(f&b.Bd)?(0!=(f&b.ac)?
(a.x+=d*(this.C-a.y)/m,a.y=this.C):(a.x+=d*(this.G-a.y)/m,a.y=this.G),f=this.ej(a)):0!=(g&b.Bd)?(0!=(g&b.ac)?(e.x+=d*(this.C-e.y)/m,e.y=this.C):(e.x+=d*(this.G-e.y)/m,e.y=this.G),g=this.ej(e)):0!=f?(0!=(f&b.ob)?(a.y+=m*(this.v-a.x)/d,a.x=this.v):(a.y+=m*(this.B-a.x)/d,a.x=this.B),f=this.ej(a)):(0!=(g&b.ob)?(e.y+=m*(this.v-e.x)/d,e.x=this.v):(e.y+=m*(this.B-e.x)/d,e.x=this.B),g=this.ej(e));if(0!=(f&g))return 0}while(0!=(f|g));return c};b.prototype.ej=function(a){return(a.x<this.v?1:0)|(a.x>this.B?
1:0)<<1|(a.y<this.C?1:0)<<2|(a.y>this.G?1:0)<<3};b.prototype.mg=function(a){return!this.s()&&(this.aa()<=a||this.ba()<=a)};b.prototype.Fb=function(g){return g instanceof a.b?Math.sqrt(this.gG(g)):Math.sqrt(this.Ou(g))};b.prototype.Ou=function(a){var e=0,f=0,g;g=this.v-a.B;g>e&&(e=g);g=this.C-a.G;g>f&&(f=g);g=a.v-this.B;g>e&&(e=g);g=a.C-this.G;g>f&&(f=g);return e*e+f*f};b.prototype.gG=function(a){var e=0,f=0,g;g=this.v-a.x;g>e&&(e=g);g=this.C-a.y;g>f&&(f=g);g=a.x-this.B;g>e&&(e=g);g=a.y-this.G;g>f&&
(f=g);return e*e+f*f};b.prototype.wu=function(a){this.s()?a.Ja():a.K(this.v,this.B)};b.ob=1;b.ac=4;b.Cc=3;b.Bd=12;return b}();a.i=b})(E||(E={}));(function(a){var b;(function(a){a[a.initialize=0]="initialize";a[a.initializeRed=1]="initializeRed";a[a.initializeBlue=2]="initializeBlue";a[a.initializeRedBlue=3]="initializeRedBlue";a[a.sweep=4]="sweep";a[a.sweepBruteForce=5]="sweepBruteForce";a[a.sweepRedBlueBruteForce=6]="sweepRedBlueBruteForce";a[a.sweepRedBlue=7]="sweepRedBlue";a[a.sweepRed=8]="sweepRed";
a[a.sweepBlue=9]="sweepBlue";a[a.iterate=10]="iterate";a[a.iterateRed=11]="iterateRed";a[a.iterateBlue=12]="iterateBlue";a[a.iterateBruteForce=13]="iterateBruteForce";a[a.iterateRedBlueBruteForce=14]="iterateRedBlueBruteForce";a[a.resetRed=15]="resetRed";a[a.resetBlue=16]="resetBlue"})(b||(b={}));var c=function(){function a(e,a){this.th=e;this.KD=a}a.prototype.Zp=function(e,a,g){this.th.BS(g,e,a,this.KD)};a.prototype.Mo=function(e){return this.th.pq(e,this.KD)};return a}();b=function(){function g(){this.Vt=
this.cn=this.Ve=this.ad=null;this.fp=new a.i;this.Al=this.Mi=this.Ni=this.od=this.rf=this.ud=this.Nt=this.Wm=this.Zc=this.vb=null;this.Hb=-1;this.ka=0;this.Rj()}g.prototype.Vp=function(){this.Rj();this.At=!0;null==this.vb?(this.Wm=new a.ga(0),this.vb=[]):(this.Wm.cf(0),this.vb.length=0)};g.prototype.Wc=function(e,f){if(!this.At)throw a.g.xa();var g=new a.i;g.K(f);this.Wm.add(e);this.vb.push(g)};g.prototype.wo=function(){if(!this.At)throw a.g.xa();this.At=!1;null!=this.vb&&0<this.vb.length&&(this.Hb=
0,this.Ec=!1)};g.prototype.jG=function(){this.Rj();this.zt=!0;null==this.vb?(this.Wm=new a.ga(0),this.vb=[]):(this.Wm.cf(0),this.vb.length=0)};g.prototype.OA=function(e,f){if(!this.zt)throw a.g.xa();var g=new a.i;g.K(f);this.Wm.add(e);this.vb.push(g)};g.prototype.$B=function(){if(!this.zt)throw a.g.xa();this.zt=!1;null!=this.vb&&0<this.vb.length&&null!=this.Zc&&0<this.Zc.length&&(-1==this.Hb?this.Hb=3:2==this.Hb?this.Hb=3:3!=this.Hb&&(this.Hb=1),this.Ec=!1)};g.prototype.iG=function(){this.Rj();this.yt=
!0;null==this.Zc?(this.Nt=new a.ga(0),this.Zc=[]):(this.Nt.cf(0),this.Zc.length=0)};g.prototype.LA=function(e,f){if(!this.yt)throw a.g.xa();var g=new a.i;g.K(f);this.Nt.add(e);this.Zc.push(g)};g.prototype.ZB=function(){if(!this.yt)throw a.g.xa();this.yt=!1;null!=this.vb&&0<this.vb.length&&null!=this.Zc&&0<this.Zc.length&&(-1==this.Hb?this.Hb=3:1==this.Hb?this.Hb=3:3!=this.Hb&&(this.Hb=2),this.Ec=!1)};g.prototype.next=function(){if(this.Ec)return!1;for(var e=!0;e;)switch(this.Hb){case 0:e=this.Qw();
break;case 1:e=this.yO();break;case 2:e=this.vO();break;case 3:e=this.xO();break;case 4:e=this.LS();break;case 5:e=this.HS();break;case 6:e=this.IS();break;case 7:e=this.JS();break;case 8:e=this.Qu();break;case 9:e=this.Wy();break;case 10:e=this.$w();break;case 11:e=this.iP();break;case 12:e=this.fP();break;case 13:e=this.gP();break;case 14:e=this.hP();break;case 15:e=this.hF();break;case 16:e=this.gF();break;default:throw a.g.wa();}return this.Ec?!1:!0};g.prototype.YF=function(e){this.ka=e};g.prototype.Fw=
function(e){return this.vb[e]};g.prototype.jw=function(e){return this.Zc[e]};g.prototype.jk=function(e){return this.Wm.read(e)};g.prototype.ek=function(e){return this.Nt.read(e)};g.Cv=function(e){return 1==(e&1)};g.Yk=function(e){return 0==(e&1)};g.prototype.Rj=function(){this.At=this.yt=this.zt=!1;this.pf=this.qf=this.tg=this.ae=-1;this.Ec=!0};g.prototype.Qw=function(){this.mf=this.Ff=-1;if(10>this.vb.length)return this.ae=this.vb.length,this.Hb=5,!0;null==this.ad&&(this.ad=new a.bq(!0),this.cn=
this.ad.Re(),this.ud=new a.ga(0));this.ad.Vp();for(var e=0;e<this.vb.length;e++){var f=this.vb[e];this.ad.gq(f.v,f.B)}this.ad.wo();this.ud.xb(2*this.vb.length);this.ud.resize(0);for(e=0;e<2*this.vb.length;e++)this.ud.add(e);this.Lr(this.ud,2*this.vb.length,!0);this.ae=2*this.vb.length;this.Hb=4;return!0};g.prototype.yO=function(){this.mf=this.Ff=-1;if(10>this.vb.length||10>this.Zc.length)return this.ae=this.vb.length,this.Hb=6,!0;null==this.ad&&(this.ad=new a.bq(!0),this.cn=this.ad.Re(),this.ud=new a.ga(0));
this.ad.Vp();for(var e=0;e<this.vb.length;e++){var f=this.vb[e];this.ad.gq(f.v,f.B)}this.ad.wo();this.ud.xb(2*this.vb.length);this.ud.resize(0);for(e=0;e<2*this.vb.length;e++)this.ud.add(e);this.Lr(this.ud,this.ud.size,!0);this.ae=this.ud.size;-1!=this.qf&&(this.od.Fg(this.qf),this.Ni.resize(0),this.qf=-1);this.Hb=7;return this.gF()};g.prototype.vO=function(){this.mf=this.Ff=-1;if(10>this.vb.length||10>this.Zc.length)return this.ae=this.vb.length,this.Hb=6,!0;null==this.Ve&&(this.Ve=new a.bq(!0),
this.Vt=this.Ve.Re(),this.rf=new a.ga(0));this.Ve.Vp();for(var e=0;e<this.Zc.length;e++){var f=this.Zc[e];this.Ve.gq(f.v,f.B)}this.Ve.wo();this.rf.xb(2*this.Zc.length);this.rf.resize(0);for(e=0;e<2*this.Zc.length;e++)this.rf.add(e);this.Lr(this.rf,this.rf.size,!1);this.tg=this.rf.size;-1!=this.pf&&(this.od.Fg(this.pf),this.Mi.resize(0),this.pf=-1);this.Hb=7;return this.hF()};g.prototype.xO=function(){this.mf=this.Ff=-1;if(10>this.vb.length||10>this.Zc.length)return this.ae=this.vb.length,this.Hb=
6,!0;null==this.ad&&(this.ad=new a.bq(!0),this.cn=this.ad.Re(),this.ud=new a.ga(0));null==this.Ve&&(this.Ve=new a.bq(!0),this.Vt=this.Ve.Re(),this.rf=new a.ga(0));this.ad.Vp();for(var e=0;e<this.vb.length;e++){var f=this.vb[e];this.ad.gq(f.v,f.B)}this.ad.wo();this.Ve.Vp();for(e=0;e<this.Zc.length;e++)f=this.Zc[e],this.Ve.gq(f.v,f.B);this.Ve.wo();this.ud.xb(2*this.vb.length);this.rf.xb(2*this.Zc.length);this.ud.resize(0);this.rf.resize(0);for(e=0;e<2*this.vb.length;e++)this.ud.add(e);for(e=0;e<2*this.Zc.length;e++)this.rf.add(e);
this.Lr(this.ud,this.ud.size,!0);this.Lr(this.rf,this.rf.size,!1);this.ae=this.ud.size;this.tg=this.rf.size;-1!=this.qf&&(this.od.Fg(this.qf),this.Ni.resize(0),this.qf=-1);-1!=this.pf&&(this.od.Fg(this.pf),this.Mi.resize(0),this.pf=-1);this.Hb=7;return!0};g.prototype.LS=function(){var e=this.ud.get(--this.ae),a=e>>1;if(g.Yk(e))return this.ad.remove(a),0==this.ae?(this.mf=this.Ff=-1,this.Ec=!0,!1):!0;this.cn.uy(this.vb[a].v,this.vb[a].B,this.ka);this.Ff=a;this.Hb=10;return!0};g.prototype.HS=function(){if(-1==
--this.ae)return this.mf=this.Ff=-1,this.Ec=!0,!1;this.tg=this.Ff=this.ae;this.Hb=13;return!0};g.prototype.IS=function(){if(-1==--this.ae)return this.mf=this.Ff=-1,this.Ec=!0,!1;this.Ff=this.ae;this.tg=this.Zc.length;this.Hb=14;return!0};g.prototype.JS=function(){var e=this.ud.get(this.ae-1),a=this.rf.get(this.tg-1),n=this.pq(e,!0),b=this.pq(a,!1);return n>b?this.Qu():n<b?this.Wy():g.Cv(e)?this.Qu():g.Cv(a)?this.Wy():this.Qu()};g.prototype.Qu=function(){var e=this.ud.get(--this.ae),f=e>>1;if(g.Yk(e))return-1!=
this.qf&&-1!=this.Ni.get(f)?(this.od.Jc(this.qf,this.Ni.get(f)),this.Ni.set(f,-1)):this.ad.remove(f),0==this.ae?(this.mf=this.Ff=-1,this.Ec=!0,!1):!0;if(-1!=this.pf&&0<this.od.vq(this.pf))for(e=this.od.gc(this.pf);-1!=e;){var n=this.od.getData(e);this.Ve.lg(n);this.Mi.set(n,-1);n=this.od.bb(e);this.od.Jc(this.pf,e);e=n}0<this.Ve.size()?(this.Vt.uy(this.vb[f].v,this.vb[f].B,this.ka),this.Ff=f,this.Hb=12):(-1==this.qf&&(null==this.od&&(this.od=new a.$n),this.Ni=new a.ga(0),this.Ni.resize(this.vb.length,
-1),this.Ni.dh(-1,0,this.vb.length),this.qf=this.od.jh(1)),this.Ni.set(f,this.od.addElement(this.qf,f)),this.Hb=7);return!0};g.prototype.Wy=function(){var e=this.rf.get(--this.tg),f=e>>1;if(g.Yk(e))return-1!=this.pf&&-1!=this.Mi.get(f)?(this.od.Jc(this.pf,this.Mi.get(f)),this.Mi.set(f,-1)):this.Ve.remove(f),0==this.tg?(this.mf=this.Ff=-1,this.Ec=!0,!1):!0;if(-1!=this.qf&&0<this.od.vq(this.qf))for(e=this.od.gc(this.qf);-1!=e;){var n=this.od.getData(e);this.ad.lg(n);this.Ni.set(n,-1);n=this.od.bb(e);
this.od.Jc(this.qf,e);e=n}0<this.ad.size()?(this.cn.uy(this.Zc[f].v,this.Zc[f].B,this.ka),this.mf=f,this.Hb=11):(-1==this.pf&&(null==this.od&&(this.od=new a.$n),this.Mi=new a.ga(0),this.Mi.resize(this.Zc.length,-1),this.Mi.dh(-1,0,this.Zc.length),this.pf=this.od.jh(0)),this.Mi.set(f,this.od.addElement(this.pf,f)),this.Hb=7);return!0};g.prototype.$w=function(){this.mf=this.cn.next();if(-1!=this.mf)return!1;var e=this.ud.get(this.ae)>>1;this.ad.lg(e);this.Hb=4;return!0};g.prototype.iP=function(){this.Ff=
this.cn.next();if(-1!=this.Ff)return!1;this.mf=this.Ff=-1;var e=this.rf.get(this.tg)>>1;this.Ve.lg(e);this.Hb=7;return!0};g.prototype.fP=function(){this.mf=this.Vt.next();if(-1!=this.mf)return!1;var e=this.ud.get(this.ae)>>1;this.ad.lg(e);this.Hb=7;return!0};g.prototype.gP=function(){if(-1==--this.tg)return this.Hb=5,!0;this.fp.K(this.vb[this.ae]);var e=this.vb[this.tg];this.fp.P(this.ka,this.ka);return this.fp.jc(e)?(this.mf=this.tg,!1):!0};g.prototype.hP=function(){if(-1==--this.tg)return this.Hb=
6,!0;this.fp.K(this.vb[this.ae]);var e=this.Zc[this.tg];this.fp.P(this.ka,this.ka);return this.fp.jc(e)?(this.mf=this.tg,!1):!0};g.prototype.hF=function(){if(null==this.ad)return this.Ec=!0,!1;this.ae=this.ud.size;0<this.ad.size()&&this.ad.reset();-1!=this.qf&&(this.od.Fg(this.qf),this.Ni.resize(0),this.qf=-1);this.Ec=!1;return!0};g.prototype.gF=function(){if(null==this.Ve)return this.Ec=!0,!1;this.tg=this.rf.size;0<this.Ve.size()&&this.Ve.reset();-1!=this.pf&&(this.od.Fg(this.pf),this.Mi.resize(0),
this.pf=-1);this.Ec=!1;return!0};g.prototype.Lr=function(e,f,g){null==this.Al&&(this.Al=new a.Rr);g=new c(this,g);this.Al.sort(e,0,f,g)};g.prototype.BS=function(e,a,n,b){var f=this;e.xd(a,n,function(e,a){var n=f.pq(e,b),c=f.pq(a,b);return n<c||n==c&&g.Yk(e)&&g.Cv(a)?-1:1})};g.prototype.pq=function(e,a){var f=.5*this.ka;if(a)return a=this.vb[e>>1],f=g.Yk(e)?a.C-f:a.G+f;a=this.Zc[e>>1];return f=g.Yk(e)?a.C-f:a.G+f};return g}();a.sz=b})(E||(E={}));(function(a){var b=function(){function b(){}b.Oa=function(a,
e,f,n,c,d){var g=new b;g.v=a;g.C=e;g.Je=f;g.B=n;g.G=c;g.ig=d;return g};b.prototype.Ja=function(){this.Je=this.v=NaN};b.prototype.s=function(){return isNaN(this.v)};b.prototype.UO=function(){return isNaN(this.Je)};b.prototype.K=function(a,e,f,n,b,c){void 0!==n?"number"===typeof a?(this.v=a,this.C=e,this.Je=f,this.B=n,this.G=b,this.ig=c):(this.v=a.x-.5*e,this.B=this.v+e,this.C=a.y-.5*f,this.G=this.C+f,this.Je=a.z-.5*n,this.ig=this.Je+n):(this.v=a,this.C=e,this.Je=f,this.B=a,this.G=e,this.ig=f)};b.prototype.move=
function(a){this.v+=a.x;this.C+=a.y;this.Je+=a.z;this.B+=a.x;this.G+=a.y;this.ig+=a.z};b.prototype.copyTo=function(a){a.v=this.v;a.C=this.C;a.B=this.B;a.G=this.G};b.prototype.Oj=function(a,e,f){this.v>a?this.v=a:this.B<a&&(this.B=a);this.C>e?this.C=e:this.G<e&&(this.G=e);0==isNaN(this.Je)?this.Je>f?this.Je=f:this.ig<f&&(this.ig=f):this.ig=this.Je=f};b.prototype.Db=function(g,e,f,n,c,d){if("number"===typeof g)n?(this.Db(g,e,f),this.Db(n,c,d)):this.s()?(this.v=g,this.C=e,this.Je=f,this.B=g,this.G=e,
this.ig=f):this.Oj(g,e,f);else if(g instanceof a.ee)this.Db(g.x,g.y,g.z);else if(g instanceof b)g.s()||(this.Db(g.v,g.C,g.Je),this.Db(g.B,g.G,g.ig));else throw a.g.N();};b.prototype.Oa=function(a,e,f){a.s()||e.s()?this.Ja():(this.v=a.qa,this.B=a.va,this.C=e.qa,this.G=e.va,this.Je=f.qa,this.ig=f.va)};b.prototype.hy=function(g){if(null==g||8>g.length)throw a.g.N();g[0]=new a.ee(this.v,this.C,this.Je);g[1]=new a.ee(this.v,this.G,this.Je);g[2]=new a.ee(this.B,this.G,this.Je);g[3]=new a.ee(this.B,this.C,
this.Je);g[4]=new a.ee(this.v,this.C,this.ig);g[5]=new a.ee(this.v,this.G,this.ig);g[6]=new a.ee(this.B,this.G,this.ig);g[7]=new a.ee(this.B,this.C,this.ig)};b.prototype.Ey=function(a){if(null==a||0==a.length)this.Ja();else{var e=a[0];this.K(e.x,e.y,e.z);for(e=1;e<a.length;e++){var f=a[e];this.Oj(f.x,f.y,f.z)}}};return b}();a.fH=b})(E||(E={}));(function(a){(function(a){a.wa=function(){var a=Error();a.message="Internal Error";return a};a.qe=function(){var a=Error();a.message="Not Implemented";return a};
a.cj=function(){var a=Error();a.message="The input unit and the spatial reference unit are not of the same unit type.ie Linear vs.Angular";return a};a.xa=function(){var a=Error();a.message="Invalid Call";return a};a.N=function(a){var g=Error();g.message="Illegal Argument Exception";void 0!==a&&(g.message+=": "+a);return g};a.BI=function(){var a=Error();a.message="Runtime Exception.";return a};a.ra=function(a){var g=Error();g.message="Geometry Exception: "+a;return g};a.PG=function(){var a=Error();
a.message="Assert Failed Exception";return a};a.Uc=function(){var a=Error();a.message="IndexOutOfBoundsException";return a};a.aU=function(a){a.message="UserCancelException";return a}})(a.g||(a.g={}))})(E||(E={}));(function(a){var b=function(){function e(e,a){this.Ma=e;this.hE=a;this.kE=-1;this.rk=!1}e.prototype.next=function(){if(++this.kE==this.hE.F())return null;var e=this.hE.Fa(this.kE);e.scale(this.Ma.Rb);var g=new a.Ka;this.Ma.Iv(e,this.rk,g);return g};e.prototype.ya=function(){return 0};return e}(),
c=function(){function e(e,g,b){this.Ma=e;this.Zt=g;this.Om=!1;this.Um=b;this.Mt=[0];this.zj=[0];this.Qi=[0];this.Sq=[0];this.rk=!1;this.$o=new a.Ka;this.Bj=[]}e.prototype.next=function(){if(this.Om){this.Om=!1;this.bd.ia();var e=a.T.Yj(this.$o);return e=a.Of.Qj(e,this.Ma.jp,!0,!0,this.Ma.Yb)}null==this.bd&&(this.bd=this.Zt.Ca(),this.bd.kb(),null!=this.Um&&this.Um.lo());if(!this.bd.La()){if(!this.bd.kb())return null;null!=this.Um&&this.Um.lo()}e=null;this.zj[0]=0;this.Fx=this.Mt[0]=0;this.uh=NaN;this.Om=
!1;for(var n=this.Bj.length=0,b=new a.b,c=new a.b,d=[0];this.bd.La()&&8>this.Fx;){var m=this.bd.ia();b.J(m.Mb());c.J(m.oc());b.scale(this.Ma.Rb);c.scale(this.Ma.Rb);a.ui.Hs(b,c)?b.x=c.x:a.ui.Fs(b,c)&&(c.x=b.x);this.Bj.length=0;a.ui.kC(this.Ma.Gb,this.Ma.Xb,this.Ma.ke,b,c,this.Ma.Nx,this.Ma.hr,d,this.Qi,this.Sq,this.Bj,this.Mt);null!=this.Um&&(m=this.Bj.slice(0),this.Um.dD(this.Um.ea()-1,m,m.length-1));a.ui.Gs(b,c)?(this.$o.Ja(),this.Ma.Iv(b,this.rk,this.$o),this.Om=!0):(this.$o.Ja(),this.Om=this.Lv(d[0],
this.$o));if(this.Om){this.bd.oi();if(this.bd.Ow()){this.bd.oi();this.bd.ia();break}this.bd.yR();break}null==e&&(e=new a.Ka,e.lo());this.TA(e);n++}this.Mt[0]=0;if(0<n){for(d=this.bd.Jb();0<n;)this.bd.oi(),b.J(this.Zt.Fa(this.bd.Jb())),c.J(this.Zt.Fa(this.bd.Bm())),b.scale(this.Ma.Rb),c.scale(this.Ma.Rb),this.rk&&(a.ui.Hs(b,c)?b.x=c.x:a.ui.Fs(b,c)&&(c.x=b.x)),this.Bj.length=0,a.ui.kC(this.Ma.Gb,this.Ma.Xb,this.Ma.ke,c,b,this.Ma.Nx,this.Ma.hr,null,this.Qi,this.Sq,this.Bj,this.Mt),this.TA(e),n--;b.J(this.Zt.Fa(this.bd.Jb()));
b.scale(this.Ma.Rb);g.kq(this.Ma.Gb,this.Ma.Xb,this.Ma.Rb,this.Ma.hb,b,this.uh+1.570796326794897,this.uh+4.71238898038469,this.Ma.Sm,this.rk,this.zj,e,NaN,NaN);this.bd.Sb(d);this.bd.ia();n=a.Ia.Cg(null,e,!0);return e=a.Of.Qj(e,n,!0,!0,this.Ma.Yb)}this.Om=!1;this.bd.ia();e=a.T.Yj(this.$o);return e=a.Of.Qj(e,this.Ma.jp,!0,!0,this.Ma.Yb)};e.prototype.TA=function(e){var f=this.Bj[0],b,c=this.Qi[0]-1.570796326794897,d=this.Sq[0]+1.570796326794897,m;if(!isNaN(this.uh)){this.uh>=this.Qi[0]?(b=this.uh+1.570796326794897,
c=b+3.141592653589793-(this.uh-this.Qi[0])):(b=this.uh+1.570796326794897,c=b+3.141592653589793-(6.283185307179586-(this.Qi[0]-this.uh)));m=this.uh>=this.Qi[0]&&3.141592653589793>=this.uh-this.Qi[0]?!1:this.uh<this.Qi[0]&&3.141592653589793<=this.Qi[0]-this.uh?!1:!0;var z=!1;if(Math.abs(c-b)<=.5*this.Ma.Sm)if(m){var k=e.Fa(e.F()-2);k.scale(this.Ma.Rb);var h=new a.ca(0);a.zb.gw(this.Ma.Gb,this.Ma.Xb,f.x,f.y,k.x,k.y,h);for(k=h.l;k<=b;)k+=6.283185307179586;for(;k>b;)k-=6.283185307179586;k<c&&(z=!0)}else z=
!0;z?(e.eF(0,e.F()-1),this.rk||(f=new a.b,f.J(e.Fa(e.F()-1)),f.scale(this.Ma.Rb),-3.141592653589793>f.x-this.zj[0]?this.zj[0]-=6.283185307179586:3.141592653589793<f.x-this.zj[0]&&(this.zj[0]+=6.283185307179586)),m||(c=.5*(c+b))):(m?(b=new a.b,b.J(f),b.scale(1/this.Ma.Rb),e.kf(0,-1,b)):g.kq(this.Ma.Gb,this.Ma.Xb,this.Ma.Rb,this.Ma.hb,this.Bj[0],b,c,this.Ma.Sm,this.rk,this.zj,e,NaN,NaN),this.Fx+=1)}g.Hv(this.Ma.Gb,this.Ma.Xb,this.Ma.Rb,this.Ma.hb,this.Ma.ke,this.Bj,c,d,this.rk,this.zj,e);this.uh=this.Sq[0]};
e.prototype.Lv=function(e,a){return this.Ma.Lv(this.Bj,e,this.Qi[0],this.Sq[0],this.rk,a)};e.prototype.ya=function(){return 0};return e}(),g=function(){function e(){}e.buffer=function(f,g,b,c,d,m){if(null==f)throw a.g.N("Geometry::Geodesic_bufferer::buffer");if(f.s())return new a.Ka(f.description);var n=new e;n.sg=g;n.wc=a.Ya.Em(g);var x=a.Ya.ft(n.wc);n.Yb=m;n.Gb=a.Ya.Ts(n.wc);n.Xb=x*(2-x);n.Rb=n.wc.Se().Dj;n.ka=n.sg.xq();n.jp=n.wc.xq();n.hr=n.jp*n.Rb;n.ip=1.570796326794897/n.Rb;n.rU=3.141592653589793/
n.Rb;n.Uq=6.283185307179586/n.Rb;n.sU=n.Uq/6;n.Ix=0;n.qU=1.5707963267948966*n.Gb/n.Ix;4==b?(n.ke=2,n.Gt=!0):(n.ke=b,n.Gt=!1);n.Da=c;n.hb=Math.abs(c);isNaN(d)||.001>d?n.sS():n.Rm=d;b=f.D();a.T.Lc(b)?(b=new a.Xa(f.description),b.Bc(f,!0),f=b,b=1607):197==b&&(b=new a.i,f.o(b),b.aa()<=n.ka||b.ba()<=n.ka?(b=new a.Xa(f.description),b.Wc(f,!1),f=b,b=1607):(b=new a.Ka(f.description),b.Wc(f,!1),f=b,b=1736));n.tS();a.T.Km(b)||n.uS();if(n.hb<=.5*n.Rm)return 1736!=b?new a.Ka(f.description):n.Gt?f:a.ui.oq(f,n.sg,
n.ke,n.Nx,-1,m);if(0>n.Da&&1736!=b)return new a.Ka(f.description);n.Gt&&a.T.Kc(b)?(g=a.ui.oq(f,g,4,NaN,n.Rm,m),f=a.Ya.Wl(g,n.sg,n.wc)):f=a.Ya.Wl(f,n.sg,n.wc);f=a.gh.qo(f,n.wc);if(f.s())return new a.Ka(f.description);!n.Gt&&a.T.Kc(b)&&(f=a.ui.IE(n.Rb,f));f=e.PS(f,n.wc);switch(b){case 1736:g=n.yK(f);break;case 1607:g=n.zK(f);break;case 550:g=n.wK(f);break;case 33:g=n.xK(f);break;default:throw a.g.ra("corrupted_geometry");}n=a.Ya.Wl(g,n.wc,n.sg);n.Ik(f.description);return n};e.prototype.yK=function(e){var f=
new a.Ka;e=new c(this,e,f);e=a.wi.local().$(e,this.wc,this.Yb).next();e=a.Vn.nl(e,this.wc,2);var g=new a.Bg;g.scale(1/this.Rb,1/this.Rb);f.Oe(g);f=a.Vn.nl(f,this.wc,2);return 0<=this.Da?a.wi.local().$(f,e,this.wc,this.Yb):a.Zr.local().$(f,e,this.wc,this.Yb)};e.prototype.zK=function(e){e=new c(this,e,null);e=a.wi.local().$(e,this.wc,this.Yb).next();return e=a.Vn.nl(e,this.wc,2)};e.prototype.wK=function(e){e=new b(this,e);e=a.wi.local().$(e,this.wc,this.Yb).next();return e=a.Vn.nl(e,this.wc,2)};e.prototype.xK=
function(e){e=e.w();e.scale(this.Rb);var f=new a.Ka;this.Iv(e,!1,f);return f=a.Vn.nl(f,this.wc,2)};e.prototype.Lv=function(f,g,b,c,d,m){var n=f[0],x=f[f.length-1],z=n.y>x.y?n.y:x.y,k=a.u.q(this.Gb,this.Xb,n.y<x.y?n.y:x.y),z=a.u.q(this.Gb,this.Xb,z);if(.001<this.Ix-(k+g+this.hb)&&.001<this.Ix+(z-g-this.hb))return!1;g=b-1.570796326794897;b=c+1.570796326794897;var k=g-3.141592653589793,z=g+3.141592653589793,I=b+3.141592653589793,h=[NaN],q=[NaN],l=[NaN],L=[NaN];c=!1;e.wG(this.Gb,this.Xb,this.hb,n,g,k,
x,b,h,q);e.wG(this.Gb,this.Xb,this.hb,x,I,b,n,k,l,L);b<h[0]&&h[0]<I?c=!0:b<q[0]&&q[0]<I&&(c=!0);c||(k<l[0]&&l[0]<g?c=!0:k<L[0]&&L[0]<g&&(c=!0));if(!c&&d)return!1;for(var v=[],t=f.length-1;0<=t;t--)v.push(f[t]);m.Ja();m.lo();t=[0];e.Hv(this.Gb,this.Xb,this.Rb,this.hb,this.ke,f,g,b,d,t,m);e.kq(this.Gb,this.Xb,this.Rb,this.hb,x,b,I,this.Sm,d,t,m,h[0],q[0]);e.Hv(this.Gb,this.Xb,this.Rb,this.hb,this.ke,v,I,z,d,t,m);e.kq(this.Gb,this.Xb,this.Rb,this.hb,n,k,g,this.Sm,d,t,m,l[0],L[0]);f=!1;d||(f=this.zB(this.Rb,
m));return c||f};e.prototype.Iv=function(a,g,b){b.Ja();b.lo();e.kq(this.Gb,this.Xb,this.Rb,this.hb,a,-this.Sm,6.283185307179586,this.Sm,g,[0],b,NaN,NaN);g||this.zB(this.Rb,b)};e.prototype.zB=function(e,a){var f=this.XK(e,a);e=this.YK(e,a);return f||e};e.prototype.XK=function(e,g){var f=g.F(),n=!1,b=new a.i;g.o(b);if(!a.j.S(b.G*e,1.570796326794897)&&!a.j.S(b.C*e,-1.570796326794897))return!1;for(var c=new a.b,f=f-1;0<=f;f--)g.w(f,c),c.y==b.G&&a.j.S(c.y*e,1.570796326794897)?(n=!0,this.RE(c,f,g)):c.y==
b.C&&a.j.S(c.y*e,-1.570796326794897)&&(n=!0,this.RE(c,f,g));return n};e.prototype.YK=function(e,a){var f=a.Fa(0),g=a.Fa(a.F()-1);return 3.141592653589793<Math.abs(f.x-g.x)*e?(this.RQ(a),!0):this.WK(a)};e.prototype.WK=function(e){return 0>e.Mh()?(this.QQ(e),!0):!1};e.prototype.RE=function(e,g,b){var f=b.F(),n=0<g?g-1:f-1,f=b.Fa(g<f-1?g+1:0),n=b.Fa(n);if(!a.j.S(f.y,e.y)&&!a.j.S(f.x,e.x)){var c=new a.b;c.ma(f.x,e.y);b.ic(g,c)}a.j.S(n.y,e.y)||a.j.S(n.x,e.x)||(f=new a.b,f.ma(n.x,e.y),b.kf(0,g,f))};e.prototype.RQ=
function(e){var f=new a.Ka,g=new a.Ka,b=new a.Bg,c=e.Fa(0),d=e.Fa(e.F()-1),m=new a.b;c.x>d.x?(d=this.ip,b.Nn(-this.Uq,0)):(d=-this.ip,b.Nn(this.Uq,0));f.add(e,!1);e.Ja();g.add(f,!1);g.Oe(b);c=new a.i;g.o(c);c.P((this.Uq-c.aa())/2,0);c.C=-this.ip;c.G=this.ip;for(var z=0;z<g.F();z++)g.w(z,m),f.kf(0,-1,m);g.Oe(b);for(z=0;z<g.F();z++)g.w(z,m),f.kf(0,-1,m);g=f.Fa(0);b=f.Fa(f.F()-1);m.ma(b.x,d);f.kf(0,-1,m);m.ma(.5*(b.x+g.x),d);f.kf(0,-1,m);m.ma(g.x,d);f.kf(0,-1,m);f=a.gh.Rw(f,this.wc,2,c.v);f=a.gh.Rw(f,
this.wc,2,c.B);f=a.Ed.clip(f,c,this.jp,NaN);e.add(f,!1)};e.prototype.QQ=function(e){var f=new a.i;e.o(f);f.P((this.Uq-f.aa())/2,0);f.C=-this.ip;f.G=this.ip;e.lo();var g=new a.b;g.ma(f.v,f.C);e.kf(1,-1,g);g.ma(f.v,f.G);e.kf(1,-1,g);g.ma(.5*(f.v+f.B),f.G);e.kf(1,-1,g);g.ma(f.B,f.G);e.kf(1,-1,g);g.ma(f.B,f.C);e.kf(1,-1,g);g.ma(.5*(f.v+f.B),f.C);e.kf(1,-1,g)};e.Hv=function(f,g,b,c,d,m,z,k,h,q,l){var n=null;h||(n=new a.b,n.Eh(),0<l.F()&&(n.J(l.Fa(l.F()-1)),n.scale(b)));var x=new a.ca(0),I=new a.ca(0),
L=new a.ca(0),v=new a.b,t=new a.b,y=m[m.length-1];b=1/b;for(var r=0;r<m.length;r++){var B=m[r],E;0==r?E=z:r==m.length-1?E=k:(a.zb.Rd(f,g,y.x,y.y,B.x,B.y,null,null,x,d),E=x.l-1.570796326794897);a.zb.Ph(f,g,B.x,B.y,c,E,I,L);h?t.ma(I.l,L.l):(v.ma(I.l,L.l),e.Gz(B.x,v.x,n.x,q),t.ma(q[0]+v.x,v.y),n.J(t));t.scale(b);l.kf(0,-1,t)}};e.kq=function(f,g,b,c,d,m,z,k,h,q,l,v,t){if(!(z-m<k)){var n=new a.ca(0),x=new a.ca(0),I=new a.b,L=new a.b,y=null;h||(y=new a.b,y.Eh(),0<l.F()&&(y.J(l.Fa(l.F()-1)),y.scale(b)));
var r=a.I.truncate(Math.ceil(m/k)),B=r++*k;B==m&&(B=r++*k);for(b=1/b;B<z+k;){m<v&&v<B?(B=v,r--):m<t&&t<B&&(B=t,r--);if(B>=z)break;a.zb.Ph(f,g,d.x,d.y,c,B,n,x);h?L.ma(n.l,x.l):(I.ma(n.l,x.l),e.Gz(d.x,I.x,y.x,q),L.ma(q[0]+I.x,I.y),y.J(L));L.scale(b);l.kf(0,-1,L);m=B;B=r++*k}}};e.wG=function(e,g,b,c,d,m,z,k,h,q){var f=new a.b,n=new a.b,x=new a.ca(0),I=new a.ca(0);a.zb.Ph(e,g,c.x,c.y,b,d,x,I);f.ma(x.l,I.l);a.zb.Ph(e,g,c.x,c.y,b,m,x,I);n.ma(x.l,I.l);b=new a.ca(0);a.zb.gw(e,g,z.x,z.y,f.x,f.y,b);h[0]=b.l;
a.zb.gw(e,g,z.x,z.y,n.x,n.y,b);for(q[0]=b.l;h[0]<=q[0];)h[0]+=6.283185307179586;for(;h[0]>q[0];)h[0]-=6.283185307179586;for(;h[0]>=k;)h[0]-=6.283185307179586,q[0]-=6.283185307179586;for(;h[0]<k;)h[0]+=6.283185307179586,q[0]+=6.283185307179586};e.Gz=function(e,a,g,b){if(isNaN(g)){for(;3.141592653589793<b[0]+a-e;)b[0]-=6.283185307179586;for(;3.141592653589793<e-(b[0]+a);)b[0]+=6.283185307179586}else 3.141592653589793<b[0]+a-g?b[0]-=6.283185307179586:3.141592653589793<g-(b[0]+a)&&(b[0]+=6.283185307179586)};
e.PS=function(e,g){var f=e.D(),b;a.T.Kc(f)?b=e.ea():550==f?b=e.F():b=1;if(1==b)return e;var n=new a.ga(0);n.resize(b);for(var c=[],d=new a.i,m=0;m<b;m++){n.write(m,m);var z;a.T.Kc(f)?(e.Ti(m,d),z=d.Af()):z=e.Fa(m);z=a.qH.QS(g,z);c[m]=z}n.xd(0,n.size,function(e,a){return c[e]<c[a]?-1:c[e]>c[a]?1:0});d=e.Pa();for(m=0;m<b;m++)z=n.read(m),a.T.Kc(f)?d.Zj(e,z,!0):d.Pd(e,z,z+1);return d};e.prototype.tS=function(){var e=Math.min(3.141592653589793*this.Gb-this.hb,this.hb),e=Math.min(e,.39269908169872414*this.Gb),
g=new a.b;g.ma(0,10*this.Rb);var b=45*this.Rb,c=new a.ca(0),d=new a.ca(0),m=new a.ca(0),z=new a.ca(0),k=new a.ca(0),h=new a.ca(0),q=new a.ca(0),l=new a.ca(0),v=new a.b,t=new a.b,y=new a.b,r=new a.b;a.zb.Ph(this.Gb,this.Xb,g.x,g.y,e,0,c,d);v.ma(c.l,d.l);a.zb.Ph(this.Gb,this.Xb,g.x,g.y,e,b,m,z);t.ma(m.l,z.l);for(var c=new a.ca(0),d=new a.ca(0),B=new a.ca(0);;){a.zb.Ph(this.Gb,this.Xb,g.x,g.y,e,.5*(0+b),k,h);y.ma(k.l,h.l);a.zb.Rd(this.Gb,this.Xb,v.x,v.y,t.x,t.y,c,d,null,2);a.zb.dk(this.Gb,this.Xb,v.x,
v.y,.5*c.l,d.l,q,l,2);r.ma(q.l,l.l);a.zb.Rd(this.Gb,this.Xb,y.x,y.y,r.x,r.y,B,null,null,2);if(B.l<=this.Rm)break;b*=.9;a.zb.Ph(this.Gb,this.Xb,g.x,g.y,e,b,m,z);t.ma(m.l,z.l)}this.Sm=6.283185307179586/Math.ceil(6.283185307179586/(b-0))};e.prototype.uS=function(){var e=Math.min(3.141592653589793*this.Gb-this.hb,this.hb),e=Math.min(e,.39269908169872414*this.Gb),g=new a.b,b=new a.b;g.ma(0,10*this.Rb);b.ma(10*this.Rb,10*this.Rb);var c=new a.ca(0),d=new a.ca(0),m=new a.ca(0);a.zb.Rd(this.Gb,this.Xb,g.x,
g.y,b.x,b.y,m,c,d,this.ke);var z=new a.ca(0),k=new a.ca(0),h=new a.ca(0),q=new a.ca(0),l=new a.b,v=new a.ca(0),t=new a.ca(0),y=new a.ca(0),r=new a.ca(0),B=new a.ca(0),E=new a.ca(0),u=new a.ca(0),C=new a.ca(0),D=new a.ca(0),O=new a.b,G=new a.b,J=new a.b,p=new a.b,w=1,c=c.l,d=d.l+1.570796326794897,m=m.l;a.zb.Ph(this.Gb,this.Xb,g.x,g.y,e,c-1.570796326794897,t,y);O.ma(t.l,y.l);a.zb.Ph(this.Gb,this.Xb,b.x,b.y,e,d,r,B);G.ma(r.l,B.l);for(var t=new a.ca(0),y=new a.ca(0),d=new a.ca(0),K=new a.ca(0);;){a.zb.dk(this.Gb,
this.Xb,g.x,g.y,.5*(0+w)*m,c,z,k,this.ke);l.ma(z.l,k.l);a.zb.Rd(this.Gb,this.Xb,g.x,g.y,l.x,l.y,null,null,v,this.ke);a.zb.Ph(this.Gb,this.Xb,l.x,l.y,e,v.l+1.570796326794897,E,u);J.ma(E.l,u.l);a.zb.Rd(this.Gb,this.Xb,O.x,O.y,G.x,G.y,t,y,null,2);a.zb.dk(this.Gb,this.Xb,O.x,O.y,.5*t.l,y.l,C,D,2);p.ma(C.l,D.l);a.zb.Rd(this.Gb,this.Xb,J.x,J.y,p.x,p.y,d,null,null,2);if(d.l<=this.Rm)break;w*=.9;a.zb.dk(this.Gb,this.Xb,g.x,g.y,w*m,c,h,q,this.ke);b.ma(h.l,q.l);a.zb.Rd(this.Gb,this.Xb,g.x,g.y,b.x,b.y,null,
null,K,this.ke);a.zb.Ph(this.Gb,this.Xb,b.x,b.y,e,K.l+1.570796326794897,r,B);G.ma(r.l,B.l)}e=w*m;1E5<e&&(e=1E5);this.Nx=e};e.prototype.sS=function(){var e;e=5E4<this.hb?100:1E4<this.hb?10:1;500>this.hb/e&&(e=this.hb/500);.01>e&&(e=.01);this.Rm=e};return e}();a.pH=g})(E||(E={}));(function(a){var b=function(){function b(){}b.ac=function(g,e){var f=new a.b;f.J(e);g.push(f)};b.$i=function(a,e){a.add(e.x);a.add(e.y)};b.cx=function(a){a.cf(a.size-2)};b.cy=function(a,e){e.ma(a.get(a.size-2),a.get(a.size-
1))};b.oq=function(g,e,f,n,c,d){if(null==g)throw a.g.N();var x=g.D();if(g.s()||a.T.Km(x))return g;var m=new b;m.sg=e;m.wc=a.Ya.Em(e);var z=a.Ya.ft(m.wc);m.Yb=d;m.Gb=a.Ya.Ts(m.wc);m.Xb=z*(2-z);m.Rb=m.wc.Se().Dj;m.jp=m.wc.xq();m.hr=m.jp*m.Rb;m.Bx=n;m.Ax=c;m.ke=f;197==x?(f=new a.Ka(g.description),f.Wc(g,!1)):a.T.Lc(x)?(f=new a.Xa(g.description),f.Bc(g,!0)):f=g;if(4!=m.ke){e=0==m.sg.lc(m.wc)?a.Ya.Wl(f,m.sg,m.wc):a.gh.qo(f,m.wc);if(e.s())return e;e=b.IE(m.Rb,e);e=m.hw(e);e=a.Vn.nl(e,m.wc,m.ke);m=a.Ya.Wl(e,
m.wc,m.sg)}else{2==a.Nf.Am(e)?(g=a.Ya.TN(),e=a.$r.local().$(f,g,e,d),e==g&&(e=new a.Ka,g.copyTo(e))):e=a.gh.qo(f,m.wc);if(e.s())return e;m=m.wS(e)}return m};b.IE=function(g,e){var f=new a.i;e.dd(f);if(3.141592653589793>f.aa()*g)return e;for(var n=!1,f=e.Ca(),c=new a.b,d=new a.b;f.kb();)for(;f.La();){var m=f.ia();c.J(m.Mb());d.J(m.oc());c.scale(g);d.scale(g);if(3.141592653589793<Math.abs(c.x-d.x)){var z=b.Gs(c,d);if(!z){n=!0;break}if(6.283185307179586<Math.abs(c.x-d.x)){n=!0;break}}}if(!n)return e;
var n=e.Pa(),k=1<e.description.Aa,h=new a.b,q=new a.b,l=new a.b,v=new a.b,t=new a.Va;for(f.Lk();f.kb();)for(var y=NaN,r=[0];f.La();){m=f.ia();c.J(m.Mb());d.J(m.oc());c.scale(g);d.scale(g);isNaN(y)?(b.Bd(c.x,NaN,r),q.J(c)):q.J(l);y=q.x;if(z=b.Gs(c,d)){if(6.283185307179586<d.x-c.x)for(;6.283185307179586<d.x-c.x;)d.x-=6.283185307179586;if(-6.283185307179586>d.x-c.x)for(;-6.283185307179586>d.x-c.x;)d.x+=6.283185307179586;b.Bd(d.x,NaN,r);l.J(d)}else h.J(d),b.eK(h),b.Bd(h.x,y,r),l.ma(r[0]+h.x,h.y);.5>Math.abs(l.x-
d.x)&&l.J(d);k?(m.uu(0,t),v.J(q),v.scale(1/g),t.ic(v),(z=f.wl())?n.df(t):n.lineTo(t),f.Jm()&&!e.vc(f.Qa)&&(m.uu(1,t),v.J(l),v.scale(1/g),t.ic(v),n.lineTo(t))):((z=f.wl())&&n.Sw(),m=n.ea()-1,v.J(q),v.scale(1/g),n.kf(m,-1,v),f.Jm()&&!e.vc(f.Qa)&&(v.J(l),v.scale(1/g),n.kf(m,-1,v)))}return n};b.kC=function(g,e,f,n,c,d,m,z,k,h,q,l){var x=new a.b,I=new a.b,v=0<n.compare(c);b.Ez(v,n,c,x,I);b.Jz(g,e,f,x,I,d,NaN,m,z,k,h,null,q,l);v&&b.gy(k,h,null,q)};b.prototype.hw=function(g){var e=g.Pa(),f=g.Ca(),n=[],c=
null,d=null,m=1<g.description.Aa;m&&(c=new a.qd(0),d=new a.Ag);for(var z=[0],k=new a.b,h=new a.b,q=new a.b,l=new a.b;f.kb();)for(z[0]=0;f.La();){var v=f.ia();k.J(v.Mb());h.J(v.oc());k.scale(this.Rb);h.scale(this.Rb);var t=0<k.compare(h);b.Ez(t,k,h,q,l);n.length=0;null!=c&&c.cf(0);0<this.Bx?b.Jz(this.Gb,this.Xb,this.ke,q,l,this.Bx,this.Ax,this.hr,null,null,null,m?c:null,n,z):b.dH(this.Gb,this.Xb,this.ke,q,l,this.Ax,this.hr,m?c:null,n,z);t&&b.gy(null,null,m?c:null,n);n[0].J(v.Mb());n[n.length-1].J(v.oc());
for(var y=1;y<n.length-1;y++)n[y].scale(1/this.Rb);m?(t=b.Cz(t,v,d),b.oz(f.wl(),f.Jm()&&!g.vc(f.Qa),v,t,c,n,e)):b.mz(f.wl(),f.Jm()&&!g.vc(f.Qa),n,e)}return e};b.prototype.wS=function(g){var e=g.Pa(),f=g.Ca(),n=[],c=null,d=new a.Ag,m=1<g.description.Aa;for(m&&(c=new a.qd(0));f.kb();)for(;f.La();){var z=f.ia(),k=z.Mb(),h=z.oc(),k=0<k.compare(h),h=b.Cz(k,z,d);n.length=0;null!=c&&c.cf(0);b.FR(this.Gb,this.Xb,this.Rb,h,this.sg,this.Bx,this.Ax,m?c:null,n);k&&b.gy(null,null,m?c:null,n);m?b.oz(f.wl(),f.Jm()&&
!g.vc(f.Qa),z,h,c,n,e):b.mz(f.wl(),f.Jm()&&!g.vc(f.Qa),n,e)}return e};b.mz=function(a,e,f,b){a&&b.Sw();a=b.ea()-1;var g=f.slice(0);b.dD(a,g,g.length-1);e&&b.kf(a,-1,f[f.length-1])};b.oz=function(g,e,f,b,c,d,m){var n=new a.Va;f.En(n);g?m.df(n):m.lineTo(n);if(2<d.length){g=b.$b();for(var x=1;x<d.length-1;x++){var z=b.AD(c.get(x)*g);b.uu(z,n);n.ic(d[x]);m.lineTo(n)}}e&&(f.Bn(n),m.lineTo(n))};b.Jz=function(g,e,f,n,c,d,m,z,k,h,q,l,v,t){var x=new a.ca(0),I=new a.ca(0),L=new a.ca(0);a.zb.Rd(g,e,n.x,n.y,
c.x,c.y,L,x,I,f);var L=L.l,y=x=x.l,I=I.l;0>y&&(y+=6.283185307179586);0>I&&(I+=6.283185307179586);null!=k&&(k[0]=L);null!=h&&(h[0]=y);null!=q&&(q[0]=I);h=k=NaN;null!=l&&(h=a.u.gg(g,e),q=a.u.q(g,e,n.y),k=(h-q)/L,h=(h+q)/L);q=b.Hs(n,c);var I=b.Fs(n,c),y=q||I,r=b.wz(n,c,z),B=new a.ca(0),E=new a.ca(0),u=new a.b,C=new a.b,D=new a.b;b.Bd(n.x,NaN,t);var P=[t[0]];if(L<=d)b.ac(v,n),b.Bd(c.x,NaN,t),null!=l&&l.add(0),y?(q&&b.by(n,c,l,v),I&&b.Vx(n,c,l,v)):r?b.Xx(n,c,x,k,h,l,v):0<m&&(C.ma(n.x-P[0],n.y),u.ma(c.x-
t[0],c.y),b.yv(g,e,f,n,L,x,C,u,0,1,m,l,v,P)),b.ac(v,c);else{d=1+a.I.truncate(Math.ceil(L/d));var Y=L/(d-1),G=new a.b,O=0;b.ac(v,n);G.J(n);C.ma(n.x-t[0],n.y);null!=l&&l.add(0);for(var J=1;J<d;J++){var p;J<d-1?(a.zb.dk(g,e,n.x,n.y,J*Y,x,B,E,f),u.ma(B.l,E.l),b.Bd(u.x,G.x,t),D.ma(t[0]+u.x,u.y),p=J/(d-1)):(b.Bd(c.x,NaN,t),u.ma(c.x-t[0],c.y),D.J(c),p=1);y?(1==J&&q&&b.by(n,D,l,v),J==d-1&&I&&b.Vx(G,c,l,v)):r?b.uz(G,D,z)&&(n.x<c.x?G.x>D.x&&(t[0]+=6.283185307179586,D.ma(t[0]+u.x,u.y)):G.x<D.x&&(t[0]-=6.283185307179586,
D.ma(t[0]+u.x,u.y)),b.Xx(G,D,x,k,h,l,v)):0<m&&b.yv(g,e,f,n,L,x,C,u,O,p,m,l,v,P);b.ac(v,D);null!=l&&l.add(p);G.J(D);C.J(u);P[0]=t[0];O=p}}};b.dH=function(g,e,f,n,c,d,m,z,k,h){var x=new a.ca(0),I=new a.ca(0),q=new a.ca(0);a.zb.Rd(g,e,n.x,n.y,c.x,c.y,q,x,I,f);var I=q.l,x=x.l,l=q=NaN;if(null!=z)var l=a.u.gg(g,e),v=a.u.q(g,e,n.y),q=(l-v)/I,l=(l+v)/I;var v=b.Hs(n,c),L=b.Fs(n,c),t=v||L;m=b.wz(n,c,m);var y=b.Gs(n,c),y=t||m||y;b.Bd(n.x,NaN,h);var r=new a.b;b.ac(k,n);r.J(n);null!=z&&z.add(0);y?(t?(v&&b.by(n,
c,z,k),L&&b.Vx(n,c,z,k)):m&&b.Xx(n,c,x,q,l,z,k),b.Bd(c.x,NaN,h),b.ac(k,c)):I<=d?(b.Bd(c.x,NaN,h),b.ac(k,c)):(q=new a.b,m=new a.b,q.J(n),m.J(c),q.x-=h[0],m.x-=h[0],-3.141592653589793>m.x?m.x+=6.283185307179586:3.141592653589793<m.x&&(m.x-=6.283185307179586),b.yv(g,e,f,n,I,x,q,m,0,1,d,z,k,h),b.ac(k,c),b.Bd(c.x,NaN,h));null!=z&&z.add(1)};b.yv=function(g,e,f,n,c,d,m,z,k,h,q,l,v,t){var x=new a.b,I=new a.b;x.ma(m.x+t[0],m.y);new a.ca(0);new a.ca(0);new a.ca(0);new a.ca(0);var L=new a.ca(0),y=new a.ca(0),
r=new a.ca(0),B=new a.b,E=new a.b,u=new a.b,C=new a.b;B.J(m);E.J(z);m=new a.qd(0);z=new a.qd(0);b.$i(m,E);z.add(h);var D=new a.b,P=new a.yb,Y=[];for(b.Kz(4,Y);0<m.size;){for(var G=!1,O,J=NaN,p=0;3>p;p++)if(O=Y[p]*h+(1-Y[p])*k,a.zb.dk(g,e,n.x,n.y,O*c,d,L,y,f),u.ma(L.l,y.l),0==p&&(J=O,C.J(u)),b.mR(B,u,E,P),P.Kb(P.Gd(u,!0),D),a.zb.Rd(g,e,u.x,u.y,D.x,D.y,r,null,null,2),r.l>q){G=!0;break}G?(E.J(C),h=J,b.$i(m,E),z.add(h)):(b.cx(m),z.oj(z.size-1,1,z.size-1),0<m.size&&(b.Bd(E.x,x.x,t),I.ma(t[0]+E.x,E.y),
b.ac(v,I),x.J(I),null!=l&&l.add(h),B.J(E),k=h,b.cy(m,E),h=z.get(z.size-1)))}};b.FR=function(g,e,f,n,c,d,m,z,k){var x=new a.b,h=new a.b,I=new a.b,q=new a.b,l=new a.b,v=new a.b,L=new a.b,t=new a.b,y=new a.b,r=new a.b,B=new a.ca(0),E=new a.ca(0),u=new a.b,C=[[],[]],D=1==a.Nf.Am(c);c=c.Ko();var P=n.Mb(),Y=n.oc();D?(v.ma(P.x*f,P.y*f),L.ma(Y.x*f,Y.y*f)):(C[0][0]=P.x,C[0][1]=P.y,C[1][0]=Y.x,C[1][1]=Y.y,a.Ya.tu(),v.x=C[0][0]*f,v.y=C[0][1]*f,L.x=C[1][0]*f,L.y=C[1][1]*f);var G=0,O=0,J=1,p=n.mD();x.J(P);h.J(Y);
var Y=new a.qd(0),w=new a.qd(0),K=new a.qd(0);b.$i(Y,h);b.$i(w,L);K.add(J);b.ac(k,x);null!=z&&z.add(O);var M=[],U;U=0<m?p?5:3:p?5:1;b.Kz(U,M);for(var Z=new a.ca(0),W=new a.ca(0),N=new a.ca(0),A=new a.ca(0),R=new a.ca(0),X=new a.ca(0),S=new a.ca(0);0<w.size;){var Q=!1,V,T=NaN;a.zb.Rd(g,e,v.x,v.y,L.x,L.y,Z,W,null,2);for(P=0;P<U;P++){if(0==P){if(!p&&0>=m&&Z.l<=d&&3.141592653589793>Math.abs(v.x-L.x))break;if(n.rA(O,J)<=c)break}V=M[P]*J+(1-M[P])*O;n.Kb(V,I);D?t.ma(I.x*f,I.y*f):(C[0][0]=I.x,C[0][1]=I.y,
a.Ya.tu(),t.x=C[0][0]*f,t.y=C[0][1]*f);if(0==P&&(T=V,l.J(I),r.J(t),0<d&&(Z.l>d||3.141592653589793<=Math.abs(v.x-L.x)))){Q=!0;break}if(p&&0<d){if(a.zb.Rd(g,e,v.x,v.y,t.x,t.y,N,null,null,2),N.l>d||3.141592653589793<=Math.abs(v.x-t.x)){Q=!0;break}}else if(0<m)if(p?(q.OO(x,h,M[P]),D?y.ma(q.x*f,q.y*f):(C[0][0]=q.x,C[0][1]=q.y,a.Ya.tu(),y.x=C[0][0]*f,y.y=C[0][1]*f)):(q.J(I),y.J(t)),a.zb.Rd(g,e,v.x,v.y,y.x,y.y,A,null,null,2),A.l<=Z.l){a.zb.dk(g,e,v.x,v.y,A.l,W.l,B,E,2);u.ma(B.l,E.l);a.zb.Rd(g,e,u.x,u.y,
t.x,t.y,R,null,null,2);if(R.l>m){Q=!0;break}if(p){a.zb.Rd(g,e,u.x,u.y,y.x,y.y,X,null,null,2);if(X.l>m){Q=!0;break}a.zb.Rd(g,e,y.x,y.y,t.x,t.y,S,null,null,2);if(S.l>m){Q=!0;break}}}else{Q=!0;break}}Q?(h.J(l),L.J(r),J=T,b.$i(Y,h),b.$i(w,L),K.add(J)):(b.cx(Y),b.cx(w),K.oj(K.size-1,1,K.size-1),b.ac(k,h),G+=Z.l,null!=z&&z.add(G),0<w.size&&(x.J(h),v.J(L),O=J,b.cy(Y,h),b.cy(w,L),J=K.get(K.size-1)))}if(null!=z)for(g=1/G,P=0;P<z.size;P++)z.write(P,z.read(P)*g)};b.gy=function(a,e,f,b){b.reverse();null!=f&&
f.Jp(0,f.size,1);f=null!=a?a[0]:NaN;b=null!=e?e[0]:NaN;null!=a&&(a[0]=b);null!=e&&(e[0]=f)};b.Ez=function(a,e,f,b,c){a?(b.J(f),c.J(e)):(b.J(e),c.J(f))};b.Cz=function(a,e,f){if(!a)return e;f.create(e.D());e.copyTo(f.get());f.get().reverse();return f.get()};b.Bd=function(a,e,f){if(isNaN(e)){for(;3.141592653589793<f[0]-a;)f[0]-=6.283185307179586;for(;3.141592653589793<a-f[0];)f[0]+=6.283185307179586}else 3.141592653589793<f[0]+a-e?f[0]-=6.283185307179586:3.141592653589793<e-(f[0]+a)&&(f[0]+=6.283185307179586)};
b.mR=function(a,e,f,b){3.141592653589793>Math.abs(e.x-a.x)?(b.ed(a),3.141592653589793<=f.x-a.x?b.Ok(f.x-6.283185307179586,f.y):3.141592653589793<=a.x-f.x?b.Ok(f.x+6.283185307179586,f.y):b.Ok(f.x,f.y)):(b.ed(f),3.141592653589793<=a.x-f.x?b.Ok(a.x-6.283185307179586,a.y):3.141592653589793<=f.x-a.x?b.Ok(a.x+6.283185307179586,a.y):b.Ok(a.x,a.y))};b.Kz=function(a,e){for(var f=0;f<a;f++){var g=Math.ceil(f/2)/(a+1);0!=f%2&&(g=-g);e[f]=.5+g}};b.Hs=function(g,e){return a.j.S(g.y,1.570796326794897)&&!a.j.S(e.y,
1.570796326794897)||a.j.S(g.y,-1.570796326794897)&&!a.j.S(e.y,-1.570796326794897)?!0:!1};b.Fs=function(g,e){return a.j.S(e.y,1.570796326794897)&&!a.j.S(g.y,1.570796326794897)||a.j.S(e.y,-1.570796326794897)&&!a.j.S(g.y,-1.570796326794897)?!0:!1};b.wz=function(g,e,f){return!b.uz(g,e,f)||a.j.S(g.y,1.570796326794897)||a.j.S(g.y,-1.570796326794897)||a.j.S(e.y,1.570796326794897)||a.j.S(e.y,-1.570796326794897)?!1:!0};b.uz=function(a,e,f){return Math.abs(Math.abs(a.x-e.x)-3.141592653589793)<=f?!0:!1};b.Gs=
function(g,e){return a.j.S(g.y,1.570796326794897)&&a.j.S(e.y,1.570796326794897)||a.j.S(g.y,-1.570796326794897)&&a.j.S(e.y,-1.570796326794897)?!0:!1};b.by=function(g,e,f,n){if(0<g.y){var c=new a.b;c.ma(e.x,1.570796326794897)}else c=new a.b,c.ma(e.x,-1.570796326794897);a.j.S(g.x,c.x)||a.j.S(e.y,c.y)||(b.ac(n,c),null!=f&&f.add(0))};b.Vx=function(g,e,f,n){if(0<e.y){var c=new a.b;c.ma(g.x,1.570796326794897)}else c=new a.b,c.ma(g.x,-1.570796326794897);a.j.S(e.x,c.x)||a.j.S(g.y,c.y)||(b.ac(n,c),null!=f&&
f.add(1))};b.Xx=function(g,e,f,n,c,d,m){a.j.Vc(f)?(0<1.570796326794897-g.y&&(f=new a.b,f.ma(g.x,1.570796326794897),b.ac(m,f),null!=d&&d.add(n)),0<1.570796326794897-e.y&&(f=new a.b,f.ma(e.x,1.570796326794897),b.ac(m,f),null!=d&&d.add(n))):(0<1.570796326794897+g.y&&(f=new a.b,f.ma(g.x,-1.570796326794897),b.ac(m,f),null!=d&&d.add(c)),0<1.570796326794897+e.y&&(f=new a.b,f.ma(e.x,-1.570796326794897),b.ac(m,f),null!=d&&d.add(c)))};b.eK=function(a){if(-3.141592653589793>a.x)for(;-3.141592653589793>a.x;)a.x+=
6.283185307179586;if(3.141592653589793<a.x)for(;3.141592653589793<a.x;)a.x-=6.283185307179586};return b}();a.ui=b})(E||(E={}));(function(a){var b=function(){function b(){}b.nl=function(g,e,f){if(null==g||null==e||!a.Ya.Qo(e))throw a.g.N();if(g.s())return g;var n=g,c=n.D();if(a.T.Kc(c)){n=a.gh.qo(g,e);g=new a.i;n.o(g);for(var c=a.Ia.zd(e,g,!1),d=a.Ya.Fm(e),m=Math.floor((g.v-d.v)/d.aa())*d.aa()+d.v;m<g.B;)m>g.v+c&&m<g.B-c&&(n=a.gh.Rw(n,e,f,m)),m+=d.aa()}else{if(197==c)return g=new a.Ka(n.description),
g.Wc(n,!1),b.nl(g,e,f);if(a.T.Lc(c))return g=new a.Xa(n.description),g.Bc(n,!0),b.nl(g,e,f)}return b.VG(n,e)};b.VG=function(g,e){if(null==g||null==e||!a.Ya.Qo(e))throw a.g.N();if(g.s())return g;var f;f=g.D();197==f?(f=new a.Ka(g.description),f.Wc(g,!1)):a.T.Lc(f)?(f=new a.Xa(g.description),f.Bc(g,!0)):f=g;f=a.gh.qo(f,e);return f.s()?f:1==a.Nf.Am(e)?a.gh.aN(f,e,f!=g):b.SG(f,e,f!=g)};b.SG=function(g,e,f){if(!a.Ya.Qo(e))throw a.g.N();if(g.s())return g;var b=a.Ya.IC(e),c=0-180*b,b=360*b;2==a.Nf.Am(e)&&
(c=a.Ya.Fm(e),b=c.B,c=c.v,b-=c);return a.gh.gC(g,c,b,e,f)};return b}();a.Vn=b})(E||(E={}));(function(a){var b=function(){function b(){}b.OH=function(a,e){var f=Math.abs(a%e);return isNaN(f)||f==a||f<=Math.abs(e)/2?f:0>a?-1*(f-e):0<a?1*(f-e):0*(f-e)};b.H=function(a){return 0>a?-a:a};b.nb=function(a,e){return 0<=e?b.H(a):-b.H(a)};b.S=function(a,e){return a==e||b.H(a-e)<=b.bF*(1+(b.H(a)+b.H(e))/2)};b.Vc=function(a){return 0==a||b.H(a)<=b.bF};b.bs=function(a){a=b.OH(a,b.fv);return b.H(a)<=b.$g?a:0>a?
a+b.fv:a-b.fv};b.Yz=function(a,e){a.l=b.bs(a.l);e.l=b.bs(e.l);b.H(e.l)>b.Vr&&(a.l=b.bs(a.l+b.$g),e.l=b.nb(b.$g,e.l)-e.l)};b.gg=function(a,e){e=Math.sqrt(1-e);e=(1-e)/(1+e);var f=e*e;return a/(1+e)*(1+f*(.25+f*(.015625+1/256*f)))*b.Vr};b.pN=function(g,e,f,n,c){var d,x,m,z,k,h,q,l=0,v=h=0,t=0,y=0,r=0;k=0;var B,E,u;q=0;var C,D,G;u=new a.ca;d=new a.ca;if(null!=c)if(u.l=g,d.l=e,b.Yz(u,d),g=u.l,e=d.l,u.l=f,d.l=n,b.Yz(u,d),f=u.l,n=d.l,f=b.bs(f-g),b.S(e,n)&&(b.Vc(f)||b.S(b.H(e),b.Vr)))null!=c&&(c.l=0);else{if(b.S(e,
-n)){if(b.S(b.H(e),b.Vr)){null!=c&&(c.l=2*b.gg(6378137,.0066943799901413165));return}if(b.S(b.H(f),b.$g)){null!=c&&(c.l=2*b.gg(6378137,.0066943799901413165));return}}if(b.Vc(.0066943799901413165))y=Math.cos(e),r=Math.cos(n),null!=c&&(l=Math.sin((n-e)/2),h=Math.sin(f/2),q=2*Math.asin(Math.sqrt(l*l+y*r*h*h)),c.l=6378137*q);else{u=1-Math.sqrt(.9933056200098587);g=1-u;d=Math.atan(g*Math.tan(e));e=Math.sin(d);d=Math.cos(d);x=Math.atan(g*Math.tan(n));n=Math.sin(x);x=Math.cos(x);z=m=f;D=0;G=1;C=f;for(E=
!0;1==E;)D+=1,1==G&&(k=Math.sin(C),h=Math.cos(C),l=x*k,q=d*n-e*x*h,l=Math.sqrt(l*l+q*q),h=e*n+d*x*h,q=Math.atan2(l,h),v=1E-15>b.H(l)?d*x*k/b.nb(1E-15,l):d*x*k/l,t=1-v*v,y=1E-15>b.H(t)?h-e*n/b.nb(1E-15,t)*2:h-e*n/t*2,r=y*y,k=((-3*t+4)*u+4)*t*u/16),B=(1-k)*u*(q+k*l*(y+h*k*(2*r-1))),1==G?(C=f+B*v,1E-14>b.H(C-z)?E=!1:b.H(C)>b.$g?(G=2,C=b.$g,0>f&&(C=-C),v=0,t=1,m=z=2,q=b.$g-b.H(Math.atan(e/d)+Math.atan(n/x)),l=Math.sin(q),h=Math.cos(q),k=((-3*t+4)*u+4)*t*u/16,1E-14>b.H(v-m)?E=!1:(y=1E-15>b.H(t)?h-e*n/
b.nb(1E-15,t)*2:h-e*n/t*2,r=y*y)):(0>(C-z)*(z-m)&&5<D&&(C=(2*C+3*z+m)/6),m=z,z=C)):(v=(C-f)/B,0>(v-z)*(z-m)&&5<D&&(v=(2*v+3*z+m)/6),m=z,z=v,t=1-v*v,k=v*l/(d*x),h=-Math.sqrt(b.H(1-k*k)),C=Math.atan2(k,h),l=x*k,q=d*n-e*x*h,l=Math.sqrt(l*l+q*q),h=e*n+d*x*h,q=Math.atan2(l,h),k=((-3*t+4)*u+4)*t*u/16,1E-14>b.H(v-m)?E=!1:(y=1E-15>b.H(t)?h-e*n/b.nb(1E-15,t)*2:h-e*n/t*2,r=y*y));null!=c&&(v=Math.sqrt(1+(1/(g*g)-1)*t),v=(v-1)/(v+1),t=v*(1-.375*v*v),c.l=(1+v*v/4)/(1-v)*g*6378137*(q-t*l*(y+t/4*(h*(-1+2*r)-t/6*
y*(-3+4*l*l)*(-3+4*r)))))}}};b.$g=3.141592653589793;b.Vr=1.5707963267948966;b.fv=6.283185307179586;b.bF=3.552713678800501E-15;return b}();a.nH=b})(E||(E={}));(function(a){var b=function(){function a(){}a.prototype.uv=function(a){this.hi=a};a.prototype.GA=function(a){this.Ab=a};a.prototype.HA=function(a){this.nn=a};a.vB=function(a){return a.s()||1607!=a.D()&&1736!=a.D()?!1:!0};a.tB=function(a){return a.s()||1607!=a.D()&&1736!=a.D()||20>a.F()?!1:!0};a.uB=function(a){return a.s()||1607!=a.D()&&1736!=
a.D()||20>a.F()?!1:!0};return a}();a.Wj=b})(E||(E={}));(function(a){var b=function(){function b(){}b.FH=function(g){var e=new a.Ka;e.Uy(g.R.v,g.R.C);e.wj(g.R.v,g.R.G);e.wj(g.R.B,g.R.G);e.wj(g.R.B,g.R.C);return e};b.aT=function(g,e){var f=a.wi.local();g=new a.Pc(g);return f.$(g,e,null).next()};b.ll=function(g,e,f){return a.Zr.local().$(g,e,f,null)};b.On=function(g,e,f){return a.dv.local().$(g,e,f,null)};b.MS=function(g,e,f){var b=a.dv.local();g=new a.Pc(g);e=new a.Pc(e);f=b.$(g,e,f,null);for(b=[];null!=
(e=f.next());)b.push(e);return b};b.lc=function(g,e,f){return a.bl.local().$(3,g,e,f,null)};b.nM=function(g,e,f){return a.bl.local().$(4,g,e,f,null)};b.QO=function(g,e,f){var b=a.$r.local();g=new a.Pc(g);e=new a.Pc(e);f=b.$(g,e,f,null);for(b=[];null!=(e=f.next());)b.push(e);return b};b.kM=function(g,e,f){var b=a.Zr.local();g=new a.Pc(g);e=new a.Pc(e);f=b.$(g,e,f,null);for(b=[];null!=(e=f.next());)b.push(e);return b};b.Ga=function(g,e,f){return a.$r.local().$(g,e,f,null)};b.jT=function(g,e,f){return a.bl.local().$(2,
g,e,f,null)};b.contains=function(g,e,f){return a.bl.local().$(1,g,e,f,null)};b.VL=function(g,e,f){return a.bl.local().$(16,g,e,f,null)};b.touches=function(g,e,f){return a.bl.local().$(8,g,e,f,null)};b.tQ=function(g,e,f){return a.bl.local().$(32,g,e,f,null)};b.RO=function(g,e,f){return a.bl.local().$(1073741824,g,e,f,null)};b.py=function(g,e,f,b){return a.fI.local().$(g,e,f,b,null)};b.Fb=function(g,e,f,b){var n=null;if(null!=f){if(n=f.Se(),null!=b&&n.Qc()!=b.Qc()&&n.Nc!=b.Nc)throw a.g.cj();}else if(null!=
b)throw a.g.N();g=a.ZH.local().$(g,e,null);null!==n&&null!==b&&(g=a.Tb.ih(g,n,b));return g};b.clip=function(g,e,f){return a.SH.local().$(g,a.i.Oa(e.R.v,e.R.C,e.R.B,e.R.G),f,null)};b.xm=function(g,e,f){if(null==g||null==e)return null;g=a.UH.local().$(!0,g,e,f,null);for(e=[];null!=(f=g.next());)f.s()||e.push(f);return e.slice(0)};b.rK=function(g,e,f,n,c,d,m,k){if(!0===c)return b.VP(g,e,f,n,d,m,k);c=f;if(null!=e){if(m=e.Se(),null!=n&&m.Qc()!=n.Qc()){if(m.Nc!=n.Nc)throw a.g.cj();c=[];a.Tb.OB(f,f.length,
n,m,c)}}else if(null!=n)throw a.g.N();f=a.Oz.local();if(d){g=new a.Pc(g);e=f.$(g,e,c,d,null);for(g=[];null!=(d=e.next());)g.push(d);d=g.slice(0)}else for(d=[],n=0;n<g.length;n++)d[n]=f.$(g[n],e,c[n],null);return d};b.VP=function(g,e,f,b,c,d,m){if(null===e)throw a.g.N();if(null===b||void 0===b)b=4326!==e.Qc()?e.Se():a.Tb.Qd(9001);if(0!==b.Nc)throw a.g.N();a.Tb.OB(f,f.length,b,a.Tb.Qd(9001),f);b=a.Tz.local();if(c){g=new a.Pc(g);e=b.$(g,e,d,f,m,!1,c,null);for(f=[];null!=(d=e.next());)f.push(d);c=f.slice(0)}else{c=
[];for(var n=0;n<g.length;n++)c[n]=b.$(g[n],e,d,f[n],m,!1,null)}return c};b.buffer=function(g,e,f,b,c,d,m){var n=f;if(!1===c){if(null!=e){if(c=e.Se(),null!=b&&c.Qc()!=b.Qc()){if(c.Nc!=b.Nc)throw a.g.cj();n=a.Tb.ih(f,b,c)}}else if(null!=b)throw a.g.N();g=a.Oz.local().$(g,e,n,null)}else{if(null===e)throw a.g.N();if(null===b||void 0===b)b=4326!==e.Qc()?e.Se():a.Tb.Qd(9001);if(0!==b.Nc)throw a.g.N();n=a.Tb.ih(f,b,a.Tb.Qd(9001));g=a.Tz.local().$(g,e,d,n,m,!1,null)}return g};b.sQ=function(g,e,f,b,c,d,m){if(null!=
e){var n=e.Se();if(null!=m&&n.Qc()!=m.Qc()){if(n.Nc!=m.Nc)throw a.g.cj();f=a.Tb.ih(f,m,n)}}else if(null!=m)throw a.g.N();g=new a.Pc(g);e=a.Wz.local().$(g,e,f,b,c,d,null);for(f=[];null!=(b=e.next());)f.push(b);return f.slice(0)};b.offset=function(g,e,f,b,c,d,m){if(null!=e){var n=e.Se();if(null!=m&&n.Qc()!=m.Qc()){if(n.Nc!=m.Nc)throw a.g.cj();f=a.Tb.ih(f,m,n)}}else if(null!=m)throw a.g.N();return a.Wz.local().$(g,e,f,b,c,d,null)};b.JL=function(g){return a.Qz.local().$(g,null)};b.KL=function(g,e){var f=
a.Qz.local();g=new a.Pc(g);f=f.$(g,e,null);for(g=[];null!=(e=f.next());)g.push(e);return g};b.zw=function(g,e,f){return a.bv.local().zw(g,e,f)};b.Aw=function(g,e){return a.bv.local().Aw(g,e)};b.Bw=function(g,e,f,b){return a.bv.local().Bw(g,e,f,b)};b.Qy=function(g,e){return a.as.local().$(g,e,!1,null)};b.cP=function(g,e){return a.as.local().Ro(g,e,null)};b.fN=function(g,e,f,b,c){var n=a.Sz.local();if(null!=e){if(e=e.Se(),null!=c&&e.Qc()!=c.Qc()){if(e.Nc!=c.Nc)throw a.g.cj();f=a.Tb.ih(f,c,e)}}else if(null!=
c)throw a.g.N();return n.$(g,f,b,null)};b.oq=function(g,e,f,b){var n=a.WH.local();if(null!=e){if(e=e.Se(),null!=b&&e.Qc()!=b.Qc()){if(e.Nc!=b.Nc)throw a.g.cj();f=a.Tb.ih(f,b,e)}}else if(null!=b)throw a.g.N();return n.$(g,f,null)};b.fw=function(g,e,f,b,c){void 0===c&&(c=0);var n=a.aI.local();if(4==c)throw a.g.qe();if(0!==c)throw a.g.qe();if(null!=e){var d=e.Se();if(null!=b&&d.Qc()!=b.Qc()){if(d.Nc!=b.Nc)throw a.g.cj();f=a.Tb.ih(f,b,d)}}else if(null!=b)throw a.g.N();return n.$(g,f,e,c,null)};b.jN=function(g,
e,f,n){if(null===g)return 0;if(4==n)throw a.g.qe();if(0!==n)throw a.g.qe();if(197==g.D())g=b.FH(g);else if(1736!=g.D())return 0;n=a.Ya.Em(e);g=a.Ya.Wl(g,e,n);g=a.oH.kN([g])[0];if(null!==f){if(2!==f.Nc)throw a.g.N("Unit must be a area unit type");g=a.Tb.ih(g,a.Tb.Qd(109404),f)}return g};b.nN=function(g,e,f,b){g=a.cI.local().$(g,e,b,null);if(null!==f){if(0!==f.Nc)throw a.g.N("Unit must be a linear unit type");g=a.Tb.ih(g,a.Tb.Qd(9001),f)}return g};b.BQ=function(g,e,f){if(null===g)return 0;var b=null;
if(null!=e){b=e.Se();if(0==b.Nc&&(b=a.Tb.PC(b),null==b&&null!==f))throw a.g.N();if(null!=f&&b.Qc()!=f.Qc()&&b.Nc!=f.Nc)throw a.g.cj();}else if(null!=f)throw a.g.N();return 1736==g.D()||197==g.D()?(g=g.Mh(),null!==f?a.Tb.ih(g,b,f):g):0};b.CQ=function(g,e,f){if(null===g||g.s()||1>g.fb())return 0;var b=null;if(null!=e){if(b=e.Se(),null!=f&&b.Qc()!=f.Qc()&&b.Nc!=f.Nc)throw a.g.cj();}else if(null!=f)throw a.g.N();1736==g.D()||197==g.D()?e=g.Rf():a.T.Lc(g.D())?(e=new a.Xa(g.description),e.Bc(g,!0)):e=g;
g=0;e=e.Ca();for(var c=new a.b,d=new a.b;e.kb();)for(;e.La();){var m=e.ia();m.ht(c);m.uw(d);g+=a.b.Fb(c,d)}null!==b&&null!==f&&(g=a.Tb.ih(g,b,f));return g};b.YT=function(g,e){return a.Nf.mN(g,e)};b.IL=function(a){return void 0!==a.points?b.kH(a,void 0===a.hasZ?!1:a.hasZ,void 0===a.hasM?!1:a.hasM):void 0!==a.rings?b.Nz(a.rings,void 0===a.hasZ?!1:a.hasZ,void 0===a.hasM?!1:a.hasM,"P"):void 0!==a.paths?b.Nz(a.paths,void 0===a.hasZ?!1:a.hasZ,void 0===a.hasM?!1:a.hasM,"L"):void 0!==a.x?b.uH(a):void 0!==
a.xmin?b.hH(a):null};b.uH=function(g){if(null==g.x||"NaN"==g.x)return new a.Va;var e=new a.Va(g.x,g.y);void 0!==g.z&&null!==g.z&&e.rS(g.z);void 0!==g.m&&null!==g.m&&e.bS(g.m);return e};b.hH=function(g){if(null==g.xmin||"NaN"==g.xmin)return new a.Vj;var e=new a.Vj(g.xmin,g.ymin,g.xmax,g.ymax);void 0!==g.zmin&&null!==g.zmin&&e.setInterval(1,0,g.zmin,g.zmax);void 0!==g.mmin&&null!==g.mmin&&e.setInterval(2,0,g.mmin,g.mmax);return e};b.kH=function(g,e,f){var b=0,c=new a.pe,d=3*g.points.length;0!=d%2&&
d++;2>d&&(d=2);var m=a.I.truncate(3*g.points.length/2);4>m?m=4:16>m&&(m=16);for(var d=a.Ac.kl(d,0),k=a.Ac.kl(m),m=a.Ac.kl(m),z=0;z<g.points.length;z++)d.write(2*z,g.points[z][0]),d.write(2*z+1,g.points[z][1]),k.write(z,e||f?g.points[z][2]:NaN),m.write(z,f&&e?g.points[z][3]:NaN),b++;0!=b&&(c.resize(b),c.bm(0,d));e&&(c.Ne(1),c.bm(1,k));f&&(c.Ne(2),c.bm(2,0==e?k:m));c.ce(16777215);return c};b.Nz=function(g,e,f,b){var n,c=0,d=2;"P"==b?(n=new a.Ka,c=1,d=3):n=new a.Xa;for(var m=a.Ac.Dg(0),k=a.Ac.to(0),
z=0,h=0,q=[],l=[],v=0;v<g.length;v++){var t=g[v].length;q[v]=!1;if("P"===b&&g[v][0][0]===g[v][g[v].length-1][0]&&g[v][0][1]===g[v][g[v].length-1][1]){var y=0==f?!0:g[v][0][3]===g[v][g[v].length-1][3]||void 0===g[v][0][3]&&void 0===g[v][g[v].length-1][3];(0==e||g[v][0][2]===g[v][g[v].length-1][2]||void 0===g[v][0][2]&&void 0===g[v][g[v].length-1][2])&&y&&(q[v]=!0,--t)}t>=d?(l[v]=!1,h+=1,m.add(z),k.add(c),z+=t):l[v]=!0}b=3*z;0!=b%2&&b++;2>b&&(b=2);v=a.I.truncate(3*z/2);4>v?v=4:16>v&&(v=16);b=a.Ac.kl(b,
0);c=a.Ac.kl(v);d=a.Ac.kl(v);for(v=t=0;v<g.length;v++)if(!1===l[v])for(y=0;y<g[v].length;y++){var r=!1;y===g[v].length-1&&!0===q[v]&&(r=!0);r||(b.write(2*t,g[v][y][0]),b.write(2*t+1,g[v][y][1]),c.write(t,e||f?g[v][y][2]:NaN),d.write(t,f&&e?g[v][y][3]:NaN),t++)}0!=z&&(g=n,m.resize(h),k.resize(h),0<z&&(m.add(z),k.add(0)),g.bm(0,b),g.NF(k),g.OF(m));e&&(n.Ne(1),n.bm(1,c));f&&(n.Ne(2),n.bm(2,0==e?c:d));n.ce(16777215);return n};return b}();a.Pb=b})(E||(E={}));(function(a){var b=function(){function a(){}
a.Zk=function(a){var e=0,f=0,g=a.length,b=a[f],c;for(f;f<g-1;f++)c=a[f+1],e+=(c[0]-b[0])*(c[1]+b[1]),b=c;return 0<=e};a.rotate=function(g,e,f){e=e*Math.PI/180;var b=Math.cos(e),c=Math.sin(e);if(void 0!==g.paths){e={paths:[]};for(var d=0;d<g.paths.length;d++){for(var m=g.paths[d],k=[],z=0;z<m.length;z++){var h=m[z].slice(0);k.push(h);var q=b*(m[z][0]-f.x)-c*(m[z][1]-f.y)+f.x,l=c*(m[z][0]-f.x)+b*(m[z][1]-f.y)+f.y;h[0]=q;h[1]=l}e.paths.push(k)}return e}if(void 0!==g.rings){e={rings:[]};for(d=0;d<g.rings.length;d++){for(var m=
g.rings[d],k=[],v=a.Zk(m),z=0;z<m.length;z++)h=m[z].slice(0),k.push(h),q=b*(m[z][0]-f.x)-c*(m[z][1]-f.y)+f.x,l=c*(m[z][0]-f.x)+b*(m[z][1]-f.y)+f.y,h[0]=q,h[1]=l;a.Zk(k)!==v&&k.reverse();e.rings.push(k)}return e}if(void 0!==g.x)return e={x:b*(g.x-f.x)-c*(g.y-f.y)+f.x,y:c*(g.x-f.x)+b*(g.y-f.y)+f.y},void 0!==g.z&&(e.z=g.z),void 0!==g.m&&(e.m=g.m),e;if(void 0!==g.points){e={points:[]};g=g.points;for(z=0;z<g.length;z++)d=g[z].slice(0),d[0]=b*(g[z][0]-f.x)-c*(g[z][1]-f.y)+f.x,d[1]=c*(g[z][0]-f.x)+b*(g[z][1]-
f.y)+f.y,e.points.push(d);return e}return null};a.eC=function(g,e){var f,b;if(void 0!==g.paths){f={paths:[]};for(var c=0;c<g.paths.length;c++){for(var d=g.paths[c],m=[],k=0;k<d.length;k++){var z=d[k].slice(0);m.push(z);b=e.x-d[k][0];z[0]=d[k][0]+2*b}f.paths.push(m)}return f}if(void 0!==g.rings){f={rings:[]};for(c=0;c<g.rings.length;c++){for(var d=g.rings[c],h=a.Zk(d),m=[],k=0;k<d.length;k++)z=d[k].slice(0),m.push(z),b=e.x-d[k][0],z[0]=d[k][0]+2*b;a.Zk(m)!==h&&m.reverse();f.rings.push(m)}return f}if(void 0!==
g.x)return b=e.x-g.x,f={x:g.x+2*b,y:g.y},void 0!==g.z&&(f.z=g.z),void 0!==g.m&&(f.m=g.m),f;if(void 0!==g.points){f={points:[]};c=g.points;for(k=0;k<c.length;k++)d=c[k].slice(0),b=e.x-d[0],d[0]+=2*b,f.points.push(d);return f}return void 0!==g.xmin?(f={v:g.xmin,C:g.ymin,B:g.xmax,G:g.ymax},void 0!==g.zmin&&(f.zmin=g.zmin,f.zmax=g.zmax),void 0!==g.mmin&&(f.mmin=g.mmin,f.mmax=g.mmax),b=e.x-g.xmin,f.xmax=g.xmin+2*b,b=e.x-g.xmax,f.xmin=g.xmax+2*b,f):null};a.fC=function(g,e){var f,b;if(void 0!==g.paths){f=
{paths:[]};for(var c=0;c<g.paths.length;c++){for(var d=g.paths[c],m=[],k=0;k<d.length;k++){var z=d[k].slice(0);m.push(z);b=e.y-d[k][1];z[1]=d[k][1]+2*b}f.paths.push(m)}return f}if(void 0!==g.rings){f={rings:[]};for(c=0;c<g.rings.length;c++){for(var d=g.rings[c],h=a.Zk(d),m=[],k=0;k<d.length;k++)z=d[k].slice(0),m.push(z),b=e.y-d[k][1],z[1]=d[k][1]+2*b;a.Zk(m)!==h&&m.reverse();f.rings.push(m)}return f}if(void 0!==g.x)return b=e.y-g.y,f={y:g.y+2*b,x:g.x},void 0!==g.z&&(f.z=g.z),void 0!==g.m&&(f.m=g.m),
f;if(void 0!==g.points){f={points:[]};c=g.points;for(k=0;k<c.length;k++)d=c[k].slice(0),b=e.y-d[1],d[1]+=2*b,f.points.push(d);return f}return void 0!==g.xmin?(f={v:g.xmin,C:g.ymin,B:g.xmax,G:g.ymax},void 0!==g.zmin&&(f.zmin=g.zmin,f.zmax=g.zmax),void 0!==g.mmin&&(f.mmin=g.mmin,f.mmax=g.mmax),b=e.y-g.ymin,f.ymax=g.ymin+2*b,b=e.y-g.ymax,f.ymin=g.ymax+2*b,f):null};return a}();a.Wn=b})(E||(E={}));(function(a){var b=function(){function b(){}b.jg=function(g,e){null==e&&(e=a.Od.Tf());switch(g){case 33:return new a.Va(e);
case 322:return new a.yb(e);case 197:return new a.Vj(e);case 550:return new a.pe(e);case 1607:return new a.Xa(e);case 1736:return new a.Ka(e);default:throw a.g.ra("invalid argument.");}};return b}();a.sH=b})(E||(E={}));(function(a){var b=function(){function b(g,e){this.De=a.ga.Yc(g,-1);this.oa=new a.Ur;this.tk=e}b.prototype.wR=function(a){this.oa.Dr(Math.min(this.De.size,a));this.oa.$l(a)};b.prototype.addElement=function(g,e){if(void 0===e)return this.JJ(g);e=a.I.truncate(e%this.De.size);var f=this.De.get(e);
-1==f&&(f=this.oa.jh(),this.De.set(e,f));return this.oa.addElement(f,g)};b.prototype.JJ=function(g){var e=this.tk.vw(g),e=a.I.truncate(e%this.De.size),f=this.De.get(e);-1==f&&(f=this.oa.jh(),this.De.set(e,f));return this.oa.addElement(f,g)};b.prototype.Jc=function(g,e){if(void 0===e)this.dM(g);else{e=a.I.truncate(e%this.De.size);var f=this.De.get(e);if(-1==f)throw a.g.N();for(var b=this.oa.gc(f),c=-1;-1!=b;){var d=this.oa.bb(b);this.oa.da(b)==g?(this.oa.Jc(f,c,b),-1==this.oa.gc(f)&&(this.oa.Fg(f),
this.De.set(e,-1))):c=b;b=d}}};b.prototype.dM=function(g){var e=this.tk.vw(g),e=a.I.truncate(e%this.De.size),f=this.De.get(e);if(-1==f)throw a.g.N();for(var b=this.oa.gc(f),c=-1;-1!=b;){var d=this.oa.bb(b);this.oa.da(b)==g?(this.oa.Jc(f,c,b),-1==this.oa.gc(f)&&(this.oa.Fg(f),this.De.set(e,-1))):c=b;b=d}};b.prototype.DN=function(g){g=a.I.truncate(g%this.De.size);g=this.De.get(g);return-1==g?-1:this.oa.gc(g)};b.prototype.SN=function(a){return this.oa.bb(a)};b.prototype.kd=function(g){var e=this.tk.vw(this.da(g)),
e=a.I.truncate(e%this.De.size),f=this.De.get(e);if(-1==f)throw a.g.N();for(var b=this.oa.gc(f),c=-1;-1!=b;){if(b==g){this.oa.Jc(f,c,b);-1==this.oa.gc(f)&&(this.oa.Fg(f),this.De.set(e,-1));return}c=b;b=this.oa.bb(b)}throw a.g.N();};b.prototype.da=function(a){return this.oa.da(a)};b.prototype.clear=function(){this.De=a.ga.Yc(this.De.size,-1);this.oa.clear()};b.prototype.size=function(){return this.oa.HC()};return b}();a.AH=b})(E||(E={}));(function(a){var b=function(){function b(){this.ci=new a.Fc(3);
this.oa=new a.Fc(6);this.AP=!1;this.Wd=-1}b.prototype.bk=function(a){this.ci.Jc(a)};b.prototype.ou=function(){return this.ci.be()};b.prototype.Rs=function(a){this.oa.Jc(a)};b.prototype.Yx=function(){return this.oa.be()};b.prototype.Jy=function(a,e){this.ci.L(a,1,e)};b.prototype.Gu=function(a,e){this.ci.L(a,2,e)};b.prototype.aS=function(a,e){this.ci.L(a,3,e)};b.prototype.Hy=function(a,e){this.oa.L(a,4,e)};b.prototype.dS=function(a,e){this.oa.L(a,3,e)};b.prototype.RF=function(a,e){this.oa.L(a,2,e)};
b.prototype.jh=function(a){var e=this.Yx();this.oa.L(e,3,this.Wd);this.oa.L(e,4,0);this.oa.L(e,5,a);-1!=this.Wd&&this.RF(this.Wd,e);return this.Wd=e};b.prototype.Fg=function(a){this.CB(a);var e=this.oa.O(a,2),f=this.oa.O(a,3);-1!=e?this.dS(e,f):this.Wd=f;-1!=f&&this.RF(f,e);this.Rs(a);return f};b.prototype.Dr=function(a){this.oa.de(a)};b.prototype.DC=function(a){return this.oa.O(a,5)};b.prototype.$R=function(a,e){this.oa.L(a,5,e)};b.prototype.addElement=function(a,e){return this.AO(a,e)};b.prototype.AO=
function(a,e){var f=this.ou();this.Gu(f,-1);-1==this.oa.O(a,0)&&this.oa.L(a,0,f);var b=this.oa.O(a,1);this.Jy(f,b);-1!=b&&this.Gu(b,f);this.oa.L(a,1,f);this.setData(f,e);this.Hy(a,this.vq(a)+1);this.AP&&this.aS(f,a);return f};b.prototype.Jc=function(a,e){var f=this.ge(e),b=this.bb(e);-1!=f?this.Gu(f,b):this.oa.L(a,0,b);-1!=b?this.Jy(b,f):this.oa.L(a,1,f);this.bk(e);this.Hy(a,this.vq(a)-1);return b};b.prototype.$l=function(a){this.ci.de(a)};b.prototype.getData=function(a){return this.ci.O(a,0)};b.prototype.setData=
function(a,e){this.ci.L(a,0,e)};b.prototype.bb=function(a){return this.ci.O(a,2)};b.prototype.ge=function(a){return this.ci.O(a,1)};b.prototype.gc=function(a){return this.oa.O(a,0)};b.prototype.tc=function(a){return this.oa.O(a,1)};b.prototype.clear=function(){for(var a=this.Wd;-1!=a;)a=this.Fg(a)};b.prototype.CB=function(a){for(var e=this.tc(a);-1!=e;){var f=e,e=this.ge(f);this.bk(f)}this.oa.L(a,0,-1);this.oa.L(a,1,-1);this.Hy(a,0)};b.prototype.s=function(){return 0==this.ci.size};b.prototype.HC=
function(){return this.ci.size};b.prototype.vq=function(a){return this.oa.O(a,4)};b.prototype.Cw=function(a){return this.oa.O(a,3)};return b}();a.$n=b})(E||(E={}));(function(a){var b=function(){function b(b){void 0===b?(this.bg=new a.Fc(2),this.oa=new a.Fc(4),this.Wd=-1,this.Bt=!0):(this.bg=new a.Fc(2),this.oa=new a.Fc(b?4:2),this.Wd=-1,this.Bt=b)}b.prototype.bk=function(a){this.bg.Jc(a)};b.prototype.ou=function(){return this.bg.be()};b.prototype.Rs=function(a){this.oa.Jc(a)};b.prototype.Yx=function(){return this.oa.be()};
b.prototype.jh=function(){var a=this.Yx();this.Bt&&(this.oa.L(a,3,this.Wd),-1!=this.Wd&&this.oa.L(this.Wd,2,a),this.Wd=a);return a};b.prototype.Fg=function(a){for(var e=this.gc(a);-1!=e;){var f=e,e=this.bb(e);this.bk(f)}this.Bt&&(e=this.oa.O(a,2),f=this.oa.O(a,3),-1!=e?this.oa.L(e,3,f):this.Wd=f,-1!=f&&this.oa.L(f,2,e));this.Rs(a)};b.prototype.Dr=function(a){this.oa.de(a)};b.prototype.addElement=function(a,e){var f=this.oa.O(a,1),b=this.ou();-1!=f?this.bg.L(f,1,b):this.oa.L(a,0,b);this.oa.L(a,1,b);
this.bg.L(b,0,e);return b};b.prototype.$l=function(a){this.bg.de(a)};b.prototype.Jc=function(a,e,f){-1!=e?(this.bg.L(e,1,this.bg.O(f,1)),this.oa.O(a,1)==f&&this.oa.L(a,1,e)):(this.oa.L(a,0,this.bg.O(f,1)),this.oa.O(a,1)==f&&this.oa.L(a,1,-1));this.bk(f)};b.prototype.Qv=function(a,e){var f=this.oa.O(a,1),b=this.oa.O(e,0);-1!=b&&(-1!=f?this.bg.L(f,1,b):this.oa.L(a,0,b),this.oa.L(a,1,this.oa.O(e,1)));this.Bt&&(f=this.oa.O(e,2),b=this.oa.O(e,3),-1!=f?this.oa.L(f,3,b):this.Wd=b,-1!=b&&this.oa.L(b,2,f));
this.Rs(e)};b.prototype.da=function(a){return this.bg.O(a,0)};b.prototype.Vi=function(a,e){this.bg.L(a,0,e)};b.prototype.bb=function(a){return this.bg.O(a,1)};b.prototype.gc=function(a){return this.oa.O(a,0)};b.prototype.Dm=function(a){return this.da(this.gc(a))};b.prototype.clear=function(){this.bg.Nh(!0);this.oa.Nh(!0);this.Wd=-1};b.prototype.s=function(a){return void 0===a?0==this.bg.size:-1==this.oa.O(a,0)};b.prototype.HC=function(){return this.bg.size};b.prototype.Cw=function(a){return this.oa.O(a,
3)};return b}();a.Ur=b})(E||(E={}));(function(a){var b=function(){function b(){}b.kz=function(g,e,f,n,c,d,m){var x=new a.b;x.J(g);g=new a.b;g.J(e);c.vv(x);c.vv(g);e=c.ms(x);var k=c.ms(g);0==k&&(k=c.CC());if(x.x!=g.x&&(x.y!=g.y||x.y!=c.C&&x.y!=c.G)||k>e!=d){e=c.vA(x);var k=c.vA(g),z,h=d?1:3;do e=e+h&3,z=c.vu(e),0!=m&&(n=b.kz(x,z,f,n,c,d,m)),f[n++].ma(z.x,z.y),x=z;while((e&3)!=k);0!=m&&(n=b.kz(x,g,f,n,c,d,m))}else if(c=new a.b,c.ma(g.x-x.x,g.y-x.y),0!=m&&(m=a.I.truncate(c.yJ()/m),0<m))for(c.scale(1/
(m+1)),d=0;d<m;d++)x.add(c),f[n++].ma(x.x,x.y);return n};b.zd=function(a,e,f){e=e.lv();a=null!=a&&void 0!==a.Ko?a.Ko():0;f&&(e*=4,a*=1.1);return Math.max(a,e)};b.As=function(a){return 2*Math.sqrt(2)*a};b.UJ=function(a){return Math.sqrt(2)*a};b.Cg=function(g,e,f){var n=new a.i;e.o(n);return b.zd(g,n,f)};b.rB=function(a,e,f){e=e.Ah(1,0).lv();a=null!=a?a.Ko():0;f&&(e*=4,a*=1.1);return Math.max(a,e)};b.$T=function(b,e){var f=new a.i;b.dd(f);f.Db(e);return f};b.$s=function(b,e){var f=new a.i;b.dd(f);b=
new a.i;e.dd(b);f.Db(b);return f};b.fU=function(b,e){var f=b.HN(e),g=b.Ea(e),c=b.Dc(e),d=b.Fa(f);f==g?(c=b.Fa(c-1),f=b.Fa(g+1)):f==c-1?(c=b.Fa(f-1),f=b.Fa(g)):(c=b.Fa(f-1),f=b.Fa(f+1));d=a.b.yn(c,d,f);return 0==d?0<b.oo(e):-1==d};b.CK=function(b){var e=new a.i;b.dd(e);if(e.s())return null;var f=new a.co(e,8),g=-1,c=new a.i,d=!1;do for(var m=0,k=b.ea();m<k;m++)if(b.Ti(m,c),g=f.kt(m,c,g),-1==g){if(d)throw a.g.ra("internal error");b.tm(e,!1);d=!0;f.reset(e,8);break}else d=!1;while(d);return f};b.nB=
function(b){var e=new a.i;b.dd(e);for(var f=new a.co(e,8),g=-1,c=b.Ca(),d=new a.i,m=!1;c.kb();)for(;c.La();){var k=c.ia(),z=c.Jb();k.o(d);g=f.kt(z,d,g);if(-1==g){if(m)throw a.g.wa();b.tm(e,!1);m=!0;f.reset(e,8);c.Lk();break}}return f};b.ij=function(b,e){var f=new a.i;b.dd(f);for(var g=new a.co(f,8),c=-1,d=new a.i,m=b.Ca(),k=!1;m.kb();)for(;m.La();){var z=m.ia(),h=m.Jb();z.o(d);if(d.jc(e)&&(c=g.kt(h,d,c),-1==c)){if(k)throw a.g.ra("internal error.");b.tm(f,!1);k=!0;g.reset(f,8);m.Lk();break}}return g};
b.DT=function(b){var e=new a.i;b.dd(e);for(var f=new a.co(e,8),g=new a.b,c=new a.i,d=!1,m=0;m<b.F();m++)if(b.w(m,g),c.K(g),-1==f.lg(m,c)){if(d)throw a.g.wa();b.tm(e,!1);d=!0;f.reset(e,8);m=-1}return f};b.oB=function(b,e){for(var f=new a.co(e,8),g=new a.b,c=!1,d=new a.i,m=0;m<b.F();m++)if(b.w(m,g),e.contains(g)&&(d.K(g),-1==f.lg(m,d))){if(c)throw a.g.wa();c=!0;m=new a.i;b.tm(m,!1);f.reset(m,8);m=-1}return f};b.AN=function(b,e,f){var g=new a.i,c=new a.i;b.dd(g);e.dd(c);g.P(f,f);c.P(f,f);var d=new a.i;
d.K(g);d.Ga(c);b=b.Ca();e=e.Ca();var m=new a.sz;m.YF(f);var k=!1;for(m.jG();b.kb();)for(;b.La();)b.ia().o(g),g.jc(d)&&(k=!0,f=new a.i,f.K(g),m.OA(b.Jb(),f));m.$B();if(!k)return null;g=!1;for(m.iG();e.kb();)for(;e.La();)e.ia().o(c),c.jc(d)&&(g=!0,f=new a.i,f.K(c),m.LA(e.Jb(),f));m.ZB();return g?m:null};b.BN=function(b,e,f,n,c){var g=b.D(),d=e.D(),m=new a.i,x=new a.i;b.dd(m);e.dd(x);m.P(f,f);x.P(f,f);var k=new a.i;k.K(m);k.Ga(x);var z=new a.sz;z.YF(f);var h=!1;z.jG();var q=0;for(f=b.ea();q<f;q++)if(!n||
1736!=g||b.qt(q))b.Ti(q,m),m.jc(k)&&(h=!0,z.OA(q,m));z.$B();if(!h)return null;b=!1;z.iG();n=0;for(f=e.ea();n<f;n++)if(!c||1736!=d||e.qt(n))e.Ti(n,x),x.jc(k)&&(b=!0,z.LA(n,x));z.ZB();return b?z:null};b.hU=function(a,e){return 0<a.rj(e)};b.zT=function(b,e){var f=new a.i;b.hR(e,f);var f=new a.co(f,8),g=-1,c=new a.i;b=b.Ca();b.vy(e);if(b.kb())for(;b.La();){e=b.ia();var d=b.Jb();e.dd(c);g=f.kt(d,c,g);if(-1==g)throw a.g.ra("internal error");}return f};return b}();a.Ia=b})(E||(E={}));(function(a){var b=
function(){function e(e){this.Na=e}e.prototype.compare=function(e,a,b){e=e.da(b);b=this.Na.uj(a);var g=this.Na.uj(e);return b<g?-1:b==g?f.Po(a)&&f.st(e)?-1:f.Po(e)&&f.st(a)?1:0:1};return e}(),c=function(){function e(e){this.Na=e}e.prototype.Zp=function(e,a,f){this.Na.yS(f,e,a)};e.prototype.Mo=function(e){return this.Na.uj(e)};return e}(),g;(function(e){e[e.initialize=0]="initialize";e[e.pIn=1]="pIn";e[e.pL=2]="pL";e[e.pR=3]="pR";e[e.pT=4]="pT";e[e.right=5]="right";e[e.left=6]="left";e[e.all=7]="all"})(g||
(g={}));var e=function(){function e(){this.Na=null;this.gi=new a.Nd;this.ug=new a.ga(0);this.$f=[0,0]}e.prototype.Ch=function(e,a){this.gi.qa=e.qa-a;this.gi.va=e.va+a;this.ug.resize(0);this.Ud=0;this.$f[0]=0};e.prototype.uy=function(e,f,b){if(e>f)throw a.g.N();this.gi.qa=e-b;this.gi.va=f+b;this.ug.resize(0);this.Ud=0;this.$f[0]=0};e.prototype.Fn=function(e,a){this.gi.qa=e-a;this.gi.va=e+a;this.ug.resize(0);this.Ud=0;this.$f[0]=0};e.prototype.next=function(){if(!this.Na.Vo)throw a.g.xa();if(0>this.Ud)return-1;
for(var e=!0;e;)switch(this.$f[this.Ud]){case 1:e=this.uQ();break;case 2:e=this.vQ();break;case 3:e=this.wQ();break;case 4:e=this.xQ();break;case 5:e=this.BR();break;case 6:e=this.sP();break;case 7:e=this.XJ();break;case 0:e=this.Qw();break;default:throw a.g.wa();}return-1!=this.pg?this.Bo()>>1:-1};e.JT=function(a,f,b){var g=new e;g.Na=a;g.ug.xb(20);g.Ch(f,b);return g};e.KT=function(a,f,b){var g=new e;g.Na=a;g.ug.xb(20);g.Fn(f,b);return g};e.Oa=function(a){var f=new e;f.Na=a;f.ug.xb(20);f.Ud=-1;return f};
e.prototype.Qw=function(){this.pg=this.YD=this.di=this.yc=-1;if(null!=this.Na.Yd&&0<this.Na.Yd.size)return this.$f[0]=1,this.di=this.Na.Ze,!0;this.Ud=-1;return!1};e.prototype.uQ=function(){this.yc=this.di;if(-1==this.yc)return this.pg=this.Ud=-1,!1;var e=this.Na.Co(this.yc);if(this.gi.va<e)return e=this.Na.tj(this.yc),this.di=this.Na.Di(this.yc),-1!=e&&(this.vh=this.Na.gk(e),this.$f[++this.Ud]=6),!0;if(e<this.gi.qa)return e=this.Na.tj(this.yc),this.di=this.Na.sj(this.yc),-1!=e&&(this.vh=this.Na.uq(e),
this.$f[++this.Ud]=5),!0;this.$f[this.Ud]=2;this.YD=this.yc;e=this.Na.tj(this.yc);this.di=this.Na.Di(this.yc);-1!=e&&(this.vh=this.Na.gk(e),this.$f[++this.Ud]=7);return!0};e.prototype.vQ=function(){this.yc=this.di;if(-1==this.yc)return this.$f[this.Ud]=3,this.di=this.Na.sj(this.YD),!0;if(this.Na.Co(this.yc)<this.gi.qa){var e=this.Na.tj(this.yc);this.di=this.Na.sj(this.yc);-1!=e&&(this.vh=this.Na.uq(e),this.$f[++this.Ud]=5);return!0}e=this.Na.tj(this.yc);this.di=this.Na.Di(this.yc);-1!=e&&(this.vh=
this.Na.gk(e),this.$f[++this.Ud]=7);e=this.Na.sj(this.yc);-1!=e&&this.ug.add(e);return!0};e.prototype.wQ=function(){this.yc=this.di;if(-1==this.yc)return this.$f[this.Ud]=4,!0;if(this.gi.va<this.Na.Co(this.yc)){var e=this.Na.tj(this.yc);this.di=this.Na.Di(this.yc);-1!=e&&(this.vh=this.Na.gk(e),this.$f[++this.Ud]=6);return!0}e=this.Na.tj(this.yc);this.di=this.Na.sj(this.yc);-1!=e&&(this.vh=this.Na.gk(e),this.$f[++this.Ud]=7);e=this.Na.Di(this.yc);-1!=e&&this.ug.add(e);return!0};e.prototype.xQ=function(){if(0==
this.ug.size)return this.pg=this.Ud=-1,!1;this.yc=this.ug.get(this.ug.size-1);this.ug.resize(this.ug.size-1);var e=this.Na.tj(this.yc);-1!=e&&(this.vh=this.Na.gk(e),this.$f[++this.Ud]=7);-1!=this.Na.Di(this.yc)&&this.ug.add(this.Na.Di(this.yc));-1!=this.Na.sj(this.yc)&&this.ug.add(this.Na.sj(this.yc));return!0};e.prototype.sP=function(){this.pg=this.vh;if(-1!=this.pg&&f.Po(this.Bo())&&this.Na.uj(this.Bo())<=this.gi.va)return this.vh=this.GC(),!1;this.Ud--;return!0};e.prototype.BR=function(){this.pg=
this.vh;if(-1!=this.pg&&f.st(this.Bo())&&this.Na.uj(this.Bo())>=this.gi.qa)return this.vh=this.bO(),!1;this.Ud--;return!0};e.prototype.XJ=function(){this.pg=this.vh;if(-1!=this.pg&&f.Po(this.Bo()))return this.vh=this.GC(),!1;this.Ud--;return!0};e.prototype.GC=function(){return this.Na.Df?this.Na.If.bb(this.pg):this.Na.ki.bb(this.pg)};e.prototype.bO=function(){return this.Na.Df?this.Na.If.ge(this.pg):this.Na.ki.ge(this.pg)};e.prototype.Bo=function(){return this.Na.Df?this.Na.If.da(this.pg):this.Na.ki.getData(this.pg)};
return e}();a.IT=e;var f=function(){function f(e){this.Al=this.rh=this.If=this.ki=this.Hl=this.Ki=this.Yd=this.Li=null;this.Df=e;this.Vo=this.Dt=!1}f.prototype.Vp=function(){this.Rj(!0)};f.prototype.gq=function(e,f){if(!this.Dt)throw a.g.xa();this.Li.push(new a.Nd(e,f))};f.prototype.wo=function(){if(!this.Dt)throw a.g.ra("invalid call");this.Dt=!1;this.Vo=!0;this.Df||(this.BO(),this.Jt=this.Li.length)};f.prototype.lg=function(e){if(!this.Df||!this.Vo)throw a.g.N("invalid call");if(-1==this.Ze){var f=
this.Li.length;if(this.nx){var b=new a.ga(0);b.xb(2*f);this.$E(b);this.rh.xb(2*f);this.rh.resize(0);this.ZE(b);this.Hl.resize(f,-1);this.Hl.dh(-1,0,f);this.nx=!1}else this.Hl.dh(-1,0,f);this.Ze=this.Ms()}f=this.cD(e<<1,this.Ze);b=this.If.addElement((e<<1)+1,this.Hw(f));this.TF(f,b);this.Hl.set(e,f);this.Jt++};f.prototype.remove=function(e){if(!this.Df||!this.Vo)throw a.g.ra("invalid call");var f=this.Hl.get(e);if(-1==f)throw a.g.N("the interval does not exist in the interval tree");this.Hl.set(e,
-1);this.Jt--;var b=this.Hw(f),g;g=this.If.hO(b);this.If.kd(this.LN(f),b);this.If.kd(this.eO(f),b);e=this.If.size(b);0==e&&(this.If.fM(b),this.WF(g,-1));this.Ki.Jc(f);for(var b=this.JC(g),n=this.Di(g),c=this.sj(g),f=0;!(0<e||g==this.Ze||-1!=n&&-1!=c);)g==this.Di(b)?-1!=n?(this.Sj(b,n),this.Xi(n,b),this.Sj(g,-1)):-1!=c?(this.Sj(b,c),this.Xi(c,b),this.Uj(g,-1)):this.Sj(b,-1):-1!=n?(this.Uj(b,n),this.Xi(n,b),this.Sj(g,-1)):-1!=c?(this.Uj(b,c),this.Xi(c,b),this.Uj(g,-1)):this.Uj(b,-1),this.Xi(g,-1),f++,
g=b,b=this.tj(g),e=-1!=b?this.If.size(b):0,n=this.Di(g),c=this.sj(g),b=this.JC(g)};f.prototype.reset=function(){if(!this.Df||!this.Vo)throw a.g.N("invalid call");this.Rj(!1)};f.prototype.size=function(){return this.Jt};f.prototype.Re=function(){return e.Oa(this)};f.prototype.$E=function(e){for(var a=this.Li.length,f=0;f<2*a;f++)e.add(f);this.zS(e,2*a)};f.prototype.ZE=function(e){for(var a=NaN,f=0;f<e.size;f++){var b=e.get(f),g=this.uj(b);g!=a&&(this.rh.add(b),a=g)}};f.prototype.BO=function(){var e=
this.Li.length,f=new a.ga(0);f.xb(2*e);this.$E(f);this.rh.xb(2*e);this.rh.resize(0);this.ZE(f);this.Ki.de(e);this.ki.$l(2*e);var b=a.Ac.Dg(e);b.dh(-1,0,e);this.Ze=this.Ms();for(e=0;e<f.size;e++){var g=f.get(e),n=b.get(g>>1);-1!=n?this.TF(n,this.ki.addElement(this.Hw(n),g)):(n=this.cD(g,this.Ze),b.set(g>>1,n))}};f.prototype.cD=function(e,f){var b=f,g=f,n,c=-1,d=0,m=this.rh.size-1,x=0,k=e>>1,z=NaN,h=NaN;n=!0;for(var q=this.RN(k),k=this.ON(k);n;){d<m?(x=d+a.I.truncate((m-d)/2),-1==this.rw(b)&&this.CF(b,
this.rh.get(x),this.rh.get(x+1))):-1==this.rw(b)&&this.CF(b,this.rh.get(d),this.rh.get(d));var I=this.Co(b);if(k<I)-1!=f&&(f==b?(g=b,z=I,f=this.Di(b),-1!=f?h=this.Co(f):h=NaN):h>I&&(I<z?this.Sj(g,b):this.Uj(g,b),this.Uj(b,f),this.Df&&(this.Xi(b,g),this.Xi(f,b)),g=b,z=I,f=-1,h=NaN)),m=this.MN(b),-1==m&&(m=this.Ms(),this.YR(b,m)),b=m,m=x;else if(q>I)-1!=f&&(f==b?(g=b,z=I,f=this.sj(b),-1!=f?h=this.Co(f):h=NaN):h<I&&(I<z?this.Sj(g,b):this.Uj(g,b),this.Sj(b,f),this.Df&&(this.Xi(b,g),this.Xi(f,b)),g=b,
z=I,f=-1,h=NaN)),d=this.fO(b),-1==d&&(d=this.Ms(),this.iS(b,d)),b=d,d=x+1;else{n=this.tj(b);-1==n&&(n=this.TL(b),this.WF(b,n));var l=this.KJ(n,e),c=this.SL();this.lS(c,n);this.XR(c,l);b!=f&&(I<z?this.Sj(g,b):this.Uj(g,b),this.Df&&this.Xi(b,g),-1!=f&&(h<I?this.Sj(b,f):this.Uj(b,f),this.Df&&this.Xi(f,b)));n=!1}}return c};f.prototype.Ms=function(){return this.Yd.be()};f.prototype.TL=function(e){return this.Df?this.If.nq(e):this.ki.jh(e)};f.prototype.SL=function(){return this.Ki.be()};f.prototype.Rj=
function(e){e?(this.Dt=this.nx=!0,this.Vo=!1,null==this.rh?this.rh=a.Ac.Dg(0):this.rh.resize(0),null==this.Li?this.Li=[]:this.Li.length=0):this.nx=!1;this.Df?null==this.Hl?(this.Hl=a.Ac.Dg(0),this.If=new a.bj,this.If.Hn(new b(this))):this.If.clear():null==this.ki?this.ki=new a.$n:this.ki.clear();null==this.Yd?(this.Ki=new a.Fc(3),this.Yd=new a.Fc(this.Df?8:7)):(this.Ki.Nh(!1),this.Yd.Nh(!1));this.Ze=-1;this.Jt=0};f.prototype.CF=function(e,a,f){this.SR(e,a);this.TR(e,f)};f.prototype.Co=function(e){var a=
this.rw(e);if(-1==a)return NaN;a=this.uj(a);e=this.uj(this.wN(e));return a==e?a:.5*(a+e)};f.prototype.SR=function(e,a){this.Yd.L(e,0,a)};f.prototype.TR=function(e,a){this.Yd.L(e,1,a)};f.prototype.YR=function(e,a){this.Yd.L(e,3,a)};f.prototype.iS=function(e,a){this.Yd.L(e,4,a)};f.prototype.WF=function(e,a){this.Yd.L(e,2,a)};f.prototype.Sj=function(e,a){this.Yd.L(e,5,a)};f.prototype.Uj=function(e,a){this.Yd.L(e,6,a)};f.prototype.Xi=function(e,a){this.Yd.L(e,7,a)};f.prototype.lS=function(e,a){this.Ki.L(e,
0,a)};f.prototype.KJ=function(e,a){return this.Df?this.If.addElement(a,e):this.ki.addElement(e,a)};f.prototype.XR=function(e,a){this.Ki.L(e,1,a)};f.prototype.TF=function(e,a){this.Ki.L(e,2,a)};f.prototype.gk=function(e){return this.Df?this.If.gc(e):this.ki.gc(e)};f.prototype.uq=function(e){return this.Df?this.If.tc(e):this.ki.tc(e)};f.Po=function(e){return 0==(e&1)};f.st=function(e){return 1==(e&1)};f.prototype.rw=function(e){return this.Yd.O(e,0)};f.prototype.wN=function(e){return this.Yd.O(e,1)};
f.prototype.tj=function(e){return this.Yd.O(e,2)};f.prototype.MN=function(e){return this.Yd.O(e,3)};f.prototype.fO=function(e){return this.Yd.O(e,4)};f.prototype.Di=function(e){return this.Yd.O(e,5)};f.prototype.sj=function(e){return this.Yd.O(e,6)};f.prototype.JC=function(e){return this.Yd.O(e,7)};f.prototype.Hw=function(e){return this.Ki.O(e,0)};f.prototype.LN=function(e){return this.Ki.O(e,1)};f.prototype.eO=function(e){return this.Ki.O(e,2)};f.prototype.RN=function(e){return this.Li[e].qa};f.prototype.ON=
function(e){return this.Li[e].va};f.prototype.zS=function(e,f){null==this.Al&&(this.Al=new a.Rr);var b=new c(this);this.Al.sort(e,0,f,b)};f.prototype.yS=function(e,a,b){var g=this;e.xd(a,b,function(e,a){var b=g.uj(e),n=g.uj(a);return b<n||b==n&&f.Po(e)&&f.st(a)?-1:1})};f.prototype.uj=function(e){var a=this.Li[e>>1];return f.Po(e)?a.qa:a.va};return f}();a.bq=f})(E||(E={}));(function(a){var b=function(b){function g(e,f,g,c){b.call(this);void 0===e?this.description=a.Od.Tf():void 0===g?this.description=
e:(this.description=a.Od.Tf(),this.Ny(e,f),this.Ok(g,c))}m(g,b);g.prototype.D=function(){return 322};g.prototype.$b=function(){var e=this.na-this.la,a=this.ja-this.ha;return Math.sqrt(e*e+a*a)};g.prototype.mg=function(e){var a=this.na-this.la,b=this.ja-this.ha;return Math.sqrt(a*a+b*b)<=e};g.prototype.mD=function(){return!1};g.prototype.Pf=function(){var e=new a.b;e.pc(this.oc(),this.Mb());return e};g.prototype.Fp=function(e){e.Ja();e.Qf(this.description);var f=new a.i;this.o(f);e.Cu(f);for(var f=
1,b=this.description.Aa;f<b;f++)for(var g=this.description.Hd(f),c=a.pa.Wa(g);f<c;f++){var d=this.Ah(g,0);e.setInterval(g,0,d)}};g.prototype.o=function(e){e.K(this.na,this.ja,this.la,this.ha);e.normalize()};g.prototype.Cn=function(e){e.Ja();e.Db(this.na,this.ja,this.yd(0,1,0));e.Db(this.la,this.ha,this.yd(1,1,0))};g.prototype.Oe=function(e){if(e instanceof a.Bg){this.qc();var f=new a.b;f.x=this.na;f.y=this.ja;e.Zi(f,f);this.na=f.x;this.ja=f.y;f.x=this.la;f.y=this.ha;e.Zi(f,f);this.la=f.x;this.ha=
f.y}else this.qc(),f=new a.ee,f.x=this.na,f.y=this.ja,f.z=this.yd(0,1,0),f=e.Qn(f),this.na=f.x,this.ja=f.y,this.om(0,1,0,f.z),f.x=this.la,f.y=this.ha,f.z=this.yd(1,1,0),f=e.Qn(f),this.la=f.x,this.ha=f.y,this.om(1,1,0,f.z)};g.prototype.Pa=function(){return new g(this.description)};g.prototype.kv=function(e,a){return(this.la-e-(this.na-e))*(this.ha-a+(this.ja-a))*.5};g.prototype.Ru=function(e){return e*this.$b()};g.prototype.AD=function(e){return e/this.$b()};g.prototype.sC=function(e){return a.vi.ut(this.na,
this.la,e)};g.prototype.vN=function(e){return a.vi.ut(this.ja,this.ha,e)};g.prototype.xm=function(e,f){var b=new a.Ag;this.Bi(e,f,b);return b.get()};g.prototype.Bi=function(e,f,b){if(null==b)throw a.g.N();b.mq();b=b.get();b.Qf(this.description);var g=new a.b;this.Kb(e,g);b.Ny(g.x,g.y);this.Kb(f,g);b.Ok(g.x,g.y);for(var g=1,n=this.description.Aa;g<n;g++)for(var c=this.description.Fd(g),d=a.pa.Wa(c),m=0;m<d;m++){var k=this.ld(e,c,m);b.My(c,m,k);k=this.ld(f,c,m);b.Cy(c,m,k)}};g.prototype.ld=function(e,
f,b){if(0==f)return 0==b?this.Kb(e).x:this.Kb(e).y;switch(a.pa.JN(f)){case 0:return.5>e?this.gt(f,b):this.Ws(f,b);case 1:var g=this.gt(f,b);f=this.Ws(f,b);return a.vi.ut(g,f,e);case 2:throw a.g.ra("not implemented");}throw a.g.wa();};g.prototype.Gd=function(e,a){var f=this.la-this.na,b=this.ha-this.ja,g=f*f+b*b;if(0==g)return.5;f=((e.x-this.na)*f+(e.y-this.ja)*b)/g;a||(0>f?f=0:1<f&&(f=1));return f};g.prototype.nt=function(e,a,b,g){if(e){e=this.ha-this.ja;if(0==e)return a==this.ha?-1:0;a=(a-this.ja)/
e;if(0>a||1<a)return 0;null!=b&&(b[0]=this.sC(a))}else{e=this.la-this.na;if(0==e)return a==this.la?-1:0;a=(a-this.na)/e;if(0>a||1<a)return 0;null!=b&&(b[0]=this.vN(a))}null!=g&&(g[0]=a);return 1};g.prototype.xe=function(e,a){var f=this.ha-this.ja;if(0==f)return e==this.ha?a:NaN;f=(e-this.ja)/f;e=this.sC(f);1==f&&(e=this.la);return e};g.prototype.qs=function(e,a,b){return 0<=this.ho(e.x,e.y,a,b)};g.prototype.Kh=function(e,a,b){return 0<=this.ho(e,a,b,!0)};g.prototype.Eq=function(e,a){return this.qs(e,
a,!1)};g.prototype.KE=function(){if(this.ha<this.ja||this.ha==this.ja&&this.la<this.na){var e=this.na;this.na=this.la;this.la=e;e=this.ja;this.ja=this.ha;this.ha=e;for(var e=0,a=this.description.up-2;e<a;e++){var b=this.fa[e];this.fa[e]=this.fa[e+a];this.fa[e+a]=b}}};g.prototype.rs=function(e,f){e=a.b.Oa(e,f);e.sub(this.Mb());f=new a.b;f.pc(this.oc(),this.Mb());var b=f.Ai(e);e=8.881784197001252E-16*(Math.abs(f.x*e.y)+Math.abs(f.y*e.x));return b>e?-1:b<-e?1:0};g.prototype.ho=function(e,f,b,g){var n=
this.na,c=this.ja,d=e-n,m=f-c,d=Math.sqrt(d*d+m*m);if(d<=Math.max(b,6.661338147750939E-16*d))return g&&0==d?NaN:0;d=e-this.la;m=f-this.ha;d=Math.sqrt(d*d+m*m);if(d<=Math.max(b,6.661338147750939E-16*d))return g&&0==d?NaN:1;d=this.la-this.na;m=this.ha-this.ja;g=Math.sqrt(d*d+m*m);if(0<g){var x=1/g,d=d*x,m=m*x,k=e-n,z=f-c,h=k*d+z*m,q=1.7763568394002505E-15*(Math.abs(k*d)+Math.abs(z*m)),l=d,d=-m,m=l,q=Math.max(b,q);if(h<-q||h>g+q)return NaN;if(Math.abs(k*d+z*m)<=Math.max(b,1.7763568394002505E-15*(Math.abs(k*
d)+Math.abs(z*m)))&&(d=a.I.Kr(h*x,0,1),.5>=d?(m=this.na+(this.la-this.na)*d,g=this.ja+(this.ha-this.ja)*d):(m=this.la-(this.la-this.na)*(1-d),g=this.ha-(this.ha-this.ja)*(1-d)),a.b.Yv(m,g,e,f)<=b)){if(.5>d){if(a.b.Yv(m,g,n,c)<=b)return 0}else if(a.b.Yv(m,g,this.la,this.ha)<=b)return 1;return d}}return NaN};g.prototype.lc=function(e){return null==e?!1:e==this?!0:e.constructor!==this.constructor?!1:this.sJ(e)};g.prototype.AA=function(e,f,b){var g=b?this.na:this.la;b=b?this.ja:this.ha;var n=new a.b;
n.x=e.la-g;n.y=e.ha-b;return f.ml(n)>6.661338147750939E-16*f.uA(n)?(n.x=e.na-g,n.y=e.ja-b,f.ml(n)<=6.661338147750939E-16*f.uA(n)):!0};g.prototype.zA=function(e){var f=new a.b;f.x=this.la-this.na;f.y=this.ha-this.ja;if(!this.AA(e,f,!1))return!1;f.Bp();return this.AA(e,f,!0)?!0:!1};g.ye=function(e,a){var f=e.rs(a.na,a.ja),b=e.rs(a.la,a.ha);if(0>f&&0>b||0<f&&0<b)return!1;f=a.rs(e.na,e.ja);b=a.rs(e.la,e.ha);if(0>f&&0>b||0<f&&0<b)return!1;f=e.$b();b=a.$b();return f>b?e.zA(a):a.zA(e)};g.Id=function(e,f,
b){var g=a.b.Oa(NaN,NaN),n=e.la-e.na,c=e.ha-e.ja,d=f.la-f.na,m=f.ha-f.ja,k=d*c-n*m;if(0==k)return g;var z=8.881784197001252E-16*(Math.abs(d*c)+Math.abs(n*m)),h=f.na-e.na,q=f.ja-e.ja,l=d*q-h*m,v=l/k,t=Math.abs(k),d=(8.881784197001252E-16*(Math.abs(d*q)+Math.abs(h*m))*t+z*Math.abs(l))/(k*k)+2.220446049250313E-16*Math.abs(v);if(v<-d||v>1+d)return g;m=n*q-h*c;d=m/k;n=(8.881784197001252E-16*(Math.abs(n*q)+Math.abs(h*c))*t+z*Math.abs(m))/(k*k)+2.220446049250313E-16*Math.abs(d);if(d<-n||d>1+n)return g;v=
a.I.Kr(v,0,1);n=a.I.Kr(d,0,1);c=e.Kb(v);k=f.Kb(n);z=new a.b;z.pc(c,k);if(z.length()>b&&(z.add(c,k),z.scale(.5),v=e.Gd(z,!1),n=f.Gd(z,!1),e=e.Kb(v),f=f.Kb(n),e.sub(f),e.length()>b))return g;g.ma(v,n);return g};g.xJ=function(e,a,b,c){var f=0;if(e.na==a.na&&e.ja==a.ja||e.na==a.la&&e.ja==a.ha)if(f++,!c)return 1;if(e.la==a.na&&e.ha==a.ja||e.la==a.la&&e.ha==a.ha){f++;if(2==f)return 2;if(!c)return 1}return a.Kh(e.na,e.ja,b)||a.Kh(e.la,e.ha,b)||e.Kh(a.na,a.ja,b)||e.Kh(a.la,a.ha,b)?1:c&&0!=f?0:0==g.ye(e,a)?
0:1};g.ov=function(e,f,b,c,d,m){var n=0,x=e.ho(f.na,f.ja,m,!1),k=e.ho(f.la,f.ha,m,!1),z=f.ho(e.na,e.ja,m,!1),h=f.ho(e.la,e.ha,m,!1);isNaN(x)||(null!=c&&(c[n]=x),null!=d&&(d[n]=0),null!=b&&(b[n]=a.b.Oa(f.na,f.ja)),n++);isNaN(k)||(null!=c&&(c[n]=k),null!=d&&(d[n]=1),null!=b&&(b[n]=a.b.Oa(f.la,f.ha)),n++);2==n||isNaN(z)||0==x&&0==z||0==k&&1==z||(null!=c&&(c[n]=0),null!=d&&(d[n]=z),null!=b&&(b[n]=a.b.Oa(e.na,e.ja)),n++);2==n||isNaN(h)||1==x&&0==h||1==k&&1==h||(null!=c&&(c[n]=1),null!=d&&(d[n]=h),null!=
b&&(b[n]=a.b.Oa(f.la,f.ha)),n++);if(0<n)return 2==n&&null!=c&&c[0]>c[1]&&(e=c[0],c[0]=c[1],c[1]=e,null!=d&&(c=d[0],d[0]=d[1],d[1]=c),null!=b&&(d=a.b.Oa(b[0].x,b[0].y),b[0]=b[1],b[1]=d)),n;n=g.Id(e,f,m);if(isNaN(n.x))return 0;null!=b&&(b[0]=e.Kb(n.x));null!=c&&(c[0]=n.x);null!=d&&(d[0]=n.y);return 1};g.prototype.TC=function(){return 0};g.prototype.eo=function(){};g.prototype.toString=function(){return"Line: ["+this.na.toString()+", "+this.ja.toString()+", "+this.la.toString()+", "+this.ha.toString()+
"]"};return g}(a.fA);a.yb=b})(E||(E={}));(function(a){var b=function(){function a(){this.Gl=[];this.ua=-1}a.prototype.ya=function(){return this.ua};a.prototype.next=function(){if(null!=this.Gl&&0!=this.Gl.length){this.ua++;var a=this.Gl[0];1>=this.Gl.length?this.Gl=[]:this.Gl=this.Gl.slice(1);return a}return this.Gl=null};return a}();a.MT=b})(E||(E={}));(function(a){(function(a){a[a.enumFillRuleOddEven=0]="enumFillRuleOddEven";a[a.enumFillRuleWinding=1]="enumFillRuleWinding"})(a.qI||(a.qI={}));var b=
function(b){function g(e,f){b.call(this);this.Yf=!1;this.np=null;this.ap=this.bp=0;this.Uh=null;this.ng=!1;this.td=this.li=this.Fe=this.qb=this.jb=null;this.gp=this.Qa=this.cp=0;if(void 0===f)this.Yf=e,this.ng=!1,this.ta=this.ap=this.bp=this.cp=0,this.description=a.Od.Tf();else{if(null==f)throw a.g.N();this.Yf=e;this.ng=!1;this.ta=this.ap=this.bp=this.cp=0;this.description=f}this.Uh=null;this.Qa=0}m(g,b);g.prototype.Hm=function(){return 0<this.cp};g.prototype.nv=function(){this.qc();null==this.np?
this.np=new a.Va(this.description):this.np.Qf(this.description)};g.prototype.Uy=function(e,f){var b=new a.b;b.x=e;b.y=f;this.Nr(b)};g.prototype.Nr=function(e){this.nv();this.np.ic(e);this.ng=!0};g.prototype.df=function(e){if(e.s())throw a.g.N();this.Ik(e.description);this.nv();e.copyTo(this.np);this.ng=!0};g.prototype.iv=function(){var e=1;this.ng&&(this.nv(),null==this.jb?(this.jb=a.Ac.Dg(2),this.jb.write(0,0),this.qb=a.Ac.to(2,0)):(this.jb.resize(this.jb.size+1,0),this.qb.resize(this.qb.size+1,
0)),this.Yf&&this.qb.write(this.qb.size-2,1),e++);var f=this.ta;this.jb.write(this.jb.size-1,this.ta+e);this.jo(f+e);this.qb.write(this.jb.size-1,0);this.ng&&(this.Iu(f,this.np),this.ng=!1)};g.prototype.wj=function(e,a){this.iv();this.ic(this.ta-1,e,a)};g.prototype.Lm=function(e){this.iv();this.ic(this.ta-1,e)};g.prototype.lineTo=function(e){this.iv();this.Iu(this.ta-1,e)};g.prototype.ro=function(){var e;this.Su();void 0===e&&(this.ng=!1,e=this.ea()-1);var a=this.qb.read(e);this.qb.write(e,a|1);null!=
this.Fe&&(e=this.Dc(e)-1,this.Fe.write(e,1),this.li.write(e,-1))};g.$i=function(e){return g.Id[e]};g.prototype.vc=function(e){return 0!=(this.qb.read(e)&1)};g.prototype.Oo=function(e){if(this.vc(e))return!0;var a=this.Ea(e);e=this.Dc(e)-1;if(a>e)return!1;a=this.Fa(a);e=this.Fa(e);return a.ub(e)};g.prototype.yq=function(e){return 0!=(this.qb.read(e)&2)};g.prototype.Bc=function(e,f){this.Ik(e.description);if(322==e.D()){var b=new a.Va;if(f||this.s())e.En(b),this.df(b);e.Bn(b);this.lineTo(b)}else throw a.g.wa();
};g.prototype.ws=function(e){var a=0==this.ta;this.Uy(e.v,e.C);this.wj(e.v,e.G);this.wj(e.B,e.G);this.wj(e.B,e.C);this.ro();this.ng=!1;a&&this.yf(256,!1)};g.prototype.Wc=function(e,f){if(!e.s()){for(var b=0==this.ta,g=new a.Va(this.description),c=0;4>c;c++)e.uf(f?4-c-1:c,g),0==c?this.df(g):this.lineTo(g);this.ro();this.ng=!1;b&&!f&&this.yf(256,!1)}};g.prototype.add=function(e,a){for(var f=0;f<e.ea();f++)this.Zj(e,f,!a)};g.prototype.Zj=function(e,a,b){this.Cf(-1,e,a,b)};g.prototype.lo=function(){this.Sw()};
g.prototype.ys=function(e,f,b,g,c){c||0!=this.ea()||(c=!0);0>f&&(f=e.ea()-1);if(f>=e.ea()||0>b||0>g||g>e.ct(f))throw a.g.ra("index out of bounds");if(0!=g){var n=e.vc(f)&&b+g==e.ct(f);if(!n||1!=g){this.ng=!1;this.Ik(e.description);b=e.Ea(f)+b+1;c&&(g++,b--);n&&g--;n=this.ta;this.jo(this.ta+g);this.kc();if(c){if(0==g)return;this.jb.add(this.ta);c=e.qb.read(f);c&=-5;this.Yf&&(c|=1);this.qb.write(this.qb.size-1,c);this.qb.add(0)}else this.jb.write(this.qb.size-1,this.ta);c=0;for(var d=this.description.Aa;c<
d;c++){var m=this.description.Hd(c),x=a.pa.Wa(m),k=e.description.zf(m);0>k||null==e.Ba[k]?this.Ba[c].ul(x*n,a.pa.ue(m),g*x,x*n):this.Ba[c].nk(x*n,e.Ba[k],x*b,g*x,!0,x,x*n)}if(this.Hm())throw a.g.wa();if(e.yq(f))throw a.g.wa();this.ce(1993)}}};g.prototype.Cr=function(e){this.kc();var f=this.ea();0>e&&(e=f-1);if(e>=f)throw a.g.N();for(var b=this.Ea(e),g=this.Ha(e),c=0,d=this.description.Aa;c<d;c++)if(null!=this.Ba[c]){var m=a.pa.Wa(this.description.Fd(c));this.Ba[c].oj(m*b,m*g,m*this.ta)}for(b=e+1;b<=
f;b++)c=this.jb.read(b),this.jb.write(b-1,c-g);if(null==this.qb)for(b=e+1;b<=f;b++)e=this.qb.read(b),this.qb.write(b-1,e);this.jb.resize(f);this.qb.resize(f);this.ta-=g;this.rg-=g;this.ce(1993)};g.prototype.Cf=function(e,f,b,g){if(f==this)throw a.g.N();if(b>=f.ea())throw a.g.N();var n=this.ea();if(e>n)throw a.g.N();0>e&&(e=n);0>b&&(b=f.ea()-1);this.ng=!1;this.Ik(f.description);f.kc();var c=f.Ea(b),d=f.Ha(b),m=this.ta,x=f.vc(b)&&!g?1:0;this.jo(this.ta+d);this.kc();for(var k=e<n?this.Ea(e):m,z=0,h=
this.description.Aa;z<h;z++){var q=this.description.Fd(z),l=f.description.zf(q),v=a.pa.Wa(q);0<=l&&null!=f.Ba[l]?(0!=x&&this.Ba[z].nk(k*v,f.Ba[l],v*c,v,!0,v,v*m),this.Ba[z].nk((k+x)*v,f.Ba[l],v*(c+x),v*(d-x),g,v,v*(m+x))):this.Ba[z].ul(k*v,a.pa.ue(q),v*d,v*m)}this.jb.add(m+d);for(g=n;g>=e+1;g--)c=this.jb.read(g-1),this.jb.write(g,c+d);f.yq(b);this.qb.add(0);for(g=n-1;g>=e+1;g--)n=this.qb.read(g),n&=-5,this.qb.write(g+1,n);n=f.VN().read(b);n&=-5;this.Yf&&(n|=1);this.qb.write(e,n)};g.prototype.Sw=function(){var e=
-1,f=this.ea();if(e>f)throw a.g.N();0>e&&(e=f);this.ng=!1;this.kc();this.jb.add(this.ta);for(var b=f;b>=e+1;b--){var g=this.jb.read(b-1);this.jb.write(b,g+0)}this.qb.add(0);for(b=f-1;b>=e+1;b--)f=this.qb.read(b),f&=-5,this.qb.write(b+1,f);this.Yf&&this.qb.write(e,1)};g.prototype.dD=function(e,f,b){var g=-1;0>e&&(e=this.ea());if(e>this.ea()||g>this.Ha(e)||b>f.length)throw a.g.ra("index out of bounds");if(0!=b){e==this.ea()&&(this.jb.add(this.ta),this.Yf?this.qb.add(1):this.qb.add(0));0>g&&(g=this.Ha(e));
this.kc();var n=this.ta;this.jo(this.ta+b);this.kc();for(var c=0,d=this.description.Aa;c<d;c++){var m=this.description.Fd(c),k=a.pa.Wa(m);this.Ba[c].km(k*(this.Ea(e)+g+b),(n-this.Ea(e)-g)*k,this.Ba[c],k*(this.Ea(e)+g),!0,k);0==c?this.Ba[c].$p(k*(this.Ea(e)+g),b,f,0,!0):this.Ba[c].dh(a.pa.ue(m),(this.Ea(e)+g)*k,b*k)}this.Hm()&&(this.Fe.km(this.Ea(e)+g+b,n-this.Ea(e)-g,this.Fe,this.Ea(e)+g,!0,1),this.li.km(this.Ea(e)+g+b,n-this.Ea(e)-g,this.li,this.Ea(e)+g,!0,1),this.Fe.dh(1,this.Ea(e)+g,b),this.li.dh(-1,
this.Ea(e)+g,b));e+=1;for(f=this.ea();e<=f;e++)this.jb.write(e,this.jb.read(e)+b)}};g.prototype.kf=function(e,f,b){var g=this.ea();0>e&&(e=this.ea());if(e>=g||f>this.Ha(e))throw a.g.ra("index out of bounds");e==this.ea()&&(this.jb.add(this.ta),this.Yf?this.qb.add(1):this.qb.add(0));0>f&&(f=this.Ha(e));var n=this.ta;this.jo(this.ta+1);this.kc();var c=this.Ea(e);this.Ba[0].lg(2*(c+f),b,2*n);b=1;for(var d=this.description.Aa;b<d;b++){var m=this.description.Fd(b),k=a.pa.Wa(m);this.Ba[b].ul(k*(c+f),a.pa.ue(m),
k,k*n)}for(e+=1;e<=g;e++)this.jb.write(e,this.jb.read(e)+1)};g.prototype.eF=function(e,f){var b=this.ea();0>e&&(e=b-1);if(e>=b||f>=this.Ha(e))throw a.g.ra("index out of bounds");this.kc();var g=this.Ea(e);0>f&&(f=this.Ha(e)-1);g+=f;f=0;for(var c=this.description.Aa;f<c;f++)if(null!=this.Ba[f]){var d=a.pa.Wa(this.description.Fd(f));this.Ba[f].oj(d*g,d,d*this.ta)}for(;b>=e+1;b--)g=this.jb.read(b),this.jb.write(b,g-1);this.ta--;this.rg--;this.ce(1993)};g.prototype.Rf=function(){return a.Hh.il(this,null)};
g.prototype.Ja=function(){this.cp=0;this.ng=!1;this.td=this.Fe=this.li=this.qb=this.jb=null;this.EA()};g.prototype.Oe=function(e){e instanceof a.Bg?this.ZA(e,-1):this.$J(e)};g.prototype.ZA=function(e,f){if(!this.s()&&!e.XO()){this.kc();var b=this.Ba[0],g=new a.b,c=new a.b,d,m,k;for(0>f?(d=this.Hm(),m=0,k=this.ta):(d=this.yq(f),m=this.Ea(f),k=this.Dc(f));m<k;m++){g.x=b.read(2*m);g.y=b.read(2*m+1);if(d&&(f=this.li.read(m),0<=f))switch(this.Fe.read(m)&7){case 2:c.x=this.td.read(f);c.y=this.td.read(f+
1);e.Zi(c,c);this.td.write(f,c.x);this.td.write(f+1,c.y);c.x=this.td.read(f+3);c.y=this.td.read(f+4);e.Zi(c,c);this.td.write(f+3,c.x);this.td.write(f+4,c.y);break;case 4:throw a.g.wa();}e.Zi(g,g);b.write(2*m,g.x);b.write(2*m+1,g.y)}this.ce(1993)}};g.prototype.$J=function(e){if(!this.s()){this.Ne(1);this.kc();for(var f=this.Ba[0],b=this.Ba[1],g=new a.ee,c=new a.ee,d=this.Hm(),m=0;m<this.ta;m++){g.x=f.read(2*m);g.y=f.read(2*m+1);g.z=b.read(m);if(d){var k=this.li.read(m);if(0<=k)switch(this.Fe.read(m)&
7){case 2:c.x=this.td.read(k);c.y=this.td.read(k+1);c.z=this.td.read(k+2);c=e.Qn(c);this.td.write(k,c.x);this.td.write(k+1,c.y);this.td.write(k+1,c.z);c.x=this.td.read(k+3);c.y=this.td.read(k+4);c.z=this.td.read(k+5);c=e.Qn(c);this.td.write(k+3,c.x);this.td.write(k+4,c.y);this.td.write(k+5,c.z);break;case 4:throw a.g.wa();}}g=e.Qn(g);f.write(2*m,g.x);f.write(2*m+1,g.y);b.write(m,g.z)}this.ce(1993)}};g.prototype.xv=function(){null==this.jb&&(this.jb=a.Ac.Dg(1,0),this.qb=a.Ac.to(1,0));null!=this.Fe&&
(this.Fe.resize(this.rg,1),this.li.resize(this.rg,-1))};g.prototype.eo=function(e){e.ng=!1;e.cp=this.cp;e.gp=this.gp;null!=this.jb?e.jb=a.ga.lj(this.jb):e.jb=null;null!=this.qb?e.qb=a.Wk.lj(this.qb):e.qb=null;null!=this.li?e.li=a.ga.lj(this.li):e.li=null;null!=this.Fe?e.Fe=a.Wk.lj(this.Fe):e.Fe=null;null!=this.td?e.td=a.qd.lj(this.td):e.td=null;e.bp=this.bp;e.ap=this.ap;this.gj(1024)?e.Uh=null:e.Uh=this.Uh};g.prototype.$b=function(){if(!this.gj(512))return this.bp;for(var e=this.Ca(),f=new a.av(0);e.kb();)for(;e.La();)f.add(e.ia().$b());
this.bp=f.rl();this.yf(512,!1);return f.rl()};g.prototype.lc=function(e){if(e==this)return!0;if(!(e instanceof g&&b.prototype.lc.call(this,e)))return!1;var a=this.ea();return a!=e.ea()||null!=this.jb&&!this.jb.lc(e.jb,0,a+1)||this.gp!=e.gp||null!=this.qb&&!this.qb.lc(e.qb,0,a)?!1:b.prototype.lc.call(this,e)};g.prototype.Ca=function(){return new a.GI(this)};g.prototype.wv=function(e){b.prototype.wv.call(this,e);if(this.Hm())for(e=this.Ca();e.kb();)for(;e.La();)break};g.prototype.tm=function(e,a){b.prototype.tm.call(this,
e,a);if(this.Hm())for(e=this.Ca();e.kb();)for(;e.La();)break};g.prototype.qv=function(){null==this.jb||0==this.jb.size?this.ta=0:this.ta=this.jb.read(this.jb.size-1)};g.prototype.Mh=function(){if(!this.Yf)return 0;this.ts();return this.ap};g.prototype.qt=function(e){if(!this.Yf)return!1;if(!this.gj(8))return 0!=(this.qb.read(e)&4);this.ts();return 0<this.Uh.read(e)};g.prototype.oo=function(e){if(!this.Yf)return 0;this.ts();return this.Uh.read(e)};g.prototype.ts=function(){if(this.gj(1024)){var e=
this.ea();null==this.Uh?this.Uh=new a.qd(e):this.Uh.size!=e&&this.Uh.resize(e);for(var e=new a.av(0),f=new a.av(0),b=new a.b,g=0,c=this.Ca();c.kb();){f.reset();for(this.w(this.Ea(c.Qa),b);c.La();)f.add(c.ia().kv(b.x,b.y));e.add(f.rl());var d=g++;this.Uh.write(d,f.rl())}this.ap=e.rl();this.yf(1024,!1)}};g.prototype.hl=function(){if(this.gj(8)){this.ts();var e=this.ea();if(null==this.qb||this.qb.size<e)this.qb=a.Ac.to(e+1);for(var f=1,b=0;b<e;b++){var g=this.Uh.read(b);0==b&&(f=0<g?1:-1);0<g*f?this.qb.xy(b,
4):this.qb.BB(b,4)}this.yf(8,!1)}};g.prototype.Ew=function(e){var f=this.Qa,b=this.ea();if(0<=f&&f<b){if(e<this.Dc(f)){if(e>=this.Ea(f))return f;f--}else f++;if(0<=f&&f<b&&e>=this.Ea(f)&&e<this.Dc(f))return this.Qa=f}if(5>b){for(f=0;f<b;f++)if(e<this.Dc(f))return this.Qa=f;throw a.g.ra("corrupted geometry");}f=0;for(--b;b>f;){var g=f+(b-f>>1),c=this.Ea(g);if(e<c)b=g-1;else if(f=this.Dc(g),e>=f)f=g+1;else return this.Qa=g}return this.Qa=f};g.prototype.HN=function(e){var f=this.mc(0);this.WN();var b=
this.Dc(e),g=this.Ea(e);e=-1;var c=new a.b,d=new a.b;c.y=-Infinity;c.x=-Infinity;for(g+=0;g<b;g++)f.ec(2*g,d),-1==c.compare(d)&&(e=g,c.J(d));return e};g.prototype.Iw=function(){var e=this.F();if(!this.Yf)for(var e=e-this.ea(),a=0,b=this.ea();a<b;a++)this.vc(a)&&e++;return e};g.prototype.ct=function(e){var a=this.Ha(e);this.vc(e)||a--;return a};g.prototype.Pa=function(){return new g(this.Yf,this.description)};g.prototype.fb=function(){return this.Yf?2:1};g.prototype.D=function(){return this.Yf?1736:
1607};g.prototype.WN=function(){this.Su()};g.prototype.OF=function(e){this.jb=e;this.ce(16777215)};g.prototype.VN=function(){this.Su();return this.qb};g.prototype.NF=function(e){this.qb=e;this.ce(16777215)};g.prototype.ea=function(){return null!=this.jb?this.jb.size-1:0};g.prototype.Dc=function(e){return this.jb.read(e+1)};g.prototype.Ha=function(e){return this.jb.read(e+1)-this.jb.read(e)};g.prototype.Ea=function(e){return this.jb.read(e)};g.prototype.jv=function(e,f){null==this.pb&&(this.pb=new a.Wj);
f=a.dA.jR(f);var b=this.pb.hi;if(null!=b)if(b.Sx<e||f>b.cO())this.pb.uv(null);else return!0;b=a.dA.create(this,e,f);this.pb.uv(b);return!0};g.prototype.hc=function(){var e=b.prototype.hc.call(this);if(!this.sc()){var a=this.ea();null!=this.jb&&this.jb.jj(e,0,a+1);null!=this.qb&&this.qb.jj(e,0,a)}return e};g.prototype.NC=function(e){return null!=this.Fe?this.Fe.read(e):1};g.prototype.cc=function(e,f,b){var g=this.Ew(e);if(e==this.Dc(g)-1&&!this.vc(g))throw a.g.ra("index out of bounds");this.kc();var n=
this.Fe,c=1;null!=n&&(c=n.read(e)&7);switch(c){case 1:f.mq();break;case 2:throw a.g.wa();case 4:throw a.g.wa();default:throw a.g.wa();}f=f.get();b?f.Qf(a.Od.Tf()):f.Qf(this.description);g=e==this.Dc(g)-1&&this.vc(g)?this.Ea(g):e+1;n=new a.b;this.w(e,n);f.ed(n);this.w(g,n);f.vd(n);if(!b)for(b=1,n=this.description.Aa;b<n;b++)for(var c=this.description.Fd(b),d=a.pa.Wa(c),m=0;m<d;m++){var k=this.ld(c,e,m);f.My(c,m,k);k=this.ld(c,g,m);f.Cy(c,m,k)}};g.prototype.Ti=function(e,f){if(e>=this.ea())throw a.g.N();
if(this.s())f.Ja();else{if(this.yq(e))throw a.g.ra("not implemented");var b=this.mc(0),g=new a.b,c=new a.i;c.Ja();var d=this.Ea(e);for(e=this.Dc(e);d<e;d++)b.ec(2*d,g),c.Db(g);f.K(c)}};g.prototype.hR=function(e,f){if(e>=this.ea())throw a.g.N();if(this.s())f.Ja();else{if(this.yq(e))throw a.g.ra("not implemented");var b=this.mc(0),g=new a.b,c=new a.i;c.Ja();var d=this.Ea(e);for(e=this.Dc(e);d<e;d++)b.ec(2*d,g),c.Db(g);f.K(c)}};g.prototype.dj=function(e){null==this.pb&&(this.pb=new a.Wj);if(0==e||16>
this.F())return!1;e=a.Ia.nB(this);this.pb.GA(e);return!0};g.prototype.jJ=function(){null==this.pb&&(this.pb=new a.Wj);if(null!=this.pb.nn)return!0;this.pb.HA(null);var e=a.Ia.CK(this);this.pb.HA(e);return!0};g.prototype.Pp=function(e){this.gp=e};g.prototype.Cm=function(){return this.gp};g.Id=[0,0,6,0,8,0];return g}(a.Wr);a.al=b})(E||(E={}));(function(a){var b=function(b){function g(e){b.call(this);if(void 0!==e){if(null==e)throw a.g.N();this.description=e}else this.description=a.Od.Tf();this.ta=0}
m(g,b);g.prototype.Pa=function(){return new g(this.description)};g.prototype.add=function(e){this.resize(this.ta+1);this.bh(this.ta-1,e)};g.prototype.zs=function(e,f){this.resize(this.ta+1);var b=new a.b;b.ma(e,f);this.ic(this.ta-1,b)};g.prototype.Pd=function(e,f,b){b=0>b?e.F():b;if(0>f||f>e.F()||b<f)throw a.g.N();if(f!=b){this.Ik(e.description);b-=f;var g=this.ta;this.resize(this.ta+b);this.kc();for(var n=0,c=e.description.Aa;n<c;n++){var d=e.description.Fd(n),m=a.pa.Wa(d),k=this.mc(d),d=e.mc(d);
k.nk(g*m,d,f*m,b*m,!0,1,g*m)}}};g.prototype.eF=function(e){if(0>e||e>=this.F())throw a.g.ra("index out of bounds");this.kc();for(var f=0,b=this.description.Aa;f<b;f++)if(null!=this.Ba[f]){var g=a.pa.Wa(this.description.Fd(f));this.Ba[f].oj(g*e,g,g*this.ta)}this.ta--;this.rg--;this.ce(1993)};g.prototype.resize=function(e){this.jo(e)};g.prototype.eo=function(){};g.prototype.Ja=function(){b.prototype.EA.call(this)};g.prototype.Oe=function(e){if(e instanceof a.Bg){if(!this.s()){this.kc();for(var f=this.Ba[0],
b=new a.b,g=0;g<this.ta;g++)b.x=f.read(2*g),b.y=f.read(2*g+1),e.Zi(b,b),f.write(2*g,b.x),f.write(2*g+1,b.y);this.ce(1993)}}else if(!this.s()){this.kc();this.Ne(1);this.kc();for(var f=this.Ba[0],b=this.Ba[1],c=new a.ee,g=0;g<this.ta;g++){c.x=f.read(2*g);c.y=f.read(2*g+1);c.z=b.read(g);var d=e.Qn(c);f.write(2*g,d.x);f.write(2*g+1,d.y);b.write(g,d.z)}this.ce(1993)}};g.prototype.fb=function(){return 0};g.prototype.D=function(){return 550};g.prototype.Mh=function(){return 0};g.prototype.$b=function(){return 0};
g.prototype.lc=function(e){return e==this?!0:e instanceof g?b.prototype.lc.call(this,e):!1};g.prototype.fR=function(e,f){var b=this.ta,b=Math.min(b,f+1E3);if(0>f||f>=this.ta||b<f||1E3!=e.length)throw a.g.N();var g=this.mc(0),c=b-f,d=[];g.Hp(2*f,2*c,d,0,!0);for(g=0;g<c;g++)e[g]=a.b.Oa(d[2*g],d[2*g+1]);return b};g.prototype.qv=function(){};g.prototype.xv=function(){};g.prototype.jv=function(){return!1};g.prototype.dj=function(){return!1};g.prototype.Rf=function(){return null};return g}(a.Wr);a.pe=b})(E||
(E={}));(function(a){(function(a){a[a.NotDetermined=0]="NotDetermined";a[a.Structure=1]="Structure";a[a.DegenerateSegments=2]="DegenerateSegments";a[a.Clustering=3]="Clustering";a[a.Cracking=4]="Cracking";a[a.CrossOver=5]="CrossOver";a[a.RingOrientation=6]="RingOrientation";a[a.RingOrder=7]="RingOrder";a[a.OGCPolylineSelfTangency=8]="OGCPolylineSelfTangency";a[a.OGCPolygonSelfTangency=9]="OGCPolygonSelfTangency";a[a.OGCDisconnectedInterior=10]="OGCDisconnectedInterior"})(a.NH||(a.NH={}));var b=function(){function a(a,
e,f){void 0===a?(this.yh=0,this.Gk=this.Fk=-1):(this.yh=a,this.Fk=e,this.Gk=f)}a.prototype.aq=function(a){this.yh=a.yh;this.Fk=a.Fk;this.Gk=a.Gk};return a}();a.wd=b})(E||(E={}));(function(a){var b=function(){function b(){}b.WT=function(b){if(!1===b)throw a.g.PG();};b.bG=function(a){return isNaN(a)?NaN:0===a?a:0<a?1:-1};b.Lh=function(a,e){void 0===e&&(e=0);for(var f=[],b=0;b<a;b++)f[b]=e;return f};b.Ps=function(a,e){var f,b;void 0===f&&(f=0);for(void 0===b&&(b=a.length-1);f<=b;f++)a[f]=e};b.Kr=function(a,
e,f){return a<e?e:a>f?f:a};b.mU=function(){return 4};b.kg=function(a,e){var f=5381;void 0!==e?f=(e<<5)+e+(a&255):f=(f<<5)+f+(a&255);f=(f<<5)+f+(a>>8&255);f=(f<<5)+f+(a>>16&255);return(f<<5)+f+(a>>24&255)&2147483647};b.Rh=function(){throw Error("Not Implemented");};b.iU=function(){return-Infinity};b.kU=function(){return Infinity};b.bU=function(){return 2147483647};b.QT=function(){return 2.220446049250313E-16};b.ST=function(){return 1.7976931348623157E308};b.$x=function(a){return b.JH(a)+12345&2147483647};
b.FD=function(a){var e=32,f=a%b.gv|0,g=a/b.gv|0;if(0===(e&=63))return a;32>e?(a=f>>>e|g<<32-e,e=g>>e):(a=g>>e-32,e=0<=g?0:-1);return e*b.gv+(a>>>0)};b.JH=function(a){a|=0;return(1103495168*a|0)+(20077*a|0)|0};b.truncate=function(a){return 0>a?-1*Math.floor(Math.abs(a)):Math.floor(a)};b.aH=Math.pow(2,53)-1;b.UT=-b.aH;b.pF=65536;b.zU=16777216;b.gv=b.pF*b.pF;return b}();a.I=b})(E||(E={}));(function(a){(function(a){a[a.Project=0]="Project";a[a.Union=1]="Union";a[a.Difference=2]="Difference";a[a.Proximity2D=
3]="Proximity2D";a[a.Relate=4]="Relate";a[a.Equals=5]="Equals";a[a.Disjoint=6]="Disjoint";a[a.Intersects=7]="Intersects";a[a.Within=8]="Within";a[a.Contains=9]="Contains";a[a.Crosses=10]="Crosses";a[a.Touches=11]="Touches";a[a.Overlaps=12]="Overlaps";a[a.Buffer=13]="Buffer";a[a.Distance=14]="Distance";a[a.Intersection=15]="Intersection";a[a.Clip=16]="Clip";a[a.Cut=17]="Cut";a[a.DensifyByLength=18]="DensifyByLength";a[a.DensifyByAngle=19]="DensifyByAngle";a[a.LabelPoint=20]="LabelPoint";a[a.GeodesicBuffer=
21]="GeodesicBuffer";a[a.GeodeticDensifyByLength=22]="GeodeticDensifyByLength";a[a.ShapePreservingDensify=23]="ShapePreservingDensify";a[a.GeodeticLength=24]="GeodeticLength";a[a.GeodeticArea=25]="GeodeticArea";a[a.Simplify=26]="Simplify";a[a.SimplifyOGC=27]="SimplifyOGC";a[a.Offset=28]="Offset";a[a.Generalize=29]="Generalize";a[a.SymmetricDifference=30]="SymmetricDifference";a[a.ConvexHull=31]="ConvexHull";a[a.Boundary=32]="Boundary";a[a.SimpleRelation=33]="SimpleRelation"})(a.iI||(a.iI={}));var b=
function(){function b(){}b.prototype.D=function(){return null};b.NT=function(b){a.T.Th(b.D())&&(b=b.pb,null!=b&&(b.uv(null),b.GA(null)))};return b}();a.Me=b})(E||(E={}));(function(a){var b=function(b){function g(){b.apply(this,arguments)}m(g,b);g.prototype.D=function(){return 13};g.local=function(){null===g.V&&(g.V=new g);return g.V};g.prototype.$=function(e,f,b,g,c){return e instanceof a.T?(c=new a.Pc(e),this.$(c,f,[b],!1,g).next()):!0===g?(b=new a.Pz(e,f,b,!1,c),a.wi.local().$(b,f,c)):new a.Pz(e,
f,b,!1,c)};g.V=null;return g}(a.Me);a.Oz=b})(E||(E={}));(function(a){var b=function(){function b(b,e,f,n,c){this.ua=-1;this.ne=b;this.fx=e;this.Oq=f;this.BP=new a.i;this.BP.Ja();this.Vm=-1;this.Yb=c}b.prototype.next=function(){for(var a;null!=(a=this.ne.next());)return this.ua=this.ne.ya(),this.Vm+1<this.Oq.length&&this.Vm++,this.buffer(a,this.Oq[this.Vm]);return null};b.prototype.ya=function(){return this.ua};b.prototype.buffer=function(b,e){return a.UG.buffer(b,e,this.fx,NaN,96,this.Yb)};return b}();
a.Pz=b})(E||(E={}));(function(a){var b=function(b){function g(){b.apply(this,arguments)}m(g,b);g.prototype.D=function(){return 16};g.local=function(){null===g.V&&(g.V=new g);return g.V};g.prototype.$=function(e,f,b,g){return e instanceof a.T?(e=new a.Pc(e),this.$(e,f,b,g).next()):new a.TH(e,f,b,g)};g.V=null;return g}(a.Me);a.SH=b})(E||(E={}));(function(a){var b=function(){function b(b,e,f){this.ua=-1;if(null==b)throw a.g.N();this.R=e;this.wk=b;this.ka=a.Ia.zd(f,e,!1)}b.prototype.next=function(){var b;
return null!=(b=this.wk.next())?(this.ua=this.wk.ya(),a.Ed.clip(b,this.R,this.ka,0)):null};b.prototype.ya=function(){return this.ua};return b}();a.TH=b})(E||(E={}));(function(a){var b=function(b){function g(){b.apply(this,arguments)}m(g,b);g.prototype.D=function(){return 31};g.local=function(){null===g.V&&(g.V=new g);return g.V};g.prototype.$=function(e,f,b){return e instanceof a.T?a.Rz.qB(e):new a.Rz(f,e,b)};g.V=null;return g}(a.Me);a.Qz=b})(E||(E={}));(function(a){var b=function(){function b(b,
e,f){this.cE=new a.Tr;this.ua=-1;if(null==e)throw a.g.N();this.zP=b;this.Ec=!1;this.wk=e;this.Yb=f}b.prototype.next=function(){if(this.zP){if(!this.Ec){var a=this.GK(this.wk);this.Ec=!0;return a}return null}if(!this.Ec){a=this.wk.next();if(null!=a)return this.ua=this.wk.ya(),b.qB(a);this.Ec=!0}return null};b.prototype.ya=function(){return this.ua};b.prototype.GK=function(a){for(var e;null!=(e=a.next());)this.cE.Eb(e);return this.cE.sN()};b.qB=function(g){if(b.Gh(g))return g;var e=g.D();if(a.al.Lc(e))return e=
new a.Xa(g.description),e.Bc(g,!0),e;if(550==e&&2==g.F()){var f=new a.Va,e=new a.Xa(g.description);g.Sd(0,f);e.df(f);g.Sd(1,f);e.lineTo(f);return e}return a.Tr.wL(g)};b.Gh=function(b){if(b.s())return!0;var e=b.D();return 33==e||197==e?!0:a.al.Lc(e)?!1:550==e?1==b.F()?!0:!1:1607==e?1==b.ea()&&2>=b.F()?!0:!1:1!=b.ea()?!1:2>=b.F()?!0:a.Tr.sD(b,0)};return b}();a.Rz=b})(E||(E={}));(function(a){var b=function(b){function g(){b.apply(this,arguments)}m(g,b);g.prototype.D=function(){return 17};g.local=function(){null===
g.V&&(g.V=new g);return g.V};g.prototype.$=function(e,f,b,g,c){return new a.VH(e,f,b,g,c)};g.V=null;return g}(a.Me);a.UH=b})(E||(E={}));(function(a){var b=function(){function b(b,e,f,n,c){this.Ef=null;if(null==e||null==f)throw a.g.ra("invalid argument");this.xP=b;this.rx=e;this.RD=f;b=a.Ia.$s(e,f);this.ka=a.Ia.zd(n,b,!0);this.QD=-1;this.oe=c}b.prototype.ya=function(){return 0};b.prototype.next=function(){this.gN();return++this.QD<this.Ef.length?this.Ef[this.QD]:null};b.prototype.gN=function(){if(null==
this.Ef)switch(this.Ef=[],this.rx.D()){case 1607:this.iN();break;case 1736:this.hN()}};b.prototype.iN=function(){var b=new a.Xa,e=new a.Xa,f=new a.Xa;this.Ef.push(b);this.Ef.push(e);var n=[];a.$G.YG(this.xP,this.rx,this.RD,this.ka,n,this.oe);for(var c=0;c<n.length;c++){var d=n[c];0==d.cu?b.add(d.U,!1):1==d.cu||2==d.cu?e.add(d.U,!1):3==d.cu?this.Ef.push(d.U):f.add(d.U,!1)}f.s()||b.s()&&e.s()&&!(3<=this.Ef.length)||this.Ef.push(f);b.s()&&e.s()&&3>this.Ef.length&&(this.Ef.length=0)};b.prototype.hN=function(){var b=
new a.ga(0),e=new a.fd,f=e.RB(),n=e.Eb(this.rx),c=e.Eb(this.RD),d=new a.Of;try{d.Np(e,this.ka,this.oe);d.xm(f,n,c,b);var m=e.hf(n),k=new a.Ka,z=new a.Ka;this.Ef.length=0;this.Ef.push(k);this.Ef.push(z);for(n=0;n<b.size;n++){var h,q=new a.fd,l=q.Eb(m),v=q.Eb(e.hf(b.get(n)));d.Mp(q,this.oe);var t=d.mt(l,v);h=q.hf(t);if(!h.s()){var y=e.yC(b.get(n),f);2==y?k.add(h,!1):1==y?z.add(h,!1):this.Ef.push(h);var r=new a.fd,l=r.Eb(m),v=r.Eb(e.hf(b.get(n)));d.Mp(r,this.oe);m=r.hf(d.ll(l,v))}}!m.s()&&0<b.size&&
this.Ef.push(m);k.s()&&z.s()&&(this.Ef.length=0)}finally{d.xg()}};return b}();a.VH=b})(E||(E={}));(function(a){var b=function(b){function g(){b.apply(this,arguments)}m(g,b);g.prototype.D=function(){return 18};g.local=function(){null===g.V&&(g.V=new g);return g.V};g.prototype.$=function(e,f,b){if(e instanceof a.T)return e=new a.Pc(e),this.$(e,f,b).next();if(0>=f)throw a.g.N();return new a.XH(e,f,b)};g.V=null;return g}(a.Me);a.WH=b})(E||(E={}));(function(a){var b=function(){function b(a,e){this.ua=
-1;this.ne=a;this.$q=e}b.prototype.ya=function(){return this.ua};b.prototype.next=function(){var a;return null!=(a=this.ne.next())?(this.ua=this.ne.ya(),this.hM(a)):null};b.prototype.hM=function(b){if(b.s()||1>b.fb())return b;var e=b.D();if(1736==e||1607==e)return this.Xv(b);if(a.T.Lc(e))return this.jM(b);if(197==e)return this.iM(b);throw a.g.wa();};b.prototype.jM=function(b){if(b.$b()<=this.$q)return b;var e=new a.Xa(b.description);e.Bc(b,!0);return this.Xv(e)};b.prototype.iM=function(b){var e=new a.Ka(b.description);
e.Wc(b,!1);var f=new a.i;b.o(f);b=f.ba();return f.aa()<=this.$q&&b<=this.$q?e:this.Xv(e)};b.prototype.Xv=function(b){for(var e=b.Pa(),f=b.Ca();f.kb();)for(var g=!0;f.La();){var c=f.ia();if(322!=c.D())throw a.g.ra("not implemented");var d=f.lD(),m=c.$b();if(m>this.$q){var k=Math.ceil(m/this.$q),m=new a.Va(b.description);g&&(c.En(m),e.df(m));for(var h=g=1/k,z=0,k=k-1;z<k;z++)c.uu(h,m),e.lineTo(m),h+=g;d?e.ro():(c.Bn(m),e.lineTo(m))}else d?e.ro():e.Bc(c,g);g=!1}return e};return b}();a.XH=b})(E||(E={}));
(function(a){var b=function(b){function g(){b.apply(this,arguments)}m(g,b);g.local=function(){null===g.V&&(g.V=new g);return g.V};g.prototype.D=function(){return 2};g.prototype.$=function(e,f,b,g){return e instanceof a.T?(e=new a.Pc(e),f=new a.Pc(f),this.$(e,f,b,g).next()):new a.YH(e,f,b,g)};g.ll=function(e,f,b,c){if(e.s()||f.s())return e;var n=e.fb(),d=f.fb();if(n>d)return e;var m=e.D(),x=f.D(),k=new a.i,h=new a.i,z=new a.i;e.o(k);f.o(h);z.K(k);z.Db(h);var z=a.Ia.zd(b,z,!1),q=z*Math.sqrt(2)*1.00001,
l=new a.i;l.K(k);l.P(q,q);if(!l.jc(h))return e;if(1==n&&2==d)return g.UI(e,f,x,b,c);if(33==m)switch(a.al.Lc(x)?(b=new a.Xa(f.description),b.Bc(f,!0)):b=f,x){case 1736:return g.kP(e,b,z);case 1607:return g.nP(e,b,z);case 550:return g.dN(e,b,z);case 197:return g.FM(e,b,z);case 33:return g.rO(e,b,z);default:throw a.g.N();}else if(550==m)switch(x){case 1736:return g.ZI(e,f,z);case 197:return g.TI(e,f,z);case 33:return g.WI(e,f,z)}return a.Of.ll(e,f,b,c)};g.kP=function(e,f,b){return 0==a.gd.uD(f,e,b)?
e:e.Pa()};g.nP=function(e,f,b){var g=e.w();f=f.Ca();for(var n=b*Math.sqrt(2)*1.00001,c=n*n,d=new a.i;f.kb();)for(;f.La();){var m=f.ia();m.o(d);d.P(n,n);if(d.contains(g)){if(m.Eq(g,b))return e.Pa();var k=m.Mb();if(a.b.Zb(g,k)<=c)return e.Pa();k=m.oc();if(a.b.Zb(g,k)<=c)return e.Pa()}}return e};g.dN=function(e,f,b){var g=f.mc(0);f=f.F();var n=e.w(),c=new a.b;b=b*Math.sqrt(2)*1.00001;b*=b;for(var d=0;d<f;d++)if(g.ec(2*d,c),a.b.Zb(c,n)<=b)return e.Pa();return e};g.FM=function(e,f,b){var g=new a.i;f.o(g);
g.P(b,b);f=e.w();return g.contains(f)?e.Pa():e};g.rO=function(e,f,b){b=b*Math.sqrt(2)*1.00001;b*=b;var g=e.w();f=f.w();return a.b.Zb(g,f)<=b?e.Pa():e};g.ZI=function(e,f,b){var g=new a.i;f.o(g);g.P(b,b);for(var n=e.F(),c=!1,d=[],m=0;m<n;m++)d[m]=!1;for(var k=new a.b,m=0;m<n;m++)e.w(m,k),g.contains(k)&&0!=a.gd.he(f,k,b)&&(c=!0,d[m]=!0);if(!c)return e;f=e.Pa();for(m=0;m<n;m++)d[m]||f.Pd(e,m,m+1);return f};g.TI=function(e,f,b){var g=new a.i;f.o(g);g.P(b,b);f=e.F();var n=!1;b=[];for(var c=0;c<f;c++)b[c]=
!1;for(var d=new a.b,c=0;c<f;c++)e.w(c,d),g.contains(d)&&(n=!0,b[c]=!0);if(!n)return e;g=e.Pa();for(c=0;c<f;c++)b[c]||g.Pd(e,c,c+1);return g};g.WI=function(e,f,b){var g=e.mc(0),n=e.F(),c=f.w(),d=new a.b,m=!1;f=[];for(var k=0;k<n;k++)f[k]=!1;k=b*Math.sqrt(2)*1.00001;b=k*k;for(k=0;k<n;k++)g.ec(2*k,d),a.b.Zb(d,c)<=b&&(m=!0,f[k]=!0);if(!m)return e;g=e.Pa();for(k=0;k<n;k++)f[k]||g.Pd(e,k,k+1);return g};g.UI=function(e,f,b,g,c){var n=new a.Vj;e.Fp(n);var d=new a.i;f.o(d);n.Db(d);n.P(.1*n.aa(),.1*n.ba());
d=new a.Ka;d.Wc(n,!1);1736==b?d.add(f,!0):d.Wc(f,!0);return a.$r.local().$(e,d,g,c)};g.V=null;return g}(a.Me);a.Zr=b})(E||(E={}));(function(a){var b=function(){function b(a,e,f,b){this.Fq=null==e;this.ua=-1;this.ne=a;this.fx=f;this.EP=e.next();this.Yb=b}b.prototype.next=function(){if(this.Fq)return null;var b;return null!=(b=this.ne.next())?(this.ua=this.ne.ya(),a.Zr.ll(b,this.EP,this.fx,this.Yb)):null};b.prototype.ya=function(){return this.ua};return b}();a.YH=b})(E||(E={}));(function(a){var b=function(){function b(e){this.oe=
e;this.Ii=new a.i;this.Ii.Ja();this.Ng=new a.i;this.Ng.Ja()}b.prototype.Pr=function(){var e;e=this.Ii.v;this.Ii.v=this.Ng.v;this.Ng.v=e;e=this.Ii.B;this.Ii.B=this.Ng.B;this.Ng.B=e;e=this.Ii.C;this.Ii.C=this.Ng.C;this.Ng.C=e;e=this.Ii.G;this.Ii.G=this.Ng.G;this.Ng.G=e};b.prototype.wM=function(e,f){var b=!this.Ii.jc(this.Ng);if(a.T.Kc(e.D())&&a.T.Kc(f.D())){if(e.F()>f.F())return this.gB(e,f,b);this.Pr();b=this.gB(f,e,b);this.Pr();return b}if(550==e.D()&&a.T.Kc(f.D()))return b=this.hB(f,e,b),this.Pr(),
b;if(550==f.D()&&a.T.Kc(e.D()))return this.hB(e,f,b);if(550==e.D()&&550==f.D()){if(e.F()>f.F())return this.iB(e,f);this.Pr();b=this.iB(f,e);this.Pr();return b}return 0};b.prototype.gB=function(e,f,b){var g=e.Ca(),n=f.Ca(),c=new a.i,d=new a.i,m=1.7976931348623157E308;if(!b&&this.iT(e,f,g,n))return 0;for(;g.kb();)for(;g.La();)if(e=g.ia(),e.o(c),!(c.Ou(this.Ng)>m)){for(;n.kb();)for(;n.La();)if(f=n.ia(),f.o(d),c.Ou(d)<m&&(f=e.Fb(f,b),f*=f,f<m)){if(0==f)return 0;m=f}n.Lk()}return Math.sqrt(m)};b.prototype.hB=
function(e,f,b){var g=e.Ca(),n=new a.i,c=1.7976931348623157E308,d=new a.b,m,k=f.F();for(b=!b&&1736==e.D();g.kb();)for(;g.La();){var h=g.ia();h.o(n);if(!(1<k&&n.Ou(this.Ng)>c)){for(var z=0;z<k;z++){f.w(z,d);if(b&&0!=a.gd.he(e,d,0))return 0;m=h.Gd(d,!1);d.sub(h.Kb(m));m=d.Up();if(m<c){if(0==m)return 0;c=m}}b=!1}}return Math.sqrt(c)};b.prototype.iB=function(e,f){for(var b=1.7976931348623157E308,g=new a.b,c=new a.b,d,m=e.F(),k=f.F(),h=0;h<m;h++)if(e.w(h,g),!(1<k&&this.Ng.gG(g)>b))for(var z=0;z<k;z++)if(f.w(z,
c),d=a.b.Zb(g,c),d<b){if(0==d)return 0;b=d}return Math.sqrt(b)};b.prototype.iT=function(e,f,b,g){if(1736==e.D()){for(;g.kb();)if(g.La()){var n=g.ia();if(0!=a.gd.he(e,n.oc(),0))return!0}g.Lk()}if(1736==f.D()){for(;b.kb();)if(b.La()&&(e=b.ia(),0!=a.gd.he(f,e.oc(),0)))return!0;b.Lk()}return!1};b.prototype.il=function(e,a){if(e.s()||a.s())return NaN;e.o(this.Ii);a.o(this.Ng);return this.wM(e,a)};return b}(),c=function(g){function e(){g.apply(this,arguments)}m(e,g);e.prototype.$=function(e,g,c){if(null==
e||null==g)throw a.g.N();if(e.s()||g.s())return NaN;var f,n;f=e.D();n=g.D();if(33==f){if(33==n)return a.b.Fb(e.w(),g.w());if(197==n)return c=new a.i,g.o(c),c.Fb(e.w());f=new a.pe;f.add(e);e=f}else if(197==f){if(197==n)return n=new a.i,e.o(n),c=new a.i,g.o(c),c.Fb(n);f=new a.Ka;f.Wc(e,!1);e=f}33==n?(n=new a.pe,n.add(g),g=n):197==n&&(n=new a.Ka,n.Wc(g,!1),g=n);return(new b(c)).il(e,g)};e.local=function(){null===e.V&&(e.V=new e);return e.V};e.prototype.D=function(){return 14};e.V=null;return e}(a.Me);
a.ZH=c})(E||(E={}));(function(a){var b=function(){function b(a,e,f,b){this.aE=a;this.fE=e;this.oe=b;this.HD=f}b.prototype.next=function(){var a=this.aE.next();return null==a?null:this.yz(a)};b.prototype.ya=function(){return this.aE.ya()};b.prototype.yz=function(b){var e=b.D();if(a.T.Km(e))return b;if(197==e)return e=new a.Ka(b.description),e.Wc(b,!1),this.yz(e);if(b.s())return b;if(null==b)throw a.g.wa();for(var e=b.Pa(),f=new a.yb,g=0,c=b.ea();g<c;g++)this.mH(b,g,e,f);return e};b.prototype.mH=function(b,
e,f,n){if(!(2>b.Ha(e))){var g=b.Ea(e),c=b.Dc(e)-1,d=b.mc(0),m=b.vc(e),k=new a.ga(0);k.xb(b.Ha(e)+1);var h=new a.ga(0);h.xb(b.Ha(e)+1);k.add(m?g:c);k.add(g);for(g=new a.b;1<k.size;){var z=k.tc();k.af();var q=k.tc();b.w(z,g);n.ed(g);b.w(q,g);n.vd(g);q=this.jH(n,g,d,z,q,c);0<=q?(k.add(q),k.add(z)):h.add(z)}m||h.add(k.get(0));if(h.size==k.size)f.Zj(b,e,!0);else if(2<=h.size&&(!this.HD||2!=h.size||!(m||a.b.Fb(b.Fa(h.get(0)),b.Fa(h.get(1)))<=this.fE))){e=new a.Va;n=0;for(c=h.size;n<c;n++)b.Sd(h.get(n),
e),0==n?f.df(e):f.lineTo(e);m&&(this.HD||2!=h.size||f.lineTo(e),f.ro())}}};b.prototype.jH=function(a,e,f,b,c,d){var g=c-1;c<=b&&(g=d);d=c=-1;for(b+=1;b<=g;b++){f.ec(2*b,e);var n=e.x,m=e.y;a.Kb(a.Gd(e,!1),e);e.x-=n;e.y-=m;n=e.length();n>this.fE&&n>d&&(c=b,d=n)}return c};return b}();a.$H=b})(E||(E={}));(function(a){var b=function(b){function g(){b.apply(this,arguments)}m(g,b);g.prototype.D=function(){return 29};g.prototype.$=function(e,f,b,g){return e instanceof a.T?(e=new a.Pc(e),this.$(e,f,b,g).next()):
new a.$H(e,f,b,g)};g.local=function(){null===g.V&&(g.V=new g);return g.V};g.V=null;return g}(a.Me);a.Sz=b})(E||(E={}));(function(a){var b=function(b){function g(){b.apply(this,arguments)}m(g,b);g.prototype.D=function(){return 21};g.local=function(){null===g.V&&(g.V=new g);return g.V};g.prototype.$=function(e,f,b,g,c,d,m,k){return e instanceof a.T?(k=new a.Pc(e),this.$(k,f,b,[g],c,d,!1,m).next()):!0===m?(b=new a.Uz(e,f,b,g,c,!1,!1,k),a.wi.local().$(b,f,k)):new a.Uz(e,f,b,g,c,!1,!1,k)};g.V=null;return g}(a.Me);
a.Tz=b})(E||(E={}));(function(a){var b=function(){function b(b,e,f,n,c,d,m,k){if(d)throw a.g.qe();if(null==e)throw a.g.N();this.ua=-1;this.Xq=b;this.cg=e;this.ke=f;this.Oq=n;this.Rm=c;this.Vm=-1;this.Yb=k;this.CP=new a.i;this.CP.Ja()}b.prototype.next=function(){for(var a;null!=(a=this.Xq.next());)return this.ua=this.Xq.ya(),this.Vm+1<this.Oq.length&&this.Vm++,this.oN(a,this.Oq[this.Vm]);return null};b.prototype.ya=function(){return this.ua};b.prototype.oN=function(b,e){return a.pH.buffer(b,this.cg,
this.ke,e,this.Rm,this.Yb)};return b}();a.Uz=b})(E||(E={}));(function(a){var b=function(b){function g(){b.apply(this,arguments)}m(g,b);g.prototype.D=function(){return 24};g.local=function(){null===g.V&&(g.V=new g);return g.V};g.prototype.$=function(e,f,b){if(null==f)throw a.g.N();if(e.s()||1>e.fb())return 0;if(4==b)throw a.g.qe();var g=a.Ya.Em(f),n=a.Ya.ft(g),c=a.Ya.Ts(g),n=n*(2-n),d=g.Se().Dj,m=e.D(),k;1736==m||197==m?k=e.Rf():a.T.Lc(m)?(k=new a.Xa(e.description),k.Bc(e,!0)):k=e;if(0==g.lc(f)){if(a.Ya.Qo(f)){k=
a.gh.qo(k,f);1607==m&&k==e&&(k=a.T.Yj(e));e=new a.Nd;a.Ya.Fm(f).wu(e);for(var m=0,h=k.F();m<h;m++){var z=k.Fa(m);z.x=a.gh.pu(z.x,e);k.ic(m,z)}}e=k.Pa();k=a.gh.ZQ(f,g,k,e)?e:a.Ya.Wl(k,f,g)}return this.yM(k,b,c,n,d)};g.prototype.yM=function(e,f,b,g,c){var n=new a.ca(0),d=0;for(e=e.Ca();e.kb();)for(;e.La();){var m=e.ia(),k=m.Mb(),m=m.oc();k.scale(c);m.scale(c);a.zb.Rd(b,g,k.x,k.y,m.x,m.y,n,null,null,f);d+=n.l}return d};g.V=null;return g}(a.Me);a.cI=b})(E||(E={}));(function(a){var b=function(b){function g(){b.apply(this,
arguments)}m(g,b);g.prototype.D=function(){return 18};g.local=function(){null===g.V&&(g.V=new g);return g.V};g.prototype.$=function(e,f,b,g,c){return e instanceof a.T?(e=new a.Pc(e),this.$(e,f,b,g,c).next()):new a.bI(e,b,g,f,-1,-1,c)};g.V=null;return g}(a.Me);a.aI=b})(E||(E={}));(function(a){var b=function(){function b(b,e,f,n,c,d){if(0<d)throw a.g.qe();if(4!=f&&0<c)throw a.g.qe();if(null==e)throw a.g.N();this.ua=-1;this.Xq=b;this.cg=e;this.ke=f;this.IP=n;this.HP=c}b.prototype.next=function(){for(var a;null!=
(a=this.Xq.next());)return this.ua=this.Xq.ya(),this.hw(a);return null};b.prototype.ya=function(){return this.ua};b.prototype.hw=function(b){return a.ui.oq(b,this.cg,this.ke,this.IP,this.HP,this.Yb)};return b}();a.bI=b})(E||(E={}));(function(a){(function(a){a[a.Unknown=0]="Unknown";a[a.Contains=1]="Contains";a[a.Within=2]="Within";a[a.Equals=3]="Equals";a[a.Disjoint=4]="Disjoint";a[a.Touches=8]="Touches";a[a.Crosses=16]="Crosses";a[a.Overlaps=32]="Overlaps";a[a.NoThisRelation=64]="NoThisRelation";
a[a.Intersects=1073741824]="Intersects";a[a.IntersectsOrDisjoint=1073741828]="IntersectsOrDisjoint"})(a.xH||(a.xH={}));var b=function(){function b(){}b.lU=function(g,e,f,n){if(e.s()||g.s())return 4;var c=g.D(),d=e.D(),m;a.T.Lc(c)&&(g=m=new a.Xa(g.description),m.Bc(g,!0));a.T.Lc(d)&&(e=m=new a.Xa(e.description),m.Bc(e,!0));switch(c){case 33:switch(d){case 33:return b.sO(g,e,f);case 197:return b.Id(b.BG(e,g,f));case 550:return b.Id(b.HG(e,g,f));case 1607:return b.Id(b.Az(e,g,f,n));case 1736:return b.Id(b.pz(e,
g,f))}throw a.g.wa();case 197:switch(d){case 33:return b.BG(g,e,f);case 197:return b.fK(g,e,f);case 550:return b.Id(b.DG(e,g,f,n));case 1607:return b.Id(b.vz(e,g));case 1736:return b.Id(b.lz(e,g))}throw a.g.wa();case 550:switch(d){case 33:return b.HG(g,e,f);case 197:return b.DG(g,e,f,n);case 550:return b.FG(g,e,f,n);case 1607:return b.Id(b.xz(e,g));case 1736:return b.Id(b.nz(e,g))}throw a.g.wa();case 1607:switch(d){case 33:return b.Az(g,e,f,n);case 197:return b.vz(g,e);case 550:return b.xz(g,e);case 1607:return b.iQ(g,
e);case 1736:return b.Id(b.rz(e,g))}throw a.g.wa();case 1736:switch(d){case 33:return b.pz(g,e,f);case 197:return b.lz(g,e);case 550:return b.nz(g,e);case 1607:return b.rz(g,e);case 1736:return b.oP(g,e)}throw a.g.wa();default:throw a.g.wa();}};b.sO=function(a,e,f){a=a.w();e=e.w();return b.jz(a,e,f)};b.jz=function(a,e,f){a.sub(e);return a.Up()<=f*f?3:4};b.BG=function(g,e,f){var n=new a.i;g.o(n);g=e.w();return b.ZL(n,g,f)};b.ZL=function(a,e,f){a.P(-f,-f);if(a.contains(e))return 1;a.P(f,f);return a.contains(e)?
8:4};b.uM=function(a,e,f){return e.contains(f)?1:a.contains(f)?8:4};b.fK=function(g,e,f){var n=new a.i;g.o(n);g=new a.i;e.o(g);return b.MK(n,g,f)};b.MK=function(a,e,f){var b=0;a.contains(e)&&(b|=1);e.contains(a)&&(b|=2);if(0!=b)return b;a.P(-f,-f);e.P(-f,-f);if(a.jc(e))return b=a,b.P(f,f),b=b.contains(e)?1:0,e.P(f,f),b|=e.contains(a)?2:0,0!=b?b:32;b=a;b.P(f,f);e.P(f,f);return b.jc(e)?8:4};b.HG=function(a,e,f){e=e.w();return b.JG(a,e,f)};b.JG=function(a,e,f){for(var g=0,c=a.F();g<c;g++){var d;d=a.Fa(g);
d=b.jz(d,e,f);if(4!=d)return 0!=(d&2)&&1!=c?1:d}return 4};b.DG=function(g,e,f,n){var c=new a.i;e.o(c);return b.eN(g,c,f,n)};b.eN=function(a,e,f,n){e.P(-f,-f);e.P(f,f);for(var g=f=0,c=a.F();g<c;g++){var d;d=a.Fa(g);d=b.Id(b.uM(e,e,d));if(4!=d&&(f|=d,4==n))return 1073741824}return 0==f?4:2==f?f:32};b.FG=function(a,e,f,n){for(var g=0,c=0,d=e.F();c<d;c++){var m;m=e.Fa(c);m=b.JG(a,m,f);if(4!=m&&(g++,4==n))return 1073741824}return 0<g?g==e.F()?3==n?(m=b.FG(e,a,f,1),1==m?3:0):1:32:0};b.Az=function(a,e,f,
n){e=e.w();return b.XP(a,e,f,n)};b.GM=function(a,e){var f=null;a=a.pb;null!=a&&(f=a.hi);if(null!=f){f=f.Kk(e.x,e.y);if(0==f)return 4;if(1==f)return 1}else return-1;return 0};b.XP=function(g,e,f,n){if(0==(n&1073741839))return 64;var c=b.GM(g,e);if(0<c)return c;f*=f;for(c=g.Ca();c.kb();){var d=c.Qa;if(!g.vc(d)){var m=g.Ha(d),d=g.Ea(d);if(0==m)continue;if(a.b.Zb(g.Fa(d),e)<=f||1<m&&a.b.Zb(g.Fa(d+m-1),e)<=f)return 8}if(8!=n)for(;c.La();)if(m=c.ia(),m=m.Kb(m.Gd(e,!1)),a.b.Zb(m,e)<=f)return 0!=(n&1073741828)?
1073741824:1}return 0!=(n&1073741828)?4:64};b.vz=function(g,e){var f=new a.i;e.o(f);return b.rP(g,f)};b.rP=function(a,e){a=b.ao(a,e);return 0<a?a:0};b.ao=function(a,e){a=a.pb;if(null!=a)a=a.hi;else return-1;if(null!=a){a=a.Dn(e);if(0==a)return 4;if(1==a)return 1}else return-1;return 0};b.xz=function(g,e){var f=new a.i;e.o(f);f=b.ao(g,f);return 0<f?f:0};b.fs=function(g,e){var f=new a.i;e.o(f);f=b.ao(g,f);return 0<f?f:-1==f&&(f=new a.i,g.o(f),f=b.ao(e,f),0<f)?b.Id(f):0};b.iQ=function(a,e){a=b.fs(a,
e);return 0<a?a:0};b.pz=function(a,e,f){e=e.w();return b.lP(a,e,f)};b.lP=function(b,e,f){b=a.gd.he(b,e,f);if(0==b)return 4;if(1==b)return 1;if(2==b)return 8;throw a.g.wa();};b.lz=function(g,e){var f=new a.i;e.o(f);return b.uO(g,f)};b.uO=function(a,e){a=b.ao(a,e);return 0<a?a:0};b.nz=function(a,e){a=b.fs(a,e);return 0<a?a:0};b.rz=function(a,e){a=b.fs(a,e);return 0<a?a:0};b.oP=function(a,e){a=b.fs(a,e);return 0<a?a:0};b.iR=function(b,e){var f=b.D(),g=e.D(),c;if(a.T.Th(f)&&(c=b.pb,null!=c&&(c=c.hi,null!=
c))){if(33==g){var d=e.w();c=c.Kk(d.x,d.y)}else d=new a.i,e.o(d),c=c.Dn(d);if(1==c)return 1;if(0==c)return 4}if(a.T.Th(g)&&(c=e.pb,null!=c&&(c=c.hi,null!=c))){33==f?(f=b.w(),c=c.Kk(f.x,f.y)):(f=new a.i,b.o(f),c=c.Dn(f));if(1==c)return 2;if(0==c)return 4}return 0};b.Id=function(a){0!=(a&1)&&(a=a&-2|2);0!=(a&2)&&(a=a&-3|1);return a};return b}();a.dI=b})(E||(E={}));(function(a){var b=function(b){function g(){b.apply(this,arguments)}m(g,b);g.local=function(){null===g.V&&(g.V=new g);return g.V};g.prototype.D=
function(){return 15};g.prototype.$=function(e,f,b,g,c){return e instanceof a.T?(e=new a.Pc(e),f=new a.Pc(f),this.$(e,f,b,g,c).next()):void 0===c?new a.Vz(e,f,b,g,-1):new a.Vz(e,f,b,g,c)};g.V=null;return g}(a.Me);a.$r=b})(E||(E={}));(function(a){var b=function(){function b(b,e,f,c,d){this.Fq=null==e;this.ua=-1;this.ne=b;this.cg=f;this.Ce=e.next();this.Ji=this.Ce.D();this.Yb=c;this.Xh=d;if(-1!=this.Xh&&(0>=this.Xh||7<this.Xh))throw a.g.N("bad dimension mask");}b.prototype.next=function(){if(this.Fq)return null;
var a;if(null!=this.du){a=this.du.next();if(null!=a)return a;this.du=null}for(;null!=(a=this.ne.next());){this.ua=this.ne.ya();if(-1==this.Xh)return a=this.Ga(a);this.du=this.PO(a);return a=this.du.next()}return null};b.prototype.ya=function(){return this.ua};b.prototype.Ga=function(b){var e=this.uG(b);if(null!=e)return e;var e=a.Ia.$s(this.Ce,b),f=a.Ia.zd(this.cg,e,!0),e=new a.i;this.Ce.o(e);var g=new a.i;b.o(g);e.P(2*f,2*f);e.Ga(g);e.P(100*f,100*f);f=a.Ed.clip(this.Ce,e,0,0);b=a.Ed.clip(b,e,0,0);
return a.Of.mt(b,f,this.cg,this.Yb)};b.prototype.SE=function(b,e,f){var g=0;if(0!=(e&1))null==f[0]&&(f[0]=new a.pe(b)),g++;else for(var c=0;c<f.length-1;c++)f[c]=f[c+1];if(0!=(e&2))null==f[g]&&(f[g]=new a.Xa(b)),g++;else for(c=g;c<f.length-1;c++)f[c]=f[c+1];if(0!=(e&4))null==f[g]&&(f[g]=new a.Ka(b)),g++;else for(c=g;c<f.length-1;c++)f[c]=f[c+1];if(3!=g){b=[];for(c=0;c<g;c++)b[c]=f[c];return new a.Pc(b)}return new a.Pc(f)};b.prototype.PO=function(b){var e=this.uG(b);if(null!=e){var f=[null,null,null];
f[e.fb()]=e;return this.SE(b.description,this.Xh,f)}e=a.Ia.$s(this.Ce,b);f=a.Ia.zd(this.cg,e,!0);e=new a.i;this.Ce.o(e);e.P(2*f,2*f);var g=new a.i;b.o(g);e.Ga(g);e.P(100*f,100*f);f=a.Ed.clip(this.Ce,e,0,0);e=a.Ed.clip(b,e,0,0);f=a.Of.Uw(e,f,this.cg,this.Yb);return this.SE(b.description,this.Xh,f)};b.prototype.uG=function(g){var e=a.Ia.$s(g,this.Ce),f=a.Ia.zd(this.cg,e,!1),e=g.D(),c=g.s(),d=this.Ce.s(),d=c||d;if(!d){d=new a.i;g.o(d);var m=new a.i;this.Ce.o(m);m.P(2*f,2*f);d=!d.jc(m)}if(!d)if(m=a.dI.iR(this.Ce,
g),4==m)d=!0;else{if(0!=(m&2))return this.Ce;if(0!=(m&1))return g}if(d)return f=a.T.ve(e),d=a.T.ve(this.Ji),f<d?b.V(g,c):f>d?this.kF():0==f?550==e&&33==this.Ji?this.kF():b.V(g,c):b.V(g,c);if((-1==this.Xh||4==this.Xh)&&197==e&&197==this.Ji)return f=this.Ce,e=new a.i,g.o(e),c=new a.i,f.o(c),e.Ga(c),f=new a.Vj,g.copyTo(f),f.Cu(e),f;if(197==e&&0==a.T.ve(this.Ji)||197==this.Ji&&0==a.T.ve(e))return c=197==e?g:this.Ce,g=197==e?this.Ce:g,e=new a.i,c.o(e),a.Ed.clip(g,e,f,0);if(0==a.T.ve(e)&&0<a.T.ve(this.Ji)||
0<a.T.ve(e)&&0==a.T.ve(this.Ji)){f=a.Ia.Cg(this.cg,g,!1);if(550==e||33==e)return a.Of.jD(g,this.Ce,f);if(550==this.Ji||33==this.Ji)return a.Of.jD(this.Ce,g,f);throw a.g.wa();}return-1!=this.Xh&&2!=this.Xh||1607!=e||1736!=this.Ji?-1!=this.Xh&&2!=this.Xh||1736!=e||1607!=this.Ji?null:this.rG(this.Ce,g):this.rG(g,this.Ce)};b.prototype.rG=function(b,e){var f=b,g=e,c=a.Ia.Cg(this.cg,e,!1),d=new a.i;g.o(d);var m=new a.i;f.o(m);m.P(2*c,2*c);d.Ga(m);d.P(10*c,10*c);var f=b=a.Ed.clip(b,d,0,0),m=new a.ga(0),
k=-1,h=g.pb;if(null!=h){var z=h.hi;if(null!=z){k=0;m.xb(f.F()+f.ea());for(var q=new a.i,l=f.Ca();l.kb();)for(;l.La();){l.ia().o(q);var v=z.Dn(q);1==v?m.add(1):0==v?m.add(0):(m.add(-1),k++)}}}5<e.F()&&(g=e=a.Ed.clip(e,d,0,0),h=g.pb);0>k&&(k=f.Iw());d=f.F()+g.F();if(k*g.F()>Math.log(d)*d*4)return null;d=null;k=g.Ca();null!=h&&null!=h.Ab&&(d=h.Ab);null==d&&20<g.F()&&(d=a.Ia.nB(g));g=b.Pa();h=null;z=f.Ca();q=[0,0,0,0,0,0,0,0,0];l=new a.qd(0);v=new a.Ag;b=-1;for(var t=0,y=0,r=0<m.size,B=-1;z.kb();){var B=
z.Qa,E=0;b=-1;for(t=0;z.La();){var u=r?a.I.truncate(m.get(y)):-1;y++;var C=z.ia();if(0>u){if(null!=d)for(null==h?h=d.KN(C,c):h.Fn(C,c),u=h.next();-1!=u;u=h.next()){k.Sb(d.da(u));for(var u=k.ia(),D=C.Ga(u,null,q,null,c),u=0;u<D;u++)l.add(q[u])}else for(k.Lk();k.kb();)for(;k.La();)for(u=k.ia(),D=C.Ga(u,null,q,null,c),u=0;u<D;u++)l.add(q[u]);if(0<l.size){l.xd(0,l.size,function(a,e){return a-e});var G=0;l.add(1);for(var D=-1,u=0,J=l.size;u<J;u++){var p=l.get(u);if(p!=G){var w=!1;0!=G||1!=p?(C.Bi(G,p,
v),G=v.get()):(G=C,w=!0);if(2<=E){g.ys(f,B,b,t,3==E);if(1!=this.UA(e,G.Mb(),c)&&1!=this.VA(e,G,c))return null;g.Bc(G,!1);E=1;t=0}else switch(D=this.VA(e,G,c),D){case 1:w?2>E?(b=z.Jb()-f.Ea(B),t=1,E=0==E?3:2):t++:(g.Bc(G,0==E),E=1);break;case 0:E=0;b=-1;t=0;break;default:return null}G=p}}}else{u=this.UA(e,C.Mb(),c);if(0>u)return null;1==u?(2>E&&(b=z.Jb()-f.Ea(B),E=0==E?3:2),t++):(b=-1,t=0)}l.clear(!1)}else 0!=u&&1==u&&(0==E?(E=3,b=z.Jb()-f.Ea(B)):1==E?(E=2,b=z.Jb()-f.Ea(B)):t++)}2<=E&&(g.ys(f,B,b,
t,3==E),b=-1)}return g};b.prototype.UA=function(b,e,f){return a.ff.xl(b,e,f)};b.prototype.VA=function(b,e,f){var g=e.Mb();e=e.oc();var c=a.ff.xl(b,g,f),d=a.ff.xl(b,e,f);if(1==c&&0==d||0==c&&1==d)return-1;if(0==c||0==d)return 0;if(1==c||1==d)return 1;c=new a.b;c.add(g,e);c.scale(.5);b=a.ff.xl(b,c,f);return 0==b?0:1==b?1:-1};b.V=function(a,e){return e?a:a.Pa()};b.prototype.kF=function(){null==this.$D&&(this.$D=this.Ce.Pa());return this.$D};return b}();a.Vz=b})(E||(E={}));(function(a){var b=function(b){function g(){b.apply(this,
arguments)}m(g,b);g.prototype.D=function(){return 28};g.local=function(){null===g.V&&(g.V=new g);return g.V};g.prototype.$=function(e,f,b,g,c,d,m){return e instanceof a.T?(e=new a.Pc(e),this.$(e,f,b,g,c,d,m).next()):new a.eI(e,f,b,g,c,d,m)};g.V=null;return g}(a.Me);a.Wz=b})(E||(E={}));(function(a){var b=function(){function b(a,e,f,b,c,d,m){this.ua=-1;this.ne=a;this.Pi=e;this.Da=f;this.bi=b;this.Dx=c;this.XD=d;this.oe=m}b.prototype.next=function(){var a=this.ne.next();return null!=a?(this.ua=this.ne.ya(),
this.RH(a)):null};b.prototype.ya=function(){return this.ua};b.prototype.RH=function(b){var e;e=0>=this.XD?a.Ia.Cg(this.Pi,b,!1):this.XD;return a.XG.$(b,this.Da,this.bi,this.Dx,e,this.oe)};return b}();a.eI=b})(E||(E={}));(function(a){var b=function(){function b(){}b.prototype.reset=function(){this.Pg=this.Fj=-1;this.Hq=this.Uo=!1};b.prototype.QM=function(a,f,b){for(a.Sb(f,b);a.La();){var e=a.ia(),e=e.$b();if(0!=e)return a.Jb()}for(a.Sb(f,b);a.Ow();)if(e=a.oi(),e=e.$b(),0!=e)return a.Jb();return-1};
b.prototype.RM=function(a,f){for(a.Sb(f,-1);a.Ow();)if(0!=a.oi().$b())return a.Jb();return-1};b.prototype.PM=function(a,f){a.Sb(f,-1);for(a.ia();a.La();)if(0!=a.ia().$b())return a.Jb();return-1};b.prototype.OM=function(e,f,b,g){this.Fj=this.QM(f,b,g);if(-1!=this.Fj){f.Sb(this.Fj,-1);var c=f.ia(),n=c.Kb(c.Gd(e,!1));b=a.b.Zb(n,e);g=new a.b;g.J(n);g.sub(c.Mb());n=new a.b;n.J(e);n.sub(c.Mb());this.Uo=0>g.Ai(n);this.Pg=this.PM(f,this.Fj);if(-1!=this.Pg){f.Sb(this.Pg,-1);var c=f.ia(),d=c.Gd(e,!1),d=c.Kb(d),
m=a.b.Zb(d,e);m>b?this.Pg=-1:(g.J(d),g.sub(c.Mb()),n.J(e),n.sub(c.Mb()),this.Hq=0>g.Ai(n))}-1==this.Pg&&(this.Pg=this.RM(f,this.Fj),-1!=this.Pg&&(f.Sb(this.Pg,-1),c=f.ia(),d=c.Gd(e,!1),d=c.Kb(d),m=a.b.Zb(d,e),m>b?this.Pg=-1:(g.J(d),g.sub(c.Mb()),n.J(e),n.sub(c.Mb()),this.Hq=0>g.Ai(n),e=this.Fj,this.Fj=this.Pg,this.Pg=e,e=this.Uo,this.Uo=this.Hq,this.Hq=e)))}};b.prototype.FK=function(a,f,b,g,c){b=b.Ca();this.OM(a,b,g,c);if(-1!=this.Fj&&-1==this.Pg)return this.Uo;if(-1!=this.Fj&&-1!=this.Pg){if(this.Uo==
this.Hq)return this.Uo;b.Sb(this.Fj,-1);a=b.ia().Pf(1);b.Sb(this.Pg,-1);f=b.ia().Pf(0);return 0<=a.Ai(f)?!0:!1}return f};return b}(),c=function(g){function e(){g.apply(this,arguments)}m(e,g);e.local=function(){null===e.V&&(e.V=new e);return e.V};e.prototype.D=function(){return 3};e.prototype.zw=function(e,b,g,c){void 0===c&&(c=!1);if(e.s())return new a.dl;b=b.w();var f=e,n=e.D();197==n&&(f=new a.Ka,f.Wc(e,!1),n=1736);switch(n){case 33:return this.OE(f,b);case 550:return this.BE(f,b);case 1607:case 1736:return this.dQ(f,
b,g,c);default:throw a.g.ra("not implemented");}};e.prototype.Aw=function(e,b){if(e.s())return new a.dl;b=b.w();var f=e,g=e.D();197==g&&(f=new a.Ka,f.Wc(e,!1),g=1736);switch(g){case 33:return this.OE(f,b);case 550:case 1607:case 1736:return this.BE(f,b);default:throw a.g.ra("not implemented");}};e.prototype.Bw=function(e,b,g,c){if(0>c)throw a.g.N();if(e.s())return[];b=b.w();var f=e,n=e.D();197==n&&(f=new a.Ka,f.Wc(e,!1),n=1736);switch(n){case 33:return this.IQ(f,b,g,c);case 550:case 1607:case 1736:return this.gQ(f,
b,g,c);default:throw a.g.ra("not implemented");}};e.prototype.dQ=function(e,g,c,d){if(1736==e.D()&&c&&(c=new a.i,e.o(c),c=a.Ia.zd(null,c,!1),0!=(d?a.gd.he(e,g,0):a.gd.he(e,g,c)))){var f=new a.dl(g,0,0);d&&f.UF(!0);return f}for(var n=e.Ca(),f=new a.b,m=c=-1,k=1.7976931348623157E308,x=0;n.kb();)for(;n.La();){var h=n.ia(),h=h.Kb(h.Gd(g,!1)),z=a.b.Zb(h,g);z<k?(x=1,f=h,c=n.Jb(),m=n.Qa,k=z):z==k&&x++}f=new a.dl(f,c,Math.sqrt(k));d&&(n.Sb(c,m),h=n.ia(),d=0>a.b.yn(g,h.Mb(),h.oc()),1<x&&(x=new b,x.reset(),
d=x.FK(g,d,e,c,m)),f.UF(d));return f};e.prototype.OE=function(e,b){e=e.w();b=a.b.Fb(e,b);return new a.dl(e,0,b)};e.prototype.BE=function(e,b){var f=e.mc(0);e=e.F();for(var g=0,c=0,n=0,d=1.7976931348623157E308,m=0;m<e;m++){var k=new a.b;f.ec(2*m,k);var h=a.b.Zb(k,b);h<d&&(c=k.x,n=k.y,g=m,d=h)}f=new a.dl;f.tv(c,n,g,Math.sqrt(d));return f};e.prototype.IQ=function(e,b,g,c){if(0==c)return g=[];g*=g;e=e.w();b=a.b.Zb(e,b);b<=g?(g=[],c=new a.dl,c.tv(e.x,e.y,0,Math.sqrt(b)),g[0]=c):g=[];return g};e.prototype.gQ=
function(e,b,g,c){if(0==c)return c=[];var f=e.mc(0),n=e.F();e=[];var d=0;g*=g;for(var m=0;m<n;m++){var k=f.read(2*m),x=f.read(2*m+1),h=b.x-k,z=b.y-x,h=h*h+z*z;h<=g&&(z=new a.dl,z.tv(k,x,m,Math.sqrt(h)),d++,e.push(z))}b=e.length;e.sort(function(a,e){return a.Da<e.Da?-1:a.Da==e.Da?0:1});if(c>=b)return e.slice(0);e.length=c;return e.slice(0)};e.V=null;return e}(a.Me);a.bv=c})(E||(E={}));(function(a){var b=function(b){function g(){b.apply(this,arguments)}m(g,b);g.prototype.D=function(){return 4};g.prototype.$=
function(e,f,b,g,c){return a.el.py(e,f,b,g,c)};g.local=function(){null===g.V&&(g.V=new g);return g.V};g.V=null;return g}(a.Me);a.fI=b})(E||(E={}));(function(a){var b=function(b){function g(){b.apply(this,arguments)}m(g,b);g.prototype.D=function(){return 33};g.prototype.$=function(e,f,b,g,c){return 1073741824===e?!a.hd.qy(f,b,g,4,c):a.hd.qy(f,b,g,e,c)};g.local=function(){null===g.V&&(g.V=new g);return g.V};g.V=null;return g}(a.Me);a.bl=b})(E||(E={}));(function(a){var b=function(){function b(b,e,f,
c){this.oe=c;this.yP=f;this.ua=-1;if(null==b)throw a.g.N();this.wk=b;this.Pi=e}b.prototype.next=function(){var a;return null!=(a=this.wk.next())?(this.ua=this.wk.ya(),this.Qy(a)):null};b.prototype.ya=function(){return this.ua};b.prototype.Qy=function(b){if(null==b)throw a.g.N();return a.cv.cG(b,this.Pi,this.yP,this.oe)};return b}();a.gI=b})(E||(E={}));(function(a){var b=function(b){function g(){b.apply(this,arguments)}m(g,b);g.prototype.D=function(){return 26};g.prototype.$=function(e,f,b,g){return e instanceof
a.T?(e=new a.Pc(e),this.$(e,f,b,g).next()):new a.gI(e,f,b,g)};g.prototype.Ro=function(e,f,b,g,c){return 0<(void 0!==g?a.cv.Ro(e,f,b,g,c):a.cv.Ro(e,f,!1,null,b))};g.local=function(){null===g.V&&(g.V=new g);return g.V};g.V=null;return g}(a.Me);a.as=b})(E||(E={}));(function(a){var b=function(){function a(){this.hp=0}a.prototype.hS=function(a){this.hp&=-2;this.hp|=a?1:0};a.prototype.sl=function(){return 0!=(this.hp&1)};a.prototype.LC=function(){return this.sl()?0:1};return a}();a.AT=b;var c=function(){return function(){}}(),
g=function(){return function(a,e,f,b){this.x=a;this.y=e;this.Sh=f;this.yl=b}}(),e=function(){function a(a){this.me=a}a.prototype.compare=function(a,e,f){a=a.da(f);e=this.me.$e.read(2*e);a=this.me.$e.read(2*a);e-=a;return 0>e?-1:0<e?1:0};return a}(),f=function(){function a(a){this.me=a}a.prototype.compare=function(a,e,f){e=this.me.$a[e];a=this.me.$a[a.da(f)];var b=e.sl(),g=a.sl();f=e.Zd.xe(this.me.wn,0);var c=a.Zd.xe(this.me.wn,0);f==c&&(f=Math.min(b?e.Zd.ja:e.Zd.ha,g?a.Zd.ja:a.Zd.ha),b=.5*(f-this.me.wn)+
this.me.wn,b==this.me.wn&&(b=f),f=e.Zd.xe(b,0),c=a.Zd.xe(b,0));return f<c?-1:f>c?1:0};return a}(),n=function(){function e(e,f){this.VE=new a.b;this.parent=e;this.mO=f}e.prototype.Zp=function(a,e,f){var b=this.parent,g=this.mO;f.xd(a,e,function(a,e){return b.kj(a,e,g)})};e.prototype.Mo=function(a){a=this.parent.xh.get(a);this.parent.$e.ec(2*(a>>1),this.VE);return this.VE.y+(0!=(a&1)?this.parent.Ri:-this.parent.Ri)};return e}(),d=function(){function d(e,f,b,g,c){this.SD=e.description;this.U=e;this.sg=
f;this.Ri=a.Ia.Cg(this.sg,e,!1);this.pn=a.Ia.Cg(this.sg,e,!0);this.yx=b;this.wP=this.SD.Aa;this.$a=[];this.dn=[];this.Lg=new a.$n;this.Za=new a.bj;this.Kd=new a.wd;this.GD=this.pk=c}d.prototype.Yw=function(){this.GD=!0;return(!a.T.Kc(this.U.D())||this.yB()&&this.xB(!1))&&this.OK()?a.T.Kc(this.U.D())?this.RK()?1607==this.U.D()?this.TK()?2:0:this.UK()?this.VK():0:0:2:0};d.prototype.Yy=function(e,f){var b=this.$e.read(2*e);e=this.$e.read(2*e+1);var g=this.$e.read(2*f);f=this.$e.read(2*f+1);var c=!a.Sr.Vw(b,
e,g,f,this.Ri*this.Ri);return c?c:0==this.U.fb()?!1:b==g&&e==f};d.prototype.yB=function(){for(var e=this.U,f=e.Yf?3:2,b=0,g=e.ea();b<g;b++)if(e.Ha(b)<f)return this.Kd=new a.wd(1,b,0),!1;return!0};d.prototype.xB=function(e){for(var f=this.U,b=f.Ca(),g=f.hasAttribute(1),f=g?a.Ia.rB(this.sg,f,!1):0;b.kb();)for(;b.La();){var c=b.ia();if(!(c.$b()>this.Ri)){if(e&&g){var n=c.gt(1,0),c=c.gt(1,0);if(Math.abs(c-n)>f)continue}this.Kd=new a.wd(2,b.Jb(),-1);return!1}}return!0};d.prototype.OK=function(){var f=
this.U,b=null;a.T.Kc(this.U.D())&&(b=this.U);var g=(this.GD||this.pk)&&null!=b,c=f.F();this.$e=f.mc(0);this.xh=new a.ga(0);this.xh.xb(2*c);this.wh=new a.ga(0);this.wh.xb(2*c);g&&(null==this.Bk&&(this.Bk=new a.ga(0)),this.Bk.xb(c));for(var d=f=0;d<c;d++)if(this.xh.add(2*d),this.xh.add(2*d+1),this.wh.add(2*d),this.wh.add(2*d+1),g){for(;d>=b.Dc(f);)f++;this.Bk.add(f)}(new a.Rr).sort(this.wh,0,2*c,new n(this,g));this.Za.clear();this.Za.Hn(new e(this));this.Za.de(c);b=0;for(c*=2;b<c;b++)if(g=this.wh.get(b),
f=this.xh.get(g),g=f>>1,0==(f&1)){f=this.Za.addElement(g,-1);d=this.Za.ge(f);if(-1!=d&&!this.Yy(this.Za.da(d),g))return this.Kd=new a.wd(3,g,this.Za.da(d)),!1;var m=this.Za.bb(f);if(-1!=m&&!this.Yy(this.Za.da(m),g))return this.Kd=new a.wd(3,g,this.Za.da(m)),!1}else if(f=this.Za.search(g,-1),d=this.Za.ge(f),m=this.Za.bb(f),this.Za.kd(f,-1),-1!=d&&-1!=m&&!this.Yy(this.Za.da(d),this.Za.da(m)))return this.Kd=new a.wd(3,this.Za.da(d),this.Za.da(m)),!1;return!0};d.prototype.RK=function(){return 10>this.U.F()?
this.PK():this.QK()};d.prototype.QK=function(){var e=new a.fd;e.Eb(this.U);var f=new a.wd;return a.Zu.DE(!1,e,this.Ri,f,this.oe)?(f.Fk=e.gb(f.Fk),f.Gk=e.gb(f.Gk),this.Kd.aq(f),!1):!0};d.prototype.PK=function(){for(var e=this.U,f=e.Ca(),e=e.Ca();f.kb();)for(;f.La();){var b=f.ia();if(!f.Jm()||!f.YO()){e.xR(f);do for(;e.La();){var g=e.ia(),g=b.fq(g,this.Ri,!0);if(0!=g)return this.Kd=new a.wd(2==g?5:4,f.Jb(),e.Jb()),!1}while(e.kb())}}return!0};d.prototype.UK=function(){var e=this.U;this.$a.length=0;this.dn.length=
0;this.Hf=e.Ca();this.Hf.NR();var f=new a.ga(0);f.xb(10);for(var b=NaN,g=0,c=0,e=2*e.F();c<e;c++){var n=this.wh.get(c),n=this.xh.get(n);if(0==(n&1)){var n=n>>1,d=this.$e.read(2*n),m=this.$e.read(2*n+1);if(0!=f.size&&(d!=b||m!=g)){if(!this.TE(f))return!1;null!=f&&f.clear(!1)}f.add(n);b=d;g=m}}return this.TE(f)?!0:!1};d.prototype.TK=function(){for(var e=this.U,f=Array(e.ea()),b=0,g=e.ea();b<g;b++)f[b]=e.Oo(b);var g=new c,n,d,m,k=new a.b,b=this.wh.get(0),b=this.xh.get(b),x=b>>1;this.$e.ec(2*x,k);b=this.Bk.get(x);
n=f[b];d=e.Ea(b);m=e.Dc(b)-1;g.ak=x==d||x==m;g.Ev=this.pk?!n&&g.ak:g.ak;g.Sh=b;g.x=k.x;g.y=k.y;g.yl=x;for(var h=new c,q=1,z=this.wh.size;q<z;q++)if(b=this.wh.get(q),b=this.xh.get(b),0==(b&1)){x=b>>1;this.$e.ec(2*x,k);b=this.Bk.get(x);b!=g.Sh&&(n=f[b],d=e.Ea(b),m=e.Dc(b)-1);var l,v=x==d||x==m;l=this.pk?!n&&g.ak:g.ak;h.x=k.x;h.y=k.y;h.Sh=b;h.yl=x;h.Ev=l;h.ak=v;if(h.x==g.x&&h.y==g.y)if(this.pk){if(!h.Ev||!g.Ev)if(h.Sh!=g.Sh||!h.ak&&!g.ak)return this.Kd=new a.wd(8,h.yl,g.yl),!1}else if(!h.ak||!g.ak)return this.Kd=
new a.wd(5,h.yl,g.yl),!1;b=g;g=h;h=b}return!0};d.prototype.AB=function(){for(var e=this.U,f=[],b=-1,c=!1,n=0,d=e.ea();n<d;n++)e.qt(n)&&(c=!1,b++,n<d-1&&(e.qt(n+1)||(c=!0))),f[n]=c?b:-1;var c=new a.b,n=this.wh.get(0),n=this.xh.get(n),m=n>>1;this.$e.ec(2*m,c);for(var n=this.Bk.get(m),b=new g(c.x,c.y,n,m,f[n]),e=[],k=1,d=this.wh.size;k<d;k++)if(n=this.wh.get(k),n=this.xh.get(n),0==(n&1)){m=n>>1;this.$e.ec(2*m,c);n=this.Bk.get(m);n=new g(c.x,c.y,n,m,f[n]);if(n.x==b.x&&n.y==b.y){if(n.Sh==b.Sh)return this.Kd=
new a.wd(9,n.yl,b.yl),!1;0<=f[n.Sh]&&f[n.Sh]==f[b.Sh]&&(0!=e.length&&e[e.length-1]==b||e.push(b),e.push(n))}b=n}if(0==e.length)return!0;n=new a.$n(!0);a.I.Ps(f,-1);c=-1;k=new a.b;k.Eh();b=0;for(d=e.length;b<d;b++){m=e[b];if(m.x!=k.x||m.y!=k.y)c=n.jh(0),k.x=m.x,k.y=m.y;var x=f[m.Sh];-1==x&&(x=n.jh(2),f[m.Sh]=x);n.addElement(x,c);n.addElement(c,x)}d=new a.ga(0);d.xb(10);for(b=n.Wd;-1!=b;b=n.Cw(b))if(e=n.DC(b),0==(e&1)&&0!=(e&2)){e=-1;d.add(b);for(d.add(-1);0<d.size;){c=d.tc();d.af();k=d.tc();d.af();
m=n.DC(k);if(0!=(m&1)){e=0==(m&2)?c:k;break}n.$R(k,m|1);for(m=n.gc(k);-1!=m;m=n.bb(m))x=n.getData(m),x!=c&&(d.add(x),d.add(k))}if(-1!=e){n=-1;b=0;for(d=f.length;b<d;b++)if(f[b]==e){n=b;break}this.Kd=new a.wd(10,n,-1);return!1}}return!0};d.prototype.VK=function(){var e=this.U;if(0>=e.Mh())return this.Kd=new a.wd(6,1==e.ea()?1:-1,-1),0;if(1==e.ea())return this.pk&&!this.AB()?0:2;this.gn=a.ga.Yc(e.ea(),0);this.Hx=a.ga.Yc(e.ea(),-1);for(var b=-1,g=0,c=0,n=e.ea();c<n;c++){var d=e.oo(c);this.gn.write(c,
0>d?0:256);if(0<d)b=c,g=d;else{if(0==d)return this.Kd=new a.wd(6,c,-1),0;if(0>b||g<Math.abs(d))if(this.Kd=new a.wd(7,c,-1),this.pk)return 0;this.Hx.write(c,b)}}this.kr=e.ea();this.Ll=new a.ga(0);this.Ll.xb(10);n=e.F();this.wn=NaN;e=new a.ga(0);e.xb(10);this.yp=a.ga.Yc(n,-1);this.hu=a.ga.Yc(n,-1);null!=this.Hi?this.Hi.clear(!1):this.Hi=new a.ga(0);this.Hi.xb(10);this.Za.clear();this.Za.Hn(new f(this));b=0;for(n*=2;0<this.kr&&b<n;b++)if(g=this.wh.get(b),g=this.xh.get(g),0==(g&1)){g>>=1;c=this.$e.read(2*
g+1);if(c!=this.wn&&0!=e.size){if(!this.yr(e))return 0;null!=e&&e.clear(!1)}e.add(g);this.wn=c}return 0<this.kr&&!this.yr(e)?0:this.pk?0==this.Kd.yh&&this.AB()?2:0:0==this.Kd.yh?2:1};d.prototype.TE=function(e){if(1==e.size)return!0;for(var f=0,b=e.size;f<b;f++){var g=e.get(f);this.Hf.Sb(g);var c=this.Hf.oi();this.$a.push(this.Ls(c,g,this.Hf.Qa,!0));this.Hf.ia();c=this.Hf.ia();this.$a.push(this.Ls(c,g,this.Hf.Qa,!1))}var n=this;this.$a.sort(function(a,e){return n.sM(a,e)});g=this.Lg.Wd;-1==g&&(g=this.Lg.jh(0));
this.Lg.$l(this.$a.length);f=0;for(b=this.$a.length;f<b;f++)this.Lg.addElement(g,f);for(var f=!0,d=b=-1;f;){f=!1;c=this.Lg.gc(g);if(-1==c)break;for(var m=this.Lg.bb(c);-1!=m;){b=this.Lg.getData(c);d=this.Lg.getData(m);b=this.$a[b].tn;d=this.$a[d].tn;if(b==d)if(f=!0,this.Lg.Jc(g,c),c=this.Lg.ge(m),m=this.Lg.Jc(g,m),-1==m||-1==c)break;else continue;c=m;m=this.Lg.bb(c)}}f=this.Lg.vq(g);this.Lg.CB(g);if(0<f)return this.Kd=new a.wd(5,b,d),!1;f=0;for(b=e.size;f<b;f++)this.my(this.$a[f]);this.$a.length=
0;return!0};d.prototype.yr=function(e){for(var f=0,b=e.size;f<b;f++){var g=e.get(f),c=this.yp.read(g);if(-1!=c){var n=this.Za.da(c);this.Hi.add(n);this.Za.kd(c,-1);this.my(this.$a[n]);this.$a[n]=null;this.yp.write(g,-1)}c=this.hu.read(g);-1!=c&&(n=this.Za.da(c),this.Hi.add(n),this.Za.kd(c,-1),this.my(this.$a[n]),this.$a[n]=null,this.hu.write(g,-1))}f=0;for(b=e.size;f<b;f++){g=e.get(f);this.Hf.Sb(g);c=this.Hf.oi();if(c.ja>c.ha){var d=this.Hf.Jb(),m=this.Ls(c,g,this.Hf.Qa,!0);0<this.Hi.size?(n=this.Hi.tc(),
this.Hi.af(),this.$a[n]=m):(n=this.$a.length,this.$a.push(m));c=this.Za.addElement(n,-1);-1==this.yp.read(d)?this.yp.write(d,c):this.hu.write(d,c);0==(this.gn.read(this.Hf.Qa)&3)&&this.Ll.add(c)}this.Hf.ia();c=this.Hf.ia();c.ja<c.ha&&(d=this.Hf.Bm(),m=this.Ls(c,g,this.Hf.Qa,!1),0<this.Hi.size?(n=this.Hi.tc(),this.Hi.af(),this.$a[n]=m):(n=this.$a.length,this.$a.push(m)),c=this.Za.addElement(n,-1),-1==this.yp.read(d)?this.yp.write(d,c):this.hu.write(d,c),0==(this.gn.read(this.Hf.Qa)&3)&&this.Ll.add(c))}f=
0;for(b=this.Ll.size;f<b&&0<this.kr;f++)if(c=this.Ll.get(f),0==(this.gn.read(this.$a[this.Za.da(c)].Gx)&3)){e=-1;for(var g=this.Za.ge(c),k=c,m=null,n=-1,x=0;-1!=g;){n=this.Za.da(g);m=this.$a[n];n=m.Gx;x=this.gn.read(n);if(0!=(x&3))break;k=g;g=this.Za.ge(g)}-1==g?(d=1,g=k):(e=1==(x&3)?n:this.Hx.read(n),d=0!=m.LC()?0:1,g=this.Za.bb(g));do{n=this.Za.da(g);m=this.$a[n];n=m.Gx;k=this.gn.read(n);if(0==(k&3)){if(d!=m.LC())return this.Kd=new a.wd(6,n,-1),!1;x=0==d||m.sl()?2:1;k=k&252|x;this.gn.write(n,x);
if(2==x&&0==this.Kd.yh&&this.Hx.read(n)!=e&&(this.Kd=new a.wd(7,n,-1),this.pk))return!1;this.kr--;if(0==this.kr)return!0}1==(k&3)&&(e=n);k=g;g=this.Za.bb(g);d=0!=d?0:1}while(k!=c)}null!=this.Ll?this.Ll.clear(!1):this.Ll=new a.ga(0);return!0};d.prototype.Ls=function(e,f,b,g){if(322==e.D())e=this.PL(e);else throw a.g.wa();e.tn=f;e.Gx=b;e.hp=0;e.hS(g);return e};d.prototype.PL=function(e){var f;0<this.dn.length?(f=this.dn[this.dn.length-1],--this.dn.length,e.copyTo(f.Zd)):(f=new b,f.Zd=a.fA.Yj(e));return f};
d.prototype.my=function(a){322==a.Zd.D()&&this.dn.push(a)};d.prototype.eQ=function(){for(var e=this.U.F(),f=new a.ga(0),b=0;b<e;b++)f.add(b);var g=this;f.xd(0,e,function(a,e){return g.Is(a,e)});for(b=1;b<e;b++)if(0==this.Is(f.get(b-1),f.get(b)))return this.Kd=new a.wd(3,f.get(b-1),f.get(b)),0;return 2};d.prototype.NQ=function(){return this.yB()?this.xB(!0)?2:0:0};d.prototype.LQ=function(){return this.Yw()};d.prototype.fQ=function(){for(var e=this.U.F(),f=new a.ga(0),b=0;b<e;b++)f.add(b);var g=this;
f.xd(0,e,function(a,e){return g.uL(a,e)});var c=Array(e);a.I.Ps(c,!1);c[f.get(0)]=!0;for(b=1;b<e;b++){var n=f.get(b-1),d=f.get(b);0==this.Is(n,d)?c[d]=!1:c[d]=!0}for(var f=this.U.Pa(),n=this.U,d=0,m=1,b=0;b<e;b++)c[b]?m=b+1:(d<m&&f.Pd(n,d,m),d=b+1);d<m&&f.Pd(n,d,m);f.hg(2,this.pn);return f};d.prototype.OQ=function(){var e=this.U,f=e.Ca(),b=e.Ca(),g=this.U.Pa(),c=this.U,n=e.hasAttribute(1),d=n?a.Ia.rB(this.sg,e,!0):0,m=new a.ga(0),k=new a.ga(0);m.xb(a.I.truncate(e.F()/2+1));for(k.xb(a.I.truncate(e.F()/
2+1));f.kb();)if(b.kb(),!(2>e.Ha(f.Qa))){b.zR();for(var x,h,q=!0;f.La();){var z=f.ia(),l=b.oi();if(f.Jb()>b.Jb())break;q&&(m.add(f.Jb()),k.add(b.Bm()),q=!1);h=m.tc();var v=f.Bm();if(1<v-h){var t=new a.b;t.pc(e.Fa(h),e.Fa(v));x=t.length()}else x=z.$b();h=k.tc();v=b.Jb();1<v-h?(t=new a.b,t.pc(e.Fa(h),e.Fa(v)),h=t.length()):h=l.$b();x>this.pn?m.add(f.Bm()):n&&(x=e.ld(1,m.tc(),0),z=z.Ws(1,0),Math.abs(z-x)>d&&m.add(f.Bm()));h>this.pn?k.add(b.Jb()):n&&(x=e.ld(1,k.tc(),0),z=l.Ws(1,0),Math.abs(z-x)>d&&k.add(b.Jb()))}m.tc()<
k.tc()?m.size>k.size?m.af():k.af():(m.tc()!=k.tc()&&k.af(),k.af());if(2<=k.size+m.size){q=new a.Va;l=0;for(z=m.size;l<z;l++)c.Sd(m.get(l),q),0==l?g.df(q):g.lineTo(q);for(l=k.size-1;0<l;l--)c.Sd(k.get(l),q),g.lineTo(q);c.vc(f.Qa)?g.ro():0<k.size&&(c.Sd(k.get(0),q),g.lineTo(q))}null!=m&&m.clear(!1);null!=k&&k.clear(!1)}g.hg(2,this.pn);return g};d.prototype.MQ=function(){return this.xS()};d.prototype.xS=function(){if(1736==this.U.D()&&1==this.U.Cm())return a.Of.Qj(this.U,this.pn,!0,!1,this.oe);this.Zh=
new a.fd;this.Zh.Eb(this.U);0!=this.Zh.pd&&(1!=this.yx&&a.aj.$(this.Zh,this.pn,this.oe,!0),1736==this.U.D()&&a.mm.$(this.Zh,this.Zh.$c,this.yx,!1,this.oe));this.U=this.Zh.hf(this.Zh.$c);1736==this.U.D()&&(this.U.hl(),this.U.Pp(0));this.U.hg(2,this.pn);return this.U};d.ac=function(e,f,b){if(e.s())return 1;var g=e.D();if(33==g)return 1;if(197==g)return b=new a.i,e.o(b),b.mg(a.Ia.Cg(f,e,!1))?0:1;if(a.T.Lc(g))throw a.g.wa();if(!a.T.Th(g))throw a.g.wa();var g=a.Ia.Cg(f,e,!1),c=e.rj(g);b=b?-1:c;if(-1!=
b)return b;1==b&&(g=0);b=(new d(e,f,b,0,!1)).Yw();e.hg(b,g);return b};d.Ro=function(e,f,b,g,c){null!=g&&(g.yh=0,g.Fk=-1,g.Gk=-1);if(e.s())return 1;var n=e.D();if(33==n)return 1;var m=a.Ia.Cg(f,e,!1);if(197==n)return f=new a.i,e.o(f),f.mg(m)?(null!=g&&(g.yh=2,g.Fk=-1,g.Gk=-1),0):1;if(a.T.Lc(n))return m=new a.Xa(e.description),m.Bc(e,!0),d.Ro(m,f,b,g,c);c=e.rj(m);b=b?-1:c;if(-1!=b)return b;f=new d(e,f,b,0,!1);if(550==n)b=f.eQ();else if(1607==n)b=f.NQ();else if(1736==n)b=f.LQ();else throw a.g.wa();e.hg(b,
m);null!=g&&0==b&&g.aq(f.Kd);return b};d.ob=function(e,f,b,g,c){null!=g&&(g.yh=0,g.Fk=-1,g.Gk=-1);if(e.s())return 1;var n=e.D();if(33==n)return 1;var m=a.Ia.Cg(f,e,!1);if(197==n)return f=new a.i,e.o(f),f.mg(m)?(null!=g&&(g.yh=2,g.Fk=-1,g.Gk=-1),0):1;if(a.T.Lc(n))return n=new a.Xa(e.description),n.Bc(e,!0),d.Ro(n,f,b,g,c);e=new d(e,f,-1,0,!0);if(550==n||1607==n||1736==n)f=e.Yw();else throw a.g.wa();null!=g&&g.aq(e.Kd);return f};d.cG=function(e,f,b,g){if(e.s())return e;var c=e.D();if(33==c)return e;
var n=a.Ia.Cg(f,e,!1);if(197==c)return f=new a.i,e.o(f),f.mg(n)?e.Pa():e;if(a.T.Lc(c))return c=new a.Xa(e.description),c.Bc(e,!0),d.cG(c,f,b,g);g=e.rj(n);b=b?-1:g;if(2==b)return e;e=new d(e,f,b,0,!1);if(550==c)e=e.fQ();else if(1607==c)e=e.OQ();else if(1736==c)e=e.MQ();else throw a.g.wa();return e};d.Ry=function(e,f,b,g){if(e.s())return e;var c=e.D();if(33==c)return e;var n=a.Ia.Cg(f,e,!1);if(197==c)return f=new a.i,e.o(f),f.mg(n)?e.Pa():e;if(a.T.Lc(c))return n=new a.Xa(e.description),n.Bc(e,!0),d.Ry(n,
f,b,g);if(!a.T.Th(c))throw a.g.ra("OGC simplify is not implemented for this geometry type "+c);return a.Of.Ry(e,n,!1,g)};d.prototype.kj=function(e,f,b){if(e==f)return 0;e=this.xh.get(e);var g=this.xh.get(f);f=e>>1;var c=g>>1,n=new a.b,d=new a.b;this.$e.ec(2*f,n);n.y+=0!=(e&1)?this.Ri:-this.Ri;this.$e.ec(2*c,d);d.y+=0!=(g&1)?this.Ri:-this.Ri;e=n.compare(d);return 0==e&&b?(b=this.Bk.get(f)-this.Bk.get(c),0>b?-1:0<b?1:0):e};d.prototype.Is=function(e,f){if(e==f)return 0;var b=this.U,g=b.Fa(e),c=b.Fa(f);
if(g.x<c.x)return-1;if(g.x>c.x)return 1;if(g.y<c.y)return-1;if(g.y>c.y)return 1;for(g=1;g<this.wP;g++)for(var c=this.SD.Hd(g),n=a.pa.Wa(c),d=0;d<n;d++){var m=b.ld(c,e,d),k=b.ld(c,f,d);if(m<k)return-1;if(m>k)return 1}return 0};d.prototype.uL=function(a,e){var f=this.Is(a,e);return 0==f?a<e?-1:1:f};d.prototype.sM=function(a,e){if(a===e)return 0;var f=a.Zd.Pf(a.sl()?1:0);a.sl()&&f.Bp();a=e.Zd.Pf(e.sl()?1:0);e.sl()&&a.Bp();e=f.ps();var b=a.ps();return b==e?(e=f.Ai(a),Math.abs(e)<=8.881784197001252E-16*
(Math.abs(a.x*f.y)+Math.abs(a.y*f.x))&&(e--,e++),0>e?1:0<e?-1:0):e<b?-1:1};return d}();a.cv=d})(E||(E={}));(function(a){var b=function(b){function g(){b.apply(this,arguments)}m(g,b);g.prototype.D=function(){return 30};g.local=function(){null===g.V&&(g.V=new g);return g.V};g.prototype.$=function(e,f,b,g){return e instanceof a.T?(e=new a.Pc(e),f=new a.Pc(f),this.$(e,f,b,g).next()):new a.hI(e,f,b,g)};g.On=function(e,f,b,c){var n=e.fb(),d=f.fb();if(e.s()&&f.s())return n>d?e:f;if(e.s())return f;if(f.s())return e;
var m=new a.i,k=new a.i,x=new a.i;e.o(m);f.o(k);x.K(m);x.Db(k);m=a.Ia.zd(b,x,!1);k=e.D();x=f.D();return 33==k&&33==x?g.qP(e,f,m):k!=x?0<n||0<d?n>d?e:f:550==k?g.pA(e,f,m):g.pA(f,e,m):a.Of.On(e,f,b,c)};g.qP=function(e,f,b){b=b*Math.sqrt(2)*1.00001;b*=b;var g=e.w(),c=f.w(),n=new a.pe(e.description);a.b.Zb(g,c)>b&&(n.add(e),n.add(f));return n};g.pA=function(e,f,b){var g=e.mc(0),c=e.F(),n=f.w(),d=e.Pa();b=b*Math.sqrt(2)*1.00001;var m=new a.i;e.o(m);m.P(b,b);if(m.contains(n)){b*=b;for(var m=!1,k=[],h=0;h<
c;h++)k[h]=!1;for(h=0;h<c;h++){var q=g.read(2*h),z=g.read(2*h+1),q=q-n.x,z=z-n.y;q*q+z*z<=b&&(m=!0,k[h]=!0)}if(m)for(h=0;h<c;h++)k[h]||d.Pd(e,h,h+1);else d.Pd(e,0,c),d.add(f)}else d.Pd(e,0,c),d.add(f);return d};g.V=null;return g}(a.Me);a.dv=b})(E||(E={}));(function(a){var b=function(){function b(a,e,f,b){this.Fq=null==e;this.ua=-1;this.ne=a;this.cg=f;this.QP=e.next();this.Yb=b}b.prototype.next=function(){if(this.Fq)return null;var b;return null!=(b=this.ne.next())?(this.ua=this.ne.ya(),a.dv.On(b,
this.QP,this.cg,this.Yb)):null};b.prototype.ya=function(){return this.ua};return b}();a.hI=b})(E||(E={}));(function(a){var b=function(){function a(){}a.prototype.jt=function(){this.iw=null;this.Vu=-1;this.xG=!1};return a}(),c=function(){function a(){this.jq=0;this.Ci=[]}a.prototype.TJ=function(a){this.jq+=a.Vu;this.Ci.push(a)};a.prototype.PQ=function(){this.jq-=this.Ci[this.Ci.length-1].Vu;--this.Ci.length};a.prototype.Dv=function(){return this.Ci[this.Ci.length-1]};a.prototype.lc=function(a){return a===
this};return a}(),g=function(){function e(a,e,b){this.ua=-1;this.Ec=!1;this.bE=[!1,!1,!1,!1];this.ep=[0,0,0,0];this.ox=!1;this.Gj=-1;this.So=0;this.Tm=-1;this.rn=[];this.ne=a;this.cg=e;this.Yb=b}e.ac=function(a){var e=[],f;for(f in a)e.push(Number(f));e.sort(function(a,e){return a-e});return e};e.prototype.UC=function(f){var b=this.rn[f],g=e.ac(b)[0],c=b[g],d=c.Dv().iw,c=c.Dv().xG;delete b[g];c&&(d=a.as.local().$(d,this.cg,!1,this.Yb),0==f&&33==d.D()&&(f=new a.pe(d.description),d.s()||f.add(d),d=
f));return d};e.prototype.next=function(){if(this.Ec&&this.Tm==this.Gj)return null;for(;!this.FS(););if(-1==this.Gj)return null;if(this.ox){for(this.Tm++;;){if(this.Tm>this.Gj||0>this.Tm)throw a.g.wa();if(this.bE[this.Tm])break}this.ua++;return this.UC(this.Tm)}this.ua=0;this.Tm=this.Gj;return this.UC(this.Gj)};e.prototype.ya=function(){return this.ua};e.prototype.FS=function(){if(this.Ec)return!0;var e=null;null!=this.ne&&(e=this.ne.next(),null==e&&(this.Ec=!0,this.ne=null));if(null!=e){var b=e.fb();
this.bE[b]=!0;b>=this.Gj&&!this.ox&&(this.SA(b,!1,e),b>this.Gj&&!this.ox&&this.vR(b))}if(0<this.So)for(b=0;b<=this.Gj;b++)for(;1<this.ep[b];)if(e=this.jL(b),0!=e.length)e=a.Of.oM(e,this.cg,this.Yb),this.SA(b,!0,e);else break;return this.Ec};e.prototype.jL=function(a){for(var f=[],b=[],g=this.rn[a],c=e.ac(g),d=0;d<c.length;d++){var m=c[d],k=g[m];if(this.Ec||1E4<k.jq&&1<k.Ci.length){this.ep[a]-=k.Ci.length;for(this.So-=k.Ci.length;0<k.Ci.length;)f.push(k.Dv().iw),k.PQ();b.push(m)}}for(d=0;d<b.length;d++)delete g[b[d]];
return f};e.prototype.vR=function(a){for(var e=0;e<a;e++)this.rn[e]=[],this.So-=this.ep[e],this.ep[e]=0};e.prototype.SA=function(a,g,d){var f=new b;f.jt();f.iw=d;d=e.$g(d);f.Vu=d;d=e.Wf(d);if(a+1>this.rn.length)for(var n=0,m=Math.max(2,a+1);n<m;n++)this.rn.push([]);n=this.rn[a][d];void 0===n&&(n=new c,this.rn[a][d]=n);f.xG=g;n.TJ(f);this.ep[a]++;this.So++;this.Gj=Math.max(this.Gj,a)};e.Wf=function(e){return 0<e?a.I.truncate(Math.log(e)/Math.log(4)+.5):0};e.$g=function(e){var f=e.D();if(a.T.Th(f))return e.F();
if(33==f)return 1;if(197==f)return 4;if(a.T.Lc(f))return 2;throw a.g.wa();};return e}();a.jI=g})(E||(E={}));(function(a){var b=function(b){function g(){b.apply(this,arguments)}m(g,b);g.prototype.D=function(){return 1};g.prototype.$=function(e,f,b,g){return void 0===g?new a.jI(e,f,b):this.xM(e,f,b,g)};g.prototype.xM=function(e,f,b,g){e=new a.Pc([e,f]);return this.$(e,b,g).next()};g.local=function(){null===g.V&&(g.V=new g);return g.V};g.V=null;return g}(a.Me);a.wi=b})(E||(E={}));(function(a){var b;
(function(a){a[a.nextPath=0]="nextPath";a[a.nextSegment=1]="nextSegment";a[a.iterate=2]="iterate"})(b||(b={}));b=function(){function b(b,e,f,c){this.dr=new a.i;this.LP=b;this.MP=e;this.Wo=c;this.hn=-1;this.qk=!1;var g=b.pb;null!=g&&(g=c?g.nn:g.Ab,null!=g&&(this.Ec=!1,this.ka=f,this.Ab=g,this.au=this.Ab.Re(),this.Xo=this.qk=!0,this.Hb=0,c?this.hn=e.ea():this.bd=e.Ca()));this.qk||(g=e.pb,null!=g&&(g=c?g.nn:g.Ab,null!=g&&(this.Ec=!1,this.ka=f,this.Ab=g,this.au=this.Ab.Re(),this.qk=!0,this.Xo=!1,this.Hb=
0,c?this.hn=b.ea():this.bd=b.Ca())));this.qk||(this.th=c?a.Ia.BN(b,e,f,1<=b.rj(0),1<=e.rj(0)):a.Ia.AN(b,e,f))}b.prototype.next=function(){if(this.qk){if(this.Ec)return!1;for(var b=!0;b;)switch(this.Hb){case 0:b=this.nQ();break;case 1:b=this.oQ();break;case 2:b=this.$w();break;default:throw a.g.ra("internal error");}return this.Ec?!1:!0}return null==this.th?!1:this.th.next()};b.prototype.jk=function(){return this.qk?this.Xo?this.Ab.da(this.Rq):this.Wo?this.hn:this.bd.Jb():this.th.jk(this.th.Ff)};b.prototype.ek=
function(){return this.qk?this.Xo?this.Wo?this.hn:this.bd.Jb():this.Ab.da(this.Rq):this.th.ek(this.th.mf)};b.prototype.Fw=function(){if(!this.Wo)throw a.g.ra("internal error");return this.qk?this.Xo?this.Ab.uC(this.Rq):this.dr:this.th.Fw(this.th.Ff)};b.prototype.jw=function(){if(!this.Wo)throw a.g.ra("internal error");return this.qk?this.Xo?this.dr:this.Ab.uC(this.Rq):this.th.jw(this.th.mf)};b.prototype.nQ=function(){if(!this.Wo){if(!this.bd.kb())return this.Ec=!0,!1;this.Hb=1;return!0}if(-1==--this.hn)return this.Ec=
!0,!1;this.Xo?this.MP.Ti(this.hn,this.dr):this.LP.Ti(this.hn,this.dr);this.au.Ch(this.dr,this.ka);this.Hb=2;return!0};b.prototype.oQ=function(){if(!this.bd.La())return this.Hb=0,!0;var a=this.bd.ia();this.au.Fn(a,this.ka);this.Hb=2;return!0};b.prototype.$w=function(){this.Rq=this.au.next();return-1==this.Rq?(this.Hb=this.Wo?0:1,!0):!1};return b}();a.cl=b})(E||(E={}));(function(a){a=a.kI||(a.kI={});a[a.enumClosed=1]="enumClosed";a[a.enumHasNonlinearSegments=2]="enumHasNonlinearSegments";a[a.enumOGCStartPolygon=
4]="enumOGCStartPolygon";a[a.enumCalcMask=4]="enumCalcMask"})(E||(E={}));(function(a){var b=function(){function b(){}b.Fb=function(g,e,f,c,d,m,k,h,q){var n=[0,0,0],x=[0,0,0],l=[0,0,0],z=[0,0,0,0],v=new a.ca(0),t=new a.ca(0),y=new a.ca(0);if(null!=k||null!=h||null!=q)if(a.j.Ih(e))a.zg.Fb(g,f,c,d,m,k,h,q);else{d=a.u.W(d);f=a.u.W(f);var I=a.u.W(d-f);if(a.j.S(c,m)&&(a.j.S(f,d)||a.j.S(a.j.H(c),1.570796326794897)))null!=k&&(k.l=0),null!=h&&(h.l=0),null!=q&&(q.l=0);else{if(a.j.S(c,-m)){if(a.j.S(a.j.H(c),
1.570796326794897)){null!=k&&(k.l=2*a.u.gg(g,e));null!=h&&(h.l=0<c?a.u.W(3.141592653589793-a.u.W(d)):a.u.W(d));null!=q&&(q.l=0<c?a.u.W(d):a.u.W(3.141592653589793-a.u.W(d)));return}a.j.S(a.j.H(I),3.141592653589793)&&(null!=k&&(k.l=2*a.u.gg(g,e)),null!=h&&(h.l=0),null!=q&&(q.l=0))}else{if(a.j.S(a.j.H(c),1.570796326794897)||a.j.S(a.j.H(m),1.570796326794897)){a.Xj.Fb(g,e,f,c,d,m,k,h,q);return}if(a.j.S(f,d)||a.j.S(a.j.H(I),3.141592653589793)){a.Xj.Fb(g,e,f,c,d,m,k,h,q);return}if(a.j.Vc(c)){a.Xj.Fb(g,e,
f,c,d,m,k,h,q);return}}var r=Math.sqrt(1-e);d=a.u.W(d-f);f=0;a.u.wm(e,c,f,v,t,y);n[0]=v.l;n[1]=t.l;n[2]=y.l;a.u.wm(e,m,d,v,t,y);x[0]=v.l;x[1]=t.l;x[2]=y.l;l[0]=0;l[1]=0;l[2]=-1*e*a.u.n(1,e,c)*Math.sin(c);0>d?a.u.Ep(l,x,n,z,0):a.u.Ep(l,n,x,z,0);for(var t=[0,0,0],y=[0,0,0],B=[0,0,0],n=[0,0,0],v=[0,0,0],E=Math.acos(z[2]/1),u=1-e,C=Math.tan(E),D=1+C*C/u,L=2*l[2]*C/u,C=Math.sqrt(L*L-4*D*(l[2]*l[2]/u-1)),D=2*D,u=(-L+C)/D,L=(-L-C)/D,C=Math.tan(E),D=C*u+l[2],E=(u+L)/2,l=(D+(C*L+l[2]))/2,C=a.u.Sn(u-E,D-l),
u=l/r*1.570796326794897,L=0;100>L;L++){D=a.u.Tk(e,u);D=D*D/Math.cos(u)*(Math.sin(u)-l*D/(1*(1-e)));if(a.j.Vc(D))break;u-=D}var l=a.u.n(1,e,u)*Math.cos(u),l=Math.sqrt((l-E)*(l+E)),C=1-C/l,C=C*(2-C),D=a.u.jm(t),E=a.u.jm(y),u=a.u.jm(B),G=a.u.Qr(B,t),L=a.u.Qr(B,y);a.u.Uu(B,t,n);a.u.Uu(B,y,v);t=Math.acos(G/(u*D));y=Math.acos(L/(u*E));y*=a.j.nb(1,a.u.Qr(n,v));if(1.570796326794897<=a.j.H(t)&&1.570796326794897<=a.j.H(y)||3.141592653589793<a.j.H(t-y))t=(3.141592653589793-a.j.H(t))*a.j.nb(1,t),y=(3.141592653589793-
a.j.H(y))*a.j.nb(1,y);n=a.u.Si(C,y);v=a.u.q(l,C,a.u.Si(C,t));n=a.u.q(l,C,n);n=a.j.H(n-v)*g;t=new a.ca(0);y=new a.ca(0);B=z[1]/1;B*=-a.j.nb(1,I);v=Math.acos(B)*a.j.nb(1,I);b.gf(g,e,f,c,n,v,t,y);a.j.S(d,t.l)&&a.j.S(m,y.l)||(C=a.u.Sn(a.u.W(d-t.l),m-y.l),b.gf(g,e,f,c,n,a.u.W(v+3.141592653589793),t,y),D=a.u.Sn(a.u.W(d-t.l),m-y.l),D<C&&(v=a.u.W(v+3.141592653589793)));t=[0,0,0,0];y=[0,0,0,0];l=[0,0,0];C=[0,0,0];g=[0,0,0];f=[0,0,0];c=[0,0,0];B=[0,0,0];l[0]=0;l[1]=0;l[2]=r;C[0]=0;C[1]=0;C[2]=0;a.u.Ep(C,l,
x,t,0);a.j.Vc(m)?(g[0]=x[0],g[1]=x[1],g[2]=1,f[0]=1*Math.cos(d)-1*Math.sin(d),f[1]=1*Math.sin(d)+1*Math.cos(d)):(e=a.u.n(1,e,m)*Math.cos(m),g[0]=0,g[1]=0,x[2]+=Math.tan(1.570796326794897-a.j.H(m))*e*a.j.nb(1,m),f[0]=e*Math.cos(d)-e*Math.sin(d),f[1]=e*Math.sin(d)+e*Math.cos(d));f[2]=x[2];a.u.Ep(x,f,g,y,1);a.u.Uu(y,t,c);a.u.Uu(y,z,B);B=a.u.Qr(c,B)/(a.u.jm(c)*a.u.jm(B));B*=a.j.nb(1,I);d=Math.acos(B)*-a.j.nb(1,I);0<v&&0<d?d=a.u.W(d+3.141592653589793):0>v&&0>d&&(d=a.u.W(d+3.141592653589793));null!=k&&
(k.l=n);null!=h&&(h.l=v);null!=q&&(q.l=d)}}};b.gf=function(b,e,f,c,d,m,k,h){var g=[0,0,0],n=[0,0,0],x=[0,0,0],q=[0,0,0],l=[0,0,0],z=[0,0,0],v=[0,0,0],t=[0,0,0,0],y=new a.ca(0),I=new a.ca(0),r=new a.ca(0),B=new a.ca(0),E=new a.ca(0),u=new a.ca(0);if(null!=k&&null!=h)if(a.j.Ih(e))a.zg.gf(b,f,c,d,m,k,h);else if(a.j.Vc(d))null!=k&&(k.l=f),null!=h&&(h.l=c);else if(m=a.u.W(m),0>d&&(d=a.j.H(d),m=a.u.W(m+3.141592653589793)),f=a.u.W(f),c=a.u.W(c),1.570796326794897<a.j.H(c)&&(f=a.u.W(f+3.141592653589793),c=
a.j.nb(3.141592653589793,c)-c),a.j.S(a.j.H(c),1.570796326794897)||a.j.Vc(c)||a.j.Vc(m)||a.j.S(a.j.H(m),3.141592653589793))a.Xj.gf(b,e,f,c,d,m,k,h);else{var C=Math.sqrt(1-e);b=d/b;a.u.wm(e,c,0,B,E,u);g[0]=B.l;g[1]=E.l;g[2]=E.l;v[0]=0;v[1]=0;v[2]=-1*e*a.u.n(1,e,c)*Math.sin(c);B=a.u.n(1,e,c);E=a.u.W(1.570796326794897-m);u=Math.sin(E);d=Math.cos(c);c=Math.sin(c);l[0]=B*d-c*u;l[1]=Math.cos(E);l[2]=(1-e)*B*c+d*u;0>m?a.u.Ep(v,l,g,t,0):a.u.Ep(v,g,l,t,0);g=Math.acos(t[2]/1);t=Math.atan2(-t[1],-t[0]);c=1-e;
l=Math.tan(g);E=1+l*l/c;B=2*v[2]*l/c;l=Math.sqrt(B*B-4*E*(v[2]*v[2]/c-1));E*=2;c=(-B+l)/E;B=(-B-l)/E;l=Math.tan(g);E=l*c+v[2];g=(c+B)/2;v=(E+(l*B+v[2]))/2;l=a.u.Sn(c-g,E-v);C=v/C*1.570796326794897;for(c=0;100>c;c++){B=a.u.Tk(e,C);B=B*B/Math.cos(C)*(Math.sin(C)-v*B/(1*(1-e)));if(a.j.Vc(B))break;C-=B}C=a.u.n(1,e,C)*Math.cos(C);C=Math.sqrt((C-g)*(C+g));v=1-l/C;v*=2-v;z=Math.acos(a.u.Qr(z,n)/(a.u.jm(z)*a.u.jm(n)));z*=a.j.nb(1,n[0]);m=(a.u.q(C,v,a.u.Si(v,z))+b*a.j.nb(1,m))/a.u.gg(C,v);m=a.u.W(1.570796326794897*
m);m=a.u.xn(v,m);a.u.n(C,v,m);l=a.u.W(t+f);f=Math.cos(l);m=Math.sin(l);x[0]=q[0]*f+q[1]*-m;x[1]=q[0]*m+q[1]*f;x[2]=q[2];a.u.JK(e,x[0],x[1],x[2],r,I,y);null!=k&&(k.l=I.l);null!=h&&(h.l=r.l)}};return b}();a.$z=b})(E||(E={}));(function(a){var b=function(){function e(e){this.Na=null;this.Ar=new a.b;this.Br=new a.b;this.a=e}e.prototype.compare=function(a,e,f){this.a.uc(e,this.Ar);this.a.uc(a.da(f),this.Br);return this.Ar.compare(this.Br)};return e}(),c=function(){function e(e){this.nf=new a.b;this.ln=
new a.b;this.a=e}e.prototype.bh=function(a){this.nf.J(a)};e.prototype.compare=function(a,e){this.a.uc(a.da(e),this.ln);return this.nf.compare(this.ln)};return e}(),g=function(a){function e(e){a.call(this,e.a,e.ka,!1);this.ab=e}m(e,a);e.prototype.compare=function(a,e,f){if(this.Zf)return-1;var b=this.ab.Cd.Dm(this.ab.lh(e));a=a.da(f);var g=this.ab.Cd.Dm(this.ab.lh(a));this.Cl=f;return this.JB(e,b,a,g)};return e}(a.hA),e=function(a){function e(e){a.call(this,e.a,e.ka);this.ab=e}m(e,a);e.prototype.compare=
function(a,e){if(this.Zf)return-1;a=this.ab.Cd.Dm(this.ab.lh(a.da(e)));this.Cl=e;return this.KB(e,a)};return e}(a.JI),f=function(){function f(){this.zc=this.Ue=this.Zm=this.Cd=this.Kg=this.nd=this.$a=this.a=null;this.og=!1;this.Xg=this.Kl=this.Vd=this.Lj=this.Mg=this.Hj=this.sf=this.Ld=null;this.Yg=this.rp=this.Tx=this.ka=0;this.Ht=this.Nm=!1;this.mn=new a.b;this.Ck=new a.b;this.$a=new a.Fc(8);this.nd=new a.Fc(5);this.Kg=new a.Ur;this.Cd=new a.Ur;this.og=!1;this.Xg=new a.b;this.Xg.ma(0,0);this.ka=
0;this.Yg=-1;this.Nm=!1;this.a=null;this.Ue=new a.bj;this.zc=new a.bj;this.Mg=new a.ga(0);this.Lj=new a.gA;this.sf=new a.ga(0);this.Hj=new a.ga(0);this.Zm=new a.Va}f.prototype.GS=function(e,f){var b=new a.Bg;b.Oy();e.Oe(b);this.Op(e);this.Nm=!1;this.ka=f;this.Tx=f*f;f=this.Xy();e.Oe(b);f||(this.JM(),f||this.Xy());-1!=this.Yg&&(this.a.bf(this.Yg),this.Yg=-1);this.a=null;return this.Nm};f.prototype.KS=function(a,e){this.Op(a);this.Nm=!1;this.ka=e;this.Tx=e*e;this.og=!1;this.Xy();this.og||(this.og=1==
a.xo(e,!0,!1));-1!=this.Yg&&(this.a.bf(this.Yg),this.Yg=-1);this.a=null};f.prototype.Uf=function(a,e){return this.$a.O(a,0+e)};f.prototype.zy=function(a,e,f){this.$a.L(a,0+e,f)};f.prototype.lh=function(a){return this.$a.O(a,2)};f.prototype.UR=function(a,e){this.$a.L(a,2,e)};f.prototype.FC=function(a,e){return this.$a.O(a,3+e)};f.prototype.Eo=function(a){return this.$a.O(a,7)};f.prototype.Nk=function(a,e){this.$a.L(a,7,e)};f.prototype.Go=function(a,e){return this.$a.O(a,3+this.Do(a,e))};f.prototype.Qp=
function(a,e,f){this.$a.L(a,3+this.Do(a,e),f)};f.prototype.ZN=function(a,e){return this.$a.O(a,5+this.Do(a,e))};f.prototype.Sp=function(a,e,f){this.$a.L(a,5+this.Do(a,e),f)};f.prototype.rq=function(a){return this.nd.O(a,0)};f.prototype.RR=function(a,e){this.nd.L(a,0,e)};f.prototype.ow=function(a){return this.nd.O(a,4)};f.prototype.Lp=function(a,e){this.nd.L(a,4,e)};f.prototype.fk=function(a){return this.nd.O(a,1)};f.prototype.dm=function(a,e){this.nd.L(a,1,e)};f.prototype.nw=function(a){return this.nd.O(a,
3)};f.prototype.Hr=function(a,e){this.nd.L(a,3,e)};f.prototype.Ul=function(a){var e=this.nd.be(),f=this.Kg.jh();this.RR(e,f);-1!=a?(this.Kg.addElement(f,a),this.a.lb(a,this.Yg,e),this.Lp(e,this.a.gb(a))):this.Lp(e,-1);return e};f.prototype.aM=function(a){this.nd.Jc(a)};f.prototype.QA=function(a,e){this.Kg.addElement(this.rq(a),e);this.a.lb(e,this.Yg,a)};f.prototype.rr=function(a){var e=this.$a.be(),f=this.Cd.jh();this.UR(e,f);-1!=a&&this.Cd.addElement(f,a);return e};f.prototype.RA=function(a,e){this.Cd.addElement(this.lh(a),
e)};f.prototype.Ns=function(a){this.$a.Jc(a);a=this.Mg.Qs(a);0<=a&&this.Mg.QE(a)};f.prototype.yi=function(e,f){if(-1==this.Uf(e,0))this.zy(e,0,f);else if(-1==this.Uf(e,1))this.zy(e,1,f);else throw a.g.wa();this.Av(e,f)};f.prototype.Av=function(a,e){var f=this.fk(e);if(-1!=f){var b=this.Go(f,e);this.Sp(b,e,a);this.Qp(a,e,b);this.Qp(f,e,a);this.Sp(a,e,f)}else this.Sp(a,e,a),this.Qp(a,e,a),this.dm(e,a)};f.prototype.Do=function(a,e){return this.Uf(a,0)==e?0:1};f.prototype.Tl=function(a,e){var f=this.nw(e);
-1!=f&&(this.Ue.kd(f,-1),this.Hr(e,-1));var b,f=this.fk(e);if(-1!=f){var g=b=f,c;do{c=!1;var n=this.Do(b,e),d=this.FC(b,n);if(this.Uf(b,n+1&1)==a){this.Os(b);this.Cd.Fg(this.lh(b));this.Ns(b);if(b==d){f=-1;break}f==b&&(f=this.fk(e),g=d,c=!0)}b=d}while(b!=g||c);if(-1!=f){do n=this.Do(b,e),d=this.FC(b,n),this.zy(b,n,a),b=d;while(b!=g);b=this.fk(a);-1!=b?(g=this.Go(b,a),c=this.Go(f,a),g==b?(this.dm(a,f),this.Av(b,a),this.dm(a,b)):c==f&&this.Av(f,a),this.Qp(f,a,g),this.Sp(g,a,f),this.Qp(b,a,c),this.Sp(c,
a,b)):this.dm(a,f)}}f=this.rq(a);b=this.rq(e);for(g=this.Kg.gc(b);-1!=g;g=this.Kg.bb(g))this.a.lb(this.Kg.da(g),this.Yg,a);this.Kg.Qv(f,b);this.aM(e)};f.prototype.YP=function(a,e){var f=this.Uf(a,0),b=this.Uf(a,1),g=this.Uf(e,0),c=this.Uf(e,1);this.Cd.Qv(this.lh(a),this.lh(e));e==this.fk(f)&&this.dm(f,a);e==this.fk(b)&&this.dm(b,a);this.Os(e);this.Ns(e);f==g&&b==c||b==g&&f==c||(this.zm(f,this.mn),this.zm(g,this.Ck),this.mn.ub(this.Ck)?(f!=g&&this.Tl(f,g),b!=c&&this.Tl(b,c)):(b!=g&&this.Tl(b,g),f!=
c&&this.Tl(f,c)))};f.prototype.Os=function(a){var e=this.Uf(a,1);this.SB(a,this.Uf(a,0));this.SB(a,e)};f.prototype.SB=function(a,e){var f=this.Go(a,e),b=this.ZN(a,e),g=this.fk(e);f!=a?(this.Qp(b,e,f),this.Sp(f,e,b),g==a&&this.dm(e,f)):this.dm(e,-1)};f.prototype.YA=function(a,e,f){var b=this.Cd.gc(a),g=this.Cd.da(b);a=this.se(g);var c=this.se(this.a.X(g));this.a.Tp(g,e,f,!0);for(b=this.Cd.bb(b);-1!=b;b=this.Cd.bb(b)){var g=this.Cd.da(b),n=this.se(g)==a;this.a.Tp(g,e,f,n)}b=e.Io(f,0).Mb();e=e.Io(f,
e.kk(f)-1).oc();this.yG(a,b);this.yG(c,e)};f.prototype.PB=function(a,e,f){var b=this.lh(a),g=this.Uf(a,0),c=this.Uf(a,1),n=this.rr(-1);this.Mg.add(n);this.Nk(n,-3);this.sf.add(n);this.yi(n,g);a=1;for(e=e.kk(f);a<e;a++)f=this.Ul(-1),this.Hj.add(f),this.sf.add(f),this.yi(n,f),n=this.rr(-1),this.Mg.add(n),this.Nk(n,-3),this.sf.add(n),this.yi(n,f);this.yi(n,c);for(b=this.Cd.gc(b);-1!=b;b=this.Cd.bb(b))if(c=this.Cd.da(b),this.se(c)==g){a=0;do 0<a&&(n=this.sf.get(a-1),this.QA(n,c),-1==this.ow(n)&&this.Lp(n,
this.a.gb(c))),n=this.sf.get(a),a+=2,this.RA(n,c),c=this.a.X(c);while(a<this.sf.size)}else{a=this.sf.size-1;do a<this.sf.size-2&&(n=this.sf.get(a+1),this.QA(n,c),0>this.ow(n)&&this.Lp(n,this.a.gb(c))),n=this.sf.get(a),a-=2,this.RA(n,c),c=this.a.X(c);while(0<=a)}this.sf.clear(!1)};f.prototype.se=function(a){return this.a.Ra(a,this.Yg)};f.prototype.UE=function(e,f,b){var g=this.Uf(f,0),c=new a.b;this.zm(g,c);var n=new a.b,d=this.Uf(f,1);this.zm(d,n);var m=b.kk(e),k=b.Io(e,0),h=new a.b;k.ht(h);if(!c.ub(h)){if(!this.og){var x=
c.compare(this.Xg),h=h.compare(this.Xg);0>x*h&&(this.og=!0)}this.lC(g,this.sf);this.Hj.add(g)}!this.og&&1<m&&(x=c.compare(n),k=k.oc(),c.compare(k)!=x||k.compare(n)!=x?this.og=!0:0>k.compare(this.Xg)&&(this.og=!0));k=b.Io(e,m-1);e=k.oc();n.ub(e)||(this.og||(x=n.compare(this.Xg),h=e.compare(this.Xg),0>x*h&&(this.og=!0)),this.lC(d,this.sf),this.Hj.add(d));this.sf.add(f);n=0;for(d=this.sf.size;n<d;n++)e=this.sf.get(n),b=this.Eo(e),a.Fc.Zw(b)&&(this.zc.kd(b,-1),this.Nk(e,-1)),e!=f&&-3!=this.Eo(e)&&(this.Mg.add(e),
this.Nk(e,-3));this.sf.clear(!1)};f.prototype.NK=function(a,e){this.Ld.compare(this.zc,this.zc.da(a),e);this.Ld.Zf&&(this.Ld.lq(),this.dC(a,e))};f.prototype.dC=function(e,f){this.Nm=!0;e=this.zc.da(e);f=this.zc.da(f);var b,g;g=this.Cd.Dm(this.lh(e));var c=this.Cd.Dm(this.lh(f));b=this.a.cc(g);null==b&&(null==this.Vd&&(this.Vd=new a.yb),this.a.Oc(g,this.Vd),b=this.Vd);g=this.a.cc(c);null==g&&(null==this.Kl&&(this.Kl=new a.yb),this.a.Oc(c,this.Kl),g=this.Kl);this.Lj.zn(b);this.Lj.zn(g);this.Lj.Ga(this.ka,
!0)&&(this.og=!0);this.fG(e,f,-1,this.Lj);this.Lj.clear()};f.prototype.VM=function(e,f){this.Nm=!0;f=this.zc.da(f);var b,g=this.Cd.Dm(this.lh(f));b=this.a.cc(g);null==b&&(null==this.Vd&&(this.Vd=new a.yb),this.a.Oc(g,this.Vd),b=this.Vd);g=this.qC(e);this.Lj.zn(b);this.a.Jk(g,this.Zm);this.Lj.Tw(this.ka,this.Zm,!0);this.fG(f,-1,e,this.Lj);this.Lj.clear()};f.prototype.DO=function(){if(0!=this.Mg.size)for(;0!=this.Mg.size;){if(this.Mg.size>Math.max(100,this.a.pd)){this.Mg.clear(!1);this.og=!0;break}var a=
this.Mg.tc();this.Mg.af();this.Nk(a,-1);-1!=this.TO(a)&&this.CO(a);this.Mm=!1}};f.prototype.CO=function(a){var e;this.Mm?(e=this.zc.vs(this.lE,this.iE,a,!0),this.Mm=!1):e=this.zc.PA(a);-1==e?this.YP(this.zc.da(this.zc.tC()),a):(this.Nk(a,e),this.Ld.Zf&&(this.Ld.lq(),this.dC(this.Ld.Cl,e)))};f.prototype.TO=function(e){var f=this.Uf(e,0);e=this.Uf(e,1);this.zm(f,this.mn);this.zm(e,this.Ck);if(a.b.Zb(this.mn,this.Ck)<=this.Tx)return this.og=!0,-1;var b=this.mn.compare(this.Xg),g=this.Ck.compare(this.Xg);
return 0>=b&&0<g?e:0>=g&&0<b?f:-1};f.prototype.HM=function(){var e=new a.ga(0);e.xb(this.a.pd);for(var f=this.a.Gp(),b=f.next();-1!=b;b=f.next())-1!=this.a.Ra(b,this.Yg)&&e.add(b);this.a.Mu(e,e.size);this.IM(e)};f.prototype.IM=function(e){this.Ue.clear();this.Ue.de(e.size);this.Ue.Hn(new b(this.a));var f=new a.b;f.Eh();for(var g=-1,c=new a.b,n=0,d=e.size;n<d;n++){var m=e.get(n);this.a.uc(m,c);c.ub(f)?(m=this.a.Ra(m,this.Yg),this.Tl(g,m)):(g=this.se(m),this.a.uc(m,f),m=this.Ue.qm(m),this.Hr(g,m))}};
f.prototype.JM=function(){var e=new a.ga(0);e.xb(this.a.pd);for(var f=this.Ue.gc(-1);-1!=f;f=this.Ue.bb(f))e.add(this.Ue.da(f));this.Ue.clear();this.a.Mu(e,e.size);for(var f=0,b=e.size;f<b;f++){var g=e.get(f),c=this.se(g),g=this.Ue.qm(g);this.Hr(c,g)}};f.prototype.lC=function(e,f){var b=this.fk(e);if(-1!=b){var g=b;do a.Fc.Zw(this.Eo(g))&&f.add(g),g=this.Go(g,e);while(g!=b)}};f.prototype.yG=function(a,e){for(a=this.Kg.gc(this.rq(a));-1!=a;a=this.Kg.bb(a))this.a.Yi(this.Kg.da(a),e)};f.prototype.fG=
function(a,e,f,b){this.Os(a);-1!=e&&this.Os(e);this.UE(0,a,b);-1!=e&&this.UE(1,e,b);-1!=f&&(b.nf.w(this.mn),this.zm(f,this.Ck),this.Ck.ub(this.mn)||this.Hj.add(f));f=0;for(var g=this.Hj.size;f<g;f++){var c=this.Hj.get(f),n=this.nw(c);-1!=n&&(this.Ue.kd(n,-1),this.Hr(c,-1))}f=this.lh(a);g=-1!=e?this.lh(e):-1;this.YA(f,b,0);-1!=e&&this.YA(g,b,1);this.PB(a,b,0);-1!=e&&this.PB(e,b,1);this.Cd.Fg(f);this.Ns(a);-1!=e&&(this.Cd.Fg(g),this.Ns(e));f=0;for(g=this.Hj.size;f<g;f++)c=this.Hj.get(f),c==this.rp&&
(this.Ht=!0),n=this.nw(c),-1==n&&(n=this.Ue.PA(this.qC(c)),-1==n?(a=this.se(this.Ue.da(this.Ue.tC())),this.Tl(a,c)):this.Hr(c,n));this.Hj.clear(!1)};f.prototype.zm=function(a,e){this.a.SC(this.ow(a),e)};f.prototype.qC=function(a){return this.Kg.Dm(this.rq(a))};f.prototype.Xy=function(){this.Ht=!1;this.rp=-1;null==this.Ld&&(this.zc.Ct=!1,this.Ld=new g(this),this.zc.Qm=this.Ld);var f=new a.ga(0),b=null,n=null,d=0;this.iE=this.lE=-1;this.Mm=!1;for(var m=this.Ue.gc(-1);-1!=m;){d++;this.Mm=!1;var k=this.Ue.da(m);
this.rp=this.se(k);this.a.uc(k,this.Xg);this.Ld.XF(this.Xg.y,this.Xg.x);var h,q=this.fk(this.rp);h=-1==q;if(!h){k=q;do{var l=this.Eo(k);-1==l?(this.Mg.add(k),this.Nk(k,-3)):-3!=l&&f.add(l);k=this.Go(k,this.rp)}while(k!=q)}if(0<f.size){this.Mm=1==f.size&&1==this.Mg.size;h=0;for(q=f.size;h<q;h++)k=this.zc.da(f.get(h)),this.Nk(k,-2);var v=-2,z=-2;h=0;for(q=f.size;h<q;h++){l=f.get(h);if(-2==v){var t=this.zc.ge(l);-1!=t?(k=this.zc.da(t),k=this.Eo(k),-2!=k&&(v=t)):v=-1}-2==z&&(l=this.zc.bb(l),-1!=l?(k=
this.zc.da(l),k=this.Eo(k),-2!=k&&(z=l)):z=-1);if(-2!=v&&-2!=z)break}h=0;for(q=f.size;h<q;h++)l=f.get(h),k=this.zc.da(l),this.zc.kd(l,-1),this.Nk(k,-1);f.clear(!1);this.lE=-1!=v?v:-1;this.iE=-1!=z?z:-1;-1!=v&&-1!=z?this.Mm||this.NK(v,z):-1==v&&-1==z&&(this.Mm=!1)}else h&&(null==b&&(b=new e(this)),b.bh(this.Xg),this.zc.sF(b),b.Zf&&(b.lq(),this.VM(this.rp,b.Cl)));this.DO();this.Ht?(this.Ht=!1,null==n&&(n=new c(this.a)),n.bh(this.Xg),m=this.Ue.sF(n)):m=this.Ue.bb(m)}return this.Nm};f.prototype.Op=function(e){this.a=
e;this.Yg=this.a.re();this.$a.de(e.pd+32);this.nd.de(e.pd);this.Kg.Dr(e.pd);this.Kg.$l(e.pd);this.Cd.Dr(e.pd+32);this.Cd.$l(e.pd+32);for(e=this.a.$c;-1!=e;e=this.a.we(e))if(a.T.Kc(this.a.Lb(e)))for(m=this.a.Vb(e);-1!=m;m=this.a.bc(m)){var f=this.a.Ha(m),b=this.a.Cb(m),g=this.Ul(b),c=this.rr(b);this.yi(c,g);k=this.a.X(b);b=0;for(f-=2;b<f;b++){var n=this.a.X(k),d=this.Ul(k);this.yi(c,d);c=this.rr(k);this.yi(c,d);k=n}this.a.vc(m)?(d=this.Ul(k),this.yi(c,d),c=this.rr(k),this.yi(c,d),this.yi(c,g)):(d=
this.Ul(k),this.yi(c,d))}else for(var m=this.a.Vb(e);-1!=m;m=this.a.bc(m))for(var k=this.a.Cb(m),g=0,f=this.a.Ha(m);g<f;g++)this.Ul(k),k=this.a.X(k);this.HM()};return f}();a.aA=f})(E||(E={}));(function(a){var b=function(b){function g(e,f,g){b.call(this);if(void 0!==e)if(void 0!==g){this.description=a.Od.Tf();var c=new a.ee;c.K(e,f,g);this.Py(c)}else if(void 0!==f)this.description=a.Od.Tf(),this.ic(e,f);else if(e instanceof a.pa)this.description=e;else if(e instanceof a.b)this.description=a.Od.Tf(),
this.ic(e);else throw a.g.N();else this.description=a.Od.Tf()}m(g,b);g.prototype.w=function(e){if(void 0!==e){if(this.sc())throw a.g.ra("This operation should not be performed on an empty geometry.");e.ma(this.fa[0],this.fa[1])}else{if(this.sc())throw a.g.ra("This operation should not be performed on an empty geometry.");e=new a.b;e.ma(this.fa[0],this.fa[1]);return e}};g.prototype.ic=function(a,f){"number"===typeof a?(this.qc(),null==this.fa&&this.ko(),this.fa[0]=a,this.fa[1]=f):(this.qc(),this.ic(a.x,
a.y))};g.prototype.Lw=function(){if(this.sc())throw a.g.ra("This operation should not be performed on an empty geometry.");var e=new a.ee;e.x=this.fa[0];e.y=this.fa[1];this.description.WC()?e.z=this.fa[2]:e.z=a.pa.ue(1);return e};g.prototype.Py=function(e){this.qc();var f=this.hasAttribute(1);f||a.pa.nD(1,e.z)||(this.Ne(1),f=!0);null==this.fa&&this.ko();this.fa[0]=e.x;this.fa[1]=e.y;f&&(this.fa[2]=e.z)};g.prototype.lk=function(){if(this.sc())throw a.g.ra("This operation should not be performed on an empty geometry.");
return this.fa[0]};g.prototype.qS=function(a){this.setAttribute(0,0,a)};g.prototype.mk=function(){if(this.sc())throw a.g.ra("This operation should not be performed on an empty geometry.");return this.fa[1]};g.prototype.$F=function(a){this.setAttribute(0,1,a)};g.prototype.lO=function(){return this.ld(1,0)};g.prototype.rS=function(a){this.setAttribute(1,0,a)};g.prototype.NN=function(){return this.ld(2,0)};g.prototype.bS=function(a){this.setAttribute(2,0,a)};g.prototype.Qc=function(){return this.nC(3,
0)};g.prototype.ld=function(e,f){var b=this.description.zf(e);return 0<=b?this.fa[this.description.fj(b)+f]:a.pa.ue(e)};g.prototype.nC=function(e,f){var b=this.description.zf(e);return 0<=b?this.fa[this.description.fj(b)+f]:a.pa.ue(e)};g.prototype.setAttribute=function(a,f,b){this.qc();var e=this.description.zf(a);0>e&&(this.Ne(a),e=this.description.zf(a));null==this.fa&&this.ko();this.fa[this.description.fj(e)+f]=b};g.prototype.D=function(){return 33};g.prototype.fb=function(){return 0};g.prototype.Ja=
function(){this.qc();null!=this.fa&&(this.fa[0]=NaN,this.fa[1]=NaN)};g.prototype.nm=function(e){if(null!=this.fa){for(var f=a.Od.iu(e,this.description),b=[],g=0,c=0,d=e.Aa;c<d;c++){var m=e.Hd(c),k=a.pa.Wa(m);if(-1==f[c])for(var h=a.pa.ue(m),m=0;m<k;m++)b[g]=h,g++;else for(h=this.description.fj(f[c]),m=0;m<k;m++)b[g]=this.fa[h],g++,h++}this.fa=b}this.description=e};g.prototype.ko=function(){this.iF(this.description.le.length);g.ob(this.description.le,this.fa,this.description.le.length);this.fa[0]=
NaN;this.fa[1]=NaN};g.prototype.Oe=function(e){if(e instanceof a.Bg){if(!this.sc()){var f=this.w();e.Zi(f,f);this.ic(f)}}else this.sc()||(this.Ne(1),f=this.Lw(),this.Py(e.Qn(f)))};g.prototype.copyTo=function(e){if(33!=e.D())throw a.g.N();e.qc();null==this.fa?(e.Ja(),e.fa=null,e.Qf(this.description)):(e.Qf(this.description),e.iF(this.description.le.length),g.ob(this.fa,e.fa,this.description.le.length))};g.prototype.Pa=function(){return new g(this.description)};g.prototype.s=function(){return this.sc()};
g.prototype.sc=function(){return null==this.fa||isNaN(this.fa[0])||isNaN(this.fa[1])};g.prototype.Fp=function(a){a.Ja();this.description!=a.description&&a.Qf(this.description);a.Db(this)};g.prototype.o=function(a){this.sc()?a.Ja():(a.v=this.fa[0],a.C=this.fa[1],a.B=this.fa[0],a.G=this.fa[1])};g.prototype.Cn=function(a){if(this.sc())a.Ja();else{var e=this.Lw();a.v=e.x;a.C=e.y;a.Je=e.z;a.B=e.x;a.G=e.y;a.ig=e.z}};g.prototype.Ah=function(e,f){var b=new a.Nd;if(this.sc())return b.Ja(),b;e=this.ld(e,f);
b.qa=e;b.va=e;return b};g.prototype.iF=function(e){if(null==this.fa)this.fa=a.I.Lh(e);else if(this.fa.length<e){for(var f=this.fa.slice(0),b=this.fa.length;b<e;b++)f[b]=0;this.fa=f}};g.ob=function(a,f,b){if(0<b)for(b=0;b<a.length;b++)f[b]=a[b]};g.prototype.lc=function(a){if(a==this)return!0;if(!(a instanceof g)||this.description!=a.description)return!1;if(this.sc())return a.sc()?!0:!1;for(var e=0,b=this.description.le.length;e<b;e++)if(this.fa[e]!=a.fa[e])return!1;return!0};g.prototype.hc=function(){var e=
this.description.hc();if(!this.sc())for(var f=0,b=this.description.le.length;f<b;f++)var g=this.fa[f],g=a.I.truncate(g^g>>>32),e=a.I.kg(g,e);return e};g.prototype.Rf=function(){return null};return g}(a.T);a.Va=b})(E||(E={}));(function(a){var b=function(){function a(a,e,f){void 0!==a&&(this.x=a,this.y=e,this.z=f)}a.Oa=function(b,e,f){var g=new a;g.x=b;g.y=e;g.z=f;return g};a.prototype.K=function(a,e,f){this.x=a;this.y=e;this.z=f};a.prototype.Lu=function(){this.z=this.y=this.x=0};a.prototype.normalize=
function(){var a=this.length();0==a&&(this.x/=a,this.y/=a,this.z/=a)};a.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};a.prototype.sub=function(b){return new a(this.x-b.x,this.y-b.y,this.z-b.z)};a.prototype.Ap=function(b){return new a(this.x*b,this.y*b,this.z*b)};a.prototype.FA=function(){this.x=NaN};a.prototype.pv=function(){return isNaN(this.x)};return a}();a.ee=b})(E||(E={}));(function(a){var b=function(){function b(a,e,f){this.gu=this.Yt=null;this.Gf=
e;this.KP=e.y-f;this.JP=e.y+f;this.xp=0;this.ix=a;this.ka=f;this.UP=f*f;this.jx=0!=f;this.xt=!1}b.prototype.result=function(){return 0!=this.xp?1:0};b.prototype.DJ=function(b){b=b.Kb(b.Gd(this.Gf,!1));return a.b.Zb(b,this.Gf)<=this.UP?!0:!1};b.prototype.WB=function(a){if(!this.jx&&(this.ix&&this.Gf.ub(a.Mb())||this.Gf.ub(a.oc())))this.xt=!0;else if(a.ja==this.Gf.y&&a.ja==a.ha){if(this.ix&&!this.jx){var e=Math.max(a.na,a.la);this.Gf.x>Math.min(a.na,a.la)&&this.Gf.x<e&&(this.xt=!0)}}else{var f=!1,e=
Math.max(a.na,a.la);this.Gf.x>e?f=!0:this.Gf.x>=Math.min(a.na,a.la)&&(f=0<a.nt(!0,this.Gf.y,this.gu,null)&&this.gu[0]<=this.Gf.x);if(f){if(this.Gf.y==a.Mb().y){if(this.Gf.y<a.oc().y)return}else if(this.Gf.y==a.oc().y&&this.Gf.y<a.Mb().y)return;this.xp=this.ix?this.xp^1:this.xp+(a.Mb().y>a.oc().y?1:-1)}}};b.prototype.zr=function(a){var e=a.Ah(0,1);if(e.qa>this.JP||e.va<this.KP)return!1;if(this.jx&&this.DJ(a))return!0;if(e.qa>this.Gf.y||e.va<this.Gf.y)return!1;null==this.Yt&&(this.Yt=[null,null,null,
null,null]);null==this.gu&&(this.gu=[0,0,0]);e=a.TC(this.Yt);if(0<e)for(a=0;a<e;a++){var f=this.Yt[a].get();this.WB(f);if(this.xt)return!0}else if(this.WB(a),this.xt)return!0;return!1};b.V=function(a,e,f){e=new b(0==a.Cm(),e,f);for(a=a.Ca();a.kb();)for(;a.La();)if(f=a.ia(),e.zr(f))return-1;return e.result()};b.Bd=function(g,e,f,c){var n=new a.i;g.dd(n);n.P(c,c);var d=new b(0==g.Cm(),f,c);g=g.Ca();var m=new a.i;m.K(n);m.B=f.x+c;m.C=f.y-c;m.G=f.y+c;f=e.xw(m,c);for(c=f.next();-1!=c;c=f.next())if(g.Sb(e.da(c)),
g.La()&&(c=g.ia(),d.zr(c)))return-1;return d.result()};b.xl=function(g,e,f){if(g.s())return 0;var c=new a.i;g.dd(c);c.P(f,f);if(!c.contains(e))return 0;c=g.pb;if(null!=c){var d=c.hi;if(null!=d){d=d.Kk(e.x,e.y);if(1==d)return 1;if(0==d)return 0}c=c.Ab;if(null!=c)return b.Bd(g,c,e,f)}return b.V(g,e,f)};b.aP=function(g,e,f,c){if(g.s())return 0;var n=new a.i;g.dd(n);n.P(c,c);if(!n.contains(e,f))return 0;n=g.pb;if(null!=n&&(n=n.hi,null!=n)){n=n.Kk(e,f);if(1==n)return 1;if(0==n)return 0}return b.V(g,a.b.Oa(e,
f),c)};b.$O=function(a,e,f){return e.s()?0:b.xl(a,e.w(),f)};b.vD=function(g,e,f,c,d){var n=new a.i;g.dd(n);n.P(c,c);if(!n.contains(f))return 0;var m=new b(!0,f,c);if(null!=d){var k=new a.i;k.K(n);k.B=f.x+c;k.C=f.y-c;k.G=f.y+c;g=g.Ca();c=d.xw(k,c);for(k=c.next();-1!=k;k=c.next())if(g.Sb(d.da(k),e),g.La()&&g.Qa==e&&(k=g.ia(),m.zr(k)))return-1}else if(g=g.Ca(),g.vy(e),g.kb())for(;g.La();)if(k=g.ia(),m.zr(k))return-1;return m.result()};b.tD=function(g,e,f){var c=new a.i;g.dd(c);c.P(f,f);if(!c.contains(e))return 0;
e=new b(!1,e,f);for(f=g.Ca();f.kb();)if(!(0>g.oo(f.Qa))){for(e.xp=0;f.La();)if(c=f.ia(),e.zr(c))return-1;if(0!=e.xp)return 1}return e.result()};b.$i=function(g,e,f,c,d){var n=g.Ca();n.vy(e);if(!n.kb()||!n.La())throw a.g.ra("corrupted geometry");for(e=2;2==e&&n.La();)e=n.ia().Kb(.5),e=b.vD(g,f,e,c,d);if(2==e)throw a.g.ra("internal error");return 1==e?!0:!1};b.An=function(a,e){a=a.F();return 16>a?!1:2*a+Math.log(a)/Math.log(2)*1*e<1*a*e};return b}();a.ff=b})(E||(E={}));(function(a){var b=function(a){function b(e){a.call(this,
!0,e)}m(b,a);b.prototype.Pa=function(){return new b(this.description)};b.prototype.fb=function(){return 2};b.prototype.D=function(){return 1736};return b}(a.al);a.Ka=b})(E||(E={}));(function(a){(function(a){a[a.PiPOutside=0]="PiPOutside";a[a.PiPInside=1]="PiPInside";a[a.PiPBoundary=2]="PiPBoundary"})(a.pI||(a.pI={}));var b=function(){function b(){}b.uD=function(b,e,f){b=a.ff.$O(b,e,f);return 0==b?0:1==b?1:2};b.he=function(b,e,f){b=a.ff.xl(b,e,f);return 0==b?0:1==b?1:2};b.CH=function(b,e,f,c){b=a.ff.aP(b,
e,f,c);return 0==b?0:1==b?1:2};b.gU=function(b,e,f,c){return 0==a.ff.vD(b,e,f,c,null)?0:1};b.tD=function(b,e,f){return 0==a.ff.tD(b,e,f)?0:1};b.ZS=function(g,e,f,c,d){if(e.length<f||d.length<f)throw a.g.N();for(var n=0;n<f;n++)d[n]=b.he(g,e[n],c)};b.eT=function(g,e,f,c,d){if(e.length/2<f||d.length<f)throw a.g.N();for(var n=0;n<f;n++)d[n]=b.CH(g,e[2*n],e[2*n+1],c)};b.nG=function(g,e,f,c,d){if(1736==g.D())b.ZS(g,e,f,c,d);else if(197==g.D()){var n=new a.i;g.o(n);b.jP(n,e,f,c,d)}else throw a.g.ra("invalid_call");
};b.nU=function(g,e,f,c,d){if(1736==g.D())b.eT(g,e,f,c,d);else if(197==g.D()){var n=new a.i;g.o(n);b.mP(n,e,f,c,d)}else throw a.g.xa();};b.jP=function(b,e,f,c,d){if(e.length<f||d.length<f)throw a.g.N();if(b.s())for(c=0;c<f;c++)d[c]=0;else for(b.P(.5*-c,.5*-c),b.P(.5*c,.5*c),c=0;c<f;c++)b.contains(e[c])?d[c]=1:b.contains(e[c])?d[c]=2:d[c]=0};b.mP=function(b,e,f,c,d){if(e.length/2<f||d.length<f)throw a.g.N();if(b.s())for(c=0;c<f;c++)d[c]=0;else for(b.P(.5*-c,.5*-c),b.P(.5*c,.5*c),c=0;c<f;c++)b.contains(e[2*
c],e[2*c+1])?d[c]=1:b.contains(e[2*c],e[2*c+1])?d[c]=2:d[c]=0};b.lT=function(a,e,f,b,c){for(var g=0;g<f;g++)c[g]=a.Eq(e[g],b)?2:0};b.hT=function(a,e,f,b,c){var g=a.pb,n=null;null!=g&&(n=g.hi);for(var g=f,d=0;d<f;d++)if(c[d]=1,null!=n){var m=e[d];0==n.Kk(m.x,m.y)&&(c[d]=0,g--)}if(0!=g)for(a=a.Ca();a.kb()&&0!=g;)for(;a.La()&&0!=g;)for(n=a.ia(),d=0;d<f&&0!=g;d++)1==c[d]&&n.Eq(e[d],b)&&(c[d]=2,g--);for(d=0;d<f;d++)1==c[d]&&(c[d]=0)};b.oG=function(g,e,f,c,d){var n=g.D();if(1607==n)b.hT(g,e,f,c,d);else if(a.T.Lc(n))b.lT(g,
e,f,c,d);else throw a.g.ra("Invalid call.");};return b}();a.gd=b})(E||(E={}));(function(a){var b=function(a){function b(e,f){2==arguments.length?(a.call(this,!1,e.description),this.df(e),this.lineTo(f)):a.call(this,!1,e)}m(b,a);b.prototype.Pa=function(){return new b(this.description)};b.prototype.fb=function(){return 1};b.prototype.D=function(){return 1607};return b}(a.al);a.Xa=b})(E||(E={}));(function(a){var b=function(){function a(){}a.GT=function(){};return a}();a.RT=b})(E||(E={}));(function(a){var b=
function(){function b(){}b.Rv=function(a){return a*b.rQ};b.aG=function(a,f){return b.cR(f-a)};b.kR=function(e){if(-360<=e&&720>e)return 0>e?e+=360:360<=e&&(e-=360),e;e=a.vi.gH(e);0>e&&(e+=360);return e};b.cR=function(a){a=b.kR(a);180<a&&(a-=360);return a};b.OT=.0174532925199433;b.rQ=57.29577951308232;return b}(),c=function(){function g(){}g.qo=function(e,f){var b=new a.i;e.o(b);var g=a.Ya.Fm(f),c=new a.i;c.K(g);c.v=b.v;c.B=b.B;c.P(.01*c.ba(),0);g=a.Ia.zd(f,b,!1);return c.contains(b)?e:a.Ed.clip(e,
c,g,0)};g.Rw=function(e,f,b,c){if(!a.Ya.Qo(f))throw a.g.N();var n=a.Ia.Cg(f,e,!1),d=a.Ya.Fm(f),m=a.Ya.Em(f),k=m.Se().Dj,h=a.Ya.ft(m),m=a.Ya.Ts(m),h=h*(2-h),x=new a.Nd;d.wu(x);var q=[[0,0],[0,0]];2==a.Nf.Am(f)?(q[0][0]=g.pu(c,x),q[0][1]=d.Vs(),a.Ya.tu(),d=q[0][0]*k):d=c*k;var l=new a.ca,v=new a.fd;e=v.Eb(e);for(var z=[0],t=new a.b,y=new a.b,r=new a.b,B=new a.b,E=new a.b,u=new a.b,C=v.Vb(e);-1!=C;C=v.bc(C)){var D=v.Cb(C);v.w(D,r);for(var G=!1,J=D=v.X(D);-1!=J;J=v.X(J)){if(J==D){if(G)break;G=!0}v.w(J,
B);if((n<c-r.x&&B.x-c>n||n<c-B.x&&r.x-c>n||n<-B.y&&r.y>n)&&!(Math.abs(r.x-B.x)>=.5*x.aa())&&(2==a.Nf.Am(f)?(q[0][0]=g.pu(r.x,x),q[0][1]=r.y,q[1][0]=g.pu(B.x,x),q[1][1]=B.y,a.Ya.YQ(),E.x=q[0][0]*k,E.y=q[0][1]*k,u.x=q[1][0]*k,u.y=q[1][1]*k):(E.x=r.x*k,E.y=r.y*k,u.x=B.x*k,u.y=B.y*k),u.x=6.283185307179586*(B.x-r.x)/x.aa()+E.x,y.x=d,y.y=g.yH(m,h,E,u,d,b),!isNaN(y.y))){a.zb.Rd(m,h,E.x,E.y,u.x,u.y,l,null,null,b);var p=l.l;a.zb.Rd(m,h,E.x,E.y,y.x,y.y,l,null,null,b);var w=l.l;2==a.Nf.Am(f)?(q[0][0]=y.x/k,
q[0][1]=y.y/k,a.Ya.qN(),t.y=q[0][1],t.x=c):(t.x=c,t.y=y.y/k);z[0]=0<p?a.I.Kr(w/p,0,1):.5;0!=z[0]&&1!=z[0]&&(p=v.Ua(J),v.Mr(p,z,1),v.ic(v.X(p),t.x,t.y))}r.J(B)}}return v.hf(e)};g.aN=function(e,f,b){if(e.s())return e;var c=a.Ya.IC(f);return g.gC(e,0-180*c,360*c,f,b)};g.yH=function(e,f,b,c,d,m){if(3.141592653589793<=Math.abs(b.x-c.x)||!g.Jv(b.x,c.x,d))return NaN;var n;b.x>c.x?n=c:(n=b,b=c);c=new a.ca(0);var k=new a.ca(0),h=new a.ca(0);a.zb.Rd(e,f,n.x,n.y,b.x,b.y,k,c,null,m);var x=k.l,q=0,l=1,v=new a.b;
for(v.J(n);x*(l-q)>1E-12*e;){var z=.5*(q+l);a.zb.dk(e,f,n.x,n.y,x*z,c.l,k,h,m);v.x=k.l;v.y=h.l;if(v.x==d)break;if(g.Jv(n.x,v.x,d))l=z;else if(g.Jv(b.x,v.x,d))q=z;else return NaN}return v.y};g.Jv=function(a,f,g){a=b.Rv(a);f=b.aG(a,b.Rv(f));g=b.aG(a,b.Rv(g));return 0==g||0<f&&0<g&&g<=f||0>f&&0>g&&g>=f?!0:!1};g.pu=function(a,f){var e=f.va-f.qa;return f.Sy(a-Math.floor((a-f.qa)/e)*e)};g.eU=function(e,f,b,g){var c=new a.Nd;c.K(f,b);b=g.aa();e=Math.floor((e-f)/b)*b+e;for(c=c.Af();Math.abs(e-c)>Math.abs(e+
b-c);)e+=b;return e};g.cU=function(e,f,b,g,c){var n;b.y>g.y?n=g:(n=b,b=g);g=new a.Nd;g.K(n.y,b.y);if(!g.contains(0)||3.141592653589793<=Math.abs(n.x-b.x))return NaN;if(n.x==b.x)return n.x;var d=new a.ca(0),m=new a.ca(0),k=new a.ca(0);a.zb.Rd(e,f,n.x,n.y,b.x,b.y,m,d,null,c);var h=m.l,x=0,q=1,l=new a.b;for(l.J(n);h*(q-x)>1E-12*e;){var v=.5*(x+q);a.zb.dk(e,f,n.x,n.y,h*v,d.l,m,k,c);l.x=m.l;l.y=k.l;g.K(n.y,l.y);if(0==l.y)break;if(g.contains(0))q=v;else if(g.K(b.y,l.y),g.contains(0))x=v;else return NaN}return l.x};
g.gC=function(e,f,b,g,c){var n=new a.i;e.o(n);if(n.s())return e;var d=new a.Nd;n.wu(d);var m=new a.Nd;m.K(f,f+b);if(m.contains(d)&&m.va!=d.va)return e;var k=new a.i;k.K(n);var h=e.D();if(33==h){k=c?e:e.vm();n=k.lk();if(n<m.qa||n>=m.va||n==m.va)n+=Math.ceil((m.qa-n)/b)*b,n=m.Sy(n),k.qS(n);return k}if(550==h){k=c?e:e.vm();g=k.mc(0);h=2*k.F();e=!1;for(c=0;c<h;c+=2)if(n=g.read(c),n<m.qa||n>=m.va||n==m.va)e=!0,n+=Math.ceil((m.qa-n)/b)*b,n=m.Sy(n),g.write(c,n);e&&k.ce(1993);return k}if(m.contains(d))return e;
if(197==h)return b=c?e:e.vm(),n.Ga(k),b.Cu(n),b;var x=.1*Math.max(n.ba(),n.aa());k.P(0,x);m=e;e=g.Ko();c=a.wi.local();for(var q=new a.Bg,l=0;;){var v=Math.floor((d.qa-f)/b),z=Math.ceil((d.va-f)/b);if(3<z-v){v=Math.floor(.5*(z+v));k.v=n.v-x;k.B=f+b*v;var t=a.Ed.clip(m,k,e,0);k.v=k.B;k.B=n.B+x;var y=a.Ed.clip(m,k,e,0);q.Nn((v-z)*b,0);y.Oe(q);1736==h?m=c.$(t,y,g,null):(m=t,m.add(y,!1));m.o(n);n.wu(d);l++}else break}k.v=f;k.B=f+b;f=new a.i;f.K(k);f.P(e,0);f=Math.floor((n.v-k.v)/b)*b;0!=f?(k.move(f,0),
q.Nn(-f,0)):q.IF();f=1607==h?new a.Xa(m.description):new a.Ka(m.description);d=new a.i;for(x=new a.i;n.B>k.v;){l=a.Ed.clip(m,k,e,0);l.o(x);if(1607==h?!l.s()&&(x.aa()>e||x.ba()>e):!l.s()&&(1736!=h||x.aa()>e))l.Oe(q),l.o(x),f.o(d),d.P(e,e),d.jc(x)&&1736==h?f=c.$(f,l,g,null):f.add(l,!1);k.move(b,0);q.shift(-b,0)}return f};g.ZQ=function(e,f,b,g){var c=new a.pe(b.description);c.Pd(b,0,-1);var c=a.Ya.Wl(c,e,f),n=b.F();g.Ja();if(!a.Ya.Qo(e)||n!=c.F())return!1;var d=new a.i;b.o(d);var m=new a.i;c.o(m);d=
d.aa();m=m.aa();if(0!=d&&0!=m){if(m/=d,e=a.Ya.Fm(f).aa()/a.Ya.Fm(e).aa(),1E-10<Math.abs(m/e-1))return!1}else if(0!=d||0!=m)return!1;g.add(b,!1);for(b=0;b<n;b++)e=c.Fa(b),g.ic(b,e);return!0};g.dU=function(){throw a.g.qe();};return g}();a.gh=c})(E||(E={}));(function(a){(function(a){a[a.rightSide=1]="rightSide"})(a.sI||(a.sI={}));var b=function(){function b(b,e,f){this.Nq=new a.b;void 0===b?this.tn=-1:(this.Nq.J(b),this.tn=e,this.Da=f,this.Ut=0)}b.prototype.UF=function(a){this.Ut=a?this.Ut|1:this.Ut&
-2};b.prototype.s=function(){return 0>this.tn};b.prototype.pw=function(){if(this.s())throw a.g.ra("invalid call");return new a.Va(this.Nq.x,this.Nq.y)};b.prototype.gb=function(){if(this.s())throw a.g.ra("invalid call");return this.tn};b.prototype.sw=function(){if(this.s())throw a.g.ra("invalid call");return this.Da};b.prototype.Xw=function(){return 0!=(this.Ut&1)};b.prototype.tv=function(a,e,f,b){this.Nq.x=a;this.Nq.y=e;this.tn=f;this.Da=b};return b}();a.dl=b})(E||(E={}));(function(a){var b=function(){function b(){}
b.prototype.Fn=function(e,f){this.Vg.resize(0);this.ai.length=0;this.Aj=-1;e.dd(this.Kj);this.Kj.P(f,f);this.Kj.jc(this.Ab.Qb)?((this.Iq=a.T.Lc(e.D()))?(this.rE=e.Mb(),this.qE=e.oc(),this.ka=f):this.ka=NaN,this.Vg.add(this.Ab.Ze),this.ai.push(this.Ab.Qb),this.ar=this.Ab.sq(this.Ab.Ze)):this.ar=-1};b.prototype.Ch=function(a,f){this.Vg.resize(0);this.ai.length=0;this.Aj=-1;this.Kj.K(a);this.Kj.P(f,f);this.ka=NaN;this.Kj.jc(this.Ab.Qb)?(this.Vg.add(this.Ab.Ze),this.ai.push(this.Ab.Qb),this.ar=this.Ab.sq(this.Ab.Ze),
this.Iq=!1):this.ar=-1};b.prototype.next=function(){if(0==this.Vg.size)return-1;this.Aj=this.ar;var e=null,f=null,b,g=null,d=null;this.Iq&&(e=new a.b,f=new a.b,g=new a.i);for(var m=!1;!m;){for(;-1!=this.Aj;){b=this.Ab.kw(this.Ab.Us(this.Aj));if(b.jc(this.Kj))if(this.Iq){if(e.J(this.rE),f.J(this.qE),g.K(b),g.P(this.ka,this.ka),0<g.Nv(e,f)){m=!0;break}}else{m=!0;break}this.Aj=this.Ab.at(this.Aj)}if(-1==this.Aj){b=this.Vg.tc();var k=this.ai[this.ai.length-1];null==d&&(d=[],d[0]=new a.i,d[1]=new a.i,
d[2]=new a.i,d[3]=new a.i);c.BF(k,d);this.Vg.af();--this.ai.length;for(k=0;4>k;k++){var h=this.Ab.zo(b,k);if(-1!=h&&0<this.Ab.gO(h)&&d[k].jc(this.Kj))if(this.Iq){if(e.J(this.rE),f.J(this.qE),g.K(d[k]),g.P(this.ka,this.ka),0<g.Nv(e,f)){var q=new a.i;q.K(d[k]);this.Vg.add(h);this.ai.push(q)}}else q=new a.i,q.K(d[k]),this.Vg.add(h),this.ai.push(q)}if(0==this.Vg.size)return-1;this.Aj=this.Ab.sq(this.Vg.get(this.Vg.size-1))}}this.ar=this.Ab.at(this.Aj);return this.Aj};b.HL=function(e,f,g){var c=new b;
c.Ab=e;c.Kj=new a.i;c.Vg=new a.ga(0);c.ai=[];c.Fn(f,g);return c};b.GL=function(e,f,g){var c=new b;c.Ab=e;c.Kj=new a.i;c.Vg=new a.ga(0);c.ai=[];c.Ch(f,g);return c};b.FL=function(e){var f=new b;f.Ab=e;f.Kj=new a.i;f.Vg=new a.ga(0);f.ai=[];return f};return b}();a.TT=b;var c=function(){function g(e,f){this.Ye=new a.Fc(11);this.qh=new a.Fc(5);this.Jq=[];this.Rt=new a.ga(0);this.Qb=new a.i;this.Rj(e,f)}g.prototype.reset=function(a,f){this.Ye.Nh(!1);this.qh.Nh(!1);this.Jq.length=0;this.Rt.clear(!1);this.Rj(a,
f)};g.prototype.lg=function(a,f){return this.lt(a,f,0,this.Qb,this.Ze,!1,-1)};g.prototype.kt=function(a,f,b){b=-1==b?this.Ze:this.KC(b);var e=this.ba(b),g=this.CN(b);return this.lt(a,f,e,g,b,!1,-1)};g.prototype.da=function(a){return this.yN(a)};g.prototype.uC=function(a){return this.kw(this.Us(a))};g.prototype.ba=function(a){return this.Xs(a)};g.prototype.CN=function(e){var f=new a.i;f.K(this.Qb);var b=this.Xs(e);e=this.EC(e);for(var g=0;g<2*b;g+=2){var c=a.I.truncate(3&e>>g);0==c?(f.v=.5*(f.v+f.B),
f.C=.5*(f.C+f.G)):1==c?(f.B=.5*(f.v+f.B),f.C=.5*(f.C+f.G)):(2==c?f.B=.5*(f.v+f.B):f.v=.5*(f.v+f.B),f.G=.5*(f.C+f.G))}return f};g.prototype.gO=function(a){return this.Kw(a)};g.prototype.KN=function(a,f){return b.HL(this,a,f)};g.prototype.xw=function(a,f){return b.GL(this,a,f)};g.prototype.Re=function(){return b.FL(this)};g.prototype.Rj=function(e,f){if(0>f||32<2*f)throw a.g.N("invalid height");this.GP=f;this.Qb.K(e);this.Ze=this.Ye.be();this.Ku(this.Ze,0);this.Eu(this.Ze,0);this.LF(this.Ze,0);this.HF(this.Ze,
0)};g.prototype.lt=function(e,f,b,c,d,m,k){if(!c.contains(f))return 0==b?-1:this.lt(e,f,0,this.Qb,this.Ze,m,k);if(!m)for(var n=d;-1!=n;n=this.UN(n))this.Ku(n,this.Kw(n)+1);n=new a.i;n.K(c);c=d;var h=[];h[0]=new a.i;h[1]=new a.i;h[2]=new a.i;for(h[3]=new a.i;b<this.GP&&this.IK(c);b++){g.BF(n,h);for(var x=!1,q=0;4>q;q++)if(h[q].contains(f)){var x=!0,l=this.zo(c,q);-1==l&&(l=this.OL(c,q));this.Ku(l,this.Kw(l)+1);c=l;n.K(h[q]);break}if(!x)break}return this.zO(e,f,b,n,c,m,d,k)};g.prototype.zO=function(a,
f,b,g,c,d,m,k){var e=this.AC(c);if(d){if(c==m)return k;this.mM(k);d=k}else d=this.QL(),this.By(d,a),this.IR(this.Us(d),f);this.gS(d,c);-1!=e?(this.Ju(d,e),this.Fu(e,d)):this.DF(c,d);this.Fy(c,d);this.Eu(c,this.Zs(c)+1);this.HK(c)&&this.$M(b,g,c);return d};g.prototype.mM=function(a){var e=this.KC(a),b=this.AC(e),g=this.$N(a),c=this.at(a);this.sq(e)==a?(-1!=c?this.Ju(c,-1):this.Fy(e,-1),this.DF(e,c)):b==a?(this.Fu(g,-1),this.Fy(e,g)):(this.Ju(c,g),this.Fu(g,c));this.Ju(a,-1);this.Fu(a,-1);this.Eu(e,
this.Zs(e)-1)};g.BF=function(a,f){var e=.5*(a.v+a.B),b=.5*(a.C+a.G);f[0].K(e,b,a.B,a.G);f[1].K(a.v,b,e,a.G);f[2].K(a.v,a.C,e,b);f[3].K(e,a.C,a.B,b)};g.prototype.HK=function(a){return 8==this.Zs(a)&&!this.VC(a)};g.prototype.$M=function(a,f,b){var e,g,c=this.sq(b);do g=this.Us(c),e=this.qh.O(c,0),g=this.kw(g),this.lt(e,g,a,f,b,!0,c),c=e=this.at(c);while(-1!=c)};g.prototype.IK=function(a){return 8<=this.Zs(a)||this.VC(a)};g.prototype.VC=function(a){return-1!=this.zo(a,0)||-1!=this.zo(a,1)||-1!=this.zo(a,
2)||-1!=this.zo(a,3)};g.prototype.OL=function(a,f){var e=this.Ye.be();this.MR(a,f,e);this.Ku(e,0);this.Eu(e,0);this.Tj(e,a);this.HF(e,this.Xs(a)+1);this.LF(e,f<<2*this.Xs(a)|this.EC(a));return e};g.prototype.QL=function(){var e=this.qh.be(),f;0<this.Rt.size?(f=this.Rt.tc(),this.Rt.af()):(f=this.Jq.length,this.Jq.push(new a.i));this.JR(e,f);return e};g.prototype.zo=function(a,f){return this.Ye.O(a,f)};g.prototype.MR=function(a,f,b){this.Ye.L(a,f,b)};g.prototype.sq=function(a){return this.Ye.O(a,4)};
g.prototype.DF=function(a,f){this.Ye.L(a,4,f)};g.prototype.AC=function(a){return this.Ye.O(a,5)};g.prototype.Fy=function(a,f){this.Ye.L(a,5,f)};g.prototype.EC=function(a){return this.Ye.O(a,6)};g.prototype.LF=function(a,f){this.Ye.L(a,6,f)};g.prototype.Zs=function(a){return this.Ye.O(a,7)};g.prototype.Kw=function(a){return this.Ye.O(a,8)};g.prototype.Eu=function(a,f){this.Ye.L(a,7,f)};g.prototype.Ku=function(a,f){this.Ye.L(a,8,f)};g.prototype.UN=function(a){return this.Ye.O(a,9)};g.prototype.Tj=function(a,
f){this.Ye.L(a,9,f)};g.prototype.Xs=function(a){return this.Ye.O(a,10)};g.prototype.HF=function(a,f){this.Ye.L(a,10,f)};g.prototype.yN=function(a){return this.qh.O(a,0)};g.prototype.By=function(a,f){this.qh.L(a,0,f)};g.prototype.$N=function(a){return this.qh.O(a,1)};g.prototype.at=function(a){return this.qh.O(a,2)};g.prototype.Ju=function(a,f){this.qh.L(a,1,f)};g.prototype.Fu=function(a,f){this.qh.L(a,2,f)};g.prototype.KC=function(a){return this.qh.O(a,3)};g.prototype.gS=function(a,f){this.qh.L(a,
3,f)};g.prototype.Us=function(a){return this.qh.O(a,4)};g.prototype.JR=function(a,f){this.qh.L(a,4,f)};g.prototype.kw=function(a){return this.Jq[a]};g.prototype.IR=function(a,f){this.Jq[a].K(f)};return g}();a.co=c})(E||(E={}));(function(a){(function(a){a[a.Outside=0]="Outside";a[a.Inside=1]="Inside";a[a.Border=2]="Border"})(a.wH||(a.wH={}));var b=function(){function a(a,f){this.Hg=null;this.SP=f;this.Hg=a}a.prototype.Bu=function(a,f){this.PD!=f&&a.flush();this.PD=f};a.prototype.XB=function(a,f){for(var e=
0;e<f;)for(var b=a[e++],g=a[e++],c=a[e++]*this.SP;b<g;b++)this.Hg[c+(b>>4)]|=this.PD<<2*(b&15)};return a}();a.VT=b;var c=function(){function g(a,f,b){this.Hg=null;this.Qx=this.Sx=this.zE=this.xE=this.Qq=this.VD=this.tf=this.Pl=0;this.ii=this.Nj=this.sk=null;this.jt(a,f,b)}g.create=function(e,f,b){if(!g.Cc(e))throw a.g.N();return g.Id(e,f,b)};g.ti=function(e,f,b){if(!g.Cc(e))throw a.g.N();return g.ye(e,f,b)};g.jR=function(e){switch(e){case 0:e=1024;break;case 1:e=16384;break;case 2:e=262144;break;
default:throw a.g.ra("Internal Error");}return e};g.Cc=function(a){return a.s()||1607!=a.D()&&1736!=a.D()?!1:!0};g.prototype.KM=function(e,f){f=f.Ca();for(var b=new a.b,g=new a.b;f.kb();)for(;f.La();){var c=f.ia();if(322!=c.D())throw a.g.ra("Internal Error");e.Zi(c.Mb(),b);e.Zi(c.oc(),g);this.ii.zv(b.x,b.y,g.x,g.y)}this.ii.fF(a.ev.$u)};g.prototype.LM=function(){throw a.g.ra("Internal Error");};g.prototype.cw=function(e,f){for(var b=1;4>b;b++)e.zv(f[b-1].x,f[b-1].y,f[b].x,f[b].y);e.zv(f[3].x,f[3].y,
f[0].x,f[0].y);this.ii.fF(a.ev.$u)};g.prototype.kG=function(e,f,b){for(var g=[null,null,null,null],c=0;c<g.length;c++)g[c]=new a.b;f=f.Ca();b=this.Nj.TS(b)+1.5;for(var c=new a.b,n=new a.b,d=new a.b,m=new a.b,k=new a.b,h=new a.i,q=new a.b;f.kb();){var l=!1,v=!0;for(q.ma(0,0);f.La();){var t=f.ia();m.x=t.na;m.y=t.ja;k.x=t.la;k.y=t.ha;h.Ja();h.Db(m.x,m.y);h.Oj(k.x,k.y);if(this.sk.rD(h)){this.Nj.Zi(k,k);v?(this.Nj.Zi(m,m),q.J(m),v=!1):m.J(q);c.pc(k,m);var t=c.length(),z=.5>t;0==t?c.ma(1,0):(z||q.J(k),
c.scale(b/t),n.ma(-c.y,c.x),d.ma(c.y,-c.x),m.sub(c),k.add(c),g[0].add(m,n),g[1].add(m,d),g[2].add(k,d),g[3].add(k,n),z?l=!0:this.cw(e,g))}else l&&(this.cw(e,g),l=!1),v=!0}l&&this.cw(e,g)}};g.prototype.fz=function(e){return a.I.truncate(e*this.VD+this.xE)};g.prototype.gz=function(e){return a.I.truncate(e*this.Qq+this.zE)};g.Id=function(a,f,b){return new g(a,f,b)};g.ye=function(a,f,b){return new g(a,f,b)};g.prototype.jt=function(e,f,g){this.tf=Math.max(a.I.truncate(2*Math.sqrt(g)+.5),64);this.Pl=a.I.truncate((2*
this.tf+31)/32);this.sk=new a.i;this.Sx=f;g=0;for(var c=this.tf,d=this.Pl;8<=c;)g+=c*d,c=a.I.truncate(c/2),d=a.I.truncate((2*c+31)/32);this.Hg=a.I.Lh(g,0);this.ii=new a.ev;g=new b(this.Hg,this.Pl,this);this.ii.vS(this.tf,this.tf,g);e.o(this.sk);this.sk.P(f,f);var c=new a.i,d=a.i.Oa(1,1,this.tf-2,this.tf-2),n=f*d.aa();f*=d.ba();c.K(this.sk.Af(),Math.max(n,this.sk.aa()),Math.max(f,this.sk.ba()));this.Qx=this.Sx;this.Nj=new a.Bg;this.Nj.wO(c,d);new a.Bg;switch(e.D()){case 550:g.Bu(this.ii,2);this.LM();
break;case 1607:g.Bu(this.ii,2);this.kG(this.ii,e,this.Qx);break;case 1736:g.Bu(this.ii,1),this.KM(this.Nj,e),g.Bu(this.ii,2),this.kG(this.ii,e,this.Qx)}this.VD=this.Nj.mb;this.Qq=this.Nj.eb;this.xE=this.Nj.Nb;this.zE=this.Nj.Ob;this.BK()};g.prototype.BK=function(){this.ii.flush();for(var e=0,f=this.tf*this.Pl,b=this.tf,g=a.I.truncate(this.tf/2),c=this.Pl,d=a.I.truncate((2*g+31)/32);8<b;){for(b=0;b<g;b++)for(var m=2*b,k=2*b+1,h=0;h<g;h++){var q=2*h,l=2*h+1,v=q>>4,q=2*(q&15),t=l>>4,l=2*(l&15),z=this.Hg[e+
c*m+v]>>q&3,z=z|this.Hg[e+c*m+t]>>l&3,z=z|this.Hg[e+c*k+v]>>q&3,z=z|this.Hg[e+c*k+t]>>l&3;this.Hg[f+d*b+(h>>4)]|=z<<2*(h&15)}b=g;c=d;e=f;g=a.I.truncate(b/2);d=a.I.truncate((2*g+31)/32);f=e+c*b}};g.prototype.Kk=function(a,f){if(!this.sk.contains(a,f))return 0;a=this.fz(a);f=this.gz(f);if(0>a||a>=this.tf||0>f||f>=this.tf)return 0;a=this.Hg[this.Pl*f+(a>>4)]>>2*(a&15)&3;return 0==a?0:1==a?1:2};g.prototype.Dn=function(e){if(!e.Ga(this.sk))return 0;var f=this.fz(e.v),b=this.fz(e.B),g=this.gz(e.C);e=this.gz(e.G);
0>f&&(f=0);0>g&&(g=0);b>=this.tf&&(b=this.tf-1);e>=this.tf&&(e=this.tf-1);if(f>b||g>e)return 0;for(var c=Math.max(b-f,1)*Math.max(e-g,1),d=0,m=this.Pl,k=this.tf,h=0;;){if(32>c||16>k){for(c=g;c<=e;c++)for(var q=f;q<=b;q++)if(h=this.Hg[d+m*c+(q>>4)]>>2*(q&15)&3,1<h)return 2;if(0==h)return 0;if(1==h)return 1}d+=m*k;k=a.I.truncate(k/2);m=a.I.truncate((2*k+31)/32);f=a.I.truncate(f/2);g=a.I.truncate(g/2);b=a.I.truncate(b/2);e=a.I.truncate(e/2);c=Math.max(b-f,1)*Math.max(e-g,1)}};g.prototype.cO=function(){return this.tf*
this.Pl};return g}();a.dA=c})(E||(E={}));(function(a){(function(a){a[a.contains=1]="contains";a[a.within=2]="within";a[a.equals=3]="equals";a[a.disjoint=4]="disjoint";a[a.touches=8]="touches";a[a.crosses=16]="crosses";a[a.overlaps=32]="overlaps";a[a.unknown=0]="unknown";a[a.intersects=1073741824]="intersects"})(a.zI||(a.zI={}));var b=function(){function a(){}a.Oa=function(e,f,b,g,c,d,m,k){var n=new a;n.Wt=e;n.Jl=f;n.Oi=b;n.ji=g;n.dE=c;n.tU=d;n.uU=m;n.vU=k;return n};return a}(),c=function(){function b(){}
b.vT=function(e,f,g){if(!b.pQ(e))return!1;var c=a.Ia.Cg(f,e,!1);f=!1;a.Wj.vB(e)&&(f=f||e.jv(c,g));c=e.D();1736!=c&&1607!=c||!a.Wj.tB(e)||0==g||(f=f||e.dj(g));1736!=c&&1607!=c||!a.Wj.uB(e)||0==g||(f=f||e.jJ());return f};b.pQ=function(e){return a.Wj.vB(e)||a.Wj.tB(e)||a.Wj.uB(e)};return b}();a.rT=c;c=function(){function g(){this.Tg=[]}g.qy=function(e,f,b,c,d){var n=e.D(),m=f.D();if(197==n){if(197==m)return g.AQ(e,f,b,c);if(33==m)return 2==c?c=1:1==c&&(c=2),g.Iz(f,e,b,c)}else if(33==n){if(197==m)return g.Iz(e,
f,b,c);if(33==m)return g.eR(e,f,b,c)}if(e.s()||f.s())return 4==c?!0:!1;var k=new a.i;e.o(k);var h=new a.i;f.o(h);var q=new a.i;q.K(k);q.Db(h);b=a.Ia.zd(b,q,!1);if(g.nj(k,h,b))return 4==c?!0:!1;k=!1;a.al.Lc(n)&&(n=new a.Xa(e.description),n.Bc(e,!0),e=n,n=1607);a.al.Lc(m)&&(m=new a.Xa(f.description),m.Bc(f,!0),f=m,m=1607);if(197!=n&&197!=m){if(e.fb()<f.fb()||33==n&&550==m)2==c?c=1:1==c&&(c=2)}else 1736!=n&&197!=m&&(2==c?c=1:1==c&&(c=2));switch(n){case 1736:switch(m){case 1736:k=g.vr(e,f,b,c,d);break;
case 1607:k=g.Vl(e,f,b,c,d);break;case 33:k=g.ur(e,f,b,c,d);break;case 550:k=g.tr(e,f,b,c,d);break;case 197:k=g.xD(e,f,b,c,d)}break;case 1607:switch(m){case 1736:k=g.Vl(f,e,b,c,d);break;case 1607:k=g.ey(e,f,b,c,d);break;case 33:k=g.xr(e,f,b,c,d);break;case 550:k=g.wr(e,f,b,c,d);break;case 197:k=g.WE(e,f,b,c)}break;case 33:switch(m){case 1736:k=g.ur(f,e,b,c,d);break;case 1607:k=g.xr(f,e,b,c,d);break;case 550:k=g.pr(f,e,b,c,d)}break;case 550:switch(m){case 1736:k=g.tr(f,e,b,c,d);break;case 1607:k=g.wr(f,
e,b,c,d);break;case 550:k=g.Wx(e,f,b,c,d);break;case 33:k=g.pr(e,f,b,c,d);break;case 197:k=g.oA(e,f,b,c)}break;case 197:switch(m){case 1736:k=g.xD(f,e,b,c,d);break;case 1607:k=g.WE(f,e,b,c);break;case 550:k=g.oA(f,e,b,c)}}return k};g.AQ=function(e,f,b,c){if(e.s()||f.s())return 4==c?!0:!1;var d=new a.i,n=new a.i,m=new a.i;e.o(d);f.o(n);m.K(d);m.Db(n);e=a.Ia.zd(b,m,!1);switch(c){case 4:return g.nj(d,n,e);case 2:return g.Bz(n,d,e);case 1:return g.Bz(d,n,e);case 3:return g.ye(d,n,e);case 8:return g.kT(d,
n,e);case 32:return g.fT(d,n,e);case 16:return g.cT(d,n,e)}return!1};g.Iz=function(e,f,b,c){if(e.s()||f.s())return 4==c?!0:!1;e=e.w();var d=new a.i,n=new a.i;f.o(d);n.K(e);n.Db(d);f=a.Ia.zd(b,n,!1);switch(c){case 4:return g.ru(e,d,f);case 2:return g.bx(e,d,f);case 1:return g.YL(e,d,f);case 3:return g.KA(e,d,f);case 8:return g.ax(e,d,f)}return!1};g.eR=function(e,f,b,c){if(e.s()||f.s())return 4==c?!0:!1;e=e.w();f=f.w();var d=new a.i;d.K(e);d.Db(f);b=a.Ia.zd(b,d,!1);switch(c){case 4:return g.rM(e,f,
b);case 2:return g.hz(f,e,b);case 1:return g.hz(e,f,b);case 3:return g.dB(e,f,b)}return!1};g.vr=function(a,f,b,c,d){switch(c){case 4:return g.dT(a,f,b);case 2:return g.su(f,a,b,d);case 1:return g.su(a,f,b,d);case 3:return g.TG(a,f,b);case 8:return g.vH(a,f,b);case 32:return g.bH(a,f,b,d)}return!1};g.Vl=function(a,f,b,c,d){switch(c){case 4:return g.gT(a,f,b);case 1:return g.dy(a,f,b,d);case 8:return g.zH(a,f,b,d);case 16:return g.lR(a,f,b)}return!1};g.ur=function(a,f,b,c){switch(c){case 4:return g.YS(a,
f,b);case 1:return g.qQ(a,f,b);case 8:return g.lH(a,f,b)}return!1};g.tr=function(a,f,b,c){switch(c){case 4:return g.OS(a,f,b);case 1:return g.hQ(a,f,b);case 8:return g.iH(a,f,b);case 16:return g.dR(a,f,b)}return!1};g.xD=function(a,f,b,c,d){if(g.ER(a,f,b))return 4==c?!0:!1;if(4==c)return!1;switch(c){case 2:return g.DH(a,f,b);case 1:return g.WP(a,f,b);case 3:return g.OG(a,f,b);case 8:return g.eH(a,f,b,d);case 32:return g.WG(a,f,b,d);case 16:return g.zQ(a,f,b,d)}return!1};g.ey=function(a,f,b,c){switch(c){case 4:return g.EI(a,
f,b);case 2:return g.JE(f,a,b);case 1:return g.JE(a,f,b);case 3:return g.QI(a,f,b);case 8:return g.cF(a,f,b);case 32:return g.$I(a,f,b);case 16:return g.LE(a,f,b)}return!1};g.xr=function(a,f,b,c){switch(c){case 4:return g.yI(a,f,b);case 1:return g.KH(a,f,b);case 8:return g.MG(a,f,b)}return!1};g.wr=function(a,f,b,c){switch(c){case 4:return g.vI(a,f,b);case 1:return g.IH(a,f,b);case 8:return g.fJ(a,f,b);case 16:return g.QH(a,f,b)}return!1};g.WE=function(a,f,b,c){if(g.nI(a,f,b))return 4==c?!0:!1;if(4==
c)return!1;switch(c){case 2:return g.WJ(a,f,b);case 1:return g.GH(a,f,b);case 3:return g.MI(a,f,b);case 8:return g.cJ(a,f,b);case 32:return g.XI(a,f,b);case 16:return g.MH(a,f,b)}return!1};g.Wx=function(a,f,b,c){switch(c){case 4:return g.xI(a,f,b);case 2:return g.kA(f,a,b);case 1:return g.kA(a,f,b);case 3:return g.LI(a,f,b);case 32:return g.bJ(a,f,b)}return!1};g.pr=function(a,f,b,c){switch(c){case 4:return g.lA(a,f,b);case 2:return g.HJ(a,f,b);case 1:return g.PH(a,f,b);case 3:return g.mu(a,f,b)}return!1};
g.oA=function(a,f,b,c){switch(c){case 4:return g.uI(a,f,b);case 2:return g.LG(a,f,b);case 1:return g.LH(a,f,b);case 3:return g.DI(a,f,b);case 8:return g.eJ(a,f,b);case 16:return g.mI(a,f,b)}return!1};g.TG=function(e,f,b){var c=new a.i,d=new a.i;e.o(c);f.o(d);if(!g.ye(c,d,b))return!1;c=g.fc(e,f,!1);if(4==c||1==c||2==c)return!1;if(g.jA(e,f,b))return!0;c=e.$b();d=f.$b();return Math.abs(c-d)>4*Math.max(e.F(),f.F())*b?!1:g.Vv(e,f,b,!0)};g.dT=function(a,f,b){var e=g.fc(a,f,!0);return 4==e?!0:1==e||2==e||
1073741824==e?!1:g.ZC(a,f,b)};g.vH=function(a,f,b){var e=g.fc(a,f,!1);return 4==e||1==e||2==e?!1:g.AE(a,f,b,null)};g.bH=function(a,f,b,c){var e=g.fc(a,f,!1);return 4==e||1==e||2==e?!1:g.wD(a,f,b,c)};g.su=function(e,f,b,c){var d=new a.i,n=new a.i;e.o(d);f.o(n);if(!g.rc(d,n,b))return!1;d=g.fc(e,f,!1);return 4==d||2==d?!1:1==d?!0:g.bC(e,f,b,c)};g.gT=function(a,f,b){var e=g.fc(a,f,!0);return 4==e?!0:1==e||1073741824==e?!1:g.ZC(a,f,b)};g.zH=function(a,f,b,c){var e=g.fc(a,f,!1);return 4==e||1==e?!1:g.CE(a,
f,b,c)};g.lR=function(a,f,b){var e=g.fc(a,f,!1);return 4==e||1==e?!1:g.YC(a,f,b,null)};g.dy=function(e,f,b,c){var d=new a.i,n=new a.i;e.o(d);f.o(n);if(!g.rc(d,n,b))return!1;d=g.fc(e,f,!1);return 4==d?!1:1==d?!0:g.jC(e,f,b,c)};g.YS=function(e,f,b){return 0==a.gd.uD(e,f,b)?!0:!1};g.lH=function(a,f,b){f=f.w();return g.yD(a,f,b)};g.qQ=function(a,f,b){f=f.w();return g.YB(a,f,b)};g.OS=function(e,f,b){var c=g.fc(e,f,!1);if(4==c)return!0;if(1==c)return!1;c=new a.i;e.o(c);c.P(b,b);for(var d=new a.b,n=0;n<
f.F();n++)if(f.w(n,d),c.contains(d)){var m=a.gd.he(e,d,b);if(1==m||2==m)return!1}return!0};g.iH=function(e,f,b){var g=this.fc(e,f,!1);if(4==g||1==g)return!1;g=new a.i;e.o(g);g.P(b,b);var c,d=!1,n;n=e;for(var m=!1,k=0;k<f.F();k++){c=f.Fa(k);if(g.contains(c))if(c=a.gd.he(n,c,b),2==c)d=!0;else if(1==c)return!1;m||(!a.ff.An(e,f.F()-1)||null!=e.pb&&null!=e.pb.Ab?n=e:(n=new a.Ka,e.copyTo(n),n.dj(1)),m=!0)}return d?!0:!1};g.dR=function(e,f,b){var g=this.fc(e,f,!1);if(4==g||1==g)return!1;var c=new a.i,g=
new a.i,d=new a.i;e.o(c);f.o(d);g.K(c);g.P(b,b);var d=c=!1,n,m;m=e;for(var k=!1,h=0;h<f.F();h++){n=f.Fa(h);g.contains(n)?(n=a.gd.he(m,n,b),0==n?d=!0:1==n&&(c=!0)):d=!0;if(c&&d)return!0;k||(!a.ff.An(e,f.F()-1)||null!=e.pb&&null!=e.pb.Ab?m=e:(m=new a.Ka,e.copyTo(m),m.dj(1)),k=!0)}return!1};g.hQ=function(e,f,b){var g=new a.i,c=new a.i;e.o(g);f.o(c);if(!this.rc(g,c,b))return!1;c=this.fc(e,f,!1);if(4==c)return!1;if(1==c)return!0;var c=!1,d,n;n=e;for(var m=!1,k=0;k<f.F();k++){d=f.Fa(k);if(!g.contains(d))return!1;
d=a.gd.he(n,d,b);if(1==d)c=!0;else if(0==d)return!1;m||(!a.ff.An(e,f.F()-1)||null!=e.pb&&null!=e.pb.Ab?n=e:(n=new a.Ka,e.copyTo(n),n.dj(1)),m=!0)}return c};g.OG=function(e,f,b){var c=new a.i,d=new a.i;e.o(c);f.o(d);if(!g.ye(c,d,b))return!1;c=new a.Ka;c.Wc(f,!1);return g.Vv(e,c,b,!0)};g.ER=function(e,f,b){var c=g.fc(e,f,!1);if(4==c)return!0;if(1==c||2==c)return!1;var d=new a.i,c=new a.i;e.o(d);f.o(c);if(g.rc(c,d,b))return!1;d=new a.b;c.Yl(d);f=a.gd.he(e,d,b);if(0!=f)return!1;c.YE(d);f=a.gd.he(e,d,
b);if(0!=f)return!1;c.Zl(d);f=a.gd.he(e,d,b);if(0!=f)return!1;c.aF(d);f=a.gd.he(e,d,b);if(0!=f)return!1;f=e.mc(0);d=new a.i;d.K(c);d.P(b,b);for(var n=0,m=e.F();n<m;n++){var k=f.read(2*n),h=f.read(2*n+1);if(d.contains(k,h))return!1}return!g.cA(e,c,b)};g.eH=function(e,f,b,c){var d=g.fc(e,f,!1);if(4==d||1==d||2==d)return!1;var d=new a.i,n=new a.i;e.o(d);f.o(n);if(g.rc(n,d,b))return!1;if(n.aa()<=b&&n.ba()<=b)return f=f.qq(),g.yD(e,f,b);if(n.aa()<=b||n.ba()<=b)return d=new a.Xa,n=new a.Va,f.uf(0,n),d.df(n),
f.uf(2,n),d.lineTo(n),g.CE(e,d,b,c);d=new a.Ka;d.Wc(f,!1);return g.AE(e,d,b,c)};g.WG=function(e,f,b,c){var d=g.fc(e,f,!1);if(4==d||1==d||2==d)return!1;var d=new a.i,n=new a.i;e.o(d);f.o(n);if(g.rc(n,d,b)||n.aa()<=b||n.ba()<=b)return!1;d=new a.Ka;d.Wc(f,!1);return g.wD(e,d,b,c)};g.DH=function(e,f,b){var c=new a.i,d=new a.i;e.o(c);f.o(d);return g.rc(d,c,b)};g.WP=function(e,f,b){var c=new a.i,d=new a.i;e.o(c);f.o(d);if(!g.rc(c,d,b))return!1;c=g.fc(e,f,!1);if(4==c||2==c)return!1;if(1==c)return!0;if(d.aa()<=
b&&d.ba()<=b)return f=f.qq(),g.YB(e,f,b);if(d.aa()<=b||d.ba()<=b)return d=new a.Xa,c=new a.Va,f.uf(0,c),d.df(c),f.uf(2,c),d.lineTo(c),g.jC(e,d,b,null);d=new a.Ka;d.Wc(f,!1);return g.bC(e,d,b,null)};g.zQ=function(e,f,b,c){var d=new a.i,n=new a.i;e.o(d);f.o(n);if(g.rc(n,d,b)||n.ba()>b&&n.aa()>b||n.ba()<=b&&n.aa()<=b)return!1;d=new a.Xa;n=new a.Va;f.uf(0,n);d.df(n);f.uf(2,n);d.lineTo(n);return g.YC(e,d,b,c)};g.QI=function(e,f,b){var c=new a.i,d=new a.i;e.o(c);f.o(d);return g.ye(c,d,b)&&4!=g.fc(e,f,!1)?
g.jA(e,f,b)?!0:g.Vv(e,f,b,!1):!1};g.EI=function(e,f,b){return 4==this.fc(e,f,!1)?!0:(new a.cl(e,f,b,!0)).next()?!this.ED(e,f,b):!1};g.cF=function(e,f,b){if(4==g.fc(e,f,!1))return!1;var c=new a.qd(0);if(0!=g.Zv(e,f,b,c))return!1;for(var d=new a.pe,n=0;n<c.size;n+=2){var m=c.read(n),k=c.read(n+1);d.zs(m,k)}e=e.Rf();f=f.Rf();e.Pd(f,0,f.F());return g.lu(e,d,b)};g.LE=function(e,f,b){if(4==g.fc(e,f,!1))return!1;var c=new a.qd(0);if(0!=g.Zv(e,f,b,c))return!1;for(var d=new a.pe,n=0;n<c.size;n+=2){var m=c.read(n),
k=c.read(n+1);d.zs(m,k)}e=e.Rf();f=f.Rf();e.Pd(f,0,f.F());return!g.lu(e,d,b)};g.$I=function(a,f,b){return 4==g.fc(a,f,!1)?!1:g.iA(a,f,b)};g.JE=function(e,f,b){var c=new a.i,d=new a.i;e.o(c);f.o(d);return g.rc(c,d,b)&&4!=g.fc(e,f,!1)?g.Wf(f,e,b,!1):!1};g.yI=function(a,f,b){if(4==g.fc(a,f,!1))return!0;f=f.w();return!g.ex(a,f,b)};g.MG=function(a,f,b){if(4==g.fc(a,f,!1))return!1;f=f.w();return g.bw(a,f,b)};g.KH=function(a,f,b){if(4==g.fc(a,f,!1))return!1;f=f.w();return g.bA(a,f,b)};g.vI=function(a,f,
b){return 4==g.fc(a,f,!1)?!0:!g.eA(a,f,b,!1)};g.fJ=function(e,f,b){if(4==this.fc(e,f,!1))return!1;var g=e.Ca(),c=new a.i,d=new a.i,n=new a.i;e.o(c);f.o(d);c.P(b,b);d.P(b,b);n.K(c);n.Ga(d);var m,k,c=null;m=e.pb;null!=m?(k=m.Ab,c=m.nn,null==k&&(k=m=a.Ia.ij(e,n))):k=m=a.Ia.ij(e,n);var h=k.Re(),q=null;null!=c&&(q=c.Re());var l=new a.b,v=new a.b,t=!1,y=b*b,c=new a.Wk(f.F());for(m=0;m<f.F();m++)c.write(m,0);for(m=0;m<f.F();m++)if(f.w(m,l),n.contains(l))if(d.K(l.x,l.y,l.x,l.y),null==q||(q.Ch(d,b),-1!=q.next())){h.Ch(d,
b);for(var r=h.next();-1!=r;r=h.next())if(g.Sb(k.da(r)),r=g.ia(),r.Kb(r.Gd(l,!1),v),a.b.Zb(l,v)<=y){c.write(m,1);t=!0;break}}if(!t)return!1;e=e.Rf();g=new a.pe;d=new a.b;for(m=0;m<f.F();m++)0!=c.read(m)&&(f.w(m,d),g.zs(d.x,d.y));return this.lu(e,g,b)};g.QH=function(e,f,b){if(4==this.fc(e,f,!1))return!1;var g=e.Ca(),c=new a.i,d=new a.i,n=new a.i;e.o(c);f.o(d);c.P(b,b);d.P(b,b);n.K(c);n.Ga(d);var m,k,c=null;m=e.pb;null!=m?(k=m.Ab,c=m.nn,null==k&&(k=m=a.Ia.ij(e,n))):k=m=a.Ia.ij(e,n);var h=k.Re(),q=null;
null!=c&&(q=c.Re());var l=new a.b,v=new a.b,t=!1,y=!1,r=b*b,c=new a.Wk(f.F());for(m=0;m<f.F();m++)c.write(m,0);for(m=0;m<f.F();m++)if(f.w(m,l),n.contains(l))if(d.K(l.x,l.y,l.x,l.y),null!=q&&(q.Ch(d,b),-1==q.next()))y=!0;else{h.Ch(d,b);for(var B=!1,E=h.next();-1!=E;E=h.next())if(g.Sb(k.da(E)),E=g.ia(),E.Kb(E.Gd(l,!1),v),a.b.Zb(l,v)<=r){c.write(m,1);B=t=!0;break}B||(y=!0)}else y=!0;if(!t||!y)return!1;e=e.Rf();g=new a.pe;d=new a.b;for(m=0;m<f.F();m++)0!=c.read(m)&&(f.w(m,d),g.zs(d.x,d.y));return!this.lu(e,
g,b)};g.IH=function(e,f,b){var c=new a.i,d=new a.i;e.o(c);f.o(d);if(!g.rc(c,d,b)||4==g.fc(e,f,!1)||!g.eA(e,f,b,!0))return!1;e=e.Rf();return!g.nA(e,f,b)};g.MI=function(e,f,b){var c=new a.i,d=new a.i;e.o(c);f.o(d);return d.ba()>b&&d.aa()>b?!1:g.ye(c,d,b)};g.nI=function(e,f,b){var c=new a.i,d=new a.i;e.o(c);f.o(d);return g.rc(d,c,b)?!1:!g.cA(e,d,b)};g.cJ=function(e,f,b){var c=new a.i,d=new a.i;e.o(c);f.o(d);if(d.ba()<=b&&d.aa()<=b)return d=f.qq(),g.bw(e,d,b);if(d.ba()<=b||d.aa()<=b)return d=new a.Xa,
c=new a.Va,f.uf(0,c),d.df(c),f.uf(2,c),d.lineTo(c),g.cF(e,d,b);e=e.Ca();f=new a.i;c=new a.i;f.K(d);c.K(d);f.P(-b,-b);c.P(b,b);for(var d=!1,n=new a.i,m=new a.i;e.kb();)for(;e.La();){e.ia().o(n);m.K(f);m.Ga(n);if(!m.s()&&(m.ba()>b||m.aa()>b))return!1;m.K(c);m.Ga(n);m.s()||(d=!0)}return d};g.XI=function(e,f,b){var c=new a.i,d=new a.i;e.o(c);f.o(d);if(g.rc(c,d,b)||g.rc(d,c,b)||g.rc(d,c,b)||d.ba()>b&&d.aa()>b||d.ba()<=b&&d.aa()<=b)return!1;c=new a.Xa;d=new a.Va;f.uf(0,d);c.df(d);f.uf(2,d);c.lineTo(d);
return g.iA(e,c,b)};g.WJ=function(e,f,b){var c=new a.i,d=new a.i;e.o(c);f.o(d);if(!g.rc(d,c,b)||d.ba()<=b&&d.aa()<=b)return!1;if(d.ba()<=b||d.aa()<=b)return g.rc(d,c,b);e=e.Ca();f=new a.i;f.K(d);f.P(-b,-b);for(var d=!1,c=new a.i,n=new a.i;e.kb();)for(;e.La();)e.ia().o(c),f.jl(c)?d=!0:(n.K(f),n.Ga(c),!n.s()&&(n.ba()>b||n.aa()>b)&&(d=!0));return d};g.GH=function(e,f,b){var c=new a.i,d=new a.i;f.o(d);e.o(c);if(!g.rc(c,d,b)||d.ba()>b&&d.aa()>b)return!1;if(d.ba()<=b&&d.aa()<=b)return f=f.qq(),g.bA(e,f,
b);c=new a.Xa;d=new a.Va;f.uf(0,d);c.df(d);f.uf(2,d);c.lineTo(d);return g.Wf(c,e,b,!1)};g.MH=function(e,b,c){var f=new a.i,d=new a.i;e.o(f);b.o(d);if(g.rc(d,f,c)||d.ba()<=c&&d.aa()<=c)return!1;if(d.ba()<=c||d.aa()<=c)return f=new a.Xa,d=new a.Va,b.uf(0,d),f.df(d),b.uf(2,d),f.lineTo(d),g.LE(e,f,c);e=e.Ca();b=new a.i;f=new a.i;f.K(d);b.K(d);f.P(-c,-c);b.P(c,c);for(var n=d=!1,m=new a.i,k=new a.i;e.kb();)for(;e.La();)if(e.ia().o(m),n||b.contains(m)||(n=!0),d||(k.K(f),k.Ga(m),!k.s()&&(k.ba()>c||k.aa()>
c)&&(d=!0)),d&&n)return!0;return!1};g.LI=function(e,b,c){var f=new a.i,d=new a.i;e.o(f);b.o(d);return g.ye(f,d,c)?g.OI(e,b,c)?!0:g.Pw(e,b,c,!1,!0,!1):!1};g.xI=function(a,b,c){return!g.nA(a,b,c)};g.bJ=function(a,b,c){return g.Pw(a,b,c,!1,!1,!0)};g.kA=function(e,b,c){var f=new a.i,d=new a.i;e.o(f);b.o(d);return g.rc(f,d,c)?g.Pw(b,e,c,!0,!1,!1):!1};g.lu=function(e,b,g){g*=g;for(var f=new a.b,c=new a.b,d=0;d<b.F();d++){b.w(d,c);for(var n=!1,m=0;m<e.F();m++)if(e.w(m,f),a.b.Zb(f,c)<=g){n=!0;break}if(!n)return!1}return!0};
g.mu=function(e,b,c){var f=new a.i,d=new a.i;e.o(f);b.o(d);return g.ye(f,d,c)};g.lA=function(a,b,c){b=b.w();return g.or(a,b,c)};g.HJ=function(a,b,c){return g.mu(a,b,c)};g.PH=function(a,b,c){return!g.lA(a,b,c)};g.DI=function(e,b,c){var f=new a.i,d=new a.i;e.o(f);b.o(d);return d.ba()>c||d.aa()>c?!1:g.ye(f,d,c)};g.uI=function(e,b,c){var f=new a.i,d=new a.i;e.o(f);b.o(d);if(g.rc(d,f,c))return!1;b=new a.i;b.K(d);b.P(c,c);c=new a.b;for(d=0;d<e.F();d++)if(e.w(d,c),b.contains(c))return!1;return!0};g.eJ=function(e,
b,g){var f=new a.i,c=new a.i,d=new a.i;b.o(f);if(f.ba()<=g&&f.aa()<=g)return!1;if(f.ba()<=g||f.aa()<=g){b=new a.b;var n=!1;c.K(f);d.K(f);c.P(g,g);f.ba()>g?d.P(0,-g):d.P(-g,0);for(var m=0;m<e.F();m++)if(e.w(m,b),c.contains(b)){if(f.ba()>g){if(b.y>d.C&&b.y<d.G)return!1}else if(b.x>d.v&&b.x<d.B)return!1;n=!0}return n}c.K(f);d.K(f);c.P(g,g);d.P(-g,-g);b=new a.b;n=!1;for(m=0;m<e.F();m++)if(e.w(m,b),c.contains(b)){if(d.jl(b))return!1;n=!0}return n};g.LG=function(e,b,c){var f=new a.i,d=new a.i;e.o(f);b.o(d);
if(!g.rc(d,f,c))return!1;if(d.ba()<=c&&d.aa()<=c)return g.ye(f,d,c);if(d.ba()<=c||d.aa()<=c){b=!1;var f=new a.i,n=new a.i;f.K(d);n.K(d);d.ba()>c?f.P(0,-c):f.P(-c,0);n.P(c,c);for(var m=new a.b,k=0;k<e.F();k++){e.w(k,m);if(!n.contains(m))return!1;d.ba()>c?m.y>f.C&&m.y<f.G&&(b=!0):m.x>f.v&&m.x<f.B&&(b=!0)}return b}b=!1;f=new a.i;n=new a.i;f.K(d);n.K(d);f.P(-c,-c);n.P(c,c);m=new a.b;for(k=0;k<e.F();k++){e.w(k,m);if(!n.contains(m))return!1;f.jl(m)&&(b=!0)}return b};g.LH=function(e,b,c){var f=new a.i,d=
new a.i;e.o(f);b.o(d);if(!g.rc(f,d,c)||d.ba()>c||d.aa()>c)return!1;b=b.qq();return!g.or(e,b,c)};g.mI=function(e,b,c){var f=new a.i,d=new a.i;e.o(f);b.o(d);if(g.rc(d,f,c)||d.ba()<=c&&d.aa()<=c)return!1;if(d.ba()<=c||d.aa()<=c){b=new a.i;f=new a.i;b.K(d);d.ba()>c?b.P(0,-c):b.P(-c,0);f.K(d);f.P(c,c);for(var n=new a.b,m=!1,k=!1,h=0;h<e.F();h++)if(e.w(h,n),m||(d.ba()>c?n.y>b.C&&n.y<b.G&&(m=!0):n.x>b.v&&n.x<b.B&&(m=!0)),k||f.contains(n)||(k=!0),m&&k)return!0;return!1}b=new a.i;f=new a.i;b.K(d);b.P(-c,-c);
f.K(d);f.P(c,c);n=new a.b;k=m=!1;for(h=0;h<e.F();h++)if(e.w(h,n),!m&&b.jl(n)&&(m=!0),k||f.contains(n)||(k=!0),m&&k)return!0;return!1};g.dB=function(e,b,g){return a.b.Zb(e,b)<=g*g?!0:!1};g.rM=function(e,b,g){return a.b.Zb(e,b)>g*g?!0:!1};g.hz=function(a,b,c){return g.dB(a,b,c)};g.KA=function(e,b,c){var f=new a.i;f.K(e);return g.ye(f,b,c)};g.ru=function(e,b,g){var f=new a.i;f.K(b);f.P(g,g);return!f.contains(e)};g.ax=function(e,b,g){if(b.ba()<=g&&b.aa()<=g)return!1;var f=new a.i,c=new a.i;f.K(b);f.P(g,
g);if(!f.contains(e))return!1;if(b.ba()<=g||b.aa()<=g){c.K(b);b.ba()>g?c.P(0,-g):c.P(-g,0);if(b.ba()>g){if(e.y>c.C&&e.y<c.G)return!1}else if(e.x>c.v&&e.x<c.B)return!1;return!0}c.K(b);c.P(-g,-g);return c.jl(e)?!1:!0};g.bx=function(e,b,g){if(b.ba()<=g&&b.aa()<=g)return!0;if(b.ba()<=g||b.aa()<=g){var f=new a.i;f.K(b);b.ba()>g?f.P(0,-g):f.P(-g,0);var c=!1;b.ba()>g?e.y>f.C&&e.y<f.G&&(c=!0):e.x>f.v&&e.x<f.B&&(c=!0);return c}f=new a.i;f.K(b);f.P(-g,-g);return f.jl(e)};g.YL=function(a,b,c){return g.KA(a,
b,c)};g.ye=function(a,b,c){return g.rc(a,b,c)&&g.rc(b,a,c)};g.nj=function(e,b,g){var f=new a.i;f.K(b);f.P(g,g);return!e.jc(f)};g.kT=function(e,b,c){if(e.ba()<=c&&e.aa()<=c){var f=e.Af();return g.ax(f,b,c)}if(b.ba()<=c&&b.aa()<=c)return f=b.Af(),g.ax(f,e,c);e.ba()>c&&e.aa()>c&&(b.ba()<=c||b.aa()<=c)?f=b:(f=e,e=b);if(f.ba()<=c||f.aa()<=c){if(e.ba()<=c||e.aa()<=c){b=new a.yb;var d=new a.yb,n=[0,0],m=[0,0],k=new a.b;f.Yl(k);b.ed(k);f.Zl(k);b.vd(k);e.Yl(k);d.ed(k);e.Zl(k);d.vd(k);b.Ga(d,null,n,m,c);return 1!=
b.Ga(d,null,null,null,c)?!1:0==n[0]||1==n[1]||0==m[0]||1==m[1]}b=new a.i;d=new a.i;b.K(e);b.P(-c,-c);d.K(b);d.Ga(f);return!d.s()&&(d.ba()>c||d.aa()>c)?!1:!0}e.P(c,c);d=new a.i;d.K(f);d.Ga(e);return d.s()||!d.s()&&d.ba()>c&&d.aa()>c?!1:!0};g.fT=function(e,b,c){if(g.rc(e,b,c)||g.rc(b,e,c)||e.ba()<=c&&e.aa()<=c||b.ba()<=c&&b.aa()<=c)return!1;if(e.ba()<=c||e.aa()<=c){if(b.ba()>c&&b.aa()>c)return!1;var f=new a.yb,d=new a.yb,n=[0,0],m=[0,0],k=new a.b;e.Yl(k);f.ed(k);e.Zl(k);f.vd(k);b.Yl(k);d.ed(k);b.Zl(k);
d.vd(k);f.Ga(d,null,n,m,c);return 2!=f.Ga(d,null,null,null,c)?!1:(0<n[0]||1>n[1])&&(0<m[0]||1>m[1])}if(b.ba()<=c||b.aa()<=c)return!1;f=new a.i;f.K(e);f.Ga(b);return f.s()||f.ba()<=c||f.aa()<=c?!1:!0};g.Bz=function(e,b,c){if(!g.rc(e,b,c))return!1;if(e.ba()<=c&&e.aa()<=c)return e=e.Af(),g.bx(e,b,c);if(b.ba()<=c&&b.aa()<=c)return b=b.Af(),g.bx(b,e,c);if(e.ba()<=c||e.aa()<=c)return g.rc(e,b,c);if(b.ba()<=c||b.aa()<=c){var f=new a.i;f.K(e);f.P(-c,-c);if(f.jl(b))return!0;e=new a.i;e.K(f);e.Ga(b);return e.s()||
e.ba()<=c&&e.aa()<=c?!1:!0}return g.rc(e,b,c)};g.cT=function(e,b,c){if(g.rc(e,b,c)||g.rc(b,e,c)||e.ba()<=c&&e.aa()<=c||b.ba()<=c&&b.aa()<=c||b.ba()>c&&b.aa()>c&&e.ba()>c&&e.aa()>c)return!1;var f;e.ba()>c&&e.aa()>c?f=b:(f=e,e=b);if(e.ba()>c&&e.aa()>c){b=new a.i;var d=new a.i;d.K(e);d.P(-c,-c);b.K(d);b.Ga(f);return b.s()||b.ba()<=c&&b.aa()<=c?!1:!0}b=new a.yb;var d=new a.yb,n=[0,0],m=[0,0],k=new a.b;f.Yl(k);b.ed(k);f.Zl(k);b.vd(k);e.Yl(k);d.ed(k);e.Zl(k);d.vd(k);b.Ga(d,null,n,m,c);return 1!=b.Ga(d,
null,null,null,c)?!1:0<n[0]&&1>n[1]&&0<m[0]&&1>m[1]};g.ZC=function(e,b,g){var f,c,d=new a.i,n=new a.i,m=new a.cl(e,b,g,!0);if(!m.next())return!0;if(this.ED(e,b,g))return!1;var k;k=e;var h;h=null;1736==b.D()&&(h=b);var q=!1,l=!1;do{f=m.jk();c=m.ek();c=b.Fa(b.Ea(c));d.K(m.Fw());d.P(g,g);if(d.contains(c)&&(c=a.gd.he(k,c,0),0!=c)||1736==b.D()&&(f=e.Fa(e.Ea(f)),n.K(m.jw()),n.P(g,g),n.contains(f)&&(c=a.gd.he(h,f,0),0!=c)))return!1;q||(!a.ff.An(e,b.ea()-1)||null!=e.pb&&null!=e.pb.Ab?k=e:(k=new a.Ka,e.copyTo(k),
k.dj(1)),q=!0);1736!=b.D()||l||(l=b,!a.ff.An(l,e.ea()-1)||null!=b.pb&&null!=b.pb.Ab?h=b:(h=new a.Ka,l.copyTo(h),h.dj(1)),l=!0)}while(m.next());return!0};g.rc=function(e,b,g){var f=new a.i;f.K(e);f.P(g,g);return f.contains(b)};g.lm=function(e,b,g){var f=new a.i;f.K(b);f.P(g,g);b=new a.b;e.Yl(b);if(!f.contains(b))return!0;e.YE(b);if(!f.contains(b))return!0;e.aF(b);if(!f.contains(b))return!0;e.Zl(b);return f.contains(b)?!1:!0};g.jA=function(e,b,g){if(e.ea()!=b.ea()||e.F()!=b.F())return!1;var f=new a.b,
c=new a.b,d=!0;g*=g;for(var n=0;n<e.ea();n++){if(e.Dc(n)!=b.Dc(n)){d=!1;break}for(var m=e.Ea(n);m<b.Dc(n);m++)if(e.w(m,f),b.w(m,c),a.b.Zb(f,c)>g){d=!1;break}if(!d)break}return d?!0:!1};g.OI=function(e,b,g){if(e.F()!=b.F())return!1;var f=new a.b,c=new a.b,d=!0;g*=g;for(var n=0;n<e.F();n++)if(e.w(n,f),b.w(n,c),a.b.Zb(f,c)>g){d=!1;break}return d?!0:!1};g.Pw=function(e,b,g,c,d,m){var f=!1,n;e.F()>b.F()?(c&&(c=!1,f=!0),n=b):(n=e,e=b);b=null;if(d||m||f){b=new a.Wk(e.F());for(var k=0;k<e.F();k++)b.write(k,
0)}var k=new a.i,h=new a.i,q=new a.i;n.o(k);e.o(h);k.P(g,g);h.P(g,g);q.K(k);q.Ga(h);for(var h=new a.b,l=new a.b,v=!0,x=a.Ia.oB(e,q),t=x.Re(),y=g*g,r=0;r<n.F();r++)if(n.w(r,h),q.contains(h)){var B=!1;k.K(h.x,h.y,h.x,h.y);t.Ch(k,g);for(var E=t.next();-1!=E&&!(E=x.da(E),e.w(E,l),a.b.Zb(h,l)<=y&&((d||m||f)&&b.write(E,1),B=!0,c));E=t.next());if(!B&&(v=!1,d||c))return!1}else{if(d||c)return!1;v=!1}if(m&&v)return!1;if(c)return!0;for(k=0;k<e.F();k++)if(1==b.read(k)){if(m)return!0}else if(d||f)return!1;return m?
!1:!0};g.nA=function(e,b,g){var f;e.F()>b.F()?f=b:(f=e,e=b);b=new a.i;var c=new a.i,d=new a.i;f.o(b);e.o(c);b.P(g,g);c.P(g,g);d.K(b);d.Ga(c);for(var c=new a.b,n=new a.b,m=g*g,k=a.Ia.oB(e,d),h=k.Re(),q=0;q<f.F();q++)if(f.w(q,c),d.contains(c)){b.K(c.x,c.y,c.x,c.y);h.Ch(b,g);for(var l=h.next();-1!=l;l=h.next())if(e.w(k.da(l),n),a.b.Zb(c,n)<=m)return!0}return!1};g.Vv=function(a,b,c,d){return g.Wf(a,b,c,d)&&g.Wf(b,a,c,d)};g.Wf=function(e,f,c,d){function n(a,e){return v.IB(a,e)}var m=!0,k=[0,0],h=[0,0],
q=0,l=new a.ga(0),v=new g,x,t=new a.i,y=new a.i,r=new a.i;e.o(t);f.o(y);t.P(c,c);y.P(c,c);r.K(t);r.Ga(y);e=e.Ca();var y=f.Ca(),B=null,E=B=null,z=f.pb;null!=z?(B=z.Ab,E=z.nn,null==B&&(B=a.Ia.ij(f,r))):B=a.Ia.ij(f,r);f=B.Re();z=null;for(null!=E&&(z=E.Re());e.kb();)for(;e.La();){var u=!1,C=e.ia();C.o(t);if(!t.jc(r))return!1;if(null!=z&&(z.Ch(t,c),-1==z.next()))return m=!1;E=C.$b();f.Fn(C,c);for(x=f.next();-1!=x;x=f.next()){y.Sb(B.da(x));x=y.ia();var D=C.Ga(x,null,k,h,c);if(2==D&&(!d||h[0]<=h[1])){var D=
k[0],G=k[1],J=h[0],p=h[1];if(D*E<=c&&(1-G)*E<=c){u=!0;q=0;l.resize(0);v.Tg.length=0;for(var w=e.Jb(),J=!0;J;){if(e.La()){C=e.ia();E=C.$b();D=C.Ga(x,null,k,h,c);if(2==D&&(!d||h[0]<=h[1])&&(D=k[0],G=k[1],D*E<=c&&(1-G)*E<=c)){w=e.Jb();continue}if(y.La()&&(x=y.ia(),D=C.Ga(x,null,k,h,c),2==D&&(!d||h[0]<=h[1])&&(D=k[0],G=k[1],D*E<=c&&(1-G)*E<=c))){w=e.Jb();continue}}J=!1}w!=e.Jb()&&(e.Sb(w),e.ia());break}else w=e.Jb(),x=b.Oa(w,e.Qa,D,G,y.Jb(),y.Qa,J,p),v.Tg.push(x),l.add(l.size)}}if(!u){if(q==v.Tg.length)return!1;
1<l.size-q&&l.xd(q,l.size,n);for(u=0;q<v.Tg.length;q++)if(x=v.Tg[l.get(q)],!(x.Oi<u&&x.ji<u)){if(E*(x.Oi-u)>c)return!1;u=x.ji;if(E*(1-u)<=c||1==u)break}if(E*(1-u)>c)return!1;q=0;l.resize(0);v.Tg.length=0}}return m};g.iA=function(e,b,c){if(1>g.Zv(e,b,c,null))return!1;var f=new a.i,d=new a.i;e.o(f);b.o(d);var n=g.lm(f,d,c),f=g.lm(d,f,c);return n&&f?!0:n&&!f?!g.Wf(b,e,c,!1):f&&!n?!g.Wf(e,b,c,!1):!g.Wf(e,b,c,!1)&&!g.Wf(b,e,c,!1)};g.Zv=function(e,f,c,d){function n(a,e){return y.IB(a,e)}var m,k;e.Iw()>
f.Iw()?(m=f,k=e):(m=e,k=f);e=m.Ca();f=k.Ca();var h=[0,0],q=[0,0],l=-1,v=0,x,t=new a.ga(0),y=new g,r,B=new a.i,E=new a.i,z=new a.i;m.o(B);k.o(E);B.P(c,c);E.P(c,c);z.K(B);z.Ga(E);m=null;null!=d&&(m=new a.b);x=E=E=null;var u=k.pb;null!=u?(E=u.Ab,x=u.nn,null==E&&(E=a.Ia.ij(k,z))):E=a.Ia.ij(k,z);k=E.Re();u=null;for(null!=x&&(u=x.Re());e.kb();)for(x=0;e.La();){var C=e.ia();C.o(B);if(B.jc(z)&&(null==u||(u.Ch(B,c),-1!=u.next()))){var D=C.$b();k.Fn(C,c);for(var G=k.next();-1!=G;G=k.next()){var J=E.da(G);f.Sb(J);
r=f.ia();var p=r.$b(),w=C.Ga(r,null,h,q,c);if(0<w){var G=h[0],l=q[0],K=2==w?h[1]:NaN,M=2==w?q[1]:NaN;if(2==w){if(D*(K-G)>c)return l=1;var U=D*(K-G);if(f.La()){r=f.ia();w=C.Ga(r,null,h,null,c);if(2==w){var w=h[0],O=h[1],w=D*(O-w);if(U+w>c)return l=1}f.Sb(J);f.ia()}if(!f.wl()){f.oi();r=f.oi();w=C.Ga(r,null,h,null,c);if(2==w&&(w=h[0],O=h[1],w=D*(O-w),U+w>c))return l=1;f.Sb(J);f.ia()}if(e.La()){J=e.Jb();C=e.ia();w=C.Ga(r,null,h,null,c);if(2==w&&(w=h[0],O=h[1],w=D*(O-w),U+w>c))return l=1;e.Sb(J);e.ia()}if(!e.wl()){J=
e.Jb();e.oi();C=e.oi();w=C.Ga(r,null,h,null,c);if(2==w&&(w=h[0],O=h[1],w=p*(O-w),U+w>c))return l=1;e.Sb(J);e.ia()}r=b.Oa(e.Jb(),e.Qa,G,K,f.Jb(),f.Qa,l,M);y.Tg.push(r);t.add(t.size)}l=0;null!=d&&(C.Kb(G,m),d.add(m.x),d.add(m.y))}}if(v<y.Tg.length){t.xd(v,t.size,n);C=0;for(G=y.Tg[t.get(v)].Jl;v<y.Tg.length;v++)if(r=y.Tg[t.get(v)],!(r.Oi<C&&r.ji<C))if(D*(r.Oi-C)>c)x=D*(r.ji-r.Oi),C=r.ji,G=r.Jl;else{r.Jl!=G?(x=D*(r.ji-r.Oi),G=r.Jl):x+=D*(r.ji-r.Oi);if(x>c)return l=1;C=r.ji;if(1==C)break}D*(1-C)>c&&(x=
0);v=0;t.resize(0);y.Tg.length=0}}}return l};g.ED=function(e,b,g){var f=e.Ca(),c=b.Ca();for(e=new a.cl(e,b,g,!1);e.next();){b=e.jk();var d=e.ek();f.Sb(b);c.Sb(d);b=f.ia();if(0<c.ia().Ga(b,null,null,null,g))return!0}return!1};g.eA=function(e,b,g,c){var f=e.Ca(),d=new a.i,n=new a.i,m=new a.i;e.o(d);b.o(n);d.P(g,g);d.contains(n);n.P(g,g);m.K(d);m.Ga(n);d=e.pb;null!=d?(d=d.Ab,null==d&&(d=a.Ia.ij(e,m))):d=a.Ia.ij(e,m);e=d.Re();for(var k=new a.b,h=new a.b,q=g*g,l=0;l<b.F();l++)if(b.w(l,k),m.contains(k)){n.K(k.x,
k.y,k.x,k.y);e.Ch(n,g);for(var v=!1,x=e.next();-1!=x;x=e.next())if(f.Sb(d.da(x)),x=f.ia(),x.Kb(x.Gd(k,!1),h),a.b.Zb(h,k)<=q){v=!0;break}if(c){if(!v)return!1}else if(v)return!0}return c?!0:!1};g.ex=function(e,b,g){var f=new a.b,c=g*g,d=e.Ca();e=e.pb;if(null!=e&&(e=e.Ab,null!=e)){var n=new a.i;n.K(b);g=e.xw(n,g);for(n=g.next();-1!=n;n=g.next())if(d.Sb(e.da(n)),d.La()){var n=d.ia(),m=n.Gd(b,!1);n.Kb(m,f);if(a.b.Zb(b,f)<=c)return!0}return!1}for(e=new a.i;d.kb();)for(;d.La();)if(n=d.ia(),n.o(e),e.P(g,
g),e.contains(b)&&(m=n.Gd(b,!1),n.Kb(m,f),a.b.Zb(b,f)<=c))return!0;return!1};g.bA=function(a,b,c){return g.ex(a,b,c)&&!g.bw(a,b,c)};g.bw=function(a,b,c){a=a.Rf();return!g.or(a,b,c)};g.cA=function(e,b,g){if(e.Hm()){var f=new a.yb(b.v,b.C,b.v,b.G),c=new a.yb(b.v,b.G,b.B,b.G),d=new a.yb(b.B,b.G,b.B,b.C);b=new a.yb(b.B,b.C,b.v,b.C);for(e=e.Ca();e.kb();)for(;e.La();){var n=e.ia();if(n.jc(f,g)||n.jc(c,g)||n.jc(d,g)||n.jc(b,g))return!0}}else{f=new a.i;f.K(b);f.P(g,g);g=e.mc(0);c=new a.b;d=new a.b;b=new a.b;
for(var n=new a.b,m=0,k=e.ea();m<k;m++)for(var h=!0,q=e.Ea(m),l=e.Dc(m);q<l;q++)if(h)g.ec(2*q,d),h=!1;else{g.ec(2*q,c);b.J(d);n.J(c);if(0!=f.Nv(b,n))return!0;d.J(c)}}return!1};g.fc=function(e,b,c){var f=e.D(),d=b.D();if(a.T.Th(f)){var n=e.pb;if(null!=n&&(n=n.hi,null!=n))if(33==d){var m=b.w(),m=n.Kk(m.x,m.y);if(1==m)return 1;if(0==m)return 4}else{m=new a.i;b.o(m);m=n.Dn(m);if(1==m)return 1;if(0==m)return 4;if(c&&a.T.Th(d)&&g.zz(b,n))return 1073741824}}if(a.T.Th(d)&&(n=b.pb,null!=n&&(n=n.hi,null!=n)))if(33==
f){e=e.w();m=n.Kk(e.x,e.y);if(1==m)return 2;if(0==m)return 4}else{b=new a.i;e.o(b);m=n.Dn(b);if(1==m)return 2;if(0==m)return 4;if(c&&a.T.Th(f)&&g.zz(e,n))return 1073741824}return 0};g.zz=function(e,b){for(var f=e.F(),g=new a.b,c=0;c<f;c++)if(e.w(c,g),1==b.Kk(g.x,g.y))return!0;return!1};g.AE=function(e,b,g,c){for(var f=1<=e.rj(0)&&1<=b.rj(0),d=e.Ca(),n=b.Ca(),m=[0,0],k=[0,0],h=new a.cl(e,b,g,!1),q=!1;h.next();){var l=h.jk(),v=h.ek();d.Sb(l);n.Sb(v);l=d.ia();v=n.ia().Ga(l,null,k,m,g);if(2==v){q=m[0];
v=m[1];l=l.$b();if(f&&(v-q)*l>g)return!1;q=!0}else if(0!=v){q=m[0];l=k[0];if(0<q&&1>q&&0<l&&1>l)return!1;q=!0}}if(!q)return!1;d=new a.i;n=new a.i;f=new a.i;e.o(d);b.o(n);d.P(1E3*g,1E3*g);n.P(1E3*g,1E3*g);f.K(d);f.Ga(n);return 10<e.F()&&(e=a.Ed.clip(e,f,g,0),e.s())||10<b.F()&&(b=a.Ed.clip(b,f,g,0),b.s())?!1:a.el.vr(e,b,g,"F********",c)};g.wD=function(e,b,c,d){var f=1<=e.rj(0)&&1<=b.rj(0),n=new a.i,m=new a.i,k=new a.i;e.o(n);b.o(m);for(var h=!1,q=g.lm(n,m,c),l=g.lm(m,n,c),v=e.Ca(),x=b.Ca(),t=[0,0],
y=[0,0],r=new a.cl(e,b,c,!1);r.next();){var B=r.jk(),E=r.ek();v.Sb(B);x.Sb(E);E=v.ia();B=x.ia().Ga(E,null,y,t,c);if(2==B){var B=t[0],z=t[1],E=E.$b();if(f&&(z-B)*E>c&&(h=!0,q&&l))return!0}else if(0!=B&&(B=t[0],E=y[0],0<B&&1>B&&0<E&&1>E))return!0}f=new a.i;v=new a.i;f.K(n);f.P(1E3*c,1E3*c);v.K(m);v.P(1E3*c,1E3*c);k.K(f);k.Ga(v);n="";n=h?n+"**":n+"T*";if(q){if(10<b.F()&&(b=a.Ed.clip(b,k,c,0),b.s()))return!1;n+="****"}else n+="T***";if(l){if(10<e.F()&&(e=a.Ed.clip(e,k,c,0),e.s()))return!1;n+="***"}else n+=
"T**";return a.el.vr(e,b,c,n.toString(),d)};g.bC=function(e,b,c,d){var f=[!1],n=g.wB(e,b,c,f);if(f[0])return n;f=new a.i;b.o(f);f.P(1E3*c,1E3*c);return 10<e.F()&&(e=a.Ed.clip(e,f,c,0),e.s())?!1:a.el.su(e,b,c,d)};g.wB=function(e,b,g,c){c[0]=!1;for(var f=e.Ca(),d=b.Ca(),n=[0,0],m=[0,0],k=new a.cl(e,b,g,!1),h=!1;k.next();){var q=k.jk(),l=k.ek();f.Sb(q,-1);d.Sb(l,-1);q=f.ia();q=d.ia().Ga(q,null,m,n,g);if(0!=q&&(h=!0,1==q&&(q=n[0],l=m[0],0<q&&1>q&&0<l&&1>l)))return c[0]=!0,!1}if(!h){c[0]=!0;n=new a.i;
e.o(n);n.P(g,g);k=e;h=!1;m=new a.i;c=0;for(f=b.ea();c<f;c++)if(0<b.Ha(c)){b.Ti(c,m);if(n.jc(m)){if(d=b.Fa(b.Ea(c)),d=a.ff.xl(k,d,0),0==d)return!1}else return!1;h||(!a.ff.An(e,b.ea()-1)||null!=e.pb&&null!=e.pb.Ab?k=e:(d=new a.Ka,e.copyTo(d),d.dj(1),k=d),h=!0)}if(1==e.ea()||1607==b.D())return!0;n=new a.i;b.o(n);n.P(g,g);m=b;k=!1;g=new a.i;c=0;for(f=e.ea();c<f;c++)if(0<e.Ha(c)){e.Ti(c,g);if(n.jc(g)&&(d=e.Fa(e.Ea(c)),d=a.ff.xl(m,d,0),1==d))return!1;k||(!a.ff.An(b,e.ea()-1)||null!=b.pb&&null!=b.pb.Ab?
m=b:(d=new a.Ka,b.copyTo(d),d.dj(1),m=d),k=!0)}return!0}return!1};g.CE=function(e,b,g,c){for(var f=e.Ca(),d=b.Ca(),n=[0,0],m=[0,0],k=new a.cl(e,b,g,!1),h=!1;k.next();){var q=k.jk(),l=k.ek();f.Sb(q);d.Sb(l);q=f.ia();q=d.ia().Ga(q,null,m,n,g);if(2==q)h=!0;else if(0!=q){h=n[0];q=m[0];if(0<h&&1>h&&0<q&&1>q)return!1;h=!0}}if(!h)return!1;d=new a.i;n=new a.i;f=new a.i;e.o(d);b.o(n);d.P(1E3*g,1E3*g);n.P(1E3*g,1E3*g);f.K(d);f.Ga(n);return 10<e.F()&&(e=a.Ed.clip(e,f,g,0),e.s())||10<b.F()&&(b=a.Ed.clip(b,f,
g,0),b.s())?!1:a.el.Vl(e,b,g,"F********",c)};g.YC=function(e,b,c,d){for(var f=e.Ca(),n=b.Ca(),m=[0,0],k=[0,0],h=new a.cl(e,b,c,!1),q=!1;h.next();){var l=h.jk(),v=h.ek();f.Sb(l);n.Sb(v);l=f.ia();l=n.ia().Ga(l,null,k,m,c);if(2==l)q=!0;else if(0!=l){q=m[0];l=k[0];if(0<q&&1>q&&0<l&&1>l)return!0;q=!0}}if(!q)return!1;n=new a.i;m=new a.i;k=new a.i;h=new a.i;f=new a.i;e.o(n);b.o(m);return g.lm(m,n,c)?(k.K(n),k.P(1E3*c,1E3*c),h.K(m),h.P(1E3*c,1E3*c),f.K(k),f.Ga(h),10<e.F()&&(e=a.Ed.clip(e,f,c,0),e.s())||10<
b.F()&&(b=a.Ed.clip(b,f,c,0),b.s())?!1:c=a.el.Vl(e,b,c,"T********",d)):c=a.el.Vl(e,b,c,"T*****T**",d)};g.jC=function(e,b,c,d){var f=[!1],n=g.wB(e,b,c,f);if(f[0])return n;f=new a.i;b.o(f);f.P(1E3*c,1E3*c);return 10<e.F()&&(e=a.Ed.clip(e,f,c,0),e.s())?!1:a.el.dy(e,b,c,d)};g.YB=function(e,b,g){return 1==a.gd.he(e,b,g)?!0:!1};g.yD=function(e,b,g){return 2==a.gd.he(e,b,g)?!0:!1};g.or=function(e,b,g){var f=new a.b;g*=g;for(var c=0;c<e.F();c++)if(e.w(c,f),a.b.Zb(f,b)<=g)return!1;return!0};g.prototype.IB=
function(a,b){a=this.Tg[a];b=this.Tg[b];return a.Jl<b.Jl||a.Jl==b.Jl&&(a.Wt<b.Wt||a.Wt==b.Wt&&(a.Oi<b.Oi||a.Oi==b.Oi&&(a.ji<b.ji||a.ji==b.ji&&a.dE<b.dE)))?-1:1};return g}();a.hd=c})(E||(E={}));(function(a){var b;(function(a){a[a.InteriorInterior=0]="InteriorInterior";a[a.InteriorBoundary=1]="InteriorBoundary";a[a.InteriorExterior=2]="InteriorExterior";a[a.BoundaryInterior=3]="BoundaryInterior";a[a.BoundaryBoundary=4]="BoundaryBoundary";a[a.BoundaryExterior=5]="BoundaryExterior";a[a.ExteriorInterior=
6]="ExteriorInterior";a[a.ExteriorBoundary=7]="ExteriorBoundary";a[a.ExteriorExterior=8]="ExteriorExterior"})(b||(b={}));var c;(function(a){a[a.AreaAreaPredicates=0]="AreaAreaPredicates";a[a.AreaLinePredicates=1]="AreaLinePredicates";a[a.LineLinePredicates=2]="LineLinePredicates";a[a.AreaPointPredicates=3]="AreaPointPredicates";a[a.LinePointPredicates=4]="LinePointPredicates";a[a.PointPointPredicates=5]="PointPointPredicates"})(c||(c={}));b=function(){function b(){this.Xd=0;this.h=new a.gs;this.A=
[0,0,0,0,0,0,0,0,0];this.Ta=[0,0,0,0,0,0,0,0,0];this.Y=[!1,!1,!1,!1,!1,!1,!1,!1,!1];this.Nl=this.$t=-1}b.py=function(e,b,g,c,d){if(9!=c.length)throw a.g.ra("relation string length has to be 9 characters");for(var f=0;9>f;f++){var n=c.charAt(f);if("*"!=n&&"T"!=n&&"F"!=n&&"0"!=n&&"1"!=n&&"2"!=n)throw a.g.ra("relation string");}f=this.YN(c,e.fb(),b.fb());if(0!=f)return a.hd.qy(e,b,g,f,d);f=new a.i;e.o(f);n=new a.i;b.o(n);var m=new a.i;m.K(f);m.Db(n);g=a.Ia.zd(g,m,!1);e=this.NB(e,g);b=this.NB(b,g);if(e.s()||
b.s())return this.rR(e,b,c);f=b.D();n=!1;switch(e.D()){case 1736:switch(f){case 1736:n=this.vr(e,b,g,c,d);break;case 1607:n=this.Vl(e,b,g,c,d);break;case 33:n=this.ur(e,b,g,c,d);break;case 550:n=this.tr(e,b,g,c,d)}break;case 1607:switch(f){case 1736:n=this.Vl(b,e,g,this.Lo(c),d);break;case 1607:n=this.ey(e,b,g,c,d);break;case 33:n=this.xr(e,b,g,c,d);break;case 550:n=this.wr(e,b,g,c,d)}break;case 33:switch(f){case 1736:n=this.ur(b,e,g,this.Lo(c),d);break;case 1607:n=this.xr(b,e,g,this.Lo(c),d);break;
case 33:n=this.KQ(e,b,g,c);break;case 550:n=this.pr(b,e,g,this.Lo(c),d)}break;case 550:switch(f){case 1736:n=this.tr(b,e,g,this.Lo(c),d);break;case 1607:n=this.wr(b,e,g,this.Lo(c),d);break;case 550:n=this.Wx(e,b,g,c,d);break;case 33:n=this.pr(e,b,g,c,d)}break;default:n=!1}return n};b.vr=function(e,f,g,c,d){var n=new b;n.pi();n.si(c);n.vF();var m=new a.i,k=new a.i;e.o(m);f.o(k);c=!1;a.hd.nj(m,k,g)&&(n.Bs(e,f),c=!0);c||(m=a.hd.fc(e,f,!1),4==m?(n.Bs(e,f),c=!0):1==m?(n.Bv(f),c=!0):2==m&&(n.$A(e),c=!0));
c||(c=new a.fd,e=c.Eb(e),f=c.Eb(f),n.In(c,g,d),n.so(e,f),n.h.xg());return b.Mf(n.A,n.Hc)};b.su=function(e,f,g,c){var d=new b;d.pi();d.si("T*****F**");d.vF();var n=new a.i,m=new a.i;e.o(n);f.o(m);var k=!1;a.hd.nj(n,m,g)&&(d.Bs(e,f),k=!0);k||(n=a.hd.fc(e,f,!1),4==n?(d.Bs(e,f),k=!0):1==n?(d.Bv(f),k=!0):2==n&&(d.$A(e),k=!0));if(k)return n=this.Mf(d.A,d.Hc);k=new a.fd;e=k.Eb(e);n=k.Eb(f);a.aj.$(k,g,c,!1);g=k.hf(n).Rf();k.xo(0,!0,!0);a.mm.$(k,e,-1,!1,c);if(0==k.F(e))return!1;a.mm.$(k,n,-1,!1,c);d.Op(k,
c);f=0==k.F(n);if(!f&&(d.so(e,n),d.h.xg(),n=this.Mf(d.A,d.Hc),!n))return n;e=k.hf(e);k=new a.fd;e=k.Eb(e);n=k.Eb(g);d.Op(k,c);d.Xd=0;d.pi();d.si(f?"T*****F**":"******F**");d.wy();d.so(e,n);d.h.xg();return n=this.Mf(d.A,d.Hc)};b.Vl=function(e,f,g,c,d){var n=new b;n.pi();n.si(c);n.wy();var m=new a.i,k=new a.i;e.o(m);f.o(k);c=!1;a.hd.nj(m,k,g)&&(n.Cs(e,f),c=!0);c||(m=a.hd.fc(e,f,!1),4==m?(n.Cs(e,f),c=!0):1==m&&(n.aB(f),c=!0));c||(c=new a.fd,e=c.Eb(e),f=c.Eb(f),n.In(c,g,d),n.Jg=n.h.uo(),b.es(f,n.h,n.Jg),
n.so(e,f),n.h.vo(n.Jg),n.h.xg());return b.Mf(n.A,n.Hc)};b.dy=function(e,f,g,c){var d=new b;d.pi();d.si("T*****F**");d.wy();var n=new a.i,m=new a.i;e.o(n);f.o(m);var k=!1;a.hd.nj(n,m,g)&&(d.Cs(e,f),k=!0);k||(n=a.hd.fc(e,f,!1),4==n?(d.Cs(e,f),k=!0):1==n&&(d.aB(f),k=!0));if(k)return g=this.Mf(d.A,d.Hc);k=new a.fd;e=k.Eb(e);f=k.Eb(f);d.In(k,g,c);if(0==k.F(e))return!1;d.so(e,f);d.h.xg();return g=this.Mf(d.A,d.Hc)};b.tr=function(e,f,g,c,d){var n=new b;n.pi();n.si(c);n.wF();var m=new a.i,k=new a.i;e.o(m);
f.o(k);c=!1;a.hd.nj(m,k,g)&&(n.Ds(e),c=!0);c||(m=a.hd.fc(e,f,!1),4==m?(n.Ds(e),c=!0):1==m&&(n.cK(),c=!0));c||(c=new a.fd,e=c.Eb(e),f=c.Eb(f),n.In(c,g,d),n.Pv(e,f),n.h.xg());return b.Mf(n.A,n.Hc)};b.ey=function(e,f,g,c,d){var n=new b;n.pi();n.si(c);n.ZR();c=new a.i;var m=new a.i;e.o(c);f.o(m);var k=!1;a.hd.nj(c,m,g)&&(n.CD(e,f),k=!0);k||4!=a.hd.fc(e,f,!1)||(n.CD(e,f),k=!0);k||(c=new a.fd,e=c.Eb(e),f=c.Eb(f),n.In(c,g,d),n.ph=n.h.uo(),n.Jg=n.h.uo(),b.es(e,n.h,n.ph),b.es(f,n.h,n.Jg),n.so(e,f),n.h.vo(n.ph),
n.h.vo(n.Jg),n.h.xg());return b.Mf(n.A,n.Hc)};b.wr=function(e,f,g,c,d){var n=new b;n.pi();n.si(c);n.KF();c=new a.i;var m=new a.i;e.o(c);f.o(m);var k=!1;a.hd.nj(c,m,g)&&(n.dx(e),k=!0);k||4!=a.hd.fc(e,f,!1)||(n.dx(e),k=!0);k||(c=new a.fd,e=c.Eb(e),f=c.Eb(f),n.In(c,g,d),n.ph=n.h.uo(),b.es(e,n.h,n.ph),n.Pv(e,f),n.h.vo(n.ph),n.h.xg());return b.Mf(n.A,n.Hc)};b.Wx=function(e,f,g,c,d){var n=new b;n.pi();n.si(c);n.PF();c=new a.i;var m=new a.i;e.o(c);f.o(m);var k=!1;a.hd.nj(c,m,g)&&(n.PE(),k=!0);k||(c=new a.fd,
e=c.Eb(e),f=c.Eb(f),n.In(c,g,d),n.Pv(e,f),n.h.xg());return b.Mf(n.A,n.Hc)};b.ur=function(e,f,g,c){var d=new b;d.pi();d.si(c);d.wF();var n=new a.i;e.o(n);f=f.w();var m=!1;a.hd.ru(f,n,g)&&(d.Ds(e),m=!0);m||(g=a.gd.he(e,f,g),1==g?(d.A[0]=0,d.A[2]=2,d.A[3]=-1,d.A[5]=1,d.A[6]=-1):2==g?(d.A[6]=-1,0!=e.Mh()?(d.A[0]=-1,d.A[3]=0,d.A[2]=2,d.A[5]=1):(d.A[0]=0,d.A[3]=-1,d.A[5]=-1,g=new a.i,e.o(g),d.A[2]=0==g.ba()&&0==g.aa()?-1:1)):d.Ds(e));return this.Mf(d.A,c)};b.xr=function(e,f,g,c,d){var n=new b;n.pi();n.si(c);
n.KF();var m=new a.i;e.o(m);c=f.w();var k=!1;a.hd.ru(c,m,g)&&(n.dx(e),k=!0);if(!k){var m=null,h=k=!1;if(n.Y[0]||n.Y[6])a.hd.ex(e,c,g)?(n.Y[0]&&(m=a.Hh.il(e,d),h=!a.hd.or(m,c,g),k=!0,n.A[0]=h?-1:0),n.A[6]=-1):(n.A[0]=-1,n.A[6]=0);n.Y[3]&&(null!=m&&m.s()?n.A[3]=-1:(k||(null==m&&(m=a.Hh.il(e,d)),h=!a.hd.or(m,c,g),k=!0),n.A[3]=h?0:-1));n.Y[5]&&(null!=m&&m.s()?n.A[5]=-1:k&&!h?n.A[5]=0:(null==m&&(m=a.Hh.il(e,d)),d=a.hd.mu(m,f,g),n.A[5]=d?-1:0));n.Y[2]&&(0!=e.$b()?n.A[2]=1:(d=new a.pe(e.description),d.Pd(e,
0,e.F()),e=a.hd.mu(d,f,g),n.A[2]=e?-1:0))}return this.Mf(n.A,n.Hc)};b.pr=function(e,f,g,c){var d=new b;d.pi();d.si(c);d.PF();var n=new a.i;e.o(n);f=f.w();var m=!1;a.hd.ru(f,n,g)&&(d.PE(),m=!0);if(!m){n=!1;m=!0;g*=g;for(var k=0;k<e.F();k++){var h=e.Fa(k);a.b.Zb(h,f)<=g?n=!0:m=!1;if(n&&!m)break}n?(d.A[0]=0,d.A[2]=m?-1:0,d.A[6]=-1):(d.A[0]=-1,d.A[2]=0,d.A[6]=0)}return b.Mf(d.A,c)};b.KQ=function(e,f,g,c){e=e.w();f=f.w();for(var d=[],n=0;9>n;n++)d[n]=-1;a.b.Zb(e,f)<=g*g?d[0]=0:(d[2]=0,d[6]=0);d[8]=2;return b.Mf(d,
c)};b.Mf=function(a,b){for(var e=0;9>e;e++)switch(b.charAt(e)){case "T":if(-1==a[e])return!1;break;case "F":if(-1!=a[e])return!1;break;case "0":if(0!=a[e])return!1;break;case "1":if(1!=a[e])return!1;break;case "2":if(2!=a[e])return!1}return!0};b.rR=function(e,b,g){var f=[-1,-1,-1,-1,-1,-1,-1,-1,-1];if(e.s()&&b.s()){for(var c=0;9>c;c++)f[c]=-1;return this.Mf(f,g)}c=!1;e.s()&&(e=b,c=!0);f[0]=-1;f[1]=-1;f[3]=-1;f[4]=-1;f[6]=-1;f[7]=-1;f[8]=2;b=e.D();a.T.Kc(b)?1736==b?0!=e.Mh()?(f[2]=2,f[5]=1):(f[5]=
-1,b=new a.i,e.o(b),f[2]=0==b.ba()&&0==b.aa()?0:1):(b=0!=e.$b(),f[2]=b?1:0,f[5]=a.Hh.No(e)?0:-1):(f[2]=0,f[5]=-1);c&&this.qG(f);return this.Mf(f,g)};b.YN=function(a,f,g){return b.mT(a)?3:b.NS(a)?4:b.nT(a,f,g)?8:b.CR(a,f,g)?16:b.yQ(a)?1:b.LK(a,f,g)?32:0};b.mT=function(a){return"T"==a.charAt(0)&&"*"==a.charAt(1)&&"F"==a.charAt(2)&&"*"==a.charAt(3)&&"*"==a.charAt(4)&&"F"==a.charAt(5)&&"F"==a.charAt(6)&&"F"==a.charAt(7)&&"*"==a.charAt(8)?!0:!1};b.NS=function(a){return"F"==a.charAt(0)&&"F"==a.charAt(1)&&
"*"==a.charAt(2)&&"F"==a.charAt(3)&&"F"==a.charAt(4)&&"*"==a.charAt(5)&&"*"==a.charAt(6)&&"*"==a.charAt(7)&&"*"==a.charAt(8)?!0:!1};b.nT=function(a,b,g){if(0==b&&0==g)return!1;if(2!=b||2!=g)if("F"==a.charAt(0)&&"*"==a.charAt(1)&&"*"==a.charAt(2)&&"T"==a.charAt(3)&&"*"==a.charAt(4)&&"*"==a.charAt(5)&&"*"==a.charAt(6)&&"*"==a.charAt(7)&&"*"==a.charAt(8)||1==b&&1==g&&"F"==a.charAt(0)&&"T"==a.charAt(1)&&"*"==a.charAt(2)&&"*"==a.charAt(3)&&"*"==a.charAt(4)&&"*"==a.charAt(5)&&"*"==a.charAt(6)&&"*"==a.charAt(7)&&
"*"==a.charAt(8))return!0;return 0!=g&&"F"==a.charAt(0)&&"*"==a.charAt(1)&&"*"==a.charAt(2)&&"*"==a.charAt(3)&&"T"==a.charAt(4)&&"*"==a.charAt(5)&&"*"==a.charAt(6)&&"*"==a.charAt(7)&&"*"==a.charAt(8)?!0:!1};b.CR=function(a,b,g){return b>g?"T"==a.charAt(0)&&"*"==a.charAt(1)&&"*"==a.charAt(2)&&"*"==a.charAt(3)&&"*"==a.charAt(4)&&"*"==a.charAt(5)&&"T"==a.charAt(6)&&"*"==a.charAt(7)&&"*"==a.charAt(8)?!0:!1:1==b&&1==g&&"0"==a.charAt(0)&&"*"==a.charAt(1)&&"*"==a.charAt(2)&&"*"==a.charAt(3)&&"*"==a.charAt(4)&&
"*"==a.charAt(5)&&"*"==a.charAt(6)&&"*"==a.charAt(7)&&"*"==a.charAt(8)?!0:!1};b.yQ=function(a){return"T"==a.charAt(0)&&"*"==a.charAt(1)&&"*"==a.charAt(2)&&"*"==a.charAt(3)&&"*"==a.charAt(4)&&"*"==a.charAt(5)&&"F"==a.charAt(6)&&"F"==a.charAt(7)&&"*"==a.charAt(8)?!0:!1};b.LK=function(a,b,g){if(b==g){if(1!=b)return"T"==a.charAt(0)&&"*"==a.charAt(1)&&"T"==a.charAt(2)&&"*"==a.charAt(3)&&"*"==a.charAt(4)&&"*"==a.charAt(5)&&"T"==a.charAt(6)&&"*"==a.charAt(7)&&"*"==a.charAt(8)?!0:!1;if("1"==a.charAt(0)&&
"*"==a.charAt(1)&&"T"==a.charAt(2)&&"*"==a.charAt(3)&&"*"==a.charAt(4)&&"*"==a.charAt(5)&&"T"==a.charAt(6)&&"*"==a.charAt(7)&&"*"==a.charAt(8))return!0}return!1};b.es=function(a,b,g){a=b.ya(a);for(var e=b.Be;-1!=e;e=b.Bf(e))if(0!=(b.md(e)&a)){var f=b.te(e);if(-1==f)b.fm(e,g,0);else{var c=f,d=0;do 0!=(b.Gg(c)&a)&&d++,c=b.Wb(b.sa(c));while(c!=f);b.fm(e,g,d)}}};b.Lo=function(a){var e;e=""+a.charAt(0);e+=a.charAt(3);e+=a.charAt(6);e+=a.charAt(1);e+=a.charAt(4);e+=a.charAt(7);e+=a.charAt(2);e+=a.charAt(5);
return e+=a.charAt(8)};b.prototype.pi=function(){for(var a=0;9>a;a++)this.A[a]=-2,this.Ta[a]=-2};b.qG=function(a){var e=a[1],b=a[2],g=a[5];a[1]=a[3];a[2]=a[6];a[5]=a[7];a[3]=e;a[6]=b;a[7]=g};b.prototype.si=function(a){this.Hc=a;for(a=0;9>a;a++)"*"!=this.Hc.charAt(a)?(this.Y[a]=!0,this.Xd++):this.Y[a]=!1};b.prototype.SF=function(){for(var a=0;9>a;a++)this.Y[a]&&-2==this.A[a]&&(this.A[a]=-1,this.Y[a]=!1)};b.prototype.dc=function(a){if(-2==this.A[a])return!1;if(-1==this.A[a])return this.Y[a]=!1,this.Xd--,
!0;if("T"!=this.Hc.charAt(a)&&"F"!=this.Hc.charAt(a)){if(this.A[a]<this.Ta[a])return!1;this.Y[a]=!1;this.Xd--;return!0}this.Y[a]=!1;this.Xd--;return!0};b.prototype.vF=function(){this.$t=0;this.Ta[0]=2;this.Ta[1]=1;this.Ta[2]=2;this.Ta[3]=1;this.Ta[4]=1;this.Ta[5]=1;this.Ta[6]=2;this.Ta[7]=1;this.Ta[8]=2;this.Y[8]&&(this.A[8]=2,this.Y[8]=!1,this.Xd--)};b.prototype.wy=function(){this.$t=1;this.Nl=3;this.Ta[0]=1;this.Ta[1]=0;this.Ta[2]=2;this.Ta[3]=1;this.Ta[4]=0;this.Ta[5]=1;this.Ta[6]=1;this.Ta[7]=
0;this.Ta[8]=2;this.Y[8]&&(this.A[8]=2,this.Y[8]=!1,this.Xd--)};b.prototype.ZR=function(){this.$t=2;this.Nl=4;this.Ta[0]=1;this.Ta[1]=0;this.Ta[2]=1;this.Ta[3]=0;this.Ta[4]=0;this.Ta[5]=0;this.Ta[6]=1;this.Ta[7]=0;this.Ta[8]=2;this.Y[8]&&(this.A[8]=2,this.Y[8]=!1,this.Xd--)};b.prototype.wF=function(){this.Nl=3;this.Ta[0]=0;this.Ta[1]=-1;this.Ta[2]=2;this.Ta[3]=0;this.Ta[4]=-1;this.Ta[5]=1;this.Ta[6]=0;this.Ta[7]=-1;this.Ta[8]=2;this.Y[1]&&(this.A[1]=-1,this.Y[1]=!1,this.Xd--);this.Y[4]&&(this.A[4]=
-1,this.Y[4]=!1,this.Xd--);this.Y[7]&&(this.A[7]=-1,this.Y[7]=!1,this.Xd--);this.Y[8]&&(this.A[8]=2,this.Y[8]=!1,this.Xd--)};b.prototype.KF=function(){this.Nl=4;this.Ta[0]=0;this.Ta[1]=-1;this.Ta[2]=1;this.Ta[3]=0;this.Ta[4]=-1;this.Ta[5]=0;this.Ta[6]=0;this.Ta[7]=-1;this.Ta[8]=2;this.Y[1]&&(this.A[1]=-1,this.Y[1]=!1,this.Xd--);this.Y[4]&&(this.A[4]=-1,this.Y[4]=!1,this.Xd--);this.Y[7]&&(this.A[7]=-1,this.Y[7]=!1,this.Xd--);this.Y[8]&&(this.A[8]=2,this.Y[8]=!1,this.Xd--)};b.prototype.PF=function(){this.Nl=
5;this.Ta[0]=0;this.Ta[1]=-1;this.Ta[2]=0;this.Ta[3]=-1;this.Ta[4]=-1;this.Ta[5]=-1;this.Ta[6]=0;this.Ta[7]=-1;this.Ta[8]=2;this.Y[1]&&(this.A[1]=-1,this.Y[1]=!1,this.Xd--);this.Y[3]&&(this.A[3]=-1,this.Y[3]=!1,this.Xd--);this.Y[4]&&(this.A[4]=-1,this.Y[4]=!1,this.Xd--);this.Y[5]&&(this.A[5]=-1,this.Y[5]=!1,this.Xd--);this.Y[7]&&(this.A[7]=-1,this.Y[7]=!1,this.Xd--);this.Y[8]&&(this.A[8]=2,this.Y[8]=!1,this.Xd--)};b.prototype.aK=function(a,b,g){var e=!0;this.Y[0]&&(this.HO(a,b,g),e=e&&this.dc(0));
this.Y[1]&&(this.eD(a,b,1),e=e&&this.dc(1));this.Y[2]&&(this.fD(a,b,g,2),e=e&&this.dc(2));this.Y[3]&&(this.eD(a,g,3),e=e&&this.dc(3));this.Y[4]&&(this.gK(a,b,g),e=e&&this.dc(4));this.Y[5]&&(this.eB(a,g,5),e=e&&this.dc(5));this.Y[6]&&(this.fD(a,g,b,6),e=e&&this.dc(6));this.Y[7]&&(this.eB(a,b,7),e=e&&this.dc(7));return e};b.prototype.Bs=function(a,b){this.A[0]=-1;this.A[1]=-1;this.A[3]=-1;this.A[4]=-1;this.iq(a,this.Y[2]?2:-1,this.Hc.charAt(2),this.Y[5]?5:-1,this.Hc.charAt(5));this.iq(b,this.Y[6]?6:
-1,this.Hc.charAt(6),this.Y[7]?7:-1,this.Hc.charAt(7))};b.prototype.iq=function(e,b,g,c,d){if(-1!=b||-1!=c)("T"!=g&&"F"!=g&&-1!=b||"T"!=d&&"F"!=d&&-1!=c?0!=e.Mh():1)?(-1!=b&&(this.A[b]=2),-1!=c&&(this.A[c]=1)):(-1!=c&&(this.A[c]=-1),-1!=b&&(g=new a.i,e.o(g),this.A[b]=0==g.ba()&&0==g.aa()?0:1))};b.prototype.Bv=function(a){this.A[2]=2;this.A[3]=-1;this.A[4]=-1;this.A[5]=1;this.A[6]=-1;this.A[7]=-1;this.iq(a,this.Y[0]?0:-1,this.Hc.charAt(0),this.Y[1]?1:-1,this.Hc.charAt(1))};b.prototype.$A=function(a){this.Bv(a);
b.qG(this.A)};b.prototype.Cs=function(e,b){this.A[0]=-1;this.A[1]=-1;this.A[3]=-1;this.A[4]=-1;if(this.Y[6]){var f=this.Hc.charAt(6),f="T"!=f&&"F"!=f?0!=b.$b():!0;this.A[6]=f?1:0}this.Y[7]&&(f=a.Hh.No(b),this.A[7]=f?0:-1);this.iq(e,this.Y[2]?2:-1,this.Hc.charAt(2),this.Y[5]?5:-1,this.Hc.charAt(5))};b.prototype.aB=function(e){if(this.Y[0]){var b=this.Hc.charAt(0),b="T"!=b&&"F"!=b?0!=e.$b():!0;this.A[0]=b?1:0}this.Y[1]&&(e=a.Hh.No(e),this.A[1]=e?0:-1);this.A[2]=2;this.A[3]=-1;this.A[4]=-1;this.A[5]=
1;this.A[6]=-1;this.A[7]=-1};b.prototype.Ds=function(a){this.A[0]=-1;this.A[3]=-1;this.A[6]=0;this.iq(a,this.Y[2]?2:-1,this.Hc.charAt(2),this.Y[5]?5:-1,this.Hc.charAt(5))};b.prototype.cK=function(){this.A[0]=0;this.A[2]=2;this.A[3]=-1;this.A[5]=1;this.A[6]=-1};b.prototype.CD=function(e,b){this.A[0]=-1;this.A[1]=-1;this.A[3]=-1;this.A[4]=-1;if(this.Y[2]){var f=this.Hc.charAt(2),f="T"!=f&&"F"!=f?0!=e.$b():!0;this.A[2]=f?1:0}this.Y[5]&&(f=a.Hh.No(e),this.A[5]=f?0:-1);this.Y[6]&&(f=this.Hc.charAt(6),
f="T"!=f&&"F"!=f?0!=b.$b():!0,this.A[6]=f?1:0);this.Y[7]&&(f=a.Hh.No(b),this.A[7]=f?0:-1)};b.prototype.dx=function(e){this.A[0]=-1;this.A[3]=-1;if(this.Y[2]){var b=this.Hc.charAt(2),b="T"!=b&&"F"!=b?0!=e.$b():!0;this.A[2]=b?1:0}this.Y[5]&&(e=a.Hh.No(e),this.A[5]=e?0:-1);this.A[6]=0};b.prototype.PE=function(){this.A[0]=-1;this.A[2]=0;this.A[6]=0};b.prototype.bK=function(a,b,g){var e=!0;this.Y[0]&&(this.IO(a,b),e=e&&this.dc(0));this.Y[1]&&(this.EO(a,b,g,this.Jg),e=e&&this.dc(1));this.Y[2]&&(this.FO(a,
b),e=e&&this.dc(2));this.Y[3]&&(this.kK(a,b,g,this.Jg),e=e&&this.dc(3));this.Y[4]&&(this.hK(a,b,g,this.Jg),e=e&&this.dc(4));this.Y[5]&&(this.iK(a,b,g),e=e&&this.dc(5));this.Y[6]&&(this.BM(a,b),e=e&&this.dc(6));this.Y[7]&&(this.AM(a,b,g,this.Jg),e=e&&this.dc(7));return e};b.prototype.uP=function(a,b,g){var e=!0;this.Y[0]&&(this.LO(a,b,g,this.ph,this.Jg),e=e&&this.dc(0));this.Y[1]&&(this.gD(a,b,g,this.ph,this.Jg,1),e=e&&this.dc(1));this.Y[2]&&(this.hD(a,b,g,2),e=e&&this.dc(2));this.Y[3]&&(this.gD(a,
g,b,this.Jg,this.ph,3),e=e&&this.dc(3));this.Y[4]&&(this.mK(a,b,g,this.ph,this.Jg),e=e&&this.dc(4));this.Y[5]&&(this.fB(a,g,this.ph,5),e=e&&this.dc(5));this.Y[6]&&(this.hD(a,g,b,6),e=e&&this.dc(6));this.Y[7]&&(this.fB(a,b,this.Jg,7),e=e&&this.dc(7));return e};b.prototype.bB=function(a,b,g){var e=!0;this.Y[0]&&(this.JO(a,b),e=e&&this.dc(0));this.Y[2]&&(this.GO(a,b),e=e&&this.dc(2));this.Y[3]&&(this.lK(a,b,g),e=e&&this.dc(3));this.Y[5]&&(this.jK(a,b),e=e&&this.dc(5));this.Y[6]&&(this.CM(a,b),e=e&&this.dc(6));
return e};b.prototype.DD=function(a,b,g){var e=!0;this.Y[0]&&(this.MO(a,b,g,this.ph),e=e&&this.dc(0));this.Y[2]&&(this.KO(a,g),e=e&&this.dc(2));this.Y[3]&&(this.oK(a,b,g,this.ph),e=e&&this.dc(3));this.Y[5]&&(this.nK(a,b,g,this.ph),e=e&&this.dc(5));this.Y[6]&&(this.DM(a,b,g),e=e&&this.dc(6));return e};b.prototype.JQ=function(a,b,g){var e=!0;this.Y[0]&&(this.NO(a,b,g),e=e&&this.dc(0));this.Y[2]&&(this.iD(a,b,g,2),e=e&&this.dc(2));this.Y[6]&&(this.iD(a,g,b,6),e=e&&this.dc(6));return e};b.prototype.HO=
function(a,b,g){2!=this.A[0]&&(a=this.h.Qe(a),0!=(a&b)&&0!=(a&g)&&(this.A[0]=2))};b.prototype.eD=function(a,b,g){if(1!=this.A[g]){var e=this.h.Qe(this.h.sa(a));0!=(this.h.Qe(a)&b)&&0!=(e&b)&&(this.A[g]=1)}};b.prototype.fD=function(a,b,g,c){2!=this.A[c]&&(a=this.h.Qe(a),0!=(a&b)&&0==(a&g)&&(this.A[c]=2))};b.prototype.gK=function(a,b,g){if(1!=this.A[4]){var e=this.h.Gg(a);0!=(e&b)&&0!=(e&g)?this.A[4]=1:0!=this.A[4]&&1!=this.h.tb(this.h.fe(this.h.sa(a)),this.ni)&&(a=this.h.md(this.h.jf(a)),0!=(a&b)&&
0!=(a&g)&&(this.A[4]=0))}};b.prototype.eB=function(a,b,g){if(1!=this.A[g]){var e=this.h.Qe(this.h.sa(a));0==(this.h.Qe(a)&b)&&0==(e&b)&&(this.A[g]=1)}};b.prototype.IO=function(a,b){if(1!=this.A[0]){var e=this.h.Qe(this.h.sa(a));0!=(this.h.Qe(a)&b)&&0!=(e&b)&&(this.A[0]=1)}};b.prototype.EO=function(a,b,g,c){if(0!=this.A[1]&&1!=this.h.tb(this.h.fe(this.h.sa(a)),this.ni)){var e=this.h.jf(a),f=this.h.md(e);0==(f&b)&&0!=(this.h.Qe(a)&b)&&(a=this.h.Sf(e,c),0!=(f&g)&&0!=a%2&&(this.A[1]=0))}};b.prototype.FO=
function(a,b){2!=this.A[2]&&0!=(this.h.Gg(a)&b)&&(this.A[2]=2)};b.prototype.kK=function(a,b,g,c){if(1!=this.A[3]){var e=this.h.Gg(a);0!=(e&b)&&0!=(e&g)?this.A[3]=1:0!=this.A[3]&&1!=this.h.tb(this.h.fe(this.h.sa(a)),this.ni)&&(e=this.h.jf(a),a=this.h.md(e),0!=(a&b)&&(b=this.h.Sf(e,c),0!=(a&g)&&0==b%2&&(this.A[3]=0)))}};b.prototype.hK=function(a,b,g,c){if(0!=this.A[4]&&1!=this.h.tb(this.h.fe(this.h.sa(a)),this.ni)){var e=this.h.jf(a);a=this.h.md(e);0!=(a&b)&&(b=this.h.Sf(e,c),0!=(a&g)&&0!=b%2&&(this.A[4]=
0))}};b.prototype.iK=function(a,b,g){1!=this.A[5]&&(a=this.h.Gg(a),0!=(a&b)&&0==(a&g)&&(this.A[5]=1))};b.prototype.BM=function(a,b){if(1!=this.A[6]){var e=this.h.Qe(this.h.sa(a));0==(this.h.Qe(a)&b)&&0==(e&b)&&(this.A[6]=1)}};b.prototype.AM=function(a,b,g,c){if(0!=this.A[7]&&1!=this.h.tb(this.h.fe(this.h.sa(a)),this.ni)){var e=this.h.jf(a),f=this.h.md(e);0==(f&b)&&0==(this.h.Qe(a)&b)&&(a=this.h.Sf(e,c),0!=(f&g)&&0!=a%2&&(this.A[7]=0))}};b.prototype.LO=function(a,b,g,c,d){if(1!=this.A[0]){var e=this.h.Gg(a);
0!=(e&b)&&0!=(e&g)?this.A[0]=1:0!=this.A[0]&&1!=this.h.tb(this.h.fe(this.h.sa(a)),this.ni)&&(a=this.h.jf(a),e=this.h.md(a),0!=(e&b)&&0!=(e&g)&&(b=this.h.Sf(a,c),d=this.h.Sf(a,d),0==b%2&&0==d%2&&(this.A[0]=0)))}};b.prototype.gD=function(a,b,g,c,d,m){if(0!=this.A[m]&&1!=this.h.tb(this.h.fe(this.h.sa(a)),this.ni)){a=this.h.jf(a);var e=this.h.md(a);0!=(e&b)&&0!=(e&g)&&(b=this.h.Sf(a,c),d=this.h.Sf(a,d),0==b%2&&0!=d%2&&(this.A[m]=0))}};b.prototype.hD=function(a,b,g,c){1!=this.A[c]&&(a=this.h.Gg(a),0!=
(a&b)&&0==(a&g)&&(this.A[c]=1))};b.prototype.mK=function(a,b,g,c,d){if(0!=this.A[4]&&1!=this.h.tb(this.h.fe(this.h.sa(a)),this.ni)){a=this.h.jf(a);var e=this.h.md(a);0!=(e&b)&&0!=(e&g)&&(b=this.h.Sf(a,c),d=this.h.Sf(a,d),0!=b%2&&0!=d%2&&(this.A[4]=0))}};b.prototype.fB=function(a,b,g,c){0!=this.A[c]&&1!=this.h.tb(this.h.fe(this.h.sa(a)),this.ni)&&(a=this.h.jf(a),0==(this.h.md(a)&b)&&0!=this.h.Sf(a,g)%2&&(this.A[c]=0))};b.prototype.JO=function(a,b){0!=this.A[0]&&0==(this.h.md(a)&b)&&0!=(this.h.pj(this.h.mw(a))&
b)&&(this.A[0]=0)};b.prototype.GO=function(a,b){2!=this.A[2]&&0!=(this.h.md(a)&b)&&(this.A[2]=2)};b.prototype.lK=function(a,b,g){0!=this.A[3]&&(a=this.h.md(a),0!=(a&b)&&0!=(a&g)&&(this.A[3]=0))};b.prototype.jK=function(a,b){1!=this.A[5]&&0!=(this.h.md(a)&b)&&(this.A[5]=1)};b.prototype.CM=function(a,b){0!=this.A[6]&&0==(this.h.md(a)&b)&&0==(this.h.pj(this.h.mw(a))&b)&&(this.A[6]=0)};b.prototype.MO=function(a,b,g,c){if(0!=this.A[0]){var e=this.h.md(a);0!=(e&b)&&0!=(e&g)&&0==this.h.Sf(a,c)%2&&(this.A[0]=
0)}};b.prototype.KO=function(a,b){1!=this.A[2]&&(-1!=this.h.te(a)?this.A[2]=1:0!=this.A[2]&&0==(this.h.md(a)&b)&&(this.A[2]=0))};b.prototype.oK=function(a,b,g,c){if(0!=this.A[3]){var e=this.h.md(a);0!=(e&b)&&0!=(e&g)&&0!=this.h.Sf(a,c)%2&&(this.A[3]=0)}};b.prototype.nK=function(a,b,g,c){if(0!=this.A[5]){var e=this.h.md(a);0!=(e&b)&&0==(e&g)&&0!=this.h.Sf(a,c)%2&&(this.A[5]=0)}};b.prototype.DM=function(a,b,g){0!=this.A[6]&&(a=this.h.md(a),0==(a&b)&&0!=(a&g)&&(this.A[6]=0))};b.prototype.NO=function(a,
b,g){0!=this.A[0]&&(a=this.h.md(a),0!=(a&b)&&0!=(a&g)&&(this.A[0]=0))};b.prototype.iD=function(a,b,g,c){0!=this.A[c]&&(a=this.h.md(a),0!=(a&b)&&0==(a&g)&&(this.A[c]=0))};b.prototype.so=function(e,b){var f=!1;e=this.h.ya(e);b=this.h.ya(b);this.ni=this.h.Eg();for(var g=this.h.Be;-1!=g;g=this.h.Bf(g)){var c=this.h.te(g);if(-1==c){if(-1!=this.Nl)switch(this.Nl){case 3:f=this.bB(g,e,b);break;case 4:f=this.DD(g,e,b);break;default:throw a.g.ra("internal error");}}else{var d=c;do{var m=d;if(1!=this.h.tb(m,
this.ni)){do{switch(this.$t){case 0:f=this.aK(m,e,b);break;case 1:f=this.bK(m,e,b);break;case 2:f=this.uP(m,e,b);break;default:throw a.g.ra("internal error");}if(f)break;this.h.Bb(m,this.ni,1);m=this.h.Wb(m)}while(m!=d&&!f)}if(f)break;d=this.h.Wb(this.h.sa(m))}while(d!=c);if(f)break}}f||this.SF();this.h.kh(this.ni)};b.prototype.Pv=function(e,b){var f=!1;e=this.h.ya(e);b=this.h.ya(b);for(var g=this.h.Be;-1!=g;g=this.h.Bf(g)){switch(this.Nl){case 3:f=this.bB(g,e,b);break;case 4:f=this.DD(g,e,b);break;
case 5:f=this.JQ(g,e,b);break;default:throw a.g.wa();}if(f)break}f||this.SF()};b.prototype.Op=function(a,b){this.h.Mp(a,b)};b.prototype.In=function(a,b,g){this.tM(a,b,g);this.Op(a,g)};b.prototype.tM=function(e,b,g){a.aj.$(e,b,g,!1);e.xo(0,!0,!0);for(b=e.$c;-1!=b;b=e.we(b))1736==e.Lb(b)&&a.mm.$(e,b,-1,!1,g)};b.NB=function(e,b){var f=e.D();if(a.T.Lc(f))return f=new a.Xa(e.description),f.Bc(e,!0),f;if(197==f){f=new a.i;e.o(f);if(f.ba()<=b&&f.aa()<=b)return f=new a.Va(e.description),e.Af(f),f;if(f.ba()<=
b||f.aa()<=b)return f=new a.Xa(e.description),b=new a.Va,e.uf(0,b),f.df(b),e.uf(2,b),f.lineTo(b),f;f=new a.Ka(e.description);f.Wc(e,!1);return f}return e};return b}();a.el=b})(E||(E={}));(function(a){var b=function(){function e(e){this.Dl=new a.ga(0);this.Ot=new a.ga(0);this.Ar=new a.b;this.Br=new a.b;this.a=e;this.Tq=-1}e.prototype.cc=function(a){return this.a.cc(this.Jw(a))};e.prototype.ot=function(a){var e=this.tw(a);a=this.vC(a);if(this.a.Ua(e)==a){var b=e,e=a;a=b}this.a.uc(e,this.Ar);this.a.uc(a,
this.Br);return this.Ar.y<this.Br.y};e.prototype.Jw=function(a){var e=this.tw(a);a=this.vC(a);return this.a.X(e)==a?e:a};e.prototype.tw=function(a){return this.Dl.get(a)};e.prototype.vC=function(a){return this.Ot.get(a)};e.prototype.hC=function(a){this.Dl.set(a,this.Tq);this.Tq=a};e.prototype.GE=function(e){if(-1!=this.Tq){var b=this.Tq;this.Tq=this.Dl.get(b);this.Dl.set(b,e);this.Ot.set(b,this.a.X(e));return b}null==this.Dl&&(this.Dl=new a.ga(0),this.Ot=new a.ga(0));b=this.Dl.size;this.Dl.add(e);
this.Ot.add(this.a.X(e));return b};e.prototype.Dw=function(a){return this.a.rd(this.tw(a))};return e}();a.BT=b;var c=function(){function e(e){this.me=e;this.Vd=new a.yb;this.Kl=new a.yb;this.eE=0;this.on=null;this.zx=-1}e.prototype.compare=function(a,e,b){b=a.da(b);var f=this.me.$a,g;this.zx==e?g=this.eE:(this.on=f.cc(e),null==this.on?(a=f.a,a.Oc(f.Jw(e),this.Vd),this.on=this.Vd,g=this.Vd.xe(this.me.Zg,0)):g=this.on.xe(this.me.Zg,0),this.eE=g,this.zx=e);a=f.cc(b);var c;null==a?(a=f.a,a.Oc(f.Jw(b),
this.Kl),a=this.Kl,c=this.Kl.xe(this.me.Zg,0)):c=a.xe(this.me.Zg,0);g==c&&(e=f.ot(e),b=f.ot(b),b=Math.min(e?this.on.ha:this.on.ja,b?a.ha:a.ja),e=.5*(b+this.me.Zg),e==this.me.Zg&&(e=b),g=this.on.xe(e,0),c=a.xe(e,0));return g<c?-1:g>c?1:0};e.prototype.reset=function(){this.zx=-1};return e}(),g=function(){function e(){this.Rl=this.Dk=null;this.Za=new a.bj;this.Za.lM();this.Ld=new c(this);this.Za.Hn(this.Ld)}e.prototype.XM=function(){var e=!1;this.Qt&&(e=this.YM());if(1==this.a.ea(this.U)){var b=this.a.Vb(this.U),
e=this.a.Gw(b);this.a.Dy(b,!0);return 0>e?(e=this.a.Cb(b),this.a.lF(e),this.a.Wi(b,this.a.Ua(e)),!0):!1}this.Ak=this.a.Uv();this.kn=this.a.Uv();for(b=this.a.Vb(this.U);-1!=b;b=this.a.bc(b))this.a.Rp(b,this.Ak,0),this.a.Rp(b,this.kn,-1);b=new a.ga(0);this.Zg=NaN;var g=new a.b;this.lr=this.a.ea(this.U);this.fn=this.a.re();this.br=this.a.re();for(var c=this.Dk.gc(this.Dk.Wd);-1!=c;c=this.Dk.bb(c)){var d=this.Dk.getData(c);this.a.uc(d,g);g.y!=this.Zg&&0!=b.size&&(e=this.yr(b)||e,this.Ld.reset(),b.clear(!1));
b.add(d);this.Zg=g.y;if(0==this.lr)break}0<this.lr&&(e=this.yr(b)||e,b.clear(!1));this.a.bf(this.fn);this.a.bf(this.br);for(b=this.a.Vb(this.U);-1!=b;)if(3==this.a.Ei(b,this.Ak)){this.a.Dy(b,!0);g=b;for(b=this.a.Ei(b,this.kn);-1!=b;)c=this.a.Ei(b,this.kn),this.a.bQ(this.U,this.a.bc(g),b),g=b,b=c;b=this.a.bc(g)}else this.a.Dy(b,!1),b=this.a.bc(b);this.a.ty(this.Ak);this.a.ty(this.kn);return e};e.prototype.yr=function(a){return this.WQ(a)};e.prototype.WQ=function(e){var f=!1;null==this.$a&&(this.$a=
new b(this.a));null==this.Rl?(this.Rl=new a.ga(0),this.Rl.xb(16)):this.Rl.clear(!1);this.VQ(e);for(var g=0,c=e.size;g<c;g++){var d=e.get(g);-1!=d&&this.bD(d,-1)}for(g=0;g<this.Rl.size&&0<this.lr;g++)if(e=this.Rl.get(g),d=this.$a.Dw(this.Za.da(e)),c=-1,0==this.a.Ei(d,this.Ak)){for(var d=this.Za.ge(e),m=e,k;-1!=d;){var h=this.Za.da(d),q=this.$a.Dw(h),l=this.a.Ei(q,this.Ak);if(0!=l){c=q;break}m=d;d=this.Za.ge(d)}-1==d?(k=!0,d=m):(h=this.Za.da(d),k=this.$a.ot(h),d=this.Za.bb(d),k=!k);do{h=this.Za.da(d);
q=this.$a.Dw(h);l=this.a.Ei(q,this.Ak);if(0==l&&(k!=this.$a.ot(h)&&(f=this.a.Cb(q),this.a.lF(f),this.a.Wi(q,this.a.Ua(f)),f=!0),this.a.Rp(q,this.Ak,k?3:2),k||(m=this.a.Ei(c,this.kn),this.a.Rp(c,this.kn,q),this.a.Rp(q,this.kn,m)),this.lr--,0==this.lr))return f;c=q;m=d;d=this.Za.bb(d);k=!k}while(m!=e)}return f};e.prototype.VQ=function(a){for(var e=0,b=a.size;e<b;e++){var f=a.get(e),g=this.a.Ra(f,this.fn),c=this.a.Ra(f,this.br);if(-1!=g){var d=this.Za.da(g);this.$a.hC(d);this.a.lb(f,this.fn,-1)}-1!=
c&&(d=this.Za.da(c),this.$a.hC(d),this.a.lb(f,this.br,-1));d=-1;-1!=g&&-1!=c?(this.Za.kd(g,-1),this.Za.kd(c,-1),a.set(e,-1)):d=-1!=g?g:c;-1!=d&&(this.bD(f,d)||this.Za.kd(d,-1),a.set(e,-1))}};e.prototype.bD=function(e,b){var f=new a.b,g=new a.b;this.a.uc(e,f);var c=this.a.X(e);this.a.uc(c,g);var d=!1;if(f.y<g.y){var d=!0,n=this.$a.GE(e),m;-1==b?m=this.Za.addElement(n,-1):(m=b,this.Za.Vi(m,n));n=this.a.Ra(c,this.fn);-1==n?this.a.lb(c,this.fn,m):this.a.lb(c,this.br,m);c=this.a.rd(e);0==this.a.Ei(c,this.Ak)&&
this.Rl.add(m)}c=this.a.Ua(e);this.a.uc(c,g);f.y<g.y&&(d=!0,n=this.$a.GE(c),-1==b?m=this.Za.addElement(n,-1):(m=b,this.Za.Vi(m,n)),n=this.a.Ra(c,this.fn),-1==n?this.a.lb(c,this.fn,m):this.a.lb(c,this.br,m),c=this.a.rd(e),0==this.a.Ei(c,this.Ak)&&this.Rl.add(m));return d};e.$=function(a,b,g,c){var f=new e;f.a=a;f.U=b;f.Dk=g;f.Qt=c;return f.XM()};e.prototype.YM=function(){var e=new a.ga(0),b=new a.ga(0),g=-1,c=-1,d=new a.b;d.Eh();for(var m=-1,k=-1,h=-1,q=new a.b,l=this.Dk.gc(this.Dk.Wd);-1!=l;l=this.Dk.bb(l)){var v=
this.Dk.getData(l);this.a.uc(v,q);var t=this.a.rd(v);d.ub(q)&&k==t?(-1==c&&(g=this.a.Uv(),c=this.a.re()),-1==h&&(h=b.size,this.a.lb(m,c,h),b.add(1),-1==this.a.Ei(t,g)&&(this.a.Rp(t,g,m),e.add(t))),this.a.lb(v,c,h),b.JF(b.tc()+1)):(h=-1,d.J(q));m=v;k=t}if(0==e.size)return!1;d=new a.ga(0);m=new a.ga(0);k=0;for(h=e.size;k<h;k++){var t=e.get(k),y=this.a.Ei(t,g),v=this.a.Ra(y,c);d.clear(!1);m.clear(!1);d.add(y);m.add(v);for(v=this.a.X(y);v!=y;v=this.a.X(v)){var r=v,q=this.a.Ra(r,c);if(-1!=q)if(0==m.size)m.add(q),
d.add(r);else if(m.tc()==q){var l=d.tc(),B=this.a.X(l),y=this.a.X(r);this.a.Sc(l,y);this.a.Tc(y,l);this.a.Sc(r,B);this.a.Tc(B,r);r=[!1];B=this.a.aD(this.U,B,this.a.Cb(t),r);this.a.lb(v,c,-1);r[0]&&this.a.Dh(t,y);v=this.a.Ha(t);y=this.a.Ha(B);v-=y;this.a.hm(t,v);b.set(q,b.get(q)-1);1==b.get(q)&&(b.set(q,0),m.af(),d.af());v=y=l}else d.add(v),m.add(q)}}this.a.ty(g);this.a.bf(c);return!0};return e}();a.AI=g})(E||(E={}));(function(a){var b=function(){function b(){}b.prototype.Ag=function(){this.Mx=this.ib=
null};b.prototype.get=function(){return this.Mx};b.prototype.set=function(b){this.Mx=b;if(null!=b)throw 322==b.D()&&(this.ib=b),a.g.wa();};b.prototype.create=function(b){if(322==b)this.mq();else throw a.g.ra("Not Implemented");};b.prototype.mq=function(){null==this.ib&&(this.ib=new a.yb);this.Mx=this.ib};return b}();a.Ag=b})(E||(E={}));(function(a){a=a.FI||(a.FI={});a[a.enumLineSeg=1]="enumLineSeg";a[a.enumBezierSeg=2]="enumBezierSeg";a[a.enumArcSeg=4]="enumArcSeg";a[a.enumNonlinearSegmentMask=6]=
"enumNonlinearSegmentMask";a[a.enumSegmentMask=7]="enumSegmentMask";a[a.enumDensified=8]="enumDensified"})(E||(E={}));(function(a){var b=function(){return function(a){this.ri=a;this.dz=this.ez=1;this.ky=this.jy=this.ly=0}}(),c=function(){function g(){this.op=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.Ij=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.nf=new a.Va;this.ka=this.fu=0;this.an=[];this.ir=[];this.bu=[];this.qp=[];this.Jx=[]}g.prototype.ny=function(a){if(null!=a){for(var e=0,b=a.length;e<b;e++)this.oR(a[e]);
a.length=0}};g.prototype.oR=function(a){a.ri=null;this.qp.push(a)};g.prototype.nu=function(a){if(0===this.qp.length)var e=new b(a);else e=this.qp[this.qp.length-1],e.ri=a,--this.qp.length;return e};g.prototype.dO=function(a,b){return 0==a?this.ir[b]:this.bu[b]};g.prototype.Zx=function(){this.fu>=this.Jx.length&&this.Jx.push(new a.Ag);var e=this.Jx[this.fu];this.fu++;return e};g.prototype.clear=function(){this.ny(this.an);this.ny(this.ir);this.ny(this.bu);this.fu=0};g.prototype.zn=function(a){this.an.push(this.nu(a))};
g.prototype.kk=function(a){return 0==a?this.ir.length:this.bu.length};g.prototype.Io=function(a,b){return this.dO(a,b).ri};g.prototype.Ga=function(e,b){if(2!=this.an.length)throw a.g.wa();this.ka=e;var f=a.vi.Ty(.01*e),g=!1,c=this.an[0],d=this.an[1];if(b||0!=(c.ri.fq(d.ri,e,!0)&5)){if(322==c.ri.D()&&(b=c.ri,322==d.ri.D())){var m=d.ri,k=a.yb.ov(b,m,null,this.op,this.Ij,e);if(0==k)throw a.yb.ov(b,m,null,this.op,this.Ij,e),a.g.wa();e=Array(9);a.I.Ps(e,null);for(var h=0;h<k;h++){var q=this.op[h],l=this.Ij[h],
v=c.ky,t=1;0==q?(v=c.ly,t=c.ez):1==q&&(v=c.jy,t=c.dz);var y=d.ky,r=1;0==l?(y=d.ly,r=d.ez):1==l&&(y=d.jy,r=d.dz);var B=new a.b;v==y?(v=new a.b,b.Kb(q,v),q=new a.b,m.Kb(l,q),l=t+r,r/=l,a.vi.BD(v,q,r,B),a.b.Zb(B,v)+a.b.Zb(B,q)>f&&(g=!0)):v>y?(b.Kb(q,B),q=new a.b,m.Kb(l,q),a.b.Zb(B,q)>f&&(g=!0)):(m.Kb(l,B),v=new a.b,b.Kb(q,v),a.b.Zb(B,v)>f&&(g=!0));e[h]=B}c=0;d=-1;for(h=0;h<=k;h++)r=h<k?this.op[h]:1,r!=c&&(f=this.Zx(),b.Bi(c,r,f),-1!=d&&f.get().ed(e[d]),h!=k&&f.get().vd(e[h]),c=r,this.ir.push(this.nu(f.get()))),
d=h;b=[0,0,0,0,0,0,0,0,0];for(h=0;h<k;h++)b[h]=h;1<k&&this.Ij[0]>this.Ij[1]&&(r=this.Ij[0],this.Ij[0]=this.Ij[1],this.Ij[1]=r,h=b[0],b[0]=b[1],b[1]=h);c=0;d=-1;for(h=0;h<=k;h++)r=h<k?this.Ij[h]:1,r!=c&&(f=this.Zx(),m.Bi(c,r,f),-1!=d&&(c=b[d],f.get().ed(e[c])),h!=k&&(c=b[h],f.get().vd(e[c])),c=r,this.bu.push(this.nu(f.get()))),d=h;return g}throw a.g.wa();}return!1};g.prototype.Tw=function(e,b,g){b.copyTo(this.nf);if(1!=this.an.length)throw a.g.wa();this.ka=e;var f=this.an[0];if(g||f.ri.qs(b.w(),e,
!0))if(322==f.ri.D()){e=f.ri;var c=e.Gd(b.w(),!1);this.op[0]=c;var d=f.ky;g=1;0==c?(d=f.ly,g=f.ez):1==c&&(d=f.jy,g=f.dz);f=new a.b;0==d?(d=new a.b,e.Kb(c,d),b=b.w(),a.vi.BD(d,b,1/(g+1),f)):0<d?(f=new a.b,e.Kb(c,f)):f=b.w();g=0;c=-1;for(d=0;1>=d;d++){b=1>d?this.op[d]:1;if(b!=g){var n=this.Zx();e.Bi(g,b,n);-1!=c&&n.get().ed(f);1!=d&&n.get().vd(f);g=b;this.ir.push(this.nu(n.get()))}c=d}this.nf.ic(f)}else throw a.g.wa();};return g}();a.gA=c})(E||(E={}));(function(a){var b=function(){function b(b){this.Pq=
this.yj=this.ib=null;this.zk=this.Ee=this.Gc=this.ze=this.Sg=this.Qa=0;this.ab=null;this.zl=!1;this.ze=-1;this.Sg=this.Gc=0;this.Qa=-1;this.ab=b;this.Ee=this.eq(this.Sg);this.zl=!1;this.yj=null;this.zk=-1;this.Pq=new a.b}b.Yn=function(g,e){if(0>e||e>=g.F())throw a.g.Uc();var f=new b(g),c=g.Ew(e);f.Gc=e-g.Ea(c);f.Sg=c+1;f.Qa=c;f.Ee=f.eq(f.Qa);f.zk=f.ab.Ea(f.Qa);return f};b.Un=function(g,e,f){if(0>e||e>=g.ea()||0>f)throw a.g.Uc();var c=g.vc(e)?0:1;if(f>=g.Ha(e)-c)throw a.g.Uc();g=new b(g);g.ze=-1;g.Gc=
f;g.Qa=e;g.Sg=g.Gc+1;g.Ee=g.eq(g.Sg);g.zk=g.ab.Ea(g.Qa);return g};b.prototype.xR=function(b){if(this.ab!=b.ab)throw a.g.xa();this.ze=b.ze;this.Gc=b.Gc;this.Qa=b.Qa;this.Sg=b.Sg;this.Ee=b.Ee;this.zl=b.zl;this.zk=b.zk;this.yj=null};b.prototype.ia=function(){this.ze!=this.Gc&&this.JA();if(this.zl)this.Gc=(this.Gc+1)%this.Ee;else{if(this.Gc==this.Ee)throw a.g.Uc();this.Gc++}return this.yj};b.prototype.oi=function(){if(this.zl)this.Gc=(this.Ee+this.Gc-1)%this.Ee;else{if(0==this.Gc)throw a.g.Uc();this.Gc--}this.Gc!=
this.ze&&this.JA();return this.yj};b.prototype.yR=function(){this.ze=-1;this.Gc=0};b.prototype.zR=function(){this.Gc=this.Ee;this.ze=-1};b.prototype.Sb=function(a,e){void 0===e&&(e=-1);if(0<=this.Qa&&this.Qa<this.ab.ea()){var b=this.uJ();if(a>=b&&a<this.ab.Dc(this.Qa)){this.ze=-1;this.Gc=a-b;return}}b=0<=e&&e<this.ab.ea()&&a>=this.ab.Ea(e)&&a<this.ab.Dc(e)?e:this.ab.Ew(a);this.Sg=b+1;this.Qa=b;this.ze=-1;this.Gc=a-this.ab.Ea(b);this.Ee=this.eq(b);this.zk=this.ab.Ea(this.Qa)};b.prototype.kb=function(){this.Qa=
this.Sg;if(this.Qa>=this.ab.ea())return!1;this.ze=-1;this.Gc=0;this.Ee=this.eq(this.Qa);this.zk=this.ab.Ea(this.Qa);this.Sg++;return!0};b.prototype.Lk=function(){this.Ee=this.Gc=this.ze=-1;this.Sg=0;this.zk=this.Qa=-1};b.prototype.vy=function(b){if(0>b)throw a.g.Uc();this.Sg=b;this.zk=this.Ee=this.Gc=this.ze=this.Qa=-1};b.prototype.eq=function(a){if(this.ab.sc())return 0;var e=1;this.ab.vc(a)&&(e=0);return this.ab.Ha(a)-e};b.prototype.lD=function(){return this.ze==this.Ee-1&&this.ab.vc(this.Qa)};
b.prototype.NR=function(){this.zl=!0};b.prototype.Jb=function(){return this.ab.jb.f[this.Qa]+this.ze};b.prototype.uJ=function(){return this.ab.Ea(this.Qa)};b.prototype.Bm=function(){return this.lD()?this.ab.Ea(this.Qa):this.Jb()+1};b.prototype.wl=function(){return 0==this.ze};b.prototype.Jm=function(){return this.ze==this.Ee-1};b.prototype.La=function(){return this.Gc<this.Ee};b.prototype.Ow=function(){return 0<this.Gc};b.prototype.vm=function(){var a=new b(this.ab);a.ze=this.ze;a.Gc=this.Gc;a.Ee=
this.Ee;a.Qa=this.Qa;a.Sg=this.Sg;a.ab=this.ab;a.zl=this.zl;return a};b.prototype.JA=function(){if(0>this.Gc||this.Gc>=this.Ee)throw a.g.Uc();this.ze=this.Gc;var b=this.Jb();this.ab.kc();var e=this.ab.Fe,f=1;null!=e&&(f=e.read(b)&7);e=this.ab.description;switch(f){case 1:null==this.ib&&(this.ib=new a.yb);this.yj=this.ib;break;case 2:throw a.g.ra("internal error");case 4:throw a.g.wa();default:throw a.g.wa();}this.yj.Qf(e);f=this.Bm();this.ab.uc(b,this.Pq);this.yj.ed(this.Pq);this.ab.uc(f,this.Pq);
this.yj.vd(this.Pq);for(var c=1,d=e.Aa;c<d;c++)for(var m=e.Hd(c),k=a.pa.Wa(m),h=0;h<k;h++){var q=this.ab.ld(m,b,h);this.yj.My(m,h,q);q=this.ab.ld(m,f,h);this.yj.Cy(m,h,q)}};b.prototype.YO=function(){return this.Qa==this.ab.ea()-1};return b}();a.GI=b})(E||(E={}));(function(a){var b=function(){function b(b){b instanceof a.T?(this.ZD=b,this.ua=-1,this.Wh=1):(this.DP=b.slice(0),this.ua=-1,this.Wh=b.length)}b.prototype.ya=function(){return this.ua};b.prototype.next=function(){return this.ua<this.Wh-1?
(this.ua++,null!=this.ZD?this.ZD:this.DP[this.ua]):null};return b}();a.Pc=b})(E||(E={}));(function(a){var b=function(){return function(){this.next=null}}(),c=function(){function g(){this.Cp=this.ju=this.ku=this.vj=this.eh=0;this.aC=!1;this.eG=0;this.am=this.wf=this.Vk=this.hh=null;this.Mk=0;this.Kv=null;this.vj=this.eh=-1}g.prototype.vS=function(e,b,g){this.eh=e;this.vj=b;this.hh=this.Vk=null;this.Cp=0;this.Kv=g;null==this.am&&(this.am=a.I.Lh(384,0));this.hG()};g.prototype.aa=function(){return this.eh};
g.prototype.ba=function(){return this.vj};g.prototype.flush=function(){0<this.Mk&&(this.Kv.XB(this.am,this.Mk),this.Mk=0)};g.prototype.hG=function(){if(0<this.Cp){for(var a=0;a<this.vj;a++){for(var b=this.Vk[a];null!=b;){var g=b,b=b.next;g.next=null}this.Vk[a]=null}this.hh=null}this.ku=this.vj;this.ju=-1;this.Cp=0};g.prototype.fF=function(a){this.aC=a==g.$u;for(a=this.ku;a<=this.ju;a++)this.VJ(),this.PJ(a),this.vM();this.hG()};g.prototype.zv=function(e,f,g,c){if(f!=c){var d=1;f>c&&(d=e,e=g,g=d,d=
f,f=c,c=d,d=-1);if(!(0>c||f>=this.vj)){0>e&&0>g?g=e=-1:e>=this.eh&&g>=this.eh&&(g=e=this.eh);var m=(g-e)/(c-f);c>this.vj&&(c=this.vj,g=m*(c-f)+e);0>f&&(e=m*(0-f)+e,f=0);var n=Math.max(this.eh+1,8388607);-8388607>e?(f=(0-e)/m+f,e=0):e>n&&(f=(this.eh-e)/m+f,e=this.eh);-8388607>g?c=(0-e)/m+f:g>n&&(c=(this.eh-e)/m+f);f=a.I.truncate(f);c=a.I.truncate(c);f!=c&&(g=new b,g.x=a.I.truncate(4294967296*e),g.y=f,g.G=c,g.pM=a.I.truncate(4294967296*m),g.dir=d,null==this.Vk&&(this.Vk=a.I.Lh(this.vj,null)),g.next=
this.Vk[g.y],this.Vk[g.y]=g,g.y<this.ku&&(this.ku=g.y),g.G>this.ju&&(this.ju=g.G),this.Cp++)}}};g.prototype.VJ=function(){if(null!=this.hh){for(var a=!1,b=null,g=this.hh;null!=g;)if(g.y++,g.y==g.G){var c=g,g=g.next;null!=b?b.next=g:this.hh=g;c.next=null}else g.x+=g.pM,null!=b&&b.x>g.x&&(a=!0),b=g,g=g.next;a&&(this.hh=this.dG(this.hh))}};g.prototype.PJ=function(a){if(!(a>=this.vj)){var e=this.Vk[a];if(null!=e){this.Vk[a]=null;e=this.dG(e);this.Cp-=this.eG;a=this.hh;for(var b=!0,g=e,c=null;null!=a&&
null!=g;)a.x>g.x?(b&&(this.hh=g),b=g.next,g.next=a,null!=c&&(c.next=g),c=g,g=b):(b=a.next,a.next=g,null!=c&&(c.next=a),c=a,a=b),b=!1;null==this.hh&&(this.hh=e)}}};g.Mz=function(a,b){return 0>a?0:a>b?b:a};g.prototype.vM=function(){if(null!=this.hh)for(var e=0,b=this.hh,c=a.I.truncate(a.I.FD(b.x)),d=b.next;null!=d;d=d.next)if(e=this.aC?e^1:e+d.dir,d.x>b.x){var m=a.I.truncate(a.I.FD(d.x));0!=e&&(b=g.Mz(c,this.eh),c=g.Mz(m,this.eh),c>b&&b<this.eh&&(this.am[this.Mk++]=b,this.am[this.Mk++]=c,this.am[this.Mk++]=
d.y,this.Mk==this.am.length&&(this.Kv.XB(this.am,this.Mk),this.Mk=0)));b=d;c=m}};g.prototype.dG=function(e){for(var b=0,c=e;null!=c;c=c.next)b++;this.eG=b;if(1==b)return e;null==this.wf?this.wf=a.I.Lh(Math.max(b,16),null):this.wf.length<b&&(this.wf=a.I.Lh(Math.max(b,2*this.wf.length),null));for(var d=0,c=e;null!=c;c=c.next)this.wf[d++]=c;2==b?this.wf[0].x>this.wf[1].x&&(e=this.wf[0],this.wf[0]=this.wf[1],this.wf[1]=e):g.pP(this.wf,b,function(a,e){return a==e?0:a.x<e.x?-1:a.x>e.x?1:0});e=this.wf[0];
this.wf[0]=null;c=e;for(d=1;d<b;d++)c.next=this.wf[d],c=this.wf[d],this.wf[d]=null;c.next=null;return e};g.pP=function(a,b,g){if(b==a.length)a.sort(g);else{var e=a.slice(0,0),f=a.slice(b);b=a.slice(0,b).sort(g);a.length=0;a.push.apply(a,e.concat(b).concat(f))}};g.$u=0;g.sT=1;return g}();a.ev=c})(E||(E={}));(function(a){var b=function(){function b(){}b.prototype.Jh=function(a,e){var b=this.a.Ra(a,this.vp);this.yk==b&&(this.yk=this.$d.bb(this.yk));this.Xm==b&&(this.Xm=this.$d.bb(this.Xm));this.$d.Jc(this.Ox,
b);this.hj(a);if(e&&(b=this.a.rd(a),-1!=b&&this.a.Cb(b)==a)){e=this.a.X(a);if(e!=a){var g=this.a.rd(e);if(g==b){this.a.Dh(b,e);return}e=this.a.Ua(a);if(e!=a&&(g=this.a.rd(e),g==b)){this.a.Dh(b,e);return}}this.a.Dh(b,-1);this.a.Wi(b,-1)}};b.prototype.yA=function(){for(var b=!1,e=0,f=new a.b;;){e++;null==this.nh?(this.nh=new a.ga(0),this.Mq=new a.ga(0),this.ie=new a.ga(0)):(this.nh.clear(!1),this.Mq.clear(!1),this.ie.clear(!1));for(var c=this.Xm,d=0,m=!0;c!=this.yk;){var k=this.$d.getData(c),h=new a.b;
this.a.uc(k,h);m&&(this.a.uc(k,f),m=!1);var h=this.a.Ua(k),q=this.a.X(k);-559038737!=this.a.Ra(h,this.fg)&&(this.nh.add(h),this.a.lb(h,this.fg,-559038737),this.Mq.add(k),this.ie.add(d++));-559038737!=this.a.Ra(q,this.fg)&&(this.nh.add(q),this.a.lb(q,this.fg,-559038737),this.Mq.add(k),this.ie.add(d++));c=this.$d.bb(c)}if(2>this.nh.size)break;var l=this;this.ie.xd(0,this.ie.size,function(a,e){return l.mJ(a,e)});c=0;for(d=this.ie.size;c<d;c++)m=this.ie.get(c),m=this.nh.get(m),this.a.lb(m,this.fg,c),
h=new a.b,this.a.uc(m,h);h=this.zJ(f);c=0;for(d=this.ie.size;c<d;c++)m=this.ie.get(c),-1!=m&&(m=this.nh.get(m),this.a.lb(m,this.fg,-1));if(h)b=!0;else break}return b};b.prototype.zJ=function(a){for(var e=!1,b=!0;b;){var b=!1,g=0;-1==this.ie.get(g)&&(g=this.fl(g));for(var c=this.fl(g),d=0,m=this.ie.size;d<m&&-1!=g&&-1!=c&&g!=c;d++){var k=this.ie.get(g),c=this.ie.get(c),k=this.nh.get(k),c=this.nh.get(c),h=this.a.X(k);this.a.pt(h,a)||(h=this.a.Ua(k));var q=this.a.X(c);this.a.pt(q,a)||(q=this.a.Ua(c));
var l=this.os(h,k),v=this.os(q,c),t=l?this.a.Ua(h):this.a.X(h),y=v?this.a.Ua(q):this.a.X(q),r=!1;this.io(h)?r=!0:this.io(q)?r=!0:this.io(k)?r=!0:this.io(c)?r=!0:this.io(t)?r=!0:this.io(y)&&(r=!0);!r&&this.a.Cq(k,c)&&(r=!0,this.BA(l,v,h,k,q,c));!r&&this.a.Cq(t,y)&&(r=!0,this.BA(!l,!v,h,t,q,y));r&&(e=!0);b=b||r;g=this.fl(g);c=this.fl(g)}}if(!e)for(g=0,-1==this.ie.get(g)&&(g=this.fl(g)),c=this.fl(g),d=0,m=this.ie.size;d<m&&-1!=g&&-1!=c&&g!=c;d++)k=this.ie.get(g),c=this.ie.get(c),k=this.nh.get(k),c=this.nh.get(c),
h=this.a.X(k),this.a.pt(h,a)||(h=this.a.Ua(k)),q=this.a.X(c),this.a.pt(q,a)||(q=this.a.Ua(c)),l=this.os(h,k),v=this.os(q,c),t=l?this.a.Ua(h):this.a.X(h),y=v?this.a.Ua(q):this.a.X(q),this.qJ(l,v,k,h,t,c,q,y)&&(e=!0),g=this.fl(g),c=this.fl(g);return e};b.prototype.CJ=function(){1736==this.a.Lb(this.U)&&1==this.a.Cm(this.U)&&(new a.Of).DQ(this.Qt,this.a,this.U,this.oe);var b=!1,e=!0;this.fg=this.vp=-1;var f=this.a.F(this.U),c=new a.ga(0);c.xb(f);for(var d=this.a.Vb(this.U);-1!=d;d=this.a.bc(d))for(var m=
this.a.Cb(d),k=0,h=this.a.Ha(d);k<h;k++)c.add(m),m=this.a.X(m);var q=this.a.cd.f,l=this.a.cd.Ic;this.a.wb.kc();var v=this.a.wb.Ba[0].f;c.xd(0,f,function(a,e){var b=q[l*a],f=q[l*e],g=v[2*b],b=v[2*b+1],c=v[2*f],f=v[2*f+1],g=b<f?-1:b>f?1:g<c?-1:g>c?1:0;0==g&&(g=q[l*a+3],f=q[l*e+3],g=g<f?-1:g==f?0:1);return g});this.vp=this.a.re();this.$d=new a.$n;this.Ox=this.$d.jh(0);this.$d.$l(f);for(d=0;d<f;d++)m=c.get(d),k=this.$d.addElement(this.Ox,m),this.a.lb(m,this.vp,k);this.fg=this.a.re();this.yk=-1;for(this.sA()&&
(b=!0);e;){e=!1;f=0;c=!1;do{c=!1;this.Xm=-1;for(var h=0,d=new a.b,k=new a.b,t=this.$d.gc(this.Ox);-1!=t;)m=this.$d.getData(t),-1!=this.Xm?(this.a.uc(m,k),d.ub(k))?h++:(d.J(k),this.yk=t,0<h&&(m=this.yA())&&(c=!0,-1!=this.yk&&(m=this.$d.getData(this.yk),this.a.uc(m,d))),this.Xm=t=this.yk,h=0):(this.Xm=t,this.a.uc(this.$d.getData(t),d),h=0),-1!=t&&(t=this.$d.bb(t));this.yk=-1;0<h&&(m=this.yA())&&(c=!0);if(10<f++)throw a.g.wa();c&&this.tJ();this.sA()&&(c=!0);e=e||c&&!1;b=b||c}while(c)}this.a.bf(this.vp);
this.a.bf(this.fg);return b=a.AI.$(this.a,this.U,this.$d,this.Qt)||b};b.prototype.os=function(a,e){return this.a.X(e)==a?!1:!0};b.prototype.qJ=function(a,e,b,c,d,m,k,h){if(c==k)return this.hj(b),this.hj(m),!1;var f=this.a.Ra(b,this.fg),g=this.a.Ra(d,this.fg),n=this.a.Ra(m,this.fg),q=this.a.Ra(h,this.fg);b=[0,0,0,0,0,0,0,0];var l=[0,0,0,0];b[0]=0;l[0]=f;b[1]=0;l[1]=g;b[2]=1;l[2]=n;b[3]=1;l[3]=q;for(f=1;4>f;f++){g=l[f];n=b[f];for(q=f-1;0<=q&&l[q]>g;)l[q+1]=l[q],b[q+1]=b[q],q--;l[q+1]=g;b[q+1]=n}l=0;
0!=b[0]&&(l|=1);0!=b[1]&&(l|=2);0!=b[2]&&(l|=4);0!=b[3]&&(l|=8);if(5!=l&&10!=l)return!1;a==e?a?(this.a.Sc(h,c),this.a.Tc(c,h),this.a.Sc(d,k),this.a.Tc(k,d)):(this.a.Tc(h,c),this.a.Sc(c,h),this.a.Tc(d,k),this.a.Sc(k,d)):a?(this.a.Tc(c,m),this.a.Sc(m,c),this.a.Tc(k,d),this.a.Sc(d,k)):(this.a.Sc(c,m),this.a.Tc(m,c),this.a.Sc(k,d),this.a.Tc(d,k));return!0};b.prototype.BA=function(a,e,b,c,d,m){this.pU?this.BJ():this.AJ(a,e,b,c,d,m)};b.prototype.BJ=function(){throw a.g.ra("not implemented.");};b.prototype.AJ=
function(a,e,b,c,d,m){if(a!=e)a?(this.a.Sc(b,d),this.a.Tc(d,b),this.a.Sc(m,c),this.a.Tc(c,m),this.pm(d,b),this.Jh(d,!0),this.a.Ui(d,!0),this.hj(b),this.pm(m,c),this.Jh(m,!0),this.a.Ui(m,!1)):(this.a.Sc(d,b),this.a.Tc(b,d),this.a.Sc(c,m),this.a.Tc(m,c),this.pm(d,b),this.Jh(d,!0),this.a.Ui(d,!1),this.hj(b),this.pm(m,c),this.Jh(m,!0),this.a.Ui(m,!0)),this.hj(c);else{var f=a?b:c,g=e?d:m;a=a?c:b;e=e?m:d;d=!1;this.a.Sc(f,g);this.a.Sc(g,f);this.a.Tc(a,e);this.a.Tc(e,a);for(m=e;m!=g;)b=this.a.Ua(m),c=this.a.X(m),
this.a.Tc(m,c),this.a.Sc(m,b),d=d||m==f,m=c;d||(b=this.a.Ua(g),c=this.a.X(g),this.a.Tc(g,c),this.a.Sc(g,b));this.pm(g,f);this.Jh(g,!0);this.a.Ui(g,!1);this.hj(f);this.pm(e,a);this.Jh(e,!0);this.a.Ui(e,!1);this.hj(a)}};b.prototype.sA=function(){for(var a=!1,e=this.a.Vb(this.U);-1!=e;){for(var b=this.a.Cb(e),c=0,d=this.a.Ha(e);c<d&&1<d;){var m=this.a.Ua(b),k=this.a.X(b);this.a.Cq(m,k)?(a=!0,this.Jh(b,!1),this.a.vf(b,!0),this.Jh(k,!1),this.a.vf(k,!0),b=m,c=0,d=this.a.Ha(e)):(b=k,c++)}if(2>this.a.Ha(e)){a=
this.a.Cb(e);c=0;for(d=this.a.Ha(e);c<d;c++)this.Jh(a,!1),a=this.a.X(a);e=this.a.Cr(e);a=!0}else e=this.a.bc(e)}return a};b.prototype.io=function(a){for(var e=!1;;){var b=this.a.X(a),c=this.a.Ua(a);if(b==a)return this.Jh(a,!0),this.a.Ui(a,!1),!0;if(!this.a.Cq(b,c))break;e=!0;this.hj(c);this.hj(b);this.Jh(a,!0);this.a.Ui(a,!1);this.pm(b,c);this.Jh(b,!0);this.a.Ui(b,!0);if(b==c)break;a=c}return e};b.prototype.tJ=function(){for(var a=0,e=this.$d.gc(this.$d.Wd);-1!=e;e=this.$d.bb(e)){var b=this.$d.getData(e);
this.a.im(b,-1)}for(var c=0,d=this.a.Vb(this.U);-1!=d;)if(e=this.a.Cb(d),-1==e||-1!=this.a.rd(e))b=d,d=this.a.bc(d),this.a.yu(b);else{this.a.im(e,d);for(var m=1,b=this.a.X(e);b!=e;b=this.a.X(b))this.a.im(b,d),m++;this.a.Jr(d,!1);this.a.hm(d,m);this.a.Wi(d,this.a.Ua(e));c+=m;a++;d=this.a.bc(d)}for(e=this.$d.gc(this.$d.Wd);-1!=e;e=this.$d.bb(e))b=this.$d.getData(e),-1==this.a.rd(b)&&(d=this.a.aD(this.U,b,b,null),c+=this.a.Ha(d),a++);this.a.gm(this.U,a);this.a.Pk(this.U,c);a=0;for(c=this.a.$c;-1!=c;c=
this.a.we(c))a+=this.a.F(c);this.a.ZF(a)};b.prototype.fl=function(a){for(var e=0,b=this.ie.size-1;e<b;e++)if(a=(a+1)%this.ie.size,-1!=this.ie.get(a))return a;return-1};b.prototype.pm=function(a,e){var b=this.a.Ra(e,this.vp),c=this.a.Ra(e,this.fg);this.a.Zy(a,e);this.a.lb(e,this.vp,b);this.a.lb(e,this.fg,c)};b.prototype.hj=function(a){var e=this.a.Ra(a,this.fg);-1!=e&&(this.ie.set(e,-1),this.a.lb(a,this.fg,-1))};b.$=function(a,e,f,c,d){var g=new b;g.a=a;g.U=e;g.yx=f;g.Qt=c;g.oe=d;return g.CJ()};b.prototype.mJ=
function(b,e){var f=this.nh.get(b),c=new a.b;this.a.uc(f,c);var f=new a.b,g=this.nh.get(e);this.a.uc(g,f);if(c.ub(f))return 0;b=this.Mq.get(b);g=new a.b;this.a.uc(b,g);e=this.Mq.get(e);b=new a.b;this.a.uc(e,b);e=new a.b;e.pc(c,g);c=new a.b;c.pc(f,b);return a.b.cq(e,c)};return b}();a.mm=b})(E||(E={}));(function(a){(function(a){a[a.Local=0]="Local";a[a.Geographic=1]="Geographic";a[a.Projected=2]="Projected";a[a.Unknown=3]="Unknown"})(a.HI||(a.HI={}));(function(a){a[a.Integer32=0]="Integer32";a[a.Integer64=
1]="Integer64";a[a.FloatingPoint=2]="FloatingPoint"})(a.rI||(a.rI={}));var b=function(){function b(){this.fo="";this.mi=0;this.Sl=null}b.prototype.Qc=function(){return this.mi};b.prototype.Ko=function(){var b=.001;0!=this.mi?b=a.ls.SM(this.mi):null!=this.Sl&&(b=a.mA.TM(this.Sl));return b};b.prototype.Se=function(){if(0!=this.mi)return a.Tb.Qd(a.ls.cC(this.mi));if(null!=this.Sl)return a.mA.UM(this.Sl)};b.Am=function(b){if(0!=b.mi){if(!0===a.ls.WO(b.mi))return 1;if(!0===a.ls.ZO(b.mi))return 2}return 3};
b.create=function(c){if(0>=c)throw a.g.N("Invalid or unsupported wkid: "+c);var e=new b;e.mi=c;return e};b.NL=function(c){if(null==c||0==c.length)throw a.g.N("Cannot create SpatialReference from null or empty text.");var e=new b;e.Sl=c;return e};b.prototype.lc=function(a){return this==a?!0:null==a||this.constructor!=a.constructor||this.mi!=a.mi||0==this.mi&&this.Sl!==a.Sl?!1:!0};b.mN=function(b,e){var f=Math.PI/180,c=new a.ca;a.nH.pN(b.w().x*f,b.w().y*f,e.w().x*f,e.w().y*f,c);return c.l};b.prototype.toString=
function(){return"[ tol: "+this.xq()+"; wkid: "+this.Qc()+"; wkt: "+this.Sl+"]"};b.prototype.hc=function(){if(""!==this.fo)return this.fo;var a=this.toString();if(Array.prototype.reduce)return this.fo="S"+a.split("").reduce(function(a,e){a=(a<<5)-a+e.charCodeAt(0);return a&a},0);var e=0;if(0===a.length)return"";for(var b=0;b<a.length;b++)e=(e<<5)-e+a.charCodeAt(b),e&=e;return this.fo="S"+e};b.prototype.xq=function(){return this.Ko()};b.jU=!0;b.ET=2147483645;b.FT=9007199254740990;return b}();a.Nf=
b})(E||(E={}));(function(a){function b(a,e){89.99999<e?e=89.99999:-89.99999>e&&(e=-89.99999);e*=.017453292519943;return[111319.49079327169*a,3189068.5*Math.log((1+Math.sin(e))/(1-Math.sin(e)))]}function c(a,e,b){a=a/6378137*57.29577951308232;return b?[a,57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*e/6378137)))]:[a-360*Math.floor((a+180)/360),57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*e/6378137)))]}function g(e,b){var f=e.vm();if(33===e.D()){var c=b(f.lk(),f.mk());
f.ic(c[0],c[1])}else if(197===e.D())c=b(e.R.v,e.R.C,!0),e=b(e.R.B,e.R.G,!0),f.K(c[0],c[1],e[0],e[1]);else for(c=new a.b,e=0;e<f.F();e++){f.w(e,c);var g=b(c.x,c.y,!0);c.ma(g[0],g[1]);f.ic(e,c)}return f}function e(a){return g(a,c)}function f(a){return g(a,b)}var d=function(){function e(){}e.Xr=function(e){var b=Math.PI/180,f=Math.sin(e.y*b);return a.b.Oa(6378137*e.x*b,3167719.6636462314*(f/(1-.006694379990197414*f*f)-6.111035746609262*Math.log((1-.0818191908429643*f)/(1+.0818191908429643*f))))};e.Wu=
function(e,b,f,c){var g=1/298.257223563,d=Math.sin(f);f=Math.cos(f);var m=(1-g)*Math.tan(e);e=1/Math.sqrt(1+m*m);for(var n=m*e,k=Math.atan2(m,f),m=e*d*e*d,h=1-m,q=2.7233160610754688E11*h/4.040829998466145E13,l=1+q/16384*(4096+q*(-768+q*(320-175*q))),v=q/1024*(256+q*(-128+q*(74-47*q))),q=c/(6356752.31424518*l),t=2*Math.PI,y,r,B,E;1E-12<Math.abs(q-t);)B=Math.cos(2*k+q),y=Math.sin(q),r=Math.cos(q),E=v*y*(B+v/4*(r*(-1+2*B*B)-v/6*B*(-3+4*y*y)*(-3+4*B*B))),t=q,q=c/(6356752.31424518*l)+E;c=n*y-e*r*f;h=g/
16*h*(4+g*(4-3*h));return a.b.Oa((b+(Math.atan2(y*d,e*r-n*y*f)-(1-h)*g*Math.sqrt(m)*(q+h*y*(B+h*r*(-1+2*B*B)))))/(Math.PI/180),Math.atan2(n*r+e*y*f,(1-g)*Math.sqrt(m+c*c))/(Math.PI/180))};e.cN=function(a,e,b,f){var c=1/298.257223563,g=f-e,d=Math.atan((1-c)*Math.tan(a)),m=Math.atan((1-c)*Math.tan(b)),n=Math.sin(d),d=Math.cos(d),k=Math.sin(m),m=Math.cos(m),h=g,q,l=1E3,v,t,y,r,B,E,u;do{y=Math.sin(h);r=Math.cos(h);t=Math.sqrt(m*y*m*y+(d*k-n*m*r)*(d*k-n*m*r));if(0===t)return 0;r=n*k+d*m*r;B=Math.atan2(t,
r);E=d*m*y/t;v=1-E*E;y=r-2*n*k/v;isNaN(y)&&(y=0);u=c/16*v*(4+c*(4-3*v));q=h;h=g+(1-u)*c*E*(B+u*t*(y+u*r*(-1+2*y*y)))}while(1E-12<Math.abs(h-q)&&0<--l);if(0===l)return n=f-e,{azimuth:Math.atan2(Math.sin(n)*Math.cos(b),Math.cos(a)*Math.sin(b)-Math.sin(a)*Math.cos(b)*Math.cos(n)),geodesicDistance:6371009*Math.acos(Math.sin(a)*Math.sin(b)+Math.cos(a)*Math.cos(b)*Math.cos(f-e))};a=2.7233160610754688E11*v/4.040829998466145E13;e=a/1024*(256+a*(-128+a*(74-47*a)));return{azimuth:Math.atan2(m*Math.sin(h),d*
k-n*m*Math.cos(h)),lN:6356752.31424518*(1+a/16384*(4096+a*(-768+a*(320-175*a))))*(B-e*t*(y+e/4*(r*(-1+2*y*y)-e/6*y*(-3+4*t*t)*(-3+4*y*y)))),yU:Math.atan2(d*Math.sin(h),d*k*Math.cos(h)-n*m)}};e.oT=function(e){var b=e.hasAttribute(1),f=e.hasAttribute(2),c=[],g=e.ea(),d=null,m=null;b&&(d=e.mc(1));f&&(m=e.mc(2));for(var n=new a.b,k=0;k<g;k++){for(var h=e.Ea(k),q=e.Ha(k),l=0,v=0,t=NaN,y=NaN,r=NaN,B=NaN,E=e.vc(k),u=[],x=h;x<h+q;x++){e.w(x,n);var B=r=NaN,C=[n.x,n.y];b&&(r=d.get(x),C.push(r));f&&(g=m.get(x),
C.push(B));x==h&&E&&(l=n.x,v=n.y,t=r,y=B);u.push(C)}!E||l==n.x&&v==n.y&&(!b||isNaN(t)&&isNaN(r)||t==r)&&(!f||isNaN(y)&&isNaN(B)||y==B)||u.push(u[0].slice(0));c.push(u)}return c};e.fw=function(a,b){a=e.oT(a);var f=Math.PI/180;637.100877151506>b&&(b=637.100877151506);for(var c=[],g=0;g<a.length;g++){var d=a[g],m;c.push(m=[]);m.push([d[0][0],d[0][1]]);var n,k,h,q,l,v;n=d[0][0]*f;k=d[0][1]*f;for(l=0;l<d.length-1;l++)if(h=d[l+1][0]*f,q=d[l+1][1]*f,n!==h||k!==q){q=e.cN(k,n,q,h);h=q.azimuth;q=q.lN;var t=
q/b;if(1<t){for(v=1;v<=t-1;v++){var y=e.Wu(k,n,h,v*b);m.push([y.x,y.y])}v=e.Wu(k,n,h,(q+Math.floor(t-1)*b)/2);m.push([v.x,v.y])}k=e.Wu(k,n,h,q);m.push([k.x,k.y]);n=k.x*f;k=k.y*f}}return{mF:c}};e.kN=function(b){for(var f=[],c=0;c<b.length;c++){var g=b[c],g=e.fw(g,1E4);f.push(g)}b=[];for(var d,m,n=0;n<f.length;n++){for(var g=f[n],k=0,c=0;c<g.mF.length;c++){var h=g.mF[c];d=e.Xr(a.b.Oa(h[0][0],h[0][1]));m=e.Xr(a.b.Oa(h[h.length-1][0],h[h.length-1][1]));var q=m.x*d.y-d.x*m.y,l;for(l=0;l<h.length-1;l++)d=
e.Xr(a.b.Oa(h[l+1][0],h[l+1][1])),m=e.Xr(a.b.Oa(h[l][0],h[l][1])),q+=m.x*d.y-d.x*m.y;q/=4046.87;k+=q}b.push(k/-2*4046.85642)}return b};return e}();a.oH=d;d=function(){function b(){}b.oy=function(a,e,f,c,g,d,m){b.AG[a.hc()]=e;0==isNaN(f)&&(b.CG[a.hc()]=f);0==isNaN(c)&&(b.iz[a.hc()]=c);0==isNaN(g)&&(b.lG[a.hc()]=g);b.EG[a.hc()]=d;null!==m&&(b.GG[a.hc()]=m)};b.xu=function(a,e,f){b.IG[a.hc()+"-"+e.hc()]=f};b.Em=function(e){e=b.AG[e.hc()];if(void 0==e)throw a.g.qe();return e};b.IC=function(e){e=b.CG[e.hc()];
if(void 0==e)throw a.g.qe();return e};b.ft=function(e){e=b.iz[e.hc()];if(void 0==e)throw a.g.qe();return e};b.Ts=function(e){e=b.lG[e.hc()];if(void 0==e)throw a.g.qe();return e};b.Fm=function(e){e=b.GG[e.hc()];if(void 0==e)throw a.g.qe();return a.i.Oa(e[0],e[1],e[2],e[3])};b.Qo=function(e){e=b.EG[e.hc()];if(void 0==e)throw a.g.qe();return e};b.Wl=function(e,f,c){if(f.lc(c))return e;var g=b.IG[f.hc()+"-"+c.hc()];if(void 0!==g)return g(e,f,c);throw a.g.qe();};b.tu=function(){throw a.g.qe();};b.qN=function(){throw a.g.qe();
};b.YQ=function(){throw a.g.qe();};b.TN=function(){throw a.g.qe();};b.qR=function(){var b=a.Nf.create(102100),c=a.Nf.create(3857),g=a.Nf.create(4326);a.Ya.oy(b,g,NaN,NaN,NaN,!1,null);a.Ya.oy(g,g,1,.0033528106647474805,6378137,!0,[-180,-90,180,90]);a.Ya.oy(c,g,NaN,NaN,NaN,!1,null);a.Ya.xu(b,g,e);a.Ya.xu(g,b,f);a.Ya.xu(c,g,e);a.Ya.xu(g,c,f)};b.AG=[];b.CG=[];b.iz=[];b.lG=[];b.EG=[];b.GG=[];b.IG=[];return b}();a.Ya=d})(E||(E={}));E.Ya.qR();(function(a){var b=function(){function b(a){this.f=null;this.qg=
-1;this.Xc=this.size=this.We=0;this.Ic=a}b.prototype.Jc=function(a){a<this.We?(this.f[a*this.Ic]=this.qg,this.qg=a):this.We--;this.size--};b.prototype.O=function(a,e){return this.f[a*this.Ic+e]};b.prototype.L=function(a,e,b){this.f[a*this.Ic+e]=b};b.prototype.be=function(){var b=this.qg;if(-1==b){if(this.We==this.Xc){b=0!=this.Xc?a.I.truncate(3*(this.Xc+1)/2):1;2147483647<b&&(b=2147483647);if(b==this.Xc)throw a.g.Uc();this.Gm(b)}b=this.We;this.We++}else this.qg=this.f[b*this.Ic];this.size++;for(var e=
b*this.Ic+this.Ic,f=b*this.Ic;f<e;f++)this.f[f]=-1;return b};b.prototype.Pj=function(b){var e=this.qg;if(-1==e){if(this.We==this.Xc){e=0!=this.Xc?a.I.truncate(3*(this.Xc+1)/2):1;2147483647<e&&(e=2147483647);if(e==this.Xc)throw a.g.Uc();this.Gm(e)}e=this.We;this.We++}else this.qg=this.f[e*this.Ic];this.size++;for(var f=e*this.Ic,c=this.Ic,g=0;g<c;g++)this.f[f+g]=b[g];return e};b.prototype.Nh=function(a){this.qg=-1;this.size=this.We=0;a&&(this.f=null,this.Xc=0)};b.prototype.de=function(a){a>this.Xc&&
this.Gm(a)};b.prototype.Pu=function(a,e,b){var f=this.f[this.Ic*e+b];this.f[this.Ic*e+b]=this.f[this.Ic*a+b];this.f[this.Ic*a+b]=f};b.Zk=function(){return-2};b.lm=function(){return-3};b.Zw=function(a){return 0<=a};b.prototype.Gm=function(a){null==this.f&&(this.f=[]);this.Xc=a};return b}();a.Fc=b;b=function(){function b(a){this.f=new Int32Array(0);this.qg=-1;this.Xc=this.size=this.We=0;this.Ic=a}b.prototype.Jc=function(a){a<this.We?(this.f[a*this.Ic]=this.qg,this.qg=a):this.We--;this.size--};b.prototype.O=
function(a,e){return this.f[a*this.Ic+e]};b.prototype.L=function(a,e,b){this.f[a*this.Ic+e]=b};b.prototype.be=function(){var b=this.qg;if(-1==b){if(this.We==this.Xc){b=0!=this.Xc?a.I.truncate(3*(this.Xc+1)/2):1;2147483647<b&&(b=2147483647);if(b==this.Xc)throw a.g.Uc();this.Gm(b)}b=this.We;this.We++}else this.qg=this.f[b*this.Ic];this.size++;for(var e=b*this.Ic;e<b*this.Ic+this.Ic;e++)this.f[e]=-1;return b};b.prototype.Pj=function(b){var e=this.qg;if(-1==e){if(this.We==this.Xc){e=0!=this.Xc?a.I.truncate(3*
(this.Xc+1)/2):1;2147483647<e&&(e=2147483647);if(e==this.Xc)throw a.g.Uc();this.Gm(e)}e=this.We;this.We++}else this.qg=this.f[e*this.Ic];this.size++;for(var f=e*this.Ic,c=0;c<b.length;c++)this.f[f+c]=b[c];return e};b.prototype.Nh=function(a){this.qg=-1;this.size=this.We=0;a&&(this.f=null,this.Xc=0)};b.prototype.de=function(a){a>this.Xc&&this.Gm(a)};b.prototype.Pu=function(a,e,b){var f=this.f[this.Ic*e+b];this.f[this.Ic*e+b]=this.f[this.Ic*a+b];this.f[this.Ic*a+b]=f};b.Zk=function(){return-2};b.lm=
function(){return-3};b.Zw=function(a){return 0<=a};b.prototype.Gm=function(a){null==this.f&&(this.f=new Int32Array(0));var e=new Int32Array(this.Ic*a);e.set(this.f,0);this.f=e;this.Xc=a};return b}();a.II=b;!0===a.ah.Sk&&(a.Fc=a.II)})(E||(E={}));(function(a){var b;(function(a){a[a.enumInputModeBuildGraph=0]="enumInputModeBuildGraph";a[a.enumInputModeSimplifyAlternate=4]="enumInputModeSimplifyAlternate";a[a.enumInputModeSimplifyWinding=5]="enumInputModeSimplifyWinding";a[a.enumInputModeIsSimplePolygon=
7]="enumInputModeIsSimplePolygon"})(b||(b={}));var c=function(){function e(e){this.me=e;this.Zg=NaN;this.LD=new a.Ag;this.MD=new a.Ag;this.Aq=new a.Nd;this.Bq=new a.Nd}e.prototype.compare=function(a,e,b){a=a.da(b);this.me.iy(e,this.LD);this.me.iy(a,this.MD);e=this.LD.get();a=this.MD.get();this.Aq.K(e.na,e.la);this.Bq.K(a.na,a.la);if(this.Aq.va<this.Bq.qa)return-1;if(this.Aq.qa>this.Bq.va)return 1;b=e.ja==e.ha;var f=a.ja==a.ha;if(b||f){if(b&&f)return 0;if(e.ja==a.ja&&e.na==a.na)return b?1:-1;if(e.ha==
a.ha&&e.la==a.la)return b?-1:1}b=e.xe(this.Zg,this.Aq.qa);f=a.xe(this.Zg,this.Bq.qa);b==f&&(b=Math.min(e.ha,a.ha),f=.5*(b+this.Zg),f==this.Zg&&(f=b),b=e.xe(f,this.Aq.qa),f=a.xe(f,this.Bq.qa));return b<f?-1:b>f?1:0};e.prototype.$F=function(a){this.Zg=a};return e}(),g=function(){function e(e){this.ab=e;this.uE=new a.Ag;this.nf=new a.b;this.xx=new a.Nd}e.prototype.eS=function(a){this.nf.J(a)};e.prototype.compare=function(a,e){this.ab.iy(a.da(e),this.uE);a=this.uE.get();this.xx.K(a.na,a.la);if(this.nf.x<
this.xx.qa)return-1;if(this.nf.x>this.xx.va)return 1;a=a.xe(this.nf.y,this.nf.x);return this.nf.x<a?-1:this.nf.x>a?1:0};return e}();b=function(){function e(){this.OD=this.Vh=this.Yh=this.px=this.Pm=this.je=this.xc=this.Ig=this.Td=null;this.sn=this.eg=-1;this.ND=!0;this.tx=!1;this.qx=NaN;this.ei=new a.wd;this.EK=2147483647;this.DK=a.I.truncate(-2147483648);this.Kf=this.Md=this.Ek=this.lp=this.Bl=this.kp=this.Zq=this.Be=-1;this.ta=0}e.prototype.Mv=function(a){this.qx=a};e.prototype.Ul=function(){null==
this.Td&&(this.Td=new a.Fc(8));var e=this.Td.be();this.Td.L(e,1,0);return e};e.prototype.kQ=function(){null==this.xc&&(this.xc=new a.Fc(8));var e=this.xc.be();this.xc.L(e,2,0);this.xc.L(e,3,0);var b=this.xc.be();this.xc.L(b,2,0);this.xc.L(b,3,0);this.GF(e,b);this.GF(b,e);return e};e.prototype.FE=function(){null==this.je&&(this.je=new a.Fc(8));var e=this.je.be();this.je.L(e,2,0);return e};e.prototype.QR=function(a,e){this.Td.L(a,7,e)};e.prototype.em=function(a,e){this.Td.L(a,2,e)};e.prototype.PR=function(a,
e){this.Td.L(a,1,e)};e.prototype.fS=function(a,e){this.Td.L(a,3,e)};e.prototype.cS=function(a,e){this.Td.L(a,4,e)};e.prototype.Lp=function(a,e){this.Td.L(a,5,e)};e.prototype.uN=function(a){return this.Td.O(a,5)};e.prototype.OR=function(a,e){this.Td.L(a,6,e)};e.prototype.IJ=function(a,e){this.OR(e,a)};e.prototype.FF=function(a,e){this.xc.L(a,1,e)};e.prototype.GF=function(a,e){this.xc.L(a,4,e)};e.prototype.Rk=function(a,e){this.xc.L(a,5,e)};e.prototype.Qk=function(a,e){this.xc.L(a,6,e)};e.prototype.VR=
function(a,e){this.xc.L(a,2,e)};e.prototype.Du=function(a,e){this.xc.L(a,3,e)};e.prototype.zC=function(a){return this.xc.O(a,3)};e.prototype.Ir=function(a,e){this.xc.L(a,7,e)};e.prototype.zG=function(a,e){if(-1!=this.ql(a))for(e=e?-1:a,a=this.ql(a);-1!=a;a=this.zq(a))this.a.lb(this.Gi(a),this.lp,e)};e.prototype.Tu=function(a,e){-1!=a&&(this.zG(a,e),this.zG(this.sa(a),e))};e.prototype.Gr=function(a,e){this.je.L(a,1,e)};e.prototype.yg=function(a,e){this.je.L(a,2,e)};e.prototype.cm=function(a,e){this.je.L(a,
3,e);this.LR(a,this.tN(e));this.KR(e,a)};e.prototype.KR=function(a,e){this.je.L(a,4,e)};e.prototype.LR=function(a,e){this.je.L(a,5,e)};e.prototype.AF=function(a,e){this.je.L(a,6,e)};e.prototype.yF=function(a,e){this.je.L(a,7,e)};e.prototype.xF=function(a,e){this.Pm.write(a,e)};e.prototype.zF=function(a,e){this.px.write(a,e)};e.prototype.bT=function(e){var b=0,f=0,c=this.pC(e),g=new a.b,d=new a.b,m=new a.b;this.tq(c,g);d.J(g);var k=c;do this.pl(k,m),f+=a.b.Fb(d,m),this.Pe(this.sa(k))!=e&&(b+=(m.x-
g.x-(d.x-g.x))*(m.y-g.y+(d.y-g.y))*.5),d.J(m),k=this.Wb(k);while(k!=c);this.Pm.write(e,b);this.px.write(e,f)};e.prototype.GQ=function(e){var b=new c(this),f=new a.bj;f.de(a.I.truncate(this.ta/2));f.Hn(b);for(var d=new a.ga(0),m=this.Eg(),k=null,h=0,q=new a.b,l=this.Be;-1!=l;l=this.Bf(l)){h++;var v=this.te(l);if(-1!=v){d.cf(0);if(!this.VS(f,m,d,v)){this.w(l,q);b.$F(q.y);var t=v;do{var y=this.tb(t,m);-1!=y&&(f.kd(y,-1),this.Bb(t,m,-2));t=this.Wb(this.sa(t))}while(v!=t);t=v;do y=this.tb(t,m),-1==y&&
(y=f.addElement(t,-1),d.add(y)),t=this.Wb(this.sa(t));while(v!=t)}for(v=d.size-1;0<=v;v--)y=d.get(v),t=f.da(y),this.Bb(this.sa(t),m,y),this.FQ(f,y,e)}else-1==this.mw(l)&&(null==k&&(k=new g(this)),this.w(l,q),k.eS(q),t=f.GR(k),v=this.Ek,-1!=t&&(y=f.da(t),this.Pe(y)==this.Pe(this.sa(y))&&(y=this.BC(f,t)),-1!=y&&(v=this.Pe(y))),this.IJ(v,l))}this.kh(m)};e.prototype.FQ=function(a,e,b){var f=a.da(e),c=this.Pe(f);if(-1==this.ym(c)){var g=this.BC(a,e),d=this.sa(f),m=this.Pe(d);this.yo(c);this.yo(m);var n=
this.ym(c),k=this.ym(m);-1==g&&-1==n&&(m==c?(this.cm(m,this.Ek),n=k=this.Ek):(-1==k&&(this.cm(m,this.Ek),k=this.Ek),this.cm(c,m),n=m));if(-1!=g){var h=this.Pe(g);-1==k&&(0>=this.yo(h)?(k=this.ym(h),this.cm(m,k)):(this.cm(m,h),k=h),m==c&&(n=k))}-1==n&&this.WS(c,m);0==b?this.aR(a,e,f,g,c,m):5==b?this.bR(a,e,f,d,c,m):4==b&&this.$Q(f,g,c,m)}};e.prototype.aR=function(a,e,b,c,g,d){var f=this.pj(g);if(-1!=c){var m=this.pj(d),n=this.pj(this.Pe(c));c=f&m&n;n^=n&this.Gg(b);n|=c;0!=n&&(this.yg(d,m|n),this.yg(g,
n|f),f=f||n)}for(e=a.bb(e);-1!=e;e=a.bb(e)){c=a.da(e);b=this.Pe(this.sa(c));g=this.pj(b);d=this.Gg(c);m=this.Pe(c);n=this.pj(m);c=g&n&f;f^=f&d;f|=c;if(0==f)break;this.yg(b,g|f);this.yg(m,n|f)}};e.prototype.bR=function(e,b,c,g,d,m){if(d!=m){c=this.tb(c,this.Kf);c+=this.tb(g,this.Kf);g=0;var f=new a.ga(0),n=new a.ga(0);n.add(0);for(var k=e.gc(-1);k!=b;k=e.bb(k)){var h=e.da(k),q=this.sa(h),l=this.Pe(h),v=this.Pe(q);if(l!=v){h=this.tb(h,this.Kf);h+=this.tb(q,this.Kf);g+=h;q=!1;0!=f.size&&f.tc()==v&&(n.af(),
f.af(),q=!0);if(-1==this.ym(v))throw a.g.wa();q&&this.ym(v)==l||(n.add(g),f.add(l))}}g+=c;0!=f.size&&f.tc()==m&&(n.af(),f.af());0!=g?0==n.tc()&&(e=this.a.$c,e=this.ya(e),this.yg(d,e)):0!=n.tc()&&(e=this.a.$c,e=this.ya(e),this.yg(d,e))}};e.prototype.$Q=function(a,e,b,c){var f=this.ya(this.a.$c);if(-1==e)this.yg(c,this.sn),a=this.tb(a,this.eg),0!=(a&1)?this.yg(b,f):this.yg(b,this.sn);else{var g=this.pj(c);0==g&&(g=this.pj(this.Pe(e)),this.yg(c,g));a=this.tb(a,this.eg);0!=(a&1)?this.yg(b,g==f?this.sn:
f):this.yg(b,g)}};e.prototype.VS=function(a,e,b,c){var f=c,g=-1,d=-1,m=0;do{if(2==m)return!1;var n=this.tb(f,e);if(-1!=n){if(-1!=g)return!1;g=n}else{if(-1!=d)return!1;d=f}m++;f=this.Wb(this.sa(f))}while(c!=f);if(-1==d||-1==g)return!1;this.Bb(a.da(g),e,-2);a.Vi(g,d);b.add(g);return!0};e.prototype.WS=function(a,e){var b=this.yo(a);if(0!=b){var f=this.yo(e);0<b&&0>f?this.cm(a,e):0>b&&0<f?this.cm(a,e):(b=this.ym(e),-1!=b&&this.cm(a,b))}};e.prototype.RL=function(e,b){this.lp=this.a.re();for(var f=0,c=
b.size;f<c;f++){var g=b.get(f),d=this.a.Ra(g,this.Bl),m=this.a.Vf(this.a.rd(g)),n=this.a.Lb(m);if(a.T.Kc(n)){var k=this.a.X(g);if(-1!=k){var h=this.a.Ra(k,this.Bl);if(d!=h){var q=this.kQ(),l=this.sa(q),v=this.Ig.be();this.Ig.L(v,0,g);this.Ig.L(v,1,-1);this.Ir(q,v);this.FF(q,d);v=this.te(d);-1==v?(this.em(d,q),this.Rk(q,l),this.Qk(l,q)):(d=this.fe(v),this.Rk(v,l),this.Qk(l,v),this.Qk(d,q),this.Rk(q,d));this.FF(l,h);d=this.te(h);-1==d?(this.em(h,l),this.Qk(q,l),this.Rk(l,q)):(h=this.fe(d),this.Rk(d,
q),this.Qk(q,d),this.Qk(h,l),this.Rk(l,h));m=this.ya(m);0==e?(this.Bb(l,this.Md,0),this.Bb(q,this.Md,1736==n?m:0)):5==e?(h=new a.b,this.a.w(g,h),g=new a.b,this.a.w(k,g),d=k=0,0>h.compare(g)?k=1:d=-1,this.Bb(l,this.Md,0),this.Bb(q,this.Md,0),this.Bb(q,this.Kf,k),this.Bb(l,this.Kf,d)):7==e?(this.Bb(l,this.Md,this.sn),this.Bb(q,this.Md,1736==n?m:0)):4==e&&(this.Bb(l,this.Md,0),this.Bb(q,this.Md,0),this.Bb(q,this.eg,1),this.Bb(l,this.eg,1));n=1736==n?this.DK:0;this.Du(q,m|n);this.Du(l,m|n)}}}}};e.prototype.ZP=
function(a,e){var b=this.ql(e);if(-1!=b){var f=this.ql(a);this.Ig.L(b,1,f);this.Ir(a,b);this.Ir(e,-1)}a=this.sa(a);e=this.sa(e);b=this.ql(e);-1!=b&&(f=this.ql(a),this.Ig.L(b,1,f),this.Ir(a,b),this.Ir(e,-1))};e.prototype.AS=function(e){function b(a,e){return c.lL(a,e)}var f=new a.ga(0);f.xb(10);for(var c=this,g=this.Be;-1!=g;g=this.Bf(g)){f.clear(!1);var d=this.te(g);if(-1!=d){var m=d;do f.add(m),m=this.Wb(this.sa(m));while(m!=d);if(1<f.size){m=!0;if(2<f.size)f.xd(0,f.size,b),f.add(f.get(0));else if(0<
this.kL(f.get(0),f.get(1))){var k=f.get(0);f.set(0,f.get(1));f.set(1,k)}else m=!1;for(var h=k=f.get(0),q=this.jf(h),l=this.sa(h),v=-1,t=1,y=f.size;t<y;t++){var r=f.get(t),B=this.sa(r),E=this.qj(B);if(E==q&&r!=h){if(0==e)v=this.zC(h)|this.zC(r),this.Du(h,v),this.Du(l,v),this.Bb(h,this.Md,this.tb(h,this.Md)|this.tb(r,this.Md)),this.Bb(l,this.Md,this.tb(l,this.Md)|this.tb(B,this.Md));else if(-1!=this.Kf)v=this.tb(h,this.Kf)+this.tb(r,this.Kf),B=this.tb(l,this.Kf)+this.tb(B,this.Kf),this.Bb(h,this.Kf,
v),this.Bb(l,this.Kf,B);else{if(7==e){this.ei=new a.wd(5,g,-1);return}-1!=this.eg&&(v=this.tb(h,this.eg)+this.tb(r,this.eg),B=this.tb(l,this.eg)+this.tb(B,this.eg),this.Bb(h,this.eg,v),this.Bb(l,this.eg,B))}this.ZP(h,r);this.Wv(r);v=h;f.set(t,-1);r==k&&(f.set(0,-1),k=-1)}else this.Tu(v,!1),v=-1,h=r,q=E,l=B}this.Tu(v,!1);v=-1;if(m){k=-1;t=0;for(y=f.size;t<y;t++)if(r=f.get(t),-1!=r)if(-1==k)h=k=r,q=this.jf(h),l=this.sa(h);else if(r!=h&&(B=this.sa(r),E=this.qj(B),this.Qk(l,r),this.Rk(r,l),h=r,q=E,l=
B,7==e&&(this.tb(r,this.Md)|this.tb(this.fe(r),this.Md))==(this.sn|1))){this.ei=new a.wd(5,g,-1);return}this.em(g,k)}else{k=-1;t=0;for(y=f.size;t<y;t++)if(r=f.get(t),-1!=r){k=r;break}d!=k&&this.em(g,k)}}}}};e.prototype.AK=function(){for(var e=-1,b=this.Eg(),c=this.Be;-1!=c;c=this.Bf(c)){var g=this.te(c);if(-1!=g){var d=g;do{if(1!=this.tb(d,b)){var m=this.FE();this.Gr(m,d);this.yF(m,e);-1!=e&&this.AF(e,m);var e=m,k=0,h=d;do k|=this.tb(h,this.Md),this.VR(h,m),this.Bb(h,b,1),h=this.Wb(h);while(h!=d);
this.yg(m,k)}d=this.Wb(this.sa(d))}while(d!=g)}}m=this.FE();this.Gr(m,-1);this.yF(m,e);-1!=e&&this.AF(e,m);this.Ek=m;this.Pm=a.qd.Yc(this.je.size,NaN);this.px=a.qd.Yc(this.je.size,NaN);this.xF(this.Ek,Infinity);this.zF(this.Ek,Infinity);this.kh(b)};e.prototype.EN=function(a,e,b){e=-1!=e?e:this.te(a);if(-1==e)return-1;for(a=e;;){if(1!=this.tb(e,b))return e;e=this.Wb(this.sa(e));if(e==a)return-1}};e.prototype.uR=function(){for(var a=this.Eg(),e=this.Be;-1!=e;e=this.Bf(e))for(var b=-1;;){var c=this.EN(e,
b,a);if(-1==c)break;for(var b=this.Wb(this.sa(c)),g=c;;){var d=this.Wb(g),m=this.fe(g),k=this.sa(g);if(m==k){this.bM(g);if(b==g||b==k)b=-1;if(g==c||m==c){c=d;if(g==c||m==c)break;g=d;continue}}else this.Bb(g,a,1);g=d;if(g==c)break}}};e.prototype.Ay=function(e,b,c,g){this.xg();this.ND=g;this.a=e;this.kp=this.a.RB();e=new a.ga(0);e.xb(null!=c?this.a.F(c.get(0)):this.a.pd);var f=0,d=1,m=null!=c?c.get(0):this.a.$c;for(g=1;-1!=m;){this.a.EF(m,this.kp,d);for(var d=d<<1,n=this.a.Vb(m);-1!=n;n=this.a.bc(n))for(var k=
this.a.Cb(n),h=0,q=this.a.Ha(n);h<q;h++)e.add(k),k=this.a.X(k);a.T.Km(this.a.Lb(m))||(f+=this.a.ea(m));null!=c?(m=g<c.size?c.get(g):-1,g++):m=this.a.we(m)}this.sn=d;this.ta=e.size;this.a.Mu(e,this.ta);null==this.Ig&&(this.Ig=new a.Fc(2),this.Td=new a.Fc(8),this.xc=new a.Fc(8),this.je=new a.Fc(8));this.Ig.de(this.ta);this.Td.de(this.ta+10);this.xc.de(2*this.ta+32);this.je.de(Math.max(32,f));this.Bl=this.a.re();c=new a.b;g=0;f=new a.b;c.Eh();for(d=0;d<=this.ta;d++)if(d<this.ta?(k=e.get(d),this.a.w(k,
f)):f.Eh(),!c.ub(f)){if(g<d){k=this.Ul();for(q=h=-1;g<d;g++)q=e.get(g),this.a.lb(q,this.Bl,k),m=this.Ig.be(),this.Ig.L(m,0,q),this.Ig.L(m,1,h),h=m,n=this.a.rd(q),m=this.a.Vf(n),m=this.ya(m),this.PR(k,this.md(k)|m);this.QR(k,h);this.Lp(k,this.a.gb(q));-1!=this.Zq&&this.cS(this.Zq,k);this.fS(k,this.Zq);this.Zq=k;-1==this.Be&&(this.Be=k)}g=d;c.J(f)}this.Md=this.Eg();5==b&&(this.Kf=this.Eg());4==b&&(this.eg=this.Eg());this.RL(b,e);0==this.ei.yh&&(this.AS(b),0==this.ei.yh&&(isNaN(this.qx)||this.ZK()?(this.AK(),
0==this.ei.yh&&(this.kh(this.Md),this.Md=-1,this.ND&&this.GQ(b))):this.tx=!0))};e.prototype.Wv=function(a){var e=this.Wb(a),b=this.fe(a),f=this.sa(a),c=this.Wb(f),g=this.fe(f);e!=f&&(this.Qk(g,e),this.Rk(e,g));b!=f&&(this.Qk(b,c),this.Rk(c,b));b=this.qj(a);this.te(b)==a&&(c!=a?this.em(b,c):this.em(b,-1));c=this.qj(f);this.te(c)==f&&(e!=f?this.em(c,e):this.em(c,-1));this.xc.Jc(a);this.xc.Jc(f)};e.prototype.BC=function(a,e){for(;;)if(e=a.ge(e),-1!=e){var b=a.da(e);if(this.Pe(b)!=this.Pe(this.sa(b)))return b}else return-1};
e.prototype.Mp=function(a,e,b){void 0===b&&(b=!0);this.Ay(a,0,null,b)};e.prototype.tF=function(e,b){var f=new a.ga(0);f.add(b);this.Ay(e,4,f,1736==e.Lb(b))};e.prototype.uF=function(e,b){var f=new a.ga(0);f.add(b);this.Ay(e,5,f,!0)};e.prototype.xg=function(){null!=this.a&&(-1!=this.kp&&(this.a.tR(this.kp),this.kp=-1),-1!=this.Bl&&(this.a.bf(this.Bl),this.Bl=-1),-1!=this.lp&&(this.a.bf(this.lp),this.lp=-1),-1!=this.Md&&(this.kh(this.Md),this.Md=-1),-1!=this.Kf&&(this.kh(this.Kf),this.Kf=-1),-1!=this.eg&&
(this.kh(this.eg),this.eg=-1),this.a=null,this.Td.Nh(!0),this.Ig.Nh(!0),this.Zq=this.Be=-1,null!=this.xc&&this.xc.Nh(!0),null!=this.Yh&&(this.Yh.length=0),null!=this.Vh&&(this.Vh.length=0),null!=this.OD&&(this.OD.length=0),null!=this.je&&this.je.Nh(!0),this.Ek=-1,this.Pm=null)};e.prototype.te=function(a){return this.Td.O(a,2)};e.prototype.w=function(a,e){this.a.SC(this.uN(a),e)};e.prototype.md=function(a){return this.Td.O(a,1)};e.prototype.Bf=function(a){return this.Td.O(a,4)};e.prototype.mw=function(a){return this.Td.O(a,
6)};e.prototype.ol=function(a){return this.Td.O(a,7)};e.prototype.zq=function(a){return this.Ig.O(a,1)};e.prototype.Gi=function(a){return this.Ig.O(a,0)};e.prototype.Sf=function(a,e){e=this.Vh[e];return e.size<=a?-1:e.read(a)};e.prototype.fm=function(a,e,b){e=this.Vh[e];e.size<=a&&e.resize(this.Td.size,-1);e.write(a,b)};e.prototype.uo=function(){null==this.Vh&&(this.Vh=[]);for(var e=a.ga.Yc(this.Td.Xc,-1),b=0,c=this.Vh.length;b<c;b++)if(null==this.Vh[b])return this.Vh[b]=e,b;this.Vh.push(e);return this.Vh.length-
1};e.prototype.vo=function(a){this.Vh[a]=null};e.prototype.qj=function(a){return this.xc.O(a,1)};e.prototype.jf=function(a){return this.qj(this.sa(a))};e.prototype.sa=function(a){return this.xc.O(a,4)};e.prototype.fe=function(a){return this.xc.O(a,5)};e.prototype.Wb=function(a){return this.xc.O(a,6)};e.prototype.Pe=function(a){return this.xc.O(a,2)};e.prototype.Qe=function(a){return this.pj(this.xc.O(a,2))};e.prototype.ql=function(a){return this.xc.O(a,7)};e.prototype.tq=function(a,e){this.w(this.qj(a),
e)};e.prototype.pl=function(a,e){this.w(this.jf(a),e)};e.prototype.Gg=function(a){return this.xc.O(a,3)&this.EK};e.prototype.tb=function(a,e){e=this.Yh[e];return e.size<=a?-1:e.read(a)};e.prototype.Bb=function(a,e,b){e=this.Yh[e];e.size<=a&&e.resize(this.xc.size,-1);e.write(a,b)};e.prototype.Eg=function(){null==this.Yh&&(this.Yh=[]);for(var e=a.ga.Yc(this.xc.Xc,-1),b=0,c=this.Yh.length;b<c;b++)if(null==this.Yh[b])return this.Yh[b]=e,b;this.Yh.push(e);return this.Yh.length-1};e.prototype.kh=function(a){this.Yh[a]=
null};e.prototype.bM=function(a){var e=this.Pe(a),b=this.Wb(a);b==this.sa(a)&&(b=this.Wb(b),b==a&&(b=-1));this.pC(e)==a&&this.Gr(e,b);b=this.Pm.read(e);isNaN(b)||(this.xF(e,NaN),this.zF(e,NaN));this.Tu(a,!0);this.Wv(a)};e.prototype.cM=function(a){for(var e=0,b=a.size;e<b;e++){var f=a.get(e),c=this.Pe(this.sa(f));this.Gr(this.Pe(f),-1);this.Gr(c,-1);this.Tu(f,!0);this.Wv(f)}};e.prototype.pC=function(a){return this.je.O(a,1)};e.prototype.pj=function(a){return this.je.O(a,2)};e.prototype.ym=function(a){return this.je.O(a,
3)};e.prototype.tN=function(a){return this.je.O(a,4)};e.prototype.yo=function(a){var e=this.Pm.read(a);isNaN(e)&&(this.bT(a),e=this.Pm.read(a));return e};e.prototype.ya=function(a){return this.a.yC(a,this.kp)};e.prototype.se=function(a){return this.a.Ra(a,this.Bl)};e.prototype.GN=function(a){return this.a.Ra(a,this.lp)};e.prototype.FN=function(a,e){var b=this.te(a);if(-1==b)return-1;var f=b,c=-1,g=-1;do{if(this.jf(f)==e)return f;if(-1==c){c=this.te(e);if(-1==c)break;g=c}if(this.jf(g)==a)return f=
this.sa(g);f=this.Wb(this.sa(f));g=this.Wb(this.sa(g))}while(f!=b&&g!=c);return-1};e.prototype.iy=function(e,b){b.mq();b=b.get();var f=new a.b;this.tq(e,f);b.ed(f);this.pl(e,f);b.vd(f)};e.prototype.lL=function(e,b){if(e==b)return 0;var f=new a.b;this.pl(e,f);var c=new a.b;this.pl(b,c);if(f.ub(c))return 0;b=new a.b;this.tq(e,b);e=new a.b;e.pc(f,b);f=new a.b;f.pc(c,b);return a.b.cq(e,f)};e.prototype.kL=function(e,b){if(e==b)return 0;var f=new a.b;this.pl(e,f);var c=new a.b;this.pl(b,c);if(f.ub(c))return 0;
b=new a.b;this.tq(e,b);e=new a.b;e.pc(f,b);f=new a.b;f.pc(c,b);return 0<=f.y&&0<e.y?a.b.cq(e,f):0};e.prototype.ZK=function(){for(var e=a.vi.Ty(this.qx),b=new a.b,c=new a.b,g=new a.b,d=new a.b,m=new a.b,k=this.Be;-1!=k;k=this.Bf(k)){var h=this.te(k);if(-1!=h){var q=h;this.tq(q,b);this.pl(q,c);m.pc(c,b);var l=m.Up();do{var v=q,q=this.Wb(this.sa(q));if(q!=v){this.pl(q,g);d.pc(g,b);var v=d.Up(),t=d.Ai(m);if(t*t/(v*l)*Math.min(v,l)<=e)return!1;m.J(d);l=v;c.J(g)}}while(q!=h)}}return!0};return e}();a.gs=
b})(E||(E={}));(function(a){var b=function(){function b(){this.h=null;this.TD=new a.b;this.UD=new a.b;this.Qg=null;this.Gq=!1;this.Ym=-1}b.prototype.Te=function(a){return a<this.Qg.length?this.Qg[a]:!1};b.prototype.xm=function(b,e,f,c){var g=a.T.ve(this.h.a.Lb(f));if(2==a.T.ve(this.h.a.Lb(e))&&1==g)this.WL(b,e,f,c);else throw a.g.wa();};b.prototype.Mp=function(b,e){null==this.h&&(this.h=new a.gs);this.h.Mp(b,e)};b.prototype.Np=function(b,e,f){a.aj.$(b,e,f,!0);for(e=b.$c;-1!=e;e=b.we(e))1736==b.Lb(e)&&
a.mm.$(b,e,-1,this.Gq,f);this.Mp(b,f)};b.prototype.EB=function(a,e,b,c,d){var f=this.h.a;if(1736==f.Lb(a))for(a=f.Vb(a);-1!=a;a=f.bc(a)){var g=f.Cb(a);this.h.se(g);this.h.se(f.X(g));var m=this.h.GN(g);if(-1!=m){var n=this.h.tb(m,b);if(1!=n&&2!=n)if(this.Te(this.h.Qe(m))){this.h.Bb(m,b,1);var n=f.Cf(e,-1),k=m,h=this.h.se(g),q=1;do{var l=this.tl(g,d);f.zi(n,l);-1!=c&&this.h.fm(h,c,1);this.h.Bb(k,b,1);var k=this.h.Wb(k),v;do l=1==q?f.X(g):f.Ua(g),v=-1!=l?this.h.se(l):-1;while(v==h);var t=this.h.qj(k);
if(t!=v){do l=1==q?f.Ua(g):f.X(g),v=-1!=l?this.h.se(l):-1;while(v==h);t!=v?(v=t,l=this.h.Gi(this.h.ol(v))):q=-q}h=v;g=l}while(k!=m);f.Gn(n,!0)}else this.h.Bb(m,b,2)}}};b.prototype.UB=function(){for(var b=this.h.Eg(),e=new a.ga(0),f=this.h.Be;-1!=f;f=this.h.Bf(f)){var c=this.h.te(f),d=c;if(-1!=c){do{if(1!=this.h.tb(d,b)){var m=this.h.sa(d);this.h.Bb(m,b,1);this.h.Bb(d,b,1);this.Te(this.h.Qe(d))&&this.Te(this.h.Qe(m))&&e.add(d)}d=this.h.Wb(this.h.sa(d))}while(d!=c)}}this.h.kh(b);this.h.cM(e)};b.prototype.tl=
function(a,e){return-1==e?a:this.kO(a,e)};b.prototype.kO=function(a,e){var b=this.h.a,c,g,d=this.h.ol(this.h.se(a));do{c=this.h.Gi(d);g=b.Vf(b.rd(c));if(g==e)return c;d=this.h.zq(d)}while(-1!=d);return a};b.prototype.Xp=function(b,e,f){this.UB();var c=this.h.a,g=c.jg(1736),d=this.h.Eg();this.pG(b,e,g,f,d,-1);this.h.kh(d);a.mm.$(c,g,1,this.Gq,null);return g};b.prototype.pG=function(a,e,b,c,d,m){this.EB(a,b,d,m,c);-1!=e&&this.EB(e,b,d,m,c);a=this.h.a;for(e=this.h.Be;-1!=e;e=this.h.Bf(e)){var f=this.h.te(e);
if(-1!=f){var g=f;do{var n=this.h.tb(g,d);if(1!=n&&2!=n)if(this.Te(this.h.Qe(g))){var n=a.Cf(b,-1),k=g;do{var h=this.h.ql(k);-1!=h?h=this.h.Gi(h):(h=this.h.Gi(this.h.ql(this.h.sa(k))),h=this.h.a.X(h));h=this.tl(h,c);a.zi(n,h);this.h.Bb(k,d,1);-1!=m&&(h=this.h.se(h),this.h.fm(h,m,1));k=this.h.Wb(k)}while(k!=g);a.Gn(n,!0)}else this.h.Bb(g,d,2);g=this.h.Wb(this.h.sa(g))}while(g!=f)}}};b.prototype.RS=function(b,e,f){var c=this.h.a,g=c.jg(1736),d=c.jg(1607),m=c.jg(550);this.UB();var k=-1,h=this.h.Eg(),
q=this.h.uo();this.pG(b,e,g,f,h,q);for(b=this.h.Be;-1!=b;b=this.h.Bf(b))if(e=this.h.te(b),-1!=e){var l=e;do{var v=this.h.tb(l,h),t=this.h.tb(this.h.sa(l),h),v=v|t;if(2==v)if(v=this.h.Gg(l),this.Te(v)){var y=c.Cf(d,-1),r=l,v=this.Au(b,c),v=this.tl(v,f);c.zi(y,v);this.h.fm(b,q,1);do{v=this.h.jf(r);t=this.Au(v,c);t=this.tl(t,f);c.zi(y,t);this.h.Bb(r,h,1);this.h.Bb(this.h.sa(r),h,1);this.h.fm(v,q,1);r=this.h.Wb(r);v=this.h.tb(r,h);t=this.h.tb(this.h.sa(r),h);v|=t;if(2!=v)break;v=this.h.Gg(r);if(!this.Te(v)){this.h.Bb(r,
h,1);this.h.Bb(this.h.sa(r),h,1);break}}while(r!=l)}else this.h.Bb(l,h,1),this.h.Bb(this.h.sa(l),h,1);l=this.h.Wb(this.h.sa(l))}while(l!=e)}for(b=this.h.Be;-1!=b;b=this.h.Bf(b))v=this.h.Sf(b,q),1!=v&&(v=this.h.md(b),this.Te(v)&&(-1==k&&(k=c.Cf(m,-1)),e=this.h.ol(b),-1!=e&&(e=this.h.Gi(e),v=this.tl(e,f),c.zi(k,v))));this.h.vo(q);this.h.kh(h);a.mm.$(c,g,1,this.Gq,null);f=[];f[0]=m;f[1]=d;f[2]=g;return f};b.prototype.Au=function(a,e){var b=-1;for(a=this.h.ol(a);-1!=a;a=this.h.zq(a)){var c=this.h.Gi(a);
-1==b&&(b=c);var g=this.h.ya(e.Vf(e.rd(c)));if(this.Te(g)){b=c;break}}return b};b.prototype.fy=function(b,e){for(var f=this.h.qj(e),c=this.h.jf(e),g=0,d=0,m=this.h.ol(f);-1!=m;m=this.h.zq(m)){var k=this.h.Gi(m),h=b.rd(k),q=this.h.ya(b.Vf(h)),l=b.X(k),v=b.Ua(k),h=b.Cb(h);h==k&&(this.Ym=e);-1!=l&&this.h.se(l)==c?(g++,this.Te(q)&&(h==l&&(this.Ym=this.h.Wb(e)),d++)):-1!=v&&this.h.se(v)==c&&(g--,this.Te(q)&&(h==v&&(this.Ym=this.h.Wb(e)),d--))}this.h.w(f,this.TD);this.h.w(c,this.UD);f=a.b.Fb(this.TD,this.UD);
return(0!=d?d:g)*f};b.prototype.Ao=function(a){return this.h.Gg(a)|this.h.Qe(a)|this.h.Qe(this.h.sa(a))};b.prototype.sG=function(a){for(var e=this.h.sa(this.h.fe(a)),b=-1;e!=a;){if(this.Te(this.Ao(e))){if(-1!=b)return-1;b=e}e=this.h.sa(this.h.fe(e))}return-1!=b?this.h.sa(b):-1};b.prototype.tG=function(a){for(var e=this.h.sa(this.h.Wb(a)),b=-1;e!=a;){if(this.Te(this.Ao(e))){if(-1!=b)return-1;b=e}e=this.h.sa(this.h.Wb(e))}return-1!=b?this.h.sa(b):-1};b.prototype.jF=function(b,e,f,c,d){var g=this.h.a,
m=b,n=this.h.sa(m);this.h.Bb(m,f,1);this.h.Bb(n,f,1);var k=this.fy(g,m);this.Ym=-1;for(var h=m,q=-1,l=!1,v=1;;){var t=this.h.fe(m);if(t==n)break;n=this.h.Wb(n);if(this.h.sa(t)!=n)if(m=this.sG(m),-1==m)break;else l=!0,n=this.h.sa(m);else m=t;if(m==b){q=b;break}t=this.Ao(m);if(!this.Te(t))break;this.h.Bb(m,f,1);this.h.Bb(n,f,1);h=m;k+=this.fy(g,m);v++}if(-1==q)for(m=b,n=this.h.sa(m),q=m;;){b=this.h.Wb(m);if(b==n)break;n=this.h.fe(n);if(this.h.sa(b)!=n)if(m=this.tG(m),-1==m){l=!0;break}else n=this.h.sa(m);
else m=b;t=this.Ao(m);if(!this.Te(t))break;this.h.Bb(m,f,1);this.h.Bb(n,f,1);q=m;k+=this.fy(g,m);v++}else if(-1!=this.Ym&&(h=this.Ym,q=this.h.fe(this.Ym),this.h.sa(q)!=this.h.Wb(this.h.sa(h))&&(q=this.sG(h),-1==q)))throw a.g.wa();0<=k||(m=q,q=this.h.sa(h),h=this.h.sa(m));f=g.Cf(e,-1);m=h;h=this.h.qj(h);l=this.h.jf(q)==h&&l;k=this.Au(h,g);k=this.tl(k,d);g.zi(f,k);-1!=c&&this.h.fm(h,c,1);h=0;for(v=l?a.I.truncate((v+1)/2):-1;;){b=this.h.jf(m);k=this.Au(b,g);k=this.tl(k,d);g.zi(f,k);h++;-1!=c&&this.h.fm(b,
c,1);l&&h==v&&(f=g.Cf(e,-1),g.zi(f,k));if(m==q)break;b=this.h.Wb(m);if(this.h.fe(this.h.sa(m))!=this.h.sa(b)){if(m=this.tG(m),-1==m)throw a.g.wa();}else m=b}};b.prototype.Yp=function(a){for(var e=this.h.a.jg(1607),b=this.h.Eg(),c=this.h.Be;-1!=c;c=this.h.Bf(c)){var g=this.h.te(c),d=g;do 1!=this.h.tb(d,b)&&this.Te(this.Ao(d))&&this.jF(d,e,b,-1,a),d=this.h.Wb(this.h.sa(d));while(d!=g)}this.h.kh(b);return e};b.prototype.SS=function(a){for(var e=this.h.a,b=e.jg(1607),c=e.jg(550),g=this.h.Eg(),d=this.h.uo(),
m=-1,k=this.h.Be;-1!=k;k=this.h.Bf(k)){var h=this.h.te(k),q=h;do{var l=this.h.tb(q,g);1!=l&&(l=this.Ao(q),this.Te(l)&&this.jF(q,b,g,d,a));q=this.h.Wb(this.h.sa(q))}while(q!=h)}for(k=this.h.Be;-1!=k;k=this.h.Bf(k))l=this.h.Sf(k,d),1!=l&&(l=this.h.md(k),this.Te(l)&&(-1==m&&(m=e.Cf(c,-1)),h=this.h.ol(k),-1!=h&&(h=this.h.Gi(h),h=this.tl(h,a),e.zi(m,h))));this.h.kh(g);this.h.vo(d);a=[];a[0]=c;a[1]=b;return a};b.prototype.Pn=function(){for(var a=this.h.a,e=a.jg(550),b=a.Cf(e,-1),c=this.h.Be;-1!=c;c=this.h.Bf(c))if(this.Te(this.h.md(c))){for(var d=
-1,m=this.h.ol(c);-1!=m;m=this.h.zq(m)){var k=this.h.Gi(m);-1==d&&(d=k);var h=this.h.ya(a.Vf(a.rd(k)));if(this.Te(h)){d=k;break}}a.zi(b,d)}return e};b.prototype.Im=function(a){this.Qg=[];for(var e=0;e<a;e++)this.Qg[e]=!1};b.qF=function(b,e,f,c){var g=b.Pa(),d=Array(1E3);a.I.Ps(d,null);var m=a.I.Lh(1E3,0),n=b.F(),k=!0,h=2==e.fb();if(1!=e.fb()&&2!=e.fb())throw a.g.wa();for(var q=0;q<n;){var l=a.I.truncate(b.fR(d,q)-q);h?a.gd.nG(e,d,l,f,m):a.gd.oG(e,d,l,f,m);for(var v=0,t=0;t<l;t++){var y=0==m[t];c||
(y=!y);y&&(k&&(k=!1,g.Pd(b,0,q)),v!=t&&g.Pd(b,q+v,q+t),v=t+1)}k||v==l||g.Pd(b,q+v,q+l);q+=l}return k?b:g};b.jD=function(c,e,f){return c instanceof a.pe?b.qF(c,e,f,!0):e instanceof a.Va?c.s()||e.s()?c.Pa():a.aj.HE(f,c,e)?a.aj.gL(c,e):c.Pa():b.mG(c,e,f,!0)};b.mt=function(c,e,f,d){var g=new a.i;c.o(g);var m=new a.i;e.o(m);var n=new a.i;n.K(g);n.Db(m);f=a.Ia.zd(f,n,!0);n=new a.i;n.K(m);m=a.Ia.As(f);n.P(m,m);if(!g.jc(n)){if(c.fb()<=e.fb())return b.Cc(b.ob(c.Pa()),c,"\x26");if(c.fb()>e.fb())return b.Cc(b.ob(e.Pa()),
c,"\x26")}m=new b;g=new a.fd;n=g.Eb(b.ob(c));e=g.Eb(b.ob(e));m.Np(g,f,d);d=m.mt(n,e);c=b.Cc(g.hf(d),c,"\x26");a.T.Kc(c.D())&&(c.hg(2,f),1736==c.D()&&c.hl());return c};b.mG=function(b,e,f,c){if(b.s())return b.Pa();if(e.s())return c?b.Pa():null;var g=[null],d=[0],m=2==e.fb();if(1!=e.fb()&&2!=e.fb())throw a.g.wa();g[0]=b.w();m?a.gd.nG(e,g,1,f,d):a.gd.oG(e,g,1,f,d);e=0==d[0];c||(e=!e);return e?b.Pa():b};b.PT=function(c,e,f){return c instanceof a.pe?b.qF(c,e,f,!1):e instanceof a.Va?c.s()?c.Pa():e.s()?
c:a.aj.HE(f,c,e)?c.Pa():c:b.mG(c,e,f,!1)};b.prototype.ME=function(b,e,f,c,d){if(b.s())return b;var g=new a.fd;b=g.Eb(b);return this.Qj(g,b,e,f,c,d)};b.prototype.EQ=function(b,e,f,c,d,m){if(d&&550!=b.Lb(e)){var g=new a.aA;g.KS(b,f);g.og?(a.aj.$(b,f,m,!0),d=!1):this.h.Mv(f)}else a.aj.$(b,f,m,!0),d=!1;c&&550!=b.Lb(e)?this.h.uF(b,e):this.h.tF(b,e);if(this.h.tx)return this.h.xg(),this.h=null,this.Qj(b,e,f,c,!1,m);this.h.Mv(NaN);m=this.h.ya(e);this.Im(m+1);this.Qg[m]=!0;if(1736==b.Lb(e)||c&&550!=b.Lb(e))return b.Pp(e,
0),e=this.Xp(e,-1,-1),b=b.hf(e),b.Pp(0),d?b.hg(1,0):(b.hg(2,f),b.hl()),b;if(1607==b.Lb(e))return e=this.Yp(-1),b=b.hf(e),d||b.hg(2,f),b;if(550==b.Lb(e))return e=this.Pn(),b=b.hf(e),d||b.hg(2,f),b;throw a.g.wa();};b.prototype.Qj=function(b,e,f,c,d,m){this.h=new a.gs;try{return this.EQ(b,e,f,c,d,m)}finally{this.h.xg()}};b.Qj=function(a,e,f,c,d){return(new b).ME(a,e,f,c,d)};b.prototype.DQ=function(b,e,f){this.Gq=b;this.h=new a.gs;b=e.Cm(f);var c=e.Lb(f);1!=b||550==c?this.h.tF(e,f):this.h.uF(e,f);if(!this.h.tx)if(this.h.Mv(NaN),
c=this.h.ya(f),this.Im(c+1),this.Qg[c]=!0,1736==e.Lb(f)||1==b&&550!=e.Lb(f))e.Pp(f,0),b=this.Xp(f,-1,-1),e.Vy(b,f),e.sy(b);else if(1607==e.Lb(f))b=this.Yp(-1),e.Vy(b,f),e.sy(b);else if(550==e.Lb(f))b=this.Pn(),e.Vy(b,f),e.sy(b);else throw a.g.ra("internal error");};b.Ry=function(a,e,f,c){var g=new b;g.Gq=!0;return g.ME(a,e,!1,f,c)};b.prototype.ll=function(b,e){var f=a.T.ve(this.h.a.Lb(b)),c=a.T.ve(this.h.a.Lb(e));if(f>c)return b;var g=this.h.ya(b),d=this.h.ya(e);this.Im((g|d)+1);this.Qg[this.h.ya(b)]=
!0;if(2==f&&2==c)return this.Xp(b,e,-1);if(1==f&&2==c||1==f&&1==c)return this.Yp(-1);if(0==f)return this.Pn();throw a.g.wa();};b.prototype.TB=function(b,e){var f=a.T.ve(this.h.a.Lb(b)),c=a.T.ve(this.h.a.Lb(e));if(f>c)return b;if(f<c)return e;var g=this.h.ya(b),d=this.h.ya(e);this.Im((g|d)+1);this.Qg[this.h.ya(b)]=!0;this.Qg[this.h.ya(e)]=!0;this.Qg[this.h.ya(b)|this.h.ya(e)]=!0;if(2==f&&2==c)return this.Xp(b,e,-1);if(1==f&&1==c)return this.Yp(-1);if(0==f&&0==c)return this.Pn();throw a.g.wa();};b.prototype.mt=
function(b,e){var f=a.T.ve(this.h.a.Lb(b)),c=a.T.ve(this.h.a.Lb(e)),g=this.h.ya(b),d=this.h.ya(e);this.Im((g|d)+1);this.Qg[this.h.ya(b)|this.h.ya(e)]=!0;g=-1;1<this.h.a.wp.Aa&&(g=b);if(2==f&&2==c)return this.Xp(b,e,g);if(1==f&&0<c||1==c&&0<f)return this.Yp(g);if(0==f||0==c)return this.Pn();throw a.g.wa();};b.prototype.Uw=function(b,e){var f=a.T.ve(this.h.a.Lb(b)),c=a.T.ve(this.h.a.Lb(e)),g=this.h.ya(b),d=this.h.ya(e);this.Im((g|d)+1);this.Qg[this.h.ya(b)|this.h.ya(e)]=!0;g=-1;1<this.h.a.wp.Aa&&(g=
b);if(2==f&&2==c)return this.RS(b,e,g);if(1==f&&0<c||1==c&&0<f)return this.SS(g);if(0==f||0==c)return f=[],f[0]=this.Pn(),f;throw a.g.wa();};b.prototype.On=function(b,e){var f=a.T.ve(this.h.a.Lb(b)),c=a.T.ve(this.h.a.Lb(e)),g=this.h.ya(b),d=this.h.ya(e);this.Im((g|d)+1);this.Qg[this.h.ya(b)]=!0;this.Qg[this.h.ya(e)]=!0;if(2==f&&2==c)return this.Xp(b,e,-1);if(1==f&&1==c)return this.Yp(-1);if(0==f&&0==c)return this.Pn();throw a.g.wa();};b.ob=function(b){var e=b.D();return 197==e?(e=new a.Ka(b.description),
b.s()||e.Wc(b,!1),e):33==e?(e=new a.pe(b.description),b.s()||e.add(b),e):322==e?(e=new a.Xa(b.description),b.s()||e.Bc(b,!0),e):b};b.Cc=function(b,e,f){var c=b.D();return 197==c?(e=new a.Ka(b.description),b.s()||e.Wc(b,!1),e):33!=c||"|"!=f&&"^"!=f?322==c?(e=new a.Xa(b.description),b.s()||e.Bc(b,!0),e):33==c&&"-"==f&&33==e.D()||550==c&&"\x26"==f&&33==e.D()?(e=new a.Va(b.description),b.s()||b.Sd(0,e),e):b:(e=new a.pe(b.description),b.s()||e.add(b),e)};b.ll=function(c,e,f,d){if(c.s()||e.s()||c.fb()>
e.fb())return b.Cc(b.ob(c),c,"-");var g=new a.i;c.o(g);var m=new a.i;e.o(m);if(!g.jc(m))return b.Cc(b.ob(c),c,"-");var n=new a.i;n.K(g);n.Db(m);f=a.Ia.zd(f,n,!0);m=new b;g=new a.fd;n=g.Eb(b.ob(c));e=g.Eb(b.ob(e));m.Np(g,f,d);d=m.ll(n,e);d=g.hf(d);c=b.Cc(d,c,"-");a.T.Kc(c.D())&&(c.hg(2,f),1736==c.D()&&c.hl());return c};b.TB=function(c,e,f,d){if(c.fb()>e.fb())return b.Cc(b.ob(c),c,"|");if(c.fb()<e.fb()||c.s())return b.Cc(b.ob(e),c,"|");if(e.s())return b.Cc(b.ob(c),c,"|");var g=new a.i;c.o(g);var m=
new a.i;e.o(m);var n=new a.i;n.K(g);n.Db(m);f=a.Ia.zd(f,n,!0);if(!g.jc(m.IN(f,f)))switch(c=b.ob(c),e=b.ob(e),c.D()){case 550:return c=a.T.Yj(c),c.Pd(e,0,-1),c;case 1607:return c=a.T.Yj(c),c.add(e,!1),c;case 1736:return c=a.T.Yj(c),c.add(e,!1),c;default:throw a.g.wa();}m=new b;g=new a.fd;n=g.Eb(b.ob(c));e=g.Eb(b.ob(e));m.Np(g,f,d);e=m.TB(n,e);c=b.Cc(g.hf(e),c,"|");a.T.Kc(c.D())&&(c.hg(2,f),1736==c.D()&&c.hl());return c};b.oM=function(c,e,f){if(2>c.length)throw a.g.N("not enough geometries to dissolve");
for(var g=0,d=0,m=c.length;d<m;d++)g=Math.max(c[d].fb(),g);var k=new a.i;k.Ja();for(var h=new a.fd,q=-1,l=0,v=-1,d=0,m=c.length;d<m;d++)if(c[d].fb()==g)if(c[d].s())-1==v&&(v=d);else{v=d;-1==q?q=h.Eb(b.ob(c[d])):h.YJ(q,b.ob(c[d]));var t=new a.i;c[d].dd(t);k.Db(t);l++}if(2>l)return b.ob(c[v]);c=2==g;e=a.Ia.zd(0==g?e:null,k,!0);return(new b).Qj(h,q,e,c,!0,f)};b.Uw=function(c,e,f,d){var g=[null,null,null],m=new a.i;c.o(m);var n=new a.i;e.o(n);var k=new a.i;k.K(m);k.Db(n);f=a.Ia.zd(f,k,!0);k=new a.i;k.K(n);
n=a.Ia.As(f);k.P(n,n);if(!m.jc(k)){if(c.fb()<=e.fb())return c=b.Cc(b.ob(c.Pa()),c,"\x26"),g[c.fb()]=c,g;if(c.fb()>e.fb())return c=b.Cc(b.ob(e.Pa()),c,"\x26"),g[c.fb()]=c,g}n=new b;m=new a.fd;k=m.Eb(b.ob(c));e=m.Eb(b.ob(e));n.Np(m,f,d);d=n.Uw(k,e);for(e=0;e<d.length;e++)n=b.Cc(m.hf(d[e]),c,"\x26"),a.T.Kc(n.D())&&(n.hg(2,f),1736==n.D()&&n.hl()),g[n.fb()]=n;return g};b.On=function(c,e,f,d){if(c.fb()>e.fb())return b.Cc(b.ob(c),c,"^");if(c.fb()<e.fb()||c.s())return b.Cc(b.ob(e),c,"^");if(e.s())return b.Cc(b.ob(c),
c,"^");var g=new a.i;c.o(g);var m=new a.i;e.o(m);var n=new a.i;n.K(g);n.Db(m);f=a.Ia.zd(f,n,!0);m=new b;g=new a.fd;n=g.Eb(b.ob(c));e=g.Eb(b.ob(e));m.Np(g,f,d);d=m.On(n,e);c=b.Cc(g.hf(d),c,"^");a.T.Kc(c.D())&&(c.hg(2,f),1736==c.D()&&c.hl());return c};b.uT=function(b,e,f){e=e.D();f=f.D();return 550==b.D()&&(33==e||33==f)&&1>=b.F()?(f=new a.Va(b.description),b.s()||b.Sd(0,f),f):b};b.prototype.ZM=function(a,e){var b=this.h.a;a=b.Cf(a,-1);for(var c=e.size,g=0;g<c;g++){var d=e.get(g);b.zi(a,d)}b.Gn(a,!0)};
b.prototype.WR=function(a,e){for(var b=this.h.a,c=b.$c;-1!=c;c=b.we(c))if(c==e)for(var g=b.Vb(c);-1!=g;g=b.bc(g)){var d=b.Cb(g);if(-1!=d)for(var m=b.X(d);-1!=m;){var d=this.h.se(d),k=this.h.se(m),d=this.h.FN(d,k);-1!=d&&(k=this.h.sa(d),this.h.Bb(d,a,1),this.h.Bb(k,a,2));d=m;m=b.X(d)}}};b.prototype.XQ=function(b,e,f,c){f=this.h.ya(f);c=this.h.ya(c);var g=new a.ga(0);g.xb(256);for(var d=this.h.a,m=this.h.Eg(),n=this.h.Be;-1!=n;n=this.h.Bf(n)){var k=this.h.te(n);if(-1!=k){var h=k;do{if(1!=this.h.tb(h,
m)){var q=h,l=h,v=!1,t=0;do{this.h.Bb(q,m,1);if(!v){var y=this.h.Gg(q);0!=(y&c)&&0!=(this.h.Qe(q)&f)&&(l=q,v=!0)}v&&(g.add(this.h.Gi(this.h.ol(this.h.qj(q)))),-1!=b&&(y=this.h.Gg(q),0!=(y&c)&&(y=this.h.tb(q,b),t|=y)));q=this.h.Wb(q)}while(q!=l);v&&0<this.h.yo(this.h.Pe(l))&&(q=d.jg(1736),this.ZM(q,g),-1!=e&&d.EF(q,e,t));g.clear(!1)}h=this.h.Wb(this.h.sa(h))}while(h!=k)}}this.h.kh(m)};b.prototype.WL=function(a,e,b,c){this.h.uR();var f=-1;-1!=a&&(f=this.h.Eg(),this.WR(f,b));this.XQ(f,a,e,b);var g=this.h.a;
a=0;for(f=g.$c;-1!=f;f=g.we(f))f!=e&&f!=b&&(c.add(f),a++);c.xd(0,a,function(a,e){a=g.Gw(g.Vb(a));e=g.Gw(g.Vb(e));return a<e?-1:a==e?0:1})};b.prototype.xg=function(){null!=this.h&&(this.h.xg(),this.h=null)};return b}();a.Of=b})(E||(E={}));(function(a){var b=function(){function b(a){void 0!==a?this.Ly(a):this.IF()}b.prototype.Lu=function(){this.Ob=this.Nb=this.sb=this.rb=this.eb=this.mb=0};b.prototype.lc=function(a){return this==a?!0:a instanceof b?this.mb==a.mb&&this.rb==a.rb&&this.Nb==a.Nb&&this.sb==
a.sb&&this.eb==a.eb&&this.Ob==a.Ob:!1};b.prototype.hc=function(){a.I.Rh();a.I.Rh();a.I.Rh();a.I.Rh();a.I.Rh();return a.I.Rh()};b.prototype.Zi=function(a,e){var b=this.sb*a.x+this.eb*a.y+this.Ob;e.x=this.mb*a.x+this.rb*a.y+this.Nb;e.y=b};b.prototype.multiply=function(a){b.multiply(this,a,this)};b.multiply=function(a,e,b){var f,c,g,d,m;f=a.mb*e.mb+a.sb*e.rb;c=a.rb*e.mb+a.eb*e.rb;g=a.Nb*e.mb+a.Ob*e.rb+e.Nb;d=a.mb*e.sb+a.sb*e.eb;m=a.rb*e.sb+a.eb*e.eb;a=a.Nb*e.sb+a.Ob*e.eb+e.Ob;b.mb=f;b.rb=c;b.Nb=g;b.sb=
d;b.eb=m;b.Ob=a};b.prototype.vm=function(){var a=new b;a.mb=this.mb;a.rb=this.rb;a.Nb=this.Nb;a.sb=this.sb;a.eb=this.eb;a.Ob=this.Ob;return a};b.prototype.$y=function(b){if(!b.s()){for(var e=[],f=0;4>f;f++)e[f]=new a.b;b.hy(e);this.US(e,e);b.Ey(e,4)}};b.prototype.US=function(b,e){for(var f=0;f<b.length;f++){var c=new a.b,g=b[f];c.x=this.mb*g.x+this.rb*g.y+this.Nb;c.y=this.sb*g.x+this.eb*g.y+this.Ob;e[f]=c}};b.prototype.wO=function(a,e){a.s()||e.s()||0==a.aa()||0==a.ba()?this.Lu():(this.rb=this.sb=
0,this.mb=e.aa()/a.aa(),this.eb=e.ba()/a.ba(),this.Nb=e.v-a.v*this.mb,this.Ob=e.C-a.C*this.eb)};b.prototype.TS=function(b){var e=new a.b,f=new a.b;e.ma(this.mb,this.sb);f.ma(this.rb,this.eb);e.sub(e);var c=.5*e.Up();e.ma(this.mb,this.sb);f.ma(this.rb,this.eb);e.add(f);e=.5*e.Up();return b*(c>e?Math.sqrt(c):Math.sqrt(e))};b.prototype.IF=function(){this.mb=1;this.sb=this.Nb=this.rb=0;this.eb=1;this.Ob=0};b.prototype.XO=function(){return 1==this.mb&&1==this.eb&&0==this.rb&&0==this.Nb&&0==this.sb&&0==
this.Ob};b.prototype.mg=function(a){return Math.abs(this.mb*this.eb-this.sb*this.rb)<=2*a*(Math.abs(this.mb*this.eb)+Math.abs(this.sb*this.rb))};b.prototype.Nn=function(a,e){this.mb=1;this.rb=0;this.Nb=a;this.sb=0;this.eb=1;this.Ob=e};b.prototype.Ly=function(a,e){void 0!==e?(this.mb=a,this.sb=this.Nb=this.rb=0,this.eb=e,this.Ob=0):this.Ly(a,a)};b.prototype.Oy=function(){this.mb=0;this.rb=1;this.Nb=0;this.sb=1;this.Ob=this.eb=0};b.prototype.jS=function(a){this.kS(Math.cos(a),Math.sin(a))};b.prototype.kS=
function(a,e){this.mb=a;this.rb=-e;this.Nb=0;this.sb=e;this.eb=a;this.Ob=0};b.prototype.shift=function(a,e){this.Nb+=a;this.Ob+=e};b.prototype.scale=function(a,e){this.mb*=a;this.rb*=a;this.Nb*=a;this.sb*=e;this.eb*=e;this.Ob*=e};b.prototype.rotate=function(a){var e=new b;e.jS(a);this.multiply(e)};b.prototype.inverse=function(a){if(void 0!==a){var e=this.mb*this.eb-this.rb*this.sb;0==e?a.Lu():(e=1/e,a.Nb=(this.rb*this.Ob-this.Nb*this.eb)*e,a.Ob=(this.Nb*this.sb-this.mb*this.Ob)*e,a.mb=this.eb*e,a.rb=
-this.rb*e,a.sb=-this.sb*e,a.eb=this.mb*e)}else this.inverse(this)};return b}();a.Bg=b})(E||(E={}));(function(a){var b=function(){function b(){}b.prototype.Lu=function(){this.fh=this.Ob=this.Nb=this.Le=this.Ie=this.He=this.Ke=this.eb=this.rb=this.ef=this.sb=this.mb=0};b.prototype.Ly=function(a,e,b){this.mb=a;this.rb=this.ef=this.sb=0;this.eb=e;this.Ie=this.He=this.Ke=0;this.Le=b;this.fh=this.Ob=this.Nb=0};b.prototype.$y=function(b){if(b.s())return b;for(var e=new a.ee[8],f=0;8>f;f++)e[f]=new a.ee;
b.hy(e);this.transform(e,8,e);b.Ey(e);return b};b.prototype.transform=function(b,e,f){for(var c=0;c<e;c++){var g=new a.ee,d=b[c];g.x=this.mb*d.x+this.rb*d.y+this.He*d.z+this.Nb;g.y=this.sb*d.x+this.eb*d.y+this.Ie*d.z+this.Ob;g.z=this.ef*d.x+this.Ke*d.y+this.Le*d.z+this.fh;f[c]=g}};b.prototype.Qn=function(b){var e=new a.ee;e.x=this.mb*b.x+this.rb*b.y+this.He*b.z+this.Nb;e.y=this.sb*b.x+this.eb*b.y+this.Ie*b.z+this.Ob;e.z=this.ef*b.x+this.Ke*b.y+this.Le*b.z+this.fh;return e};b.prototype.Ap=function(a){b.multiply(this,
a,this)};b.multiply=function(a,e,b){var f,c,g,d,m,k,h,q,l,v,t;f=a.mb*e.mb+a.sb*e.rb+a.ef*e.He;c=a.mb*e.sb+a.sb*e.eb+a.ef*e.Ie;g=a.mb*e.ef+a.sb*e.Ke+a.ef*e.Le;d=a.rb*e.mb+a.eb*e.rb+a.Ke*e.He;m=a.rb*e.sb+a.eb*e.eb+a.Ke*e.Ie;k=a.rb*e.ef+a.eb*e.Ke+a.Ke*e.Le;h=a.He*e.mb+a.Ie*e.rb+a.Le*e.He;q=a.He*e.sb+a.Ie*e.eb+a.Le*e.Ie;l=a.He*e.ef+a.Ie*e.Ke+a.Le*e.Le;v=a.Nb*e.mb+a.Ob*e.rb+a.fh*e.He+e.Nb;t=a.Nb*e.sb+a.Ob*e.eb+a.fh*e.Ie+e.Ob;a=a.Nb*e.ef+a.Ob*e.Ke+a.fh*e.Le+e.fh;b.mb=f;b.sb=c;b.ef=g;b.rb=d;b.eb=m;b.Ke=
k;b.He=h;b.Ie=q;b.Le=l;b.Nb=v;b.Ob=t;b.fh=a};b.inverse=function(b,e){var f=b.mb*(b.eb*b.Le-b.Ke*b.Ie)-b.sb*(b.rb*b.Le-b.Ke*b.He)+b.ef*(b.rb*b.Ie-b.eb*b.He);if(0!=f){var c,g,d,m,k,h,q,l,v,t;l=1/f;f=(b.eb*b.Le-b.Ke*b.Ie)*l;d=-(b.rb*b.Le-b.Ke*b.He)*l;h=(b.rb*b.Ie-b.eb*b.He)*l;c=-(b.sb*b.Le-b.Ie*b.ef)*l;m=(b.mb*b.Le-b.ef*b.He)*l;q=-(b.mb*b.Ie-b.sb*b.He)*l;g=(b.sb*b.Ke-b.ef*b.eb)*l;k=-(b.mb*b.Ke-b.ef*b.rb)*l;l*=b.mb*b.eb-b.sb*b.rb;v=-(b.Nb*f+b.Ob*d+b.fh*h);t=-(b.Nb*c+b.Ob*m+b.fh*q);b=-(b.Nb*g+b.Ob*k+b.fh*
l);e.mb=f;e.sb=c;e.ef=g;e.rb=d;e.eb=m;e.Ke=k;e.He=h;e.Ie=q;e.Le=l;e.Nb=v;e.Ob=t;e.fh=b}else throw a.g.ra("math singularity");};b.prototype.vm=function(){var a=new b;a.mb=this.mb;a.sb=this.sb;a.ef=this.ef;a.rb=this.rb;a.eb=this.eb;a.Ke=this.Ke;a.He=this.He;a.Ie=this.Ie;a.Le=this.Le;a.Nb=this.Nb;a.Ob=this.Ob;a.fh=this.fh;return a};return b}();a.ZT=b})(E||(E={}));(function(a){var b=function(b){function e(a){if(void 0!==a)b.call(this,a.hc(),a);else{b.call(this);this.Jf=[];this.Jf[0]=0;this.Aa=1;this.Wg=
[];for(a=0;10>a;a++)this.Wg[a]=-1;this.Wg[this.Jf[0]]=0}this.To=!0}m(e,b);e.prototype.Ne=function(a){this.hasAttribute(a)||(this.Wg[a]=0,this.xA())};e.prototype.removeAttribute=function(e){if(0==e)throw a.g.N("Position attribue cannot be removed");this.hasAttribute(e)&&(this.Wg[e]=-1,this.xA())};e.prototype.reset=function(){this.Jf[0]=0;this.Aa=1;for(var a=0;a<this.Wg.length;a++)this.Wg[a]=-1;this.Wg[this.Jf[0]]=0;this.To=!0};e.prototype.qw=function(){return c.ww().add(this)};e.Tf=function(){return c.ww().iO()};
e.Zn=function(){return c.ww().jO()};e.prototype.pJ=function(){var e=this.hc();return new a.pa(e,this)};e.prototype.xA=function(){for(var a=this.Aa=0,e=0;10>a;a++)0<=this.Wg[a]&&(this.Jf[e]=a,this.Wg[a]=e,e++,this.Aa++);this.To=!0};e.prototype.hc=function(){this.To&&(this.tk=this.jj(),this.To=!1);return this.tk};e.prototype.lc=function(a){if(null==a)return!1;if(a==this)return!0;if(!(a instanceof e)||a.Aa!=this.Aa)return!1;for(var b=0;b<this.Aa;b++)if(this.Jf[b]!=a.Jf[b])return!1;return this.To!=a.To?
!1:!0};e.prototype.qD=function(a){if(a.Aa!=this.Aa)return!1;for(var e=0;e<this.Aa;e++)if(this.Jf[e]!=a.Jf[e])return!1;return!0};e.iu=function(a,e){for(var b=[],f=0;f<a.Aa;f++)b[f]=-1;for(var f=0,c=a.Aa;f<c;f++)b[f]=e.zf(a.Hd(f));return b};e.PN=function(a,b){a=new e(a);a.Ne(b);return a.qw()};e.QN=function(a,b){for(var f=null,c=0;10>c;c++)!a.hasAttribute(c)&&b.hasAttribute(c)&&(null==f&&(f=new e(a)),f.Ne(c));return null!=f?f.qw():a};e.bo=function(a,b){a=new e(a);a.removeAttribute(b);return a.qw()};
return e}(a.pa);a.Od=b;var c=function(){function a(){this.map=[];var a=new b;this.add(a);a=new b;a.Ne(1);this.add(a)}a.ww=function(){return a.lI};a.prototype.iO=function(){return a.Yn};a.prototype.jO=function(){return a.Zn};a.prototype.add=function(e){var b=e.hc();if(null!=a.Yn&&a.Yn.hc()==b&&e.qD(a.Yn))return a.Yn;if(null!=a.Zn&&a.Zn.hc()==b&&e.qD(a.Zn))return a.Zn;var c=null;void 0!==this.map[b]&&(c=this.map[b]);null==c&&(c=e.pJ(),1==c.Aa?a.Yn=c:2==c.Aa&&1==c.Hd(1)?a.Zn=c:this.map[b]=c);return c};
a.lI=new a;return a}()})(E||(E={}));var N=0==w.version.indexOf("4."),W;(function(a){a[a.Linear=0]="Linear";a[a.Angular=1]="Angular";a[a.Area=2]="Area";a[a.LinearOrAngular=3]="LinearOrAngular"})(W||(W={}));var R={feet:9002,kilometers:9036,meters:9001,miles:9035,"nautical-miles":9030,yards:9096},V={acres:109402,ares:109463,hectares:109401,"square-feet":109405,"square-kilometers":109414,"square-meters":109404,"square-miles":109413,"square-yards":109442},Q={degrees:9102,radians:9101};void 0===l.prototype.getCacheValue&&
k.extend(l,{cache:null,getCacheValue:function(a){if(null===this.cache||void 0===this.cache)this.cache={};return this.cache[a]},setCacheValue:function(a,b){if(null===this.cache||void 0===this.cache)this.cache={};this.cache[a]=b}});var S=E.Nf.create(4326),X=E.Nf.create(102100);return function(){function a(){}a.extendedSpatialReferenceInfo=function(a){if(null===a)return null;a=B(a);var b=a.Se();return{tolerance:a.xq(),unitType:null==b?-1:b.Nc,unitID:null==b?-1:b.Qc(),unitBaseFactor:null==b?0:b.Dj,unitSquareDerivative:null==
b?0:E.Tb.PC(b).Qc()}};a.clip=function(a,c){if(null===a)return null;c=E.Pb.clip(D(a),D(c),b(a));return v(c,a.spatialReference)};a.cut=function(a,c){c=D(c);c=E.Pb.xm(D(a),c,b(a));for(var g=[],e=0;e<c.length;e++)g.push(v(c[e],a.spatialReference));return g};a.contains=function(a,c){if(null===a||null===c)throw Error("Illegal Argument Exception");return E.Pb.contains(D(a),D(c),b(a))};a.crosses=function(a,c){if(null===a||null===c)throw Error("Illegal Argument Exception");return E.Pb.VL(D(a),D(c),b(a))};
a.distance=function(a,c,g){if(null===a||null===c)throw Error("Illegal Argument Exception");return E.Pb.Fb(D(a),D(c),b(a),E.Tb.Qd(C(g,3)))};a.equals=function(a,c){return null===a&&null!==c||null===c&&null!==a?!1:E.Pb.lc(D(a),D(c),b(a))};a.intersects=function(a,c){if(null===a||null===c)throw Error("Illegal Argument Exception");return E.Pb.RO(D(a),D(c),b(a))};a.touches=function(a,c){if(null===a||null===c)throw Error("Illegal Argument Exception");return E.Pb.touches(D(a),D(c),b(a))};a.within=function(a,
c){if(null===a||null===c)throw Error("Illegal Argument Exception");return E.Pb.jT(D(a),D(c),b(a))};a.disjoint=function(a,c){if(null===a||null===c)throw Error("Illegal Argument Exception");return E.Pb.nM(D(a),D(c),b(a))};a.overlaps=function(a,c){if(null===a||null===c)throw Error("Illegal Argument Exception");return E.Pb.tQ(D(a),D(c),b(a))};a.relate=function(a,c,g){if(null===a||null===c)throw Error("Illegal Argument Exception");return E.Pb.py(D(a),D(c),b(a),g)};a.isSimple=function(a){if(null===a)throw Error("Illegal Argument Exception");
return E.Pb.cP(D(a),b(a))};a.simplify=function(a){if(null===a)throw Error("Illegal Argument Exception");var c=E.Pb.Qy(D(a),b(a));return v(c,a.spatialReference)};a.convexHull=function(c,d){void 0===d&&(d=!1);if(null===c)throw Error("Illegal Argument Exception");return c instanceof l?(d=E.Pb.JL(D(c),b(c)),v(d,c.spatialReference)):a.NI(c,d)};a.NI=function(a,b){for(var c=[],e=0;e<a.length;e++)c.push(D(a[e]));c=E.Pb.KL(c,b);for(e=0;e<c.length;e++)c[e]=v(c[e],a[0].spatialReference);return c};a.difference=
function(c,d){if(null===c||null===d)throw Error("Illegal Argument Exception");return c instanceof l?(d=E.Pb.ll(D(c),D(d),b(c)),v(d,c.spatialReference)):a.XL(c,d)};a.XL=function(a,c){for(var g=[],e=0;e<a.length;e++)g.push(D(a[e]));g=E.Pb.kM(g,D(c),b(c));for(e=0;e<g.length;e++)g[e]=v(g[e],c.spatialReference);return g};a.symmetricDifference=function(c,d){if(null===c||null===d)throw Error("Illegal Argument Exception");return c instanceof l?(d=E.Pb.On(D(c),D(d),b(c)),v(d,c.spatialReference)):a.tO(c,d)};
a.tO=function(a,c){for(var g=[],e=0;e<a.length;e++)g.push(D(a[e]));g=E.Pb.MS(g,D(c),b(c));for(e=0;e<g.length;e++)g[e]=v(g[e],c.spatialReference);return g};a.intersect=function(c,d){if(null===c||null===d)throw Error("Illegal Argument Exception");return c instanceof l?(d=E.Pb.Ga(D(c),D(d),b(c)),v(d,c.spatialReference)):a.EM(c,d)};a.EM=function(a,c){for(var g=[],e=0;e<a.length;e++)g.push(D(a[e]));g=E.Pb.QO(g,D(c),b(c));for(e=0;e<g.length;e++)g[e]=v(g[e],c.spatialReference);return g};a.union=function(a,
c){void 0===c&&(c=null);if(null===a)return null;a instanceof l&&(a=[a],null!==c&&a.push(c));if(0===a.length)return null;c=[];for(var g=0;g<a.length;g++)c.push(D(a[g]));return v(E.Pb.aT(c,b(a[0])),a[0].spatialReference)};a.offset=function(c,d,g,e,f,m){var n=0;if(null!=e&&void 0!=e)switch(e){case "round":n=0;break;case "bevel":n=1;break;case "miter":n=2;break;case "square":n=3}return c instanceof l?(d=E.Pb.offset(D(c),b(c),d,n,f,m,E.Tb.Qd(C(g,3))),v(d,c.spatialReference)):a.qO(c,d,g,n,f,m)};a.qO=function(a,
c,g,e,f,d){if(null===a)return null;if(0===a.length)return[];for(var m=[],n=0;n<a.length;n++)m.push(D(a[n]));c=E.Pb.sQ(m,b(a[0]),c,e,f,d,E.Tb.Qd(C(g,3)));for(n=0;n<c.length;n++)c[n]=v(c[n],a[0].spatialReference);return c};a.buffer=function(c,d,g,e){void 0===e&&(e=!1);if(c instanceof l)return d=E.Pb.buffer(D(c),b(c),d,E.Tb.Qd(C(g,3)),!1,0,NaN),v(d,c.spatialReference);if("[object Array]"!==Object.prototype.toString.call(d)){for(var f=[],m=0;m<c.length;m++)f.push(d);d=f}if(d.length!=c.length){if(0==d.length)throw Error("Illegal Argument Exception");
for(var f=[],k=0,m=0;m<c.length;m++)void 0===d[m]?f.push(k):(f.push(d[m]),k=d[m]);d=f}return a.vG(c,d,g,!1,e,"geodesic",NaN)};a.geodesicBuffer=function(c,d,g,e,f,m){if(c instanceof l)return void 0===f&&(f=NaN),d=E.Pb.buffer(D(c),b(c),d,E.Tb.Qd(C(g,0)),!0,q(e),f),v(d,c.spatialReference);if("[object Array]"!==Object.prototype.toString.call(d)){for(var n=[],k=0;k<c.length;k++)n.push(d);d=n}if(d.length!=c.length){if(0==d.length)throw Error("Illegal Argument Exception");for(var n=[],h=0,k=0;k<c.length;k++)void 0===
d[k]?n.push(h):(n.push(d[k]),h=d[k]);d=n}return a.vG(c,d,g,!0,e,f,m)};a.vG=function(a,c,g,e,f,d,m){if(null===a)return null;if(0===a.length)return[];void 0===m&&(m=NaN);for(var n=[],k=0;k<a.length;k++)n.push(D(a[k]));c=E.Pb.rK(n,b(a[0]),c,E.Tb.Qd(C(g,0)),e,f,q(d),m);for(k=0;k<c.length;k++)c[k]=v(c[k],a[0].spatialReference);return c};a.nearestCoordinate=function(a,b,c){void 0===c&&(c=!0);b=E.Pb.zw(D(a),D(b),c);return{coordinate:v(b.pw(),a.spatialReference),distance:b.sw(),isRightSide:b.Xw(),vertexIndex:b.gb(),
isEmpty:b.s()}};a.nearestVertex=function(a,b){b=E.Pb.Aw(D(a),D(b));return{coordinate:v(b.pw(),a.spatialReference),distance:b.sw(),isRightSide:b.Xw(),vertexIndex:b.gb(),isEmpty:b.s()}};a.nearestVertices=function(a,b,c,e){b=D(b);c=E.Pb.Bw(D(a),b,c,e);e=[];for(b=0;b<c.length;b++)!1===c[b].s()&&e.push({coordinate:v(c[b].pw(),a.spatialReference),distance:c[b].sw(),isRightSide:c[b].Xw(),vertexIndex:c[b].gb(),isEmpty:c[b].s()});return e};a.generalize=function(a,c,g,e){c=E.Pb.fN(D(a),b(a),c,g,E.Tb.Qd(C(e,
3)));return v(c,a.spatialReference)};a.densify=function(a,c,g){c=E.Pb.oq(D(a),b(a),c,E.Tb.Qd(C(g,3)));return v(c,a.spatialReference)};a.geodesicDensify=function(a,c,g,e){void 0===e&&(e=0);c=E.Pb.fw(D(a),b(a),c,E.Tb.Qd(C(g,3)),e);return v(c,a.spatialReference)};a.rotate=function(a,b,g){if(void 0===g||null===g)switch(a.type){case "point":g=a;break;case "extent":g=N?a.get("center"):a.getCenter();break;default:g=N?a.get("extent").get("center"):a.getExtent().getCenter()}b=N?E.Wn.rotate(a.toJSON(),b,g.toJSON()):
E.Wn.rotate(a.toJson(),b,g.toJson());N?(b=t(b),b.set("spatialReference",a.spatialReference)):(b=c(b),b.setSpatialReference(a.spatialReference));return b};a.flipHorizontal=function(a,b){if(void 0===b||null===b)switch(a.type){case "point":b=a;break;case "extent":b=N?a.get("center"):a.getCenter();break;default:b=N?a.get("extent").get("center"):a.getExtent().getCenter()}b=N?E.Wn.eC(a.toJSON(),b.toJSON()):E.Wn.eC(a.toJson(),b.toJson());N?(b=t(b),b.set("spatialReference",a.spatialReference)):(b=c(b),b.setSpatialReference(a.spatialReference));
return b};a.flipVertical=function(a,b){if(void 0===b||null===b)switch(a.type){case "point":b=a;break;case "extent":b=N?a.get("center"):a.getCenter();break;default:b=N?a.get("extent").get("center"):a.getExtent().getCenter()}b=N?E.Wn.fC(a.toJSON(),b.toJSON()):E.Wn.fC(a.toJson(),b.toJson());N?(b=t(b),b.set("spatialReference",a.spatialReference)):(b=c(b),b.setSpatialReference(a.spatialReference));return b};a.planarArea=function(a,c){if(null===a)throw Error("Illegal Argument Exception");return E.Pb.BQ(D(a),
b(a),E.Tb.Qd(C(c,2)))};a.planarLength=function(a,c){if(null===a)throw Error("Illegal Argument Exception");return E.Pb.CQ(D(a),b(a),E.Tb.Qd(C(c,3)))};a.geodesicArea=function(a,c,g){if(null===a)throw Error("Illegal Argument Exception");return E.Pb.jN(D(a),b(a),E.Tb.Qd(C(c,2)),q(g))};a.geodesicLength=function(a,c,g){if(null===a)throw Error("Illegal Argument Exception");return E.Pb.nN(D(a),b(a),E.Tb.Qd(C(c,0)),q(g))};return a}()})},"esri/widgets/support/AnchorElementViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/watchUtils ../../core/Accessor ../../core/Evented ../../core/HandleRegistry ../../core/watchUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k){return function(c){function t(){var d=c.call(this)||this;return d._anchorHandles=new a,d.location=null,d.screenLocation=null,d.screenLocationEnabled=!1,d.view=null,d._anchorHandles.add([k.watch(d,"screenLocationEnabled,location,view.size",function(){return d._updateScreenPointAndHandle()}),k.watch(d,"view, view.ready",function(){return d._wireUpView()})]),d}return w(t,c),t.prototype.destroy=function(){this.view=null;this._anchorHandles&&this._anchorHandles.destroy();
this._viewpointHandle=this._anchorHandles=null},t.prototype._wireUpView=function(){var a=this;this._anchorHandles.remove("view");this._viewpointHandle=null;if(this.get("view.ready")){this._setScreenLocation();var c=this.view,c=d.pausable(c,"3d"===c.type?"camera":"viewpoint",function(){return a._viewpointChange()});this._anchorHandles.add(c,"view");this._viewpointHandle=c;this._toggleWatchingViewpoint()}},t.prototype._viewpointChange=function(){this._setScreenLocation();this.emit("view-change")},t.prototype._updateScreenPointAndHandle=
function(){this._setScreenLocation();this._toggleWatchingViewpoint()},t.prototype._toggleWatchingViewpoint=function(){var a=this._viewpointHandle,c=this.location,d=this.screenLocationEnabled;a&&(c&&d?a.resume():a.pause())},t.prototype._setScreenLocation=function(){var a=this.location,c=this.view,d=this.screenLocationEnabled,k=this.get("view.ready"),a=d&&a&&k?c.toScreen(a):null;this._set("screenLocation",a)},l([h.property()],t.prototype,"location",void 0),l([h.property({readOnly:!0})],t.prototype,
"screenLocation",void 0),l([h.property()],t.prototype,"screenLocationEnabled",void 0),l([h.property()],t.prototype,"view",void 0),t=l([h.subclass("esri.widgets.support.AnchorElementViewModel")],t)}(h.declared(u,r))})},"esri/widgets/Spinner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ./support/widget ../core/accessorSupport/decorators ./Widget ../core/promiseUtils ../core/watchUtils ./support/AnchorElementViewModel".split(" "),function(A,
p,w,l,h,d,u,r,a,k){return function(c){function t(a){a=c.call(this)||this;return a._animationDelay=500,a._animationPromise=null,a.location=null,a.view=null,a.visible=!1,a.viewModel=new k,a}return w(t,c),t.prototype.postInitialize=function(){var c=this;this.own([a.watch(this,"visible",function(a){return c._visibleChange(a)})])},t.prototype.destroy=function(){this._cancelAnimationPromise()},t.prototype.show=function(a){var c=this,d=a.location;a=a.promise;d&&(this.viewModel.location=d);this.visible=!0;
a&&a.always(function(){return c.hide()})},t.prototype.hide=function(){this.visible=!1},t.prototype.render=function(){var a=this.visible,c=!!this.viewModel.screenLocation,a=(d={},d["esri-spinner--start"]=a&&c,d["esri-spinner--finish"]=!a&&c,d),d=this._getPositionStyles();return h.tsx("div",{"class":"esri-spinner",classes:a,styles:d});var d},t.prototype._cancelAnimationPromise=function(){this._animationPromise&&(this._animationPromise.cancel(),this._animationPromise=null)},t.prototype._visibleChange=
function(a){var c=this;return a?void(this.viewModel.screenLocationEnabled=!0):(this._cancelAnimationPromise(),void(this._animationPromise=r.after(this._animationDelay).then(function(){c.viewModel.screenLocationEnabled=!1;c._animationPromise=null})))},t.prototype._getPositionStyles=function(){var a=this.viewModel.screenLocation;return a?{left:a.x+"px",top:a.y+"px"}:{}},l([d.aliasOf("viewModel.location")],t.prototype,"location",void 0),l([d.aliasOf("viewModel.view")],t.prototype,"view",void 0),l([d.property(),
h.renderable()],t.prototype,"visible",void 0),l([d.property({type:k}),h.renderable(["viewModel.screenLocation","viewModel.screenLocationEnabled"])],t.prototype,"viewModel",void 0),t=l([d.subclass("esri.widgets.Spinner")],t)}(d.declared(u))})},"esri/views/PopupManager":function(){define("require ../core/promiseUtils dojo/_base/array dojo/on dojo/Deferred dojo/promise/all ../layers/support/layerUtils ../geometry/support/scaleUtils ../geometry/Extent ../tasks/support/Query ../layers/GroupLayer ../core/Accessor".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t){var C;return t.createSubclass({declaredClass:"esri.views.PopupManager",properties:{map:{dependsOn:["view.map"],readOnly:!0}},constructor:function(){this._featureLayersCache={}},destroy:function(){this._featureLayersCache={};this.view=null},_clickHandle:null,_featureLayersCache:null,enabled:!1,_enabledSetter:function(a){this._clickHandle&&(a?this._clickHandle.resume():this._clickHandle.pause());this._set("enabled",a)},_mapGetter:function(){return this.get("view.map")||
null},view:null,_viewSetter:function(a){this._clickHandle&&(this._clickHandle.remove(),this._clickHandle=null);a&&(this._clickHandle=l.pausable(a,"click",this._clickHandler.bind(this)),this.enabled||this._clickHandle.pause());this._set("view",a)},getMapLayer:function(a){var c;if(a&&(c=a.findLayerById())&&(a=c.id,this._featureLayersCache[a])){var d=a.lastIndexOf("_");-1<d&&(a=a.substring(0,d),c=this.map.findLayerById(a))}return c},_closePopup:function(){var a=this.get("view.popup");a&&(a.clear(),a.close())},
_showPopup:function(d,l,t){function q(a){return m.allLayerViews.find(function(b){return b.layer===a})}function v(a){if(null==a)return!1;var b=q(a);return null==b?!1:a.loaded&&!b.suspended&&(a.popupEnabled&&a.popupTemplate||"graphics"===a.type||"geo-rss"===a.type||"map-notes"===a.type||"kml"===a.type||b.getPopupData)}function b(a){return(a=q(a))&&a.hasDraped}var m=this.view;d=m.popup;var y=this,u=[],C="3d"===m.type;w.forEach(this.map.layers.toArray(),function(a){a.isInstanceOf(c)?w.forEach(a.layers.toArray(),
function(a){!v(a)||C&&!b(a)||u.push(a)}):!v(a)||C&&!b(a)||u.push(a)});0<m.graphics.length&&u.push(m.graphics);if((t&&m.graphics.includes(t)?!t.popupTemplate:t&&!v(t.layer))&&(t=null),!u.length&&!t)return void y._closePopup();var K=[],M=!!t,U=y._calculateClickTolerance(u);if(!l)return void y._closePopup();var N=1;"2d"===m.type&&(N=m.state.resolution);var W=m.basemapTerrain;W&&W.overlayManager&&(N=W.overlayManager.overlayPixelSizeInMapUnits(l));U*=N;W&&!W.spatialReference.equals(m.spatialReference)&&
(U*=r.getMetersPerUnitForSR(W.spatialReference)/r.getMetersPerUnitForSR(m.spatialReference));var W=l.clone().offset(-U,-U),U=l.clone().offset(U,U),A=new a(Math.min(W.x,U.x),Math.min(W.y,U.y),Math.max(W.x,U.x),Math.max(W.y,U.y),m.spatialReference),W=function(a){var b;if("imagery"===a.type){b=new k;b.geometry=l;var c=q(a),d={rasterAttributeTableFieldPrefix:"Raster.",returnDomainValues:!0};d.layerView=c;b=a.queryVisibleRasters(b,d).then(function(a){return M=M||0<a.length,a})}else if("csv"===a.type||
"scene"===a.type||!y._featureLayersCache[a.id]&&"function"!=typeof a.queryFeatures){if("map-image"===a.type||"wms"===a.type)return c=q(a),c.getPopupData(A);var m,h=[];"esri.core.Collection\x3cesri.Graphic\x3e"===a.declaredClass?(d=a,m=!0):"graphics"===a.type?(d=a.graphics,m=!0):(c=q(a),d=c&&c.loadedGraphics,m=!1);d&&(h=d.filter(function(a){return a&&(!m||a.popupTemplate)&&a.visible&&A.intersects(a.geometry)}).toArray());0<h.length&&(M=!0,b="scene"===a.type?y._fetchSceneAttributes(a,h):p.resolve(h))}else c=
a.createQuery(),c.geometry=A,b=a.queryFeatures(c).then(function(b){b=b.features;if(t&&t.layer===a&&a.objectIdField){var e=a.objectIdField,f=t.attributes[e];b=b.filter(function(a){return a.attributes[e]!==f})}if(!t&&"function"==typeof q(a).getGraphics3DGraphics){var c=[],g=q(a).getGraphics3DGraphics(),d;for(d in g)c.push(g[d].graphic.attributes[a.objectIdField]);b=b.filter(function(e){return-1!==c.indexOf(e.attributes[a.objectIdField])})}return M=M||0<b.length,b});return b};if(C&&!t||!C)var K=u.map(W).filter(function(a){return!!a}),
V=function(a){return a.reduce(function(a,b){return a.concat(b.items?V(b.items):b)},[])},K=V(K);t&&(t.layer&&"scene"===t.layer.type?K.unshift(this._fetchSceneAttributes(t.layer,[t])):t.popupTemplate&&(W=new h,K.unshift(W.resolve([t]))));return w.some(K,function(a){return!a.isFulfilled()})||M?void(K.length&&d.open({promises:K,location:l})):void y._closePopup()},_fetchSceneAttributes:function(a,c){return this.view.whenLayerView(a).then(function(d){var k=this._getOutFields(a.popupTemplate),h=c.map(function(a){return d.whenGraphicAttributes(a,
k).otherwise(function(){return a})});return p.eachAlways(h)}.bind(this)).then(function(a){return a.map(function(a){return a.value})})},_getSubLayerFeatureLayers:function(a,c){var k=c||new h,q=[];c=a.length;var v=Math.floor(this.view.extent.width/this.view.width),b=this.view.scale,m=!1,t=this,r=0;a:for(;c>r;r++){var G=a[r],p=G.dynamicLayerInfos||G.layerInfos;if(p){var M=null;G._params&&(G._params.layers||G._params.dynamicLayers)&&(M=G.visibleLayers);for(var M=u._getVisibleLayers(p,M),U=u._getLayersForScale(b,
p),N=p.length,W=0;N>W;W++){var R=p[W],V=R.id,Q=G.popupTemplates[V];if(!R.subLayerIds&&Q&&Q.popupTemplate&&-1<w.indexOf(M,V)&&-1<w.indexOf(U,V)){if(!C){m=!0;break a}var S=G.id+"_"+V,X=this._featureLayersCache[S];X&&X.loadError||(X||((X=Q.layerUrl)||(X=R.source?this._getLayerUrl(G.url,"/dynamicLayer"):this._getLayerUrl(G.url,V)),X=new C(X,{id:S,drawMode:!1,mode:C.MODE_SELECTION,outFields:this._getOutFields(Q.popupTemplate),resourceInfo:Q.resourceInfo,source:R.source}),this._featureLayersCache[S]=X),
X.setDefinitionExpression(G.layerDefinitions&&G.layerDefinitions[V]),X.setGDBVersion(G.gdbVersion),X.popupTemplate=Q.popupTemplate,X.setMaxAllowableOffset(v),X.setUseMapTime(!!G.useMapTime),G.layerDrawingOptions&&G.layerDrawingOptions[V]&&G.layerDrawingOptions[V].renderer&&X.setRenderer(G.layerDrawingOptions[V].renderer),q.push(X))}}}}if(m){var z=new h;A(["../layers/FeatureLayer"],function(a){C=a;z.resolve()});z.then(function(){t._getSubLayerFeatureLayers(a,k)})}else{var Z=[];w.forEach(q,function(a){if(!a.loaded){var b=
new h;l.once(a,"load, error",function(){b.resolve()});Z.push(b.promise)}});Z.length?d(Z).then(function(){q=w.filter(q,function(a){return!a.loadError&&a.isVisibleAtScale(b)});k.resolve(q)}):(q=w.filter(q,function(a){return a.isVisibleAtScale(b)}),k.resolve(q))}return k.promise},_getLayerUrl:function(a,c){var d=a.indexOf("?");return-1===d?a+"/"+c:a.substring(0,d)+"/"+c+a.substring(d)},_getOutFields:function(a){var c=["*"];if("esri.PopupTemplate"===a.declaredClass){var d=null==a.content||Array.isArray(a.content)&&
a.content.every(function(a){return"attachments"===a.type||"fields"===a.type&&null==a.fieldInfos||"text"===a.type&&-1===a.text.indexOf("{")});a.fieldInfos&&!a.expressionInfos&&d&&(c=[],w.forEach(a.fieldInfos,function(a){var d=a.fieldName&&a.fieldName.toLowerCase();d&&"shape"!==d&&0!==d.indexOf("relationships/")&&c.push(a.fieldName)}))}return c},_calculateClickTolerance:function(a){var c=6;return w.forEach(a,function(a){if(a=a.renderer)"simple"===a.type?((a=a.symbol)&&a.xoffset&&(c=Math.max(c,Math.abs(a.xoffset))),
a&&a.yoffset&&(c=Math.max(c,Math.abs(a.yoffset)))):"unique-value"!==a.type&&"class-breaks"!==a.type||w.forEach(a.uniqueValueInfos||a.classBreakInfos,function(a){(a=a.symbol)&&a.xoffset&&(c=Math.max(c,Math.abs(a.xoffset)));a&&a.yoffset&&(c=Math.max(c,Math.abs(a.yoffset)))})}),c},_clickHandler:function(a){function d(a){return k.allLayerViews.find(function(b){return b.layer===a})}var k=this.view,h=k.popup,q=k.map,b=a.screenPoint,m=this;if(0===a.button&&h&&k.ready){var l="3d"===k.type,t=q.allLayers.some(function(a){if(a.isInstanceOf(c))a=
!1;else{var b;null==a?b=!1:(b=d(a),b=null==b?!1:a.loaded&&!b.suspended&&(a.popupEnabled&&a.popupTemplate||"graphics"===a.type||b.getPopupData));!(b=!b)&&(b=l)&&(a=d(a),b=!(a&&a.hasDraped));a=b?!1:!0}return a});return null!=b?void this.view.hitTest(b.x,b.y).then(function(b){t||0<b.results.length?0<b.results.length?(b=b.results[0],m._showPopup(a,b.mapPoint,b.graphic)):m._showPopup(a,a.mapPoint,null):m._closePopup()}):void m._showPopup(a,a.mapPoint)}}})})},"esri/layers/support/layerUtils":function(){define(["dojo/_base/array"],
function(A){return{_serializeLayerDefinitions:function(p){var w=[],l=!1,h=/[:;]/;if(p&&(A.forEach(p,function(d,r){d&&(w.push([r,d]),!l&&h.test(d)&&(l=!0))}),0<w.length)){var d;return l?(d={},A.forEach(w,function(h){d[h[0]]=h[1]}),d=JSON.stringify(d)):(d=[],A.forEach(w,function(h){d.push(h[0]+":"+h[1])}),d=d.join(";")),d}return null},_serializeTimeOptions:function(p,w){if(p){var l=[];return A.forEach(p,function(h,d){h&&(h=h.toJSON(),w&&-1!==A.indexOf(w,d)&&(h.useTime=!1),l.push('"'+d+'":'+JSON.stringify(h)))}),
l.length?"{"+l.join(",")+"}":void 0}},_getVisibleLayers:function(p,w){var l,h,d=[];if(!p)return d;if(w)for(d=w.concat(),h=0;h<p.length;h++)w=p[h],l=A.indexOf(p,w.id),w.subLayerIds&&-1<l&&(d.splice(l,1),d=d.concat(w.subLayerIds));else d=this._getDefaultVisibleLayers(p);return d},_getDefaultVisibleLayers:function(p){var w,l=[];if(!p)return l;for(w=0;w<p.length;w++)0<=p[w].parentLayerId&&-1===A.indexOf(l,p[w].parentLayerId)&&A.some(p,function(h){return h.id===p[w].parentLayerId})||p[w].defaultVisibility&&
l.push(p[w].id);return l},_getLayersForScale:function(p,w){var l=[];if(0<p&&w){var h;for(h=0;h<w.length;h++)if(!(0<=w[h].parentLayerId&&-1===A.indexOf(l,w[h].parentLayerId)&&A.some(w,function(a){return a.id===w[h].parentLayerId}))&&0<=w[h].id){var d=!0,u=w[h].maxScale,r=w[h].minScale;(0<u||0<r)&&(0<u&&0<r?d=p>=u&&r>=p:0<u?d=p>=u:0<r&&(d=r>=p));d&&l.push(w[h].id)}}return l}}})},"esri/layers/GroupLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ./Layer ../core/MultiOriginJSONSupport ./mixins/PortalLayer ./mixins/OperationalLayer ../support/LayersMixin ../core/accessorSupport/utils ../core/accessorSupport/decorators".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c){return function(a){function d(c){c=a.call(this)||this;return c._visibilityHandles={},c.fullExtent=void 0,c.operationalLayerType="GroupLayer",c.spatialReference=void 0,c.type="group",c._visibilityWatcher=c._visibilityWatcher.bind(c),c}return w(d,a),d.prototype.initialize=function(){this._enforceVisibility(this.visibilityMode,this.visible);this.watch("visible",this._visibleWatcher.bind(this),!0)},d.prototype._writeLayers=function(a,c,d,k){var h=[];return a?(a.forEach(function(a){a.write&&
(a=a.write(null,k))&&a.layerType&&h.push(a)}),void(c.layers=h)):h},Object.defineProperty(d.prototype,"visibilityMode",{set:function(a){var c=this._get("visibilityMode")!==a;this._set("visibilityMode",a);c&&this._enforceVisibility(a,this.visible)},enumerable:!0,configurable:!0}),d.prototype.load=function(){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"]})),this.when()},d.prototype.layerAdded=function(a,c){a.visible&&"exclusive"===
this.visibilityMode?this._turnOffOtherLayers(a):"inherited"===this.visibilityMode&&(a.visible=this.visible);this._visibilityHandles[a.uid]=a.watch("visible",this._visibilityWatcher,!0)},d.prototype.layerRemoved=function(a,c){(c=this._visibilityHandles[a.uid])&&(c.remove(),delete this._visibilityHandles[a.uid]);this._enforceVisibility(this.visibilityMode,this.visible)},d.prototype._turnOffOtherLayers=function(a){this.layers.forEach(function(c){c!==a&&(c.visible=!1)})},d.prototype._enforceVisibility=
function(a,c){if(k.getProperties(this).initialized){var d=this.layers,h=d.find(function(a){return a.visible});switch(a){case "exclusive":d.length&&!h&&(h=d.getItemAt(0),h.visible=!0);this._turnOffOtherLayers(h);break;case "inherited":d.forEach(function(a){a.visible=c})}}},d.prototype._visibleWatcher=function(a){"inherited"===this.visibilityMode&&this.layers.forEach(function(c){c.visible=a})},d.prototype._visibilityWatcher=function(a,c,d,k){switch(this.visibilityMode){case "exclusive":a?this._turnOffOtherLayers(k):
this._isAnyLayerVisible()||(k.visible=!0);break;case "inherited":k.visible=this.visible}},d.prototype._isAnyLayerVisible=function(){return this.layers.some(function(a){return a.visible})},l([c.shared({"2d":"../views/layers/GroupLayerView","3d":"../views/layers/GroupLayerView"})],d.prototype,"viewModulePaths",void 0),l([c.property()],d.prototype,"fullExtent",void 0),l([c.property({json:{read:!1,write:{ignoreOrigin:!0}}})],d.prototype,"layers",void 0),l([c.writer("layers")],d.prototype,"_writeLayers",
null),l([c.property()],d.prototype,"operationalLayerType",void 0),l([c.property({json:{write:!1}})],d.prototype,"portalItem",void 0),l([c.property()],d.prototype,"spatialReference",void 0),l([c.property({json:{read:!1},readOnly:!0,value:"group"})],d.prototype,"type",void 0),l([c.property({json:{read:!1,write:!1}})],d.prototype,"url",void 0),l([c.property({type:String,value:"independent",json:{write:!0}})],d.prototype,"visibilityMode",null),d=l([c.subclass("esri.layers.GroupLayer")],d)}(c.declared(h,
a,d,r,u))})},"esri/support/LayersMixin":function(){define(["../core/Accessor","../core/Collection","../core/Logger"],function(A,p,w){var l=function(d,h,r){for(var a,k,c=0,t=d.length;t>c;c++){if(a=d.getItemAt(c),a[h]===r)return a;if(a.layers&&(k=l(a.layers,h,r)))return k}},h=w.getLogger("esri.support.LayersMixin");return A.createSubclass({declaredClass:"esri.support.LayersMixin",destroy:function(){this._layersHandle.remove();this._layersHandle=null;this.layers.drain(this._lyrRemove,this)},properties:{layers:{type:p,
get:function(){var d=this._get("layers");return d?d:(d=new p,d.on("after-add",function(d){d=d.item;d.parent&&d.parent!==this&&d.parent.remove(d);d.parent=this;this.layerAdded(d);"elevation"===d.type&&h.error("Layer '"+d.title+", id:"+d.id+"' of type '"+d.type+"' is not supported as an operational layer and will therefore be ignored.")}.bind(this)),d.on("after-remove",function(d){d=d.item;d.parent=null;this.layerRemoved(d)}.bind(this)),d)},set:function(d){var h=this._get("layers");h&&this.remove(h.toArray());
this.addMany(d.toArray())}}},findLayerById:function(d){return l(this.layers,"id",d)},add:function(d,h){var l=this.layers;return h=l.getNextIndex(h),d.parent===this?void this.reorder(d,h):void l.add(d,h)},addMany:function(d,h){var l=this.layers;h=l.getNextIndex(h);d.slice().forEach(function(a){return a.parent===this?void this.reorder(a,h):(l.add(a,h),void(h+=1))},this)},remove:function(d){return this.layers.remove(d)},removeMany:function(d){return this.layers.removeMany(d)},removeAll:function(){return this.layers.removeAll()},
reorder:function(d,h){return this.layers.reorder(d,h)},findLayerByUid:function(d){return l(this.layers,"uid",d)},layerAdded:function(d){},layerRemoved:function(d){}})})},"esri/views/overlay/ViewOverlay":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom ../../core/Accessor ../../core/accessorSupport/decorators ../../core/Collection ../../widgets/libs/maquette/maquette".split(" "),function(A,p,w,l,h,d,u,r,a){return function(d){function c(){var c=
null!==d&&d.apply(this,arguments)||this;return c.items=new r,c._callbacks=new Map,c._projector=a.createProjector(),c}return w(c,d),Object.defineProperty(c.prototype,"needsRender",{get:function(){return 0<this.items.length},enumerable:!0,configurable:!0}),c.prototype.initialize=function(){var a=this,c=document.createElement("div");c.className="esri-overlay-surface";h.setSelectable(c,!1);this._set("surface",c);this._itemsChangeHandle=this.items.on("change",function(c){c.added.map(function(c){var d=
function(){return c.render()};a._callbacks.set(c,d);a._projector.append(a.surface,d)});c.removed.map(function(c){var d=a._projector.detach(a._callbacks.get(c));a.surface.removeChild(d.domNode);a._callbacks["delete"](c)})})},c.prototype.addItem=function(a){this.items.add(a)},c.prototype.removeItem=function(a){this.items.remove(a)},c.prototype.destroy=function(){this.items.removeAll();this._itemsChangeHandle.remove();this._projector=this._callbacks=null},c.prototype.render=function(){this._projector.renderNow()},
l([u.property({type:HTMLDivElement})],c.prototype,"surface",void 0),l([u.property({type:r})],c.prototype,"items",void 0),l([u.property({readOnly:!0,dependsOn:["items.length"]})],c.prototype,"needsRender",null),c=l([u.subclass("esri.views.overlay.ViewOverlay")],c)}(u.declared(d))})},"esri/views/ui/DefaultUI":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/watchUtils ./UI ./Component ../../widgets/Attribution ../../widgets/Compass ../../widgets/Zoom ../../widgets/NavigationToggle dojo/dom-geometry".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C){return function(q){function v(a){a=q.call(this)||this;return a._defaultPositionLookup=null,a.components=[],a}return w(v,q),v.prototype.initialize=function(){this._handles.add([d.init(this,"components",this._componentsWatcher.bind(this)),d.init(this,"view",this._updateViewAwareWidgets.bind(this))])},v.prototype._findComponentPosition=function(a){if(!this._defaultPositionLookup){var c=C.isBodyLtr();this._defaultPositionLookup={attribution:"manual",compass:c?"top-left":
"top-right","navigation-toggle":c?"top-left":"top-right",zoom:c?"top-left":"top-right"}}return this._defaultPositionLookup[a]},v.prototype._removeComponents=function(a){var c=this;a.forEach(function(a){(a=c.find(a))&&(c.remove(a),a.destroy())})},v.prototype._updateViewAwareWidgets=function(a){var c=this;this.components.forEach(function(d){(d=(d=c.find(d))&&d.widget)&&void 0!==d.view&&d.set("view",a)})},v.prototype._componentsWatcher=function(a,c){this._removeComponents(c);this._addComponents(a)},
v.prototype._addComponents=function(a){var c=this;this.initialized&&a.forEach(function(a){return c.add(c._createComponent(a),c._findComponentPosition(a))})},v.prototype._createComponent=function(a){var c=this._createWidget(a);return c?new r({id:a,node:c}):void 0},v.prototype._createWidget=function(a){return"attribution"===a?this._createAttribution():"compass"===a?this._createCompass():"navigation-toggle"===a?this._createNavigationToggle():"zoom"===a?this._createZoom():void 0},v.prototype._createAttribution=
function(){return new a({view:this.view})},v.prototype._createCompass=function(){return new k({view:this.view})},v.prototype._createNavigationToggle=function(){return new t({view:this.view})},v.prototype._createZoom=function(){return new c({view:this.view})},l([h.property()],v.prototype,"components",void 0),v=l([h.subclass("esri.views.ui.DefaultUI")],v)}(h.declared(u))})},"esri/views/ui/UI":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ./Component ../../core/Accessor ../../core/Evented ../../core/HandleRegistry ../../core/watchUtils dojo/_base/lang dojo/dom-class dojo/dom-construct dojo/dom-style".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q){function v(a){return"object"!=typeof a||a&&a.isInstanceOf&&a.isInstanceOf(d)||!("component"in a||"index"in a||"position"in a)?null:a}var y={left:0,top:0,bottom:0,right:0},B={bottom:30,top:15,right:15,left:15};return function(r){function b(){var b=r.call(this)||this;return b._cornerNameToContainerLookup={},b._positionNameToContainerLookup={},b._components=[],b._handles=new a,b.padding=B,b.view=null,b._initContainers(),b}return w(b,r),b.prototype.initialize=function(){this._handles.add([k.init(this,
"view.padding, container",this._applyViewPadding.bind(this)),k.init(this,"padding",this._applyUIPadding.bind(this))])},b.prototype.destroy=function(){this.container=null;this._components.forEach(function(a){a.destroy()});this._components.length=0;this._handles.destroy()},Object.defineProperty(b.prototype,"container",{set:function(a){var b=this._get("container");a!==b&&(a&&(t.add(a,"esri-ui"),this._attachContainers(a)),b&&(t.remove(b,"esri-ui"),q.set(b,{top:"",bottom:"",left:"",right:""}),C.empty(b)),
this._set("container",a))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"height",{get:function(){var a=this.get("view.height")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.top+b.bottom),0)},enumerable:!0,configurable:!0}),b.prototype.castPadding=function(a){return"number"==typeof a?{bottom:a,top:a,right:a,left:a}:c.mixin({},B,a)},Object.defineProperty(b.prototype,"width",{get:function(){var a=this.get("view.width")||0;if(0===a)return a;var b=this._getViewPadding();
return Math.max(a-(b.left+b.right),0)},enumerable:!0,configurable:!0}),b.prototype.add=function(a,b){var c,m=this;if(Array.isArray(a))return void a.forEach(function(a){return m.add(a,b)});var k=v(a);k&&(c=k.index,b=k.position,a=k.component);b&&"object"==typeof b&&(c=b.index,b=b.position);!a||b&&!this._isValidPosition(b)||(!!a&&a.isInstanceOf&&a.isInstanceOf(d)||(a=new d({node:a})),this._place({component:a,position:b,index:c}),this._components.push(a))},b.prototype.remove=function(a){if(a){if(Array.isArray(a))return a.map(this.remove,
this);if(a=this.find(a)){var b=this._components.indexOf(a);return a.node.parentNode&&a.node.parentNode.removeChild(a.node),this._components.splice(b,1)[0]}}},b.prototype.empty=function(a){var b=this;return Array.isArray(a)?a.map(function(a){return b.empty(a)}).reduce(function(a,b){return a.concat(b)}):(a=a||"manual","manual"===a)?Array.prototype.slice.call(this._manualContainer.children).filter(function(a){return!t.contains(a,"esri-ui-corner")}).map(function(a){return b.remove(a)}):this._isValidPosition(a)?
Array.prototype.slice.call(this._cornerNameToContainerLookup[a].children).map(this.remove,this):void 0},b.prototype.move=function(a,b){var c=this;if(Array.isArray(a)&&a.forEach(function(a){return c.move(a,b)}),a){var d,m=v(a)||v(b);(m&&(d=m.index,b=m.position,a=m.component||a),!b||this._isValidPosition(b))&&(a=this.remove(a))&&this.add(a,{position:b,index:d})}},b.prototype.find=function(a){return a?a&&a.isInstanceOf&&a.isInstanceOf(d)?this._findByComponent(a):"string"==typeof a?this._findById(a):
this._findByNode(a.domNode||a):null},b.prototype._getViewPadding=function(){return this.get("view.padding")||y},b.prototype._attachContainers=function(a){C.place(this._manualContainer,a);C.place(this._innerContainer,a)},b.prototype._initContainers=function(){var a=C.create("div",{className:"esri-ui-inner-container esri-ui-corner-container"}),b=C.create("div",{className:"esri-ui-inner-container esri-ui-manual-container"}),d=C.create("div",{className:"esri-ui-top-left esri-ui-corner"},a),k=C.create("div",
{className:"esri-ui-top-right esri-ui-corner"},a),h=C.create("div",{className:"esri-ui-bottom-left esri-ui-corner"},a),q=C.create("div",{className:"esri-ui-bottom-right esri-ui-corner"},a);this._innerContainer=a;this._manualContainer=b;this._cornerNameToContainerLookup={"top-left":d,"top-right":k,"bottom-left":h,"bottom-right":q};this._positionNameToContainerLookup=c.mixin({manual:b},this._cornerNameToContainerLookup)},b.prototype._isValidPosition=function(a){return!!this._positionNameToContainerLookup[a]},
b.prototype._place=function(a){var b,c=a.component,d=a.index;a=this._positionNameToContainerLookup[a.position||"manual"];return-1<d?(b=Array.prototype.slice.call(a.children),0===d?void this._placeComponent(c,a,"first"):d>=b.length?void this._placeComponent(c,a,"last"):void this._placeComponent(c,b[d],"before")):void this._placeComponent(c,a,"last")},b.prototype._placeComponent=function(a,b,c){var d=a.widget;d&&!d._started&&"function"==typeof d.postMixInProperties&&"function"==typeof d.buildRendering&&
"function"==typeof d.postCreate&&"function"==typeof d.startup&&a.widget.startup();C.place(a.node,b,c)},b.prototype._applyViewPadding=function(){var a=this.container;a&&q.set(a,this._toPxPosition(this._getViewPadding()))},b.prototype._applyUIPadding=function(){this._innerContainer&&q.set(this._innerContainer,this._toPxPosition(this.padding))},b.prototype._toPxPosition=function(a){return{top:this._toPxUnit(a.top),left:this._toPxUnit(a.left),right:this._toPxUnit(a.right),bottom:this._toPxUnit(a.bottom)}},
b.prototype._toPxUnit=function(a){return 0===a?0:a+"px"},b.prototype._findByComponent=function(a){var b,c=null;return this._components.some(function(d){return b=d===a,b&&(c=d),b}),c},b.prototype._findById=function(a){var b,c=null;return this._components.some(function(d){return b=d.id===a,b&&(c=d),b}),c},b.prototype._findByNode=function(a){var b,c=null;return this._components.some(function(d){return b=d.node===a,b&&(c=d),b}),c},l([h.property()],b.prototype,"container",null),l([h.property({dependsOn:["view.height"]})],
b.prototype,"height",null),l([h.property()],b.prototype,"padding",void 0),l([h.cast("padding")],b.prototype,"castPadding",null),l([h.property()],b.prototype,"view",void 0),l([h.property({dependsOn:["view.width"]})],b.prototype,"width",null),b=l([h.subclass("esri.views.ui.UI")],b)}(h.declared(u,r))})},"esri/views/ui/Component":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor dojo/dom dojo/dom-class".split(" "),
function(A,p,w,l,h,d,u,r){return function(a){function d(){var c=null!==a&&a.apply(this,arguments)||this;return c.widget=null,c}return w(d,a),d.prototype.destroy=function(){this.widget&&this.widget.destroy();this.node=null},Object.defineProperty(d.prototype,"id",{get:function(){return this._get("id")||this.get("node.id")},set:function(a){this._set("id",a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"node",{set:function(a){var c=this._get("node");a!==c&&(a&&r.add(a,"esri-component"),
c&&r.remove(c,"esri-component"),this._set("node",a))},enumerable:!0,configurable:!0}),d.prototype.castNode=function(a){return a?"string"==typeof a||a&&"nodeType"in a?(this._set("widget",null),u.byId(a)):(a&&"function"==typeof a.render&&!a.domNode&&(a.domNode=document.createElement("div")),this._set("widget",a),a.domNode):(this._set("widget",null),null)},l([h.property()],d.prototype,"id",null),l([h.property()],d.prototype,"node",null),l([h.cast("node")],d.prototype,"castNode",null),l([h.property({readOnly:!0})],
d.prototype,"widget",void 0),d=l([h.subclass("esri.views.ui.Component")],d)}(h.declared(d))})},"esri/widgets/Attribution":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./support/widget ./Widget ./Attribution/AttributionViewModel ../core/watchUtils".split(" "),function(A,p,w,l,h,d,u,r,a){return function(k){function c(a){a=k.call(this)||this;return a._isOpen=!1,a._attributionTextOverflowed=!1,a._prevSourceNodeHeight=
0,a.itemDelimiter=" | ",a.view=null,a.viewModel=new r,a}return w(c,k),c.prototype.postInitialize=function(){var c=this;this.own(a.on(this,"viewModel.items","change",function(){return c.scheduleRender()}))},Object.defineProperty(c.prototype,"attributionText",{get:function(){return this.viewModel.items.map(function(a){return a.text}).join(this.itemDelimiter)},enumerable:!0,configurable:!0}),c.prototype.render=function(){var a=(c={},c["esri-attribution--open"]=this._isOpen,c);return d.tsx("div",{bind:this,
"class":"esri-attribution esri-widget",classes:a,onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),d.tsx("div",{"class":"esri-attribution__powered-by"},"Powered by ",d.tsx("a",{target:"_blank",href:"http://www.esri.com/","class":"esri-attribution__link"},"Esri")));var c},c.prototype._renderSourcesNode=function(){var a=this._isOpen,c=this._isInteractive(),k=this.attributionText,a=(h={},h["esri-attribution__sources--open"]=a,h["esri-interactive"]=c,h);return d.tsx("div",
{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,"class":"esri-attribution__sources",classes:a,innerHTML:k,role:c?"button":void 0,tabIndex:c?0:-1});var h},c.prototype._afterSourcesNodeCreate=function(a){this._prevSourceNodeHeight=a.clientWidth},c.prototype._afterSourcesNodeUpdate=function(a){var c=!1,d=a.clientHeight;a=a.scrollWidth>=a.clientWidth;var k=this._attributionTextOverflowed!==a;if(this._attributionTextOverflowed=a,k&&(c=!0),this._isOpen)a=d<this._prevSourceNodeHeight,
this._prevSourceNodeHeight=d,a&&(this._isOpen=!1,c=!0);c&&this.scheduleRender()},c.prototype._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)},c.prototype._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed},l([h.property({dependsOn:["viewModel.items.length","itemDelimiter"],readOnly:!0}),d.renderable()],c.prototype,"attributionText",null),l([h.property(),d.renderable()],c.prototype,"itemDelimiter",void 0),l([h.aliasOf("viewModel.view")],c.prototype,
"view",void 0),l([h.property({type:r}),d.renderable(["state","view.size"])],c.prototype,"viewModel",void 0),l([d.accessibleHandler()],c.prototype,"_toggleState",null),c=l([h.subclass("esri.widgets.Attribution")],c)}(h.declared(u))})},"esri/widgets/Attribution/AttributionViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../geometry/support/webMercatorUtils ../../core/HandleRegistry ../../core/Accessor ../../core/lang ../../core/watchUtils ../../core/Collection ../../geometry/Extent".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t){return function(r){function q(a){a=r.call(this,a)||this;return a._handles=new u,a._pendingAttributionItemsByLayerId={},a._attributionDataByLayerId={},a.items=new c,a.view=null,a._updateAttributionItems=a._updateAttributionItems.bind(a),a}return w(q,r),q.prototype.initialize=function(){this._handles.add(k.init(this,"view",this._viewWatcher))},q.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null},Object.defineProperty(q.prototype,"state",
{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0}),q.prototype._viewWatcher=function(a){var c=this,d=this._handles;d&&d.remove();a&&(d.add([a.allLayerViews.on("change",function(a){c._addLayerViews(a.added);0<a.removed.length&&(a.removed.forEach(function(a){d.remove(a.uid)}),c._updateAttributionItems())}),k.init(a,"stationary",this._updateAttributionItems)]),this._addLayerViews(a.allLayerViews))},q.prototype._addLayerViews=function(a){var c=this;a.forEach(function(a){c._handles.has(a.uid)||
c._handles.add(k.init(a,"suspended",c._updateAttributionItems),a.uid)})},q.prototype._updateAttributionItems=function(){var a=this,c=[];this._getActiveLayerViews().forEach(function(d){var k=d.layer;if(!k.hasAttributionData){var b=k.get("copyright");if(!b)return;d=a._findItem(c,b);return void(d?a._updateItemSource(d,k):c.push({text:b,layers:[k]}))}if(k&&k.tileInfo){var m=a._attributionDataByLayerId;if(m[k.uid]){b=a._getDynamicAttribution(m[k.uid],a.view,k);if(!b)return;d=a._findItem(c,b);return void(d?
a._updateItemSource(d,k):c.push({text:b,layers:[k]}))}var h=a._pendingAttributionItemsByLayerId;a._inProgress(h[k.uid])||(h[k.uid]=k.fetchAttributionData().then(function(b){b=a._createContributionIndex(b,a._isBingLayer(k));delete h[k.uid];m[k.uid]=b;a._updateAttributionItems()}))}});this._itemsChanged(this.items,c)&&(this.items.removeAll(),this.items.addMany(c))},q.prototype._itemsChanged=function(a,c){return a.length!==c.length||a.some(function(a,d){return a.text!==c[d].text})},q.prototype._inProgress=
function(a){return a&&!a.isFulfilled()},q.prototype._getActiveLayerViews=function(){return this.get("view.allLayerViews").filter(function(a){return!a.suspended&&a.get("layer.attributionVisible")})},q.prototype._findItem=function(a,c){var d;return a.some(function(a){var b=a.text===c;return b&&(d=a),b}),d},q.prototype._updateItemSource=function(a,c){-1===a.layers.indexOf(c)&&a.layers.push(c)},q.prototype._isBingLayer=function(a){return-1!==a.declaredClass.toLowerCase().indexOf("vetiledlayer")},q.prototype._createContributionIndex=
function(c,k){c=c.contributors;var h={};return c?(c.forEach(function(c,b){var m=c.coverageAreas;m&&m.forEach(function(m){var q=m.bbox,l=m.zoomMin-(k&&m.zoomMin?1:0),v=m.zoomMax-(k&&m.zoomMax?1:0);c={extent:d.geographicToWebMercator(new t({xmin:q[1],ymin:q[0],xmax:q[3],ymax:q[2]})),attribution:c.attribution||"",score:a.isDefined(m.score)?m.score:100,id:b};for(m=l;v>=m;m++)h[m]=h[m]||[],h[m].push(c)})}),h.maxKey=Math.max.apply(null,Object.keys(h)),h):h},q.prototype._getDynamicAttribution=function(c,
d,k){var h=d.extent;d=k.tileInfo.scaleToZoom(d.scale);if(d=Math.min(c.maxKey,Math.round(d)),!h||!a.isDefined(d)||-1>=d)return"";c=c[d];var b=h.center.clone().normalize(),m={};return c.filter(function(a){var c=!m[a.id]&&a.extent.contains(b);return c&&(m[a.id]=!0),c}).sort(function(a,b){return b.score-a.score||a.objectId-b.objectId}).map(function(a){return a.attribution}).join(", ")},l([h.property({readOnly:!0,type:c})],q.prototype,"items",void 0),l([h.property({dependsOn:["view.ready"],readOnly:!0})],
q.prototype,"state",null),l([h.property()],q.prototype,"view",void 0),q=l([h.subclass("esri.widgets.Attribution.AttributionViewModel")],q)}(h.declared(r))})},"esri/widgets/Compass":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./support/widget ./Widget ./Compass/CompassViewModel dojo/i18n!./Compass/nls/Compass".split(" "),function(A,p,w,l,h,d,u,r,a){return function(k){function c(a){a=k.call(this)||this;
return a.activeMode=null,a.modes=null,a.view=null,a.viewModel=new r,a}return w(c,k),c.prototype.reset=function(){},c.prototype.render=function(){var c=this.viewModel.orientation,k=this.viewModel.state,h="disabled"===k,l="compass"===("rotation"===k?"rotation":"compass"),k=(y={},y["esri-disabled"]=h,y["esri-compass--active"]="device-orientation"===this.viewModel.activeMode,y["esri-interactive"]=!h,y),y=(r={},r["esri-icon-compass"]=l,r["esri-icon-dial"]=!l,r);return d.tsx("div",{bind:this,"class":"esri-compass esri-widget-button esri-widget",
classes:k,onclick:this._start,onkeydown:this._start,role:"button",tabIndex:h?-1:0,"aria-label":a.reset,title:a.reset},d.tsx("span",{"aria-hidden":"true","class":"esri-compass__icon",classes:y,styles:this._toRotationTransform(c)}),d.tsx("span",{"class":"esri-icon-font-fallback-text"},a.reset));var y,r},c.prototype._start=function(){var a=this.viewModel;a.nextMode();a.startMode()},c.prototype._toRotationTransform=function(a){return{transform:"rotateZ("+a.z+"deg)"}},l([h.aliasOf("viewModel.activeMode")],
c.prototype,"activeMode",void 0),l([h.aliasOf("viewModel.modes")],c.prototype,"modes",void 0),l([h.aliasOf("viewModel.view")],c.prototype,"view",void 0),l([h.property({type:r}),d.renderable(["viewModel.orientation","viewModel.state"])],c.prototype,"viewModel",void 0),l([h.aliasOf("viewModel.reset")],c.prototype,"reset",null),l([d.accessibleHandler()],c.prototype,"_start",null),c=l([h.subclass("esri.widgets.Compass")],c)}(h.declared(u))})},"esri/widgets/Compass/CompassViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor ../../core/HandleRegistry ../../core/Logger ../../core/promiseUtils ../../core/watchUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k){var c=r.getLogger("esri.widgets.CompassViewModel");return function(d){function t(a){a=d.call(this,a)||this;return a._handles=new u,a.canUseHeading=!1,a.orientation={x:0,y:0,z:0},a.view=null,a._updateForCamera=a._updateForCamera.bind(a),a._updateForRotation=a._updateForRotation.bind(a),a._updateRotationWatcher=a._updateRotationWatcher.bind(a),a._updateViewHeading=a._updateViewHeading.bind(a),a._checkHeadingSupport=a._checkHeadingSupport.bind(a),a._canUseHeading(),a}return w(t,
d),t.prototype.initialize=function(){this._handles.add(k.init(this,"view",this._updateRotationWatcher))},t.prototype.destroy=function(){this._removeCheckHeadingListener();this._removeOrientationListener();this._handles.destroy();this.view=this._handles=null},Object.defineProperty(t.prototype,"activeMode",{get:function(){var a=this._get("activeMode");return a?a:(a=this.modes)?a[0]:"none"},set:function(a){this.stopMode();this._set("activeMode",a);void 0===a&&this._clearOverride("activeMode")},enumerable:!0,
configurable:!0}),Object.defineProperty(t.prototype,"canShowNorth",{get:function(){var a=this.get("view.spatialReference");return a&&(a.isWebMercator||a.isWGS84)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"modes",{get:function(){return this._get("modes")||["reset"]},set:function(a){this._set("modes",a);void 0===a&&this._clearOverride("modes")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this.get("view.ready")?this.canShowNorth?
"compass":"rotation":"disabled"},enumerable:!0,configurable:!0}),t.prototype.previousMode=function(){var a=this.activeMode,c=this.modes;2>c.length||(a=c.indexOf(a),this._paginateMode(a-1))},t.prototype.nextMode=function(){var a=this.activeMode,c=this.modes;2>c.length||(a=c.indexOf(a),this._paginateMode(a+1))},t.prototype.startMode=function(){var a=this.activeMode;"reset"===a&&this.reset();"device-orientation"===a&&(this._removeOrientationListener(),this._addOrientationListener())},t.prototype.stopMode=
function(){"device-orientation"===this.activeMode&&this._removeOrientationListener()},t.prototype.reset=function(){if(this.get("view.ready")){var a={};"2d"===this.view.type?a.rotation=0:a.heading=0;this.view.goTo(a)}},t.prototype._supportsDeviceOrientation=function(){return"DeviceOrientationEvent"in window},t.prototype._paginateMode=function(a){var c=this.modes;this.activeMode=c[(a+c.length)%c.length]},t.prototype._getHeading=function(a){return a.webkitCompassHeading},t.prototype._removeCheckHeadingListener=
function(){this._supportsDeviceOrientation()&&window.removeEventListener("deviceorientation",this._checkHeadingSupport)},t.prototype._checkHeadingSupport=function(a){"number"==typeof this._getHeading(a)&&this._set("canUseHeading",!0);this._removeCheckHeadingListener()},t.prototype._canUseHeading=function(){var c=this;this._supportsDeviceOrientation()&&(window.addEventListener("deviceorientation",this._checkHeadingSupport),a.after(500).then(function(){c._removeCheckHeadingListener()}))},t.prototype._updateViewHeading=
function(a){var c=this.view;a=this._getHeading(a);"number"!=typeof a||0>a||360<a||!c||("3d"===c.type&&c.goTo({heading:a}),"2d"===c.type&&(c.rotation=a))},t.prototype._removeOrientationListener=function(){this.canUseHeading&&window.removeEventListener("deviceorientation",this._updateViewHeading)},t.prototype._addOrientationListener=function(){var a=this.canShowNorth;return this.canUseHeading?a?void window.addEventListener("deviceorientation",this._updateViewHeading):void c.warn("device-orientation mode requires 'canShowNorth' to be true"):
void c.warn("The deviceorientation event is not supported in this browser")},t.prototype._updateForRotation=function(a){void 0!==a&&null!==a&&(this.orientation={z:a})},t.prototype._updateForCamera=function(a){a&&(this.orientation={x:0,y:0,z:-a.heading})},t.prototype._updateRotationWatcher=function(a){this._handles.removeAll();a&&("2d"===a.type?this._handles.add(k.init(this,"view.rotation",this._updateForRotation)):this._handles.add(k.init(this,"view.camera",this._updateForCamera)))},l([h.property({dependsOn:["modes"]})],
t.prototype,"activeMode",null),l([h.property({dependsOn:["view.spatialReference.isWebMercator","view.spatialReference.wkid"],readOnly:!0})],t.prototype,"canShowNorth",null),l([h.property({readOnly:!0})],t.prototype,"canUseHeading",void 0),l([h.property({dependsOn:["canUseHeading"]})],t.prototype,"modes",null),l([h.property()],t.prototype,"orientation",void 0),l([h.property({dependsOn:["view.ready","canShowNorth"],readOnly:!0})],t.prototype,"state",null),l([h.property()],t.prototype,"view",void 0),
l([h.property()],t.prototype,"previousMode",null),l([h.property()],t.prototype,"nextMode",null),l([h.property()],t.prototype,"startMode",null),l([h.property()],t.prototype,"stopMode",null),l([h.property()],t.prototype,"reset",null),t=l([h.subclass("esri.widgets.CompassViewModel")],t)}(h.declared(d))})},"esri/widgets/Zoom":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./support/widget ./Widget ./Zoom/IconButton ./Zoom/ZoomViewModel dojo/i18n!./Zoom/nls/Zoom".split(" "),
function(A,p,w,l,h,d,u,r,a,k){return function(c){function t(d){d=c.call(this)||this;return d.view=null,d.viewModel=new a,d}return w(t,c),t.prototype.postInitialize=function(){this._zoomInButton=new r({action:this.zoomIn,iconClass:"esri-icon-plus",title:k.zoomIn});this._zoomOutButton=new r({action:this.zoomOut,iconClass:"esri-icon-minus",title:k.zoomOut})},Object.defineProperty(t.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0}),
t.prototype.render=function(){var a=this.viewModel,c=(k={},k["esri-zoom--horizontal"]="horizontal"===this.layout,k);return this._zoomInButton.enabled="ready"===a.state&&a.canZoomIn,this._zoomOutButton.enabled="ready"===a.state&&a.canZoomOut,d.tsx("div",{"class":"esri-zoom esri-widget",classes:c},this._zoomInButton.render(),this._zoomOutButton.render());var k},t.prototype.zoomIn=function(){},t.prototype.zoomOut=function(){},l([h.property({value:"vertical"}),d.renderable()],t.prototype,"layout",null),
l([h.aliasOf("viewModel.view"),d.renderable()],t.prototype,"view",void 0),l([h.property({type:a}),d.renderable(["viewModel.canZoomIn","viewModel.canZoomOut","viewModel.state"])],t.prototype,"viewModel",void 0),l([h.aliasOf("viewModel.zoomIn")],t.prototype,"zoomIn",null),l([h.aliasOf("viewModel.zoomOut")],t.prototype,"zoomOut",null),t=l([h.subclass("esri.widgets.Zoom")],t)}(h.declared(u))})},"esri/widgets/Zoom/IconButton":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../support/widget ../Widget".split(" "),
function(A,p,w,l,h,d,u){return function(r){function a(){var a=null!==r&&r.apply(this,arguments)||this;return a.enabled=!0,a.iconClass="",a.title="",a}return w(a,r),a.prototype.render=function(){var a=this.enabled?0:-1,c=(h={},h["esri-disabled"]=!this.enabled,h["esri-interactive"]=this.enabled,h),h=(l={},l[this.iconClass]=!!this.iconClass,l);return d.tsx("div",{bind:this,"class":"esri-widget-button esri-widget",classes:c,onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:a,
title:this.title},d.tsx("span",{"aria-hidden":"true",role:"presentation","class":"esri-icon",classes:h}),d.tsx("span",{"class":"esri-icon-font-fallback-text"},this.title));var h,l},a.prototype._triggerAction=function(){this.action.call(this)},l([h.property()],a.prototype,"action",void 0),l([h.property(),d.renderable()],a.prototype,"enabled",void 0),l([h.property(),d.renderable()],a.prototype,"iconClass",void 0),l([h.property(),d.renderable()],a.prototype,"title",void 0),l([d.accessibleHandler()],
a.prototype,"_triggerAction",null),a=l([h.subclass("esri.widgets.IconButton")],a)}(h.declared(u))})},"esri/widgets/Zoom/ZoomViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ./ZoomConditions3D ./ZoomConditions2D ../../core/Accessor".split(" "),function(A,p,w,l,h,d,u,r){return function(a){function k(c){c=a.call(this,c)||this;return c.canZoomIn=null,c.canZoomOut=null,c.zoomIn=c.zoomIn.bind(c),
c.zoomOut=c.zoomOut.bind(c),c}return w(k,a),k.prototype.destroy=function(){this.view=null},Object.defineProperty(k.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"view",{set:function(a){a?"2d"===a.type?this._zoomConditions=new u({view:a}):"3d"===a.type&&(this._zoomConditions=new d):this._zoomConditions=null;this._set("view",a)},enumerable:!0,configurable:!0}),k.prototype.zoomIn=function(){this.canZoomIn&&
this._zoomToFactor(.5)},k.prototype.zoomOut=function(){this.canZoomOut&&this._zoomToFactor(2)},k.prototype._zoomToFactor=function(a){if("ready"===this.state){var c=this.view;"3d"===this.view.type?c.goTo({zoomFactor:1/a}):c.goTo({scale:this.get("view.scale")*a})}},l([h.property()],k.prototype,"_zoomConditions",void 0),l([h.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],k.prototype,"canZoomIn",void 0),l([h.property({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],k.prototype,"canZoomOut",
void 0),l([h.property({dependsOn:["view.ready"],readOnly:!0})],k.prototype,"state",null),l([h.property()],k.prototype,"view",null),l([h.property()],k.prototype,"zoomIn",null),l([h.property()],k.prototype,"zoomOut",null),k=l([h.subclass("esri.widgets.Zoom.ZoomViewModel")],k)}(h.declared(r))})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor".split(" "),
function(A,p,w,l,h,d){return function(d){function r(){var a=null!==d&&d.apply(this,arguments)||this;return a.canZoomIn=!0,a.canZoomOut=!0,a}return w(r,d),l([h.property({readOnly:!0})],r.prototype,"canZoomIn",void 0),l([h.property({readOnly:!0})],r.prototype,"canZoomOut",void 0),r=l([h.subclass("esri.widgets.Zoom.ZoomConditions3D")],r)}(h.declared(d))})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor".split(" "),
function(A,p,w,l,h,d){return function(d){function r(){return null!==d&&d.apply(this,arguments)||this}return w(r,d),Object.defineProperty(r.prototype,"canZoomIn",{get:function(){var a=this.get("view.scale"),d=this.get("view.constraints.effectiveMaxScale");return 0===d||a>d},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"canZoomOut",{get:function(){var a=this.get("view.scale"),d=this.get("view.constraints.effectiveMinScale");return 0===d||d>a},enumerable:!0,configurable:!0}),l([h.property({dependsOn:["view.ready",
"view.scale"],readOnly:!0})],r.prototype,"canZoomIn",null),l([h.property({dependsOn:["view.ready","view.scale"],readOnly:!0})],r.prototype,"canZoomOut",null),l([h.property()],r.prototype,"view",void 0),r=l([h.subclass("esri.widgets.Zoom.ZoomConditions2D")],r)}(h.declared(d))})},"esri/widgets/NavigationToggle":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./support/widget ./Widget ./NavigationToggle/NavigationToggleViewModel dojo/i18n!./NavigationToggle/nls/NavigationToggle".split(" "),
function(A,p,w,l,h,d,u,r,a){return function(k){function c(a){a=k.call(this)||this;return a.view=null,a.viewModel=new r,a}return w(c,k),Object.defineProperty(c.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0}),c.prototype.toggle=function(){},c.prototype.render=function(){var c="disabled"===this.get("viewModel.state"),k="pan"===this.get("viewModel.navigationMode"),h=(l={},l["esri-disabled"]=c,l["esri-navigation-toggle--horizontal"]=
"horizontal"===this.layout,l),l=(y={},y["esri-navigation-toggle__button--active"]=k,y),k=(r={},r["esri-navigation-toggle__button--active"]=!k,r);return d.tsx("div",{bind:this,"class":"esri-navigation-toggle esri-widget",classes:h,onclick:this._toggle,onkeydown:this._toggle,tabIndex:c?-1:0,"aria-label":a.toggle,title:a.toggle},d.tsx("div",{"class":d.join("esri-navigation-toggle__button esri-widget-button","esri-navigation-toggle__button--pan"),classes:l},d.tsx("span",{"class":"esri-icon-pan"})),d.tsx("div",
{"class":d.join("esri-navigation-toggle__button esri-widget-button","esri-navigation-toggle__button--rotate"),classes:k},d.tsx("span",{"class":"esri-icon-rotate"})));var l,y,r},c.prototype._toggle=function(){this.toggle()},l([h.property({value:"vertical"}),d.renderable()],c.prototype,"layout",null),l([h.aliasOf("viewModel.view"),d.renderable()],c.prototype,"view",void 0),l([h.property({type:r}),d.renderable(["viewModel.state","viewModel.navigationMode"])],c.prototype,"viewModel",void 0),l([h.aliasOf("viewModel.toggle")],
c.prototype,"toggle",null),l([d.accessibleHandler()],c.prototype,"_toggle",null),c=l([h.subclass("esri.widgets.NavigationToggle")],c)}(h.declared(u))})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/watchUtils ../../core/Accessor ../../core/HandleRegistry".split(" "),function(A,p,w,l,h,d,u,r){return function(a){function k(c){c=
a.call(this,c)||this;return c._handles=new r,c.navigationMode="pan",c.view=null,c.toggle=c.toggle.bind(c),c}return w(k,a),k.prototype.initialize=function(){this._handles.add(d.when(this,"view.inputManager",this._setNavigationMode.bind(this)))},k.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null},Object.defineProperty(k.prototype,"state",{get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"},enumerable:!0,configurable:!0}),k.prototype.toggle=
function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())},k.prototype._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"},l([h.property({dependsOn:["view.ready"],readOnly:!0})],k.prototype,"state",null),l([h.property()],k.prototype,"navigationMode",void 0),l([h.property()],k.prototype,"view",void 0),l([h.property()],k.prototype,"toggle",null),k=l([h.subclass("esri.widgets.NavigationToggleViewModel")],
k)}(h.declared(u))})},"esri/views/ViewAnimation":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators dojo/Deferred ../core/Accessor ../core/Promise ../core/Scheduler ../core/Error ../core/promiseUtils".split(" "),function(A,p,w,l,h,d,u,r,a,k,c){A=function(t){function r(a){a=t.call(this)||this;return a.state="running",a.target=null,a}return w(r,t),r.prototype.initialize=function(){this._dfd=new d;this.addResolvingPromise(this._dfd.promise)},
Object.defineProperty(r.prototype,"done",{get:function(){return"finished"===this.state||"stopped"===this.state},enumerable:!0,configurable:!0}),r.prototype.stop=function(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","stopped"),a.schedule(this._dfd.reject.bind(this._dfd,new k("ViewAnimation stopped"))))},r.prototype.finish=function(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","finished"),a.schedule(this._dfd.resolve))},r.prototype.update=function(a,
d){d||(d=c.isThenable(a)?"waiting-for-target":"running");this._set("target",a);this._set("state",d)},l([h.property({readOnly:!0,dependsOn:["state"]})],r.prototype,"done",null),l([h.property({readOnly:!0,type:String})],r.prototype,"state",void 0),l([h.property()],r.prototype,"target",void 0),r=l([h.subclass("esri.views.ViewAnimation")],r)}(h.declared(u,r));(A||(A={})).State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"};return A})},"esri/Camera":function(){define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/JSONSupport ./geometry/Point ./views/3d/support/mathUtils ./core/accessorSupport/decorators".split(" "),
function(A,p,w,l,h,d,u,r){return function(a){function k(c,d,k,h){c=a.call(this)||this;return c.position=null,c.heading=0,c.tilt=0,c.fov=55,c}return w(k,a),c=k,k.prototype.getDefaults=function(a){return a.position?void 0:{position:new d([0,0,0])}},k.prototype.normalizeCtorArgs=function(a,c,d,k){return a&&"object"==typeof a&&("x"in a||Array.isArray(a))?(a={position:a},null!=c&&(a.heading=c),null!=d&&(a.tilt=d),null!=k&&(a.fov=k),a):a},k.prototype.equals=function(a){return a?this.tilt===a.tilt&&this.heading===
a.heading&&this.fov===a.fov&&this.position.equals(a.position):!1},k.prototype.clone=function(){return new c({position:this.position.clone(),heading:this.heading,tilt:this.tilt,fov:this.fov})},l([r.property({type:d,json:{write:{isRequired:!0}}})],k.prototype,"position",void 0),l([r.property({type:Number,json:{write:{isRequired:!0}}}),r.cast(u.cyclicalDeg.normalize)],k.prototype,"heading",void 0),l([r.property({type:Number,json:{write:{isRequired:!0}}}),r.cast(function(a){return u.clamp(a,-180,180)})],
k.prototype,"tilt",void 0),l([r.property({json:{read:!1,write:!1}})],k.prototype,"fov",void 0),k=c=l([r.subclass("esri.Camera")],k);var c}(r.declared(h))})},"esri/Viewpoint":function(){define(["./core/JSONSupport","./Camera","./geometry/support/typeUtils","./geometry/support/jsonUtils"],function(A,p,w,l){var h=A.createSubclass({declaredClass:"esri.Viewpoint",properties:{rotation:{type:Number,value:0,cast:function(d){return d%=360,0>d&&(d+=360),d},json:{write:!0}},scale:{type:Number,value:0,json:{write:!0}},
targetGeometry:{value:null,types:w.types,json:{read:function(d){return l.fromJSON(d)},write:!0}},camera:{value:null,type:p,json:{write:!0}}},clone:function(){return new h({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry?this.targetGeometry.clone():null,camera:this.camera?this.camera.clone():null})}});return h})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators ./Lighting".split(" "),
function(A,p,w,l,h,d,u){return function(h){function a(a){a=h.call(this,a)||this;return a.lighting=new u,a}return w(a,h),k=a,a.prototype.clone=function(){return new k({lighting:u.prototype.clone.call(this.lighting)})},a.sanitizeJSON=function(a){return{lighting:a.lighting?u.sanitizeJSON(a.lighting):(new u).toJSON()}},l([d.property({type:u,json:{write:!0}})],a.prototype,"lighting",void 0),a=k=l([d.subclass("esri.webscene.Environment")],a);var k}(d.declared(h))})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),
function(A,p,w,l,h,d){return function(h){function r(a){a=h.call(this,a)||this;return a.date=null,a.directShadowsEnabled=!1,a.displayUTCOffset=null,a}return w(r,h),a=r,r.prototype.readDate=function(a,c){return null!=c.datetime&&new Date(c.datetime)||null},r.prototype.writeDate=function(a,c,d){c[d]=a.getTime()},r.prototype.readDirectShadowsEnabled=function(a,c){return!!c.directShadows},r.prototype.writedirectShadowsEnabled=function(a,c,d){a&&(c[d]=a)},r.prototype.writeDisplayUTCOffset=function(a,c){null!=
a&&(c.displayUTCOffset=a)},r.prototype.clone=function(){return new a({date:null!=this.date?new Date(this.date.getTime()):null,directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null})},r.sanitizeJSON=function(a){var c={datetime:a.datetime};return void 0!==a.directShadows&&(c.directShadows=!!a.directShadows),void 0!==a.displayUTCOffset&&(c.displayUTCOffset=a.displayUTCOffset),c},l([d.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],
r.prototype,"date",void 0),l([d.reader("date",["datetime"])],r.prototype,"readDate",null),l([d.writer("date")],r.prototype,"writeDate",null),l([d.property({type:Boolean,json:{write:{target:"directShadows"}}})],r.prototype,"directShadowsEnabled",void 0),l([d.reader("directShadowsEnabled",["directShadows"])],r.prototype,"readDirectShadowsEnabled",null),l([d.writer("directShadowsEnabled")],r.prototype,"writedirectShadowsEnabled",null),l([d.property({type:Number,json:{write:!0}})],r.prototype,"displayUTCOffset",
void 0),l([d.writer("displayUTCOffset")],r.prototype,"writeDisplayUTCOffset",null),r=a=l([d.subclass("esri.webscene.Lighting")],r);var a}(d.declared(h))})},"esri/views/support/screenshotUtils":function(){define(["require","exports","dojo/_base/lang"],function(A,p,w){Object.defineProperty(p,"__esModule",{value:!0});p.adjustScreenshotSettings=function(l,h){l=w.mixin({format:"png",quality:100},l||{});var d,u;l.includePadding?(d=h.width,u=h.height):(d=h.width-h.padding.left-h.padding.right,u=h.height-
h.padding.top-h.padding.bottom);var r=d/u;return void 0!==l.width&&void 0===l.height?l.height=l.width/r:void 0!==l.height&&void 0===l.width&&(l.width=r*l.height),void 0!==l.height&&(l.height=Math.floor(l.height)),void 0!==l.width&&(l.width=Math.floor(l.width)),l.area||l.includePadding||(l.area={x:h.padding.left,y:h.padding.top,width:d,height:u}),l};p.resampleHermite=function(l,h,d,u,r,a,k){void 0===k&&(k=!0);var c=h/r;d/=a;for(var t=Math.ceil(c/2),C=Math.ceil(d/2),q=0;a>q;q++)for(var v=0;r>v;v++){for(var y=
4*(v+(k?a-q-1:q)*r),B=0,D=0,b=0,m=0,E=0,p=0,G=0,w=(q+.5)*d,M=Math.floor(q*d);(q+1)*d>M;M++)for(var U=Math.abs(w-(M+.5))/C,A=(v+.5)*c,U=U*U,W=Math.floor(v*c);(v+1)*c>W;W++){var R=Math.abs(A-(W+.5))/t,V=Math.sqrt(U+R*R);-1<=V&&1>=V&&(B=2*V*V*V-3*V*V+1,0<B&&(R=4*(W+M*h),G+=B*l[R+3],b+=B,255>l[R+3]&&(B=B*l[R+3]/250),m+=B*l[R],E+=B*l[R+1],p+=B*l[R+2],D+=B))}u[y]=m/D;u[y+1]=E/D;u[y+2]=p/D;u[y+3]=G/b}}})},"esri/views/support/WebGLRequirements":function(){define(["require","exports","../../core/Error","../../core/sniff"],
function(A,p,w,l){Object.defineProperty(p,"__esModule",{value:!0});p.check=function(){var h=null;return l("esri-webgl")?l("esri-webgl-major-performance-caveat")?h=new w("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check if your GPU is blacklisted."):l("esri-webgl-high-precision-fragment")?l("esri-webgl-vertex-shader-samplers")?l("esri-webgl-element-index-uint")||(h=new w("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.")):
h=new w("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):h=new w("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):h=new w("webgl:required","WebGL is required but not supported."),h}})},"esri/views/3d/state/ViewState":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../views/ViewAnimation ../support/PropertiesPool ../support/Evented ../support/earthUtils ./Constraints ../webgl-engine/lib/Camera ../lib/glMatrix ./controllers/CameraController ./controllers/AnimationController".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v){Object.defineProperty(p,"__esModule",{value:!0});A=function(b){function d(c){c=b.call(this,c)||this;return c.propertiesPool=new r["default"]({camera:t},c),c.events=new a.Evented,c.updateQueue=new D,c.processingUpdates=!1,c}return w(d,b),d.prototype.destroy=function(){this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)},d.prototype.normalizeCtorArgs=function(a){return{camera:this.createInitialCamera(a.viewingMode),mode:a.viewingMode,
spatialReference:a.spatialReference,constraints:new c["default"]({mode:a.viewingMode})}},Object.defineProperty(d.prototype,"animation",{get:function(){return this.cameraController instanceof v.AnimationController?this.cameraController.viewAnimation:null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"camera",{get:function(){return this._get("camera")},set:function(a){a!==y&&y.copyFrom(a);y.markViewDirty();y.computeUp(this.mode);B.camera=y;this.events.emit("before-camera-change",
B);(a=this._get("camera"))&&a.equivalent(y)||this._set("camera",this.propertiesPool.get("camera").copyFrom(y))},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"isLocal",{get:function(){return"local"===this.mode},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"interacting",{get:function(){return!!this.cameraController&&this.cameraController.isInteractive},
enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"cameraController",{get:function(){return this._get("cameraController")},set:function(a){var b=this;return this.stopActiveCameraController()?(a&&(a.watch("state",function(c){c!==q.State.Finished&&c!==q.State.Stopped||(b.updateCamera(function(b){a.onControllerEnd(b)}),b._set("cameraController",null))},!0),a.onControllerStart(this.camera)),void this._set("cameraController",a)):void(a&&(a.state=q.State.Rejected))},enumerable:!0,configurable:!0}),
d.prototype.switchCameraController=function(a){return this.cameraController=a,a.state!==q.State.Rejected},d.prototype.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0},d.prototype.cameraChanged=function(){this.updateCamera(function(){})},d.prototype.updateCamera=function(a){this.updateQueue.enqueue(a);this.processingUpdates||this.processUpdateQueue()},d.prototype.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=
!0;var a=this.updateQueue.dequeue();y.copyFrom(this._get("camera"));a(y);this.camera=y;this.processingUpdates=!1;this.processUpdateQueue()}},d.prototype.createInitialCamera=function(a){return"global"===a?new t(C.vec3d.createFrom(4*k.earthRadius,0,0),C.vec3d.createFrom(k.earthRadius,0,0),C.vec3d.createFrom(0,0,1)):new t(C.vec3d.createFrom(0,0,100),C.vec3d.createFrom(0,0,0),C.vec3d.createFrom(0,1,0))},l([h.property({readOnly:!0,type:u,dependsOn:["cameraController"]})],d.prototype,"animation",null),
l([h.property({type:t})],d.prototype,"camera",null),l([h.property({constructOnly:!0})],d.prototype,"constraints",void 0),l([h.property({readOnly:!0})],d.prototype,"events",void 0),l([h.property({readOnly:!0,dependsOn:["isLocal"]})],d.prototype,"isGlobal",null),l([h.property({readOnly:!0,dependsOn:["mode"]})],d.prototype,"isLocal",null),l([h.property({constructOnly:!0})],d.prototype,"mode",void 0),l([h.property({constructOnly:!0})],d.prototype,"spatialReference",void 0),l([h.property({readOnly:!0,
dependsOn:["cameraController"]})],d.prototype,"interacting",null),l([h.property()],d.prototype,"cameraController",null),d=l([h.subclass()],d)}(h.declared(d));p.ViewState=A;var y=new t,B={camera:null},D=function(){function a(){this.data=[];this.length=this.ptr=0}return a.prototype.enqueue=function(a){this.data.push(a);this.length++},a.prototype.dequeue=function(){if(0===this.length)return null;var a=this.data[this.ptr++];return this.length--,0===this.length&&(this.data.length=0,this.ptr=0),a},a}();
p["default"]=A})},"esri/views/3d/support/PropertiesPool":function(){define(["require","exports","../../../core/ObjectPool","../../../core/accessorSupport/watch"],function(A,p,w,l){Object.defineProperty(p,"__esModule",{value:!0});A=function(){function h(d,h){var r=this;this.owner=h;this.properties={};this.afterDispatchHandle=null;for(var a in d)h=new w(d[a],null,null,2,2),this.properties[a]={pool:h,acquired:[]};this.afterDispatchHandle=l.afterDispatch(function(){return r.release()})}return h.prototype.destroy=
function(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);this.owner=null},h.prototype.get=function(d){var h=this.owner._get(d);d=this.properties[d];var l=d.pool.acquire();for(d.acquired.push(l);l===h;)d.acquired.push(l),l=d.pool.acquire();return l},h.prototype.release=function(){for(var d in this.properties){for(var h=this.properties[d],r=0,a=0,k=h.acquired;a<k.length;a++){var c=k[a];l.isValueInUse(c)?h.acquired[r++]=c:h.pool.release(c)}h.acquired.length=
r}},h}();p.PropertiesPool=A;p["default"]=A})},"esri/views/3d/support/Evented":function(){define(["require","exports"],function(A,p){Object.defineProperty(p,"__esModule",{value:!0});A=function(){function p(){this._listeners={}}return p.prototype.hasEventListener=function(l){return null!=this._listeners[l]&&0<this._listeners[l].size},p.prototype.on=function(l,h){var d=this;null==this._listeners[l]&&(this._listeners[l]=new Map);var u={};return this._listeners[l].set(u,h),{remove:function(){return d._listeners[l]["delete"](u)}}},
p.prototype.emit=function(l,h){null!=this._listeners[l]&&this._listeners[l].forEach(function(d){return d(h)})},p}();p.Evented=A})},"esri/views/3d/state/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../core/Logger ../support/earthUtils ../support/mathUtils".split(" "),function(A,p,w,l,h,d,u,r,a){Object.defineProperty(p,"__esModule",{value:!0});
var k=u.getLogger("esri.views.3d.state.Constraints");A=function(d){function q(a){a=d.call(this)||this;return a.collision=new t,a.distance=1/0,a.minimumPoiDistance=4,a}return w(q,d),Object.defineProperty(q.prototype,"altitude",{get:function(){return"local"===this.mode?null:this._get("altitude")||null},set:function(a){return"local"===this.mode?void k.warn("Altitude constraint is ignored in local scenes"):void this._set("altitude",a)},enumerable:!0,configurable:!0}),q.prototype.clampAltitude=function(c){return this.altitude?
a.clamp(c,this.altitude.min,this.altitude.max):c},q.prototype.clampTilt=function(c,d){if(!this.tilt)return d;c=this.tilt(c);return a.clamp(d,c.min,c.max)},q.prototype.clampDistance=function(a){return Math.min(a,this.distance)},q.prototype.createDefaultTilt=function(){return"local"===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()},q.prototype.createConstantMaxTilt=function(a){return function(d,k){return void 0===k&&(k=c),k.min=p.TiltDefault.min,k.max=a,k}},q.prototype.createDefaultTiltLocal=
function(){var d=a.makePiecewiseLinearFunction([[4E3,p.TiltDefault.max],[1E4,a.deg2rad(88)],[6E6,a.deg2rad(88)]]);return function(a,k){return void 0===k&&(k=c),k.min=p.TiltDefault.min,k.max=d(a),k}},q.prototype.createDefaultTiltGlobal=function(){var d=a.makePiecewiseLinearFunction([[4E3,p.TiltDefault.max],[5E4,a.deg2rad(88)],[6E6,a.deg2rad(88)],[2E7,p.TiltDefault.min]]);return function(a,k){return void 0===k&&(k=c),k.min=p.TiltDefault.min,k.max=d(a),k}},l([h.property()],q.prototype,"altitude",null),
l([h.property({readOnly:!0})],q.prototype,"collision",void 0),l([h.property()],q.prototype,"distance",void 0),l([h.property({readOnly:!0})],q.prototype,"minimumPoiDistance",void 0),l([h.property()],q.prototype,"tilt",void 0),l([h.property({constructOnly:!0})],q.prototype,"mode",void 0),q=l([h.subclass("esri.views.3d.state.Constraints")],q)}(h.declared(d));p.Constraints=A;p.AltitudeDefault={min:-r.earthRadius,max:4*r.earthRadius};p.TiltDefault={min:a.deg2rad(.5),max:a.deg2rad(179.5)};var c={min:0,
max:0},t=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;return c.enabled=!0,c.elevationMargin=5,c}return w(c,a),l([h.property({type:Boolean})],c.prototype,"enabled",void 0),l([h.property({type:Number})],c.prototype,"elevationMargin",void 0),c=l([h.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],c)}(h.declared(d));p["default"]=A})},"esri/views/3d/webgl-engine/lib/Camera":function(){define(["require","exports","./Util","./gl-matrix"],function(A,p,w,l){function h(a,
c){var d=c[0]-a[0],k=c[1]-a[1],b=c[2]-a[2];a=c[3]-a[3];return d*d+k*k+b*b+a*a}function d(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]}function u(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]}var r=l.vec3d,a=l.vec4d,k=l.mat4d;A=function(){function l(c,d,h){this._viewUp=r.create();this._viewForward=r.create();this._viewRight=r.create();this._viewport=a.create();this._padding=a.create();this._fov=55/180*Math.PI;this._near=0;this._far=1E3;this._viewDirty=!0;this._viewMatrix=k.create();
this._projectionDirty=!0;this._projectionMatrix=k.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=k.create();this._frustumPlanesDirty=!0;this._frustumPlanes=[a.create(),a.create(),a.create(),a.create(),a.create(),a.create()];this._fullViewport=null;this.aboveGround=!0;this._eye=r.create(c);this._center=r.create(d);void 0!==h?this._up=r.create(h):this._up=r.create([0,0,1]);this._padding=a.create()}return Object.defineProperty(l.prototype,"eye",{get:function(){return this._eye},
set:function(a){this._compareAndSetView(a,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"center",{get:function(){return this._center},set:function(a){this._compareAndSetView(a,this._center)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"up",{get:function(){return this._up},set:function(a){this._compareAndSetView(a,this._up)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"viewMatrix",{get:function(){return this._ensureViewClean(),
this._viewMatrix},set:function(a){k.set(a,this._viewMatrix);this._viewDirty=!1;this._frustumPlanesDirty=this._viewInverseTransposeMatrixDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"viewForward",{get:function(){return this._ensureViewClean(),this._viewForward},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"viewUp",{get:function(){return this._ensureViewClean(),this._viewUp},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"viewRight",
{get:function(){return this._ensureViewClean(),this._viewRight},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"near",{get:function(){return this._near},set:function(a){this._near!==a&&(this._near=a,this._projectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"far",{get:function(){return this._far},set:function(a){this._far!==a&&(this._far=a,this._projectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),
Object.defineProperty(l.prototype,"viewport",{get:function(){return this._viewport},set:function(a){this.x=a[0];this.y=a[1];this.width=a[2];this.height=a[3]},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"x",{get:function(){return this._viewport[0]},set:function(a){a+=this._padding[3];this._viewport[0]!==a&&(this._viewport[0]=a,this._projectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"y",{get:function(){return this._viewport[1]},
set:function(a){a+=this._padding[2];this._viewport[1]!==a&&(this._viewport[1]=a,this._projectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"width",{get:function(){return this._viewport[2]},set:function(a){this._viewport[2]!==a&&(this._viewport[2]=a,this._projectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"height",{get:function(){return this._viewport[3]},set:function(a){this._viewport[3]!==
a&&(this._viewport[3]=a,this._projectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(a){this.width=a-(this._padding[1]+this._padding[3])},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(a){this.height=a-(this._padding[0]+
this._padding[2])},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"fullViewport",{get:function(){return this._fullViewport||(this._fullViewport=a.create()),this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"aspect",{get:function(){return this.width/this.height},
enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"padding",{get:function(){return this._padding},set:function(c){(this._padding[0]!==c[0]||this._padding[1]!==c[1]||this._padding[2]!==c[2]||this._padding[3]!==c[3])&&(this._viewport[0]+=c[3]-this._padding[3],this._viewport[1]+=c[2]-this._padding[2],this._viewport[2]-=c[1]+c[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=c[0]+c[2]-(this._padding[0]+this._padding[2]),a.set(c,this._padding),this._projectionDirty=!0,this._frustumPlanesDirty=
!0)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var a=this.width,c=this.height,d=this.near*Math.tan(this.fovY/2),b=d*this.aspect;k.frustum(-b*(1+2*this._padding[3]/a),b*(1+2*this._padding[1]/a),-d*(1+2*this._padding[2]/c),d*(1+2*this._padding[0]/c),this.near,this.far,this._projectionMatrix);this._projectionDirty=!1}return this._projectionMatrix},set:function(a){k.set(a,this._projectionMatrix);this._projectionDirty=
!1;this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"fov",{get:function(){return this._fov},set:function(a){this._fov=a;this._frustumPlanesDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"fovX",{get:function(){return w.fovd2fovx(this._fov,this.width,this.height)},set:function(a){this._fov=w.fovx2fovd(a,this.width,this.height);this._frustumPlanesDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0}),
Object.defineProperty(l.prototype,"fovY",{get:function(){return w.fovd2fovy(this._fov,this.width,this.height)},set:function(a){this._fov=w.fovy2fovd(a,this.width,this.height);this._frustumPlanesDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"distance",{get:function(){return r.dist(this._center,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"frustumPoints",{get:function(){return this.computeFrustumPoints()},enumerable:!0,
configurable:!0}),Object.defineProperty(l.prototype,"frustumPlanes",{get:function(){return this._frustumPlanesDirty&&(this._frustumPlanes=this._computeFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1),this._frustumPlanes},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"viewInverseTransposeMatrix",{get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=k.create()),k.inverse(this.viewMatrix,
this._viewInverseTransposeMatrix),k.transpose(this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"perPixelRatio",{get:function(){return Math.tan(this.fovX/2)/this.width},enumerable:!0,configurable:!0}),l.prototype.copyFrom=function(c){return r.set(c._eye,this._eye),r.set(c._center,this._center),r.set(c._up,this._up),a.set(c._viewport,this._viewport),a.set(c._padding,this._padding),
this._near=c._near,this._far=c._far,this._fov=c._fov,this.aboveGround=c.aboveGround,c._viewDirty?this._viewDirty=!0:(k.set(c._viewMatrix,this._viewMatrix),r.set(c._viewRight,this._viewRight),r.set(c._viewUp,this._viewUp),r.set(c._viewForward,this._viewForward),this._viewDirty=!1),c._projectionDirty?this._projectionDirty=!0:(k.set(c._projectionMatrix,this._projectionMatrix),this._projectionDirty=!1),c._frustumPlanesDirty?this._frustumPlanesDirty=!0:(c.copyFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=
!1),c._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?k.set(c._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=k.create(c._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),c._fullViewport?this._fullViewport?a.set(c._fullViewport,this._fullViewport):this._fullViewport=a.create(c._fullViewport):this._fullViewport=null,this},l.prototype.copyViewFrom=function(a){this.eye=a.eye;
this.center=a.center;this.up=a.up},l.prototype.copy=function(){var a=new l;return a.copyFrom(this),a},l.prototype.equivalent=function(a){return d(this._eye,a._eye)&&d(this._center,a._center)&&d(this._up,a._up)&&u(this._viewport,a._viewport)&&u(this._padding,a._padding)&&this._near===a._near&&this._far===a._far&&this._fov===a._fov},l.prototype.almostEquals=function(a,c,d){void 0===d&&(d=!1);var b;c=r.dist(this._eye,this._center)*(c||5E-4);c*=c;return d?(r.direction(a._center,a._eye,C),r.direction(this._center,
this._eye,q),b=1E-10):(r.set(a._center,C),r.set(this._center,q),b=c),r.dist2(a._eye,this._eye)<c&&r.dist2(C,q)<b&&.001>Math.abs(a._fov-this._fov)&&.5>h(a._padding,this._padding)&&.5>h(a._viewport,this._viewport)},l.prototype.markViewDirty=function(){this._frustumPlanesDirty=this._viewDirty=!0},l.prototype.computePixelSizeAt=function(a){return this.computePixelSizeAtDist(r.dist(a,this._eye))},l.prototype.computePixelSizeAtDist=function(a){return 2*a*Math.tan(this.fovX/2)/this.width},l.prototype.computeDistanceFromRadius=
function(a,c){return a/Math.tan(Math.min(this.fovX,this.fovY)/(2*(c||1)))},l.prototype.copyFrustumPlanes=function(c){if(!c){c=Array(6);for(var d=0;6>d;++d)c[d]=a.create()}for(var k=this.frustumPlanes,d=0;6>d;d++)a.set(k[d],c[d]);return c},l.prototype.computeFrustumPoints=function(a){if(!a){a=Array(8);for(var c=0;8>c;++c)a[c]=r.create()}return w.matrix2frustum(this.viewMatrix,this.projectionMatrix,a),a},l.prototype.setGLViewport=function(a){var c=this.viewport,d=this.padding;a.setViewport(c[0]-d[3],
c[1]-d[2],c[2]+d[1]+d[3],c[3]+d[0]+d[2])},l.prototype.applyProjection=function(a,d,h){void 0===h&&(h=!1);a!==c&&r.set(a,c);c[3]=1;h&&(d[2]=-c[2]);k.multiplyVec4(this.projectionMatrix,c);r.scale(c,1/Math.abs(c[3]));a=this.fullViewport;return d[0]=w.lerp(0,a[0]+a[2],.5+.5*c[0]),d[1]=w.lerp(0,a[1]+a[3],.5+.5*c[1]),h||(d[2]=.5*(c[2]+1)),d},l.prototype.projectPoint=function(a,d,h){return void 0===h&&(h=!1),k.multiplyVec3(this.viewMatrix,a,c),this.applyProjection(c,d,h)},l.prototype.unprojectPoint=function(a,
d,h){if(void 0===h&&(h=!1),h)return console.error("Camera.unprojectPoint() not yet implemented for linear Z"),null;if(k.multiply(this.projectionMatrix,this.viewMatrix,t),!k.inverse(t))return null;h=this.fullViewport;return c[0]=2*(a[0]-h[0])/h[2]-1,c[1]=2*(a[1]-h[1])/h[3]-1,c[2]=2*a[2]-1,c[3]=1,k.multiplyVec4(t,c),0===c[3]?null:(d[0]=c[0]/c[3],d[1]=c[1]/c[3],d[2]=c[2]/c[3],d)},l.prototype.computeUp=function(a){"global"===a?this.computeUpGlobal():this.computeUpLocal()},l.prototype.computeUpGlobal=
function(){r.subtract(this.center,this.eye,C);var a=r.length(this.center);1>a?(r.set3(0,0,1,this.up),this.markViewDirty()):Math.abs(r.dot(C,this.center))>.9999*r.length(C)*a||(r.cross(C,this.center,this.up),r.cross(this.up,C,this.up),r.normalize(this.up),this.markViewDirty())},l.prototype.computeUpLocal=function(){r.direction(this.center,this.eye,C);.9999>=Math.abs(C[2])&&(r.scale(C,C[2]),r.set3(-C[0],-C[1],1-C[2],this.up),r.normalize(this.up),this.markViewDirty())},l.prototype._compareAndSetView=
function(a,c){d(a,c)||(r.set(a,c),this._viewDirty=!0,this._frustumPlanesDirty=!0)},l.prototype._computeFrustumPlanes=function(c){if(!c){c=Array(6);for(var d=0;6>d;++d)c[d]=a.create()}return w.matrix2frustumPlanes(this.viewMatrix,this.projectionMatrix,c),c},l.prototype._ensureViewClean=function(){this._viewDirty&&(k.lookAt(this._eye,this._center,this._up,this._viewMatrix),r.set3(-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10],this._viewForward),r.set3(this._viewMatrix[1],this._viewMatrix[5],
this._viewMatrix[9],this._viewUp),r.set3(this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8],this._viewRight),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)},l}();var c=a.create(),t=k.create(),C=r.create(),q=r.create();return A})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["require","exports","./gl-matrix"],function(A,p,w){function l(a,b){if(!a)throw a=Error("dummy"),a.stack&&console.log(a.stack),new S(b);}function h(a,b,c){return b>a?b:a>c?c:a}function d(a){return a/
180*Math.PI}function u(a){return 180*a/Math.PI}function r(a,b,c){w.mat4d.multiply(b,a,C);w.mat4d.inverse(C);for(a=0;8>a;++a)w.mat4d.multiplyVec4(C,q[a],v),w.vec3d.set3(v[0]/v[3],v[1]/v[3],v[2]/v[3],c[a])}function a(a,b,c,d){w.vec3d.subtract(a,b,B);w.vec3d.subtract(c,b,D);w.vec3d.cross(D,B,d);w.vec3d.normalize(d);d[3]=-w.vec3d.dot(d,a)}function k(a,b,c,d){var g=6378137/Math.sqrt(1-p.ECCENTRICITY_SQUARED*Math.pow(Math.sin(a),2)),e=Math.cos(a);d[0]=(g+c)*Math.cos(b)*e;d[1]=(g*(1-p.ECCENTRICITY_SQUARED)+
c)*Math.sin(a);d[2]=-(g+c)*Math.sin(b)*e}function c(a){for(var b in a)return b}function t(a,b){a[12]=b[0];a[13]=b[1];a[14]=b[2]}Object.defineProperty(p,"__esModule",{value:!0});var C=w.mat4d.create(),q=[w.vec4d.createFrom(-1,-1,-1,1),w.vec4d.createFrom(1,-1,-1,1),w.vec4d.createFrom(1,1,-1,1),w.vec4d.createFrom(-1,1,-1,1),w.vec4d.createFrom(-1,-1,1,1),w.vec4d.createFrom(1,-1,1,1),w.vec4d.createFrom(1,1,1,1),w.vec4d.createFrom(-1,1,1,1)],v=w.vec4d.create(),y=[w.vec3d.create(),w.vec3d.create(),w.vec3d.create(),
w.vec3d.create(),w.vec3d.create(),w.vec3d.create(),w.vec3d.create(),w.vec3d.create()],B=w.vec3d.create(),D=w.vec3d.create(),b=w.vec3d.create(),m=w.vec3d.create(),E=w.vec3d.create(),J=w.vec3d.create(),G=w.vec3d.create(),K=w.vec3d.create(),M=w.vec3d.create(),U=w.vec3d.create(),N=w.vec3d.create(),W=w.vec3d.create(),R=w.vec3d.create(),V=w.vec3d.create(),Q=w.vec3d.createFrom(0,0,0),S=function(){function a(a){this.message=a}return a.prototype.toString=function(){return"AssertException: "+this.message},
a}();p.AssertException=S;p.EARTH_RADIUS=6378137;p.METER2FEET=3.28084;p.ECCENTRICITY_SQUARED=.0066943799901414;p.VertexAttrConstants={POSITION:"position",NORMAL:"normal",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region"};p.assert=l;p.verify=function(a,b){a||(console.log("Verify failed: "+b),console.log(Error("dummy").stack))};p.createQuadVertexUvBuffer=function(a){void 0===a&&(a=Float32Array);a=new a(20);return a[0]=-1,a[1]=-1,a[2]=0,
a[3]=0,a[4]=0,a[5]=1,a[6]=-1,a[7]=0,a[8]=1,a[9]=0,a[10]=-1,a[11]=1,a[12]=0,a[13]=0,a[14]=1,a[15]=1,a[16]=1,a[17]=0,a[18]=1,a[19]=1,a};p.isPowerOfTwo=function(a){return 0===(a&a-1)};p.lerp=function(a,b,c){return a+(b-a)*c};p.clamp=h;p.fallbackIfUndefined=function(a,b){return void 0===a?b:a};p.hex2rgb=function(a){a=Math.floor(a);return[(a>>16&255)/255,(a>>8&255)/255,(255&a)/255]};p.rgb2hex=function(a){var b=h(Math.round(255*a[0]),0,255),c=h(Math.round(255*a[1]),0,255);a=h(Math.round(255*a[2]),0,255);
return"0x"+((b<<16)+(c<<8)+a).toString(16)};p.dec2hex=function(a){a=a.toString(16);return"00000000".substr(0,8-a.length)+a};p.deg2rad=d;p.rad2deg=u;p.azimuthElevationAngle2Direction=function(a,b){a=1.5*Math.PI-a;b=.5*Math.PI-b;return[Math.cos(a)*Math.sin(b),Math.cos(b),Math.sin(a)*Math.sin(b)]};p.rayPlane=function(a,b,c,d){var g=w.vec3d.dot(c,b);if(0===g)return!1;c=-(w.vec3d.dot(c,a)+c[3])/g;return w.vec3d.add(a,w.vec3d.scale(b,c,d),d),!0};p.raySphere=function(a,b,c,d,g){c=c||Q;var e=w.vec3d.subtract(a,
c,B);c=w.vec3d.dot(b,b);var f=2*w.vec3d.dot(b,e);d=w.vec3d.dot(e,e)-d*d;d=f*f-4*c*d;if(0>d)return!1;e=Math.sqrt(d);d=(-f-e)/(2*c);c=(-f+e)/(2*c);return(0>d||d>c&&0<c)&&(d=c),0<d?(w.vec3d.add(a,w.vec3d.scale(b,d,V),g),!0):!1};p.rayTriangle3D=function(a,b,c,d,g,e,f,m,k){void 0===k&&(k=w.vec3d.create());var n=d[f]-c[e],h=d[f+1]-c[e+1],l=d[f+2]-c[e+2];d=g[m]-c[e];f=g[m+1]-c[e+1];g=g[m+2]-c[e+2];var q=b[1]*g-f*b[2],v=b[2]*d-g*b[0],t=b[0]*f-d*b[1];m=n*q+h*v+l*t;if(-1E-5<m&&1E-5>m)return!1;m=1/m;var r=a[0]-
c[e],y=a[1]-c[e+1];a=a[2]-c[e+2];if(k[1]=m*(r*q+y*v+a*t),0>k[1]||1<k[1])return!1;c=y*l-h*a;a=a*n-l*r;n=r*h-n*y;return k[2]=m*(b[0]*c+b[1]*a+b[2]*n),0>k[2]||1<k[1]+k[2]?!1:(k[0]=m*(d*c+f*a+g*n),!0)};p.rayBoxTest=function(a,b,c,d){var g,e=(c[0]-a[0])/b[0],f=(d[0]-a[0])/b[0];e>f&&(g=e,e=f,f=g);var m=(c[1]-a[1])/b[1],k=(d[1]-a[1])/b[1];if(m>k&&(g=m,m=k,k=g),e>k||m>f)return!1;m>e&&(e=m);f>k&&(f=k);c=(c[2]-a[2])/b[2];a=(d[2]-a[2])/b[2];return c>a&&(g=c,c=a,a=g),e>a||c>f?!1:(f>a&&(f=a),0>f?!1:!0)};p.rayRay2D=
function(a,b,c,d,g,e){void 0===e&&(e=w.vec2d.create());var f=(d[g]-c[g])*(b[0]-a[0])-(d[0]-c[0])*(b[g]-a[g]);if(0===f)return!1;c=((d[0]-c[0])*(a[g]-c[g])-(d[g]-c[g])*(a[0]-c[0]))/f;return e[0]=a[0]+c*(b[0]-a[0]),e[1]=a[g]+c*(b[g]-a[g]),!0};p.matrix2frustum=r;p.matrix2frustumPlanes=function(b,c,d,m){void 0===m&&(m=d,d=y);r(b,c,d);a(d[4],d[0],d[3],m[0]);a(d[1],d[5],d[6],m[1]);a(d[4],d[5],d[1],m[2]);a(d[3],d[2],d[6],m[3]);a(d[0],d[1],d[2],m[4]);a(d[5],d[4],d[7],m[5])};p.point2plane=a;p.project=function(a,
b,c,d,g){g||(g=a);v[0]=a[0];v[1]=a[1];v[2]=a[2];v[3]=1;w.mat4d.multiplyVec4(b,v);2<g.length&&(g[2]=-v[2]);w.mat4d.multiplyVec4(c,v);l(0!==v[3]);g[0]=v[0]/v[3];g[1]=v[1]/v[3];g[2]=v[2]/v[3];g[0]=(.5*g[0]+.5)*d[2]+d[0];g[1]=(.5*g[1]+.5)*d[3]+d[1]};p.geodeticToGeocentricLatidude=function(a){return Math.atan((1-p.ECCENTRICITY_SQUARED)*Math.tan(a))};p.latLon2positionWGS84Ellipsoid=k;p.pos2latLon=function(a,b){var c=w.vec3d.length(a);b[0]=Math.asin(h(a[1]/c,-1,1));b[1]=(0>a[2]?1:-1)*Math.acos(h(a[0]/(Math.cos(b[0])*
c),-1,1));b[0]=u(b[0]);b[1]=u(b[1]);b[2]=c};p.pos2latLonWGS84Ellipsoid=function(a,b){var c=a[0],d=-a[2],g=a[1],e=Math.sqrt(Math.pow(6378137,2)*(1-p.ECCENTRICITY_SQUARED));a=Math.sqrt(Math.pow(c,2)+Math.pow(d,2));var f=Math.atan2(6378137*g,e*a),c=Math.atan2(d,c),d=Math.atan2(g+Math.pow(Math.sqrt((Math.pow(6378137,2)-Math.pow(e,2))/Math.pow(e,2)),2)*e*Math.pow(Math.sin(f),3),a-6378137*p.ECCENTRICITY_SQUARED*Math.pow(Math.cos(f),3));a=a/Math.cos(d)-6378137/Math.sqrt(1-p.ECCENTRICITY_SQUARED*Math.pow(Math.sin(d),
2))+p.EARTH_RADIUS;b[0]=d;b[1]=c;b[2]=a};p.computeGlobeTransformation=function(a,c,m){var h=d(a[0]);a=d(a[1]);return k(h,a,c,b),w.mat4d.translate(m,b),w.mat4d.rotateY(m,.5*Math.PI+a),w.mat4d.rotateX(m,.5*Math.PI-h),m};p.readUInt16=function(a,b){return a[b]+(a[b+1]<<8)};p.readUInt32=function(a,b){return a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24)};p.setIfDefined=function(a,b,c){void 0!==b[a]&&(c[a]=b[a])};p.array2object=function(a,b){var c={};if(void 0!==b)for(var d=0;d<a.length;d++){var g=a[d];c[b(g)]=
g}else for(b=0;b<a.length;b++)g=a[b],c[g]=g;return c};p.object2array=function(a){var b=[],c;for(c in a)b.push(a[c]);return b};p.mergeObjects=function(a,b,c){if(void 0===c&&(c={}),c!==a)for(var d in a)c[d]=a[d];if(c!==b)for(var g in b)c[g]=b[g];return c};p.subtractObjects=function(a,b){var c={},d;for(d in a)void 0===b[d]&&(c[d]=a[d]);return c};p.intersectObjects=function(a,b){var c={},d;for(d in a)void 0!==b[d]&&(c[d]=a[d]);return c};p.getFirstObjectKey=c;p.getFirstObjectValue=function(a){return a[c(a)]};
p.objectEmpty=function(a){for(var b in a)return!1;return!0};p.arraysEqual=function(a,b){if(a.length!==b.length)return!1;for(var c=0,d=a.length;d>c;++c)if(a[c]!==b[c])return!1;return!0};p.arrayRemove=function(a,b){var c=a.indexOf(b);return-1!==c?(a[c]=a[a.length-1],a.pop(),b):null};p.byteBuffer2base64image=function(a,b,c,d,g){var e=4*b;l(a.length===e*c,"buffer length must match image resolution");var f=document.createElement("canvas");f.width=b;f.height=c;var m=f.getContext("2d");b=m.getImageData(0,
0,b,c);for(var k=b.data,h=0;c>h;++h)for(var q=h*e,v=(c-1-h)*e,t=0;e>t;++t)k[q++]=a[v++];return m.putImageData(b,0,0),f.toDataURL(d,g)};p.cround=function(a){return Math.round(100*a)/100};p.logWithBase=function(a,b){return Math.log(a)/Math.log(b)};p.setMatrixTranslation=t;p.setMatrixTranslation3=function(a,b,c,d){a[12]=b;a[13]=c;a[14]=d};p.getMatrixTranslation=function(a,b){return void 0===b&&(b=w.vec3d.create()),b[0]=a[12],b[1]=a[13],b[2]=a[14],b};p.createTranslationMatrix=function(a,b){return a=w.mat4d.identity(a),
t(a,b),a};p.fovx2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/b)};p.fovy2fovx=function(a,b,c){return 2*Math.atan(b*Math.tan(.5*a)/c)};p.fovx2fovd=function(a,b,c){return 2*Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*a)/b)};p.fovy2fovd=function(a,b,c){return 2*Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*a)/c)};p.fovd2fovx=function(a,b,c){return 2*Math.atan(b*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};p.fovd2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};p.nextHighestPowerOfTwo=
function(a){--a;for(var b=1;32>b;b<<=1)a|=a>>b;return a+1};p.nextHighestPowerOfTen=function(a){return Math.pow(10,Math.ceil(Math.LOG10E*Math.log(a)))};p.lineSegmentLineSegmentDistance3D=function(a,b,c,d){var g,e,f,n,k,l;if((m[0]=a[0]-c[0],m[1]=a[1]-c[1],m[2]=a[2]-c[2],E[0]=d[0]-c[0],E[1]=d[1]-c[1],E[2]=d[2]-c[2],1E-4>Math.abs(E[0])&&1E-4>Math.abs(E[1])&&1E-4>Math.abs(E[2]))||(J[0]=b[0]-a[0],J[1]=b[1]-a[1],J[2]=b[2]-a[2],1E-4>Math.abs(J[0])&&1E-4>Math.abs(J[1])&&1E-4>Math.abs(J[2]))||(g=m[0]*E[0]+
m[1]*E[1]+m[2]*E[2],e=E[0]*J[0]+E[1]*J[1]+E[2]*J[2],f=m[0]*J[0]+m[1]*J[1]+m[2]*J[2],n=E[0]*E[0]+E[1]*E[1]+E[2]*E[2],k=J[0]*J[0]+J[1]*J[1]+J[2]*J[2],l=k*n-e*e,1E-4>Math.abs(l)))return[!1];b=h((g*e-f*n)/l,0,1);g=h((g+e*b)/n,0,1);G[0]=a[0]+b*J[0];G[1]=a[1]+b*J[1];G[2]=a[2]+b*J[2];K[0]=c[0]+g*E[0];K[1]=c[1]+g*E[1];K[2]=c[2]+g*E[2];return[!0,w.vec3d.dist(G,K),G,K]};p.pointLineSegmentDistance2D=function(a,b,c){W[0]=b[0]-a[0];W[1]=b[1]-a[1];W[2]=0;R[0]=c[0]-a[0];R[1]=c[1]-a[1];R[2]=0;V[0]=c[0];V[1]=c[1];
V[2]=0;b=w.vec3d.dot(R,W);c=w.vec3d.length(W);b=h(b/(c*c),0,1);N[0]=W[0]*b;N[1]=W[1]*b;M[0]=a[0]+N[0];M[1]=a[1]+N[1];w.vec3d.subtract(V,M,U);a=w.vec3d.length(U);b=w.vec3d.length(R);c=w.vec3d.length(W);var d=w.vec3d.length(N);return(d>b||d>c)&&(a=Number.MAX_VALUE),a};A=function(){var a=window.performance||{};if(a.now)return function(){return a.now()};if(a.webkitNow)return function(){return a.webkitNow()};if(a.mozNow)return function(){return a.mozNow()};if(a.msNow)return function(){return a.msNow()};
if(a.oNow)return function(){return a.oNow()};var b;return b=a.timing&&a.timing.navigationStart?a.timing.navigationStart:Date.now(),function(){return Date.now()-b}}();p.performance={now:A}})},"esri/views/3d/webgl-engine/lib/gl-matrix":function(){define([],function(){var A={};return function(p,w){w(p,!0);w(p,!1)}(A,function(p,w){var l={};!function(){if("undefined"!=typeof Float32Array){var a=new Float32Array(1),c=new Int32Array(a.buffer);l.invsqrt=function(b){a[0]=b;c[0]=1597463007-(c[0]>>1);var d=
a[0];return d*(1.5-.5*b*d*d)}}else l.invsqrt=function(a){return 1/Math.sqrt(a)}}();var h=Array;"undefined"!=typeof Float32Array&&(h=w?Float32Array:Array);var d={create:function(a){var b=new h(3);return a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):b[0]=b[1]=b[2]=0,b},createFrom:function(a,c,d){var b=new h(3);return b[0]=a,b[1]=c,b[2]=d,b},set:function(a,c){return c[0]=a[0],c[1]=a[1],c[2]=a[2],c},set3:function(a,c,d,k){return k[0]=a,k[1]=c,k[2]=d,k},add:function(a,c,d){return d&&a!==d?(d[0]=a[0]+c[0],d[1]=a[1]+
c[1],d[2]=a[2]+c[2],d):(a[0]+=c[0],a[1]+=c[1],a[2]+=c[2],a)},subtract:function(a,c,d){return d&&a!==d?(d[0]=a[0]-c[0],d[1]=a[1]-c[1],d[2]=a[2]-c[2],d):(a[0]-=c[0],a[1]-=c[1],a[2]-=c[2],a)},multiply:function(a,c,d){return d&&a!==d?(d[0]=a[0]*c[0],d[1]=a[1]*c[1],d[2]=a[2]*c[2],d):(a[0]*=c[0],a[1]*=c[1],a[2]*=c[2],a)},max:function(a,c,d){return d[0]=Math.max(a[0],c[0]),d[1]=Math.max(a[1],c[1]),d[2]=Math.max(a[2],c[2]),d},min:function(a,c,d){return d[0]=Math.min(a[0],c[0]),d[1]=Math.min(a[1],c[1]),d[2]=
Math.min(a[2],c[2]),d},negate:function(a,c){return c||(c=a),c[0]=-a[0],c[1]=-a[1],c[2]=-a[2],c},scale:function(a,c,d){return d&&a!==d?(d[0]=a[0]*c,d[1]=a[1]*c,d[2]=a[2]*c,d):(a[0]*=c,a[1]*=c,a[2]*=c,a)},normalize:function(a,c){c||(c=a);var b=a[0],d=a[1];a=a[2];var m=Math.sqrt(b*b+d*d+a*a);return m?1===m?(c[0]=b,c[1]=d,c[2]=a,c):(m=1/m,c[0]=b*m,c[1]=d*m,c[2]=a*m,c):(c[0]=0,c[1]=0,c[2]=0,c)},cross:function(a,c,d){d||(d=a);var b=a[0],m=a[1];a=a[2];var k=c[0],h=c[1];c=c[2];return d[0]=m*c-a*h,d[1]=a*
k-b*c,d[2]=b*h-m*k,d},length:function(a){var b=a[0],c=a[1];a=a[2];return Math.sqrt(b*b+c*c+a*a)},length2:function(a){var b=a[0],c=a[1];a=a[2];return b*b+c*c+a*a},dot:function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]},direction:function(a,c,d){d||(d=a);var b=a[0]-c[0],m=a[1]-c[1];a=a[2]-c[2];return(c=Math.sqrt(b*b+m*m+a*a))?(c=1/c,d[0]=b*c,d[1]=m*c,d[2]=a*c,d):(d[0]=0,d[1]=0,d[2]=0,d)},lerp:function(a,c,d,k){return k||(k=a),k[0]=a[0]+d*(c[0]-a[0]),k[1]=a[1]+d*(c[1]-a[1]),k[2]=a[2]+d*(c[2]-a[2]),k},
dist:function(a,c){var b=c[0]-a[0],d=c[1]-a[1];a=c[2]-a[2];return Math.sqrt(b*b+d*d+a*a)},dist2:function(a,c){var b=c[0]-a[0],d=c[1]-a[1];a=c[2]-a[2];return b*b+d*d+a*a}},u=null,r=new h(4);d.unproject=function(a,c,d,k,h){h||(h=a);u||(u=v.create());var b=u;return r[0]=2*(a[0]-k[0])/k[2]-1,r[1]=2*(a[1]-k[1])/k[3]-1,r[2]=2*a[2]-1,r[3]=1,v.multiply(d,c,b),v.inverse(b)?(v.multiplyVec4(b,r),0===r[3]?null:(h[0]=r[0]/r[3],h[1]=r[1]/r[3],h[2]=r[2]/r[3],h)):null};var a=d.createFrom(1,0,0),k=d.createFrom(0,
1,0),c=d.createFrom(0,0,1);d.rotationTo=function(b,m,h){h||(h=y.create());var l=d.dot(b,m),q=d.create();if(1<=l)y.set(B,h);else if(-.999999>l)d.cross(a,b,q),1E-6>q.length&&d.cross(k,b,q),1E-6>q.length&&d.cross(c,b,q),d.normalize(q),y.fromAxisAngle(q,Math.PI,h);else{var l=Math.sqrt(2*(1+l)),v=1/l;d.cross(b,m,q);h[0]=q[0]*v;h[1]=q[1]*v;h[2]=q[2]*v;h[3]=.5*l;y.normalize(h)}return 1<h[3]?h[3]=1:-1>h[3]&&(h[3]=-1),h};var t=d.create(),C=d.create();d.project=function(a,c,k,h){h||(h=a);d.direction(c,k,t);
d.subtract(a,c,C);a=d.dot(t,C);d.scale(t,a,h);d.add(h,c,h)};d.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};var q={create:function(a){var b=new h(9);return a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8]):b[0]=b[1]=b[2]=b[3]=b[4]=b[5]=b[6]=b[7]=b[8]=0,b},createFrom:function(a,c,d,k,l,q,v,t,r){var b=new h(9);return b[0]=a,b[1]=c,b[2]=d,b[3]=k,b[4]=l,b[5]=q,b[6]=v,b[7]=t,b[8]=r,b},determinant:function(a){var b=a[3],c=a[4],d=a[5],k=a[6],h=a[7],l=
a[8];return a[0]*(l*c-d*h)+a[1]*(-l*b+d*k)+a[2]*(h*b-c*k)},inverse:function(a,c){var b,d=a[0],m=a[1],k=a[2],h=a[3],l=a[4],v=a[5],t=a[6],r=a[7];a=a[8];var y=a*l-v*r,B=-a*h+v*t,u=r*h-l*t,C=d*y+m*B+k*u;return C?(b=1/C,c||(c=q.create()),c[0]=y*b,c[1]=(-a*m+k*r)*b,c[2]=(v*m-k*l)*b,c[3]=B*b,c[4]=(a*d-k*t)*b,c[5]=(-v*d+k*h)*b,c[6]=u*b,c[7]=(-r*d+m*t)*b,c[8]=(l*d-m*h)*b,c):null},multiply:function(a,c,d){d||(d=a);var b=a[0],m=a[1],k=a[2],h=a[3],l=a[4],q=a[5],v=a[6],t=a[7];a=a[8];var r=c[0],y=c[1],B=c[2],u=
c[3],E=c[4],C=c[5],D=c[6],g=c[7];c=c[8];return d[0]=r*b+y*h+B*v,d[1]=r*m+y*l+B*t,d[2]=r*k+y*q+B*a,d[3]=u*b+E*h+C*v,d[4]=u*m+E*l+C*t,d[5]=u*k+E*q+C*a,d[6]=D*b+g*h+c*v,d[7]=D*m+g*l+c*t,d[8]=D*k+g*q+c*a,d},multiplyVec2:function(a,c,d){d||(d=c);var b=c[0];c=c[1];return d[0]=b*a[0]+c*a[3]+a[6],d[1]=b*a[1]+c*a[4]+a[7],d},multiplyVec3:function(a,c,d){d||(d=c);var b=c[0],m=c[1];c=c[2];return d[0]=b*a[0]+m*a[3]+c*a[6],d[1]=b*a[1]+m*a[4]+c*a[7],d[2]=b*a[2]+m*a[5]+c*a[8],d},set:function(a,c){return c[0]=a[0],
c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[8]=a[8],c},identity:function(a){return a||(a=q.create()),a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},transpose:function(a,c){if(!c||a===c){c=a[1];var b=a[2],d=a[5];return a[1]=a[3],a[2]=a[6],a[3]=c,a[5]=a[7],a[6]=b,a[7]=d,a}return c[0]=a[0],c[1]=a[3],c[2]=a[6],c[3]=a[1],c[4]=a[4],c[5]=a[7],c[6]=a[2],c[7]=a[5],c[8]=a[8],c},toMat4:function(a,c){return c||(c=v.create()),c[15]=1,c[14]=0,c[13]=0,c[12]=0,c[11]=
0,c[10]=a[8],c[9]=a[7],c[8]=a[6],c[7]=0,c[6]=a[5],c[5]=a[4],c[4]=a[3],c[3]=0,c[2]=a[2],c[1]=a[1],c[0]=a[0],c},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+"]"}},v={create:function(a){var b=new h(16);return 4===arguments.length?(b[0]=arguments[0],b[1]=arguments[1],b[2]=arguments[2],b[3]=arguments[3],b[4]=arguments[4],b[5]=arguments[5],b[6]=arguments[6],b[7]=arguments[7],b[8]=arguments[8],b[9]=arguments[9],b[10]=arguments[10],b[11]=arguments[11],
b[12]=arguments[12],b[13]=arguments[13],b[14]=arguments[14],b[15]=arguments[15]):a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]),b},createFrom:function(a,c,d,k,l,q,v,t,r,y,B,u,C,D,p,z){var b=new h(16);return b[0]=a,b[1]=c,b[2]=d,b[3]=k,b[4]=l,b[5]=q,b[6]=v,b[7]=t,b[8]=r,b[9]=y,b[10]=B,b[11]=u,b[12]=C,b[13]=D,b[14]=p,b[15]=z,b},createFromMatrixRowMajor:function(a){var b=
new h(16);return b[0]=a[0],b[4]=a[1],b[8]=a[2],b[12]=a[3],b[1]=a[4],b[5]=a[5],b[9]=a[6],b[13]=a[7],b[2]=a[8],b[6]=a[9],b[10]=a[10],b[14]=a[11],b[3]=a[12],b[7]=a[13],b[11]=a[14],b[15]=a[15],b},createFromMatrix:function(a){var b=new h(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},set:function(a,c){return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=a[4],c[5]=a[5],
c[6]=a[6],c[7]=a[7],c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c},setRowMajor:function(a,c){return c[0]=a[0],c[4]=a[1],c[8]=a[2],c[12]=a[3],c[1]=a[4],c[5]=a[5],c[9]=a[6],c[13]=a[7],c[2]=a[8],c[6]=a[9],c[10]=a[10],c[14]=a[11],c[3]=a[12],c[7]=a[13],c[11]=a[14],c[15]=a[15],c},identity:function(a){return a||(a=v.create()),a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},transpose:function(a,
c){if(!c||a===c){c=a[1];var b=a[2],d=a[3],m=a[6],k=a[7],h=a[11];return a[1]=a[4],a[2]=a[8],a[3]=a[12],a[4]=c,a[6]=a[9],a[7]=a[13],a[8]=b,a[9]=m,a[11]=a[14],a[12]=d,a[13]=k,a[14]=h,a}return c[0]=a[0],c[1]=a[4],c[2]=a[8],c[3]=a[12],c[4]=a[1],c[5]=a[5],c[6]=a[9],c[7]=a[13],c[8]=a[2],c[9]=a[6],c[10]=a[10],c[11]=a[14],c[12]=a[3],c[13]=a[7],c[14]=a[11],c[15]=a[15],c},determinant:function(a){var b=a[0],c=a[1],d=a[2],k=a[3],h=a[4],l=a[5],q=a[6],v=a[7],t=a[8],r=a[9],y=a[10],B=a[11],u=a[12],C=a[13],D=a[14];
a=a[15];return u*r*q*k-t*C*q*k-u*l*y*k+h*C*y*k+t*l*D*k-h*r*D*k-u*r*d*v+t*C*d*v+u*c*y*v-b*C*y*v-t*c*D*v+b*r*D*v+u*l*d*B-h*C*d*B-u*c*q*B+b*C*q*B+h*c*D*B-b*l*D*B-t*l*d*a+h*r*d*a+t*c*q*a-b*r*q*a-h*c*y*a+b*l*y*a},inverse:function(a,c){c||(c=a);var b,d=a[0],m=a[1],k=a[2],h=a[3],l=a[4],q=a[5],v=a[6],t=a[7],r=a[8],y=a[9],B=a[10],u=a[11],C=a[12],D=a[13],p=a[14];a=a[15];var g=d*q-m*l,e=d*v-k*l,f=d*t-h*l,n=m*v-k*q,x=m*t-h*q,w=k*t-h*v,L=r*D-y*C,A=r*p-B*C,Y=r*a-u*C,fa=y*p-B*D,ga=y*a-u*D,ia=B*a-u*p,na=g*ia-e*ga+
f*fa+n*Y-x*A+w*L;return na?(b=1/na,c[0]=(q*ia-v*ga+t*fa)*b,c[1]=(-m*ia+k*ga-h*fa)*b,c[2]=(D*w-p*x+a*n)*b,c[3]=(-y*w+B*x-u*n)*b,c[4]=(-l*ia+v*Y-t*A)*b,c[5]=(d*ia-k*Y+h*A)*b,c[6]=(-C*w+p*f-a*e)*b,c[7]=(r*w-B*f+u*e)*b,c[8]=(l*ga-q*Y+t*L)*b,c[9]=(-d*ga+m*Y-h*L)*b,c[10]=(C*x-D*f+a*g)*b,c[11]=(-r*x+y*f-u*g)*b,c[12]=(-l*fa+q*A-v*L)*b,c[13]=(d*fa-m*A+k*L)*b,c[14]=(-C*n+D*e-p*g)*b,c[15]=(r*n-y*e+B*g)*b,c):null},toRotationMat:function(a,c){return c||(c=v.create()),c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=
a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},toMat3:function(a,c){return c||(c=q.create()),c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[4],c[4]=a[5],c[5]=a[6],c[6]=a[8],c[7]=a[9],c[8]=a[10],c},toInverseMat3:function(a,c){var b,d=a[0],m=a[1],k=a[2],h=a[4],l=a[5],v=a[6],t=a[8],r=a[9];a=a[10];var y=a*l-v*r,B=-a*h+v*t,u=r*h-l*t,C=d*y+m*B+k*u;return C?(b=1/C,c||(c=q.create()),c[0]=y*b,c[1]=(-a*m+k*r)*b,c[2]=(v*m-k*l)*b,c[3]=B*b,c[4]=(a*d-k*t)*
b,c[5]=(-v*d+k*h)*b,c[6]=u*b,c[7]=(-r*d+m*t)*b,c[8]=(l*d-m*h)*b,c):null},multiply:function(a,c,d){d||(d=a);var b=a[0],m=a[1],k=a[2],h=a[3],l=a[4],q=a[5],v=a[6],t=a[7],r=a[8],y=a[9],B=a[10],u=a[11],E=a[12],C=a[13],D=a[14];a=a[15];var g=c[0],e=c[1],f=c[2],n=c[3],x=c[4],p=c[5],w=c[6],A=c[7],Y=c[8],fa=c[9],ga=c[10],ia=c[11],na=c[12],ka=c[13],wa=c[14];c=c[15];return d[0]=g*b+e*l+f*r+n*E,d[1]=g*m+e*q+f*y+n*C,d[2]=g*k+e*v+f*B+n*D,d[3]=g*h+e*t+f*u+n*a,d[4]=x*b+p*l+w*r+A*E,d[5]=x*m+p*q+w*y+A*C,d[6]=x*k+p*
v+w*B+A*D,d[7]=x*h+p*t+w*u+A*a,d[8]=Y*b+fa*l+ga*r+ia*E,d[9]=Y*m+fa*q+ga*y+ia*C,d[10]=Y*k+fa*v+ga*B+ia*D,d[11]=Y*h+fa*t+ga*u+ia*a,d[12]=na*b+ka*l+wa*r+c*E,d[13]=na*m+ka*q+wa*y+c*C,d[14]=na*k+ka*v+wa*B+c*D,d[15]=na*h+ka*t+wa*u+c*a,d},multiplyVec3:function(a,c,d){d||(d=c);var b=c[0],m=c[1];c=c[2];return d[0]=a[0]*b+a[4]*m+a[8]*c+a[12],d[1]=a[1]*b+a[5]*m+a[9]*c+a[13],d[2]=a[2]*b+a[6]*m+a[10]*c+a[14],d},multiplyVec4:function(a,c,d){d||(d=c);var b=c[0],m=c[1],k=c[2];c=c[3];return d[0]=a[0]*b+a[4]*m+a[8]*
k+a[12]*c,d[1]=a[1]*b+a[5]*m+a[9]*k+a[13]*c,d[2]=a[2]*b+a[6]*m+a[10]*k+a[14]*c,d[3]=a[3]*b+a[7]*m+a[11]*k+a[15]*c,d},translate:function(a,c,d){var b,m,k,h,l,q,v,t,r,y,B,u,E=c[0],C=c[1];c=c[2];return d&&a!==d?(b=a[0],m=a[1],k=a[2],h=a[3],l=a[4],q=a[5],v=a[6],t=a[7],r=a[8],y=a[9],B=a[10],u=a[11],d[0]=b,d[1]=m,d[2]=k,d[3]=h,d[4]=l,d[5]=q,d[6]=v,d[7]=t,d[8]=r,d[9]=y,d[10]=B,d[11]=u,d[12]=b*E+l*C+r*c+a[12],d[13]=m*E+q*C+y*c+a[13],d[14]=k*E+v*C+B*c+a[14],d[15]=h*E+t*C+u*c+a[15],d):(a[12]=a[0]*E+a[4]*C+
a[8]*c+a[12],a[13]=a[1]*E+a[5]*C+a[9]*c+a[13],a[14]=a[2]*E+a[6]*C+a[10]*c+a[14],a[15]=a[3]*E+a[7]*C+a[11]*c+a[15],a)},scale:function(a,c,d){var b=c[0],m=c[1];c=c[2];return d&&a!==d?(d[0]=a[0]*b,d[1]=a[1]*b,d[2]=a[2]*b,d[3]=a[3]*b,d[4]=a[4]*m,d[5]=a[5]*m,d[6]=a[6]*m,d[7]=a[7]*m,d[8]=a[8]*c,d[9]=a[9]*c,d[10]=a[10]*c,d[11]=a[11]*c,d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15],d):(a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,a[4]*=m,a[5]*=m,a[6]*=m,a[7]*=m,a[8]*=c,a[9]*=c,a[10]*=c,a[11]*=c,a)},maxScale:function(a){return Math.max(Math.max(Math.sqrt(a[0]*
a[0]+a[4]*a[4]+a[8]*a[8]),Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])),Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))},rotate:function(a,c,d,k){var b,m,h,l,q,v,t,r,y,B,u,C,E,D,g,e,f,n,x,p,w,J,A,fa,ga=d[0],ia=d[1];d=d[2];var na=Math.sqrt(ga*ga+ia*ia+d*d);return na?(1!==na&&(na=1/na,ga*=na,ia*=na,d*=na),b=Math.sin(c),m=Math.cos(c),h=1-m,l=a[0],q=a[1],v=a[2],t=a[3],r=a[4],y=a[5],B=a[6],u=a[7],C=a[8],E=a[9],D=a[10],g=a[11],e=ga*ga*h+m,f=ia*ga*h+d*b,n=d*ga*h-ia*b,x=ga*ia*h-d*b,p=ia*ia*h+m,w=d*ia*h+ga*b,J=ga*
d*h+ia*b,A=ia*d*h-ga*b,fa=d*d*h+m,k?a!==k&&(k[12]=a[12],k[13]=a[13],k[14]=a[14],k[15]=a[15]):k=a,k[0]=l*e+r*f+C*n,k[1]=q*e+y*f+E*n,k[2]=v*e+B*f+D*n,k[3]=t*e+u*f+g*n,k[4]=l*x+r*p+C*w,k[5]=q*x+y*p+E*w,k[6]=v*x+B*p+D*w,k[7]=t*x+u*p+g*w,k[8]=l*J+r*A+C*fa,k[9]=q*J+y*A+E*fa,k[10]=v*J+B*A+D*fa,k[11]=t*J+u*A+g*fa,k):null},rotateX:function(a,c,d){var b=Math.sin(c);c=Math.cos(c);var m=a[4],k=a[5],h=a[6],l=a[7],q=a[8],v=a[9],t=a[10],r=a[11];return d?a!==d&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],d[12]=a[12],
d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a,d[4]=m*c+q*b,d[5]=k*c+v*b,d[6]=h*c+t*b,d[7]=l*c+r*b,d[8]=m*-b+q*c,d[9]=k*-b+v*c,d[10]=h*-b+t*c,d[11]=l*-b+r*c,d},rotateY:function(a,c,d){var b=Math.sin(c);c=Math.cos(c);var m=a[0],k=a[1],h=a[2],l=a[3],q=a[8],v=a[9],t=a[10],r=a[11];return d?a!==d&&(d[4]=a[4],d[5]=a[5],d[6]=a[6],d[7]=a[7],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a,d[0]=m*c+q*-b,d[1]=k*c+v*-b,d[2]=h*c+t*-b,d[3]=l*c+r*-b,d[8]=m*b+q*c,d[9]=k*b+v*c,d[10]=h*b+t*c,d[11]=l*b+r*c,d},rotateZ:function(a,
c,d){var b=Math.sin(c);c=Math.cos(c);var m=a[0],k=a[1],h=a[2],l=a[3],q=a[4],v=a[5],t=a[6],r=a[7];return d?a!==d&&(d[8]=a[8],d[9]=a[9],d[10]=a[10],d[11]=a[11],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a,d[0]=m*c+q*b,d[1]=k*c+v*b,d[2]=h*c+t*b,d[3]=l*c+r*b,d[4]=m*-b+q*c,d[5]=k*-b+v*c,d[6]=h*-b+t*c,d[7]=l*-b+r*c,d},frustum:function(a,c,d,k,h,l,q){q||(q=v.create());var b=c-a,m=k-d,t=l-h;return q[0]=2*h/b,q[1]=0,q[2]=0,q[3]=0,q[4]=0,q[5]=2*h/m,q[6]=0,q[7]=0,q[8]=(c+a)/b,q[9]=(k+d)/m,q[10]=-(l+
h)/t,q[11]=-1,q[12]=0,q[13]=0,q[14]=-(l*h*2)/t,q[15]=0,q},perspective:function(a,c,d,k,h){a=d*Math.tan(a*Math.PI/360);c*=a;return v.frustum(-c,c,-a,a,d,k,h)},ortho:function(a,c,d,k,h,l,q){q||(q=v.create());var b=c-a,m=k-d,t=l-h;return q[0]=2/b,q[1]=0,q[2]=0,q[3]=0,q[4]=0,q[5]=2/m,q[6]=0,q[7]=0,q[8]=0,q[9]=0,q[10]=-2/t,q[11]=0,q[12]=-(a+c)/b,q[13]=-(k+d)/m,q[14]=-(l+h)/t,q[15]=1,q},lookAt:function(a,c,d,k){k||(k=v.create());var b,m,h,l,q,t,r,y,B,u,C=a[0],E=a[1];a=a[2];var D=d[0],p=d[1];d=d[2];var g=
c[0],e=c[1];c=c[2];return C===g&&E===e&&a===c?v.identity(k):(r=C-g,y=E-e,B=a-c,u=1/Math.sqrt(r*r+y*y+B*B),r*=u,y*=u,B*=u,b=p*B-d*y,m=d*r-D*B,h=D*y-p*r,u=Math.sqrt(b*b+m*m+h*h),u?(u=1/u,b*=u,m*=u,h*=u):(b=0,m=0,h=0),l=y*h-B*m,q=B*b-r*h,t=r*m-y*b,u=Math.sqrt(l*l+q*q+t*t),u?(u=1/u,l*=u,q*=u,t*=u):(l=0,q=0,t=0),k[0]=b,k[1]=l,k[2]=r,k[3]=0,k[4]=m,k[5]=q,k[6]=y,k[7]=0,k[8]=h,k[9]=t,k[10]=B,k[11]=0,k[12]=-(b*C+m*E+h*a),k[13]=-(l*C+q*E+t*a),k[14]=-(r*C+y*E+B*a),k[15]=1,k)},fromRotationTranslation:function(a,
c,d){d||(d=v.create());var b=a[0],m=a[1],k=a[2],h=a[3],l=b+b,q=m+m,t=k+k;a=b*l;var r=b*q,b=b*t,y=m*q,m=m*t,k=k*t,l=h*l,q=h*q,h=h*t;return d[0]=1-(y+k),d[1]=r+h,d[2]=b-q,d[3]=0,d[4]=r-h,d[5]=1-(a+k),d[6]=m+l,d[7]=0,d[8]=b+q,d[9]=m-l,d[10]=1-(a+y),d[11]=0,d[12]=c[0],d[13]=c[1],d[14]=c[2],d[15]=1,d},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"}},y={create:function(a){var b=
new h(4);return a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):b[0]=b[1]=b[2]=b[3]=0,b},createFrom:function(a,c,d,k){var b=new h(4);return b[0]=a,b[1]=c,b[2]=d,b[3]=k,b},set:function(a,c){return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c},identity:function(a){return a||(a=y.create()),a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}},B=y.identity();y.calculateW=function(a,c){var b=a[0],d=a[1],m=a[2];return c&&a!==c?(c[0]=b,c[1]=d,c[2]=m,c[3]=-Math.sqrt(Math.abs(1-b*b-d*d-m*m)),c):(a[3]=-Math.sqrt(Math.abs(1-b*b-d*d-m*m)),
a)};y.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};y.inverse=function(a,c){var b=a[0],d=a[1],m=a[2],k=a[3],b=(b=b*b+d*d+m*m+k*k)?1/b:0;return c&&a!==c?(c[0]=-a[0]*b,c[1]=-a[1]*b,c[2]=-a[2]*b,c[3]=a[3]*b,c):(a[0]*=-b,a[1]*=-b,a[2]*=-b,a[3]*=b,a)};y.conjugate=function(a,c){return c&&a!==c?(c[0]=-a[0],c[1]=-a[1],c[2]=-a[2],c[3]=a[3],c):(a[0]*=-1,a[1]*=-1,a[2]*=-1,a)};y.length=function(a){var b=a[0],c=a[1],d=a[2];a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)};y.normalize=function(a,c){c||
(c=a);var b=a[0],d=a[1],m=a[2];a=a[3];var k=Math.sqrt(b*b+d*d+m*m+a*a);return 0===k?(c[0]=0,c[1]=0,c[2]=0,c[3]=0,c):(k=1/k,c[0]=b*k,c[1]=d*k,c[2]=m*k,c[3]=a*k,c)};y.add=function(a,c,d){return d&&a!==d?(d[0]=a[0]+c[0],d[1]=a[1]+c[1],d[2]=a[2]+c[2],d[3]=a[3]+c[3],d):(a[0]+=c[0],a[1]+=c[1],a[2]+=c[2],a[3]+=c[3],a)};y.multiply=function(a,c,d){d||(d=a);var b=a[0],m=a[1],k=a[2];a=a[3];var h=c[0],l=c[1],q=c[2];c=c[3];return d[0]=b*c+a*h+m*q-k*l,d[1]=m*c+a*l+k*h-b*q,d[2]=k*c+a*q+b*l-m*h,d[3]=a*c-b*h-m*l-
k*q,d};y.multiplyVec3=function(a,c,d){d||(d=c);var b=c[0],m=c[1],k=c[2];c=a[0];var h=a[1],l=a[2];a=a[3];var q=a*b+h*k-l*m,v=a*m+l*b-c*k,t=a*k+c*m-h*b,b=-c*b-h*m-l*k;return d[0]=q*a+b*-c+v*-l-t*-h,d[1]=v*a+b*-h+t*-c-q*-l,d[2]=t*a+b*-l+q*-h-v*-c,d};y.scale=function(a,c,d){return d&&a!==d?(d[0]=a[0]*c,d[1]=a[1]*c,d[2]=a[2]*c,d[3]=a[3]*c,d):(a[0]*=c,a[1]*=c,a[2]*=c,a[3]*=c,a)};y.toMat3=function(a,c){c||(c=q.create());var b=a[0],d=a[1],m=a[2],k=a[3],h=b+b,l=d+d,v=m+m;a=b*h;var t=b*l,b=b*v,r=d*l,d=d*v,
m=m*v,h=k*h,l=k*l,k=k*v;return c[0]=1-(r+m),c[1]=t+k,c[2]=b-l,c[3]=t-k,c[4]=1-(a+m),c[5]=d+h,c[6]=b+l,c[7]=d-h,c[8]=1-(a+r),c};y.toMat4=function(a,c){c||(c=v.create());var b=a[0],d=a[1],m=a[2],k=a[3],h=b+b,l=d+d,q=m+m;a=b*h;var t=b*l,b=b*q,r=d*l,d=d*q,m=m*q,h=k*h,l=k*l,k=k*q;return c[0]=1-(r+m),c[1]=t+k,c[2]=b-l,c[3]=0,c[4]=t-k,c[5]=1-(a+m),c[6]=d+h,c[7]=0,c[8]=b+l,c[9]=d-h,c[10]=1-(a+r),c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c};y.slerp=function(a,c,d,k){k||(k=a);var b,m,h,l,q=a[0]*c[0]+a[1]*c[1]+
a[2]*c[2]+a[3]*c[3];return 1<=Math.abs(q)?(k!==a&&(k[0]=a[0],k[1]=a[1],k[2]=a[2],k[3]=a[3]),k):(b=Math.acos(q),m=Math.sqrt(1-q*q),.001>Math.abs(m)?(k[0]=.5*a[0]+.5*c[0],k[1]=.5*a[1]+.5*c[1],k[2]=.5*a[2]+.5*c[2],k[3]=.5*a[3]+.5*c[3],k):(h=Math.sin((1-d)*b)/m,l=Math.sin(d*b)/m,k[0]=a[0]*h+c[0]*l,k[1]=a[1]*h+c[1]*l,k[2]=a[2]*h+c[2]*l,k[3]=a[3]*h+c[3]*l,k))};y.fromRotationMatrix=function(a,c){c||(c=y.create());var b,d=a[0]+a[4]+a[8];if(0<d)b=Math.sqrt(d+1),c[3]=.5*b,b=.5/b,c[0]=(a[7]-a[5])*b,c[1]=(a[2]-
a[6])*b,c[2]=(a[3]-a[1])*b;else{b=y.fromRotationMatrix.s_iNext=y.fromRotationMatrix.s_iNext||[1,2,0];d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var m=b[d],k=b[m];b=Math.sqrt(a[3*d+d]-a[3*m+m]-a[3*k+k]+1);c[d]=.5*b;b=.5/b;c[3]=(a[3*k+m]-a[3*m+k])*b;c[m]=(a[3*m+d]+a[3*d+m])*b;c[k]=(a[3*k+d]+a[3*d+k])*b}return c};q.toQuat4=y.fromRotationMatrix;(function(){var a=q.create();y.fromAxes=function(b,c,d,k){return a[0]=c[0],a[3]=c[1],a[6]=c[2],a[1]=d[0],a[4]=d[1],a[7]=d[2],a[2]=b[0],a[5]=b[1],a[8]=b[2],y.fromRotationMatrix(a,
k)}})();y.identity=function(a){return a||(a=y.create()),a[0]=0,a[1]=0,a[2]=0,a[3]=1,a};y.fromAngleAxis=function(a,c,d){d||(d=y.create());a*=.5;var b=Math.sin(a);return d[3]=Math.cos(a),d[0]=b*c[0],d[1]=b*c[1],d[2]=b*c[2],d};y.toAngleAxis=function(a,c){c||(c=a);var b=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<b?(c[3]=2*Math.acos(a[3]),b=l.invsqrt(b),c[0]=a[0]*b,c[1]=a[1]*b,c[2]=a[2]*b):(c[3]=0,c[0]=1,c[1]=0,c[2]=0);return c};y.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"};var D={create:function(a){var b=
new h(4);return a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):b[0]=b[1]=b[2]=b[3]=0,b},createFrom:function(a,c,d,k){var b=new h(4);return b[0]=a,b[1]=c,b[2]=d,b[3]=k,b},set:function(a,c){return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c},identity:function(a){return a||(a=D.create()),a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},transpose:function(a,c){return c&&a!==c?(c[0]=a[0],c[1]=a[2],c[2]=a[1],c[3]=a[3],c):(c=a[1],a[1]=a[2],a[2]=c,a)},determinant:function(a){return a[0]*a[3]-a[2]*a[1]},inverse:function(a,c){c||
(c=a);var b=a[0],d=a[1],m=a[2];a=a[3];var k=b*a-m*d;return k?(k=1/k,c[0]=a*k,c[1]=-d*k,c[2]=-m*k,c[3]=b*k,c):null},multiply:function(a,c,d){d||(d=a);var b=a[0],m=a[1],k=a[2];a=a[3];return d[0]=b*c[0]+m*c[2],d[1]=b*c[1]+m*c[3],d[2]=k*c[0]+a*c[2],d[3]=k*c[1]+a*c[3],d},rotate:function(a,c,d){d||(d=a);var b=a[0],m=a[1],k=a[2];a=a[3];var h=Math.sin(c);c=Math.cos(c);return d[0]=b*c+m*h,d[1]=b*-h+m*c,d[2]=k*c+a*h,d[3]=k*-h+a*c,d},multiplyVec2:function(a,c,d){d||(d=c);var b=c[0];c=c[1];return d[0]=b*a[0]+
c*a[1],d[1]=b*a[2]+c*a[3],d},scale:function(a,c,d){d||(d=a);var b=a[1],m=a[2],k=a[3],h=c[0];c=c[1];return d[0]=a[0]*h,d[1]=b*c,d[2]=m*h,d[3]=k*c,d},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}};w=w?"":"d";p["glMath"+w]=l;p["vec2"+w]={create:function(a){var b=new h(2);return a?(b[0]=a[0],b[1]=a[1]):(b[0]=0,b[1]=0),b},createFrom:function(a,c){var b=new h(2);return b[0]=a,b[1]=c,b},add:function(a,c,d){return d||(d=c),d[0]=a[0]+c[0],d[1]=a[1]+c[1],d},subtract:function(a,c,d){return d||
(d=c),d[0]=a[0]-c[0],d[1]=a[1]-c[1],d},multiply:function(a,c,d){return d||(d=c),d[0]=a[0]*c[0],d[1]=a[1]*c[1],d},divide:function(a,c,d){return d||(d=c),d[0]=a[0]/c[0],d[1]=a[1]/c[1],d},scale:function(a,c,d){return d||(d=a),d[0]=a[0]*c,d[1]=a[1]*c,d},dist:function(a,c){var b=c[0]-a[0];a=c[1]-a[1];return Math.sqrt(b*b+a*a)},dist2:function(a,c){var b=c[0]-a[0];a=c[1]-a[1];return b*b+a*a},set:function(a,c){return c[0]=a[0],c[1]=a[1],c},set2:function(a,c,d){return d[0]=a,d[1]=c,d},negate:function(a,c){return c||
(c=a),c[0]=-a[0],c[1]=-a[1],c},normalize:function(a,c){c||(c=a);var b=a[0]*a[0]+a[1]*a[1];return 0<b?(b=Math.sqrt(b),c[0]=a[0]/b,c[1]=a[1]/b):c[0]=c[1]=0,c},cross:function(a,c,d){a=a[0]*c[1]-a[1]*c[0];return d?(d[0]=d[1]=0,d[2]=a,d):a},length:function(a){var b=a[0];a=a[1];return Math.sqrt(b*b+a*a)},dot:function(a,c){return a[0]*c[0]+a[1]*c[1]},direction:function(a,c,d){d||(d=a);var b=a[0]-c[0];a=a[1]-c[1];return(c=b*b+a*a)?(c=1/Math.sqrt(c),d[0]=b*c,d[1]=a*c,d):(d[0]=0,d[1]=0,d[2]=0,d)},lerp:function(a,
c,d,k){return k||(k=a),k[0]=a[0]+d*(c[0]-a[0]),k[1]=a[1]+d*(c[1]-a[1]),k},str:function(a){return"["+a[0]+", "+a[1]+"]"}};p["vec3"+w]=d;p["vec4"+w]={create:function(a){var b=new h(4);return a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):(b[0]=0,b[1]=0,b[2]=0,b[3]=0),b},createFrom:function(a,c,d,k){var b=new h(4);return b[0]=a,b[1]=c,b[2]=d,b[3]=k,b},add:function(a,c,d){return d||(d=c),d[0]=a[0]+c[0],d[1]=a[1]+c[1],d[2]=a[2]+c[2],d[3]=a[3]+c[3],d},subtract:function(a,c,d){return d||(d=c),d[0]=a[0]-c[0],
d[1]=a[1]-c[1],d[2]=a[2]-c[2],d[3]=a[3]-c[3],d},multiply:function(a,c,d){return d||(d=c),d[0]=a[0]*c[0],d[1]=a[1]*c[1],d[2]=a[2]*c[2],d[3]=a[3]*c[3],d},divide:function(a,c,d){return d||(d=c),d[0]=a[0]/c[0],d[1]=a[1]/c[1],d[2]=a[2]/c[2],d[3]=a[3]/c[3],d},scale:function(a,c,d){return d||(d=a),d[0]=a[0]*c,d[1]=a[1]*c,d[2]=a[2]*c,d[3]=a[3]*c,d},dot:function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]},set:function(a,c){return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c},set4:function(a,c,d,k,h){return h[0]=
a,h[1]=c,h[2]=d,h[3]=k,h},negate:function(a,c){return c||(c=a),c[0]=-a[0],c[1]=-a[1],c[2]=-a[2],c[3]=-a[3],c},lerp:function(a,c,d,k){return k||(k=a),k[0]=a[0]+d*(c[0]-a[0]),k[1]=a[1]+d*(c[1]-a[1]),k[2]=a[2]+d*(c[2]-a[2]),k[3]=a[3]+d*(c[3]-a[3]),k},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}};p["mat2"+w]=D;p["mat3"+w]=q;p["mat4"+w]=v;p["quat4"+w]=y}),A})},"esri/views/3d/state/controllers/CameraController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../core/Accessor".split(" "),
function(A,p,w,l,h,d){Object.defineProperty(p,"__esModule",{value:!0});var u;!function(d){d.Ready="ready";d.Rejected="rejected";d.Running="running";d.Stopped="stopped";d.Finished="finished"}(u=p.State||(p.State={}));A=function(d){function a(){var a=null!==d&&d.apply(this,arguments)||this;return a.state=u.Ready,a}return w(a,d),Object.defineProperty(a.prototype,"active",{get:function(){return this.state===u.Running},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isInteractive",{get:function(){return!1},
enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"canStop",{get:function(){return!1},enumerable:!0,configurable:!0}),a.prototype.stopController=function(){return this.canStop?(this.state=u.Stopped,!0):!1},a.prototype.finishController=function(){this.state=u.Finished},a.prototype.onControllerStart=function(a){this.state=u.Running},a.prototype.onControllerEnd=function(a){},a.prototype.stepController=function(a,c){},Object.defineProperty(a.prototype,"steppingFinished",{get:function(){return!1},
enumerable:!0,configurable:!0}),l([h.property({readOnly:!0,dependsOn:["state"]})],a.prototype,"active",null),l([h.property()],a.prototype,"state",void 0),a=l([h.subclass()],a)}(h.declared(d));p.CameraController=A})},"esri/views/3d/state/controllers/AnimationController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../ViewAnimation","./CameraController"],function(A,p,w,l,h){Object.defineProperty(p,"__esModule",{value:!0});A=function(d){function u(h){void 0===
h&&(h=new l);var a=d.call(this)||this;return a.viewAnimation=h,a}return w(u,d),Object.defineProperty(u.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"asyncResult",{get:function(){return this._asyncResult},set:function(d){this._asyncResult&&this._asyncResult.reject();this._asyncResult=d;(this.state===h.State.Finished||this.state===h.State.Stopped)&&(this._asyncResult=null,this.state===h.State.Finished?d.resolve():d.reject())},enumerable:!0,
configurable:!0}),u.prototype.onControllerStart=function(l){var a=this;d.prototype.onControllerStart.call(this,l);this.viewAnimation&&this.viewAnimation.when(function(){a.state!==h.State.Ready&&a.state!==h.State.Running||a.finish()},function(){a.state!==h.State.Ready&&a.state!==h.State.Running||(a.state=h.State.Stopped)})},u.prototype.onControllerEnd=function(l){this.viewAnimation&&(this.viewAnimation.done||(this.state===h.State.Finished?this.viewAnimation.finish():this.state===h.State.Stopped&&this.viewAnimation.stop()));
this._asyncResult&&(this.state===h.State.Finished?this._asyncResult.resolve():this._asyncResult.reject());d.prototype.onControllerEnd.call(this,l)},u.prototype.finish=function(){this.finishController()},u}(h.CameraController);p.AnimationController=A})},"esri/views/3d/state/ViewStateManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators dojo/_base/lang ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Logger ../../../core/HandleRegistry ../../../core/watchUtils ../../../core/Error ../../../core/promiseUtils ../../../geometry/Point ../../../geometry/Extent ../../../geometry/ScreenPoint ../../../geometry/support/webMercatorUtils ../../animation/easing ./controllers/PointToPointAnimationController ../support/PropertiesPool ../support/cameraUtils ../support/viewpointUtils ../camera/intersectionUtils ../camera/constraintUtils ./Frustum ./ConstraintsManager ./controllers/SurfaceCollisionCorrectionController ../lib/glMatrix ../webgl-engine/lib/Camera ./helpers/PickingHelper".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E,J,G,K,M,U,N,W,R,V,Q){Object.defineProperty(p,"__esModule",{value:!0});var S=k.getLogger("esri.views.3d.state.ViewStateManager");A=function(a){function k(e){e=a.call(this)||this;return e.propertiesPool=new E["default"]({frustum:U["default"]},e),e.handles=new c,e.cameraSetByUser=!1,e.internalSetOrder=[],e.immediateGoToPromise=null,e.animatedGoToPromise=null,e.ready=!1,e}return w(k,a),Object.defineProperty(k.prototype,"camera",{get:function(){return this.ready?
J.internalToExternal(this.view,this.view.state.camera):this._get("camera")},set:function(a){this.updatePropertyBeforeReady("camera",a)||this.setStateCamera(J.externalToInternal(this.view,a),{applyConstraints:!1})||S.error("#camera\x3d","Invalid camera",a)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"center",{get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(a){return this.updatePropertyBeforeReady("center",
a)?void 0:a?this.isCompatible(a)?void(this.setStateCamera(this.centerToCamera(a),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.forceUpdate():S.error("#center\x3d","Invalid center",a)):void S.error("#center\x3d","Center has an incompatible spatial reference (center: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):void S.error("#center\x3d","Center may not be null or undefined")},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,
"extent",{get:function(){return this.ready?J.toExtent(this.view,null,null,null,O):this._get("extent")},set:function(a){return this.updatePropertyBeforeReady("extent",a)?void 0:a?this.isCompatible(a)?void(this.setStateCamera(this.extentToCamera(a),{applyConstraints:!0})||S.error("#extent\x3d","Invalid extent",a)):void S.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):void S.error("#extent\x3d",
"Extent may not be null or undefined")},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"frustum",{get:function(){var a=this.propertiesPool.get("frustum");return a.update(this.view.state.camera),a},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"hasInitialView",{get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"scale",{get:function(){if(!this.ready)return this._get("scale");
var a=this.view.pointsOfInterest.centerOnContent;return J.distanceToScale(this.view,a.distance,a.location.latitude)},set:function(a){this.updatePropertyBeforeReady("scale",a)||this.setStateCamera(this.scaleToCamera(a),{applyConstraints:!0})||S.error("#scale\x3d","Invalid scale",a)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"padding",{get:function(){if(!this.ready)return this._get("padding");var a=this.view.state.camera.padding;return{top:a[0],right:a[1],bottom:a[2],left:a[3]}},
set:function(a){this.updatePropertyBeforeReady("padding",a)||(a?R.vec4d.set4(a.top||0,a.right||0,a.bottom||0,a.left||0,e):R.vec4d.set4(0,0,0,0,e),this.view.state.updateCamera(function(a){a.padding=e}))},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"screenCenter",{get:function(){var a=this.padding;return new B((this.view.width-(a.left+a.right))/2+a.left,(this.view.height-(a.top+a.bottom))/2+a.top)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"viewpoint",{get:function(){return this.ready?
G.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(a){if(!this.updatePropertyBeforeReady("viewpoint",a)){if(!a)return void S.error("#viewpoint\x3d","Viewpoint may not be null or undefined");if(!this.isCompatible(a)){var e=a.camera?a.camera.position:a.targetGeometry,e=e&&e.spatialReference;return void S.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(e?e.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a)}this.setStateCamera(this.viewpointToCamera(a),
{applyConstraints:!a.camera})||S.error("#viewpoint\x3d","Invalid viewpoint",a)}},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"zoom",{get:function(){return this.ready?J.scaleToZoom(this.view,this.scale):this._get("zoom")},set:function(a){this.updatePropertyBeforeReady("zoom",a)||this.setStateCamera(this.zoomToCamera(a),{applyConstraints:!0})||S.error("#zoom\x3d","Invalid zoom",a)},enumerable:!0,configurable:!0}),k.prototype.initialize=function(){var a=this;this.pickingHelper=
new Q.PickingHelper(this.view);this.handles.add(this.view.watch("state.camera",function(e){return a.cameraChangedSync(e)},!0),t.on(this.view,"state.events","before-camera-change",function(e){return a.beforeCameraChangeHandle(e.camera)}));this.handles.add(this.view.on("resize",function(e){return a.handleResize(e.width,e.height)}));this.handles.add(this.view.watch("state.cameraController",function(){a.cameraSetByUser=!0;a.handles.remove(f);a.cancelImmediateGoTo()}));this.handles.add(t.on(this.view,
"pointsOfInterest.events","camera-parameters-changed",function(){return a.notifyChange("scale")}))},k.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)},k.prototype.init=function(){var a=this;this.constraintsManager=new N["default"]({view:this.view});this.handleResize(this.view.width,this.view.height);var e=this.getInitialProperties();this.cameraSetByUser=!1;this._set("ready",!0);for(var b=
0;b<e.length;b++){var c=e[b];this.set(c.name,c.value)}this.cameraSetByUser||((e=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(e)?this.setInitialView(e):"local"===this.view.state.mode&&this.handles.add(t.whenOnce(this.view.basemapTerrain,"ready",function(){a.handles.remove(f);a.setInitialView(a.view.groundExtent)}),f))},k.prototype.deinit=function(){this.ready&&(this._override("padding",this.padding),this.cancelImmediateGoTo(),this.cancelAnimatedGoTo(),
this._set("ready",!1),this._clearOverride("hasInitialView"),this.internalSetOrder.length=0,this.cameraSetByUser=!1,this.handles.remove(f),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))},k.prototype.goTo=function(a,e){return e=d.mixin({animate:!0},e),e.animate?this.goToAnimated(a,e):this.goToImmediate(a,e)},k.prototype.debugSetCameraOnContent=function(){this.setStateCamera(K.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})},k.prototype.step=
function(a){var e=this.view.state,b=e&&this.view.state.cameraController;b&&(e.updateCamera(function(e){b.stepController(a,e)}),b.steppingFinished&&b.finishController())},k.prototype.cancelImmediateGoTo=function(){var a=this.immediateGoToPromise;a&&(this.immediateGoToPromise=null,a.cancel())},k.prototype.cancelAnimatedGoTo=function(){var a=this.animatedGoToPromise;a&&(this.animatedGoToPromise=null,a.cancel())},k.prototype.getInitialProperties=function(){for(var a=this,e=new Set,b=[],c=0,f=z;c<f.length;c++){var d=
f[c],g=d.propertyName,d=d.overrides,k=e.has(g),m=this._isOverridden(g);!k&&m&&b.push({name:g,value:this._get(g)});this._clearOverride(g);(k||m)&&d.forEach(function(a){return e.add(a)})}return b.sort(function(e,b){e=a.internalSetOrder.indexOf(e.name);b=a.internalSetOrder.indexOf(b.name);return b>e?-1:e>b?1:0})},k.prototype.setInitialView=function(a){if(a&&!this.cameraSetByUser){var e,b={applyConstraints:!0};a instanceof u?(e=a,b.applyConstraints=!1):a instanceof r?a.targetGeometry instanceof y?e=J.fromExtent(this.view,
a.targetGeometry,0,.5,{noReset:!0}):(a.camera&&(b.applyConstraints=!1),e=G.toCamera(this.view,a)):e=J.fromExtent(this.view,a,0,.5,{noReset:!0});this.setStateCamera(J.externalToInternal(this.view,e),b)}},k.prototype.updatePropertyBeforeReady=function(a,e){if(this.ready)return!1;this._override(a,e);var b=this.internalSetOrder.indexOf(a);return-1!==b&&(this.internalSetOrder=this.internalSetOrder.splice(b,1)),e&&(this.internalSetOrder.push(a),-1!==X.indexOf(a)&&this._override("hasInitialView",!0)),!0},
k.prototype.isCompatible=function(a){return a?a instanceof r?a.camera?this.isCompatible(a.camera):this.isCompatible(a.targetGeometry):a instanceof u?this.isCompatible(a.position):a.spatialReference&&D.canProject(a.spatialReference,this.view.spatialReference):!1},k.prototype.getPreservingHeadingTilt=function(a){return void 0===a&&(a=Z),this.cameraSetByUser?(a.heading=this.camera.heading,a.tilt=this.camera.tilt):(a.heading=0,a.tilt=.5),a},k.prototype.centerPointAtDistanceToCamera=function(a,e,b){void 0===
b&&(b=g);var c=this.getPreservingHeadingTilt();return(a=J.eyeHeadingTiltForCenterPointAtDistance(this.view,c.heading,c.tilt,a,e))?(b.copyFrom(this.view.state.camera),b.eye=a.eye,b.center=a.center,b.up=a.up,b):null},k.prototype.centerToCamera=function(a){var e=this.view.pointsOfInterest.centerOnContent;e.forceUpdate();return this.centerPointAtDistanceToCamera(a,e.distance)},k.prototype.extentToCamera=function(a){var e=this.getPreservingHeadingTilt();return(a=J.fromExtent(this.view,a,e.heading,e.tilt,
O))?J.externalToInternal(this.view,a):void 0},k.prototype.scaleToCamera=function(a){var e=this.view.pointsOfInterest.centerOnContent;e.forceUpdate();var b=e.renderLocation;a=J.scaleToDistance(this.view,a,e.location.latitude);return this.centerPointAtDistanceToCamera(b,a)},k.prototype.zoomToCamera=function(a){return this.scaleToCamera(J.zoomToScale(this.view,a))},k.prototype.viewpointToCamera=function(a){return(a=G.toCamera(this.view,a))?J.externalToInternal(this.view,a):null},k.prototype.setStateCamera=
function(a,e){var b=this;return a&&this.view.state.stopActiveCameraController()?(this.cameraSetByUser=!0,this.cancelImmediateGoTo(),this.view.state.updateCamera(function(c){c.copyFrom(a);e.applyConstraints&&M.applyAll(b.view,c)}),e.applyConstraints||(this.view.state.cameraController=new W.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:a})),!0):!1},k.prototype.handleResize=function(a,e){var b=this.view.canvas;if(b&&(b.width!==a||b.height!==e)&&(b.width=a,b.height=e),this.view.state)b=
this.view.state.camera,(b.fullWidth!==a||b.fullHeight!==e)&&(g.copyFrom(b),g.fullWidth=a,g.fullHeight=e,this.view.state.camera=g)},k.prototype.beforeCameraChangeHandle=function(a){this.updateCameraAboveGround(a)},k.prototype.cameraChangedSync=function(a){a&&this.view._stage&&this.view._stage.setCamera(a)},k.prototype.updateCameraAboveGround=function(a){var e=this.view.basemapTerrain,b=this.view.renderCoordsHelper.getAltitude(a.eye),e=e&&e.spatialReference?K.surfaceElevationBelowEye(this.view,a):0;
a.aboveGround=b>=e},k.prototype.createGoToCamera=function(a){var e=this;return t.whenOnce(this,"ready",null,!0).then(function(){return G.create(e.view,a)}).then(function(b){var c=!!(a instanceof r&&a.camera||a instanceof u),f=b.camera;if(!e.isCompatible(f))throw b=(b=f.position)&&b.spatialReference,new C("goto:incompatible-spatialreference","Resulting camera has an incompatible spatial reference (camera: "+(b?b.wkid:"none")+", view: "+e.view.spatialReference.wkid+")",{camera:f});f=J.externalToInternal(e.view,
f);if(!f)throw new C("goto:invalid-camera","Resulting camera is invalid");return{viewpoint:b,camera:f,isFullySpecified:c}})},k.prototype.cancellableGoTo=function(a){var e,b=this;return q.create(function(b,c){e={resolve:b,reject:c};a.asyncResult=e},function(){b.view.state.cameraController===a&&a.active&&a.asyncResult===e&&a.stopController()})},k.prototype.goToImmediate=function(a,e){var b=this;this.cancelAnimatedGoTo();this.cancelImmediateGoTo();var c=this.createGoToCamera(a).then(function(a){b.immediateGoToPromise===
c&&(b.immediateGoToPromise=null);b.setStateCamera(a.camera,{applyConstraints:!a.isFullySpecified})})["catch"](function(a){b.immediateGoToPromise===c&&(b.immediateGoToPromise=null);throw a instanceof C&&a.message&&S.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1)),a;});return this.immediateGoToPromise=c,c},k.prototype.goToAnimatedBeforeReady=function(a,e){var b=this;this.cancelAnimatedGoTo();var c=t.whenOnce(this.view,"ready").then(function(){if(c===
b.animatedGoToPromise)return b.animatedGoToPromise=null,b.goToAnimated(a,e);throw new C("view:goto-cancelled","Cancelled");});return this.animatedGoToPromise=c,c},k.prototype.goToAnimated=function(a,e){var b=this;if(this.cancelAnimatedGoTo(),!this.ready)return this.goToAnimatedBeforeReady(a,e);var c,f=this.view.state.cameraController;c=f instanceof m.PointToPointAnimationController&&f.active?f:new m.PointToPointAnimationController(this.view.state,this.pickingHelper);this.cancelAnimatedGoTo();var d=
c.viewAnimation;a=this.createGoToCamera(a);var g=a.then(function(a){return a.viewpoint});if(d.update(g),c!==f&&!this.view.state.switchCameraController(c))return d.stop(),S.error("#goTo()","Cannot start an animation while interacting"),q.reject(new C("view:goto-cannot-interrupt","Cannot start an animation while interacting"));var k=d.target,n=function(){return b.view.state.cameraController===c&&c.viewAnimation.target===k&&c.active};return a.then(function(a){var f=a.viewpoint,g=a.camera;a=a.isFullySpecified;
if(n()){c.viewAnimation.update(f);k=c.viewAnimation.target;var m;return a?(m=new W.SurfaceCollisionCorrectionController({view:b.view,desiredCamera:g}),M.applySurfaceCollision(b.view,g,1)):M.applyAll(b.view,g),c.begin(g,b.internalAnimateOptions(e)),d.when().then(function(){m&&c.viewAnimation.target===k&&(b.view.state.cameraController=m)})}}).otherwise(function(a){if(a instanceof C&&a.message&&S.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1)),n())throw b.view.state.cameraController.stopController(),
a;}),this.cancellableGoTo(c)},k.prototype.internalAnimateOptions=function(a){var e={};return a&&(null!=a.speedFactor&&(e.speedFactor=a.speedFactor),null!=a.duration&&(e.duration=a.duration/1E3),null!=a.maxDuration&&(e.maxDuration=a.maxDuration/1E3),null!=a.easing&&("string"==typeof a.easing?e.easing=b.named[a.easing]:e.easing=a.easing)),e},l([h.property({type:u,dependsOn:["view.state.camera","ready"]})],k.prototype,"camera",null),l([h.property({type:v,dependsOn:["view.pointsOfInterest.centerOnContent.location",
"ready"]})],k.prototype,"center",null),l([h.property({type:y,dependsOn:["view.state.camera","ready"]})],k.prototype,"extent",null),l([h.property({readOnly:!0,dependsOn:["view.state.camera","ready"]})],k.prototype,"frustum",null),l([h.property({readOnly:!0,dependsOn:["view.map.initialViewProperties.viewpoint"]})],k.prototype,"hasInitialView",null),l([h.property({readOnly:!0,type:Boolean})],k.prototype,"ready",void 0),l([h.property({dependsOn:["view.pointsOfInterest.centerOnContent.distance","ready"],
type:Number})],k.prototype,"scale",null),l([h.property({dependsOn:["view.state.camera","ready"]})],k.prototype,"padding",null),l([h.property({readOnly:!0,dependsOn:["view.width","view.height","padding"]})],k.prototype,"screenCenter",null),l([h.property({constructOnly:!0})],k.prototype,"view",void 0),l([h.property({type:r,dependsOn:["camera","ready"]})],k.prototype,"viewpoint",null),l([h.property({type:Number,dependsOn:["scale"]})],k.prototype,"zoom",null),k=l([h.subclass("esri.views.3d.state.ViewStateManager")],
k)}(h.declared(a));p.ViewStateManager=A;var X="camera viewpoint extent scale center zoom".split(" "),z=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"center",overrides:[]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Z={heading:0,tilt:0},O=new u,g=new V,e=R.vec4d.create(),f="pending-initial-view";p["default"]=A})},
"esri/views/animation/easing":function(){define(["require","exports"],function(A,p){function w(d){return d}function l(d){var h=2*(d-Math.sqrt((d-1)*d)),l=h/2/d;return function(a){return l>a?d*a*a:h*a-h+1}}function h(d,h){return function(l){return h>l?h*d(l/h):1-d((1-l)/(1-h))*(1-h)}}Object.defineProperty(p,"__esModule",{value:!0});p.linear=w;p.inQuad=function(d){return d*d};p.outQuad=function(d){return 1-p.inQuad(1-d)};p.inOutQuad=function(d){return.5>d?p.inQuad(2*d)/2:(p.outQuad(2*(d-.5))+1)/2};
p.inCubic=function(d){return d*d*d};p.outCubic=function(d){return 1-p.inCubic(1-d)};p.inOutCubic=function(d){return.5>d?p.inCubic(2*d)/2:(p.outCubic(2*(d-.5))+1)/2};p.inQuart=function(d){return d*d*d*d};p.outQuart=function(d){return 1-p.inQuart(1-d)};p.inOutQuart=function(d){return.5>d?p.inQuart(2*d)/2:(p.outQuart(2*(d-.5))+1)/2};p.inQuint=function(d){return d*d*d*d*d};p.outQuint=function(d){return 1-p.inQuint(1-d)};p.inOutQuint=function(d){return.5>d?p.inQuint(2*d)/2:(p.outQuint(2*(d-.5))+1)/2};
p.inSine=function(d){return-Math.cos(d*Math.PI/2)+1};p.outSine=function(d){return 1-p.inSine(1-d)};p.inOutSine=function(d){return.5>d?p.inSine(2*d)/2:(p.outSine(2*(d-.5))+1)/2};p.inExpo=function(d){return Math.pow(2,10*(d-1))};p.outExpo=function(d){return 1-p.inExpo(1-d)};p.inOutExpo=function(d){return.5>d?p.inExpo(2*d)/2:(p.outExpo(2*(d-.5))+1)/2};p.inCirc=function(d){return-(Math.sqrt(1-d*d)-1)};p.outCirc=function(d){return 1-p.inCirc(1-d)};p.inOutCirc=function(d){return.5>d?p.inCirc(2*d)/2:(p.outCirc(2*
(d-.5))+1)/2};p.inCoastQuad=h(l(1),1);p.outCoastQuad=h(l(1),0);p.inOutCoastQuad=h(l(1),.5);p.inCoastCubic=h(l(2),1);p.outCoastCubic=h(l(2),0);p.inOutCoastCubic=h(l(2),.5);p.inCoastQuart=h(l(3),1);p.outCoastQuart=h(l(3),0);p.inOutCoastQuart=h(l(3),.5);p.inCoastQuint=h(l(4),1);p.outCoastQuint=h(l(4),0);p.inOutCoastQuint=h(l(4),.5);p.named={linear:w,"in-quad":p.inQuad,"out-quad":p.outQuad,"in-out-quad":p.inOutQuad,"in-cubic":p.inCubic,"out-cubic":p.outCubic,"in-out-cubic":p.inOutCubic,"in-quart":p.inQuart,
"out-quart":p.outQuart,"in-out-quart":p.inOutQuart,"in-quint":p.inQuint,"out-quint":p.outQuint,"in-out-quint":p.inOutQuint,"in-sine":p.inSine,"out-sine":p.outSine,"in-out-sine":p.inOutSine,"in-expo":p.inExpo,"out-expo":p.outExpo,"in-out-expo":p.inOutExpo,"in-circ":p.inCirc,"out-circ":p.outCirc,"in-out-circ":p.inOutCirc}})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./AnimationController ../../webgl-engine/lib/Camera ../../lib/glMatrix ../../animation/pointToPoint/Animation".split(" "),
function(A,p,w,l,h,d,u){Object.defineProperty(p,"__esModule",{value:!0});A=function(d){function c(a,c,k){k=d.call(this,k)||this;return k.viewState=a,k.pickingHelper=c,k.hasTarget=!1,k.animation=new u["default"](k.viewState.mode),k}return w(c,d),c.prototype.begin=function(c,d){this.hasTarget=!0;d=this.animationSettings(d);r.copyFrom(this.viewState.camera);this.pickingHelper.pickRaySegment(r.eye,r.center,a)&&(r.center=a);this.animation.update(r,c,d);this.animation.finished&&this.finish()},c.prototype.finish=
function(){this.animation.currentTime=this.animation.time;d.prototype.finish.call(this)},Object.defineProperty(c.prototype,"steppingFinished",{get:function(){return this.hasTarget&&this.animation.finished},enumerable:!0,configurable:!0}),c.prototype.stepController=function(a,c){d.prototype.stepController.call(this,a,c);this.hasTarget&&this.animation.step(a,c)},c.prototype.onControllerEnd=function(a){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,a),this.animation.currentTime=
this.animation.time);d.prototype.onControllerEnd.call(this,a)},c.prototype.animationSettings=function(a){return void 0===a&&(a={}),{apex:{maximumDistance:this.viewState.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},speedFactor:a.speedFactor,duration:a.duration,maxDuration:a.maxDuration,easing:a.easing}},c}(l.AnimationController);p.PointToPointAnimationController=A;var r=new h,a=d.vec3d.create()})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../animation/pointToPoint/Animation ./Camera ../../lib/glMatrix ../../webgl-engine/lib/Camera".split(" "),
function(A,p,w,l,h,d,u){Object.defineProperty(p,"__esModule",{value:!0});var r=d.vec3d,a=r.create();A=function(){function d(a){this.currentTime=0;this.animation=new l.Animation(function(){return new h["default"](a)});this._current=new h["default"](a)}return Object.defineProperty(d.prototype,"finished",{get:function(){return this.currentTime>=this.animation.time},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"time",{get:function(){return this.animation.time},enumerable:!0,configurable:!0}),
d.prototype.update=function(c,d,k){var h=this.animation.definition.source,l=this.animation.definition.target,t=r.subtract(d.center,c.center,a),B=r.length(t);1E-5<=B?(t[0]/=B,t[1]/=B,t[2]/=B):(t[0]=0,t[1]=1,t[0]=0);r.set(t,h.lookAtDirection);r.set(t,l.lookAtDirection);h.copyFromRenderCamera(c);l.copyFromRenderCamera(d);this._current.copyFrom(h);this.animation.update(h,l,k);this.currentTime=0;c.almostEquals(d,5E-4,!0)&&(this.currentTime=this.animation.time)},d.prototype.cameraAt=function(a,d){a=this.animation.cameraAt(a,
this._current);return d||(d=new u),a.copyToRenderCamera(d),d},d.prototype.step=function(a,d){return this.finished||(this.currentTime+=a,this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,d)},d}();p.Animation=A;p["default"]=A})},"esri/views/animation/pointToPoint/Animation":function(){define("require exports ../easing ./Definition ./Settings ./apex/Path".split(" "),function(A,p,w,l,h,d){Object.defineProperty(p,"__esModule",{value:!0});var u={zoom:0,
pan:0,rotate:0};A=function(){function r(a){this.createCamera=a;this.time=0;this.definition=new l.Definition(a);this.path=new d.Path}return r.prototype.update=function(a,d,c){this.definition.update(a,d,c);this.path.update(this.definition,c);this.time=this._applyTimeSettings(this.path.time,c);this.settings=c},r.prototype.cameraAt=function(a,d){d||(d=this.createCamera());a=Math.min(Math.max(0,a),1);a=this.settings.easing?this.normalizedEasing(this.settings.easing,a,1E3*this.time):1<=this.time?this.normalizedEasing(w.inOutCoastQuad,
a):this.normalizedEasing(w.outExpo,a);a=this.path.interpolateComponentsAt(a,u);return d.interpolate(this.definition.source,this.definition.target,a),d},r.prototype.normalizedEasing=function(a,d,c){c=a(0);var k=a(1);return(a(d)-c)/(k-c)},r.prototype._applyTimeSettings=function(a,d){var c=null!=d.speedFactor?d.speedFactor:1;null!=d.duration?a=d.duration:null!=d.speedFactor&&(a/=c);return a=Math.min(Math.max(null!=d.minDuration?d.minDuration:h.defaultSettings.minDuration/c,a),null!=d.maxDuration?d.maxDuration:
h.defaultSettings.maxDuration/c)},r}();p.Animation=A;p["default"]=A})},"esri/views/animation/pointToPoint/Definition":function(){define(["require","exports","./Settings"],function(A,p,w){Object.defineProperty(p,"__esModule",{value:!0});A=function(){function l(h){this.createCamera=h;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:w.defaultSettings.desiredScreenFlow};this.source=h();this.target=h()}return l.prototype.clone=function(){var h=new l(this.createCamera);
return h.copyFrom(this),h},l.prototype.copyFrom=function(h){this.update(h.source,h.target,h.settings)},l.prototype.update=function(h,d,l){this.source!==h&&this.source.copyFrom(h);this.target!==d&&this.target.copyFrom(d);this.settings.desiredScreenFlow=null!=l.desiredScreenFlow?l.desiredScreenFlow:w.defaultSettings.desiredScreenFlow;this.compared=this.source.compareTo(this.target,this.compared);this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/
2},l.prototype.halfWindowPanAtZoom=function(h){h=this.target.pixelsPerPanAtZoom(h);return this.halfWindowSize/h},Object.defineProperty(l.prototype,"hasZoom",{get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"hasPan",{get:function(){return 1E-9<this.compared.pan},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"hasRotate",{get:function(){return 1E-9<this.compared.rotate},enumerable:!0,
configurable:!0}),l}();p.Definition=A;p["default"]=A})},"esri/views/animation/pointToPoint/Settings":function(){define(["require","exports"],function(A,p){Object.defineProperty(p,"__esModule",{value:!0});p.defaultSettings={desiredScreenFlow:2,minDuration:.5,maxDuration:8}})},"esri/views/animation/pointToPoint/apex/Path":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../easing ../Path ../Segment ./planning".split(" "),function(A,p,w,l,h,d,u){Object.defineProperty(p,
"__esModule",{value:!0});A=function(h){function a(a,c){var k=h.call(this)||this;return k._preallocSegments=[new d["default"],new d["default"],new d["default"]],k.update(a,c),k}return w(a,h),a.prototype.update=function(a,c){if(a){this.definition?this.definition.copyFrom(a):this.definition=a.clone();var d=null;c&&c.apex&&(d=u.optimalDistance(a,c.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==d?this._updateWithoutApex():this._updateWithApex(d,c.apex)}},a.prototype.segmentInterpolateComponentsAt=
function(a,c,d){return d=a.interpolateComponentsAt(c,d),a===this._ascensionSegment?d.zoom=l.outQuad(d.zoom):a===this._descensionSegment&&(d.zoom=l.inQuad(d.zoom)),d},a.prototype._updateWithApex=function(a,c){var d=this._preallocSegments,k=d[0],h=d[1],d=d[2],l=null!=c.ascensionFactor?c.ascensionFactor:.5;c=Math.min(1-l,null!=c.ascensionFactor?c.descensionFactor:.5);var r=1-l-c;k.definition?k.definition.copyFrom(this.definition):k.definition=this.definition.clone();k.definition.compared.targetZoom=
a;k.definition.compared.pan=this.definition.compared.pan*l;k.definition.compared.rotate=this.definition.compared.rotate*l;k.update();this._ascensionSegment=k;this.segments.push(k);0<r&&(h.definition?h.definition.copyFrom(this.definition):h.definition=this.definition.clone(),h.definition.copyFrom(this.definition),h.definition.compared.sourceZoom=a,h.definition.compared.targetZoom=a,h.definition.compared.pan=this.definition.compared.pan*r,h.definition.compared.rotate=this.definition.compared.rotate*
r,h.update(),this.segments.push(h));d.definition?d.definition.copyFrom(this.definition):d.definition=this.definition.clone();d.definition.compared.sourceZoom=a;d.definition.compared.pan=this.definition.compared.pan*c;d.definition.compared.rotate=this.definition.compared.rotate*c;d.update();this._descensionSegment=d;this.segments.push(d)},a.prototype._updateWithoutApex=function(){var a=this._preallocSegments[0];a.update(this.definition);this.segments.push(a)},a}(h["default"]);p.Path=A;p["default"]=
A})},"esri/views/animation/pointToPoint/Path":function(){define(["require","exports"],function(A,p){Object.defineProperty(p,"__esModule",{value:!0});A=function(){function p(){this.segments=[]}return Object.defineProperty(p.prototype,"time",{get:function(){return this.segments.reduce(function(l,h){return l+h.time},0)},enumerable:!0,configurable:!0}),p.prototype.interpolateComponentsAt=function(l,h){l=Math.min(Math.max(l,0),1);l*=this.time;for(var d=0,u=0,r=this.definition,a=0;a<this.segments.length;a++){var k=
this.segments[a],c=k.definition;if(l<=k.time||a===this.segments.length-1)return h=this.segmentInterpolateComponentsAt(k,l/k.time,h),r.hasPan?h.pan=(d+c.compared.pan*h.pan)/r.compared.pan:h.pan=1,r.hasRotate?h.rotate=(u+c.compared.rotate*h.rotate)/r.compared.rotate:h.rotate=1,l=h.zoom*(c.compared.targetZoom-c.compared.sourceZoom)+c.compared.sourceZoom,d=this.segments[0].definition.compared.sourceZoom,u=this.segments[this.segments.length-1].definition.compared.targetZoom,r.hasZoom?h.zoom=(l-d)/(u-d):
h.zoom=1,h;l-=k.time;d+=c.compared.pan;u+=c.compared.rotate}},p.prototype.segmentInterpolateComponentsAt=function(l,h,d){return l.interpolateComponentsAt(h,d)},p}();p.Path=A;p["default"]=A})},"esri/views/animation/pointToPoint/Segment":function(){define(["require","exports"],function(A,p){Object.defineProperty(p,"__esModule",{value:!0});A=function(){function p(l){l&&this.update(l)}return p.prototype.update=function(l){l&&(this.definition?this.definition.copyFrom(l):this.definition=l.clone());this._updatePrecomputedVariables();
this._updatePixelFlow()},p.prototype._updatePrecomputedVariables=function(){var l=this.definition,h=l.compared,d=h.sourceZoom,u=h.targetZoom;this._sl=d>u?1:-1;this._panPixelsAtSource=h.pan*l.source.pixelsPerPanAtZoom(d);l=(l.source.pixelsPerRotateAtZoom(d)+l.target.pixelsPerRotateAtZoom(u))/2;this._rotatePixels=h.rotate*l},p.prototype._updatePixelFlow=function(){var l,h,d=this.definition.compared.sourceZoom,u=this.definition.compared.targetZoom,r=this.definition.hasZoom,a=this.definition.hasPan,k=
this.definition.hasRotate;l=a&&r?(u/d-1)/(-1/(this._sl*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource):0;h=r&&k?Math.log(d/u)/Math.LN2*this._sl*this.definition.halfWindowSize/this._rotatePixels:0;this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;d=this.definition.desiredPixelFlow;r&&a&&k?(u=l+h+l*h,this._zoomPixelFlow=l*h/u*d,this._panPixelFlow=h/u*d,this._rotatePixelFlow=l/u*d):r&&a?(u=1+l,this._zoomPixelFlow=l/u*d,this._panPixelFlow=1/u*d):r&&k?(u=1+h,this._zoomPixelFlow=
h/u*d,this._rotatePixelFlow=1/u*d):a&&k?(l=this._panPixelsAtSource/this._rotatePixels,u=1+l,this._panPixelFlow=l/u*d,this._rotatePixelFlow=1/u*d):a?this._panPixelFlow=d:r?this._zoomPixelFlow=d:k&&(this._rotatePixelFlow=d);k?this.time=this.rotateTime:r?this.time=this.zoomTime:a?this.time=this.panTime:this.time=0},Object.defineProperty(p.prototype,"zoomTime",{get:function(){return this.definition.hasZoom?Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._sl*
this.definition.halfWindowSize/this._zoomPixelFlow:0},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"panTime",{get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){var l=-1/(this._sl*this.definition.halfWindowSize)*Math.LN2;return Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*l+1)/(l*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"rotateTime",
{get:function(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0},enumerable:!0,configurable:!0}),p.prototype._interpolateComponentsZoom=function(l){if(this.definition.hasZoom){var h=this.definition.compared.sourceZoom,d=this.definition.compared.targetZoom;return(h*Math.pow(h/d,-l)-h)/(d-h)}return l},p.prototype._interpolateComponentsPan=function(l){if(this.definition.hasPan&&this.definition.hasZoom){var h=-1/(this._sl*this.definition.halfWindowSize)*this._zoomPixelFlow;
return 1/this._panPixelsAtSource*this._panPixelFlow*(Math.pow(2,h*l*this.time)-1)/(h*Math.LN2)}return l},p.prototype._interpolateComponentsRotate=function(l){return l},p.prototype.interpolateComponentsAt=function(l,h){l=Math.min(Math.max(l,0),1);var d=this._interpolateComponentsZoom(l),u=this._interpolateComponentsPan(l);l=this._interpolateComponentsRotate(l);return h?(h.zoom=d,h.pan=u,h.rotate=l):h={zoom:d,pan:u,rotate:l},h},p}();p.Segment=A;p["default"]=A})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["require",
"exports","./functions"],function(A,p,w){function l(h,d){var l=Math.max(h.compared.sourceZoom,h.compared.targetZoom);h=h.source.zoomAtPixelsPerPan(h.desiredPixelFlow/h.compared.pan)/2;return l>h?null!=d.maximumDistance?l+(d.maximumDistance-l)/2:1.5*l:d.maximumDistance?Math.min(d.maximumDistance,h):h}Object.defineProperty(p,"__esModule",{value:!0});p.optimalDistance=function(h,d){var u=l(h,d),r={ascensionFactor:null!=d.ascensionFactor?d.ascensionFactor:.5,descensionFactor:null!=d.descensionFactor?
d.descensionFactor:.5},a=0===r.ascensionFactor,k=0===r.descensionFactor,c=a?w.tAscensionZoomOnly:w.tAscensionZoomPan,t=a?w.dtAscensionZoomOnly:w.dtAscensionZoomPan,C=a?w.ddtAscensionZoomOnly:w.ddtAscensionZoomPan,q=k?w.tDescensionZoomOnly:w.tDescensionZoomPan,v=k?w.dtDescensionZoomOnly:w.dtDescensionZoomPan,y=k?w.ddtDescensionZoomOnly:w.ddtDescensionZoomPan,a=function(a){return c(h,r,a)+w.tPanion(h,r,a)+q(h,r,a)},k=function(a){return t(h,r,a)+w.dtPanion(h,r,a)+v(h,r,a)},B=function(a){return C(h,r,
a)+w.ddtPanion(h,r,a)+y(h,r,a)},D=a(u),b=w.tBaseLine(h),m=d.maximumIterations||20,E=null!=d.maximumDistance?d.maximumDistance:1/0;for(d=0;m>d;d++){var p=(k(u)+1E-6)/B(u);if(isNaN(p)||u>=E&&0>p){if(!isFinite(E))return null;u=E;D=a(u);break}if(u-=p,u<h.compared.sourceZoom||u<h.compared.targetZoom)return null;p=a(u);if(.005>=Math.abs(p-D)/D)break;D=p}return D>.7*b?null:u<h.compared.sourceZoom||u<h.compared.targetZoom?null:u}})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["require",
"exports"],function(A,p){Object.defineProperty(p,"__esModule",{value:!0});p.tAscensionZoomPan=function(p,l,h){var d=p.halfWindowPanAtZoom(h-p.compared.sourceZoom);return-p.halfWindowSize*(l.ascensionFactor*Math.LN2*p.compared.pan+d)*Math.log(p.compared.sourceZoom/h)/(p.desiredPixelFlow*Math.LN2*d)};p.dtAscensionZoomPan=function(p,l,h){var d=1/h,u=Math.log(p.compared.sourceZoom*d),r=1/p.desiredPixelFlow,a=1/Math.LN2;h-=p.compared.sourceZoom;var k=1/h;l=(l.ascensionFactor*Math.LN2*p.compared.pan+p.halfWindowPanAtZoom(h))/
p.halfWindowPanAtZoom(1);return p.halfWindowSize*d*r*a*k*l-p.halfWindowSize*u*r*a*k+p.halfWindowSize*u*r*a*l/(h*h)};p.ddtAscensionZoomPan=function(p,l,h){var d=h-p.compared.sourceZoom,u=1/d,r=1/h,a=Math.log(p.compared.sourceZoom*r);l=(l.ascensionFactor*Math.LN2*p.compared.pan+p.halfWindowPanAtZoom(d))/p.halfWindowPanAtZoom(1);return p.halfWindowSize*u*(-2*u*r*l+2*u*a+2*r-2*a*l/(d*d)-l/(h*h))/(p.desiredPixelFlow*Math.LN2)};p.tAscensionZoomOnly=function(p,l,h){return-p.halfWindowSize*Math.log(p.compared.sourceZoom/
h)/(p.desiredPixelFlow*Math.LN2)};p.dtAscensionZoomOnly=function(p,l,h){return p.halfWindowSize/(h*p.desiredPixelFlow*Math.LN2)};p.ddtAscensionZoomOnly=function(p,l,h){return-p.halfWindowSize/(h*h*p.desiredPixelFlow*Math.LN2)};p.tPanion=function(p,l,h){return-p.compared.pan*p.halfWindowSize*(l.ascensionFactor+l.descensionFactor-1)/(p.desiredPixelFlow*p.halfWindowPanAtZoom(h))};p.dtPanion=function(p,l,h){return p.compared.pan*p.halfWindowSize*(l.ascensionFactor+l.descensionFactor-1)/(p.desiredPixelFlow*
p.halfWindowPanAtZoom(h*h))};p.ddtPanion=function(p,l,h){return-2*p.compared.pan*p.halfWindowSize*(l.ascensionFactor+l.descensionFactor-1)/(p.desiredPixelFlow*p.halfWindowPanAtZoom(h*h*h))};p.tDescensionZoomPan=function(p,l,h){return p.halfWindowSize*(-p.halfWindowPanAtZoom(h)-l.descensionFactor*Math.LN2*p.compared.pan+p.halfWindowPanAtZoom(p.compared.targetZoom))*Math.log(h/p.compared.targetZoom)/(p.desiredPixelFlow*Math.LN2*p.halfWindowPanAtZoom(-h+p.compared.targetZoom))};p.dtDescensionZoomPan=
function(p,l,h){var d=Math.log(h/p.compared.targetZoom),u=1/p.desiredPixelFlow,r=1/Math.LN2,a=-h+p.compared.targetZoom,k=1/a;l=(-p.halfWindowPanAtZoom(h)-l.descensionFactor*Math.LN2*p.compared.pan+p.halfWindowPanAtZoom(p.compared.targetZoom))/p.halfWindowPanAtZoom(1);return-p.halfWindowSize*d*u*r*k+p.halfWindowSize*d*u*r*l/(a*a)+p.halfWindowSize*u*r*k*l/h};p.ddtDescensionZoomPan=function(p,l,h){var d=h-p.compared.targetZoom,u=1/d,r=1/h,a=Math.log(h/p.compared.targetZoom);l=(p.halfWindowPanAtZoom(h)+
l.descensionFactor*Math.LN2*p.compared.pan-p.halfWindowPanAtZoom(p.compared.targetZoom))/p.halfWindowPanAtZoom(1);return p.halfWindowSize*u*(-2*u*r*l-2*u*a+2*r+2*a*l/(d*d)-l/(h*h))/(p.desiredPixelFlow*Math.LN2)};p.tDescensionZoomOnly=function(p,l,h){return p.halfWindowSize*Math.log(h/p.compared.targetZoom)/(p.desiredPixelFlow*Math.LN2)};p.dtDescensionZoomOnly=function(p,l,h){return p.halfWindowSize/(h*p.desiredPixelFlow*Math.LN2)};p.ddtDescensionZoomOnly=function(p,l,h){return-p.halfWindowSize/(h*
h*p.desiredPixelFlow*Math.LN2)};p.tBaseLine=function(p){var l=Math.LN2*p.compared.pan,h=p.halfWindowPanAtZoom(p.compared.sourceZoom-p.compared.targetZoom),d=p.halfWindowSize*Math.log(p.compared.sourceZoom/p.compared.targetZoom)/(p.desiredPixelFlow*Math.LN2*h);return p.compared.sourceZoom<=p.compared.targetZoom?d*(l-h):d*(l+h)}})},"esri/views/3d/animation/pointToPoint/Camera":function(){define(["require","exports","../../lib/glMatrix","../../support/mathUtils"],function(A,p,w,l){Object.defineProperty(p,
"__esModule",{value:!0});var h=l.angle,d=l.lerp,u=l.slerpOrLerp,r=w.vec3d,a=w.mat3d,k=r.create(),c=r.create(),t=r.create(),C=r.create(),q=r.create(),v=r.create(),y=r.createFrom(0,0,1),B=r.createFrom(0,1,0),D=r.createFrom(1,0,0),b=a.create();A=function(){function l(a){void 0===a&&(a="global");this.viewingMode=a;this.center=r.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=r.create(B)}return l.prototype.pixelsPerPanAtZoom=function(a){return this.size/2/(this._zoomToPanScale*a)},l.prototype.zoomAtPixelsPerPan=
function(a){return this.size/2/(this._zoomToPanScale*a)},l.prototype.pixelsPerRotateAtZoom=function(a){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)},l.prototype.compareTo=function(a,b){if(b||(b={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),"global"===this.viewingMode){var c=r.length(this.center),d=r.length(a.center),c=(c+d)/2;b.pan=h(this.center,a.center)*c}else b.pan=r.dist(this.center,a.center);c=Math.abs(a.yaw-this.yaw);c>=Math.PI&&(c=2*Math.PI-c);return b.rotate=Math.max(c,Math.abs(a.pitch-
this.pitch)),b.sourceZoom=this.distance,b.targetZoom=a.distance,b},l.prototype.interpolate=function(a,b,c){"global"===this.viewingMode?u(a.center,b.center,c.pan,this.center,m):r.lerp(a.center,b.center,c.pan,this.center);this.distance=d(a.distance,b.distance,c.zoom);this.pitch=d(a.pitch,b.pitch,c.rotate);a=a.yaw;b=b.yaw;Math.abs(b-a)>=Math.PI&&(a+=2*(b>a?1:-1)*Math.PI);this.yaw=d(a,b,c.rotate)},l.prototype.copyFrom=function(a){r.set(a.center,this.center);this.pitch=a.pitch;this.yaw=a.yaw;this.distance=
a.distance;r.set(a.lookAtDirection,this.lookAtDirection);this.size=a.size;this.copyFromCommon(a);this.viewingMode=a.viewingMode},l.prototype.copyFromRenderCamera=function(c){var d=this._lookAtOrientation(c.center,b);r.set(c.center,this.center);a.multiplyVec3(d,r.subtract(c.center,c.eye,C));a.multiplyVec3(d,c.up,q);this.distance=r.length(C);C[0]/=this.distance;C[1]/=this.distance;C[2]/=this.distance;this.pitch=this._eyeUpToPitch(C,q);this.yaw=this._eyeUpToYaw(C,q);this.size=Math.sqrt(c.width*c.width+
c.height*c.height);this.copyFromCommon(c)},l.prototype.copyFromCommon=function(a){this.fov=a.fov;this._zoomToPanScale=Math.atan(.5*this.fov)},l.prototype.copyToRenderCamera=function(c){var d=this._lookAtOrientation(this.center,b);a.transpose(d);this._axisAngleVec3(D,this.pitch-Math.PI/2,B,C);this._axisAngleVec3(y,this.yaw,C);this._axisAngleVec3(D,this.pitch-Math.PI/2,y,q);this._axisAngleVec3(y,this.yaw,q);r.scale(C,this.distance);a.multiplyVec3(d,C);a.multiplyVec3(d,q);c.center=this.center;c.eye=
r.subtract(this.center,C,C);c.up=q},l.prototype._axisAngleVec3=function(a,b,d,m){void 0===m&&(m=d);var h=Math.cos(b);b=Math.sin(b);return r.scale(d,h,k),r.scale(r.cross(a,d,c),b),r.scale(a,(1-h)*r.dot(a,d),t),r.add(r.add(k,c,m),t,m)},l.prototype._lookAtOrientation=function(b,d){return this._upAtLookAt(b,t),r.normalize(r.cross(this.lookAtDirection,t,k)),0===k[0]&&0===k[1]&&0===k[2]&&r.set(D,k),r.normalize(r.cross(t,k,c)),d||(d=a.create()),d[0]=k[0],d[1]=c[0],d[2]=t[0],d[3]=k[1],d[4]=c[1],d[5]=t[1],
d[6]=k[2],d[7]=c[2],d[8]=t[2],d},l.prototype._upAtLookAt=function(a,b){return"local"===this.viewingMode?r.set(y,b):r.normalize(a,b)},l.prototype._eyeUpToPitch=function(a,b){return Math.PI-h(y,a)},l.prototype._eyeUpToYaw=function(a,b){return.5>Math.abs(b[2])?(r.set(b,v),0<a[2]&&r.scale(v,-1)):r.set(a,v),h(D,r.normalize(r.cross(v,y,c)),y)},l}();var m=1E-4;p["default"]=A})},"esri/views/3d/support/cameraUtils":function(){define("require exports dojo/_base/lang ../../../geometry/SpatialReference ../../../config ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../../../Camera ../webgl-engine/lib/Camera ../lib/glMatrix ./mathUtils ./earthUtils ./projectionUtils ./cameraUtilsPlanar ./cameraUtilsSpherical ../camera/intersectionUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y){function B(a){return"global"===a.viewingMode?v:q}function D(a,b,m){var g=a.renderSpatialReference,e=k.vec3d.set(b.viewForward,V),e=J(a,b.eye,e,b.up,Q);a=a.spatialReference||l.WGS84;return C.vectorToVector(b.eye,g,W,a)||(a=l.WGS84,C.vectorToVector(b.eye,g,W,a)),m?(m.position.x=W[0],m.position.y=W[1],m.position.z=W[2],m.position.spatialReference=a,m.heading=e.heading,m.tilt=e.tilt,m.fov=c.rad2deg(b.fov),m):new r(new d(W,a),e.heading,e.tilt,c.rad2deg(b.fov))}
function b(a,b,d){var g=a.state.camera,e=g.fovX,g=g.width/2;"global"===a.viewingMode&&null!=d&&(b*=Math.cos(c.deg2rad(d)));b/=a.renderCoordsHelper.unitInMeters;return g/(h.screenDPI*K/b)/Math.tan(e/2)}function m(a,b,d){var g=a.state.camera;b=h.screenDPI*K/(g.width/2/(b*Math.tan(g.fovX/2)));return"global"===a.viewingMode&&(b/=Math.cos(c.deg2rad(d))),b*=a.renderCoordsHelper.unitInMeters}function E(a,b,c,d,e,f){var g=a.renderSpatialReference;b=G(a,d.heading,d.tilt,b,c,e);return(a=C.vectorToPoint(b.eye,
g,a.spatialReference||l.WGS84))?f?(f.position=a,f.heading=b.heading,f.tilt=b.tilt,f.fov=d.fov,f):new r(a,b.heading,b.tilt,d.fov):null}function J(a,b,c,d,e){return B(a).directionToHeadingTilt(b,c,d,e)}function G(a,b,c,g,e,f){var m=k.vec3d.create(),h=a.renderSpatialReference;if(g)if(g instanceof d){var q=g;if(C.pointToVector(q,m,a.renderSpatialReference),null==q.z&&null!=a.basemapTerrain)q=a.basemapTerrain.getElevation(q),null!=q&&a.renderCoordsHelper.setAltitude(q,m)}else g&&k.vec3d.set(g,m);else k.vec3d.set(a.state.camera.center,
m);g&&g instanceof d||(g=C.vectorToPoint(m,h,a.spatialReference||l.WGS84));e=Math.max(e,a.state.constraints.minimumPoiDistance);h=c;c=e;if(!(q=f&&f.noReset))var q=g,v=a.engineToScreen(a.state.camera.center),t=a.toScreen(q),q=v.x-t.x,v=v.y-t.y,t=a.pointsOfInterest.centerOnSurfaceFrequent.distance,t=Math.log(Math.max(c,t)/Math.min(c,t))/Math.LN2,q=!(Math.sqrt(q*q+v*v)>M*Math.max(a.width,a.height)||t>U&&c>N);q?(h=B(a).eyeTiltToLookAtTilt(m,c,h),h=a.state.constraints.clampTilt(c,h),h=B(a).lookAtTiltToEyeTilt(m,
c,h)):(b=0,h=a.state.constraints.tilt(c).min);c=h;h=B(a).eyeForCenterWithHeadingTilt;b=h(m,e,b,c);m={eye:b.eye,up:b.up,center:m,heading:b.heading,tilt:b.tilt};if(b=!(f&&f.noReset||"global"!==a.viewingMode))b=a.renderCoordsHelper.fromRenderCoords(m.eye,S,a.spatialReference)?a.basemapTerrain&&(a.basemapTerrain.getElevation(S)||0)>S.z-1:!1;return b?(m=a.state.constraints.tilt(e).min,G(a,0,m,g,e,w.mixin({},f,{noReset:!0}))):m}Object.defineProperty(p,"__esModule",{value:!0});var K=39.37,M=5,U=8,N=8E5,
W=k.vec3d.create(),R=k.vec3d.create(),V=k.vec3d.create(),Q={heading:0,tilt:0},S=new d,X=new c.Cyclical(-2.0037508342788905E7,2.0037508342788905E7);p.externalToInternal=function(a,b){var d=a.renderSpatialReference,g=B(a).headingTiltToDirectionUp,e=k.vec3d.create();return C.pointToVector(b.position,e,d)?(d=g(e,b.heading,b.tilt),k.vec3d.add(d.direction,e),a=y.cameraOnContentAlongViewDirection(a,e,d.direction,d.up),a.fov=c.deg2rad(b.fov),a):null};p.internalToExternal=D;p.scaleToDistance=b;p.distanceToScale=
m;p.fromCenterScale=function(a,c,d,g,e,f){d=b(a,d,c.latitude);return E(a,c,d,g,e,f)};p.fromCenterDistance=E;p.directionToHeadingTilt=J;p.eyeHeadingTiltForCenterPointAtDistance=G;p.fromExtent=function(a,b,c,g,e,f){var k;e instanceof r?(f=e,k={noReset:!1}):k=e;var m,h="global"===a.viewingMode;e=a.renderSpatialReference;var q=a.spatialReference||l.WGS84,v=l.WebMercator,y=b.spatialReference||v,B=0;null!=b.zmax&&null!=b.zmin&&(m=(b.zmax+b.zmin)/2,B=b.zmax-b.zmin);if(h){var h=new d(b.xmin,b.ymin,y),D=new d(b.xmax,
b.ymax,y);if(h=u.project(h,v),D=u.project(D,v),null===h||null===D)return;b=new d(X.center(h.x,D.x),(D.y+h.y)/2,v);null!=m&&(b.z=m);m=t.getGreatCircleSpanAt(b,h,D);v=m.lon;y=m.lat;X.diff(h.x,D.x)>X.range/2&&(v+=t.halfEarthCircumference);v=Math.min(v,t.halfEarthCircumference);y=Math.min(y,t.halfEarthCircumference)}else u.canProject(b,q)&&(b=u.project(b,q)),v=b.xmax-b.xmin,y=b.ymax-b.ymin,b=new d({x:b.xmin+.5*v,y:b.ymin+.5*y,z:m,spatialReference:q});m=a.state.camera;c=G(a,c,g,b,Math.max(1/Math.tan(m.fovX/
2)*v*.5,1/Math.tan(m.fovY/2)*y*.5,1/Math.tan(m.fov/2)*B*.5)/1,k);return(g=C.vectorToPoint(c.eye,e,q))?(f||(f=new r),f.position=g,f.heading=c.heading,f.tilt=c.tilt,f.fov=a.camera.fov,f):null};p.toExtent=function(a,b,c,d,e){var f,g=a.renderSpatialReference;if(b||(c||(c=a.state.camera),b=D(a,c,e)),c)f=C.vectorToPoint(c.center,g,a.spatialReference||l.WGS84),e=c.distance;else{if(f=a.toMap(a.screenCenter),!f)return null;e=t.computeCarthesianDistance(b.position,f)}c||(c=a.state.camera);b=2*e*Math.tan(c.fovX/
2)*1;c=2*e*Math.tan(c.fovY/2)*1;return"global"===a.viewingMode?v.toExtent(a,f,b,c,d):q.toExtent(a,f,b,c,d)};p.scaleToZoom=function(a,b){return(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)?a.levelAtScale(b):void 0};p.zoomToScale=function(a,b){return(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)?a.scaleAtLevel(b):void 0};p.computeScale=function(b,c,d){var g=b.renderSpatialReference;c||(c=b.state.camera);var e,f,n=l.WGS84;return c instanceof a?(C.vectorToVector(c.center,g,R,n),e=R[1],f=c.distance):
(e=c.position.latitude,C.pointToVector(c.position,W,g),C.pointToVector(d,R,g),f=k.vec3d.dist(W,R)),m(b,f,e)}})},"esri/views/3d/support/cameraUtilsPlanar":function(){define("require exports ../../../geometry/Extent ./mathUtils ./projectionUtils ./cameraUtilsInternal ../lib/glMatrix".split(" "),function(A,p,w,l,h,d,u){function r(d,h,t){d=u.vec3d.create();var q=u.vec3d.create();return u.mat4d.identity(c),u.mat4d.rotateZ(c,-l.deg2rad(h)),u.mat4d.rotateX(c,l.deg2rad(t)),u.mat4d.multiplyVec3(c,k,d),u.vec3d.scale(d,
-1),u.mat4d.multiplyVec3(c,a,q),{direction:d,up:q}}Object.defineProperty(p,"__esModule",{value:!0});var a=u.vec3d.createFrom(0,1,0),k=u.vec3d.createFrom(0,0,1),c=u.mat4d.create(),t=u.vec3d.create(),C=u.vec3d.create();p.headingTiltToDirectionUp=r;p.directionToHeadingTilt=function(c,h,l,t){return d.directionToHeadingTilt(h,l,t,k,a)};p.eyeForCenterWithHeadingTilt=function(a,c,d,k){var h=r(a,d,k);a=u.vec3d.add(u.vec3d.scale(h.direction,-c,u.vec3d.create()),a);return{up:h.up,eye:a,heading:d,tilt:k}};p.lookAtTiltToEyeTilt=
function(a,c,d){return l.rad2deg(d)};p.eyeTiltToLookAtTilt=function(a,c,d){return l.deg2rad(d)};p.toExtent=function(a,c,d,k,l){var b=a.renderSpatialReference;a=a.map&&a.spatialReference||c.spatialReference;return h.pointToVector(c,t,b),h.pointToVector(c,C,b),t[0]-=d/2,C[0]+=d/2,t[1]-=k/2,C[1]+=k/2,h.vectorToVector(t,b,t,a),h.vectorToVector(C,b,C,a),l?(l.xmin=t[0],l.ymin=t[1],l.xmax=C[0],l.ymax=C[1],l.spatialReference=a):l=new w(t[0],t[1],C[0],C[1],a),l}})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["require",
"exports","./mathUtils","../lib/glMatrix"],function(A,p,w,l){Object.defineProperty(p,"__esModule",{value:!0});var h=l.vec3d.create(),d=l.vec3d.create();p.directionToHeadingTilt=function(u,r,a,k,c){var t=h;l.vec3d.normalize(u,t);var C=l.vec3d.dot(t,k),q=0<C,C=Math.abs(C);.99<C&&(C=Math.abs(l.vec3d.dot(r,k)),.99>C?(l.vec3d.set(r,t),q&&l.vec3d.scale(t,-1)):t=null);r=0;t&&(l.vec3d.scale(k,l.vec3d.dot(k,t),d),l.vec3d.subtract(t,d),r=l.vec3d.dot(t,c)/(l.vec3d.length(t)*l.vec3d.length(c)),l.vec3d.cross(t,
c,d),r=(0<l.vec3d.dot(d,k)?1:-1)*w.rad2deg(w.acos(r)));u=w.rad2deg(w.acos(-l.vec3d.dot(k,u)/l.vec3d.length(u)));return a?(a.heading=r,a.tilt=u,a):{heading:r,tilt:u}}})},"esri/views/3d/support/cameraUtilsSpherical":function(){define("require exports ../../../geometry/SpatialReference ../../../geometry/Extent ../../../geometry/support/webMercatorUtils ./mathUtils ./earthUtils ./cameraUtilsInternal ../lib/glMatrix".split(" "),function(A,p,w,l,h,d,u,r,a){function k(b,c,k){var m=a.vec3d.create(),h=a.vec3d.create();
return a.vec3d.cross(b,C,B),0===a.vec3d.dot(B,B)&&a.vec3d.cross(b,q,B),a.mat4d.identity(y),a.mat4d.rotate(y,-d.deg2rad(c),b),a.mat4d.rotate(y,-d.deg2rad(k),B),a.vec3d.cross(B,b,h),a.vec3d.normalize(h),a.mat4d.multiplyVec3(y,h),a.vec3d.normalize(b,m),a.mat4d.multiplyVec3(y,a.vec3d.negate(m)),{direction:m,up:h}}function c(a){var b=a[1];a[1]=-a[2];a[2]=b}function t(a,c){c=k(c,a.heading,a.tilt);return a.up=c.up,a}Object.defineProperty(p,"__esModule",{value:!0});var C=a.vec3d.createFrom(0,0,1),q=a.vec3d.normalize(a.vec3d.createFrom(1,
1,1)),v=new d.Cyclical(-180,180),y=a.mat4d.create(),B=a.vec3d.create(),D=a.vec3d.create();p.headingTiltToDirectionUp=k;p.directionToHeadingTilt=function(b,c,d,k){var m=B;return a.vec3d.normalize(b,m),a.vec3d.cross(m,C,D),0===a.vec3d.dot(D,D)&&a.vec3d.cross(m,q,D),a.vec3d.cross(D,m,D),r.directionToHeadingTilt(c,d,k,m,D)};p.eyeForCenterWithHeadingTilt=function(b,k,h,l){var m={eye:a.vec3d.create(),up:null,tilt:l,heading:h},q=B;q[0]=b[0];q[1]=b[2];q[2]=-b[1];var v;h=d.deg2rad(h);v=d.deg2rad(l);l=Math.sin(h);
h=Math.cos(h);var r=Math.sin(v),y=Math.cos(v),u=a.vec3d.length(q);if(1E-8>Math.abs(v))v=k+u;else{var C=u/r,D=d.asin(k/C);v=C*Math.sin(Math.PI-v-D)}var C=r*k,y=y*k,D=h*C,p=v-y,E=p*p,w=k*k*r*r,r=h*h*w,w=l*l*w,z=q[1]*p,J=r*(r+E-q[1]*q[1]);if(0>J)return a.vec3d.scale(q,v/u,m.eye),m.tilt=0,m;var A=Math.sqrt(J),J=r+E;if(z=0<h?-A+z:A+z,1E-8>Math.abs(J))return 1E-8>u?(m.eye[0]=0,m.eye[1]=0,m.eye[2]=k):a.vec3d.scale(q,v/u,m.eye),m.tilt=0,c(m.eye),t(m,b);m.eye[1]=z/J;J=m.eye[1]*m.eye[1];k=1-J;z=Math.sqrt(k);
D=r*J+w-2*D*m.eye[1]*z*p+k*E;return 1E-8>Math.abs(D)?(a.vec3d.scale(q,v/u,m.eye),m.tilt=0,c(m.eye),t(m,b)):(m.eye[0]=(k*(v*q[0]-y*q[0])-C*z*(q[0]*m.eye[1]*h+q[2]*l))/D,m.eye[2]=(k*(v*q[2]-y*q[2])-C*z*(q[2]*m.eye[1]*h-q[0]*l))/D,a.vec3d.scale(m.eye,v),c(m.eye),t(m,b))};p.lookAtTiltToEyeTilt=function(b,c,k){b=a.vec3d.length(b);c=d.asin(c/(Math.sqrt(c*c+b*b-2*c*b*Math.cos(Math.PI-k))/Math.sin(k)));return d.rad2deg(k-c)};p.eyeTiltToLookAtTilt=function(b,c,k){k=d.deg2rad(k);b=a.vec3d.length(b);return d.asin(c/
(b/Math.sin(k)))+k};p.toExtent=function(a,c,k,q,t){function b(a){var b=Math.PI/2;return a=d.cyclical2PI.normalize(a,-b),a>b&&(a=Math.PI-a),a}var m,r,y=c.latitude;c=c.longitude;var B=u.getLonDeltaForDistance(c,y,k)/2;k=c-B;c+=B;var B=d.deg2rad(y),y=u.earthRadius,B=(1+Math.sin(B))/(1-Math.sin(B)),C=(B+1)*Math.tan(q/y/2);if(m=1.5*Math.PI-2*Math.atan(.5*(C+Math.sqrt(4*B+C*C))),r=m+q/y,m=b(m),r=b(r),m>r)m=r=m;if(m=Math.max(d.rad2deg(m),-90),r=Math.min(d.rad2deg(r),90),c=v.monotonic(k,c),180<c-k)q=(c-k-
180)/2,k+=q,c-=q;return t?(t.xmin=k,t.ymin=m,t.xmax=c,t.ymax=r,t.spatialReference=w.WGS84):t=new l(k,m,c,r,w.WGS84),a.spatialReference&&a.spatialReference.isWebMercator&&h.geographicToWebMercator(t,!1,t),t}})},"esri/views/3d/camera/intersectionUtils":function(){define("require exports ../../../geometry/Point ../lib/glMatrix ../support/aaBoundingRect ../support/earthUtils ../webgl-engine/lib/Selector".split(" "),function(A,p,w,l,h,d,u){function r(c,k,h,t){void 0===t&&(t=l.vec3d.create());var q=a[c.viewingMode];
q||(q=new u(c.viewingMode),q.enableBackfacesTerrain=!c.state.isGlobal,q.enableInvisibleTerrain=!0,a[c.viewingMode]=q);c._stage.pickRay(k,h,null,null,null,null,q);if((q=q.getMinResult())&&q.getIntersectionPoint(t))return t;q=l.vec3d.direction(h,k,C);if(!c.renderCoordsHelper.intersectManifold(k,q,0,t))if("global"===c.viewingMode){c=t;var q=l.vec3d.dot(k,k),b=d.earthRadius*d.earthRadius,q=q>b?Math.sqrt(q-b)/3:1;l.vec3d.subtract(h,k,c);l.vec3d.scale(c,q/l.vec3d.length(c),c);l.vec3d.add(c,k)}else h!==
t&&l.vec3d.set(h,t);return t}Object.defineProperty(p,"__esModule",{value:!0});p.eyeWithinExtent=function(a,c,d,l){return a.renderCoordsHelper.fromRenderCoords(c.eye,k,l)&&h.containsPoint(d,k)};p.surfaceElevationBelowEye=function(a,c){return a.renderCoordsHelper.fromRenderCoords(c.eye,t,a.basemapTerrain.spatialReference)?a.basemapTerrain.getElevation(t)||0:0};p.cameraOnContentAlongViewDirection=function(a,d,k,h){var q=a.state.camera.copy();d&&(q.eye=d);k&&(q.center=k);h&&(q.up=h);r(a,q.eye,q.center,
c);k=a.state.constraints;h=k.minimumPoiDistance;l.vec3d.dist2(q.eye,c)<h&&(d=k.collision.enabled,l.vec3d.set(q.viewForward,C),l.vec3d.scale(C,h),d?l.vec3d.subtract(c,C,q.eye):l.vec3d.add(q.eye,C,c),a=a.renderCoordsHelper,h=a.getAltitude(q.eye),k=k.collision.elevationMargin,d&&k>h&&(l.vec3d.subtract(c,q.eye,C),a.setAltitude(k,q.eye),l.vec3d.add(q.eye,C,c)));return q.center=c,q};p.contentAlongViewDirection=r;var a={},k=l.vec3d.create(),c=l.vec3d.create(),t=new w,C=l.vec3d.create()})},"esri/views/3d/webgl-engine/lib/Selector":function(){define("require exports dojo/has ./PerformanceTimer ./gl-matrix ./Object3D".split(" "),
function(A,p,w,l,h,d){var u=h.vec3d.create(),r=h.vec3d.create(),a=w("dojo-debug-messages");A=function(){function d(d,q,v,t,r,u,b,m){void 0===m&&(m=!1);this.dir=h.vec3d.create();this.normalDir=null;this.minResult=new k;this.maxResult=new k;this.transform=h.mat4d.create();this._transformInverse=new c({value:this.transform},h.mat4d.inverse,h.mat4d.create);this._transformInverseTranspose=new c(this._transformInverse,h.mat4d.transpose,h.mat4d.create);this._transformTranspose=new c({value:this.transform},
h.mat4d.transpose,h.mat4d.create);this._transformInverseRotation=new c({value:this.transform},h.mat4d.toInverseMat3,h.mat3d.create);this.enableTerrain=this.enableHUDSelection=!0;this.enableInvisibleTerrain=!1;this.enableBackfacesTerrain=!0;this.performanceInfo={queryDuration:0,numObjectsTested:0};this.viewingMode=d||"global";this.intersectObject=this.intersectObject.bind(this);a&&(this.timer=new l(1));this.init(q,v,t,r,u,b,m)}return d.prototype.init=function(c,d,k,l,t,r,b){if(d&&k&&h.vec3d.subtract(k,
d,this.dir),this.minResult.init(d,k),this.maxResult.init(d,k),this.numObjectsTested=0,this.point=l,this.camera=t,this.isSelection=b,this.layers=c,this.p0=d,this.p1=k,this.hudResults=[],null==r&&(r=1E-5),this.tolerance=r,this.layers){a&&this.timer.start();for(c=0;c<this.layers.length;++c)if(d=this.layers[c],k=d.getSpatialQueryAccelerator?d.getSpatialQueryAccelerator():void 0)k.forEachAlongRay(this.p0,this.dir,this.intersectObject);else for(d=d.getObjects(),k=0;k<d.length;++k)this.intersectObject(d[k]);
a&&(this.timer.stop(),this.performanceInfo.queryDuration=this.timer.getLast(),this.performanceInfo.numObjectsTested=this.numObjectsTested)}},Object.defineProperty(d.prototype,"transformInverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"transformInverseTranspose",{get:function(){return this._transformInverseTranspose.value},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"transformInverseRotation",{get:function(){return this._transformInverseRotation.value},
enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"transformTranspose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0}),d.prototype.getDirection=function(){return this.normalDir||(this.normalDir=h.vec3d.create(),h.vec3d.normalize(this.dir,this.normalDir)),this.normalDir},d.prototype.intersectObject=function(a){var c=this;this.numObjectsTested++;for(var d,l=a.getId(),t=a.getGeometryRecords(),C=a.objectTransformation,b=0;b<t.length;b++){var m=t[b],
p=m.geometry,w=m.materials,G=m.instanceParameters;d=p.getId();h.mat4d.set(C,this.transform);h.mat4d.multiply(this.transform,m.getShaderTransformation());this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate();h.mat4d.multiplyVec3(this.transformInverse,this.p0,u);h.mat4d.multiplyVec3(this.transformInverse,this.p1,r);w[0].intersect(p,G,this.transform,this,u,r,function(b,m,h,q,v,t){0<=b&&(v?(v=
new k,v.init(c.p0,c.p1),v.set(a,l,b,m,q,t,d,h),c.hudResults.push(v)):((null==c.minResult.priority||q>=c.minResult.priority)&&(null==c.minResult.dist||b<c.minResult.dist)&&c.minResult.set(a,l,b,m,q,null,d,h),(null==c.maxResult.priority||q>=c.maxResult.priority)&&(null==c.maxResult.dist||b>c.maxResult.dist)&&c.maxResult.set(a,l,b,m,q,null,d,h)))},m.customTransformation)}},d.prototype.getMinResult=function(){return this.minResult},d.prototype.getMaxResult=function(){return this.maxResult},d.prototype.getHudResults=
function(){return this.hudResults},d.DEFAULT_TOLERANCE=1E-5,d}();var k=function(){function a(a,c){this.normal=h.vec3d.create();this.init(a,c)}return a.prototype.getIntersectionPoint=function(a){return null==this.dist?!1:(h.vec3d.lerp(this.p0,this.p1,this.dist,a),!0)},a.prototype.set=function(a,c,k,l,t,r,b,m){this.dist=k;h.vec3d.set(l,this.normal);a?this.targetType=a instanceof d?"StageObject":"StagePoint":this.targetType="None";this.target=a;this.name=c;this.priority=t;this.center=r?h.vec3d.create(r):
null;this.geometryId=b;this.triangleNr=m},a.prototype.copyFrom=function(a){this.p0=a.p0;this.p1=a.p1;this.dist=a.dist;this.targetType=a.targetType;this.target=a.target;this.name=a.name;this.priority=a.priority;this.center=a.center?h.vec3d.create(a.center):null;this.geometryId=a.geometryId;this.triangleNr=a.triangleNr;this.intersector=a.intersector;h.vec3d.set(a.normal,this.normal)},a.prototype.setIntersector=function(a){this.intersector=a},a.prototype.init=function(a,c){this.dist=void 0;this.targetType=
"None";this.priority=this.name=this.target=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="stage";this.p0=a;this.p1=c},a}(),c=function(){function a(a,c,d){this.original=a;this.update=c;this.dirty=!0;this.transform=d()}return a.prototype.invalidate=function(){this.dirty=!0},Object.defineProperty(a.prototype,"value",{get:function(){return this.dirty&&(this.update(this.original.value,this.transform),this.dirty=!1),this.transform},enumerable:!0,configurable:!0}),a}();return A})},
"esri/views/3d/webgl-engine/lib/PerformanceTimer":function(){define(["require","exports","./Util"],function(A,p,w){return function(){function l(h){this._filterSampleIndex=0;this._lastTime=NaN;this._numMeasurements=this._totalTime=0;this._filterSamples=Array(h);this.reset();this._filterSize=h}return l.prototype.reset=function(){for(var h=this._filterSampleIndex=0;h<this._filterSize;h++)this._filterSamples[h]=NaN},l.prototype.start=function(){this._tsStart=w.performance.now()},l.prototype.stop=function(){return this._lastTime=
w.performance.now()-this._tsStart,this._totalTime+=this._lastTime,this._numMeasurements++,this._filterSize&&(this._filterSamples[this._filterSampleIndex]=this._lastTime,this._filterSampleIndex=(this._filterSampleIndex+1)%this._filterSize),this._lastTime},l.prototype.getLast=function(){return this._lastTime},l.prototype.getLastFiltered=function(){for(var h=0,d=0;d<this._filterSamples.length;d++)h+=this._filterSamples[d];return h/this._filterSamples.length},l.prototype.getAverage=function(){return this._totalTime/
this._numMeasurements},l.prototype.getTotal=function(){return this._totalTime},l.prototype.getNumMeasurements=function(){return this._numMeasurements},l}()})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("require exports ./IdGen ./Util ./gl-matrix ./ComponentUtils ./HighlightUtils ./ModelContentType ./GeometryRecord".split(" "),function(A,p,w,l,h,d,u,r,a){var k=l.assert,c=h.mat4d,t=h.vec3d,C=c.identity();A=function(){function h(a){void 0===a&&(a={});this._bvObjectSpace=new q;this._bvWorldSpace=
new q;this._bvDirty=!0;this._hasVolatileTransformation=!1;this.id=h._idGen.gen(a.idHint);this.name=a.name;this.castShadow=null!=a.castShadow?a.castShadow:!0;this.metadata=a.metadata;this.objectTransformation=c.identity();this._initializeGeometryRecords(a.geometries,a.materials,a.transformations)}return h.prototype._initializeGeometryRecords=function(d,h,l){if(!Array.isArray(d))return this.geometryRecords=[],void(this.geometries=[]);k(h.length===d.length,"Object3D: materials don't match geometries");
k(l.length===d.length,"Object3D: transformations don't match geometries");this.geometryRecords=Array(d.length);this.geometries=d.slice();for(var b=0;b<d.length;b++)k(Array.isArray(h[b]),"Object3D: materials parameter must be array of array"),this.geometryRecords[b]=new a(d[b],h[b].slice(),c.create(l[b]),{});this._hasVolatileTransformation=!1},h.prototype.getId=function(){return this.id},Object.defineProperty(h.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(a){k(null==
this._parentLayer||null==a,"Object3D can only be added to a single Layer");this._parentLayer=a},enumerable:!0,configurable:!0}),h.prototype.getParentLayer=function(){return this.parentLayer},h.prototype.addParentLayer=function(a){this.parentLayer=a},h.prototype.removeParentLayer=function(a){this.parentLayer=null},h.prototype.getNumGeometryRecords=function(){return this.geometryRecords.length},h.prototype.getFirstGeometryIndex=function(a){a=this.geometries.indexOf(a);return k(-1<a,"Object3D.getFirstGeometryIndex: geometry not found"),
a},h.prototype.findGeometryRecords=function(a){for(var c=[],d=0;d<this.geometries.length;d++)this.geometries[d]===a&&c.push(this.geometryRecords[d]);return c},h.prototype.getGeometryRecord=function(a){return k(0<=a&&a<this.geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range"),this.geometryRecords[a]},h.prototype.getGeometryRecords=function(){return this.geometryRecords},h.prototype.addGeometry=function(d,h,l,b,m,q){void 0===l&&(l=C);k(Array.isArray(h),"Object3D.addGeometry: materials must be array");
this.geometries.push(d);d=new a(d,h.slice(),c.create(l),b||{},m,q);return this.geometryRecords.push(d),this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.customTransformation}),this._notifyDirty("objGeometryAdded",d),this._invalidateBoundingVolume(),d},h.prototype.hasGeometry=function(a){return-1<this.geometries.indexOf(a)},h.prototype.removeGeometry=function(a){var c=this.geometryRecords.splice(a,1)[0];return this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.customTransformation}),
this.geometries.splice(a,1),this._notifyDirty("objGeometryRemoved",c),this._invalidateBoundingVolume(),c},h.prototype.removeAllGeometries=function(){for(;0<this.getNumGeometryRecords();)this.removeGeometry(0)},h.prototype.geometryVertexAttrsUpdated=function(a){this._notifyDirty("vertexAttrsUpdated",this.geometryRecords[a]);this._invalidateBoundingVolume()},h.prototype.geometryColorAttrsUpdated=function(a){this._notifyDirty("colorAttrsUpdated",this.geometryRecords[a])},h.prototype.isAllHidden=function(){for(var a=
0,c=this.geometryRecords;a<c.length;a++){var k=c[a],b=k.instanceParameters.componentVisibilities,k=k.geometry.getData().componentOffsets;if(!d.isAllHidden(b,k))return!1}return!0},h.prototype.isAllVisible=function(){for(var a=0,c=this.geometryRecords;a<c.length;a++){var k=c[a],b=k.instanceParameters.componentVisibilities,k=k.geometry.getData().componentOffsets;if(!d.isAllVisible(b,k))return!1}return!0},h.prototype.hasComponents=function(){for(var a=!1,c=0;c<this.geometries.length&&!(a=this.geometries[c].getData(),
a=d.hasComponents(a.componentOffsets));c++);return a},h.prototype.setComponentVisibility=function(a,c,k){var b=a.instanceParameters.componentVisibilities,m=a.geometry.getData().componentOffsets;c=d.updateVisibility(b,m,c,k);a.instanceParameters.componentVisibilities=c;this._notifyDirty("componentVisibilityChanged",a)},h.prototype.getComponentVisibility=function(a,c){return d.getVisibility(a.instanceParameters.componentVisibilities,c)},h.prototype.hideAllComponents=function(){for(var a=0,c=this.geometryRecords;a<
c.length;a++){var k=c[a],b=d.hideAllComponents(k.instanceParameters.componentVisibilities);k.instanceParameters.componentVisibilities=b}this._notifyDirty("componentVisibilityChanged")},h.prototype.unhideAllComponents=function(){for(var a=0,c=this.geometryRecords;a<c.length;a++){var k=c[a],b=d.unhideAllComponents(k.instanceParameters.componentVisibilities);k.instanceParameters.componentVisibilities=b}this._notifyDirty("componentVisibilityChanged")},h.prototype._setComponentHighlight=function(a,c,k,
b){c=d.addHighlight(a.instanceParameters.componentHighlights,c,k,b);a.instanceParameters.componentHighlights=c},h.prototype.setComponentHighlight=function(a,c,d){var b=u.generateHighlightId();return this._setComponentHighlight(a,c,d,b),this._notifyDirty("componentHighlightChanged"),b},h.prototype.highlightAllComponents=function(a){for(var c=u.generateHighlightId(),d=0,b=this.geometryRecords;d<b.length;d++)this._setComponentHighlight(b[d],null,a,c);return this._notifyDirty("componentHighlightChanged"),
c},h.prototype.removeHighlights=function(a){for(var c=0,k=this.geometryRecords;c<k.length;c++){var b=k[c].instanceParameters,m=d.removeHighlight(b.componentHighlights,a);b.componentHighlights=m}this._notifyDirty("componentHighlightChanged")},h.prototype.getComponentFromTriangleNr=function(a,c){k(0<=a&&a<this.geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");a=this.geometryRecords[a].geometry.getData().componentOffsets;return d.componentFind(a,3*c)},h.prototype.setGeometryTransformation=
function(d,h){k(0<=d&&d<this.geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var l=this.geometryRecords[d];h=new a(l.geometry,l.materials,c.create(h),l.instanceParameters);this.geometryRecords[d]=h;this._notifyDirty("objGeometryReplaced",[l,h]);this._invalidateBoundingVolume()},h.prototype.getObjectTransformation=function(){return c.create(this.objectTransformation)},h.prototype.setObjectTransformation=function(a){c.set(a,this.objectTransformation);this._invalidateBoundingVolume();
this._notifyDirty("objTransformation")},h.prototype.getCombinedStaticTransformation=function(a,d){return d=d||c.create(),c.multiply(this.objectTransformation,a.getStaticTransformation(),d),d},h.prototype.getCombinedShaderTransformation=function(a,d){return d=d||c.create(),c.multiply(this.objectTransformation,a.getShaderTransformation(),d),d},h.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation},h.prototype.getCastShadow=function(){return this.castShadow},h.prototype.setCastShadow=
function(a){this.castShadow=a},h.prototype.getMetadata=function(){return this.metadata},h.prototype.getName=function(){return this.name},h.prototype.getBBMin=function(a){return this._validateBoundingVolume(),a?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin},h.prototype.getBBMax=function(a){return this._validateBoundingVolume(),a?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax},h.prototype.getCenter=function(a){return this._validateBoundingVolume(),a?this._bvObjectSpace.center:this._bvWorldSpace.center},
h.prototype.getBSRadius=function(a){return this._validateBoundingVolume(),a?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius},h.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var a=0;a<this.geometryRecords.length;++a){var d=this.geometries[a],k=this.geometryRecords[a],d=d.getBoundingInfo();this._calculateTransformedBoundingVolume(d,this._bvObjectSpace,k.getShaderTransformation());this._calculateTransformedBoundingVolume(d,
this._bvWorldSpace,this.getCombinedShaderTransformation(k))}t.lerp(this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5,this._bvObjectSpace.center);t.lerp(this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5,this._bvWorldSpace.center);for(var k=t.create(),b=t.create(),m=this._getScaleFactor(this.objectTransformation),a=0;a<this.geometryRecords.length;++a){var d=this.geometries[a],h=this.geometryRecords[a].getShaderTransformation(),l=this._getScaleFactor(h),d=d.getBoundingInfo();c.multiplyVec3(h,
d.getCenter(),k);h=t.dist(k,this._bvObjectSpace.center);d=d.getBSRadius()*l;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,h+d);c.multiplyVec3(this.objectTransformation,k,b);l=t.dist(b,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,l+d*m)}this._bvDirty=!1}},h.prototype._calculateTransformedBoundingVolume=function(a,d,k){var b=a.getBBMin();a=a.getBBMax();for(var m=t.create(),h=t.create(),l=-1;3>l;++l){t.set(b,m);t.set(a,h);-1<l&&(m[l]=
a[l],h[l]=b[l]);c.multiplyVec3(k,m);c.multiplyVec3(k,h);for(var q=0;3>q;++q)d.bbMin[q]=Math.min(d.bbMin[q],m[q],h[q]),d.bbMax[q]=Math.max(d.bbMax[q],m[q],h[q])}},h.prototype._getScaleFactor=function(a){return Math.max(Math.max(Math.sqrt(a[0]*a[0]+a[4]*a[4]+a[8]*a[8]),Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])),Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))},h.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0;this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace)},
h.prototype._notifyDirty=function(a,c,d,b){this._parentLayer&&(d=d||r.OBJECT,this._parentLayer.notifyDirty(a,c,d,b||this))},h._idGen=new w,h}();var q=function(){function a(){this.bbMin=t.create();this.bbMax=t.create();this.center=t.create();this.bsRadius=0}return a.prototype.init=function(){t.set3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.bbMin);t.set3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.bbMax);t.set3(0,0,0,this.center);this.bsRadius=0},a.prototype.getCenter=function(){return this.center},
a.prototype.getBSRadius=function(){return this.bsRadius},a}();return A})},"esri/views/3d/webgl-engine/lib/IdGen":function(){define(["require","exports"],function(A,p){return function(){function p(){this._count=0}return p.prototype.gen=function(l){return null==l&&(l="a"),l+"_"+this._count++},p}()})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["require","exports","../../../../core/arrayUtils"],function(A,p,w){function l(a,c){if(null!=a){var b=a.isVisibleBit,d=a.data,k=8*d.BYTES_PER_ELEMENT;
return d.length*k>c?C(b,d,c,k):!a.isVisibleBit}return!0}function h(a){return null===a.component?-1:a.component}function d(a,c,b,d,k){l(c,d)&&u(a,c,b,b[d],b[d+1]-1,k)}function u(a,c,b,d,k,h){b=(c=0<a.length?a[a.length-1]:null)?c.range[1]:-1;var m=c?c.options:null;b>=d||(b+1===d&&m===h?c.range[1]=k:a.push({range:[d,k],options:h}))}function r(a){return void 0===a&&(a=!0),{isVisibleBit:!a,data:new Uint32Array(0)}}function a(a,d){return c(a,d,!0)}function k(a,d){return c(a,d,!1)}function c(a,c,b){var d=
!1;a=a||v;d=a.isVisibleBit;a=a.data;c=q(c);var k=8*a.BYTES_PER_ELEMENT,h=a.length*k;b=b===d;if(0===a.length||0===c)d=!b;else if(c>h&&!b)d=!0;else{for(var l=y[k],h=y[0],t=0;t<a.length-1;t++)if(d=!b&&a[t]!==l||b&&a[t]!==h)return d;d=a.length-1;c=y[(c-1)%k+1];d=!b&&(a[d]&c)!==c||b&&(a[d]&c)!==h}return d}function t(a){return 0<a.length}function C(a,c,b,d){var k=b/d|0;return 0!==(c[k]&1<<b-k*d)===a}function q(a){return Math.max(0,a.length-1)}Object.defineProperty(p,"__esModule",{value:!0});p.updateVisibility=
function(a,c,b,d){if(b<q(c)){null==a&&(a=r());var k=a.isVisibleBit,m=a.data,h=8*m.BYTES_PER_ELEMENT,l=b/h|0,v=b-h*l;c=(q(c)-1)/h|0;var t=m;d=d===k;t.length*h>b||!d||(b=Math.max(l+1,Math.ceil(1.5*t.length)),b=Math.min(b,c+1),m=new Uint32Array(b),m.set(t));l<m.length&&(m[l]=m[l]&~(1<<v)|(d?1:0)<<v);a.data=m}return a};p.getVisibility=l;p.hideAllComponents=function(a){if(null==a)a=r(!1);else{a.isVisibleBit=!0;for(var c=0;c<a.data.length;c++)a.data[c]=0}return a};p.unhideAllComponents=function(a){var c;
if(null!=a)for(c=a,c.isVisibleBit=!1,a=0;a<c.data.length;a++)c.data[a]=0;return c};p.generateVisibleIndexRanges=function(a,c){var b;if(a)if(t(c))if(0===a.data.length)b=[],c=[[c[0],c[c.length-1]-1]],b=a.isVisibleBit?b:c;else{b=[];for(var d=a.isVisibleBit,k=a.data,h=8*k.BYTES_PER_ELEMENT,l=k.length*h,v=q(c),r=!1,y=0;l>y&&v>y;y++){var u=C(d,k,y,h);if(u!==r){var B=c[y];u?b.push([B,0]):(r=b[b.length-1],r[1]=B-1);r=u}}a=!a.isVisibleBit;v>l&&a&&!r?b.push([c[l],c[v]-1]):r&&(r=b[b.length-1],r[1]=c[a?v:Math.min(v,
l)]-1)}else b=[],b=a.isVisibleBit?b:null;else b=null;return b};p.addHighlight=function(a,c,b,d){a=a||[];c={component:c,options:b,id:d};a.push(c);c=h(c);for(b=a.length-1;0<b&&c<h(a[b-1]);)d=[a[b],a[b-1]],a[b-1]=d[0],a[b]=d[1],--b;return a};p.removeHighlight=function(a,c){return a?(a=a.filter(function(a){return a.id!==c}),0===a.length?null:a):a};p.generateHighlightedIndexRanges=function(a,c,b){if(c){if(t(b)){for(var m=b[0],h=b[b.length-1]-1,l=[],v=!k(a,b),r=0;r<c.length;++r){var y=c[r].options,B=c[r].component;
if(null!==B)d(l,a,b,B,y);else if(v)u(l,a,b,m,h,y);else for(B=0;B<q(b);++B)d(l,a,b,B,y)}return 0<l.length?l:null}return(v=!a||!a.isVisibleBit)?c.map(function(a){return{range:null,options:a.options}}):null}return null};p.defaultVisibilities=r;p.isAllVisible=function(a,c){return!k(a,c)};p.isAllHidden=function(c,d){return!a(c,d)};p.hasVisible=a;p.hasHidden=k;var v=r();p.createOffsets=function(a){return Array.isArray(a)?new Uint32Array(a):a};p.hasComponent=function(a,c){return c<q(a)};p.hasComponents=
t;var y=[];for(A=0;65>A;A++)y.push(Math.pow(2,A)-1);p.componentCount=q;p.componentFind=function(a,c){a=w.binaryIndexOf(a,c,!0);return 0<=a?a:null}})},"esri/views/3d/webgl-engine/lib/HighlightUtils":function(){define(["require","exports","./IdGen"],function(A,p,w){Object.defineProperty(p,"__esModule",{value:!0});var l=new w;p.generateHighlightId=function(){return l.gen("highlight")}})},"esri/views/3d/webgl-engine/lib/ModelContentType":function(){define(["require","exports"],function(A,p){return function(){function p(){}
return p.LAYER="layers",p.OBJECT="objects",p.GEOMETRY="geometries",p.MATERIAL="materials",p.TEXTURE="textures",p}()})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define(["require","exports","./IdGen"],function(A,p,w){return function(){function l(h,d,u,r,a,k){this.id=l._idGen.gen(h.getId());this.geometry=h;this.materials=d;this.transformation=u;this.instanceParameters=r;this.origin=a;this.customTransformation=k}return l.prototype.getId=function(){return this.id},l.prototype.getStaticTransformation=
function(){return this.transformation},l.prototype.getShaderTransformation=function(){return this.customTransformation?this.customTransformation(this.transformation):this.transformation},l._idGen=new w,l}()})},"esri/views/3d/support/viewpointUtils":function(){define("require exports ../../../geometry/SpatialReference ../../../geometry/Point ../../../geometry/Extent ../../../geometry/Geometry ../../../geometry/support/webMercatorUtils ../../../core/Error ../../../core/promiseUtils ../../../Camera ../../../Viewpoint ../../../Graphic ../lib/glMatrix ./mathUtils ./projectionUtils ../camera/intersectionUtils ./cameraUtils ./aaBoundingBox ./aaBoundingRect ./intersectionUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m){function E(a){return 360-q.cyclicalDeg.normalize(a)}function J(a){return q.cyclicalDeg.normalize(360-a)}function G(a,e,b){if(!e)return null;var c=a.spatialReference||w.WGS84;if(e.camera){a=e.get("camera.position.spatialReference");if(!u.canProject(a,c))return null;e=e.camera.clone();return a.equals(c)||(e.position=u.project(e.position,c)),e}var f=e.get("targetGeometry.spatialReference");if(f&&!u.canProject(f,c))return null;var f=B.internalToExternal(a,
a.state.camera),d={noReset:!1};if(null!=e.rotation&&(f.heading=E(e.rotation),d.noReset=!0),null!=b&&(f.tilt=b),"point"===e.targetGeometry.type){b=e.targetGeometry;var g=void 0,m=e.targetGeometry.clone(),g=null!=e.scale?B.scaleToDistance(a,e.scale,b.latitude):a.state.camera.distance;e=B.eyeHeadingTiltForCenterPointAtDistance(a,f.heading,f.tilt,m,g,d);c=v.vectorToPoint(e.eye,a.renderSpatialReference,c);return new k(c,e.heading,e.tilt,f.fov)}return B.fromExtent(a,e.targetGeometry.extent,f.heading,f.tilt,
d)}function K(a,e,b){e=b.scale;return null==e&&null!=b.zoom&&(e=B.zoomToScale(a,b.zoom)),e}function M(a,e){var b=!1;return null!=e.heading?(a.heading=e.heading,b=!0):null!=e.rotation&&(a.heading=E(e.rotation),b=!0),null!=e.tilt&&(a.tilt=e.tilt,b=!0),null!=e.fov&&(a.fov=e.fov),b}function U(a,e,b){var c=a.spatialReference||w.WGS84;return e=e||B.externalToInternal(a,b.camera),b.targetGeometry=v.vectorToPoint(e.center,a.renderSpatialReference,c),b.scale=B.computeScale(a,e),b.rotation=J(b.camera.heading),
b}function N(a,e,b){if(e){if(!u.canProject(e.spatialReference,a.spatialReference))throw new r("viewpointutils:incompatible-spatialreference","Spatial reference ("+(e.spatialReference?e.spatialReference.wkid:"unknown")+") is incompatible with the view ("+a.spatialReference.wkid+")",{geometry:e});var c=[];if(!e.hasZ&&a.basemapTerrain){var f=void 0;(f="point"===e.type?e:"multipoint"===e.type||"polyline"===e.type?e.extent.center:"extent"===e.type?e.center:e.centroid)&&u.canProject(f,a.basemapTerrain.spatialReference)?
O[2]=a.basemapTerrain.getElevation(f)||0:O[2]=0}(0,fa[e.type])(e,function(a){c.push(a[0],a[1],a[2])},O);var d=c.length/3;if(0!==d&&(f=Array(c.length),v.bufferToBuffer(c,e.spatialReference,0,f,a.spatialReference,0,d)))for(e.hasZ&&(b.hasZ=!0),a=0;a<f.length;a+=3)e.hasZ?(O[0]=f[a+0],O[1]=f[a+1],O[2]=f[a+2]):(O[0]=f[a+0],O[1]=f[a+1]),D.expand(b.boundingBox,O)}}function W(a,e,b){return a.whenViewForGraphic(e).then(function(a){return a&&a.whenGraphicBounds?a.whenGraphicBounds(e):void 0}).then(function(a){var e=
a.boundingBox;D.expand(b.boundingBox,e);a.screenSpaceObjects&&a.screenSpaceObjects.forEach(function(a){b.screenSpaceObjects.push(a)});isFinite(e[2])&&(b.hasZ=!0)}).otherwise(function(){N(a,e.geometry,b)})}function R(e,b,c){if(Array.isArray(b)&&2===b.length){var f=b[0],g=b[1];if("number"==typeof f&&"number"==typeof g)return Y.x=f,Y.y=g,Y.z=void 0,Y.spatialReference=w.WGS84,N(e,Y,c),a.resolve()}if(b&&"function"==typeof b.map)return a.eachAlways(b.map(function(a){return R(e,a,c)}));if(b instanceof d)try{N(e,
b,c)}catch(ta){return a.reject(ta)}else if(b instanceof t)return W(e,b,c);return a.resolve()}function V(a,e,b,c){if(e.camera)return Q(a,b,e.camera,c);c.scale=e.scale;c.rotation=e.rotation;c.targetGeometry=e.targetGeometry?e.targetGeometry.clone():null;c.camera=null;null!=b.heading?c.rotation=J(b.heading):null!=b.rotation&&(c.rotation=b.rotation);e=K(a,c.targetGeometry,b);return null!=e&&(c.scale=e),c.camera=G(a,c,b.tilt),c}function Q(a,e,b,c){c.camera=b.clone();c.camera.fov=a.camera.fov;e=a.spatialReference;
b=c.camera.position.spatialReference;return u.canProject(b,e)?(b.equals(e)||(c.camera.position=u.project(c.camera.position,e)),U(a,null,c)):null}function S(a,e,b,c){if(!b)return null;c.targetGeometry=b.clone();var f=y.cameraOnContentAlongViewDirection(a);if(e.position){b=c.targetGeometry;var d=a.renderSpatialReference;return v.pointToVector(e.position,I,d),v.pointToVector(b,L,d),c.targetGeometry=new l(b),c.camera.position=new l(e.position),C.vec3d.subtract(L,I,x),B.directionToHeadingTilt(a,I,x,f.up,
c.camera),c.scale=B.distanceToScale(a,C.vec3d.dist(I,L),c.targetGeometry.latitude),c.rotation=J(c.camera.heading),c}if(e.zoomFactor){var d=f.distance/e.zoomFactor,g=C.vec3d.scale(f.viewForward,-d,O);C.vec3d.add(f.center,g,f.eye);f.markViewDirty();c.scale=B.distanceToScale(a,d,b.latitude)}B.internalToExternal(a,f,c.camera);d={noReset:!1};return M(c.camera,e)&&(d.noReset=!0),e.zoomFactor||(c.scale=K(a,c.targetGeometry,e),null==c.scale&&(v.pointToVector(b,O,a.renderSpatialReference),m.frustumPoint(f.frustumPlanes,
O)?c.scale=B.distanceToScale(a,C.vec3d.dist(f.eye,O),b.latitude):c.scale=B.computeScale(a,f)),B.fromCenterScale(a,c.targetGeometry,c.scale,c.camera,d,c.camera))?c:null}function X(a,e,b,c){c.targetGeometry=b.clone();var f=y.cameraOnContentAlongViewDirection(a);B.internalToExternal(a,f,c.camera);f={noReset:!1};return M(c.camera,e)&&(f.noReset=!0),B.fromExtent(a,b,c.camera.heading,c.camera.tilt,f,c.camera)?c:null}function z(a,e){if(!e||!a.spatialReference)return null;a={target:null};if("declaredClass"in
e||Array.isArray(e))a.target=e;else{for(var b in e)a[b]=e[b];e.center&&!a.target&&(a.target=e.center)}return a}function Z(e){return e&&(e.rotation=J(e.camera.heading)),a.resolve(e)}Object.defineProperty(p,"__esModule",{value:!0});p.DEFAULT_FRAME_COVERAGE=.66;p.rotationToHeading=E;p.headingToRotation=J;p.toCamera=G;p.fromInternalCamera=function(a,e,b){return b||(b=new c({camera:new k})),B.internalToExternal(a,e,b.camera),U(a,e,b)};p.fromCamera=function(a,e,b){return b||(b=new c),b.camera=e.clone(),
U(a,null,b)};p.create=function(d,m){var q=z(d,m);if(!q)return a.reject(new r("viewpointutils-create:no-target","Missing target for creating viewpoint"));var t=new c({camera:new k({fov:d.camera.fov})}),u=null!=q.scale||null!=q.zoom;if(q.target instanceof c)return Z(V(d,q.target,q,t));if(q.target instanceof k)return Z(Q(d,q,q.target,t));if(q.target instanceof h)return m=q.target.xmin===q.target.xmax||q.target.ymin===q.target.ymax,Z(u||m?S(d,q,q.target.center,t):X(d,q,q.target,t));var E={boundingBox:D.create(D.NEGATIVE_INFINITY),
spatialReference:d.spatialReference,hasZ:!1,screenSpaceObjects:[]};return R(d,q.target,E).then(function(){if(isFinite(E.boundingBox[0])){D.center(E.boundingBox,O);Y.x=O[0];Y.y=O[1];Y.z=O[2];Y.spatialReference=d.spatialReference;var a=void 0;isFinite(Y.z)&&E.hasZ?a=D.isPoint(E.boundingBox):(Y.z=void 0,a=b.isPoint(D.toRect(E.boundingBox,n)));if(u||a)a=S(d,q,Y,t);else{var c=Y,a=E.boundingBox,k;k=E.screenSpaceObjects;var m=p.DEFAULT_FRAME_COVERAGE;if(k.length){for(var h=Number.NEGATIVE_INFINITY,r=0;r<
k.length;r++)var z=k[r].screenSpaceBoundingRect,h=Math.max(h,Math.abs(z[0]),Math.abs(z[1]),Math.abs(z[2]),Math.abs(z[3]));k=m-h/Math.min(d.width,d.height)*2}else k=m;m=k;t.targetGeometry=c.clone();k=y.cameraOnContentAlongViewDirection(d);h=0;c.hasZ?h=c.z:d.basemapTerrain&&(h=d.basemapTerrain.getElevation(c));C.vec3d.set3(c.x,c.y,h,O);v.computeLinearTransformation(d.spatialReference,O,g,d.renderSpatialReference);C.mat4d.toMat3(g,e);C.mat3d.transpose(e);D.set(f,D.NEGATIVE_INFINITY);c=[[0,1,2],[3,1,
2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(r=0;r<c.length;r++){var z=c[r],w=a[z[2]];isFinite(w)||(w=h);C.vec3d.set3(a[z[0]],a[z[1]],w,O);v.vectorToVector(O,d.spatialReference,O,d.renderSpatialReference);D.expand(f,C.mat3d.multiplyVec3(e,O))}a=D.width(f);c=D.height(f);h=D.depth(f);r=1/Math.tan(k.fovY/2);a=Math.max(.5*Math.sqrt(a*a+h*h)*Math.max(r,1/Math.tan(k.fovX/2))+.5*c,.5*c*r+.5*Math.max(a,h))/m;B.internalToExternal(d,k,t.camera);k={noReset:!1};a=(M(t.camera,q)&&(k.noReset=!0),t.scale=
B.distanceToScale(d,a,t.targetGeometry.latitude),B.fromCenterScale(d,t.targetGeometry,t.scale,t.camera,k,t.camera)?t:null)}return a}q.position?(a=y.cameraOnContentAlongViewDirection(d),a=(C.vec3d.set(a.viewForward,x),B.directionToHeadingTilt(d,a.eye,x,a.up,P),t.camera.position=new l(q.position),t.camera.heading=null!=q.heading?q.heading:P.heading,t.camera.tilt=null!=q.tilt?q.tilt:P.tilt,U(d,null,t))):(a=y.cameraOnContentAlongViewDirection(d),a=v.vectorToPoint(a.center,d.renderSpatialReference,Y,d.spatialReference),
a=S(d,q,a,t));return a}).then(function(a){return Z(a)})};var O=C.vec3d.create(),g=C.mat4d.create(),e=C.mat3d.create(),f=D.create(),n=b.create(),x=C.vec3d.create(),I=C.vec3d.create(),L=C.vec3d.create(),P={heading:0,tilt:0},Y=new l,fa={point:function(a,e,b){b[0]=a.x;b[1]=a.y;a.hasZ&&(b[2]=a.z);e(b)},polygon:function(a,e,b){for(var c=a.hasZ,f=0;f<a.rings.length;f++)for(var d=a.rings[f],g=0;g<d.length;g++)b[0]=d[g][0],b[1]=d[g][1],c&&(b[2]=d[g][2]),e(b)},polyline:function(a,e,b){for(var c=a.hasZ,f=0;f<
a.paths.length;f++)for(var d=a.paths[f],g=0;g<d.length;g++)b[0]=d[g][0],b[1]=d[g][1],c&&(b[2]=d[g][2]),e(b)},multipoint:function(a,e,b){var c=a.points;a=a.hasZ;for(var f=0;f<c.length;f++)b[0]=c[f][0],b[1]=c[f][1],a&&(b[2]=c[f][2]),e(b)},extent:function(a,e,b){a.hasZ?(e(C.vec3d.set3(a.xmin,a.ymin,a.zmin,b)),e(C.vec3d.set3(a.xmax,a.ymin,a.zmin,b)),e(C.vec3d.set3(a.xmin,a.ymax,a.zmin,b)),e(C.vec3d.set3(a.xmax,a.ymax,a.zmin,b)),e(C.vec3d.set3(a.xmin,a.ymin,a.zmax,b)),e(C.vec3d.set3(a.xmax,a.ymin,a.zmax,
b)),e(C.vec3d.set3(a.xmin,a.ymax,a.zmax,b)),e(C.vec3d.set3(a.xmax,a.ymax,a.zmax,b))):(e(C.vec3d.set3(a.xmin,a.ymin,b[2],b)),e(C.vec3d.set3(a.xmax,a.ymin,b[2],b)),e(C.vec3d.set3(a.xmin,a.ymax,b[2],b)),e(C.vec3d.set3(a.xmax,a.ymax,b[2],b)))}}})},"esri/views/3d/support/aaBoundingBox":function(){define(["require","exports","./aaBoundingRect","../../../geometry/Extent"],function(A,p,w,l){function h(a){return a[0]>=a[3]?0:a[3]-a[0]}function d(a){return a[1]>=a[4]?0:a[4]-a[1]}function u(a){return a[2]>=
a[5]?0:a[5]-a[2]}function r(a){return 6===a.length}Object.defineProperty(p,"__esModule",{value:!0});p.create=function(a){return void 0===a&&(a=p.ZERO),[a[0],a[1],a[2],a[3],a[4],a[5]]};p.fromExtent=function(a){return[a.xmin,a.ymin,a.zmin,a.xmax,a.ymax,a.zmax]};p.toExtent=function(a,d){var c=isFinite(a[2])||isFinite(a[5]);return new l(c?{xmin:a[0],xmax:a[3],ymin:a[1],ymax:a[4],zmin:a[2],zmax:a[5],spatialReference:d}:{xmin:a[0],xmax:a[3],ymin:a[1],ymax:a[4],spatialReference:d})};p.fromMinMax=function(a,
d){return[a[0],a[1],a[2],d[0],d[1],d[2]]};p.expand=function(a,d,c){void 0===c&&(c=a);var k=d.declaredClass;return"esri.geometry.Extent"===k?(c[0]=Math.min(a[0],d.xmin),c[1]=Math.min(a[1],d.ymin),c[3]=Math.max(a[3],d.xmax),c[4]=Math.max(a[4],d.ymax),d.hasZ&&(c[2]=Math.min(a[2],d.zmin),c[5]=Math.max(a[5],d.zmax))):"esri.geometry.Point"===k?(c[0]=Math.min(a[0],d.x),c[1]=Math.min(a[1],d.y),c[3]=Math.max(a[3],d.x),c[4]=Math.max(a[4],d.y),d.hasZ&&(c[2]=Math.min(a[2],d.z),c[5]=Math.max(a[5],d.z))):r(d)?
(c[0]=Math.min(a[0],d[0]),c[1]=Math.min(a[1],d[1]),c[2]=Math.min(a[2],d[2]),c[3]=Math.max(a[3],d[3]),c[4]=Math.max(a[4],d[4]),c[5]=Math.max(a[5],d[5])):w.is(d)?(c[0]=Math.min(a[0],d[0]),c[1]=Math.min(a[1],d[1]),c[3]=Math.max(a[3],d[2]),c[4]=Math.max(a[4],d[3])):Array.isArray(d)&&(2===d.length?(c[0]=Math.min(a[0],d[0]),c[1]=Math.min(a[1],d[1]),c[3]=Math.max(a[3],d[0]),c[4]=Math.max(a[4],d[1])):3===d.length&&(c[0]=Math.min(a[0],d[0]),c[1]=Math.min(a[1],d[1]),c[2]=Math.min(a[2],d[2]),c[3]=Math.max(a[3],
d[0]),c[4]=Math.max(a[4],d[1]),c[5]=Math.max(a[5],d[2]))),c};p.expandBuffer=function(a,d,c,h,l){void 0===l&&(l=a);var k=a[0],t=a[1],r=a[2],u=a[3],C=a[4];a=a[5];for(var b=0;h>b;b++)k=Math.min(k,d[c+3*b]),t=Math.min(t,d[c+3*b+1]),r=Math.min(r,d[c+3*b+2]),u=Math.max(u,d[c+3*b]),C=Math.max(C,d[c+3*b+1]),a=Math.max(a,d[c+3*b+2]);return l[0]=k,l[1]=t,l[2]=r,l[3]=u,l[4]=C,l[5]=a,l};p.allFinite=function(a){for(var d=0;6>d;d++)if(!isFinite(a[d]))return!1;return!0};p.width=h;p.depth=d;p.height=u;p.center=function(a,
k){return void 0===k&&(k=[0,0,0]),k[0]=a[0]+h(a)/2,k[1]=a[1]+d(a)/2,k[2]=a[2]+u(a)/2,k};p.size=function(a,k){return void 0===k&&(k=[0,0,0]),k[0]=h(a),k[1]=d(a),k[2]=u(a),k};p.containsPoint=function(a,d){return d[0]>=a[0]&&d[1]>=a[1]&&d[2]>=a[2]&&d[0]<=a[3]&&d[1]<=a[4]&&d[2]<=a[5]};p.containsPointWithMargin=function(a,d,c){return d[0]>=a[0]-c&&d[1]>=a[1]-c&&d[2]>=a[2]-c&&d[0]<=a[3]+c&&d[1]<=a[4]+c&&d[2]<=a[5]+c};p.contains=function(a,d){return d[0]>=a[0]&&d[1]>=a[1]&&d[2]>=a[2]&&d[3]<=a[3]&&d[4]<=
a[4]&&d[5]<=a[5]};p.intersects=function(a,d){return Math.max(d[0],a[0])<=Math.min(d[3],a[3])&&Math.max(d[1],a[1])<=Math.min(d[4],a[4])&&Math.max(d[2],a[2])<=Math.min(d[5],a[5])};p.offset=function(a,d,c,h,l){return void 0===l&&(l=a),l[0]=a[0]+d,l[1]=a[1]+c,l[2]=a[2]+h,l[3]=a[3]+d,l[4]=a[4]+c,l[5]=a[5]+h,l};p.setMin=function(a,d,c){return void 0===c&&(c=a),c[0]=d[0],c[1]=d[1],c[2]=d[2],c!==a&&(c[3]=a[3],c[4]=a[4],c[5]=a[5]),c};p.setMax=function(a,d,c){return void 0===c&&(c=a),c[3]=d[0],c[4]=d[1],c[5]=
d[2],c!==a&&(c[0]=a[0],c[1]=a[1],c[2]=a[2]),a};p.set=function(a,d){return a[0]=d[0],a[1]=d[1],a[2]=d[2],a[3]=d[3],a[4]=d[4],a[5]=d[5],a};p.toRect=function(a,d){return d||(d=w.create()),d[0]=a[0],d[1]=a[1],d[2]=a[3],d[3]=a[4],d};p.fromRect=function(a,d){return a[0]=d[0],a[1]=d[1],a[3]=d[2],a[4]=d[3],a};p.is=r;p.isPoint=function(a){return 0===h(a)&&0===d(a)&&0===u(a)};p.equals=function(a,d,c){if(null==a||null==d)return a===d;if(!r(a)||!r(d))return!1;if(c)for(var k=0;k<a.length;k++){if(!c(a[k],d[k]))return!1}else for(k=
0;k<a.length;k++)if(a[k]!==d[k])return!1;return!0};p.POSITIVE_INFINITY=[-(1/0),-(1/0),-(1/0),1/0,1/0,1/0];p.NEGATIVE_INFINITY=[1/0,1/0,1/0,-(1/0),-(1/0),-(1/0)];p.ZERO=[0,0,0,0,0,0]})},"esri/views/3d/support/intersectionUtils":function(){define(["../lib/glMatrix"],function(A){function p(d,h,a,k){k.clip[0]=0;k.clip[1]=a?k.len:Number.MAX_VALUE;for(a=0;a<d.length;a++){var c;var t=d[a],r=h;c=k;var q=l.dot(t,c.dir),r=-l.dot(r,t)-t[3];0>r&&0<=q?c=!1:-1E-6<q&&1E-6>q?c=!0:!(0>r||0>q)||0>r&&0>q?(r/=q,c=(0<
q?r<c.clip[1]&&(c.clip[1]=r):r>c.clip[0]&&(c.clip[0]=r),c.clip[0]<=c.clip[1])):c=!0;if(!c)return!1}return!0}function w(d,r,a,k){return d?(a&&k&&(h.len=l.dist(r,a)),l.set(d,h.dir)):k?(h.len=l.dist(r,a),l.scale(l.subtract(a,r,h.dir),1/h.len)):l.normalize(l.subtract(a,r,h.dir)),h}var l=A.vec3d;A=A.vec2d;var h={dir:l.create(),len:0,clip:A.create()},d={planeSphere:function(d,h,a){return d[0]*h[0]+d[1]*h[1]+d[2]*h[2]+d[3]<a},frustumSphere:function(h,l,a){for(var k=0;6>k;k++)if(!d.planeSphere(h[k],l,a))return!1;
return!0},frustumRay:function(d,h,a,k){a=w(k,h,a,!1);return p(d,h,null,a)},frustumPoint:function(d,h){for(var a=0;6>a;a++){var k=d[a];if(0>-l.dot(h,k)-k[3])return!1}return!0},frustumLineSegment:function(d,h,a,k){k=w(k,h,a,!0);return p(d,h,a,k)},closestPointOnRay:function(d,h,a,k){a=l.dot(h,l.subtract(a,d,k));return l.add(d,l.scale(h,a,k),k),k}};return d})},"esri/views/3d/camera/constraintUtils":function(){define("require exports ../lib/glMatrix ../../animation/easing ./constraintUtils/common ./constraintUtils/tilt ./constraintUtils/tilt ./constraintUtils/altitude ./constraintUtils/altitude ./constraintUtils/distance ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/surfaceCollision".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C){Object.defineProperty(p,"__esModule",{value:!0});p.applyTilt=u.apply;p.tiltError=u.error;p.applyAltitude=a.apply;p.altitudeError=a.error;p.applyDistance=c.apply;p.distanceError=c.error;p.applySurfaceCollision=C.apply;p.applyAll=function(a,c,b,d){void 0===b&&(b=v);void 0===d&&(d=c);var k=!1;d!==c&&d.copyFrom(c);d.markViewDirty();d.computeUp(a.state.mode);for(c=0;y>c;c++){for(var m=0,l=0,r=q;l<r.length;l++){var u=r[l];if(h.hasConstraintType(b.selection,u.type)){var B=
Math.abs(u.error(a,d,b));u.apply(a,d,b)&&(k=!0,m+=B)}}if(0===m)break}c=h.hasConstraintType(b.selection,8);b=4===b.interactionType?1:0;return c&&t.apply(a,d,b)&&(k=!0),k&&d.computeUp(a.state.mode),k};p.pixelDistanceToInteractionFactor=function(a,c){a="number"==typeof a?a:w.vec2d.dist(a,c);return l.inOutCubic(Math.min(1,a/150))};var q=[{type:1,error:function(a,c,b){return d.error(a,c,b)*c.distance},apply:d.apply},{type:2,error:r.error,apply:r.apply},{type:4,error:k.error,apply:k.apply}],v={selection:15,
interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null},y=5})},"esri/views/3d/camera/constraintUtils/common":function(){define(["require","exports","../../lib/glMatrix","../../support/mathUtils"],function(A,p,w,l){Object.defineProperty(p,"__esModule",{value:!0});p.hasConstraintType=function(h,d){return 0!==(h&d)};p.adjustRangeForInteraction=function(h,d,l,r,a,k){0!==h&&(l?(k.min=Math.min(k.min,d),k.max=Math.max(k.max,d)):null!=r?(k.min-=Math.max(0,(d-k.min)*(1-
r)),k.max+=Math.max(0,(d-k.max)*(1-r))):a&&(k.min-=Math.max(0,d-k.min-a),k.max+=Math.max(0,d-k.max-a)))};p.defaultApplyOptions={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null};p.interactionDirectionTowardsConstraintMinimization=function(h,d,u,r,a){return u||(u=d.viewForward),w.vec3d.set(u,a),w.vec3d.scale(a,l.sign(w.vec3d.dot(u,r))),a}})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("require exports ../../lib/glMatrix ../../support/mathUtils ../../support/earthUtils ../../state/utils/viewUtils ./common".split(" "),
function(A,p,w,l,h,d,u){function r(c,k,h,B){if((void 0===h&&(h=u.defaultApplyOptions),void 0===B&&(B=u.defaultApplyOptions),3===h.interactionType)||!c.state.constraints.tilt)return 0;var q=d.viewAngle(c.renderCoordsHelper,k.center,k.eye);k=c.state.constraints.tilt(k.distance,C);if(0!==h.interactionType){var b=h.interactionStartCamera,m=h.interactionFactor,v=k.min,y=k.max,p=r(c,b,u.defaultApplyOptions,h),w=0===p?0:d.viewAngle(c.renderCoordsHelper,b.center,b.eye);k.min=v;k.max=y;2===h.interactionType?
(u.hasConstraintType(h.selection,2)&&a(c,b,k),u.adjustRangeForInteraction(p,w,!0,m,t,k)):u.adjustRangeForInteraction(p,w,!1,m,t,k)}2===B.interactionType&&u.hasConstraintType(B.selection,2)&&a(c,B.interactionStartCamera,k);c=l.clamp(q,k.min,k.max);q-=c;return 1E-6>=Math.abs(q)?0:q}function a(a,c,d){if(!a.state.isLocal){var k=a.state.constraints;if(k.altitude){a=w.vec3d.length2(c.center);var q=Math.sqrt(a);c=c.distance;var b=k.altitude.min+h.earthRadius,k=k.altitude.max+h.earthRadius,b=(b*b-c*c-a)/
(-2*q*c);d.min=Math.max(d.min,Math.min(Math.PI-l.acos((k*k-c*c-a)/(-2*q*c)),d.max));d.max=Math.min(d.max,Math.PI-l.acos(b))}}}Object.defineProperty(p,"__esModule",{value:!0});p.apply=function(a,d,h,l){void 0===h&&(h=u.defaultApplyOptions);void 0===l&&(l=d);d!==l&&l.copyFrom(d);a=r(a,d,h);return 0===a?!1:(w.mat4d.identity(c),w.mat4d.rotate(c,-a,d.viewRight),w.vec3d.subtract(d.center,d.eye,k),w.mat4d.multiplyVec3(c,k),w.vec3d.subtract(d.center,k,l.eye),w.mat4d.multiplyVec3(c,l.up),l.markViewDirty(),
!0)};p.error=r;var k=w.vec3d.create(),c=w.mat4d.create(),t=l.deg2rad(5),C={min:0,max:0}})},"esri/views/3d/state/utils/viewUtils":function(){define(["require","exports","../../lib/glMatrix","../../support/mathUtils"],function(A,p,w,l){Object.defineProperty(p,"__esModule",{value:!0});p.viewAngle=function(u,r,a){u.worldUpAtPosition(r,h);w.vec3d.subtract(a,r,d);u=w.vec3d.length(d);return 0===u?0:l.acos(w.vec3d.dot(d,h)/u)};var h=w.vec3d.create(),d=w.vec3d.create()})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("require exports ../../lib/glMatrix ../../support/mathUtils ../../support/intersectionUtils ./common".split(" "),
function(A,p,w,l,h,d){function u(c,k,h){void 0===h&&(h=d.defaultApplyOptions);var q=c.state.constraints.altitude;if(!c.state.isGlobal||!q||2===h.interactionType&&d.hasConstraintType(h.selection,1))return 0;var q=c.state.constraints.altitude,t=a,q=(t.min=q.min,t.max=q.max,t),v=h.interactionType;if(0!==v){var t=q.min,b=q.max,m=h.interactionStartCamera;h=h.interactionFactor;var v=2===v||1===v,r=u(c,m),m=0===r?0:c.renderCoordsHelper.getAltitude(m.eye);q.min=t;q.max=b;d.adjustRangeForInteraction(r,m,v,
h,.05*m,q)}c=c.renderCoordsHelper.getAltitude(k.eye);c=l.clamp(c,q.min,q.max)-c;return 1E-6>=Math.abs(c)?0:c}function r(a,c,d,k){return a.renderCoordsHelper.worldUpAtPosition(c.eye,k),w.vec3d.scale(k,d),k}Object.defineProperty(p,"__esModule",{value:!0});p.apply=function(a,q,v,y){void 0===v&&(v=d.defaultApplyOptions);void 0===y&&(y=q);y!==q&&y.copyFrom(q);var B=u(a,q,v);if(0===B)return!1;var C=a.renderCoordsHelper,b=C.getAltitude(q.eye)+B;a=d.interactionDirectionTowardsConstraintMinimization(a,q,v.interactionDirection,
r(a,q,l.sign(B),c),k);v=w.vec3d.set(q.viewForward,t);return C.intersectManifold(q.eye,a,b,y.eye)||C.setAltitude(b,y.eye),h.closestPointOnRay(q.eye,v,q.center,q.center),y.markViewDirty(),!0};p.error=u;var a={min:0,max:0},k=w.vec3d.create(),c=w.vec3d.create(),t=w.vec3d.create()})},"esri/views/3d/camera/constraintUtils/distance":function(){define(["require","exports","../../lib/glMatrix","../../webgl-engine/lib/Util","./common"],function(A,p,w,l,h){function d(a,c,k){if(void 0===k&&(k=h.defaultApplyOptions),
!a.state.isLocal)return 0;var l=a.state.constraints.distance;if(!a.pointsOfInterest.surfaceOrigin.renderLocation||l===1/0)return 0;u.min=0;u.max=l;var l=u,q=k.interactionType;if(0!==q){var t=l.min,r=l.max,b=k.interactionStartCamera;k=k.interactionFactor;var q=1===q||4===q,m=d(a,b),b=0===m?0:w.vec3d.dist(b.eye,a.pointsOfInterest.surfaceOrigin.renderLocation);l.min=t;l.max=r;h.adjustRangeForInteraction(m,b,q,k,.05*b,l)}a=w.vec3d.dist(c.eye,a.pointsOfInterest.surfaceOrigin.renderLocation);a=u.max-a;
return-1E-6<=a?0:a}Object.defineProperty(p,"__esModule",{value:!0});p.error=d;p.apply=function(t,u,q,v){void 0===q&&(q=h.defaultApplyOptions);void 0===v&&(v=u);v!==u&&v.copyFrom(u);var y=d(t,u,q);if(0===y)return!1;var B=t.pointsOfInterest.surfaceOrigin,y=w.vec3d.dist(u.eye,t.pointsOfInterest.surfaceOrigin.renderLocation)+y,C=w.vec3d.set(u.eye,r);q=h.interactionDirectionTowardsConstraintMinimization(t,u,q.interactionDirection,w.vec3d.direction(t.pointsOfInterest.surfaceOrigin.renderLocation,u.eye,
c),k);return l.raySphere(u.eye,q,B.renderLocation,y,v.eye)?(u=w.vec3d.subtract(v.eye,C,a),w.vec3d.add(v.center,u),v.markViewDirty(),u=t.renderCoordsHelper.getAltitude(v.center),t.renderCoordsHelper.intersectManifold(v.eye,v.viewForward,u,v.center),v.markViewDirty(),!0):!1};var u={min:0,max:0},r=w.vec3d.create(),a=w.vec3d.create(),k=w.vec3d.create(),c=w.vec3d.create()})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["require","exports","../intersectionUtils","../../lib/glMatrix"],
function(A,p,w,l){Object.defineProperty(p,"__esModule",{value:!0});p.apply=function(d,u,r,a){void 0===r&&(r=0);void 0===a&&(a=u);var k=d.state.constraints;if(u!==a&&a.copyFrom(u),!k.collision.enabled)return!1;var c=w.surfaceElevationBelowEye(d,u);u=d.renderCoordsHelper.getAltitude(u.eye);k=k.collision.elevationMargin;return u-c>=k?!1:(l.vec3d.subtract(a.center,a.eye,h),d.renderCoordsHelper.setAltitude(c+k,a.eye),1===r&&l.vec3d.add(a.eye,h,a.center),a.markViewDirty(),!0)};var h=l.vec3d.create()})},
"esri/views/3d/state/Frustum":function(){define(["require","exports","../lib/glMatrix","../support/earthUtils","../webgl-engine/lib/Util"],function(A,p,w,l,h){Object.defineProperty(p,"__esModule",{value:!0});A=function(){function d(){this.planes=Array(6);this.points=Array(8);this.lines=Array(12);this.origin=w.vec3d.create();this.direction=w.vec3d.create();this._altitude=null;for(var d=0;6>d;d++)this.planes[d]=w.vec4d.create();for(d=0;8>d;d++)this.points[d]=w.vec3d.create();for(d=0;12>d;d++)this.lines[d]=
{origin:null,direction:w.vec3d.create(),endpoint:null}}return d.prototype.updateLine=function(d,h,a){d.origin=h;d.endpoint=a;w.vec3d.direction(a,h,d.direction)},d.prototype.update=function(d){h.matrix2frustumPlanes(d.viewMatrix,d.projectionMatrix,this.points,this.planes);for(var r=0;4>r;r++){var a=r,k=r+4;this.updateLine(this.lines[r],this.points[a],this.points[k]);this.updateLine(this.lines[r+4],this.points[a],3===r?this.points[0]:this.points[a+1]);this.updateLine(this.lines[r+8],this.points[k],
3===r?this.points[4]:this.points[k+1])}w.vec3d.set(d.eye,this.origin);w.vec3d.set(d.viewForward,this.direction);this._altitude=w.vec3d.length(this.origin)-l.earthRadius},Object.defineProperty(d.prototype,"altitude",{get:function(){return this._altitude},enumerable:!0,configurable:!0}),d}();p.Frustum=A;p["default"]=A})},"esri/views/3d/state/ConstraintsManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../core/HandleRegistry ../../../core/watchUtils ../camera/intersectionUtils ../camera/constraintUtils ./SurfaceCollisionConstraint ./NearFarHeuristic ../support/mathUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C){Object.defineProperty(p,"__esModule",{value:!0});A=function(d){function v(a){var c=d.call(this)||this;return c.handles=new u,c.nearFarHeuristic=t.createNearFarHeuristic(a.view.state.mode,a.view.basemapTerrain,a.view.renderCoordsHelper.spatialReference),c}return w(v,d),v.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],function(){return a.handleClipDistanceNearFarChanged()}),
this.view.watch("constraints.clipDistance.mode",function(){return a.handleClipDistanceModeChanged()}),this.view.state.events.on("before-camera-change",function(c){return a.cameraUpdateNearFar(c.camera)}),this.view.watch("dataExtent",function(){return a.updateNearFar()},!0)],"clipDistance");this.handles.add([this.view.watch(["constraints.altitude.min","constraints.altitude.max"],function(){return a.handleAltitudeMinMaxChanged()},!0)],"altitude");this.handles.add([this.view.watch("constraints.tilt.max",
function(){return a.handleTiltMaxChanged()},!0),this.view.watch("constraints.tilt.mode",function(){return a.handleTiltModeChanged()},!0),this.view.watch("state.camera",function(){return a.tiltAutoUpdateMax()},!0)],"tilt");this.handles.add([this.view.watch("constraints.collision.enabled",function(){return a.handleCollisionEnabledChanged()},!0)],"collision");this.view.state.isLocal&&this.handles.add(r.init(this.view,"dataExtent",function(c){return a.updateLocalSurfaceDistance(c)}));this.updateNearFar();
"local"!==this.view.state.mode&&this.updateAltitude();this.updateTilt();this.updateCollision();this._set("surfaceCollisionConstraint",new c["default"]({view:this.view}))},v.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))},v.prototype.handleClipDistanceNearFarChanged=function(){var a=this,c=this.view.constraints&&this.view.constraints.clipDistance;
c&&"auto"!==c.mode&&this.view.state.updateCamera(function(b){return a.cameraUpdateNearFarManual(b,c),!0})},v.prototype.handleClipDistanceModeChanged=function(){this.updateNearFar()},v.prototype.updateNearFar=function(){var a=this;this.view.state.updateCamera(function(c){return a.cameraUpdateNearFar(c),!0})},v.prototype.cameraUpdateNearFar=function(a){var c=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(c?c.mode:"auto")?this.cameraUpdateNearFarManual(a,c):this.cameraUpdateNearFarAuto(a,
c)},v.prototype.cameraUpdateNearFarAuto=function(c,d){var b=this.nearFarHeuristic.compute(c.eye,c.center,this.view.dataExtent,a.surfaceElevationBelowEye(this.view,c),q),k=b.distance,h=b.maxFarNearRatio,b=b.minNearDistance;k/h>b?(c.far=k,c.near=c.far/h):(c.near=b,c.far=c.near*h);d&&d.autoUpdate(c.near,c.far)},v.prototype.cameraUpdateNearFarManual=function(a,c){c&&(a.near=c.near,a.far=c.far)},v.prototype.handleCollisionEnabledChanged=function(){this.updateCollision()},v.prototype.updateCollision=function(){var a=
this.view.constraints&&this.view.constraints.collision,c=this.view.state.constraints.collision,a=a?a.enabled:!1;a!==c.enabled&&(c.enabled=a,a&&this.reapplyConstraints(8))},v.prototype.handleAltitudeMinMaxChanged=function(){this.updateAltitude()},v.prototype.updateAltitude=function(){var a=this.view.constraints&&this.view.constraints.altitude;a&&"local"!==this.view.state.mode?this.view.state.constraints.altitude={min:a.min,max:a.max}:this.view.state.constraints.altitude=null;this.reapplyConstraints()},
v.prototype.handleTiltModeChanged=function(){this.updateTilt()},v.prototype.handleTiltMaxChanged=function(){var a=this.view.constraints&&this.view.constraints.tilt;a&&"auto"!==a.mode&&(this.updateTiltManual(a),this.reapplyConstraints())},v.prototype.updateTilt=function(){var a=this.view.constraints&&this.view.constraints.tilt;"manual"===(a?a.mode:"auto")?this.updateTiltManual(a):this.updateTiltAuto(a);this.reapplyConstraints()},v.prototype.updateTiltManual=function(a){var c=this.view.state.constraints;
c.tilt=c.createConstantMaxTilt(C.deg2rad(a.max))},v.prototype.updateTiltAuto=function(a){a=this.view.state.constraints;a.tilt=a.createDefaultTilt();this.tiltAutoUpdateMax()},v.prototype.tiltAutoUpdateMax=function(){var a=this.view.constraints&&this.view.constraints.tilt;if(a&&"auto"===a.mode){var c=this.view.state.constraints;c.tilt&&(c=c.tilt(this.view.state.camera.distance).max,a.autoUpdate(C.rad2deg(c)))}},v.prototype.updateLocalSurfaceDistance=function(a){var c=Math.max(a.width,a.height);0>=c||
(a.hasZ&&(c=Math.max(c,a.zmax-a.zmin)),a=this.view.state,c=3*c/Math.atan(a.camera.fov/2),c!==a.constraints.distance&&(a.constraints.distance=c))},v.prototype.reapplyConstraints=function(a){var c=this;void 0===a&&(a=15);this.view.state.updateCamera(function(b){return k.applyAll(c.view,b,{selection:a,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null})})},l([h.property({constructOnly:!0})],v.prototype,"view",void 0),l([h.property({readOnly:!0})],v.prototype,
"surfaceCollisionConstraint",void 0),v=l([h.subclass("esri.views.3d.state.ConstraintsManager")],v)}(h.declared(d));p.ConstraintsManager=A;var q={distance:0,maxFarNearRatio:0,minNearDistance:0};p["default"]=A})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../core/HandleRegistry ../camera/intersectionUtils ../camera/constraintUtils".split(" "),
function(A,p,w,l,h,d,u,r,a){Object.defineProperty(p,"__esModule",{value:!0});A=function(d){function c(a){a=d.call(this)||this;return a.handles=new u,a}return w(c,d),c.prototype.initialize=function(){var a=this;this.handles.add(this.view.basemapTerrain.on("elevation-change",function(c){return a.handleElevationChangeEvent(c)}))},c.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)},c.prototype.handleElevationChangeEvent=function(a){if(this.view.state.cameraController)return!1;
r.eyeWithinExtent(this.view,this.view.state.camera,a.extent,a.spatialReference)&&this.applyToCurrentCamera()},c.prototype.applyToCurrentCamera=function(){var c=this;this.view.state.updateCamera(function(d){a.applySurfaceCollision(c.view,d,1)})},l([h.property({constructOnly:!0})],c.prototype,"view",void 0),c=l([h.subclass("esri.views.3d.state.ElevationCollisionConstraint")],c)}(h.declared(d));p.SurfaceCollisionConstraint=A;p["default"]=A})},"esri/views/3d/state/NearFarHeuristic":function(){define("require exports ../lib/glMatrix ../../../geometry/support/scaleUtils ../support/mathUtils ../support/earthUtils".split(" "),
function(A,p,w,l,h,d){Object.defineProperty(p,"__esModule",{value:!0});p.createNearFarHeuristic=function(a,c,b){return"global"===a?new r:new u(c,b)};var u=function(){function c(a,b){this.elevationProvider=a;this.unitInMeters=l.getMetersPerUnitForSR(b)}return c.prototype.compute=function(c,b,m,l,t){t||(t={maxFarNearRatio:0,distance:0,minNearDistance:0});var r=d.earthRadius;t.maxFarNearRatio=a;t.minNearDistance=k/this.unitInMeters;var u=c[2]*this.unitInMeters,B=u;l=u-l;var p=this.elevationProvider?
this.elevationProvider.getElevationBounds():null;p&&(u=0<=l?B-this.unitInMeters*p[0]:this.unitInMeters*p[1]-B);B=Math.max(m.xmax-m.xmin,m.ymax-m.ymin,4*Math.max(m.xmax-m.xmin,m.ymax-m.ymin));w.vec3d.subtract(b,c,y);v[0]=0<y[0]?m.xmax:m.xmin;v[1]=0<y[1]?m.ymax:m.ymin;v[2]=0<y[2]?B/2:-B/2;w.vec3d.subtract(v,c);w.vec3d.normalize(y);c=1.1*w.vec3d.dot(v,y)*this.unitInMeters;b=u+r;r=Math.sqrt(b*b-r*r);m=Math.max(m.xmax-m.xmin,m.ymax-m.ymin);b=m*q*this.unitInMeters;u=h.clamp((u-b)/(m*C*this.unitInMeters-
b),0,1);return u*=u*u,t.distance=h.lerp(r,c,u),t.distance*=Math.max(Math.log(Math.abs(l)),1),t.distance=Math.min(t.distance,Math.max(34064E4,B)),t.distance/=this.unitInMeters,t},c}(),r=function(){function l(){}return l.prototype.compute=function(c,b,m,l,q){q||(q={maxFarNearRatio:0,minNearDistance:0,distance:0});b=d.earthRadius;c=w.vec3d.dot(c,c);m=b*b;(q.maxFarNearRatio=a,q.minNearDistance=k/1,this.isNemoMode(c,l))?(l=b+l,q.distance=Math.sqrt(c-l*l)/1):c>m?(q.maxFarNearRatio=h.clamp(2E4-(Math.log(Math.sqrt(c)-
b)-7.983)/9.011*19E3,1E3,2E4),q.distance=Math.sqrt(c-m)/1):q.distance=q.maxFarNearRatio*q.minNearDistance;return q.distance*=1.2,q},l.prototype.isNemoMode=function(a,b){var k=d.earthRadius+c;return k*k>a&&t>b},l}(),a=2E4,k=2,c=2E4,t=-500,C=.001,q=1E-4,v=w.vec3d.create(),y=w.vec3d.create()})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/HandleRegistry ../../camera/intersectionUtils ../../camera/constraintUtils ./CameraController".split(" "),
function(A,p,w,l,h,d,u){Object.defineProperty(p,"__esModule",{value:!0});A=function(r){function a(a){var c=r.call(this)||this;return c.handles=new l,c.view=a.view,c.desiredCamera=a.desiredCamera.copy(),c}return w(a,r),Object.defineProperty(a.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"constraintEnabled",{get:function(){return this.view.state.constraints.collision.enabled},enumerable:!0,configurable:!0}),a.prototype.onControllerStart=
function(a){var c=this;r.prototype.onControllerStart.call(this,a);this.handles.add(this.view.basemapTerrain.on("elevation-change",function(a){return c.handleElevationChangeEvent(a)}));this.applyCorrection()},a.prototype.onControllerEnd=function(a){this.handles.removeAll();r.prototype.onControllerEnd.call(this,a)},a.prototype.handleElevationChangeEvent=function(a){h.eyeWithinExtent(this.view,this.desiredCamera,a.extent,a.spatialReference)&&this.applyCorrection()},a.prototype.applyCorrection=function(){var a=
this;this.view.state.updateCamera(function(c){c.copyViewFrom(a.desiredCamera);d.applySurfaceCollision(a.view,c,1)||a.constraintEnabled||(a.state=u.State.Stopped)})},a}(u.CameraController);p.SurfaceCollisionCorrectionController=A})},"esri/views/3d/state/helpers/PickingHelper":function(){define(["require","exports","../../lib/glMatrix","../../webgl-engine/lib/Selector","../../camera/intersectionUtils"],function(A,p,w,l,h){Object.defineProperty(p,"__esModule",{value:!0});A=function(){function d(d){this.view=
d;this.tmpR0=w.vec3d.create();this.tmpR1=w.vec3d.create();this.tmpSelector=new l(this.view.viewingMode)}return d.prototype.pickPointInScreen=function(d,h){return this.pickedIntersectionPoint(this.pickInScreen(d,!1),h)},d.prototype.pickFreePointFromSegment=function(d,l,a){w.vec3d.set(d,this.tmpR0);w.vec3d.set(l,this.tmpR1);w.vec3d.subtract(this.tmpR1,this.tmpR0);w.vec3d.normalize(this.tmpR1);var k=this.view.dataExtent;d=Math.max(k.xmax-k.xmin,k.ymax-k.ymin,8*Math.max(k.xmax-k.xmin,k.ymax-k.ymin));
l=this.view.state.camera;var c=Math.max(0,k.xmin-l.eye[0],l.eye[0]-k.xmax),k=Math.max(0,k.ymin-l.eye[1],l.eye[1]-k.ymax),c=Math.sqrt(c*c+k*k),k=this.view.renderCoordsHelper.getAltitude(l.eye);l=h.surfaceElevationBelowEye(this.view,l);l=d/Math.max(1,Math.pow(Math.max(0,Math.log(d/(Math.abs(k-l)+Number.MIN_VALUE))),2));l=Math.max(l,Math.min(c,d));w.vec3d.scale(this.tmpR1,l);w.vec3d.add(this.tmpR0,this.tmpR1,a)},d.prototype.pickFreePointInScreen=function(d,h){this.view._pickRayWithBeginPoint(d,void 0,
this.view.state.camera.viewMatrix,this.tmpR0,this.tmpR1);this.pickFreePointFromSegment(this.tmpR0,this.tmpR1,h)},d.prototype.pickRaySegment=function(d,h,a){return this.pickedIntersectionPoint(this.view._pickRay(d,h,null,null,null,null,this.tmpSelector),a)},d.prototype.pickInScreen=function(d,h){return this.view._pickRayWithBeginPoint(d,void 0,this.view.state.camera.viewMatrix,this.tmpR0,this.tmpR1),h&&w.vec3d.set(this.view.state.camera.eye,this.tmpR0),this.view._pickRay(this.tmpR0,this.tmpR1,d,d,
null,null,this.tmpSelector)},d.prototype.pickedIntersectionPoint=function(d,h){return d?d.getMinResult().getIntersectionPoint(h):!1},d}();p.PickingHelper=A})},"esri/views/3d/environment/SceneViewEnvironment":function(){define(["dojo/_base/lang","../../../webscene/Environment","../../../webscene/Lighting","./SceneViewLighting","./SceneViewAtmosphere"],function(A,p,w,l,h){var d=p.createSubclass({declaredClass:"esri.views.3d.environment.SceneViewEnvironment",properties:{atmosphere:{type:h,json:{read:!1}},
atmosphereEnabled:{value:!0,json:{read:!1}},starsEnabled:{value:!0,json:{read:!1}},lighting:{set:function(d){if(!d)return void(this.lighting||this._set("lighting",new l));if(this.lighting)null!=d.date&&(this.lighting.date=d.date),null!=d.defaultDate&&(this.lighting.defaultDate=d.defaultDate),null!=d.displayUTCOffset&&(this.lighting.displayUTCOffset=d.displayUTCOffset),this.lighting.directShadowsEnabled=d.directShadowsEnabled,null!=d.ambientOcclusionEnabled&&(this.lighting.ambientOcclusionEnabled=
d.ambientOcclusionEnabled),null!=d.cameraTrackingEnabled&&(this.lighting.cameraTrackingEnabled=d.cameraTrackingEnabled);else if(d instanceof l)this._set("lighting",d);else if(d instanceof w){var h={directShadowsEnabled:d.directShadowsEnabled};null!=d.date&&(h.date=d.date);null!=d.displayUTCOffset&&(h.displayUTCOffset=d.displayUTCOffset);null!=d.defaultDate&&(h.defaultDate=d.defaultDate);this._set("lighting",new l(h))}else this._set("lighting",new l(d))}}},getDefaults:function(){return A.mixin(this.inherited(arguments),
{atmosphere:{}})},atmosphere:null,atmosphereEnabled:!0,starsEnabled:!0,clone:function(){return new d({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled})}});return d})},"esri/views/3d/environment/SceneViewLighting":function(){define(["../../../core/Evented","../../../webscene/Lighting"],function(A,p){var w=new Date,l={target:null,date:null},h={target:null,timezoneOffset:0};return p.createSubclass([A],{declaredClass:"esri.views.3d.environment.SceneViewLighting",
properties:{cameraTrackingEnabled:{value:!0},ambientOcclusionEnabled:{value:!1},defaultDate:{get:function(){return new Date(this._get("defaultDate"))},set:function(d){var h=this._get("date")===this._get("defaultDate");d=new Date(d);this._set("defaultDate",d);h&&this._set("date",d)}},date:{cast:function(d){return d},set:function(d){null!=d&&(this._set("date",new Date(d)),this.positionTimezoneInfo.autoUpdated=!1,this._emitDateWillChange())}}},constructor:function(){this.positionTimezoneInfo={hours:0,
minutes:0,seconds:0,autoUpdated:!0};this._autoUpdateDate=null;var d=(new Date).getFullYear(),d=new Date("March 15, "+d+" 12:00:00 UTC");this._set("defaultDate",d);this._set("date",d)},autoUpdate:function(d,l){var r=this._calculateTimezoneOffset(this.positionTimezoneInfo);if(this.positionTimezoneInfo.hours=l.hours,this.positionTimezoneInfo.minutes=l.minutes,this.positionTimezoneInfo.seconds=l.seconds,null!=d){this.positionTimezoneInfo.autoUpdated=!0;var a=this.date&&this.date.getTime();this._set("date",
new Date(d));this._emitDateWillChange()}l=this._calculateTimezoneOffset(this.positionTimezoneInfo);return r!==l&&(h.target=this,h.timezoneOffset=l,this.emit("timezone-will-change",h)),null!=d?a!==d.getTime():void 0},_calculateTimezoneOffset:function(d){return Math.round(d.hours+d.minutes/60+d.seconds/3600)},_emitDateWillChange:function(){l.target=this;w.setTime(this._get("date").getTime());l.date=w;this.emit("date-will-change",l)}})})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define(["../../../core/Accessor"],
function(A){return A.createSubclass({properties:{quality:{}},quality:"low",_qualitySetter:function(p){-1!==["low","high"].indexOf(p)&&this._set("quality",p)},clone:function(){return new this.constructor({quality:this.quality})}})})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("../../../core/declare ../../../core/Accessor ../../../core/Evented ../../../core/promiseUtils ../../../core/watchUtils ../../../core/HandleRegistry ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../../../geometry/SpatialReference ../support/sunUtils ../support/earthUtils ./EnvironmentRenderer ../webgl-engine/lighting/Lightsources ../lib/glMatrix".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q){var v=q.vec3d,y=new Date,B={hours:0,minutes:0,seconds:0},D=[.5773502691896258,-.5773502691896258,.5773502691896258],b=v.createFrom(.22,.22,.33),m=v.createFrom(.22,.22,.22);A=A([p,w],{declaredClass:"esri.views.3d.environment.SceneViewEnvironmentManager",referencePointUpdateDelay:200,referencePointUpdateInterval:3E3,referencePointUpdateDistThreshold:1E6,properties:{updating:{dependsOn:["noReferencePositionQueries"],readOnly:!0,get:function(){return!(this.noReferencePositionQueries||
!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)}},noReferencePositionQueries:{},view:{},_environmentRenderer:{}},constructor:function(){this._viewHandles=new d;this._environmentRenderer=null;this._viewConnected=this._trackingEnabled=this._preserveAbsoluteDateTime=!1;this._referencePosResetPreserveAbsoluteTime=null;this._resetReferencePosition()},destroy:function(){this._viewHandles.destroy();this.disposeRendering()},disposeRendering:function(){this._environmentRenderer&&(this._environmentRenderer.destroy(),
this._environmentRenderer=null);this._resetReferencePosition(!0)},updateReadyChange:function(a){a&&!this._viewConnected?(this._viewConnected=!0,this.connectView(this.view)):!a&&this._viewConnected&&(this._viewConnected=!1,this.disconnectView(this.view))},connectView:function(a){this._environmentRenderer=new t({view:a});this._viewHandles.add([h.on(this.view,"environment.lighting","date-will-change",this._lightingDateHandler.bind(this)),this.view.watch("interacting,stationary",this._interactingStationaryHandler.bind(this)),
this.view.watch("environment.lighting.directShadowsEnabled,environment.lighting.ambientOcclusionEnabled",this._updateRenderParamsHandler.bind(this)),this.view.watch("spatialReference",this._spatialReferenceHandler.bind(this)),h.init(this.view,"viewingMode",this._viewingModeHandler.bind(this)),h.init(this.view,"environment.lighting.cameraTrackingEnabled",this._updateCameraTracking.bind(this),!0),this.watch("noReferencePositionQueries",this._cameraHandler.bind(this,null))]);this._updateRenderParamsHandler();
this._updateLightParams();this._cameraHandler()},_updateCameraTracking:function(a){(this._trackingEnabled=a,a)?(a=h.init(this,"view.state.camera",this._cameraHandler.bind(this,null),!0),this._viewHandles.add(a,"camera")):((a=this.get("view.environment.lighting"))&&(a.positionTimezoneInfo.autoUpdated=!1),this._viewHandles.remove("camera"))},disconnectView:function(a){this.disposeRendering();this._viewHandles.removeAll()},_lightingDateHandler:function(a){if(a=a.date){var b=this.view.environment.lighting;
if(!b.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;var d=this.view.spatialReference;if(!(d.isWGS84||d.isWebMercator||(d=this.view.camera.position,this._referencePosMapCoords&&this._referencePosMapCoords.equals(d))))return void this._requestReferencePositionUpdate(d);if(this._preupdateTracking(a),this._referencePosWGS84)d=c.positionToTimezone(this._referencePosWGS84,B),b.autoUpdate(null,d),this._trackingEnabled&&(b.positionTimezoneInfo.autoUpdated=!0)}this._updateLightParams(a)}},
_preupdateTracking:function(a){!this._trackingEnabled&&this.get("view.environment.lighting.cameraTrackingEnabled")&&this._cameraHandler(a)},_cameraHandler:function(a){if(this.view.ready){var b=this.view.camera;if(b){var c=this.view.spatialReference;c.isWGS84||c.isWebMercator?this._cameraHandlerGlobal(b,a):this._cameraHandlerLocal(b,a)}}},_cameraHandlerGlobal:function(b,c){b=b.position;this._referencePosWGS84||(this._referencePosWGS84=new u({spatialReference:a.WGS84}));b.spatialReference.isWebMercator?
r.webMercatorToGeographic(b,!1,this._referencePosWGS84):(this._referencePosWGS84.x=b.x,this._referencePosWGS84.y=b.y);this._referencePosWGS84.z=b.z;this._autoUpdateTimezone(b,c)||this._updateLightParams(c)},_cameraHandlerLocal:function(a,b){a=a.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(a))&&this._requestReferencePositionUpdate(a,!0);this.view.mapCoordsHelper&&this._referencePosWGS84&&(this._referencePosWGS84.z=a.z*this.view.mapCoordsHelper.unitInMeters,
this._referencePosChanged())},_interactingStationaryHandler:function(){!this.view.interacting&&this.view.stationary&&this._executePendingReferencePositionUpdate()},_mainLight:new C.MainLight,_ambientLight:new C.AmbientLight,_moonLight:new C.FillLight,_updateLightParams:function(a){var c=this.view.environment.lighting;a=a||c.date;var d,c=this.view._stage;this._referencePosWGS84?(d=k.computeColorAndIntensity(a,this._referencePosWGS84),k.computeDirection(a,this._referencePosWGS84,this.view.viewingMode,
d.diffuse.direction)):d={diffuse:{color:[1,1,1],intensity:.55,direction:D},ambient:{color:[1,1,1],intensity:.55},noonFactor:.5,globalFactor:0};v.scale(d.diffuse.color,d.diffuse.intensity*Math.PI,this._mainLight.intensity);v.negate(d.diffuse.direction,this._mainLight.direction);v.scale(d.ambient.color,d.ambient.intensity,this._ambientLight.intensity);v.lerp(b,m,d.globalFactor,this._moonLight.intensity);v.scale(this._moonLight.intensity,(1-.5*d.globalFactor)*(1-.4*d.noonFactor*(1-d.globalFactor)));
v.set(d.diffuse.direction,this._moonLight.direction);c.setLighting({lights:[this._mainLight,this._ambientLight,this._moonLight],globalFactor:d.globalFactor,groundLightingFactor:1-d.noonFactor});this._updateRenderParamsHandler()},_autoUpdateTimezone:function(a,b){if(!this.view.get("environment.lighting.cameraTrackingEnabled"))return!1;y.setTime((b||this.view.environment.lighting.date).getTime());a=c.positionToTimezone(a,B);var d=this.view.environment.lighting.positionTimezoneInfo;if(d.autoUpdated){if(d.hours===
a.hours&&d.minutes===a.minutes&&d.seconds===a.seconds)return!1}else d=a;var k=y.getUTCHours()-(a.hours-d.hours),m=y.getUTCMinutes()-(a.minutes-d.minutes),d=y.getUTCSeconds()-(a.seconds-d.seconds);return y.setUTCHours(k),y.setUTCMinutes(m),y.setUTCSeconds(d),b?!1:this.view.environment.lighting.autoUpdate(y,a)},_updateRenderParamsHandler:function(){var a=this.view._stage,b=!0;this._referencePosWGS84&&(b=k.computeShadowsEnabled(this._referencePosWGS84,this.view.viewingMode));a&&a.setRenderParams({shadowMap:this.view.environment.lighting.directShadowsEnabled&&
b,ssao:this.view.environment.lighting.ambientOcclusionEnabled})},_spatialReferenceHandler:function(){this._resetReferencePosition()},_viewingModeHandler:function(a){this._resetReferencePosition()},_resetReferencePosition:function(a){this._cancelReferencePosUpdates();this._referencePosWGS84=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;a||this.notifyChange("updating")},_requestReferencePositionUpdate:function(a,b){if(this.view.mapCoordsHelper.canProject()&&
!this.noReferencePositionQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(a):this._referencePosMapCoordsRequested=a.clone(),this._referencePosResetPreserveAbsoluteTime=!!b,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&!this.view.interacting&&this.view.stationary)){var c=this,d=this._referencePosUpdateQuery=l.after(this.referencePointUpdateDelay).then(function(){if(c._referencePosUpdateQuery===d)return c._doReferencePositionUpdateQuery(function(){return c._referencePosUpdateQuery!==
d})}).always(function(){c._referencePosUpdateQuery===d&&(c._referencePosUpdateQuery=null,c._referencePosUpdateTimer||c._executePendingReferencePositionUpdate(),c.notifyChange("updating"))}),k=this._referencePosUpdateTimer=l.after(this.referencePointUpdateInterval).then(function(){c._referencePosUpdateTimer===k&&(c._referencePosUpdateTimer=null,c._referencePosUpdateQuery||c._executePendingReferencePositionUpdate())});this.notifyChange("updating")}},_doReferencePositionUpdateQuery:function(b){return this._referencePosResetPreserveAbsoluteTime&&
(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null,this.view.mapCoordsHelper.toGeographic(this._referencePosMapCoords).then(function(c){if(!b()&&!isNaN(c[0])&&!isNaN(c[1])){var d=this._referencePosMapCoords.z*this.view.mapCoordsHelper.unitInMeters;this._referencePosWGS84?
(this._referencePosWGS84.x=c[0],this._referencePosWGS84.y=c[1],this._referencePosWGS84.z=d):this._referencePosWGS84=new u({x:c[0],y:c[1],z:d,spatialReference:a.WGS84});this._referencePosChanged()}}.bind(this))},_executePendingReferencePositionUpdate:function(){var a=this._referencePosMapCoordsRequested;a&&this._requestReferencePositionUpdate(a,this._referencePosResetPreserveAbsoluteTime)},_referencePosChanged:function(){this._preserveAbsoluteDateTime?this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84)||
this._updateLightParams()},_exceedsReferencePosDistThreshold:function(a){return this._referencePosMapCoords?(a=this._referencePosMapCoords.distance(a),this.view.mapCoordsHelper&&(a*=this.view.mapCoordsHelper.unitInMeters),a>this.referencePointUpdateDistThreshold):!0},_cancelReferencePosUpdates:function(){this._referencePosUpdateTimer=this._referencePosUpdateQuery=null}});return A.FIXED_LIGHT_DIRECTION=D,A})},"esri/views/3d/support/sunUtils":function(){define(["./mathUtils","../lib/glMatrix","../lib/SunCalc"],
function(A,p,w){var l=p.vec3d,h=p.mat4d,d=A.lerp,u=h.identity(),r={azimuth:0,altitude:0},a={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:Math.PI/3,altitude:Math.PI/3}}},k={ambient:{color:l.create(),intensity:0},diffuse:{color:l.create(),intensity:0,direction:l.create()}},c={settings:a,computeDirection:function(a,
d,k,t){t||(t=l.create());var q=h.identity(u);if("global"===k)w.getPosition(a,0,0,r),l.set3(0,0,-1,t),h.rotateX(q,-r.azimuth),h.rotateY(q,-r.altitude);else{var v=c.settings.planarDirection;k=v.globalAngles;v=(Math.abs(d.z)-v.localAltitude)/(v.globalAltitude-v.localAltitude);v=A.clamp(v,0,1);1>v?(w.getPosition(a,d.y,d.x,r),r.azimuth=(1-v)*r.azimuth+v*k.azimuth,r.altitude=(1-v)*r.altitude+v*k.altitude):(r.azimuth=k.azimuth,r.altitude=k.altitude);l.set3(0,-1,0,t);h.rotateZ(q,-r.azimuth);h.rotateX(q,-r.altitude)}h.multiplyVec3(q,
t);return t},computeShadowsEnabled:function(a,d){return"global"===d?!0:Math.abs(a.z)<c.settings.planarDirection.localAltitude},computeColorAndIntensity:function(h,q){var v=q.z,r=c.settings;l.set3(1,1,1,k.ambient.color);k.ambient.intensity=r.global.ambient;l.set3(1,1,1,k.diffuse.color);k.diffuse.intensity=r.global.diffuse;v=(Math.abs(v)-r.local.altitude)/(r.global.altitude-r.local.altitude);v=A.clamp(v,0,1);k.globalFactor=v;q=w.getTimes(h,q.y,q.x);if(1>v){var u,C,r=h.valueOf();q.polarException===w.POLAR_EXCEPTION.MIDNIGHT_SUN?
(u=r-36E5*(h.getHours()+48)-6E4*h.getMinutes(),C=u+432E6):q.polarException===w.POLAR_EXCEPTION.POLAR_NIGHT?(u=r-2,C=r-1):(u=q.sunrise.valueOf(),C=q.sunset.valueOf());var b,m,p=C-u,J=u+p/2,G=p/4,K=J-G,G=J+G,M=.06*p,p=u-M/2;u+=M/2;var U=C-M/2;C+=M/2;var N=a.local,M=[.01,N.ambientAtNight],W=[.8,.8,1],R=[.01,.01,.01],V=[N.diffuseAtTwilight,N.ambientAtTwilight],Q=[1,.75,.75],S=[.8,.8,1],X=[.9*N.diffuseAtNoon,N.ambientAtNoon],z=[1,.98,.98],Z=[.98,.98,1],O=[N.diffuseAtNoon,N.ambientAtNoon],g=[1,1,1],e=[1,
1,1],N=[0,0],f=[0,0],n=[0,0],r=(p>r||r>C?(N=M,f=R,n=W,m="night"):u>r?(b=u-p,N=t(r-p,b,M,V),f=t(r-p,b,R,Q),n=t(r-p,b,W,S),m="sun rising"):K>r?(b=K-u,N=t(r-u,b,V,X),f=t(r-u,b,Q,z),n=t(r-u,b,S,Z),m="early morning"):J>r?(b=J-K,N=t(r-K,b,X,O),f=t(r-K,b,z,g),n=t(r-K,b,Z,e),m="late morning"):G>r?(b=G-J,N=t(r-J,b,O,X),f=t(r-J,b,g,z),n=t(r-J,b,e,Z),m="early afternoon"):U>r?(b=U-G,N=t(r-G,b,X,V),f=t(r-G,b,z,Q),n=t(r-G,b,Z,S),m="late afternoon"):C>r&&(b=C-U,N=t(r-U,b,V,M),f=t(r-U,b,Q,R),n=t(r-U,b,S,W),m="sun setting"),
{diffuse:{intensity:N[0],color:f},ambient:{intensity:N[1],color:n},timeOfDay:m});l.lerp(r.ambient.color,k.ambient.color,v,k.ambient.color);k.ambient.intensity=d(r.ambient.intensity,k.ambient.intensity,v);l.lerp(r.diffuse.color,k.diffuse.color,v,k.diffuse.color);k.diffuse.intensity=d(r.diffuse.intensity,k.diffuse.intensity,v)}var x,I;b=h.valueOf();q.polarException===w.POLAR_EXCEPTION.MIDNIGHT_SUN?(x=b-36E5*(h.getHours()+48)-6E4*h.getMinutes(),I=x+432E6):q.polarException===w.POLAR_EXCEPTION.POLAR_NIGHT?
(x=b-2,I=b-1):(x=q.sunrise.valueOf(),I=q.sunset.valueOf());h=1-A.clamp(Math.abs(b-(x+(I-x)/2))/432E5,0,1);return k.noonFactor=h,k}},t=function(a,c,d,k){for(var h=[],l=0;l<d.length;l++)h[l]=(k[l]-d[l])*a/c+d[l];return h};return c})},"esri/views/3d/lib/SunCalc":function(){define([],function(){function A(a){return new Date((a+.5-b)*D)}function p(a,b){return v(c(a)*t(J)-C(b)*c(J),t(a))}function w(a,b){return q(c(b)*t(J)+t(b)*c(J)*c(a))}function l(a,b,d){return v(c(a),t(a)*c(b)-C(d)*t(b))}function h(a,
b,d){return q(c(b)*c(d)+t(b)*t(d)*t(a))}function d(a){return B*(1.9148*c(a)+.02*c(2*a)+3E-4*c(3*a))}function u(a,b){a=B*(357.5291+.98560028*a);var c=d(a);a=a+c+102.9372*B+k;return b||(b={dec:0,ra:0}),b.dec=w(a,0),b.ra=p(a,0),b}function r(a,b,d){return m+a+.0053*c(b)-.0069*c(2*d)}function a(a){var b=B*(134.963+13.064993*a),d=B*(93.272+13.22935*a);a=B*(218.316+13.176396*a)+6.289*B*c(b);d=5.128*B*c(d);b=385001-20905*t(b);return{ra:p(a,d),dec:w(a,d),dist:b}}var k=Math.PI,c=Math.sin,t=Math.cos,C=Math.tan,
q=Math.asin,v=Math.atan2,y=Math.acos,B=k/180,D=864E5,b=2440588,m=2451545,E={dec:0,ra:0},J=23.4397*B,G={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(a,c,d,k){d=B*-d;c*=B;var q=a.valueOf()/D-.5+b-m;a=u(q,E);d=B*(280.16+360.9856235*q)-d-a.ra;return k||(k={azimuth:0,altitude:0}),k.azimuth=l(d,c,a.dec),k.altitude=h(d,c,a.dec),k}},K=[[-.83,"sunrise","sunset"]];G.addTime=function(a,b,c){K.push([a,b,c])};return G.getTimes=function(a,h,l){function q(a){var e=p,b=M;a=y((c(a)-
c(e)*c(b))/(t(e)*t(b)));return r(9E-4+(a+C)/(2*k)+E,z,J)}var v,u,C=B*-l,p=B*h,E=Math.round(a.valueOf()/D-.5+b-m-9E-4-C/(2*k));a=9E-4+(0+C)/(2*k)+E;var z=B*(357.5291+.98560028*a);h=d(z);var J=z+h+102.9372*B+k,M=w(J,0),g=r(a,z,J),e={solarNoon:A(g),nadir:A(g-.5),polarException:G.POLAR_EXCEPTION.NORMAL};a=0;for(h=K.length;h>a;a+=1)l=K[a],v=q(l[0]*B),u=g-(v-g),e[l[1]]=A(u),e[l[2]]=A(v);return e.polarException=function(a){a=(c(a)-c(p)*c(M))/(t(p)*t(M));return-1>a?G.POLAR_EXCEPTION.MIDNIGHT_SUN:1<a?G.POLAR_EXCEPTION.POLAR_NIGHT:
G.POLAR_EXCEPTION.NORMAL}(K[0][0]*B),e},G.getMoonPosition=function(c,d,k){k=B*-k;d*=B;var q=c.valueOf()/D-.5+b-m;c=a(q);k=B*(280.16+360.9856235*q)-k-c.ra;q=h(k,d,c.dec);return q+=.017*B/C(q+10.26*B/(q+5.1*B)),{azimuth:l(k,d,c.dec),altitude:q,distance:c.dist}},G.getMoonFraction=function(d){var k=d.valueOf()/D-.5+b-m;d=u(k);k=a(k);d=y(c(d.dec)*c(k.dec)+t(d.dec)*t(k.dec)*t(d.ra-k.ra));d=v(149598E3*c(d),k.dist-149598E3*t(d));return(1+t(d))/2},G})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("../../../core/watchUtils ../support/ExternalRenderer ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars ../webgl-engine/lib/RenderSlot".split(" "),
function(A,p,w,l,h,d,u){return p.createSubclass({declaredClass:"esri.views.3d.environment.EnvironmentRenderer",properties:{view:{},viewingMode:{dependsOn:["view.viewingMode"],get:function(){return this.get("view.viewingMode")||"global"}},atmosphereQuality:{dependsOn:["view.environment.atmosphereEnabled","view.environment.atmosphere.quality"],get:function(){return this.get("view.environment.atmosphereEnabled")?this.get("view.environment.atmosphere.quality")||"none":"none"}},starsEnabled:{dependsOn:["view.environment.starsEnabled"],
get:function(){return this.get("view.environment.starsEnabled")||!1}},transparent:{dependsOn:["view.basemapTerrain.opacity","view.basemapTerrain.wireframe"],get:function(){var d=this.get("view.basemapTerrain");return d&&d._renderer.isTransparent()}},_atmosphere:{},_stars:{},needsRender:{dependsOn:["_stars.needsRender","_atmosphere.needsRender"],get:function(){return!!(this._needsRender||this._atmosphere&&this._atmosphere.needsRender||this._stars&&this._stars.needsRender)}}},constructor:function(){this._STANDARD_SLOT=
u.BACKGROUND;this._SPECIAL_SLOT=u.POSTPROCESSING_ATMOSPHERE;this._slots=[this._STANDARD_SLOT,this._SPECIAL_SLOT];this._stars=this._atmosphere=this._atmosphereReadyPromise=this._AtmosphereClass=null;this._needsRender=!0;this.notifyChange("needsRender")},initialize:function(){this.view._stage.addExternalRenderer(this._slots,this);this._basemapTerrainHandle=A.when(this.view,"basemapTerrain",this._updateBasemapTerrain.bind(this))},destroy:function(){this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=
null);this._stars&&(this._stars.destroy(),this._stars=null);this._basemapTerrainHandle&&this._basemapTerrainHandle.remove();this.view&&(this.view._stage.removeExternalRenderer(this),this.view=null)},setup:function(d){this.watch("viewingMode,atmosphereQuality,transparent,visible",this._updateAtmosphere.bind(this));this._updateAtmosphere();this.watch("starsEnabled,transparent,visible",this._updateStars.bind(this));this._updateStars();this.watch("view.basemapTerrain.loaded",function(){this._needsRender=
!0;this.notifyChange("needsRender")}.bind(this))},resetNeedsRender:function(){this._atmosphere&&(this._atmosphere.resetNeedsRender?this._atmosphere.resetNeedsRender():this._atmosphere.didRender&&(this._atmosphere.needsRender=!1,this._atmosphere.didRender=!1));this._stars&&(this._stars.resetNeedsRender?this._stars.resetNeedsRender():this._stars.didRender&&(this._stars.needsRender=!1,this._stars.didRender=!1));this.didRender&&(this._needsRender=!1,this.didRender=!1,this.notifyChange("needsRender"))},
render:function(d){return this.get("view.basemapTerrain.loaded")||"global"!==this.viewingMode?this._stars||this._atmosphere?(this._stars&&this._stars.render(d),this._atmosphere&&this._atmosphere.render(d),this._stars&&this._stars.didRender||this._atmosphere&&this._atmosphere.didRender):!0:!1},_updateStars:function(){var h=this._getAtmosphereSlot();this.starsEnabled&&!this._stars?(this._stars=new d({view:this.view,slot:h}),this._stars.initializeRenderContext(this.renderContext)):!this.starsEnabled&&
this._stars?(this._stars.destroy(),this._stars=null):this._stars&&(this._stars.slot=h);this._needsRender=!0;this.notifyChange("needsRender")},_updateAtmosphere:function(){var d=this._getAtmosphereSlot();if(this._atmosphere&&(this._atmosphere.slot=d),this._updateAtmosphereClass(this.renderContext)){this._needsRender=!0;this.notifyChange("needsRender");var a=function(){this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null)}.bind(this);if(!this._AtmosphereClass)return a(),void this._updateBasemapTerrain();
this._atmosphereReadyPromise&&(this._atmosphereReadyPromise.cancel(),this._atmosphereReadyPromise=null);var k=new this._AtmosphereClass({view:this.view,slot:d});k.initializeRenderContext(this.renderContext);this._atmosphere?this._atmosphereReadyPromise=k.when(function(){a();this._atmosphereReadyPromise=null;this._atmosphere=k}.bind(this)):this._atmosphere=k;k.when(this._updateBasemapTerrain.bind(this))}},_updateAtmosphereClass:function(d){var a=this._AtmosphereClass;return"none"===this.atmosphereQuality?
this._AtmosphereClass=null:"high"===this.atmosphereQuality&&!this.transparent&&l.isSupported(d)?"local"===this.viewingMode?this._AtmosphereClass=w:this._AtmosphereClass=l:"local"===this.viewingMode?this._AtmosphereClass=w:this._AtmosphereClass=h,this._AtmosphereClass!==a},_getAtmosphereSlot:function(){return this.transparent&&"global"===this.viewingMode?this._SPECIAL_SLOT:this._STANDARD_SLOT},_updateBasemapTerrain:function(){var d=this.get("view.basemapTerrain");d&&(d.velvetOverground=!(!this._AtmosphereClass||
this._AtmosphereClass===l))}})})},"esri/views/3d/support/ExternalRenderer":function(){define("../../../core/declare ../../../core/Accessor ../../../core/Promise dojo/Deferred dojo/aspect dojo/_base/lang".split(" "),function(A,p,w,l,h,d){return A([p,w],{"-chains-":d.mixin(p._meta.chains,{setup:"after",initializeRenderContext:"after",uninitializeRenderContext:"before"}),properties:{gl:{readOnly:!0,get:function(){return this._gl}},needsRender:{value:!0},visible:{value:!0}},constructor:function(){this.didRender=
!1;this.renderContext=null;this.watch("visible",function(){this.needsRender=!0}.bind(this));this._contextDfd=new l},initialize:function(){this.addResolvingPromise(this._contextDfd.promise);h.around(this,"render",function(d){return function(){return this.isRejected()?(this.didRender=!0,!0):!this.isResolved()||this.visible&&!d.apply(this,arguments)?!1:(this.didRender=!0,!0)}.bind(this)}.bind(this));this.when(function(){this.destroyed||this.setup(this.renderContext)}.bind(this))},needsRender:!0,visible:!0,
initializeRenderContext:function(d){this.renderContext=d;this._contextDfd.resolve()},uninitializeRenderContext:function(d){},setup:function(d){},render:function(d){return!1}})})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("dojo/text!./materials/SimpleAtmosphereMaterial.xml dojo/Deferred ../support/ExternalRenderer ../lib/glMatrix ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/Texture ../webgl-engine/lib/Util ../webgl-engine/lib/GLTextureRep ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ./resources/SimpleAtmosphereTexture ../../webgl/Program ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/DefaultVertexAttributeLocations".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v){var y=l.vec2d,B=l.vec3d,D=l.mat4d,b=r.VertexAttrConstants,m=D.create();return w.createSubclass({declaredClass:"esri.views.3d.environment.PanoramicAtmosphere",properties:{view:{},needsRender:{value:!1},slot:{value:c.BACKGROUND,set:function(a){this.needsRender=!0;this._set("slot",a)}}},constructor:function(){this._renderData={texV:y.create(),silCircleCenter:B.create(),silCircleV1:B.create(),silCircleV2:B.create()};this._textureRep=this._texture=null;this.slot=
c.BACKGROUND},initialize:function(){this._textureDfd=new p;this.addResolvingPromise(this._textureDfd.promise)},destroy:function(){this._textureRep&&(this._texture&&(this._textureRep.release("SimpleAtmosphere"),this._textureRep.getTexture("SimpleAtmosphere").unload()),this._textureRep=null);this._program&&(this._program.dispose(),this._program=null);this._textureDfd&&(this._textureDfd.cancel(),this._textureDfd=null)},initializeRenderContext:function(b){this._textureRep=new a({SimpleAtmosphere:new u(t,
"SimpleAtmosphere",{wrapClamp:!0})},b.programRep,function(){return this.view.state.camera.viewport}.bind(this),b.rctx);this._texture=this._textureRep.aquire("SimpleAtmosphere",void 0,void 0,function(a){this._texture=a.getGLTexture();this._textureDfd.resolve();this._textureDfd=null}.bind(this))},setup:function(a){var b=this._createGeometryData(),c=this.renderContext.rctx;this._renderer=new h(b,q.Pos3,null,c);a.shaderSnippets.vsSimpleAtmosphere||a.shaderSnippets._parse(A);this._program=new C(c,a.shaderSnippets.vsSimpleAtmosphere,
a.shaderSnippets.fsSimpleAtmosphere,v.Default3D,["PANORAMIC"])},render:function(a){if(a.slot!==this.slot||a.pass!==k.MATERIAL||!this._textureRep.getIsLoaded("SimpleAtmosphere"))return!1;var b=this.renderContext.rctx,c=b.gl,d=this._program;return b.bindProgram(d),b.bindTexture(this._texture),d.setUniform1i("tex",0),d.setUniformMatrix4fv("proj",a.camera.projectionMatrix),D.toRotationMat(a.camera.viewMatrix,m),d.setUniformMatrix4fv("view",m),d.setUniform4f("color",1,1,1,1),d.setUniform3fv("lightDirection",
a.lightingData.direction),b.setFaceCullingEnabled(!0),b.setDepthFunction(c.LEQUAL),b.setBlendingEnabled(!0),b.setDepthWriteEnabled(!1),this._renderer.render(this._program),b.setDepthWriteEnabled(!0),b.setBlendingEnabled(!1),b.setDepthFunction(c.LESS),b.setFaceCullingEnabled(!1),!0},_createGeometryData:function(){for(var a=d.createPolySphereGeometry(1,2),c=a.indices[b.POSITION],k=0;k<c.length;k+=3){var m=c[k];c[k]=c[k+2];c[k+2]=m}c=a.getVertexAttr();m=c[b.NORMAL].data;for(k=0;k<m.length;k++)m[k]=-m[k];
return{indices:a.indices,vertexAttr:c}}})})},"esri/views/3d/webgl-engine/lib/GeometryRenderer":function(){define("require exports ../materials/internal/MaterialUtil ./Util ./DefaultVertexAttributeLocations ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Util ../../../webgl/enums".split(" "),function(A,p,w,l,h,d,u,r,a){return function(){function a(a,k,C,q){this._drawMode=4;this._count=a.indices[l.VertexAttrConstants.POSITION].length;var c=new Float32Array(this._count*r.getStride(k)/
4);C?C(a,void 0,void 0,null,k,c,0):w.fillInterleaved(a,void 0,void 0,null,k,c,0);this._rctx=q;this._vao=new d(q,h.Default3D,{geometry:k},{geometry:u.createVertex(q,35044,c)})}return a.prototype.enablePointRendering=function(a){this._drawMode=a?0:4},a.prototype.render=function(a){var c=this._rctx;c.bindVAO(this._vao);r.assertCompatibleVertexAttributeLocations(this._vao,a);c.drawArrays(this._drawMode,0,this._count)},a}()})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("require exports ../../lib/IdGen ../../lib/gl-matrix ../../lib/ComponentUtils ../../lib/Util ../../parts/Model ../../lib/screenSizePerspectiveUtils ../../../../webgl/Util ../../../support/aaBoundingBox".split(" "),
function(A,p,w,l,h,d,u,r,a,k){function c(a,b,c,d,k,g){if(void 0===k||3!==g)for(k=0;g>k;++k)c[d+k]=a[b+k];else{var e=a[b],f=a[b+1];a=a[b+2];c[d]=k[0]*e+k[4]*f+k[8]*a+k[12];c[d+1]=k[1]*e+k[5]*f+k[9]*a+k[13];c[d+2]=k[2]*e+k[6]*f+k[10]*a+k[14]}return g}function t(a,b,c,d,k,g){for(var e=a.length,f=0;e>f;++f){for(var m=c*a[f],h=0;c>h;++h)d[k+h]=b[m+h];k+=g}}function C(a,b,c,d,k,g){d=new Uint8Array(d.buffer);k*=4;g*=4;var e=a.length;if(4===c)for(c=0;e>c;++c){var f=4*a[c];d[k]=b[f];d[k+1]=b[f+1];d[k+2]=b[f+
2];d[k+3]=b[f+3];k+=g}else if(3===c)for(c=0;e>c;++c)f=3*a[c],d[k]=b[f],d[k+1]=b[f+1],d[k+2]=b[f+2],d[k+3]=255,k+=g}function q(a,b,c,d,m){var g=y(b,c,M);if(k.setMin(G,a.getBBMin()),k.setMax(G,a.getBBMax()),B(G,b,g,d)){var g=a.getPrimitiveIndices(),e=a.getIndices(),f=a.getPosition(),n=g?g.length:e.length/3;if(1E4<n&&(a=a.getChildren(),void 0!==a)){for(g=0;8>g;++g)void 0!==a[g]&&q(a[g],b,c,d,m);return}v(b,c,0,n,e,f,g,m)}}function v(a,b,c,d,k,g,e,f){var m=g.data,h=g.offsetIdx;g=g.strideIdx;var q=a[0],
t=a[1];a=a[2];var v=b[0]-q,r=b[1]-t;for(b=b[2]-a;d>c;c++){var y=e?e[c]:c,u=h+g*k[3*y],B=h+g*k[3*y+1],C=h+g*k[3*y+2],p=m[u],D=m[u+1],E=m[u+2],u=m[B]-p,z=m[B+1]-D,B=m[B+2]-E,w=m[C]-p,G=m[C+1]-D,C=m[C+2]-E,K=r*C-G*b,J=b*w-C*v,M=v*G-w*r,F=u*K+z*J+B*M,p=q-p,A=t-D,S=a-E,D=A*B-z*S,E=S*u-B*p,Q=p*z-u*A;if(F>U){K=p*K+A*J+S*M;if(0>K||K>F)continue;J=v*D+r*E+b*Q;if(0>J||K+J>F)continue}else{if(!(-U>F))continue;K=p*K+A*J+S*M;if(0<K||F>K)continue;J=v*D+r*E+b*Q;if(0<J||F>K+J)continue}F=(w*D+G*E+C*Q)/F;0<=F&&(K=N,
u=(l.vec3d.set3(u,z,B,W),l.vec3d.set3(w,G,C,R),l.vec3d.normalize(l.vec3d.cross(W,R,K))),f(F,u,y))}}function y(a,b,c){return l.vec3d.set3(1/(b[0]-a[0]),1/(b[1]-a[1]),1/(b[2]-a[2]),c)}function B(a,b,c,d){var k=(a[0]-d-b[0])*c[0],g=(a[3]+d-b[0])*c[0],e=Math.min(k,g),k=Math.max(k,g),g=(a[1]-d-b[1])*c[1],f=(a[4]+d-b[1])*c[1];if(e=Math.max(e,Math.min(g,f)),k=Math.min(k,Math.max(g,f)),e>k)return!1;g=(a[2]-d-b[2])*c[2];a=(a[5]+d-b[2])*c[2];return e=Math.max(e,Math.min(g,a)),k=Math.min(k,Math.max(g,a)),k>=
e}function D(a,b,c,d){return void 0!==a?c.aquire(a,b,d):void 0}function b(a,b){void 0!==a&&b.release(a)}function m(a,b){b=b?m(b):{};for(var c in a){var d=a[c];d&&d.forEach&&(d=E(d));null==d&&c in b||(b[c]=d)}return b}function E(a){var b=[];return a.forEach(function(a){return b.push(a)}),b}Object.defineProperty(p,"__esModule",{value:!0});var J=l.mat4d.create(),G=k.create(),K=d.VertexAttrConstants;p.__Material_idGen=new w;p.__GLMaterial_id=0;p.IDENTITY=l.mat4d.identity();p.fill=c;p.fillInterleaved=
function(b,c,d,k,m,g,e,f){for(var n=a.getStride(m)/4,h=0;h<m.length;h++){var l=m[h],q=e+l.offset/4,l=l.name,v=b.vertexAttr[l];if(null!=v&&(null==f||null!=f[l]))switch(l){case "uv0":t(b.indices[l],v.data,v.size,g,q,n);break;case "region":for(var l=b.indices[l],r=v.data,y=v.size,v=g,u=n,v=new Uint16Array(v.buffer),q=2*q,u=2*u,B=l.length,p=0;B>p;++p){for(var D=y*l[p],E=0;y>E;++E)v[q+E]=r[D+E];q+=u}break;case "color":if(k&&k.color)if(l=b.indices[l],r=v.data,y=k.color,p=v.size,v=g,u=n,v=new Uint8Array(v.buffer),
q*=4,u*=4,B=l.length,4===p)for(p=0;B>p;++p)D=4*l[p],v[q]=r[D]*y[0],v[q+1]=r[D+1]*y[1],v[q+2]=r[D+2]*y[2],v[q+3]=r[D+3]*y[3],q+=u;else{if(3===p)for(E=255*y[3],p=0;B>p;++p)D=3*l[p],v[q]=r[D]*y[0],v[q+1]=r[D+1]*y[1],v[q+2]=r[D+2]*y[2],v[q+3]=E,q+=u}else C(b.indices[l],v.data,v.size,g,q,n);break;case "symbolColor":C(b.indices[l],v.data,v.size,g,q,n);break;default:if(y=l===K.POSITION?c:l===K.NORMAL?d:void 0,void 0!==y&&3===v.size)for(l=b.indices[l],r=v.data,v=g,u=n,B=l.length,p=0;B>p;++p){var z=3*l[p],
D=r[z],E=r[z+1],z=r[z+2];v[q]=y[0]*D+y[4]*E+y[8]*z+y[12];v[q+1]=y[1]*D+y[5]*E+y[9]*z+y[13];v[q+2]=y[2]*D+y[6]*E+y[10]*z+y[14];q+=u}else t(b.indices[l],v.data,v.size,g,q,n)}}};p.triangleVertexArrayToWireframeLines=function(a,b,d,k){for(d=Math.floor(d/3)-1;0<=d;d--){var m=b+3*d*k,g=b+6*d*k+5*k;c(a,m,a,g,null,k);g-=k;c(a,m+k,a,g,null,k);g-=k;c(a,m+k,a,g,null,k);g-=k;c(a,m+2*k,a,g,null,k);g-=k;c(a,m+2*k,a,g,null,k);g-=k;c(a,m,a,g,null,k)}};p.intersectTriangleGeometry=function(a,b,c,m,l,g,e){d.assert("triangle"===
a.data.primitiveType);b=b.componentVisibilities;m=m.tolerance;var f=a.getBoundingInfo();if(1<a.getComponentCount()){if(c=y(l,g,M),k.setMin(G,f.getBBMin()),k.setMax(G,f.getBBMax()),B(G,l,c,m))for(var n=a.data,f=a.getComponentCount(),t=n.getIndices(K.POSITION),r=n.getAttribute(K.POSITION),n=n.componentOffsets,u=0;f>u;u++)if(h.getVisibility(b,u)){var C=a.getComponentAABB(u,G);B(C,l,c,m)&&v(l,g,n[u]/3,n[u+1]/3,t,r,void 0,e)}}else h.getVisibility(b,0)&&q(f,l,g,m,e)};var M=l.vec3d.create(),U=Math.pow(2,
-52),N=l.vec3d.create(),W=l.vec3d.create(),R=l.vec3d.create();p.transformToWorld=function(a,b,c){return l.vec4d.set4(a[0]-b[0],a[1]-b[1],a[2]-b[2],1,c)};p.transformToView=function(a,b,c,d){return l.mat4d.translate(c,b,J),c=J,l.mat4d.multiplyVec4(c,a,d)};p.transformToProjection=function(a,b,c,d){return d[0]=a[0]+c[0],d[1]=a[1]+c[1],d[2]=a[2]+c[2],d[3]=a[3],l.mat4d.multiplyVec4(b,d)};p.transformToNDC=function(a,b){return l.vec4d.scale(a,1/Math.abs(a[3]),b)};p.applyScreenSizePerspectiveScale=function(a,
b,c,d,k){return r.scale(a,d,c,k)};p.verticalOffsetAtDistance=function(a,b,c,k,m){var g=c.screenLength||0;m&&(g=r.scale(g,k,b,m));return d.clamp(g*Math.tan(.5*a.fovY)/(.5*a.fullHeight)*b,c.minWorldLength||0,null!=c.maxWorldLength?c.maxWorldLength:1/0)};p.basicMaterialConstructor=function(a,b){var c=!0,k=!1,m=0,g=p.__Material_idGen.gen(b);a.getId=function(){return g};var e;a.getParentStage=function(){return e};a.addParentStage=function(a){d.assert(void 0===e,"Material can only be added to a single Stage");
e=a};a.removeParentStage=function(a){e=void 0};a.setVisible=function(e){c!==e&&(c=e,a.notifyDirty("matChanged"))};a.isVisible=function(){return c};a.setRenderOccluded=function(e){k!==e&&(k=e,a.notifyDirty("matChanged"))};a.isRenderOccluded=function(){return k};a.notifyDirty=function(b){e&&e.notifyDirty(u.ContentType.MATERIAL,a,b)};a.setRenderPriority=function(a){m=a;this.notifyDirty("matChanged")};a.getRenderPriority=function(){return m}};p.aquireIfNotUndefined=D;p.releaseIfNotUndefined=b;var V=l.mat4.create();
p.bindView=function(a,b,c){l.mat4d.translate(b,a,V);c.setUniform3fv("localOrigin",a);c.setUniformMatrix4fv("view",V)};p.bindCamPos=function(a,b,c){c.setUniform3f("camPos",b[3]-a[0],b[7]-a[1],b[11]-a[2])};p.bindVerticalOffset=function(a,b,c){if(a){var d=b.fovY,k=b.viewport[3];b=void 0;a=(void 0===b&&(b=Q),b.screenLength=a.screenLength,b.perDistance=Math.tan(.5*d)/(.5*k),b.minWorldLength=a.minWorldLength,b.maxWorldLength=a.maxWorldLength,b);c.setUniform4f("verticalOffset",a.screenLength,a.perDistance,
a.minWorldLength,a.maxWorldLength)}};p.bindScreenSizePerspective=function(a,b,c){if(void 0===c&&(c="screenSizePerspectiveAlignment"),a){var d=a.parameters;b.setUniform4f(c,d.divisor,d.offset,d.minPixelSize,a.paddingPixelsOverride)}};p.basicGLMaterialConstructor=function(a,b){var c=p.__GLMaterial_id++;a.getId=function(){return c};a.getMaterialId=function(){return b.getId()};a.isVisible=function(){return b.isVisible()};a.isRenderOccluded=function(){return b.isRenderOccluded()};a.getRenderPriority=function(){return b.getRenderPriority()}};
p.singleTextureGLMaterialConstructor=function(a,c,d,k){var m=D(d.textureId,d.initTexture,c,k);a.updateTexture=function(a){d.textureId!==a&&(b(d.textureId,c),d.textureId=a,m=D(d.textureId,d.initTexture,c,k))};a.renderTexture=function(a){(a=c.getTexture(d.textureId))&&a.dirty&&a.redraw&&a.redraw()};a.bindTexture=function(a,e){void 0!==m&&(e.setUniform1i("tex",0),a.bindTexture(m.getGLTexture()))};a.bindTextureSize=function(a,e){void 0!==m&&(a=m.getGLTexture(),e.setUniform2f("texSize",a.descriptor.width,
a.descriptor.height))};a.dispose=function(){b(d.textureId,c)}};p.multiTextureGLMaterialConstructor=function(a,c,d,k){for(var m=k.length,g=Array(m),e=0;m>e;e++)g[e]=D(d[k[e][0]],d[k[e][1]],c);a.updateTextures=function(a){for(var e=0;m>e;e++){var f=d[k[e][0]],h=a[k[e][0]];f!==h&&(b(f,c),d[k[e][0]]=h,g[e]=D(h,d[k[e][1]],c))}};a.bindTextures=function(a,e){for(var b=0;m>b;b++)void 0!==g[b]&&(e.setUniform1i(k[b][2],b),a.bindTexture(g[b].getGLTexture(),b));a.setActiveTexture(0)};a.bindOneTexture=function(a,
e,b){e.setUniform1i(k[b][2],b);a.bindTexture(g[b].getGLTexture(),b);a.setActiveTexture(0)};a.disposeTextures=function(){for(var a=0;m>a;a++)b(d[k[a][0]],c)}};p.copyParameters=m;p.updateParameters=function(a,b){var c=!1,d;for(d in b){var k=b[d];void 0!==k&&(c=!0,Array.isArray(k)?a[d]=k.slice():a[d]=k)}return c};p.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var Q={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}})},"esri/views/3d/webgl-engine/parts/Model":function(){define("require exports dojo/string ../lib/ModelContentType ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util ../lib/gl-matrix".split(" "),
function(A,p,w,l,h,d,u,r){var a=u.assert,k=r.vec3d,c=r.mat4d,t=u.logWithBase;return function(){function r(){this.dirtySet=new h(this);this._uniqueIdx=0;this._id2origin={};this.content={};for(var a in l)this.content[l[a]]={}}return r.prototype.getAll=function(c){c=this.content[c];return a(void 0!==c),c},r.prototype.get=function(a,c){return this.getAll(a)[c]},r.prototype.add=function(c,d){var k=this.content[c];a(void 0!==k);var h=d.getId();a(null==k[h],"Model/Stage already contains object to be added");
k[h]=d;c===l.LAYER&&this.notifyDirty(c,d,"layerAdded")},r.prototype.remove=function(c,d){var k=this.content[c];a(void 0!==k);var h=k[d];return a(void 0!==h,"Model/Stage doesn't contain object to be removed"),delete k[d],c===l.TEXTURE&&h.unload(),c===l.LAYER&&this.notifyDirty(c,h,"layerRemoved"),h},r.prototype.getDirtySet=function(){return this.dirtySet},r.prototype.notifyDirty=function(a,c,d,k){this.dirtySet.handleUpdate(c,d,k)},r.prototype.getOrigin=function(a,c,d){void 0===d&&(d=10);var h=0;c=c*
d/1E4;1<c&&(h=Math.ceil(t(c,2)));c=1E4*Math.pow(2,h);d=Math.round(a[0]/c);var l=Math.round(a[1]/c);a=Math.round(a[2]/c);var h=h+"_"+d+"_"+l+"_"+a,b=this._id2origin[h];return null==b&&(b={vec3:k.createFrom(d*c,l*c,a*c),id:h},this._id2origin[h]=b),b},r.prototype.getGeometryRenderGeometries=function(a,k,h){var l=a.getId(),q=k.geometry,b=q.getData(),m=!!q.singleUse,t=k.materials,v=k.instanceParameters,r=a.getCombinedStaticTransformation(k),u=c.maxScale(r),y=k.origin,q=q.getBoundingInfo(),C=k.getId(),
p=this._uniqueIdx++;a=new d(b,q,t[0],r,k.customTransformation,u,a.getCastShadow(),m,l,C,p);a.origin=y||this.getOrigin(a.center,a.bsRadius);a.instanceParameters=v;h.push(a)},r.prototype.updateRenderGeometryTransformation=function(a,c,d){a.getCombinedStaticTransformation(c,d.transformation);d.updateTransformation(d.transformation)},r.prototype.formatDebugInfo=function(a){var c=[];if(a){c[0]="\x3ctable\x3e";for(var d in l)a=l[d],c[0]+="\x3ctr\x3e\x3ctd\x3e"+a+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+
Object.keys(this.getAll(a)).length+"\x3c/td\x3e\x3c/tr\x3e";c[0]+="\x3c/table\x3e";c[1]=this.dirtySet.formatDebugInfo(!0)}else{c[0]="";for(d in l)a=l[d],c[0]+=w.pad(String(Object.keys(this.getAll(a)).length),6," ")+" "+a+", ";c[1]=this.dirtySet.formatDebugInfo(!1)}return c},r.prototype.validateContent=function(){var a=this.getAll(l.OBJECT),c;for(c in a)this.validateObject(a[c]);var a=this.getAll(l.LAYER),d;for(d in a)this.validateLayer(a[d]);d=this.getAll(l.MATERIAL);for(var k in d)this.validateMaterial(d[k])},
r.prototype.validateObject=function(c){c=c.geometryRecords;for(var d=0;d<c.length;++d){var k=c[d];a(null!=this.get(l.GEOMETRY,k.geometry.id));a(1===k.materials.length,"object materials do not match geometry groups");a(null!=this.get(l.MATERIAL,k.materials[0].getId()))}},r.prototype.validateLayer=function(c){c=c.getObjects();for(var d=0;d<c.length;++d){var k=this.get(l.OBJECT,c[d].getId());a(null!=k)}},r.prototype.validateMaterial=function(c){c=c.getAllTextureIds();for(var d=0;d<c.length;++d){var k=
this.get(l.TEXTURE,c[d]);a(null!=k)}},r.ContentType=l,r}()})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define(["require","exports","./ModelContentType","./ModelDirtyTypesTs","./Util"],function(A,p,w,l,h){var d=h.objectEmpty,u=h.assert;return function(){function h(a){this._residentGeomRecords={};this._dirtyGeomRecords={};this._dirtyMaterials={};this._model=a}return Object.defineProperty(h.prototype,"residentLayerCount",{get:function(){return Object.keys(this._residentGeomRecords).length},
enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"residentObjectCount",{get:function(){var a=0,d;for(d in this._residentGeomRecords)a+=Object.keys(this._residentGeomRecords[d]).length;return a},enumerable:!0,configurable:!0}),h.prototype._getResidentGeometryRecords=function(){return this._residentGeomRecords},h.prototype._getDirtyGeometryRecords=function(){return this._dirtyGeomRecords},h.prototype.getDirtyMaterials=function(){return d(this._dirtyMaterials)?null:this._dirtyMaterials},
h.prototype.clearDirtyMaterials=function(){this._dirtyMaterials={}},h.prototype.hasDirtyGeometryRecords=function(){for(var a in this._dirtyGeomRecords)for(var k in this._dirtyGeomRecords[a]){var c=this._dirtyGeomRecords[a][k];if(c&&!d(c))return!0}return!1},h.prototype.handleUpdate=function(a,d,c){return u(this[d],"ModelDirtySet doesn't know how to process "+d),this[d](a,c)},h.prototype.shaderTransformationChanged=function(a){if(a=this._residentGeomRecords[a.getId()])for(var d in a){var c=this._model.content[w.OBJECT][d];
if(c&&c.hasVolativeTransformation()){var c=a[d],h;for(h in c)for(var l=0,q=c[h][1];l<q.length;l++)q[l].shaderTransformationChanged()}}},h.prototype.getAddRemoveUpdateList=function(a){return this.getAddRemoveUpdateListFilteredByLayers(Object.keys(this._dirtyGeomRecords),a)},h.prototype.getAddRemoveUpdateListFilteredByLayers=function(a,k){for(var c=[],h=[],l=[],q=0;q<a.length;q++){var v=a[q];if(v in this._dirtyGeomRecords){for(var r in this._dirtyGeomRecords[v]){var B=this._dirtyGeomRecords[v][r];if(B){var p=
this._createObjectRecordObjIfNonexistent(this._residentGeomRecords,v,r),b;for(b in B){var m=B[b],E=m[0],J=m[1],m=m[2],G=2&J&&1&m;if(4&J||G){var K=p[b];K?h.push.apply(h,K[1]):4===J&&u(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");k&&K&&delete p[b]}if(1&J||G){var K=[E,[]],M=this._model.get(w.OBJECT,r);this._model.getGeometryRenderGeometries(M,E,K[1]);c.push.apply(c,K[1]);k&&(p[b]=K)}if(2&J&&!G)if(K=p[b],M=this._model.get(w.OBJECT,r),K){J=K[1];G=J.length;if(16&m)for(K=0;G>K;K++){var U=
J[K];this._model.updateRenderGeometryTransformation(M,E,U)}for(K=0;G>K;K++)U=J[K],l.push({renderGeometry:U,updateType:m})}else u(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}d(p)&&delete this._residentGeomRecords[v][r]}}d(this._residentGeomRecords[v])&&delete this._residentGeomRecords[v]}k&&delete this._dirtyGeomRecords[v]}return[c,h,l]},h.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(Object.keys(this._residentGeomRecords))},
h.prototype.getResidentRenderGeometriesFilteredByLayers=function(a){for(var d=[],c=0;c<a.length;c++){var h=a[c];if(h in this._residentGeomRecords)for(var l in this._residentGeomRecords[h]){var q=this._residentGeomRecords[h][l];if(q)for(var v in q)d.push.apply(d,q[v][1])}}return d},h.prototype.componentVisibilityChanged=function(a,d,c){if(null!=d)this._componentPropertyChanged(a,d,c,2);else{d=0;for(var k=a.getGeometryRecords();d<k.length;d++)this._componentPropertyChanged(a,k[d],c,2)}},h.prototype.componentHighlightChanged=
function(a,d,c){if(null!=d)this._componentPropertyChanged(a,d,c,32);else{d=0;for(var k=a.getGeometryRecords();d<k.length;d++)this._componentPropertyChanged(a,k[d],c,32)}},h.prototype.vertexAttrsUpdated=function(a,d,c){this._updateOrCreateDirtyRecord(a,d,c,2,0,0,2,5,4)},h.prototype.colorAttrsUpdated=function(a,d,c){this._updateOrCreateDirtyRecord(a,d,c,2,0,0,2,5,8)},h.prototype.matChanged=function(a){this._dirtyMaterials[a.getId()]=!0},h.prototype.layerAdded=function(a){for(var d=a.getObjects(),c=
0;c<d.length;c++)this.layObjectAdded(a,d[c])},h.prototype.layerRemoved=function(a){for(var d=a.getObjects(),c=0;c<d.length;c++)this.layObjectRemoved(a,d[c])},h.prototype.layObjectAdded=function(a,d){a=a.getId();for(var c=d.getGeometryRecords(),k=0;k<c.length;k++)this.objGeometryAdded(d,c[k],a)},h.prototype.layObjectRemoved=function(a,d){a=a.getId();for(var c=d.getGeometryRecords(),k=0;k<c.length;k++)this.objGeometryRemoved(d,c[k],a)},h.prototype.layObjectReplaced=function(a,d){this.layObjectRemoved(a,
d[0]);this.layObjectAdded(a,d[1])},h.prototype.objDirty=function(a,d){d=d||this._getParentLayerId(a);var c=a.getId(),c=this._createObjectRecordObjIfNonexistent(this._residentGeomRecords,d,c),k;for(k in c)this._updateOrCreateDirtyRecord(a,c[k][0],d,2,0,2,0,5,1)},h.prototype.objTransformation=function(a,d){d=d||this._getParentLayerId(a);var c=a.getId(),c=this._createObjectRecordObjIfNonexistent(this._residentGeomRecords,d,c),k;for(k in c)this._updateOrCreateDirtyRecord(a,c[k][0],d,2,0,0,2,5,16)},h.prototype.objGeometryAdded=
function(a,d,c){this._updateOrCreateDirtyRecord(a,d,c,1,4,0,0,0)},h.prototype.objGeometryRemoved=function(a,d,c){this._updateOrCreateDirtyRecord(a,d,c,4,1,2,0,0)},h.prototype.objGeometryReplaced=function(a,d){this.objGeometryRemoved(a,d[0]);this.objGeometryAdded(a,d[1])},h.prototype.objGeometryTransformation=function(a,d){this.objGeometryReplaced(a,d)},h.prototype._componentPropertyChanged=function(a,d,c,h){this._updateOrCreateDirtyRecord(a,d,c,2,0,0,2,5,h)},h.prototype._updateOrCreateDirtyRecord=
function(a,d,c,h,l,q,v,r,B){c=c||this._getParentLayerId(a);var k=a.getId();a=d.getId();c=this._createObjectRecordObjIfNonexistent(this._dirtyGeomRecords,c,k);(k=c[a])?(d=k[1],d&l?delete c[a]:d&q?(k[1]=h,k[2]=B):d&v?k[2]|=B:d&r||u(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")):c[a]=[d,h,B]},h.prototype._createObjectRecordObjIfNonexistent=function(a,d,c){return a[d]||(a[d]={}),a[d][c]||(a[d][c]={}),a[d][c]},h.prototype._getParentLayerId=function(a){return a.parentLayer.id},h.prototype.formatDebugInfo=
function(a){var d=["ADD","UPD",void 0,"REM"];if(a)return"";a="";for(var c in this._dirtyGeomRecords)for(var h in this._dirtyGeomRecords[c]){var l=this._dirtyGeomRecords[c][h];if(l){0<a.length&&(a+="\n");a+=c+"."+h;var q=[],v;for(v in l){var r=l[v][1];q[r]||(q[r]=[]);q[r].push(l[v][0].geometry.id)}for(l=0;l<q.length;l++)if(q[l])for(a+=" "+d[l-1]+": ",r=0;r<q[l].length;r++)a+=q[l][r]+", "}}return a},h}()})},"esri/views/3d/webgl-engine/lib/ModelDirtyTypesTs":function(){define(["require","exports"],function(A,
p){Object.defineProperty(p,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define(["require","exports","./gl-matrix"],function(A,p,w){var l=w.vec3d,h=w.mat4d;return function(){function d(d,h,a,k,c,t,C,q,v,y,B){this.shaderTransformationDirty=!0;this.data=d.toRenderData();this.componentOffsets=d.componentOffsets;this.boundingInfo=h;this.material=a;this.origin=null;this.center=l.create();this.bsRadius=0;this.transformation=null;this.calculateShaderTransformation=
c;k&&this.updateTransformation(k,t);this.castShadow=C;this.singleUse=q;this.name=v;this.uniqueName=y;this.idx=B;this.canBeMerged=!0;this.instanceParameters={}}return d.prototype.updateTransformation=function(d,h){this.transformation=d;this.shaderTransformationDirty=!0;this.bsRadius=this.getBoundingSphere(d,h,this.center)},d.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0},d.prototype.getBoundingSphere=function(d,l,a){return l=l||h.maxScale(d),h.multiplyVec3(d,this.boundingInfo.getCenter(),
a),this.boundingInfo.getBSRadius()*l},Object.defineProperty(d.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0}),d.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=h.create()),h.set(this.calculateShaderTransformation(this.transformation),this.shaderTransformation),this.shaderTransformationDirty=!1),
this.shaderTransformation):this.transformation},d}()})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["require","exports","./Util"],function(A,p,w){function l(a){return Math.abs(a*a*a)}function h(a,d,k,h){void 0===h&&(h=c);var q=k.parameters;k=k.paddingPixelsOverride;return h.scale=Math.min(q.divisor/(d-q.offset),1),h.factor=l(a),h.minPixelSize=q.minPixelSize,h.paddingPixels=k,h}function d(a,c){return 0===a?c.minPixelSize:c.minPixelSize*(1+2*c.paddingPixels/a)}function u(a,
c){return Math.max(w.lerp(a*c.scale,a,c.factor),d(a,c))}function r(a,c,d){a=h(a,c,d);return a.minPixelSize=0,a.paddingPixels=0,u(1,a)}Object.defineProperty(p,"__esModule",{value:!0});p.getSettings=function(c){return new a(c,p.defaultDescription)};p.getLabelSettings=function(c){var d=p.defaultDescription.curvatureDependent;return new a(c,{curvatureDependent:{min:{curvature:d.min.curvature,tiltAngle:d.min.tiltAngle,scaleFallOffFactor:k.curvatureDependent.min.scaleFallOffFactor},max:{curvature:d.max.curvature,
tiltAngle:d.max.tiltAngle,scaleFallOffFactor:k.curvatureDependent.max.scaleFallOffFactor}},scaleStart:p.defaultDescription.scaleStart,scaleFallOffRange:p.defaultDescription.scaleFallOffRange,minPixelSize:k.minPixelSize})};p.perspectiveFactor=l;p.scaleFactor=h;p.applyScaleFactor=u;p.applyScaleFactorVec2=function(a,c,k){void 0===k&&(k=[0,0]);var h=Math.min(Math.max(c.scale,d(a[1],c)/a[1]),1);return k[0]=w.lerp(a[0]*h,a[0],c.factor),k[1]=w.lerp(a[1]*h,a[1],c.factor),k};p.precomputeScale=r;p.precomputeScaleFactor=
function(a,c,d,k){return k.scale=r(a,c,d),k.factor=0,k.minPixelSize=d.parameters.minPixelSize,k.paddingPixels=d.paddingPixelsOverride,k};p.applyPrecomputedScaleFactorVec2=function(a,c,k){void 0===k&&(k=[0,0]);c=Math.min(Math.max(c.scale,d(a[1],c)/a[1]),1);return k[0]=a[0]*c,k[1]=a[1]*c,k};p.scale=function(a,c,d,k){return u(a,h(c,d,k))};var a=function(){function a(a,c,d,k){void 0===d&&(d={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0});this.viewingMode=a;this.description=
c;this.parameters=d;this._paddingPixelsOverride=k;"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}return Object.defineProperty(a.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||
this.parameters.paddingPixels},enumerable:!0,configurable:!0}),a.prototype.update=function(a){return this.parameters&&this.parameters.camera.fovY===a.fovY&&this.parameters.camera.distance===a.distance?!1:(this.calculateParameters(a,this.parameters),!0)},a.prototype.overridePadding=function(c){return c!==this.paddingPixelsOverride?new a(this.viewingMode,this.description,this.parameters,c):this},a.prototype.calculateParameters=function(a,c){var d=this.description,k=d.scaleStart,b=d.scaleFallOffRange,
d=d.minPixelSize,m=a.fovY,h=a.distance,l=this.calculateCurvatureDependentParameters(a),q=this.coverageCompensation(a,l),t=l.tiltAngle,l=l.scaleFallOffFactor,h=Math.sin(t)*h,t=.5*Math.PI-t-m*(.5-k*q),k=h/Math.cos(t),b=(k-h/Math.cos(t+m*b*q)*l)/(1-l);return c.camera.fovY=a.fovY,c.camera.distance=a.distance,c.offset=b,c.divisor=k-b,c.minPixelSize=d,c},a.prototype.calculateCurvatureDependentParametersLocal=function(a,c){return void 0===c&&(c=t),c.tiltAngle=this.description.curvatureDependent.min.tiltAngle,
c.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,c},a.prototype.calculateCurvatureDependentParametersGlobal=function(a,c){void 0===c&&(c=t);var d=this.description.curvatureDependent;a=1+a.distance/C;var k=[d.min.curvature,d.max.curvature],b=k[0];a=w.clamp((Math.sqrt(a*a-1)-b)/(k[1]-b),0,1);k=[d.min,d.max];d=k[0];k=k[1];return c.tiltAngle=w.lerp(d.tiltAngle,k.tiltAngle,a),c.scaleFallOffFactor=w.lerp(d.scaleFallOffFactor,k.scaleFallOffFactor,a),c},a.prototype.surfaceCoverageCompensationLocal=
function(a,c){return(a.fovY-c.tiltAngle)/a.fovY},a.prototype.surfaceCoverageCompensationGlobal=function(a,c){var d=C*C;c=c.tiltAngle+.5*Math.PI;var k=a.fovY;a=a.distance;a=a*a+d-2*Math.cos(c)*a*C;var b=Math.sqrt(a);return(Math.acos(Math.sqrt(a-d)/b)-Math.asin(C/(b/Math.sin(c)))+.5*k)/k},a}();p.defaultDescription={curvatureDependent:{min:{curvature:w.deg2rad(10),tiltAngle:w.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:w.deg2rad(70),tiltAngle:w.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,
scaleFallOffRange:.65,minPixelSize:0};var k={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};p.copyParameters=function(a,c){return c.camera.distance=a.camera.distance,c.camera.fovY=a.camera.fovY,c.divisor=a.divisor,c.offset=a.offset,c.minPixelSize=a.minPixelSize,c};var c={scale:0,factor:0,minPixelSize:0,paddingPixels:0},t={tiltAngle:0,scaleFallOffFactor:0},C=6378137})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["require",
"exports"],function(A,p){Object.defineProperty(p,"__esModule",{value:!0});p.Default3D={position:0,normal:1,uv0:2,color:3,instanceColor:3,size:4,auxpos1:5,symbolColor:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12}})},"esri/views/webgl/enums":function(){define(["require","exports"],function(A,p){Object.defineProperty(p,"__esModule",{value:!0});p.BASE_TEXTURE_UNIT=33984})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define(["./GeometryData","./BufferVectorMath",
"./Util","./gl-matrix"],function(A,p,w,l){function h(a,c,k,h,l){return Math.abs(d.dot(c,a))>l?!1:(d.cross(a,c,k),d.normalize(k),d.cross(k,a,h),d.normalize(h),!0)}var d=l.vec3,u=l.vec4,r=l.vec3d,a=w.VertexAttrConstants,k=p.Vec3Compact,c=r.create(),t=r.create(),C={createSphereGeometry:function(c,k,h,l,t,b,m){c=c||50;l=void 0!==l?l:-Math.PI;t=void 0!==t?t:2*Math.PI;b=void 0!==b?b:.5*-Math.PI;m=void 0!==m?m:Math.PI;var q,v,r=Math.max(3,Math.floor(k)||8),u=Math.max(2,Math.floor(h)||6),y=(r+1)*(u+1);h=
new Float32Array(3*y);k=new Float32Array(3*y);var y=new Float32Array(2*y),B=[],C=d.create(),p=0;for(v=0;u>=v;v++){var D=[],V=v/u,Q=b+V*m,S=Math.cos(Q);for(q=0;r>=q;q++){var X=q/r,z=l+X*t,Z=Math.cos(z)*S*c,O=Math.sin(Q)*c,z=-Math.sin(z)*S*c;h[3*p]=Z;h[3*p+1]=O;h[3*p+2]=z;d.set3(Z,O,z,C);d.normalize(C);k[3*p]=C[0];k[3*p+1]=C[1];k[3*p+2]=C[2];y[2*p]=X;y[2*p+1]=V;D.push(p);++p}B.push(D)}c=new Uint32Array(2*r*(u-1)*3);for(v=p=0;u>v;v++)for(q=0;r>q;q++)l=B[v][q],t=B[v][q+1],b=B[v+1][q+1],m=B[v+1][q],0===
v?(c[p++]=l,c[p++]=b,c[p++]=m):v===u-1?(c[p++]=l,c[p++]=t,c[p++]=b):(c[p++]=l,c[p++]=t,c[p++]=b,c[p++]=b,c[p++]=m,c[p++]=l);w.assert(p===c.length);r={};r[a.POSITION]=c;r[a.NORMAL]=c;r[a.UV0]=c;u={};return u[a.POSITION]={size:3,data:h},u[a.NORMAL]={size:3,data:k},u[a.UV0]={size:2,data:y},new A(u,r)},createPolySphereGeometry:function(c,d,h){function l(a,d){a>d&&(a=d+(d=a,0));var h=a.toString()+"."+d.toString();if(m[h])return m[h];var l=b.length;return b.length+=3,k.add(b,3*a,b,3*d,b,l),k.scale(b,l,
c/k.length(b,l)),l/=3,m[h]=l,l}var q,b;h?(b=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],h=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]):(h=c*(1+Math.sqrt(5))/2,b=[-c,h,0,c,h,0,-c,-h,0,c,-h,0,0,-c,h,0,c,h,0,-c,-h,0,c,-h,h,0,-c,h,0,c,-h,0,-c,-h,0,c],h=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]);for(q=0;q<b.length;q+=3)k.scale(b,q,c/k.length(b,q));var m={};for(q=0;d>q;q++){for(var t=h.length,v=new Uint32Array(4*
t),r=0;t>r;r+=3){var u=h[r],y=h[r+1],C=h[r+2],p=l(u,y),w=l(y,C),R=l(C,u),V=4*r;v[V]=u;v[V+1]=p;v[V+2]=R;v[V+3]=y;v[V+4]=w;v[V+5]=p;v[V+6]=C;v[V+7]=R;v[V+8]=w;v[V+9]=p;v[V+10]=w;v[V+11]=R}h=v;m={}}d=new Float32Array(b);for(q=0;d>q;q+=3)k.normalize(d,q);b=new Float32Array(b);q={};q[a.POSITION]=h;q[a.NORMAL]=h;h={};return h[a.POSITION]={size:3,data:b},h[a.NORMAL]={size:3,data:d},new A(h,q)},createPointGeometry:function(c,d,k,h,l,b,m){var q=new Float32Array(3);q[0]=d?d[0]:0;q[1]=d?d[1]:0;q[2]=d?d[2]:
0;d=new Float32Array(3);if(d[0]=c?c[0]:0,d[1]=c?c[1]:0,d[2]=c?c[2]:1,null==b)c=new Float32Array(2),c[0]=0,c[1]=0;else{c=new Float32Array(b.length);for(var t=0;t<b.length;t++)c[t]=b[t]}b=new Uint8Array(4);b[0]=k?255*k[0]:255;b[1]=k?255*k[1]:255;b[2]=k?255*k[2]:255;b[3]=k&&3<k.length?255*k[3]:255;k=new Float32Array(2);if(k[0]=null!=h&&2==h.length?h[0]:1,k[1]=null!=h&&2==h.length?h[1]:1,null!=l){var v=new Float32Array(4);v[0]=l[0];v[1]=l[1];v[2]=l[2];v[3]=l[3]}if(null!=m){var r=new Float32Array(4);r[0]=
m[0];r[1]=m[1];r[2]=m[2];r[3]=m[3]}t=new Uint32Array(1);t[0]=0;h={};h[a.POSITION]=t;h[a.NORMAL]=t;h[a.UV0]=t;h[a.COLOR]=t;h[a.SIZE]=t;null!=l&&(h[a.AUXPOS1]=t);null!=m&&(h[a.AUXPOS2]=t);t={};return t[a.POSITION]={size:3,data:q},t[a.NORMAL]={size:3,data:d},t[a.UV0]={size:c.length,data:c},t[a.COLOR]={size:4,data:b},t[a.SIZE]={size:2,data:k},null!=l&&(t[a.AUXPOS1]={size:4,data:v}),null!=m&&(t[a.AUXPOS2]={size:4,data:r}),new A(t,h,A.DefaultOffsets,"point")},createPointArrayGeometry:function(c,d){for(var k=
new Float32Array(3*c.length),h=new Float32Array(d?3*c.length:3),l=new Uint32Array(c.length),b=new Uint32Array(c.length),m=0;m<c.length;m++)k[3*m]=c[m][0],k[3*m+1]=c[m][1],k[3*m+2]=c[m][2],d&&(h[3*m]=d[m][0],h[3*m+1]=d[m][1],h[3*m+2]=d[m][2]),l[m]=m,b[m]=0;d||(h[0]=0,h[1]=1,h[2]=0);c=new Float32Array(2);c[0]=0;c[1]=0;m={};m[a.POSITION]=l;m[a.NORMAL]=d?l:b;m[a.UV0]=b;d={};return d[a.POSITION]={size:3,data:k},d[a.NORMAL]={size:3,data:h},d[a.UV0]={size:2,data:c},new A(d,m,A.DefaultOffsets,"point")},createTriangleGeometry:function(){var c=
new Float32Array(9);c[0]=0;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=100;c[6]=100;c[7]=0;c[8]=0;var d=new Uint32Array(3);d[0]=0;d[1]=1;d[2]=2;var k=new Float32Array(3);k[0]=0;k[1]=1;k[2]=0;var h=new Uint32Array(3);h[0]=0;h[1]=0;h[2]=0;var l=new Float32Array(2);l[0]=0;l[1]=0;var b=new Uint32Array(3);b[0]=0;b[1]=0;b[2]=0;var m={};m[a.POSITION]=d;m[a.NORMAL]=h;m[a.UV0]=b;d={};return d[a.POSITION]={size:3,data:c},d[a.NORMAL]={size:3,data:k},d[a.UV0]={size:2,data:l},new A(d,m)},createSquareGeometry:function(c){var d,
k,h=new Float32Array(12);if(c)for(d=0;4>d;d++)for(k=0;3>k;k++)h[3*d+k]=c[d][k];else h[0]=-1,h[1]=-1,h[2]=0,h[3]=1,h[4]=-1,h[5]=0,h[6]=1,h[7]=1,h[8]=0,h[9]=-1,h[10]=1,h[11]=0;k=new Uint32Array(6);k[0]=0;k[1]=1;k[2]=2;k[3]=2;k[4]=3;k[5]=0;c=new Float32Array(3);c[0]=0;c[1]=0;c[2]=1;var l=new Uint32Array(6);for(d=0;6>d;d++)l[d]=0;d=new Float32Array(8);d[0]=0;d[1]=0;d[2]=1;d[3]=0;d[4]=1;d[5]=1;d[6]=0;d[7]=1;var b=new Uint8Array(4);b[0]=255;b[1]=255;b[2]=255;b[3]=255;var m={};m[a.POSITION]=k;m[a.NORMAL]=
l;m[a.UV0]=k;m[a.COLOR]=l;k={};return k[a.POSITION]={size:3,data:h},k[a.NORMAL]={size:3,data:c},k[a.UV0]={size:2,data:d},k[a.COLOR]={size:4,data:b},new A(k,m)},createBoxGeometry:function(){var c,d,k=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],h=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],l=[0,0,1,0,1,1,0,1],b=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],m=Array(36);for(c=0;6>c;c++)for(d=0;6>d;d++)m[6*c+d]=c;var t=
Array(36);for(c=0;6>c;c++)t[6*c+0]=0,t[6*c+1]=1,t[6*c+2]=2,t[6*c+3]=2,t[6*c+4]=3,t[6*c+5]=0;return function(c){var d;Array.isArray(c)||(c=[c,c,c]);var q=new Float32Array(24);for(d=0;8>d;d++)q[3*d]=k[d][0]*c[0],q[3*d+1]=k[d][1]*c[1],q[3*d+2]=k[d][2]*c[2];c={};c[a.POSITION]=new Uint32Array(b);c[a.NORMAL]=new Uint32Array(m);c[a.UV0]=new Uint32Array(t);d={};return d[a.POSITION]={size:3,data:q},d[a.NORMAL]={size:3,data:new Float32Array(h)},d[a.UV0]={size:2,data:new Float32Array(l)},new A(d,c)}}(),createDiamondGeometry:function(){var c=
[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],d=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],k=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],h=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];return function(l){var b;Array.isArray(l)||(l=[l,l,l]);var m=new Float32Array(18);for(b=0;6>b;b++)m[3*b]=c[b][0]*l[0],m[3*b+1]=c[b][1]*l[1],m[3*b+2]=c[b][2]*l[2];l={};l[a.POSITION]=new Uint32Array(k);l[a.NORMAL]=new Uint32Array(h);b={};return b[a.POSITION]={size:3,data:m},
b[a.NORMAL]={size:3,data:new Float32Array(d)},new A(b,l)}}(),createTetrahedronGeometry:function(){var c=d.createFrom(-.5,0,-.5),k=d.createFrom(.5,0,-.5),h=d.createFrom(0,0,.5),l=d.createFrom(0,.5,0),t=d.create(),b=d.create(),m=d.create(),r=d.create(),u=d.create();d.subtract(c,l,t);d.subtract(c,k,b);d.cross(t,b,m);d.normalize(m,m);d.subtract(k,l,t);d.subtract(k,h,b);d.cross(t,b,r);d.normalize(r,r);d.subtract(h,l,t);d.subtract(h,c,b);d.cross(t,b,u);d.normalize(u,u);var C=[c,k,h,l],p=[0,-1,0,m[0],m[1],
m[2],r[0],r[1],r[2],u[0],u[1],u[2]],w=[0,1,2,3,1,0,3,2,1,3,0,2],U=[0,0,0,1,1,1,2,2,2,3,3,3];return function(b){var c;Array.isArray(b)||(b=[b,b,b]);var d=new Float32Array(12);for(c=0;4>c;c++)d[3*c]=C[c][0]*b[0],d[3*c+1]=C[c][1]*b[1],d[3*c+2]=C[c][2]*b[2];b={};b[a.POSITION]=new Uint32Array(w);b[a.NORMAL]=new Uint32Array(U);c={};return c[a.POSITION]={size:3,data:d},c[a.NORMAL]={size:3,data:new Float32Array(p)},new A(c,b)}}(),createConeGeometry:function(c,k,h,l){var q=0,b=d.createFrom(0,q,0),m=d.createFrom(0,
q+c,0),t=d.createFrom(0,-1,0),r=d.createFrom(0,1,0);l&&(q=c,m=d.createFrom(0,0,0),b=d.createFrom(0,q,0),t=d.createFrom(0,1,0),r=d.createFrom(0,-1,0));var b=[m,b],t=[t,r],r=h+2,v=0,m=Math.sqrt(c*c+k*k);if(l)for(l=h-1;0<=l;l--)v=2*Math.PI/h*l,u=d.createFrom(Math.cos(v)*k,q,Math.sin(v)*k),b.push(u),v=d.createFrom(c*Math.cos(v)/m,-k/m,c*Math.sin(v)/m),t.push(v);else for(l=0;h>l;l++){var v=2*Math.PI/h*l,u=d.createFrom(Math.cos(v)*k,q,Math.sin(v)*k);b.push(u);v=d.createFrom(c*Math.cos(v)/m,k/m,c*Math.sin(v)/
m);t.push(v)}c=new Uint32Array(6*(h+2));h=new Uint32Array(6*(h+2));q=k=0;for(l=3;l<b.length;l++)c[k++]=1,c[k++]=l-1,c[k++]=l,h[q++]=0,h[q++]=0,h[q++]=0;c[k++]=b.length-1;c[k++]=2;c[k++]=1;h[q++]=0;h[q++]=0;h[q++]=0;for(l=3;l<b.length;l++)c[k++]=l,c[k++]=l-1,c[k++]=0,h[q++]=l,h[q++]=l-1,h[q++]=1;c[k++]=0;c[k++]=2;c[k++]=b.length-1;h[q++]=1;h[q++]=2;h[q++]=t.length-1;q=1;Array.isArray(q)||(q=[q,q,q]);k=new Float32Array(3*r);for(l=0;r>l;l++)k[3*l]=b[l][0]*q[0],k[3*l+1]=b[l][1]*q[1],k[3*l+2]=b[l][2]*
q[2];b=new Float32Array(3*r);for(l=0;r>l;l++)b[3*l]=t[l][0],b[3*l+1]=t[l][1],b[3*l+2]=t[l][2];t={};t[a.POSITION]=c;t[a.NORMAL]=h;r={};return r[a.POSITION]={size:3,data:k},r[a.NORMAL]={size:3,data:b},new A(r,t)},createCylinderGeometry:function(c,k,h,l,t,b){l||(l=d.createFrom(1,0,0));t||(t=d.createFrom(0,0,0));b=void 0===b?!0:b;var m=d.create();d.normalize(l,m);l=d.create();d.scale(m,Math.abs(c),l);var q=d.create();d.scale(l,-.5,q);d.add(q,t);var r=d.createFrom(0,1,0);Math.abs(.2>1-d.dot(m,r))&&d.set3(0,
0,1,r);var v=d.create();d.cross(m,r,v);d.normalize(v);d.cross(v,m,r);var u=2*h+(b?2:0),y=h+(b?2:0);t=new Float32Array(3*u);c=new Float32Array(3*y);var C=new Float32Array(2*u),B=new Uint32Array(3*h*(b?4:2)),p=new Uint32Array(3*h*(b?4:2));b&&(t[3*(u-2)+0]=q[0],t[3*(u-2)+1]=q[1],t[3*(u-2)+2]=q[2],C[2*(u-2)]=0,C[2*(u-2)+1]=0,t[3*(u-1)+0]=t[3*(u-2)+0]+l[0],t[3*(u-1)+1]=t[3*(u-2)+1]+l[1],t[3*(u-1)+2]=t[3*(u-2)+2]+l[2],C[2*(u-1)]=1,C[2*(u-1)+1]=1,c[3*(y-2)+0]=-m[0],c[3*(y-2)+1]=-m[1],c[3*(y-2)+2]=-m[2],
c[3*(y-1)+0]=m[0],c[3*(y-1)+1]=m[1],c[3*(y-1)+2]=m[2]);for(var D,w=function(a,b,c){B[a]=b;p[a]=c},Q=0,S=d.create(),X=d.create(),m=0;h>m;m++)D=2*Math.PI/h*m,d.scale(r,Math.sin(D),S),d.scale(v,Math.cos(D),X),d.add(S,X),c[3*m+0]=S[0],c[3*m+1]=S[1],c[3*m+2]=S[2],d.scale(S,k),d.add(S,q),t[3*m+0]=S[0],t[3*m+1]=S[1],t[3*m+2]=S[2],C[2*m+0]=m/h,C[2*m+1]=0,t[3*(m+h)+0]=t[3*m+0]+l[0],t[3*(m+h)+1]=t[3*m+1]+l[1],t[3*(m+h)+2]=t[3*m+2]+l[2],C[2*(m+h)+0]=m/h,C[2*m+1]=1,D=(m+1)%h,w(Q++,m,m),w(Q++,m+h,m),w(Q++,D,D),
w(Q++,D,D),w(Q++,m+h,m),w(Q++,D+h,D);if(b){for(m=0;h>m;m++)D=(m+1)%h,w(Q++,u-2,y-2),w(Q++,m,y-2),w(Q++,D,y-2);for(m=0;h>m;m++)D=(m+1)%h,w(Q++,m+h,y-1),w(Q++,u-1,y-1),w(Q++,D+h,y-1)}k={};k[a.POSITION]=B;k[a.NORMAL]=p;k[a.UV0]=B;h={};return h[a.POSITION]={size:3,data:t},h[a.NORMAL]={size:3,data:c},h[a.UV0]={size:2,data:C},new A(h,k)},createTubeGeometry:function(a,c,d,k,h){d=d||10;k=null!=k?k:!0;w.assert(1<a.length);for(var b=[],m=[],l=0;d>l;l++){b.push([0,-l-1,-((l+1)%d)-1]);var q=l/d*2*Math.PI;m.push([Math.cos(q)*
c,Math.sin(q)*c])}return C.createPathExtrusionGeometry(m,a,[[0,0,0]],b,k,h)},createPathExtrusionGeometry:function(c,k,l,t,C,b){var m,q=c.length,v=new Float32Array(k.length*q*3+(6*l.length||0)),y=new Float32Array(k.length*q+(2*l.length||0)),B=new Float32Array(k.length*q*3+(l?6:0)),p=0,D=0,N=0,W=(k.length-1)*q*6+6*t.length,R=new Uint32Array(W),W=new Uint32Array(W),V=0,Q=0,S=d.create(),X=d.create(),z=d.create(),Z=d.create(),O=(d.create(),d.create()),g=(d.create(),d.create(),d.create()),e=d.create(),
f=d.create(),n=d.create(),x=d.create(),I=(d.create(),d.create(),d.create()),L=d.create(),P=d.create(),Y=u.create();d.set3(0,1,0,n);d.subtract(k[1],k[0],X);d.normalize(X);C?(d.add(k[0],b,f),d.normalize(f,z)):d.set3(0,0,1,z);h(X,z,O,z,.99619469809)||h(X,n,O,z,.99619469809)||h(X,n,O,z,.99619469809);d.set(z,Z);d.set(O,L);for(m=0;m<l.length;m++)d.scale(O,l[m][0],g),d.scale(z,l[m][2],f),d.add(g,f),d.add(g,k[0]),v[p++]=g[0],v[p++]=g[1],v[p++]=g[2],y[N++]=0;B[D++]=-X[0];B[D++]=-X[1];B[D++]=-X[2];for(m=0;m<
t.length;m++)R[V++]=0<t[m][0]?t[m][0]:-t[m][0]-1+l.length,R[V++]=0<t[m][1]?t[m][1]:-t[m][1]-1+l.length,R[V++]=0<t[m][2]?t[m][2]:-t[m][2]-1+l.length,W[Q++]=0,W[Q++]=0,W[Q++]=0;var fa,ga=l.length;m=l.length-1;for(var ia=0;ia<k.length;ia++){if(fa=!1,0<ia){d.set(X,S);ia<k.length-1?(d.subtract(k[ia+1],k[ia],X),d.normalize(X)):fa=!0;d.add(S,X,x);d.normalize(x);d.add(k[ia-1],Z,I);Y[0]=x[0];Y[1]=x[1];Y[2]=x[2];Y[3]=-r.dot(x,k[ia]);if(w.rayPlane(I,S,Y,f))d.subtract(f,k[ia]),d.normalize(f,z),d.cross(x,z,O),
d.normalize(O);else{var na=x,ka=L,wa=n,ta=O,sa=z;h(na,Z,ta,sa,.99619469809)||h(na,ka,ta,sa,.99619469809)||h(na,wa,ta,sa,.99619469809)}d.set(z,Z);d.set(O,L)}C&&(d.add(k[ia],b,f),d.normalize(f,P));for(na=0;q>na;na++)if(d.scale(O,c[na][0],g),d.scale(z,c[na][1],f),d.add(g,f),d.normalize(g,e),B[D++]=e[0],B[D++]=e[1],B[D++]=e[2],C?y[N++]=d.dot(g,P):y[N++]=g[2],d.add(g,k[ia]),v[p++]=g[0],v[p++]=g[1],v[p++]=g[2],!fa)for(ka=(na+1)%q,R[V++]=ga+na,R[V++]=ga+q+na,R[V++]=ga+ka,R[V++]=ga+ka,R[V++]=ga+q+na,R[V++]=
ga+q+ka,ka=0;6>ka;ka++)W[Q++]=R[V-6+ka]-m;ga+=q}fa=k[k.length-1];for(m=0;m<l.length;m++)d.scale(O,l[m][0],g),d.scale(z,l[m][1],f),d.add(g,f),d.add(g,fa),v[p++]=g[0],v[p++]=g[1],v[p++]=g[2],y[N++]=0;c=D/3;B[D++]=X[0];B[D++]=X[1];B[D++]=X[2];q=ga-q;for(m=0;m<t.length;m++)R[V++]=0<=t[m][0]?ga+t[m][0]:-t[m][0]-1+q,R[V++]=0<=t[m][2]?ga+t[m][2]:-t[m][2]-1+q,R[V++]=0<=t[m][1]?ga+t[m][1]:-t[m][1]-1+q,W[Q++]=c,W[Q++]=c,W[Q++]=c;t={};t[a.POSITION]=R;t[a.NORMAL]=W;R={};return R[a.POSITION]={size:3,data:v},R.zOffset=
{size:1,data:y},R[a.NORMAL]={size:3,data:B},new A(R,t)},createPolylineGeometry:function(c,d){w.assert(1<c.length,"createPolylineGeometry(): polyline needs at least 2 points");w.assert(3===c[0].length,"createPolylineGeometry(): malformed vertex");w.assert(void 0===d||d.length===c.length,"createPolylineGeometry: need same number of points and normals");w.assert(void 0===d||3===d[0].length,"createPolylineGeometry(): malformed normal");for(var k=new Float32Array(3*c.length),h=new Uint32Array(2*(c.length-
1)),l=0,b=0,m=0;m<c.length;m++){for(var q=0;3>q;q++)k[l++]=c[m][q];0<m&&(h[b++]=m-1,h[b++]=m)}l={};b={};if(l[a.POSITION]=h,b[a.POSITION]={size:3,data:k},d){for(var k=new Float32Array(3*d.length),t=0,m=0;m<c.length;m++)for(q=0;3>q;q++)k[t++]=d[m][q];l[a.NORMAL]=h;b[a.NORMAL]={size:3,data:k}}return new A(b,l,A.DefaultOffsets,"line")},addVertexColors:function(c,d){var k,h=d||[1,1,1,1];d=new Uint8Array(4);d[0]=255*h[0];d[1]=255*h[1];d[2]=255*h[2];d[3]=255*(3<h.length?h[3]:1);var h={},l=c.getVertexAttr();
for(k in l)h[k]=l[k];h[a.COLOR]={size:4,data:d};d={};for(k in c.indices)d[k]=c.indices[k];return d[a.COLOR]=new Uint32Array(d[a.POSITION].length),c=new A(h,d,c.componentOffsets,c.primitiveType)},addNormals:function(a){var d=a.getVertexAttr();a=a.indices;for(var k=p.Vec3Compact.subtract,h=new Float32Array(a.position.length/3*3),l=d.position.data,b=0,m=a.position,q=new Uint32Array(m.length),u=0;u<m.length;u+=3){k(l,3*m[u],l,3*m[u+2],t,0);k(l,3*m[u],l,3*m[u+1],c,0);r.cross(c,t);r.normalize(c);var C=
b/3;h[b++]=c[0];h[b++]=c[1];h[b++]=c[2];q[u]=C;q[u+1]=C;q[u+2]=C}d.normal={size:3,data:h};a.normal=q},cgToGIS:function(a){var c,d;c=a.getVertexAttr();a=c.position.data;var k=c.normal.data;if(k)for(c=0;c<k.length;c+=3)d=k[c+1],k[c+1]=-k[c+2],k[c+2]=d;if(a)for(c=0;c<a.length;c+=3)d=a[c+1],a[c+1]=-a[c+2],a[c+2]=d}};return C})},"esri/views/3d/webgl-engine/lib/GeometryData":function(){define(["require","exports","./ComponentUtils","./geometryDataUtils","./Util"],function(A,p,w,l,h){return function(){function d(u,
r,a,k){void 0===r&&(r=d.DefaultIndices);void 0===a&&(a=d.DefaultOffsets);void 0===k&&(k="triangle");this.preinterleaved=!1;var c={},t;for(t in u){var C=u[t],q=C.size;c[t]={data:C.data,size:q,offsetIdx:0,strideIdx:q}}if(r===d.DefaultIndices){r=h.getFirstObjectValue(c);u=l.generateDefaultIndexArray(r.data.length/r.size);r={};for(var v in c)r[v]=u}this._id=l.getNewId();this._vertexAttributes=c;this._indices=r;this._componentOffsets=w.createOffsets(a);this._primitiveType=k}return Object.defineProperty(d.prototype,
"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"indexCount",{get:function(){return h.getFirstObjectValue(this._indices).length},
enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0}),d.prototype.getId=function(){return this.id},d.prototype.getVertexAttr=function(){return this.vertexAttributes},d.prototype.toRenderData=function(){return{id:this._id.toString(),preinterleaved:!1,indices:this._indices,vertexAttr:this._vertexAttributes}},d.prototype.getIndices=function(d){return this._indices[d]},d.prototype.getAttribute=function(d){return this._vertexAttributes[d]},
d.prototype.estimateGpuMemoryUsage=function(){var d=0;this._indices.position&&(d+=12*this._indices.position.length);this._indices.normal&&(d+=12*this._indices.normal.length);this._indices.uv0&&(d+=8*this._indices.uv0.length);this._indices.color&&(d+=4*this._indices.color.length);return this._indices.terrain&&(d+=2*this._indices.terrain.length,d+=4*this._vertexAttributes.terrain.data.length),d},d.DefaultIndices={},d.DefaultOffsets=new Uint32Array(0),d}()})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["require",
"exports"],function(A,p){Object.defineProperty(p,"__esModule",{value:!0});var w=1,l=null;p.generateDefaultIndexArray=function(d){if(d>w||null==l){for(;d>w;)w*=2;l=new Uint32Array(w);for(var h=0;w>h;h++)l[h]=h}return new Uint32Array(l.buffer,0,d)};var h=0;p.getNewId=function(){return h++}})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("require exports ./IdGen ./Util ./DDSUtil ./gl-matrix ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/enums ./DefaultVertexBufferLayouts ./DefaultVertexAttributeLocations".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q){function v(a,b,c,d,k,h,q){q=!1!==q;var m=new Image;m.onerror=function(){h(null);m.onerror=void 0;m.onload=void 0};m.onload=function(){l.assert(1<=m.width&&1<=m.height);c.samplingMode=q?9987:9729;c.hasMipmap=q;if(!q&&33071===c.wrapMode||l.isPowerOfTwo(m.width)&&l.isPowerOfTwo(m.height)){c.width=m.width;c.height=m.height;var b=new r(a,c,m)}else b=y(a,m,c,d,k);a.bindTexture(b);h(b);m.onerror=void 0;m.onload=void 0};m.src=b}function y(d,b,m,h,t){var v=l.nextHighestPowerOfTwo(b.width),
y=l.nextHighestPowerOfTwo(b.height);l.assert(v!==b.width||y!==b.height);m.width=v;m.height=y;var p=new r(d,m),D=u.createWithAttachments(d,p,{colorTarget:0,depthStencilTarget:0});b=new r(d,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!!m.flipped,maxAnisotropy:8,preMultiplyAlpha:m.preMultiplyAlpha},b);if(d.bindFramebuffer(D),void 0===t)t=d.getViewport(),t=[t.x,t.y,t.width,t.height];d.setViewport(0,0,v,y);h=h.get("texOnly");v=B.identity();d.bindProgram(h);h.setUniformMatrix4fv("model",
v);h.setUniformMatrix4fv("view",v);h.setUniformMatrix4fv("proj",v);h.setUniform4f("color",1,1,1,1);h.setUniform1i("tex",0);h=new k(d,q.Default3D,{geometry:C.Pos3Tex},{geometry:c.createVertex(d,35044,l.createQuadVertexUvBuffer())});return d.bindTexture(b,0),d.bindVAO(h),d.setDepthTestEnabled(!1),d.setBlendingEnabled(!1),d.drawArrays(5,0,a.vertexCount(h,"geometry")),d.setDepthTestEnabled(!0),d.bindFramebuffer(null),d.setViewport(t[0],t[1],t[2],t[3]),h.dispose(!0),b.dispose(),d.bindFramebuffer(null),
D.detachColorTexture(),D.dispose(),m.hasMipmap&&p.generateMipmap(),p}var B=d.mat4d;return function(){function a(b,c,d){this.data=b;this.id=a.idGen.gen(c);this.unloadFunc=void 0;this.params=d||{};this.params.wrapClamp=this.params.wrapClamp||!1;this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=this.params.noUnpackFlip||!1;this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1;this.estimatedTexMemRequiredMB=a.estimateTexMemRequiredMB(this.data,this.params)}return a.estimateTexMemRequiredMB=
function(a,c){return null==a?0:a instanceof ArrayBuffer||a instanceof Uint8Array?a.byteLength/1E6:a instanceof Image||a instanceof ImageData||a instanceof HTMLCanvasElement?(c.mipmap?4/3:1)*a.width*a.height*4/1E6:(c.mipmap?4/3:1)*c.width*c.height*4/1E6||0},a.prototype.getId=function(){return this.id},a.prototype.getEstimatedTexMemRequiredMB=function(){return this.estimatedTexMemRequiredMB},a.prototype.dispose=function(){this.data=void 0},a.prototype.deferredLoading=function(){return"string"==typeof this.data},
a.prototype.getWidth=function(){return this.params.width},a.prototype.getHeight=function(){return this.params.height},a.prototype.initializeThroughUpload=function(b,c,d,k,q){var m=this.data;if(c.flipped=!this.params.noUnpackFlip,c.samplingMode=this.params.mipmap?9987:9729,c.hasMipmap=this.params.mipmap,c.wrapMode=this.params.wrapClamp?33071:10497,c.preMultiplyAlpha=this.params.preMultiplyAlpha,"string"==typeof m)v(b,m,c,d,k,q,this.params.mipmap);else{if(m instanceof Image||m instanceof ImageData||
m instanceof HTMLCanvasElement)this.params.width=m.width,this.params.height=m.height,!this.params.mipmap&&this.params.wrapClamp||l.isPowerOfTwo(m.width)&&l.isPowerOfTwo(m.height)?(c.width=m.width,c.height=m.height,c=new r(b,c,m)):c=y(b,m,c,d,k);else if(m instanceof ArrayBuffer&&this.params.encoding===a.DDS_ENCODING)c=h.createDDSTexture(b,c,m,this.params.mipmap);else if(m instanceof Uint8Array&&this.params.encoding===a.DDS_ENCODING)c=h.createDDSTexture(b,c,m.buffer,this.params.mipmap);else if(m instanceof
Uint8Array)l.assert(0<this.params.width&&0<this.params.height),c.pixelFormat=1===this.params.components?6409:6408,c.width=this.params.width,c.height=this.params.height,c=new r(b,c,m);else{if(null!==m)throw console.warn("Unsupported image data"),Error("Unsupported image data");c=new r(b,c,null)}b.bindTexture(c);q(c)}this.data=void 0},a.prototype.setUnloadFunc=function(a){this.unloadFunc=a},a.prototype.unload=function(){void 0!==this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)},a.idGen=
new w,a.DDS_ENCODING="image/vnd-ms.dds",a}()})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["require","exports","../../../webgl/Texture","../../../webgl/enums"],function(A,p,w,l){function h(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}Object.defineProperty(p,"__esModule",{value:!0});var d=h("DXT1"),u=h("DXT3"),r=h("DXT5");p.createDDSTexture=function(a,k,c,h){var l=new Int32Array(c,0,31);if(542327876!==l[0])return console.error("Invalid magic number in DDS header"),
null;if(!(l[20]&4))return console.error("Unsupported format, must contain a FourCC code"),null;var q,t;q=l[21];switch(q){case d:q=8;t=33776;break;case u:q=16;t=33778;break;case r:q=16;t=33779;break;default:return console.error("Unsupported FourCC code:",String.fromCharCode(255&q,q>>8&255,q>>16&255,q>>24&255)),null}var y=1;l[2]&131072&&!1!==h&&(y=Math.max(1,l[7]));var p,D;h=l[4];var b=l[3],m=l[1]+4;k.samplingMode=1<y?9987:9729;k.hasMipmap=1<y;k.width=l[4];k.height=l[3];k=new w(a,k);a.bindTexture(k);
for(l=0;y>l&&(D=Math.floor((h+3)/4)*Math.floor((b+3)/4)*q,p=new Uint8Array(c,m,D)),a.gl.compressedTexImage2D(a.gl.TEXTURE_2D,l,t,h,b,0,p),m+=D,(1!==h||1!==b)&&1!==y;++l)h=Math.max(1,h>>1),b=Math.max(1,b>>1);return k}})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["require","exports"],function(A,p){Object.defineProperty(p,"__esModule",{value:!0});p.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}];p.Pos3Tex=[{name:"position",count:3,type:5126,
offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}];p.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];p.Pos3TexCol=[{name:"position",count:3,type:5126,offset:0,stride:24,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:24,normalized:!1},{name:"color",count:4,type:5121,offset:20,stride:24,normalized:!1}];p.Pos3TexRegion=[{name:"position",count:3,
type:5126,offset:0,stride:28,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:28,normalized:!1},{name:"region",count:4,type:5123,offset:20,stride:28,normalized:!1}];p.Pos3TexRegionCol=[{name:"position",count:3,type:5126,offset:0,stride:44,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:44,normalized:!1},{name:"region",count:4,type:5123,offset:32,stride:44,normalized:!1},{name:"color",count:4,type:5121,offset:40,stride:44,normalized:!1}];p.Pos3Norm=[{name:"position",count:3,
type:5126,offset:0,stride:24,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:24,normalized:!1}];p.Pos3NormTex=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:32,normalized:!1}];p.Pos3NormCol=[{name:"position",count:3,type:5126,offset:0,stride:28,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:28,normalized:!1},{name:"color",count:4,
type:5121,offset:24,stride:28,normalized:!1}];p.Pos3NormTexCol=[{name:"position",count:3,type:5126,offset:0,stride:36,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:36,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:36,normalized:!1},{name:"color",count:4,type:5121,offset:32,stride:36,normalized:!1}];p.Pos3NormTexRegion=[{name:"position",count:3,type:5126,offset:0,stride:40,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:40,normalized:!1},{name:"uv0",
count:2,type:5126,offset:24,stride:40,normalized:!1},{name:"region",count:4,type:5123,offset:32,stride:40,normalized:!1}];p.Pos3NormTexRegionCol=[{name:"position",count:3,type:5126,offset:0,stride:44,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:44,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:44,normalized:!1},{name:"region",count:4,type:5123,offset:32,stride:44,normalized:!1},{name:"color",count:4,type:5121,offset:40,stride:44,normalized:!1}];p.Pos3NormSymcol=
[{name:"position",count:3,type:5126,offset:0,stride:28,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:28,normalized:!1},{name:"symbolColor",count:4,type:5121,offset:24,stride:28,normalized:!1}];p.Pos3NormTexSymcol=[{name:"position",count:3,type:5126,offset:0,stride:36,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:36,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:36,normalized:!1},{name:"symbolColor",count:4,type:5121,offset:32,stride:36,normalized:!1}];
p.Pos3NormColSymcol=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"color",count:4,type:5121,offset:24,stride:32,normalized:!1},{name:"symbolColor",count:4,type:5121,offset:28,stride:32,normalized:!1}];p.Pos3NormTexColSymcol=[{name:"position",count:3,type:5126,offset:0,stride:40,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:40,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:40,
normalized:!1},{name:"color",count:4,type:5121,offset:32,stride:40,normalized:!1},{name:"symbolColor",count:4,type:5121,offset:36,stride:40,normalized:!1}];p.Pos3NormTexRegionSymcol=[{name:"position",count:3,type:5126,offset:0,stride:44,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:44,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:44,normalized:!1},{name:"region",count:4,type:5123,offset:32,stride:44,normalized:!1},{name:"symbolColor",count:4,type:5121,offset:40,
stride:44,normalized:!1}];p.Pos3NormTexRegionColSymcol=[{name:"position",count:3,type:5126,offset:0,stride:48,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:48,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:48,normalized:!1},{name:"region",count:4,type:5123,offset:32,stride:48,normalized:!1},{name:"color",count:4,type:5121,offset:40,stride:48,normalized:!1},{name:"symbolColor",count:4,type:5121,offset:44,stride:48,normalized:!1}];p.Pos2=[{name:"position",count:2,type:5126,
offset:0,stride:8,normalized:!1}];p.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}];p.Model=[{name:"model",count:16,type:5126,offset:0,stride:128,normalized:!1,divisor:1},{name:"modelNormal",count:16,type:5126,offset:64,stride:128,normalized:!1,divisor:1}];p.ModelCol=[{name:"model",count:16,type:5126,offset:0,stride:144,normalized:!1,divisor:1},{name:"modelNormal",count:16,type:5126,offset:64,stride:144,
normalized:!1,divisor:1},{name:"instanceColor",count:4,type:5126,offset:128,stride:144,normalized:!1,divisor:1}]})},"esri/views/3d/webgl-engine/lib/GLTextureRep":function(){define("require exports ./Util ../../../../core/Logger ../../../webgl/Texture ../../../webgl/enums".split(" "),function(A,p,w,l,h,d){var u=l.getLogger("esri.views.3d.webgl-engine.lib.GLTextureRep"),r=function(){function a(a){this._glTexture=null;this._refCount=0;this._glTexture=a}return a.prototype.incRefCnt=function(){++this._refCount},
a.prototype.decRefCnt=function(){--this._refCount;w.assert(0<=this._refCount)},a.prototype.getRefCnt=function(){return this._refCount},a.prototype.setGLTexture=function(a){this._glTexture=a},a.prototype.getGLTexture=function(){return this._glTexture},a}();return function(){function a(a,c,d,h){this.NUM_PARALLEL=8;this.textures=a;this._programRepository=c;this.getViewportToRestore=d;this._rctx=h;this.NUM_PARALLEL=8;this.id2textureRef={};this.loading={};this._queue=[];this.listeners=[];this.maxMaxAnisotropy=
(this.afExt=h.extensions.textureFilterAnisotropic)?h.parameters.maxMaxAnisotropy:1;this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy);this._needsRender=!0;this._fallbackTextureData=new Uint8Array(256);this._fallbackTextureTransparentData=new Uint8Array(256);for(a=0;a<this._fallbackTextureData.length;++a)this._fallbackTextureData[a]=255,this._fallbackTextureTransparentData[a]=0!==(a+1)%4?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,
maxAnisotropy:8}}return a.prototype.resetNeedsRender=function(){this._needsRender=!1},a.prototype.needsRender=function(){return this._needsRender},a.prototype.aquire=function(a,c,d,l){var k=this,t=this.id2textureRef[a];if(null==t){c=this.textures[a];w.assert(void 0!==c);c.setUnloadFunc(this._unload.bind(this));d=!0===d;var y=this._createGLTextureDescription(c);if(t=new r(null),w.assert(null==this.id2textureRef[a]),this.id2textureRef[a]=t,c.initializeThroughRender)a=c.initializeThroughRender(this._rctx,
y),t.setGLTexture(a),l&&l(t);else if(c.deferredLoading())this.getLoadingCount()<this.NUM_PARALLEL?this._loadImage(a,y,l):this._queue.push([a,y,l]);else try{c.initializeThroughUpload(this._rctx,y,this._programRepository,this.getViewportToRestore(),function(a){t.setGLTexture(a);k._needsRender=!0;l&&l(t)})}catch(B){u.error("#aquire","Error loading texture: "+B.toString())}null==t.getGLTexture()&&t.setGLTexture(d?new h(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData):new h(this._rctx,
this._fallbackTextureDesc,this._fallbackTextureData));this._needsRender=!0}return t.incRefCnt(),t},a.prototype.release=function(a){a=this.id2textureRef[a];void 0!==a&&(a.decRefCnt(),w.assert(0<=a.getRefCnt()))},a.prototype.getLoadingCount=function(){return Object.keys(this.loading).length},a.prototype.getIsLoaded=function(a){if(null==this.id2textureRef[a]||void 0!==this.loading[a])return!1;for(var c=0;c<this._queue.length;++c)if(this._queue[c][0]===a)return!1;return!0},a.prototype.addTextureListener=
function(a){w.assert(-1===this.listeners.indexOf(a));this.listeners.push(a)},a.prototype.removeTextureListener=function(a){a=this.listeners.indexOf(a);w.assert(-1!==a);this.listeners.splice(a,1)},a.prototype.getTexture=function(a){return this.textures[a]},a.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy},a.prototype._unload=function(a){var c=this.id2textureRef[a];void 0!==c&&(c.getGLTexture().dispose(),delete this.id2textureRef[a]);this.next(a)},a.prototype._createGLTextureDescription=
function(a){return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&a.params&&a.params.mipmap&&!a.params.disableAnisotropy?this.maxAnisotropy:void 0,wrapMode:a.params&&a.params.wrapClamp?33071:void 0}},a.prototype.next=function(a){if(a in this.loading){delete this.loading[a];var c=Object.keys(this.id2textureRef),d=Object.keys(this.loading);this.listeners.forEach(function(k){k(a,c,d)});this.processQueue()}},a.prototype._loadImage=function(a,c,d){var k=this;w.assert(null==this.loading[a]);
this.loading[a]=!0;var h=this.textures[a];w.assert(void 0!==h);setTimeout(function(){var l=k.id2textureRef[a];l&&l.getRefCnt()&&h.initializeThroughUpload(k._rctx,c,k._programRepository,k.getViewportToRestore(),function(c){k.next(a);k._needsRender=!0;l&&l.getRefCnt()&&(l.setGLTexture(c),d&&d(l))})},0)},a.prototype.processQueue=function(){for(var a=[],c=0;c<this._queue.length;++c){var d=this._queue[c][0],h=this.id2textureRef[d];void 0!==h&&(0===h.getRefCnt()?(h.getGLTexture().dispose(),delete this.id2textureRef[d]):
a.push(this._queue[c]))}this._queue=a;a=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,this._queue.length);for(c=0;a>c;++c)this._loadImage(this._queue[c][0],this._queue[c][1],this._queue[c][2]);this._queue.splice(0,a)},a}()})},"esri/views/3d/webgl-engine/lib/RenderPass":function(){define(["require","exports"],function(A,p){var w;A=w||(w={});A[A.MATERIAL=0]="MATERIAL";A[A.MATERIAL_DEPTH=1]="MATERIAL_DEPTH";A[A.MATERIAL_NORMAL=2]="MATERIAL_NORMAL";A[A.MATERIAL_DEPTH_SHADOWMAP=3]="MATERIAL_DEPTH_SHADOWMAP";
A[A.MATERIAL_HIGHLIGHT=4]="MATERIAL_HIGHLIGHT";A[A.MAX_PASS=5]="MAX_PASS";return w})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["require","exports"],function(A,p){var w;A=w||(w={});A[A.BACKGROUND=0]="BACKGROUND";A[A.INTERNAL_MATERIAL=1]="INTERNAL_MATERIAL";A[A.STENCIL_MATERIAL=2]="STENCIL_MATERIAL";A[A.OPAQUE_TERRAIN=3]="OPAQUE_TERRAIN";A[A.OPAQUE_MATERIAL=4]="OPAQUE_MATERIAL";A[A.OPAQUE_EXTERNAL=5]="OPAQUE_EXTERNAL";A[A.TRANSPARENT_MATERIAL=6]="TRANSPARENT_MATERIAL";A[A.TRANSPARENT_EXTERNAL=
7]="TRANSPARENT_EXTERNAL";A[A.TRANSPARENT_TERRAIN=8]="TRANSPARENT_TERRAIN";A[A.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS";A[A.POSTPROCESSING_HIGHLIGHT=10]="POSTPROCESSING_HIGHLIGHT";A[A.POSTPROCESSING_ATMOSPHERE=11]="POSTPROCESSING_ATMOSPHERE";A[A.POSTPROCESSING_EXTERNAL=12]="POSTPROCESSING_EXTERNAL";A[A.HUDMATERIAL1=13]="HUDMATERIAL1";A[A.HUDMATERIAL2=14]="HUDMATERIAL2";A[A.LINE_CALLOUTS=15]="LINE_CALLOUTS";A[A.LINE_CALLOUTS_HUD_DEPTH=16]="LINE_CALLOUTS_HUD_DEPTH";A[A.MAX_SLOTS=17]="MAX_SLOTS";return w})},
"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define([],function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAAB3RJTUUH4QkLDx4bnqU2+QAAAd1JREFUSMd9lkmWxDAIQ/Xluv+V0wuDjaeuhV+IGQUoJUnNwGfAVvx+lsBCWJIsCaMpQn8nuhgqyyEzbAX1Ih0oHaQZN5X5jul581diaDVbSgAdZv1YLoCLyn/RruCsOdcqR7RS/jXkLMa9UddcDn9O7G8gwprzs6xbQl/Fns3BE90r9veQ/wzNrTM5p1yDF1yokLCosDX5kik1lxeSWxfWsihN/lZcHuPIOuhccZ4Ovt74qQK3USkFzsQx7Ki5NgqoMI1J5ILztr9UrGoGHN2qnSEwOHiD97ByDghs/KIVYp9DfdIIoJPcBkWWnM2O2s5ru3su+8GdPLhM5048r/09UDsZmJ3HRwe5MT/aA9Ul4cG74+lIvICYlZcFY42B6vAzuz/HEVn5VbP3DDgQ7xuAGZtnI76cEkbPczDDgSMDR8iFkfBMTQV728mnsx84GopNWZxQsWJxbI9pD0hmNAzWB8bun41hRk+3mNlRFvbY86mcMEVCWWAX+xJbERJHWVPP3Wkq91uyDtuKDLrYNKLl7bww6rZulo3jnafyePJ64ZZi67aEl0MkbJtTbE1h+2vIzVOU3JwWISrNyNtfi+9xqECIXZk87ODcEMeBhjj41GN1Xf+DzP9c9UmPd39C1BID2rDpAwAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/environment/RealisticAtmosphere":function(){define("dojo/text!./materials/RealisticAtmosphereMaterial.xml ../../../core/watchUtils ../../../core/HandleRegistry ../support/ExternalRenderer ../lib/glMatrix ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/OffscreenRenderingHelper ../support/earthUtils ../../webgl/Program ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/DefaultVertexAttributeLocations".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q){var v=c.earthRadius,y=h.vec3d,B=h.vec2d,D=h.vec4d;h=.02*Math.PI;c=.004*Math.PI;var b=y.createFrom(1/Math.pow(.65,4),1/Math.pow(.57,4),1/Math.pow(.475,4)),m=y.create(b);y.scale(m,h);y.add(m,y.createFrom(c,c,c));var E=(1- -.99999*-.99999)/(2+-.99999*-.99999)*1.5;l=l.createSubclass({declaredClass:"esri.views.3d.environment.RealisticAtmosphere",properties:{view:{},planar:{value:!1,set:function(a){a=!!a;a!==this.planar&&this._update();this._set("planar",a)}},needsRender:{value:!1}},
constructor:function(){this._handles=new w;this._lowerElevationBoundRadius=0;this._earthRadius=v;this._renderer=this._skyPlanarProgram=this._skyProgram=this._hazePlanarProgram=this._hazeProgram=null;this._renderData={texDepth:B.create(),v3CameraPos:y.create(),v3CameraUp:y.create(),v3CameraRight:y.create(),v3CameraDir:y.create(),halfSizeNearPlane:B.create(),v2CameraCenterOffset:B.create(),v4SphereComp:D.create(),v4AtmosParams1:D.create(),v4AtmosParams2:D.create(),v4AtmosParams3:D.create(),v3InvWavelength:b,
v3InvWavelengthScaled:m,v4Radii:D.create(),fScale:0,fScaleDepth:.25,fLowerAlphaBlendBound:0,fScaleOverScaleDepth:0,fOneOverScaleDepth:0,fScaleDepthBlue:.05,fOneOverScaleDepthBlue:20,fScaleOverScaleDepthBlue:0,g:-.99999,g2:-.99999*-.99999,fMiePhaseCoefficients:E,showTest:0,nearFar:B.create()};this._updateRadius(v);this._hazeSlot=a.POSTPROCESSING_ATMOSPHERE;this._skySlot=a.BACKGROUND},destroy:function(){this._handles&&(this._handles.destroy(),this._handles=null);this._hazeProgram&&(this._hazeProgram.dispose(),
this._hazeProgram=null);this._hazePlanarProgram&&(this._hazePlanarProgram.dispose(),this._hazePlanarProgram=null);this._skyProgram&&(this._skyProgram.dispose(),this._skyProgram=null);this._skyPlanarProgram&&(this._skyPlanarProgram.dispose(),this._skyPlanarProgram=null)},setup:function(a){var b=u.createSquareGeometry().toRenderData(),c=this.renderContext.rctx;this._renderer=new d(b,C.Pos3Tex,null,c);b=this._update.bind(this);this._handles.add(p.init(this,"view.state.camera",b,!0));var b=this._updateElevation.bind(this),
k=function(){this._updateElevation({tile:this.view.basemapTerrain.rootTiles[0]})}.bind(this),m=this._updateVisibleElevationBounds.bind(this);this._handles.add(p.on(this,"view.basemapTerrain","elevation-change",b,k));this._handles.add(p.on(this,"view.basemapTerrain","elevation-bounds-change",m,m));a.shaderSnippets.fsRealisticAtmosphere||a.shaderSnippets._parse(A);this._hazeProgram=new t(c,a.shaderSnippets.vsRealisticAtmosphere,a.shaderSnippets.fsRealisticAtmosphere,q.Default3D,["HAZE"]);this._skyProgram=
new t(c,a.shaderSnippets.vsRealisticAtmosphere,a.shaderSnippets.fsRealisticAtmosphere,q.Default3D);this._hazePlanarProgram=new t(c,a.shaderSnippets.vsRealisticAtmosphere,a.shaderSnippets.fsRealisticAtmosphere,q.Default3D,["HAZE","PLANAR"]);this._skyPlanarProgram=new t(c,a.shaderSnippets.vsRealisticAtmosphere,a.shaderSnippets.fsRealisticAtmosphere,q.Default3D,["PLANAR"])},render:function(a){if(!(a.slot!=this._hazeSlot&&a.slot!=this._skySlot||a.pass!=r.MATERIAL||a.slot==this._hazeSlot&&a.options.earlyOcclusionPixelDraw)){var b,
c=this.renderContext.rctx,d=c.gl,k=a.offscreenRenderingHelper,m=!1;if(a.slot==this._hazeSlot){b=this.planar?this._hazePlanarProgram:this._hazeProgram;c.bindProgram(b);c.setBlendFunctionSeparate(d.ONE,d.ONE_MINUS_SRC_COLOR,d.ZERO,d.ONE);k.detachDepthTextureFromBuffer();var m=!0,h=k.getDepthTexture();c.bindTexture(h,0);b.setUniform1i("tDepth",0);b.setUniform4fv("v4SphereComp",this._renderData.v4SphereComp)}return a.slot==this._skySlot&&(b=this.planar?this._skyPlanarProgram:this._skyProgram,c.bindProgram(b),
c.setBlendFunctionSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA),b.setUniform4fv("v4SphereComp",this._renderData.v4SphereComp),b.setUniform4fv("v4AtmosParams3",this._renderData.v4AtmosParams3)),b.setUniform3fv("v3InvWavelength",this._renderData.v3InvWavelength),b.setUniform3fv("v3InvWavelengthScaled",this._renderData.v3InvWavelengthScaled),b.setUniform3fv("v3LightDir",a.lightingData.direction),b.setUniform3fv("v3CameraPos",this._renderData.v3CameraPos),b.setUniform3fv("v3CameraUp",
this._renderData.v3CameraUp),b.setUniform3fv("v3CameraRight",this._renderData.v3CameraRight),b.setUniform3fv("v3CameraDir",this._renderData.v3CameraDir),b.setUniform2fv("nearFar",this._renderData.nearFar),b.setUniform2fv("halfSizeNearPlane",this._renderData.halfSizeNearPlane),b.setUniform2fv("v2CameraCenterOffset",this._renderData.v2CameraCenterOffset),b.setUniform4fv("v4Radii",this._renderData.v4Radii),b.setUniform4fv("v4AtmosParams1",this._renderData.v4AtmosParams1),b.setUniform4fv("v4AtmosParams2",
this._renderData.v4AtmosParams2),b.setUniform1f("showTest",this._renderData.showTest),c.setDepthTestEnabled(!1),c.setBlendingEnabled(!0),this._renderer.render(b),c.setBlendingEnabled(!1),c.setDepthTestEnabled(!0),c.setBlendFunctionSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA),m&&k.restoreDepthTextureToBuffer(),!0}},_setEnableTestImage:function(a){a?this._renderData.showTest=1:this._renderData.showTest=0;this.needsRender=!0},_adjustRadiusForTesselation:function(a){return a*
Math.cos(Math.PI/Math.pow(2,4)/16)},_normalizeRadius:function(a){return a=this._adjustRadiusForTesselation(a),Math.max(v-1E4,Math.min(a,v))},_updateElevation:function(a){0===a.tile.lij[0]&&(a=this._adjustRadiusForTesselation(v+a.tile.elevationBounds[0]),a!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=a,this._earthRadius=-1,this._updateVisibleElevationBounds()))},_updateVisibleElevationBounds:function(){var a=this._adjustRadiusForTesselation(v+this.view.basemapTerrain.getElevationBounds()[0]);
return 0>this._earthRadius||a<this._earthRadius?this._updateRadius(a):!1},_updateRadius:function(a){this._earthRadius=a;var b=a*a,c=a/10*10.25,d=c*c,k=1/(c-a),m=k/.25,h=k/.05,l=.3*(c-a)+a,q=1/(c-l),t=this._renderData;return D.set4(k,.25,m,4,t.v4AtmosParams1),D.set4(-.99999,.05,h,20,t.v4AtmosParams2),D.set4(-.99999*-.99999,E,l,q,t.v4AtmosParams3),D.set4(a,b,c,d,t.v4Radii),t.fScale=k,t.fLowerAlphaBlendBound=l,t.fScaleOverScaleDepth=m,t.fScaleOverScaleDepthBlue=h,this._update(),!0},_update:function(a){if(a=
a||this.get("view.state.camera")){if(y.negate(a.viewForward,this._renderData.v3CameraDir),y.set(a.viewUp,this._renderData.v3CameraUp),y.set(a.viewRight,this._renderData.v3CameraRight),this.planar){var b=this.view.renderCoordsHelper;this._renderData.fCameraHeight=b.getAltitude(a.eye)/b.unitInMeters+v}else this._renderData.fCameraHeight=y.length(a.eye);this._renderData.fCameraHeight2=this._renderData.fCameraHeight*this._renderData.fCameraHeight;this._renderData.fC=this._renderData.fCameraHeight2-this._renderData.v4Radii[3];
this._renderData.fCSur=this._renderData.fCameraHeight2-this._renderData.v4Radii[1];this._renderData.v4SphereComp=D.createFrom(this._renderData.fCameraHeight,this._renderData.fCameraHeight2,this._renderData.fC,this._renderData.fCSur);y.set(a.eye,this._renderData.v3CameraPos);B.set2(Math.tan(a.fovX/2)/(a.width/a.fullWidth),Math.tan(a.fovY/2)/(a.height/a.fullHeight),this._renderData.halfSizeNearPlane);B.set2((a.padding[3]+a.width/2)/a.fullWidth-.5,(a.padding[2]+a.height/2)/a.fullHeight-.5,this._renderData.v2CameraCenterOffset);
B.set2(a.near,a.far,this._renderData.nearFar);this.needsRender=!0}}});return l.isSupported=function(a){return k.supportsDepthTexture(a.rctx.extensions)},l})},"esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":function(){define("require exports ./Util dojo/text!../materials/internal/offscreen.xml ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Program ../../../webgl/Util ../../../webgl/enums ./DefaultVertexBufferLayouts ./DefaultVertexAttributeLocations".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C){var q={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},v={target:3553,pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:0,height:0};return function(){function c(a,c){this._hudVisibilityTexture=null;this._enabled=!1;this.height=this.width=0;this._programRep=a;this._rctx=c;this.height=this.width=null}return c.prototype.enable=function(){if(!this.getEnableState()){var a=this._rctx;this._enabled=!0;
this.framebuffer=h.createWithAttachments(a,q,{colorTarget:0,depthStencilTarget:a.extensions.depthTexture?4:3});this.quadVAO=this.createQuadVAO(a)}},c.prototype.disable=function(){this.getEnableState()&&(this._enabled=!1,this.framebuffer.dispose(),this.quadVAO.dispose(!0),this.framebuffer=null,this.quadVAO=null,this._depthStencilTextureCached=null)},c.prototype.createQuadVAO=function(a){var c=new Float32Array([-1,-1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,1,1,1]);return new u(a,C.Default3D,{geometry:t.Pos2Tex},
{geometry:r.createVertex(a,35044,c)})},c.prototype.setEnableState=function(a){a?this.enable():this.disable()},c.prototype.getEnableState=function(){return this._enabled},c.prototype.getColorTexture=function(){return this.framebuffer.colorTexture},c.prototype.getDepthTexture=function(){return c.supportsDepthTexture(this._rctx.extensions)?this.framebuffer.depthStencilTexture||this._depthStencilTextureCached:null},c.prototype.getHUDVisibilityTexture=function(){return this._hudVisibilityTexture},c.supportsDepthTexture=
function(a){return!!a.depthTexture},c.prototype.initializeFrame=function(a){w.assert(this.getEnableState());var c=this._rctx,b=c.gl;a=a.fullViewport;this.width=a[2];this.height=a[3];this.framebuffer.resize(this.width,this.height);c.bindFramebuffer(this.framebuffer);c.setClearStencil(0);c.setClearColor(0,0,0,1);c.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT|b.STENCIL_BUFFER_BIT)},c.prototype.renderHUDVisibility=function(a){var c=this._rctx,b=c.gl;this._hudVisibilityTexture||(this._hudVisibilityTexture=
new d(c,v));this._hudVisibilityTexture.resize(this.width,this.height);var k=this.framebuffer.detachColorTexture();this.framebuffer.attachColorTexture(this._hudVisibilityTexture);c.bindFramebuffer(this.framebuffer);c.setClearColor(0,0,0,1);c.clear(b.COLOR_BUFFER_BIT);a();b.flush();this.framebuffer.detachColorTexture();this.framebuffer.attachColorTexture(k)},c.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)},c.prototype.getFramebuffer=function(){return this.framebuffer},
c.prototype.detachDepthTextureFromBuffer=function(){this._depthStencilTextureCached=this.framebuffer.depthStencilTexture;this.framebuffer.detachDepthStencilTexture()},c.prototype.restoreDepthTextureToBuffer=function(){this.framebuffer.attachDepthStencilTexture(this._depthStencilTextureCached);this._depthStencilTextureCached=null},c.prototype.drawQuad=function(a){w.assert(this.getEnableState());a=this._rctx;var c=a.gl,b=this._programRep.get("offscreenProgram");a.bindFramebuffer();a.setDepthTestEnabled(!1);
a.clear(c.COLOR_BUFFER_BIT);a.bindProgram(b);b.setUniform1i("tex",1);a.bindTexture(this.framebuffer.colorTexture,1);a.bindVAO(this.quadVAO);a.drawArrays(5,0,k.vertexCount(this.quadVAO,"geometry"));a.setDepthTestEnabled(!0)},c.loadShaders=function(c,d,b,k){c._parse(l);c=new a(k,c.vsOffscreenRenderer,c.fsOffscreenRenderer,C.Default3D);b.add("offscreenProgram",c)},c}()})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("dojo/text!./materials/SimpleAtmosphereMaterial.xml dojo/Deferred ../../../core/watchUtils ../support/ExternalRenderer ../lib/glMatrix ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/Texture ../webgl-engine/lib/Util ../webgl-engine/lib/GLTextureRep ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ./resources/SimpleAtmosphereTexture ../support/earthUtils ../../webgl/Program ../webgl-engine/lib/DefaultVertexAttributeLocations".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v){var y=C.earthRadius,B=h.vec3d,D=h.vec2d,b=h.mat4d,m=r.VertexAttrConstants,E=(y-1E4)/y,J=(y+3E5)/y,G=-1E4/3E5,K=1-G;return l.createSubclass({declaredClass:"esri.views.3d.environment.SimpleAtmosphere",properties:{view:{},needsRender:{value:!1},slot:{value:c.BACKGROUND,set:function(a){this.needsRender=!0;this._set("slot",a)}}},constructor:function(){this._renderData={texV:D.create(),silCircleCenter:B.create(),silCircleV1:B.create(),silCircleV2:B.create()};this._textureRep=
this._texture=null},initialize:function(){this._textureDfd=new p;this.addResolvingPromise(this._textureDfd.promise)},destroy:function(){this._currentViewChangedHandle&&(this._currentViewChangedHandle.remove(),this._currentViewChangedHandle=null);this._textureRep&&(this._texture&&(this._textureRep.release("SimpleAtmosphere"),this._textureRep.getTexture("SimpleAtmosphere").unload()),this._textureRep=null);this._program&&(this._program.dispose(),this._program=null);this._textureDfd&&(this._textureDfd.cancel(),
this._textureDfd=null)},initializeRenderContext:function(b){this._textureRep=new a({SimpleAtmosphere:new u(t,"SimpleAtmosphere",{wrapClamp:!0})},b.programRep,function(){return this.view.state.camera.viewport}.bind(this),b.rctx);this._texture=this._textureRep.aquire("SimpleAtmosphere",void 0,void 0,function(a){this._texture=a.getGLTexture();this._textureDfd.resolve();this._textureDfd=null}.bind(this))},setup:function(a){var b=this._createRibbonGeometryData();this._renderer=new d(b,[{name:"position",
count:3,type:5126,offset:0,stride:12,normalized:!1}],null,a.rctx);this._currentViewChangedHandle=w.init(this,"view.state.camera",this._update.bind(this),!0);a.shaderSnippets.vsSimpleAtmosphere||a.shaderSnippets._parse(A);this._program=new q(a.rctx,a.shaderSnippets.vsSimpleAtmosphere,a.shaderSnippets.fsSimpleAtmosphere,v.Default3D)},render:function(a){if(a.slot!==this.slot||a.pass!==k.MATERIAL)return!1;var b=this.renderContext.rctx,c=b.gl,d=this._program;return b.bindProgram(d),d.setUniform4f("color",
1,1,1,1),d.setUniformMatrix4fv("proj",a.camera.projectionMatrix),d.setUniformMatrix4fv("view",a.camera.viewMatrix),d.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),d.setUniform3fv("silCircleV1",this._renderData.silCircleV1),d.setUniform3fv("silCircleV2",this._renderData.silCircleV2),d.setUniform2fv("texV",this._renderData.texV),b.bindTexture(this._texture,0),d.setUniform1i("tex",0),d.setUniform3fv("lightDirection",a.lightingData.direction),b.setDepthFunction(c.LEQUAL),b.setBlendingEnabled(!0),
b.setDepthWriteEnabled(!1),this._renderer.render(d),b.setBlendingEnabled(!1),b.setDepthWriteEnabled(!0),b.setDepthFunction(c.LESS),!0},_update:function(a){var b=B.create(),c=B.create(),d=B.create(),k=this.view.renderCoordsHelper.getAltitude(a.eye);B.scale(a.eye,(y+50)/B.length(a.eye),d);this._computeSilhouetteCircle(d,a.center,a.up,y);B.add(this._renderData.silCircleCenter,this._renderData.silCircleV2,b);B.scale(b,J,c);var d=this._computeScreenRimWidth(d,a.up,b,c),m=0,h=1,l=1;50>k?(m=.001953125,h=
.1015625):500>k?(l=(k-50)/450,m=.001953125*(1-l)+.001953125*l,h=.1015625*(1-l)+.21875*l):5E3>k?(l=(k-500)/4500,m=.001953125*(1-l)+.001953125*l,h=.21875*(1-l)+.51171875*l):5E4>k&&(l=(k-5E3)/45E3,m=.001953125*(1-l)+.001953125*l,h=.51171875*(1-l)+.4140625*l);k=G+m*K;l=G+d*h*K;50<B.length(a.eye)-y&&(this._computeSilhouetteCircle(a.eye,a.center,a.up,y),B.add(this._renderData.silCircleCenter,this._renderData.silCircleV2,b),B.scale(b,J,c),a=this._computeScreenRimWidth(a.eye,a.up,b,c),a=r.clamp((a-1.5)/(d-
1.5),0,1),k=G+a*m*K,l=G+r.lerp(1,d*h,a)*K);D.set2(k,l,this._renderData.texV);this.needsRender=!0},_computeSilhouetteCircle:function(a,b,c,d){var k=B.length(a),m=d*Math.sqrt(k*k-d*d)/k,h=this._renderData.silCircleV1,l=this._renderData.silCircleV2;return B.scale(a,Math.sqrt(d*d-m*m)/k,this._renderData.silCircleCenter),B.cross(a,b,h),1>B.length2(h)&&B.cross(a,c,h),B.scale(h,m/B.length(h)),B.cross(h,a,l),B.scale(l,m/B.length(l)),m},_computeScreenRimWidth:function(a,c,d,k){var m=b.create();b.lookAt(a,
d,c,m);a=this.view.state.camera;return r.project(d,m,a.projectionMatrix,a.viewport),r.project(k,m,a.projectionMatrix,a.viewport),B.dist(d,k)/a.height},_createRibbonGeometryData:function(){for(var a=new Float32Array(768),b=new Uint32Array(768),c=0;128>c;c++){var d=6*c;a[d+0]=c;a[d+1]=E;a[d+2]=0;a[d+3]=c;a[d+4]=J;a[d+5]=1;var k=2*c,h=127===c?0:k+2;b[d+0]=k;b[d+1]=k+1;b[d+2]=h+1;b[d+3]=h+1;b[d+4]=h;b[d+5]=k}c={};c[m.POSITION]=b;b={};return b[m.POSITION]={size:3,data:a},{indices:c,vertexAttr:b}}})})},
"esri/views/3d/environment/Stars":function(){define("dojo/text!./materials/StarMaterial.xml require ../../../request ../../../core/watchUtils ../../../core/promiseUtils ../../../core/Error ../../../core/Logger ../lib/glMatrix ../support/ExternalRenderer ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../../webgl/Program ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Util".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B){var D=r.mat4d;r=r.mat3d;var b=c.VertexAttrConstants,m="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),E=u.getLogger("esri.views.3d.environment.Stars"),J=r.toMat4(r.createFrom(1,0,0,0,.9174771405229186,.39778850739794974,0,-.39778850739794974,.9174771405229186)),G=r.toMat4(r.createFrom(1,0,0,0,.9174771405229186,-.39778850739794974,
0,.39778850739794974,.9174771405229186)),K=null;return a.createSubclass({properties:{view:{},numBinaryFloats:{value:2},numBinaryUInt8:{value:1},bytesPerStar:{value:9},needsRender:{value:!1},slot:{value:q.BACKGROUND,set:function(a){this.needsRender=!0;this._set("slot",a)}}},constructor:function(){this._renderData={model:D.identity()};this.slot=q.BACKGROUND;this._vertexBufferLayout=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:20,
normalized:!1},{name:"size",count:1,type:5126,offset:16,stride:20,normalized:!1}]},initialize:function(){this._loadDataPromise=this._loadBrightStarCatalogue();this.addResolvingPromise(this._loadDataPromise)},destroy:function(){this._loadDataPromise.isFulfilled()||this._loadDataPromise.cancel("Atmosphere has been removed.");this._dateHandle&&(this._dateHandle.remove(),this._dateHandle=null);this._program&&(this._program.dispose(),this._program=null)},setup:function(a){this._numStars=this._starData.byteLength/
this.bytesPerStar;var b=new Float32Array(this._starData,0,this._numStars*this.numBinaryFloats),c=new Uint8Array(this._starData,this._numStars*this.numBinaryFloats*4,this._numStars*this.numBinaryUInt8),b=this._createStarGeometryData(b,c);this._renderer=new k(b,this._vertexBufferLayout,this._fillInterleaved,a.rctx);this._renderer.enablePointRendering(!0);this._dateHandle=l.init(this,"view.environment.lighting.date",this._update.bind(this));a.shaderSnippets.vertexShaderStar||a.shaderSnippets._parse(A);
this._program=new v(a.rctx,a.shaderSnippets.vertexShaderStar,a.shaderSnippets.fragmentShaderStar,y.Default3D)},render:function(a){if(a.slot!==this.slot||a.pass!==C.MATERIAL)return!1;var b=this.renderContext.rctx,c=b.gl,d=this._program;return b.bindProgram(d),d.setUniformMatrix4fv("view",a.camera.viewMatrix),d.setUniformMatrix4fv("proj",a.camera.projectionMatrix),d.setUniform4fv("viewport",a.camera.fullViewport),d.setUniformMatrix4fv("model",this._renderData.model),b.setDepthFunction(c.LEQUAL),b.setBlendingEnabled(!0),
b.setBlendFunctionSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA),b.setDepthWriteEnabled(!1),this._renderer.render(d),b.setBlendingEnabled(!1),b.setDepthWriteEnabled(!0),b.setDepthFunction(c.LESS),!0},_fillInterleaved:function(a,c,d,k,m,h,l){var q=B.getStride(m);d=q/4;var r=t.fill,v=a.indices[b.POSITION],u=a.vertexAttr[b.POSITION].data;k=l+B.findAttribute(m,"position").offset/4;for(var y=0;y<v.length;++y){var g=3*v[y];r(u,g,h,k,c,3);k+=d}c=a.indices[b.COLOR];v=a.vertexAttr[b.COLOR].data;
k=l+B.findAttribute(m,"color").offset;u=new Uint8Array(h.buffer);for(y=0;y<c.length;++y)g=4*c[y],r(v,g,u,k,null,4),k+=q;q=a.indices[b.SIZE];a=a.vertexAttr[b.SIZE].data;k=l+B.findAttribute(m,"size").offset/4;for(y=0;y<q.length;++y)h[k]=a[q[y]],k+=d},_computeDayDuration:function(a){var b=new Date(a.getFullYear(),0,1,11,58,56),c=new Date(a.getFullYear()+1,0,1,11,58,55);return(a-b)/(c-b)},_update:function(a){if(a){var b=a.getHours()/12,c=a.getMinutes()/60*(2/24),d=a.getSeconds()/60*(2/1440),b=(b+c+d-
.9972222)%2;a=2*this._computeDayDuration(a);c=D.create(G);D.rotateZ(c,-a*Math.PI);D.multiply(J,c,c);D.rotateZ(c,-b*Math.PI);this._renderData.model=c;this.needsRender=!0}},_hexToRGB:function(a){return[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)]},_unpackUint8Attributes:function(a){return 192<=a?[2.9,a-192]:160<=a?[2.5,a-160]:128<=a?[2,a-128]:96<=a?[1.5,a-96]:64<=a?[1,a-64]:32<=a?[.7,a-32]:[.4,a]},_createStarGeometryData:function(a,c){for(var d=new Float32Array(3*
this._numStars),k=new Uint8Array(4*this._numStars),h=new Float32Array(this._numStars),l=new Uint32Array(this._numStars),q=0;q<this._numStars;q++){var t=2*q,r=3*q,v=4*q,u=a[t+0],t=a[t+1];d[r+0]=-Math.cos(u)*Math.sin(t);d[r+1]=-Math.sin(u)*Math.sin(t);d[r+2]=-Math.cos(t);r=this._unpackUint8Attributes(c[q]);u=this._hexToRGB(m[r[1]]);k[v+0]=255*u[0];k[v+1]=255*u[1];k[v+2]=255*u[2];k[v+3]=255;h[q]=r[0];l[q]=q}a={};a[b.POSITION]=l;a[b.NORMAL]=l;a[b.UV0]=l;a[b.COLOR]=l;a[b.SIZE]=l;l={};return l[b.POSITION]=
{size:3,data:d},l[b.COLOR]={size:4,data:k},l[b.SIZE]={size:1,data:h},{indices:a,vertexAttr:l}},_verifyStartData:function(a){if(!a)throw new d("stars:no-data-received","Failed to create stars because star catalogue is missing");a=a.byteLength/this.bytesPerStar;if(0!==a%1||5E4<a||5E3>a)throw new d("stars:invalid-data","Failed to create stars because star catalogue data is invalid");},_loadBrightStarCatalogue:function(){return K?(this._starData=K,h.resolve()):w(p.toUrl("./resources/stars.wsv"),{responseType:"array-buffer",
failOk:!0}).then(function(a){a=a.data;this._verifyStartData(a);this._starData=K=a}.bind(this)).otherwise(function(a){throw E.error("loadBrightStarCatalogue",a.message),a;})}})})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["require","exports","../../lib/glMatrix"],function(A,p,w){Object.defineProperty(p,"__esModule",{value:!0});var l=w.vec3d;A=function(){return function(h,d,u){void 0===h&&(h=l.create());void 0===d&&(d=l.createFrom(.57735,.57735,.57735));void 0===u&&(u=!0);
this.intensity=h;this.direction=d;this.castShadows=u}}();p.MainLight=A;A=function(){return function(h,d){void 0===h&&(h=l.create());void 0===d&&(d=l.createFrom(.57735,.57735,.57735));this.intensity=l.create();this.direction=l.create();this.intensity=h;this.direction=d}}();p.FillLight=A;A=function(){return function(h){void 0===h&&(h=l.create());this.intensity=h}}();p.AmbientLight=A;A=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();p.SphericalHarmonicsLight=A})},"esri/views/3d/constraints/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ./AltitudeConstraint ./ClipDistanceConstraint ./TiltConstraint ./CollisionConstraint".split(" "),
function(A,p,w,l,h,d,u,r,a,k){Object.defineProperty(p,"__esModule",{value:!0});A=function(c){function d(){var d=null!==c&&c.apply(this,arguments)||this;return d.tilt=new a["default"],d.altitude=new u["default"],d.clipDistance=new r["default"],d.collision=new k["default"],d}return w(d,c),l([h.property({type:a["default"]})],d.prototype,"tilt",void 0),l([h.property({type:u["default"]})],d.prototype,"altitude",void 0),l([h.property({type:r["default"]})],d.prototype,"clipDistance",void 0),l([h.property({type:k["default"]})],
d.prototype,"collision",void 0),d=l([h.subclass("esri.views.3d.constraints.Constraints")],d)}(h.declared(d));p.Constraints=A;p["default"]=A})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor dojo/_base/kernel ../state/Constraints".split(" "),function(A,p,w,l,h,d,u,r){Object.defineProperty(p,"__esModule",{value:!0});A=
function(a){function d(){var c=null!==a&&a.apply(this,arguments)||this;return c.min=r.AltitudeDefault.min,c.max=r.AltitudeDefault.max,c}return w(d,a),Object.defineProperty(d.prototype,"mode",{get:function(){return u.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.","","4.6"),"manual"},set:function(a){u.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",
"","4.6")},enumerable:!0,configurable:!0}),l([h.property({type:Number})],d.prototype,"min",void 0),l([h.property({type:Number})],d.prototype,"max",void 0),d=l([h.subclass("esri.views.3d.constraints.AltitudeConstraint")],d)}(h.declared(d));p.AltitudeConstraint=A;p["default"]=A})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor".split(" "),
function(A,p,w,l,h,d){Object.defineProperty(p,"__esModule",{value:!0});A=function(d){function r(){var a=null!==d&&d.apply(this,arguments)||this;return a.mode="auto",a}return w(r,d),Object.defineProperty(r.prototype,"near",{get:function(){return this._get("near")},set:function(a){this._set("near",a);a>=this._get("far")&&(this.far=a+1E-9);this.mode="manual"},enumerable:!0,configurable:!0}),r.prototype.castNear=function(a){return Math.max(1E-8,a)},Object.defineProperty(r.prototype,"far",{get:function(){return this._get("far")},
set:function(a){this._set("far",a);a<=this._get("near")&&(this.near=a-1E-9);this.mode="manual"},enumerable:!0,configurable:!0}),r.prototype.castFar=function(a){return Math.max(1E-8,a)},r.prototype.autoUpdate=function(a,d){"auto"===this.mode&&(this._get("near")!==a&&this._set("near",a),this._get("far")!==d&&this._set("far",d))},l([h.property({type:Number,value:1E-8})],r.prototype,"near",null),l([h.cast("near")],r.prototype,"castNear",null),l([h.property({type:Number,value:1E-8})],r.prototype,"far",
null),l([h.cast("far")],r.prototype,"castFar",null),l([h.property({type:String})],r.prototype,"mode",void 0),r=l([h.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],r)}(h.declared(d));p.ClipDistanceConstraint=A;p["default"]=A})},"esri/views/3d/constraints/TiltConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../support/mathUtils ../state/Constraints".split(" "),
function(A,p,w,l,h,d,u,r){Object.defineProperty(p,"__esModule",{value:!0});var a=u.rad2deg(r.TiltDefault.min),k=u.rad2deg(r.TiltDefault.max);A=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;return a.mode="auto",a}return w(d,c),Object.defineProperty(d.prototype,"max",{get:function(){return this._get("max")},set:function(a){this._set("max",a);this.mode="manual"},enumerable:!0,configurable:!0}),d.prototype.castMax=function(c){return u.clamp(c,a,k)},d.prototype.autoUpdate=function(a){"auto"===
this.mode&&this._get("max")!==a&&this._set("max",a)},l([h.property({type:String})],d.prototype,"mode",void 0),l([h.property({type:Number,value:k})],d.prototype,"max",null),l([h.cast("max")],d.prototype,"castMax",null),d=l([h.subclass("esri.views.3d.constraints.TiltConstraint")],d)}(h.declared(d));p.TiltConstraint=A;p["default"]=A})},"esri/views/3d/constraints/CollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor".split(" "),
function(A,p,w,l,h,d){Object.defineProperty(p,"__esModule",{value:!0});A=function(d){function r(){var a=null!==d&&d.apply(this,arguments)||this;return a.enabled=!0,a}return w(r,d),l([h.property()],r.prototype,"enabled",void 0),r=l([h.subclass("esri.views.3d.constraints.CollisionConstraint")],r)}(h.declared(d));p.CollisionConstraint=A;p["default"]=A})},"esri/views/3d/input/SceneInputManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/watchUtils ../../../core/Accessor ../../../core/HandleRegistry ../../../core/accessorSupport/decorators ../../input/InputManager ../../input/BrowserEventSource ../../input/ViewEvents ../../input/handlers/PreventContextMenu ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/KeyPan ./handlers/MouseWheelZoom ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/PointerDownCancelAnimation ./handlers/TwoFingerTilt ./handlers/PinchAndPanNavigation".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E,J){A=function(d){function p(){var a=null!==d&&d.apply(this,arguments)||this;return a._handles=new u,a}return w(p,d),p.prototype.initialize=function(){var a=this;this.viewEvents=new c.ViewEvents(this.view);this._handles.add([h.whenNot(this.view,"ready",function(){return a._disconnect()}),h.when(this.view,"ready",function(){return a._connect()})])},p.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this._disconnect()},
Object.defineProperty(p.prototype,"primaryDragAction",{get:function(){return this._get("primaryDragAction")},set:function(a){"pan"!==a&&"rotate"!==a||a===this._get("primaryDragAction")||(this._set("primaryDragAction",a),this._updateMode())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"mode",{get:function(){return this._get("mode")},set:function(a){"default"!==a&&"pro"!==a||a===this._get("mode")||(this._set("mode",a),this._updateMode())},enumerable:!0,configurable:!0}),p.prototype._disconnect=
function(){this.viewEvents.disconnect();this._source&&(this._source.destroy(),this._source=null);this._inputManager&&(this._inputManager.destroy(),this._inputManager=null)},p.prototype._connect=function(){var c=this.view;this._source=new k.BrowserEventSource(this.view.canvas);var d=new a.InputManager(this._source);this._inputManager=d;d.installHandlers("prevent-context-menu",[new t.PreventContextMenu]);this._modeDragPan=new J.PinchAndPanNavigation(c,"primary");this._modeDragRotate=new q.DragRotate(c,
"secondary","center");this._modeDragZoom=new v.DragZoom(c,"tertiary");d.installHandlers("navigation",[new m.PointerDownCancelAnimation(c),new C.DoubleClickZoom(c),new y.KeyPan(c,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j"}),new B.MouseWheelZoom(c),new b.SingleKeyResetTilt(c,"p"),new D.SingleKeyResetHeading(c,"n"),new q.DragRotate(c,"primary","eye",["b"]),new q.DragRotate(c,"secondary","center",["b"]),new J.PinchAndPanNavigation(c,"tertiary",["b"]),this._modeDragRotate,
this._modeDragZoom,this._modeDragPan,new E.TwoFingerTilt(c)]);this.viewEvents.connect(d);this._updateMode()},p.prototype._updateMode=function(){var a=this.primaryDragAction,a=G.get(this.mode).get(a);this._modeDragPan&&(this._modeDragPan.pointerType=a.pan);this._modeDragRotate&&(this._modeDragRotate.pointerType=a.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerType=a.zoom)},l([r.property()],p.prototype,"view",void 0),l([r.property({value:"pan"})],p.prototype,"primaryDragAction",null),l([r.property({value:"default"})],
p.prototype,"mode",null),l([r.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],p.prototype,"latestPointerType",void 0),l([r.property()],p.prototype,"_inputManager",void 0),p=l([r.subclass("esri.views.3d.input.SceneInputManager")],p)}(r.declared(d));var G=new Map;p=new Map;d=new Map;return p.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),p.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),d.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),
d.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),G.set("default",p),G.set("pro",d),A})},"esri/views/input/InputManager":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor ../../core/now dojo/has ./keys ./recognizers ../../core/Logger ./handlers/LatestPointerType".split(" "),function(A,p,w,l,h,d,u,r,a,k,c,t){Object.defineProperty(p,"__esModule",{value:!0});var C=
c.getLogger("esri.views.input.InputManager");A=function(c){function d(d,k){d=c.call(this)||this;return d._pointerCaptures=new Map,d._nameToGroup={},d._handlers=[],d._currentPropagation=null,d._sourceEvents=new Set,d._keyModifiers=new Set,d._activeKeyModifiers=new Set,d.primaryKey=a.primaryKey,d.latestPointerType="mouse",d._installRecognizers(),d}return w(d,c),d.prototype.normalizeCtorArgs=function(a,c){return this._browserEvents=a,this._browserEvents.onEventReceived=this._onEventReceived.bind(this),
this._recognizers=c,this._recognizers||(this._recognizers=k.defaults.map(function(a){return new a})),{}},d.prototype.destroy=function(){for(var a=0,c=Object.keys(this._nameToGroup);a<c.length;a++)this.uninstallHandlers(c[a])},d.prototype.installHandlers=function(a,c){var b=this;if(this._nameToGroup[a])return void C.error("There is already an InputHandler group registered under the name `"+a+"`");if(0===c.length)return void C.error("Can't register a group of zero handlers");var d={name:a,handlers:c.map(function(a,
b){return{handler:a,active:!0,removed:!1,priorityIndex:0,eventCallback:null,uninstallCallback:null}})};this._nameToGroup[a]=d;a=function(a){var c=d.handlers[a];k._handlers.push(c);c.handler.onInstall({updateDependencies:function(){b.updateDependencies()},emit:function(a,d,k,m){b._emitInputEvent(c.priorityIndex,a,d,k,m)},setPointerCapture:function(a,k){b._setPointerCapture(d,c,a,k)},setEventCallback:function(a){c.eventCallback=a},setUninstallCallback:function(a){c.uninstallCallback=a}})};var k=this;
for(c=d.handlers.length-1;0<=c;c--)a(c);this.updateDependencies()},d.prototype.uninstallHandlers=function(a){var c=this._nameToGroup[a];return c?(c.handlers.forEach(function(a){a.removed=!0;a.uninstallCallback()}),delete this._nameToGroup[a],void(this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers())):void C.error("There is no InputHandler group registered under the name `"+a+"`")},d.prototype.hasHandlers=function(a){return void 0!==
this._nameToGroup[a]},d.prototype.updateDependencies=function(){var c=new Set,d=new Set;this._handlersPriority=[];for(var b=this._handlers.length-1;0<=b;b--){var k=this._handlers[b];k.priorityIndex=b;this._handlersPriority.push(k)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(b=this._handlersPriority.length-1;0<=b;b--){k=this._handlersPriority[b];k.priorityIndex=b;var h=k.handler.hasSideEffects;if(!h)for(var l=0,q=k.handler.outgoingEventTypes;l<q.length;l++)if(c.has(q[l])){h=
!0;break}if(h)for(l=0,q=k.handler.incomingEventMatches;l<q.length;l++){var t=q[l];c.add(t.eventType);for(var r=0,t=t.keyModifiers;r<t.length;r++){var v=t[r];a.isSystemModifier(v)||d.add(v)}}k.active=h}this._sourceEvents=c;this._keyModifiers=d;0<this._pointerCaptures.size&&this._sourceEvents.add("pointer-capture-lost");0<this._keyModifiers.size&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up"));this._browserEvents&&(this._browserEvents.activeEvents=this._sourceEvents)},d.prototype._setLatestPointerType=
function(a){this._set("latestPointerType",a)},d.prototype._onEventReceived=function(a,c){if("pointer-capture-lost"===a)this._pointerCaptures["delete"](c["native"].pointerId);this._updateKeyModifiers(a,c);this._emitInputEventFromSource(a,c,c["native"].timestamp)},d.prototype._updateKeyModifiers=function(a,c){var b=this;if(c){var d=!1,k=function(){if(!d){var a=new Set;b._activeKeyModifiers.forEach(function(b){a.add(b)});b._activeKeyModifiers=a;d=!0}},h=function(a,c){c&&!b._activeKeyModifiers.has(a)?
(k(),b._activeKeyModifiers.add(a)):!c&&b._activeKeyModifiers.has(a)&&(k(),b._activeKeyModifiers["delete"](a))};if("key-down"===a||"key-up"===a){var l=c.key;this._keyModifiers.has(l)&&h(l,"key-down"===a)}a=c["native"];h("Alt",!(!a||!a.altKey));h("Ctrl",!(!a||!a.ctrlKey));h("Shift",!(!a||!a.shiftKey));h("Meta",!(!a||!a.metaKey));h("Primary",this._activeKeyModifiers.has(this.primaryKey))}},d.prototype._installRecognizers=function(){var a=this;this._latestPointerTypeHandler=new t.LatestPointerType(function(c){return a._setLatestPointerType(c)});
0<this._recognizers.length&&this.installHandlers("default",this._recognizers);this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler])},d.prototype.allowPointerCapture=function(a){return 2!==a.button?!0:!(r("mac")&&r("chrome"))},d.prototype._setPointerCapture=function(a,c,b,d){a=a.name+"-"+c.priorityIndex;c=this._pointerCaptures.get(b.pointerId)||new Set;this._pointerCaptures.set(b.pointerId,c);d&&this.allowPointerCapture(b)?(c.add(a),1===c.size&&this._browserEvents&&this._browserEvents.setPointerCapture(b,
!0)):!d&&c.has(a)&&(c["delete"](a),0===c.size&&(this._pointerCaptures["delete"](b.pointerId),this._browserEvents&&this._browserEvents.setPointerCapture(b,!1)))},d.prototype._garbageCollectRemovedHandlers=function(){this._handlers=this._handlers.filter(function(a){return!a.removed});this.updateDependencies()},d.prototype._emitInputEventFromSource=function(a,c,b){this._emitInputEvent(0,a,c,b)},d.prototype._emitInputEvent=function(a,c,b,d,k){d=void 0!==d?d:this._currentPropagation?this._currentPropagation.timestamp:
u();c=new q(c,b,d,k||this._activeKeyModifiers);return this._currentPropagation?void this._currentPropagation.addedEvents.push(c):void this._doNewPropagation(a,c)},d.prototype._doNewPropagation=function(a,c){for(a=this._currentPropagation={events:[c],addedEvents:[],currentHandler:this._handlersPriority[a],needsHandlerGarbageCollect:!1,timestamp:c.timestamp};a.currentHandler;){if(a.currentHandler.removed)a.needsHandlerGarbageCollect=!0;else{c=a.events;var b=[];a.addedEvents=[];for(var d=0;d<c.length;d++){var k=
c[d];a.currentHandler.active&&a.currentHandler.eventCallback(k);k.shouldStopPropagation()||b.push(k)}a.events=b.concat(a.addedEvents)}a.currentHandler=this._handlersPriority[a.currentHandler.priorityIndex+1]}a.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers();this._currentPropagation=null},d.prototype._compareHandlerPriority=function(a,c){if(a.handler.hasSideEffects!==c.handler.hasSideEffects)return a.handler.hasSideEffects?1:-1;for(var b=0,d=a.handler.incomingEventMatches;b<d.length;b++)for(var k=
d[b],h=function(a){if(k.eventType!==a.eventType)return"continue";var b=k.keyModifiers.filter(function(b){return-1!==a.keyModifiers.indexOf(b)});return b.length===k.keyModifiers.length!==(b.length===a.keyModifiers.length)?{value:k.keyModifiers.length>a.keyModifiers.length?-1:1}:void 0},l=0,q=c.handler.incomingEventMatches;l<q.length;l++){var t=h(q[l]);if("object"==typeof t)return t.value}return a.priorityIndex>c.priorityIndex?-1:1},d.prototype._sortHandlersPriority=function(a){for(var c=[],b=0;b<a.length;b++){for(var d=
a[b],k=0;k<c.length&&0<=this._compareHandlerPriority(d,c[k]);)k++;c.splice(k,0,d)}return c},l([h.property({readOnly:!0})],d.prototype,"latestPointerType",void 0),d=l([h.subclass("esri.views.input.InputManager")],d)}(h.declared(d));p.InputManager=A;var q=function(){function a(a,c,d,b){this.type=a;this.data=c;this.timestamp=d;this.modifiers=b;this._stopPropagation=!1}return a.prototype.stopPropagation=function(){this._stopPropagation=!0},a.prototype.shouldStopPropagation=function(){return this._stopPropagation},
a}()})},"esri/views/input/keys":function(){define(["require","exports","../../core/sniff"],function(A,p,w){Object.defineProperty(p,"__esModule",{value:!0});p.primaryKey=w("mac")?"Meta":"Ctrl";var l={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(A=48;58>A;A++)l[A]=String.fromCharCode(A);for(A=1;25>A;A++)l[111+A]="F"+A;for(A=65;91>A;A++)l[A]=[String.fromCharCode(A+32),
String.fromCharCode(A)];var h={Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Esc:"Escape"};p.eventKey=function(d){if(void 0!==d.key)return h[d.key]||d.key;var u=l[d.keyCode];return Array.isArray(u)?d.shiftKey?u[1]:u[0]:u};p.isSystemModifier=function(d){switch(d){case "Ctrl":case "Alt":case "Shift":case "Meta":case "Primary":return!0}}})},"esri/views/input/recognizers":function(){define("require exports ./recognizers/Drag ./recognizers/PointerClickHoldAndDrag ./recognizers/SingleAndDoubleClick ./recognizers/VerticalTwoFingerDrag".split(" "),
function(A,p,w,l,h,d){Object.defineProperty(p,"__esModule",{value:!0});p.defaults=[l.PointerClickHoldAndDrag,h.SingleAndDoubleClick,w.Drag,d.VerticalTwoFingerDrag]})},"esri/views/input/recognizers/Drag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler","./support"],function(A,p,w,l,h){Object.defineProperty(p,"__esModule",{value:!0});A=function(d){function l(){var h=d.call(this,!1)||this;return h._startStateModifiers=new Set,h._activePointers=[],h._activePointerMap=
new Map,h._isDragging=!1,h._drag=h.registerOutgoing("drag"),h.registerIncoming("pointer-drag",h._handlePointerDrag.bind(h)),h.registerIncoming("pointer-down",h._handlePointerDown.bind(h)),h.registerIncoming("pointer-up",h._handlePointerUpAndPointerLost.bind(h)),h.registerIncoming("pointer-capture-lost",h._handlePointerUpAndPointerLost.bind(h)),h}return w(l,d),l.prototype._createPayload=function(d,a){return{action:d,pointers:this._activePointers.map(function(a){return a.data}),startState:this._startState,
previousState:this._previousState,currentState:a}},l.prototype._fitCircleLSQ=function(){var d=this._activePointers.map(function(a){return a.data.currentEvent});return h.fitCircleLSQ(d)},l.prototype._createDragState=function(d){for(var a=this._fitCircleLSQ(),k=0,c=0,h=this._activePointers;c<h.length;c++){for(var l=h[c],q=this._pointerAngle(l,a),q=q-l.lastAngle;q>Math.PI;)q-=2*Math.PI;for(;q<-Math.PI;)q+=2*Math.PI;q=l.lastAngle+q;l.lastAngle=q;k+=q-l.initialAngle}return k/=this._activePointers.length,
{angle:k,radius:a.radius,center:a.center,timestamp:d}},l.prototype._updateMultiPointer=function(d,a){var k=d.startEvent["native"].pointerId,c=this._activePointerMap.get(k),h=!c;h?(c={data:null,initialAngle:0,lastAngle:0},this._activePointers.push(c),this._activePointerMap.set(k,c),c.data={startEvent:d.startEvent,previousEvent:d.previousEvent,currentEvent:d.currentEvent},d=this._fitCircleLSQ(),c.initialAngle=this._pointerAngle(c,d),c.lastAngle=c.initialAngle):c.data={startEvent:c.data.startEvent,previousEvent:d.previousEvent,
currentEvent:d.currentEvent};return h&&this._isDragging&&this._updateInitialAngles(a),c},l.prototype._pointerAngle=function(d,a){d=d.data.currentEvent;return Math.atan2(d.y-a.center.y,d.x-a.center.x)},l.prototype._updateInitialAngles=function(d){d=this._createDragState(d);for(var a=0,k=this._activePointers;a<k.length;a++){var c=k[a];c.initialAngle=this._pointerAngle(c,d)}},l.prototype._emitStart=function(d){this._updateInitialAngles(d.timestamp);var a=this._createDragState(d.timestamp);this._previousState=
this._startState=a;this._startStateModifiers=d.modifiers;this._isDragging=!0;for(var k=0,c=this._activePointers;k<c.length;k++){var h=c[k];h.data={previousEvent:h.data.currentEvent,startEvent:h.data.currentEvent,currentEvent:h.data.currentEvent}}this._drag.emit(this._createPayload("start",a),d.timestamp)},l.prototype._emitUpdate=function(d){d=this._createDragState(d.timestamp);this._drag.emit(this._createPayload("update",d),void 0,this._startStateModifiers);this._previousState=d},l.prototype._emitEnd=
function(d){d=this._createDragState(d);this._drag.emit(this._createPayload("end",d),void 0,this._startStateModifiers);this._startState=this._previousState=null;this._isDragging=!1},l.prototype._handlePointerDown=function(d){var a=d.data;this._isDragging&&this._emitEnd(d.timestamp);this._updateMultiPointer({startEvent:a,previousEvent:a,currentEvent:a},d.timestamp)},l.prototype._removeMultiPointer=function(d,a){var k=this,c=d["native"].pointerId,h=this._activePointerMap.get(c);if(h){var l=function(){k._activePointerMap["delete"](c);
var d=k._activePointers.indexOf(h);k._activePointers.splice(d,1);k._isDragging&&k._updateInitialAngles(a)};this._isDragging?(this._updateMultiPointer({startEvent:h.data.startEvent,previousEvent:h.data.currentEvent,currentEvent:d},a),this._emitEnd(a),l()):l()}},l.prototype._handlePointerUpAndPointerLost=function(d){this._removeMultiPointer(d.data,d.timestamp)},l.prototype._handlePointerDrag=function(d){var a=d.data;switch(a.action){case "start":this._isDragging||this._emitStart(d);break;case "update":this._isDragging||
this._emitStart(d),this._updateMultiPointer(a,d.timestamp),this._emitUpdate(d)}},l}(l.InputHandler);p.Drag=A})},"esri/views/input/InputHandler":function(){define(["require","exports","./EventMatch","../../core/Logger"],function(A,p,w,l){Object.defineProperty(p,"__esModule",{value:!0});var h=l.getLogger("esri.views.input.InputHandler");A=function(){function l(a){this._manager=null;this._incoming={};this._outgoing={};this._outgoingEventTypes=this._incomingEventTypes=this._incomingEventMatches=null;
this._hasSideEffects=a}return Object.defineProperty(l.prototype,"incomingEventMatches",{get:function(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(var a in this._incoming)for(var d=0,c=this._incoming[a];d<c.length;d++)this._incomingEventMatches.push(c[d].match)}return this._incomingEventMatches},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"incomingEventTypes",{get:function(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(function(a){return a.eventType})),
this._incomingEventTypes},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"outgoingEventTypes",{get:function(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"hasSideEffects",{get:function(){return this._hasSideEffects},enumerable:!0,configurable:!0}),l.prototype.onInstall=function(a){var d=this;return this._manager?void h.error("This InputHandler has already been registered with an InputManager"):
(a.setEventCallback(function(a){return d._handleEvent(a)}),a.setUninstallCallback(function(){return d._onUninstall()}),void(this._manager=a))},l.prototype.onUninstall=function(){},l.prototype.registerIncoming=function(a,k,c){var h,l=this;"function"==typeof k?(c=k,h=[]):h=k||[];a="string"==typeof a?new w.EventMatch(a,h):a;var q=function(){l._incomingEventTypes=null;l._incomingEventMatches=null};k=function(a){var c=l._incoming[a.match.eventType];c&&(a=c.indexOf(a),c.splice(a,1),q(),l._manager&&l._manager.updateDependencies())};
c=new d(a,c,{onPause:k,onRemove:k,onResume:function(a){var c=l._incoming[a.match.eventType];c&&-1===c.indexOf(a)&&(c.push(a),q(),l._manager&&l._manager.updateDependencies())}});k=this._incoming[a.eventType];return k||(k=[],this._incoming[a.eventType]=k),k.push(c),q(),this._manager&&this._manager.updateDependencies(),c},l.prototype.registerOutgoing=function(a){var d=this;if(this._outgoing[a])throw Error("There is already a callback registered for this outgoing InputEvent: "+a);var c=new u(a,{onEmit:function(a,
c,k,h){d._manager.emit(a.eventType,c,k,h)},onRemove:function(a){delete d._outgoing[a.eventType];d._manager.updateDependencies()}});return this._outgoing[a]=c,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),c},l.prototype.startCapturingPointer=function(a){this._manager.setPointerCapture(a,!0)},l.prototype.stopCapturingPointer=function(a){this._manager.setPointerCapture(a,!1)},l.prototype._onUninstall=function(){return this._manager?(this.onUninstall(),void(this._manager=
null)):void h.error("This InputHandler is not registered with an InputManager")},l.prototype._handleEvent=function(a){var d=this._incoming[a.type];if(d)for(var c=0;c<d.length;c++){var h=d[c];if(h.match.matches(a)&&(h.callback(a),a.shouldStopPropagation()))break}},l}();p.InputHandler=A;var d=function(){function d(a,d,c){this.match=a;this._callback=d;this._handler=c}return d.prototype.pause=function(){this._handler.onPause(this)},d.prototype.resume=function(){this._handler.onResume(this)},d.prototype.remove=
function(){this._handler.onRemove(this)},Object.defineProperty(d.prototype,"callback",{get:function(){return this._callback},enumerable:!0,configurable:!0}),d}(),u=function(){function d(a,d){this.eventType=a;this._removed=!1;this._handler=d}return d.prototype.emit=function(a,d,c){this._removed||this._handler.onEmit(this,a,d,c)},d.prototype.remove=function(){this._removed=!0;this._handler.onRemove(this)},d}()})},"esri/views/input/EventMatch":function(){define(["require","exports"],function(A,p){Object.defineProperty(p,
"__esModule",{value:!0});A=function(){function p(l,h){void 0===h&&(h=[]);this.eventType=l;this.keyModifiers=h}return p.prototype.matches=function(l){if(l.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;l=l.modifiers;for(var h=0,d=this.keyModifiers;h<d.length;h++)if(!l.has(d[h]))return!1;return!0},p}();p.EventMatch=A})},"esri/views/input/recognizers/support":function(){define(["require","exports"],function(A,p){Object.defineProperty(p,"__esModule",{value:!0});p.manhattanDistance=
function(p,l){return Math.abs(l.x-p.x)+Math.abs(l.y-p.y)};p.euclideanDistance=function(p,l){var h=l.x-p.x;p=l.y-p.y;return Math.sqrt(h*h+p*p)};p.fitCircleLSQ=function(p,l){if(l?(l.radius=0,l.center.x=0,l.center.y=0):l={radius:0,center:{x:0,y:0}},0===p.length)return l;if(1===p.length)return l.center.x=p[0].x,l.center.y=p[0].y,l;if(2===p.length){var h=p[0];p=p[1];var d=[p.x-h.x,p.y-h.y],u=d[0],d=d[1];return l.radius=Math.sqrt(u*u+d*d)/2,l.center.x=(h.x+p.x)/2,l.center.y=(h.y+p.y)/2,l}for(var r=0,a=
0,k=0;k<p.length;k++)r+=p[k].x,a+=p[k].y;for(var r=r/p.length,a=a/p.length,c=p.map(function(a){return a.x-r}),t=p.map(function(b){return b.y-a}),C=h=l=0,q=0,v=u=0,k=d=0;k<c.length;k++){var y=c[k],B=t[k],w=y*y,b=B*B;l+=w;h+=b;C+=y*B;q+=w*y;u+=b*B;v+=y*b;d+=B*w}k=l;c=C;t=h;q=.5*(q+v);u=.5*(u+d);d=k*t-C*c;v=(q*t-u*c)/d;u=(k*u-C*q)/d;return{radius:Math.sqrt(v*v+u*u+(l+h)/p.length),center:{x:v+r,y:u+a}}}})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper",
"../InputHandler","./support"],function(A,p,w,l,h){Object.defineProperty(p,"__esModule",{value:!0});p.DefaultParameters={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilTouchDrag:6,holdDelay:500};A=function(d){function l(h,a,k,c){void 0===h&&(h=p.DefaultParameters.maximumClickDelay);void 0===a&&(a=p.DefaultParameters.movementUntilMouseDrag);void 0===k&&(k=p.DefaultParameters.movementUntilTouchDrag);void 0===c&&(c=p.DefaultParameters.holdDelay);var l=d.call(this,!1)||this;return l.maximumClickDelay=
h,l.movementUntilMouseDrag=a,l.movementUntilTouchDrag=k,l.holdDelay=c,l._pointerState=new Map,l._modifiers=new Set,l._pointerDrag=l.registerOutgoing("pointer-drag"),l._pointerClick=l.registerOutgoing("pointer-click"),l._pointerHold=l.registerOutgoing("hold"),l.registerIncoming("pointer-down",l._handlePointerDown.bind(l)),l.registerIncoming("pointer-up",l._handlePointerUpOrLost.bind(l)),l.registerIncoming("pointer-capture-lost",l._handlePointerUpOrLost.bind(l)),l._moveHandle=l.registerIncoming("pointer-move",
l._handlePointerMove.bind(l)),l._moveHandle.pause(),l}return w(l,d),l.prototype.onUninstall=function(){this._pointerState.forEach(function(d){0!==d.holdTimeout&&(clearTimeout(d.holdTimeout),d.holdTimeout=0)});d.prototype.onUninstall.call(this)},l.prototype._handlePointerDown=function(d){var a=this,k=d.data,c=k["native"].pointerId,h=0;0===this._pointerState.size&&(h=setTimeout(function(){var k=a._pointerState.get(c);k&&(k.isDragging||(a._pointerHold.emit(k.previousEvent,void 0,d.modifiers),k.holdEmitted=
!0),k.holdTimeout=0)},this.holdDelay));1===this._pointerState.size&&this._pointerState.forEach(function(a){0!==a.holdTimeout&&(clearTimeout(a.holdTimeout),a.holdTimeout=0)});this._pointerState.set(c,{startEvent:k,previousEvent:k,startTimestamp:d.timestamp,isDragging:!1,downButton:k["native"].button,holdTimeout:h});this.startCapturingPointer(k["native"]);this._moveHandle.resume()},l.prototype._createPointerDragData=function(d,a,k){return{action:d,startEvent:a.startEvent,previousEvent:a.previousEvent,
currentEvent:k}},l.prototype._handlePointerMove=function(d){var a=d.data,k=this._pointerState.get(a["native"].pointerId);k&&(k.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",k,a),void 0,this._modifiers):h.euclideanDistance(a,k.startEvent)>("touch"===a["native"].pointerType?this.movementUntilTouchDrag:this.movementUntilMouseDrag)&&(k.isDragging=!0,k.previousEvent=k.startEvent,this._modifiers=d.modifiers,0!==k.holdTimeout&&clearTimeout(k.holdTimeout),this._pointerDrag.emit(this._createPointerDragData("start",
k,k.startEvent),k.startTimestamp),this._pointerDrag.emit(this._createPointerDragData("update",k,a))),k.previousEvent=a)},l.prototype._handlePointerUpOrLost=function(d){var a=d.data,k=a["native"].pointerId,c=this._pointerState.get(k);c&&((0!==c.holdTimeout&&clearTimeout(c.holdTimeout),c.isDragging)?this._pointerDrag.emit(this._createPointerDragData("end",c,a),void 0,this._modifiers):c.downButton===a["native"].button&&d.timestamp-c.startTimestamp<=this.maximumClickDelay&&!c.holdEmitted&&this._pointerClick.emit(a),
this._pointerState["delete"](k),this.stopCapturingPointer(a["native"]),0===this._pointerState.size&&this._moveHandle.pause())},l}(l.InputHandler);p.PointerClickHoldAndDrag=A})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler","./support"],function(A,p,w,l,h){Object.defineProperty(p,"__esModule",{value:!0});p.DefaultParameters={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,
maximumDoubleTouchDistance:35};A=function(d){function l(h,a,k,c){void 0===h&&(h=p.DefaultParameters.maximumDoubleClickDelay);void 0===a&&(a=p.DefaultParameters.maximumDoubleClickDistance);void 0===k&&(k=p.DefaultParameters.maximumDoubleTouchDelay);void 0===c&&(c=p.DefaultParameters.maximumDoubleTouchDistance);var l=d.call(this,!1)||this;return l.maximumDoubleClickDelay=h,l.maximumDoubleClickDistance=a,l.maximumDoubleTouchDelay=k,l.maximumDoubleTouchDistance=c,l._pointerState=new Map,l._click=l.registerOutgoing("click"),
l._doubleClick=l.registerOutgoing("double-click"),l._firstClick=l.registerOutgoing("first-click"),l.registerIncoming("pointer-click",l._handlePointerClick.bind(l)),l}return w(l,d),l.prototype.onUninstall=function(){this._pointerState.forEach(function(d){0!==d.doubleClickTimeout&&(clearTimeout(d.doubleClickTimeout),d.doubleClickTimeout=0)})},l.prototype._pointerId=function(d){d=d["native"];return"mouse"===d.pointerType?d.pointerId+":"+d.button:""+d.pointerType},l.prototype._handlePointerClick=function(d){var a=
d.data,k=this._pointerId(a),c=this._pointerState.get(k);if(c){clearTimeout(c.doubleClickTimeout);c.doubleClickTimeout=0;var l="touch"===a["native"].pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;h.manhattanDistance(c.event.data,a)>l?(this._doubleClickTimeoutExceeded(k),this._startClick(d)):(this._doubleClick.emit(a,void 0,c.event.modifiers),this._pointerState["delete"](k))}else this._startClick(d)},l.prototype._startClick=function(d){var a=this,k=d.data,c=this._pointerId(d.data);
this._pointerState.set(c,{event:d,doubleClickTimeout:setTimeout(function(){return a._doubleClickTimeoutExceeded(c)},"touch"===k["native"].pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)});this._firstClick.emit(d.data,void 0,d.modifiers)},l.prototype._doubleClickTimeoutExceeded=function(d){var a=this._pointerState.get(d);this._click.emit(a.event.data,void 0,a.event.modifiers);a.doubleClickTimeout=0;this._pointerState["delete"](d)},l}(l.InputHandler);p.SingleAndDoubleClick=A})},
"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(A,p,w,l){Object.defineProperty(p,"__esModule",{value:!0});A=function(h){function d(d,l){void 0===d&&(d=20);void 0===l&&(l=40);var a=h.call(this,!1)||this;return a._threshold=d,a._maxDelta=l,a._failed=!1,a._active=!1,a._vertical=a.registerOutgoing("vertical-two-finger-drag"),a._artificalDragEnd=a.registerOutgoing("drag"),a.registerIncoming("drag",
a._handleDrag.bind(a)),a}return w(d,h),Object.defineProperty(d.prototype,"failed",{get:function(){return this._failed},enumerable:!0,configurable:!0}),d.prototype._handleDrag=function(d){if(2===d.data.pointers.length)switch(d.data.action){case "start":this._handleDragStart(d);break;case "update":this._handleDragUpdate(d);break;case "end":this._handleDragEnd(d)}},d.prototype._handleDragStart=function(d){this._failed=!1},d.prototype._handleDragUpdate=function(d){this._failed||(this._active?(this._vertical.emit({delta:d.data.currentState.center.y-
this._thresholdReachedCenter.y,action:"update"}),d.stopPropagation()):(this._failed=!this._checkDeltaConstraint(d.data),this._failed||this._checkThresholdReached(d.data)&&(this._active=!0,this._thresholdReachedCenter=d.data.currentState.center,this._artificalDragEnd.emit({action:"end",currentState:d.data.currentState,previousState:d.data.previousState,startState:d.data.startState,pointers:d.data.pointers}),this._vertical.emit({delta:d.data.currentState.center.y-this._thresholdReachedCenter.y,action:"begin"}),
d.stopPropagation())))},d.prototype._handleDragEnd=function(d){this._active&&(this._vertical.emit({delta:d.data.currentState.center.y-this._thresholdReachedCenter.y,action:"end"}),d.stopPropagation());this._active=!1},d.prototype._checkDeltaConstraint=function(d){var h=Math.abs(d.pointers[0].startEvent.x-d.pointers[1].startEvent.x),a=Math.abs(d.pointers[0].startEvent.y-d.pointers[1].startEvent.y),k=Math.abs(d.pointers[0].currentEvent.y-d.pointers[1].currentEvent.y),c=Math.abs(d.pointers[0].currentEvent.x-
d.pointers[1].currentEvent.x);return Math.abs(d.currentState.center.x-d.startState.center.x)<this._threshold&&Math.abs(c-h)<=this._maxDelta&&Math.abs(k-a)<=this._maxDelta},d.prototype._checkThresholdReached=function(d){return Math.min(Math.abs(d.pointers[0].currentEvent.y-d.pointers[0].startEvent.y),Math.abs(d.pointers[1].currentEvent.y-d.pointers[1].startEvent.y),Math.abs(d.currentState.center.y-d.startState.center.y))>=this._threshold},d}(l.InputHandler);p.VerticalTwoFingerDrag=A})},"esri/views/input/handlers/LatestPointerType":function(){define(["require",
"exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(A,p,w,l){Object.defineProperty(p,"__esModule",{value:!0});A=function(h){function d(d){var l=h.call(this,!0)||this;return l._onChange=d,l._value="mouse",l.registerIncoming("pointer-down",function(a){l._setValue("touch"===a.data["native"].pointerType?"touch":"mouse")}),l._moveHandler=l.registerIncoming("pointer-move",function(a){l._setValue("touch"===a.data["native"].pointerType?"touch":"mouse")}),l._moveHandler.pause(),l}
return w(d,h),d.prototype._setValue=function(d){d!==this._value&&("touch"===d?this._moveHandler.resume():this._moveHandler.pause(),this._value=d,this._onChange(d))},d}(l.InputHandler);p.LatestPointerType=A})},"esri/views/input/BrowserEventSource":function(){define(["require","exports","./keys","../../core/libs/pep/pep","dojo/sniff"],function(A,p,w,l,h){Object.defineProperty(p,"__esModule",{value:!0});var d=h("trident"),u=h("edge"),r=h("chrome"),a=h("ff"),k=h("safari");A=function(){function h(a){this._active=
{};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._element=a;l.applyLocal(a);a.getAttribute("tabindex")||a.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};
this._initialCssTouchAction=a.style.touchAction;a.style.touchAction="none"}return h.prototype.destroy=function(){var a=this;this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(function(c){a._element.releasePointerCapture(c)});this._activePointerCaptures=null;this._element.style.touchAction=this._initialCssTouchAction},Object.defineProperty(h.prototype,"onEventReceived",{set:function(a){this._callback=a},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"activeEvents",
{set:function(a){var d=this,k;for(k in this._active)a&&a.has(k)||(this._element.removeEventListener(c[k],this._active[k]),delete this._active[k]);a&&a.forEach(function(a){if(!d._active[a]&&c[a]){var k=(d._eventHandlers[a]||d._handleDefault).bind(d,a);d._element.addEventListener(c[a],k);d._active[a]=k}})},enumerable:!0,configurable:!0}),h.prototype.setPointerCapture=function(a,c){c?(this._element.setPointerCapture(a.pointerId),this._activePointerCaptures.add(a.pointerId)):(this._element.releasePointerCapture(a.pointerId),
this._activePointerCaptures["delete"](a.pointerId))},h.prototype._updateNormalizedPointerLikeEvent=function(a,c){var d=this._element.getBoundingClientRect();return c.x=a.clientX-Math.round(d.left),c.y=a.clientY-Math.round(d.top),c},h.prototype._handleKey=function(a,c){var d=w.eventKey(c);d&&"key-up"===a&&this._keyDownState["delete"](d);c={"native":c,key:d,repeat:d&&this._keyDownState.has(d)};d&&"key-down"===a&&this._keyDownState.add(c.key);this._callback(a,c)},h.prototype._handlePointer=function(a,
c){c=this._updateNormalizedPointerLikeEvent(c,{"native":c,x:0,y:0});this._callback(a,c)},h.prototype._handlePointerPreventDefault=function(a,c){var d=this._updateNormalizedPointerLikeEvent(c,{"native":c,x:0,y:0});c.preventDefault();this._callback(a,d)},h.prototype._handleMouseWheel=function(c,h){h.preventDefault();var l=h.deltaY;switch(h.deltaMode){case 0:(d||u)&&(l=l/document.documentElement.clientHeight*600);break;case 1:l*=30;break;case 2:l*=900}d||u?l*=.7:r||k?l*=.6:a&&(l*=1.375);var q=Math.abs(l);
100<q&&(l=l/q*200/(1+Math.exp(-.02*(q-100))));h=this._updateNormalizedPointerLikeEvent(h,{"native":h,x:0,y:0,deltaY:l});this._callback(c,h)},h.prototype._handlePointerCaptureLost=function(a,c){this._activePointerCaptures["delete"](c.pointerId);this._handleDefault(a,c)},h.prototype._handleDefault=function(a,c){var d={"native":c};c.preventDefault();this._callback(a,d)},h}();p.BrowserEventSource=A;var c={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove",
"mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave"}})},"esri/core/libs/pep/pep":function(){define([],function(){function A(a,e){e=e||Object.create(null);var b=document.createEvent("Event");b.initEvent(a,e.bubbles||!1,e.cancelable||!1);for(var d=2;d<k.length;d++)a=k[d],b[a]=e[a]||c[d];b.buttons=e.buttons||0;a=0;return a=e.pressure?e.pressure:b.buttons?
.5:0,b.x=b.clientX,b.y=b.clientY,b.pointerId=e.pointerId||0,b.width=e.width||0,b.height=e.height||0,b.pressure=a,b.tiltX=e.tiltX||0,b.tiltY=e.tiltY||0,b.pointerType=e.pointerType||"",b.hwTimestamp=e.hwTimestamp||0,b.isPrimary=e.isPrimary||!1,b}function p(){this.array=[];this.size=0}function w(a,e,b,c){this.addCallback=a.bind(c);this.removeCallback=e.bind(c);this.changedCallback=b.bind(c);G&&(this.observer=new G(this.mutationWatcher.bind(this)))}function l(a){return"body /shadow-deep/ "+h(a)}function h(a){return'[touch-action\x3d"'+
a+'"]'}function d(a){return"{ -ms-touch-action: "+a+"; touch-action: "+a+"; touch-action-delay: none; }"}function u(){if(N){M.forEach(function(a){String(a)===a?(U+=h(a)+d(a)+"\n",W&&(U+=l(a)+d(a)+"\n")):(U+=a.selectors.map(h)+d(a.rule)+"\n",W&&(U+=a.selectors.map(l)+d(a.rule)+"\n"))});var a=document.createElement("style");a.textContent=U;document.head.appendChild(a)}}function r(a){if(!B.pointermap.has(a))throw a=Error("InvalidPointerId"),a.name="InvalidPointerId",a;}function a(a){if(!a.ownerDocument.contains(a))throw a=
Error("InvalidStateError"),a.name="InvalidStateError",a;}var k="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget pageX pageY".split(" "),c=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],t=window.Map&&window.Map.prototype.forEach?Map:p;p.prototype={set:function(a,e){return void 0===e?this["delete"](a):(this.has(a)||this.size++,void(this.array[a]=e))},has:function(a){return void 0!==this.array[a]},"delete":function(a){this.has(a)&&
(delete this.array[a],this.size--)},get:function(a){return this.array[a]},clear:function(){this.size=this.array.length=0},forEach:function(a,e){return this.array.forEach(function(b,c){a.call(e,b,c,this)},this)}};var C="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget buttons pointerId width height pressure tiltX tiltY pointerType hwTimestamp isPrimary type target currentTarget which pageX pageY timeStamp".split(" "),q=[!1,!1,null,
null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],v={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},y="undefined"!=typeof SVGElementInstance,B={pointermap:new t,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(a,e){var b=e.events;b&&(b.forEach(function(a){e[a]&&(this.eventMap[a]=e[a].bind(e))},this),this.eventSources[a]=e,this.eventSourceList.push(e))},register:function(a){for(var e,
b=this.eventSourceList.length,c=0;b>c&&(e=this.eventSourceList[c]);c++)e.register.call(e,a)},unregister:function(a){for(var e,b=this.eventSourceList.length,c=0;b>c&&(e=this.eventSourceList[c]);c++)e.unregister.call(e,a)},contains:function(a,e){try{return a.contains(e)}catch(ga){return!1}},down:function(a){a.bubbles=!0;this.fireEvent("pointerdown",a)},move:function(a){a.bubbles=!0;this.fireEvent("pointermove",a)},up:function(a){a.bubbles=!0;this.fireEvent("pointerup",a)},enter:function(a){a.bubbles=
!1;this.fireEvent("pointerenter",a)},leave:function(a){a.bubbles=!1;this.fireEvent("pointerleave",a)},over:function(a){a.bubbles=!0;this.fireEvent("pointerover",a)},out:function(a){a.bubbles=!0;this.fireEvent("pointerout",a)},cancel:function(a){a.bubbles=!0;this.fireEvent("pointercancel",a)},leaveOut:function(a){this.out(a);this.propagate(a,this.leave,!1)},enterOver:function(a){this.over(a);this.propagate(a,this.enter,!0)},eventHandler:function(a){if(!a._handledByPE){var e=a.type;(e=this.eventMap&&
this.eventMap[e])&&e(a);a._handledByPE=!0}},listen:function(a,e){e.forEach(function(e){this.addEvent(a,e)},this)},unlisten:function(a,e){e.forEach(function(e){this.removeEvent(a,e)},this)},addEvent:function(a,e){a.addEventListener(e,this.boundHandler)},removeEvent:function(a,e){a.removeEventListener(e,this.boundHandler)},makeEvent:function(a,e){this.captureInfo[e.pointerId]&&(e.relatedTarget=null);a=new A(a,e);return e.preventDefault&&(a.preventDefault=e.preventDefault),a._target=a._target||e.target,
a},fireEvent:function(a,e){a=this.makeEvent(a,e);return this.dispatchEvent(a)},cloneEvent:function(a){for(var e,b=Object.create(null),c=0;c<C.length;c++)e=C[c],b[e]=a[e]||q[c],!y||"target"!==e&&"relatedTarget"!==e||b[e]instanceof SVGElementInstance&&(b[e]=b[e].correspondingUseElement);return a.preventDefault&&(b.preventDefault=function(){a.preventDefault()}),b},getTarget:function(a){var e=this.captureInfo[a.pointerId];return e?a._target!==e&&a.type in v?void 0:e:a._target},propagate:function(a,e,
b){for(var c=a.target,d=[];!c.contains(a.relatedTarget)&&c!==document;)d.push(c),c=c.parentNode;b&&d.reverse();d.forEach(function(b){a.target=b;e.call(this,a)},this)},setCapture:function(a,e){this.captureInfo[a]&&this.releaseCapture(a);this.captureInfo[a]=e;var b=new A("gotpointercapture");b.pointerId=a;this.implicitRelease=this.releaseCapture.bind(this,a);document.addEventListener("pointerup",this.implicitRelease);document.addEventListener("pointercancel",this.implicitRelease);b._target=e;this.asyncDispatchEvent(b)},
releaseCapture:function(a){var e=this.captureInfo[a];if(e){var b=new A("lostpointercapture");b.pointerId=a;this.captureInfo[a]=void 0;document.removeEventListener("pointerup",this.implicitRelease);document.removeEventListener("pointercancel",this.implicitRelease);b._target=e;this.asyncDispatchEvent(b)}},dispatchEvent:function(a){var e=this.getTarget(a);return e?e.dispatchEvent(a):void 0},asyncDispatchEvent:function(a){requestAnimationFrame(this.dispatchEvent.bind(this,a))}};B.boundHandler=B.eventHandler.bind(B);
var D={shadow:function(a){return a?a.shadowRoot||a.webkitShadowRoot:void 0},canTarget:function(a){return a&&!!a.elementFromPoint},targetingShadow:function(a){a=this.shadow(a);return this.canTarget(a)?a:void 0},olderShadow:function(a){var e=a.olderShadowRoot;e||(a=a.querySelector("shadow"))&&(e=a.olderShadowRoot);return e},allShadows:function(a){var e=[];for(a=this.shadow(a);a;)e.push(a),a=this.olderShadow(a);return e},searchRoot:function(a,e,b){if(a){var c,d=a.elementFromPoint(e,b);for(c=this.targetingShadow(d);c;){if(a=
c.elementFromPoint(e,b))return c=this.targetingShadow(a),this.searchRoot(c,e,b)||a;c=this.olderShadow(c)}return d}},owner:function(a){for(;a.parentNode;)a=a.parentNode;return a.nodeType!==Node.DOCUMENT_NODE&&a.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(a=document),a},findTarget:function(a){var e=a.clientX,b=a.clientY;a=this.owner(a.target);return a.elementFromPoint(e,b)||(a=document),this.searchRoot(a,e,b)}},b=Array.prototype.forEach.call.bind(Array.prototype.forEach),m=Array.prototype.map.call.bind(Array.prototype.map),
E=Array.prototype.slice.call.bind(Array.prototype.slice),J=Array.prototype.filter.call.bind(Array.prototype.filter),G=window.MutationObserver||window.WebKitMutationObserver,K={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};w.prototype={watchSubtree:function(a){this.observer&&D.canTarget(a)&&this.observer.observe(a,K)},enableOnSubtree:function(a){this.watchSubtree(a);a===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(a)},
installNewSubtree:function(a){b(this.findElements(a),this.addElement,this)},findElements:function(a){return a.querySelectorAll?a.querySelectorAll("[touch-action]"):[]},removeElement:function(a){this.removeCallback(a)},addElement:function(a){this.addCallback(a)},elementChanged:function(a,e){this.changedCallback(a,e)},concatLists:function(a,e){return a.concat(E(e))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document)}.bind(this))},
isElement:function(a){return a.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(a){var e=m(a,this.findElements,this);return e.push(J(a,this.isElement)),e.reduce(this.concatLists,[])},mutationWatcher:function(a){a.forEach(this.mutationHandler,this)},mutationHandler:function(a){"childList"===a.type?(this.flattenMutationTree(a.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(a.removedNodes).forEach(this.removeElement,this)):"attributes"===a.type&&this.elementChanged(a.target,
a.oldValue)}};var M=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],U="",N=window.PointerEvent||window.MSPointerEvent,W=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,R=B.pointermap,V=[1,4,2,8,16],Q=!1;try{Q=1===(new MouseEvent("test",{buttons:1})).buttons}catch(Y){}var S,X={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(a){B.listen(a,this.events)},unregister:function(a){B.unlisten(a,
this.events)},lastTouches:[],isEventSimulatedFromTouch:function(a){var e,b=this.lastTouches,c=a.clientX;a=a.clientY;for(var d=0,f=b.length;f>d&&(e=b[d]);d++){var g=Math.abs(a-e.y);if(25>=Math.abs(c-e.x)&&25>=g)return!0}},prepareEvent:function(a){var e=B.cloneEvent(a),b=e.preventDefault;return e.preventDefault=function(){a.preventDefault();b()},e.pointerId=this.POINTER_ID,e.isPrimary=!0,e.pointerType=this.POINTER_TYPE,e},prepareButtonsForMove:function(a,e){var b=R.get(this.POINTER_ID);0!==e.which&&
b?a.buttons=b.buttons:a.buttons=0;e.buttons=a.buttons},mousedown:function(a){if(!this.isEventSimulatedFromTouch(a)){var e=R.get(this.POINTER_ID),b=this.prepareEvent(a);Q||(b.buttons=V[b.button],e&&(b.buttons|=e.buttons),a.buttons=b.buttons);R.set(this.POINTER_ID,a);e&&0!==e.buttons?B.move(b):B.down(b)}},mousemove:function(a){if(!this.isEventSimulatedFromTouch(a)){var e=this.prepareEvent(a);Q||this.prepareButtonsForMove(e,a);e.button=-1;R.set(this.POINTER_ID,a);B.move(e)}},mouseup:function(a){if(!this.isEventSimulatedFromTouch(a)){var e=
R.get(this.POINTER_ID),b=this.prepareEvent(a);if(!Q){var c=V[b.button];b.buttons=e?e.buttons&~c:0;a.buttons=b.buttons}R.set(this.POINTER_ID,a);b.buttons&=~V[b.button];0===b.buttons?B.up(b):B.move(b)}},mouseover:function(a){if(!this.isEventSimulatedFromTouch(a)){var e=this.prepareEvent(a);Q||this.prepareButtonsForMove(e,a);e.button=-1;R.set(this.POINTER_ID,a);B.enterOver(e)}},mouseout:function(a){if(!this.isEventSimulatedFromTouch(a)){var e=this.prepareEvent(a);Q||this.prepareButtonsForMove(e,a);e.button=
-1;B.leaveOut(e)}},cancel:function(a){a=this.prepareEvent(a);B.cancel(a);this.deactivateMouse()},deactivateMouse:function(){R["delete"](this.POINTER_ID)}},z=B.captureInfo,Z=D.findTarget.bind(D),O=D.allShadows.bind(D),g=B.pointermap,e={events:["touchstart","touchmove","touchend","touchcancel"],register:function(a){S.enableOnSubtree(a)},unregister:function(a){},elementAdded:function(a){var e=a.getAttribute("touch-action"),b=this.touchActionToScrollType(e);b&&(a._scrollType=b,B.listen(a,this.events),
O(a).forEach(function(a){a._scrollType=b;B.listen(a,this.events)},this))},elementRemoved:function(a){a._scrollType=void 0;B.unlisten(a,this.events);O(a).forEach(function(a){a._scrollType=void 0;B.unlisten(a,this.events)},this)},elementChanged:function(a,e){var b=a.getAttribute("touch-action"),c=this.touchActionToScrollType(b);e=this.touchActionToScrollType(e);c&&e?(a._scrollType=c,O(a).forEach(function(a){a._scrollType=c},this)):e?this.elementRemoved(a):c&&this.elementAdded(a)},scrollTypes:{EMITTER:"none",
XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(a){var e=this.scrollTypes;return"none"===a?"none":a===e.XSCROLLER?"X":a===e.YSCROLLER?"Y":e.SCROLLER.exec(a)?"XY":void 0},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){(0===g.size||1===g.size&&g.has(1))&&(this.firstTouch=a.identifier,this.firstXY={X:a.clientX,Y:a.clientY},this.scrolling=!1,this.cancelResetClickCount())},
removePrimaryPointer:function(a){a.isPrimary&&(this.firstTouch=null,this.firstXY=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var a=function(){this.clickCount=0;this.resetId=null}.bind(this);this.resetId=setTimeout(a,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(a){var e=0;return("touchstart"===a||"touchmove"===a)&&(e=1),e},touchToPointer:function(a){var e=this.currentTouchEvent,b=B.cloneEvent(a),c=b.pointerId=
a.identifier+2;b.target=z[c]||Z(b);b.bubbles=!0;b.cancelable=!0;b.detail=this.clickCount;b.button=0;b.buttons=this.typeToButtons(e.type);b.width=a.radiusX||a.webkitRadiusX||0;b.height=a.radiusY||a.webkitRadiusY||0;b.pressure=a.force||a.webkitForce||.5;b.isPrimary=this.isPrimaryTouch(a);b.pointerType=this.POINTER_TYPE;b.altKey=e.altKey;b.ctrlKey=e.ctrlKey;b.metaKey=e.metaKey;b.shiftKey=e.shiftKey;var d=this;return b.preventDefault=function(){d.scrolling=!1;d.firstXY=null;e.preventDefault()},b},processTouches:function(a,
e){var b=a.changedTouches;this.currentTouchEvent=a;for(var c=0;c<b.length;c++)a=b[c],e.call(this,this.touchToPointer(a))},shouldScroll:function(a){if(this.firstXY){var e;e=a.currentTarget._scrollType;if("none"===e)e=!1;else if("XY"===e)e=!0;else{a=a.changedTouches[0];var b="Y"===e?"X":"Y";e=Math.abs(a["client"+e]-this.firstXY[e])>=Math.abs(a["client"+b]-this.firstXY[b])}return this.firstXY=null,e}},findTouch:function(a,e){for(var b,c=0,d=a.length;d>c&&(b=a[c]);c++)if(b.identifier===e)return!0},vacuumTouches:function(a){var e=
a.touches;if(g.size>=e.length){var b=[];g.forEach(function(a,c){1===c||this.findTouch(e,c-2)||b.push(a.out)},this);b.forEach(this.cancelOut,this)}},touchstart:function(a){this.vacuumTouches(a);this.setPrimaryTouch(a.changedTouches[0]);this.dedupSynthMouse(a);this.scrolling||(this.clickCount++,this.processTouches(a,this.overDown))},overDown:function(a){g.set(a.pointerId,{target:a.target,out:a,outTarget:a.target});B.enterOver(a);B.down(a)},touchmove:function(a){this.scrolling||(this.shouldScroll(a)?
(this.scrolling=!0,this.touchcancel(a)):(a.preventDefault(),this.processTouches(a,this.moveOverOut)))},moveOverOut:function(a){var e=g.get(a.pointerId);if(e){var b=e.out,c=e.outTarget;B.move(a);b&&c!==a.target&&(b.relatedTarget=a.target,a.relatedTarget=c,b.target=c,a.target?(B.leaveOut(b),B.enterOver(a)):(a.target=c,a.relatedTarget=null,this.cancelOut(a)));e.out=a;e.outTarget=a.target}},touchend:function(a){this.dedupSynthMouse(a);this.processTouches(a,this.upOut)},upOut:function(a){this.scrolling||
(B.up(a),B.leaveOut(a));this.cleanUpPointer(a)},touchcancel:function(a){this.processTouches(a,this.cancelOut)},cancelOut:function(a){B.cancel(a);B.leaveOut(a);this.cleanUpPointer(a)},cleanUpPointer:function(a){g["delete"](a.pointerId);this.removePrimaryPointer(a)},dedupSynthMouse:function(a){var e=X.lastTouches;a=a.changedTouches[0];this.isPrimaryTouch(a)&&(a={x:a.clientX,y:a.clientY},e.push(a),e=function(a,e){e=a.indexOf(e);-1<e&&a.splice(e,1)}.bind(null,e,a),setTimeout(e,2500))}};S=new w(e.elementAdded,
e.elementRemoved,e.elementChanged,e);var f,n,x=B.pointermap,I=window.MSPointerEvent&&"number"==typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,L={events:"MSPointerDown MSPointerMove MSPointerUp MSPointerOut MSPointerOver MSPointerCancel MSGotPointerCapture MSLostPointerCapture".split(" "),register:function(a){B.listen(a,this.events)},unregister:function(a){B.unlisten(a,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(a){var e=a;return I&&(e=B.cloneEvent(a),
e.pointerType=this.POINTER_TYPES[a.pointerType]),e},cleanup:function(a){x["delete"](a)},MSPointerDown:function(a){x.set(a.pointerId,a);a=this.prepareEvent(a);B.down(a)},MSPointerMove:function(a){a=this.prepareEvent(a);B.move(a)},MSPointerUp:function(a){var e=this.prepareEvent(a);B.up(e);this.cleanup(a.pointerId)},MSPointerOut:function(a){a=this.prepareEvent(a);B.leaveOut(a)},MSPointerOver:function(a){a=this.prepareEvent(a);B.enterOver(a)},MSPointerCancel:function(a){var e=this.prepareEvent(a);B.cancel(e);
this.cleanup(a.pointerId)},MSLostPointerCapture:function(a){a=B.makeEvent("lostpointercapture",a);B.dispatchEvent(a)},MSGotPointerCapture:function(a){a=B.makeEvent("gotpointercapture",a);B.dispatchEvent(a)}};window.navigator.msPointerEnabled?(f=function(e){r(e);a(this);0!==B.pointermap.get(e).buttons&&this.msSetPointerCapture(e)},n=function(a){r(a);this.msReleasePointerCapture(a)}):(f=function(e){r(e);a(this);0!==B.pointermap.get(e).buttons&&B.setCapture(e,this)},n=function(a){r(a);B.releaseCapture(a,
this)});var P=window.PointerEvent||window.MSPointerEvent;return{dispatcher:B,Installer:w,PointerEvent:A,PointerMap:t,targetFinding:D,applyGlobal:function(){u();window.PointerEvent||((window.PointerEvent=A,window.navigator.msPointerEnabled)?(Object.defineProperty(window.navigator,"maxTouchPoints",{value:window.navigator.msMaxTouchPoints,enumerable:!0}),B.registerSource("ms",L)):(B.registerSource("mouse",X),void 0!==window.ontouchstart&&B.registerSource("touch",e)),B.register(document));window.Element&&
!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:f},releasePointerCapture:{value:n}})},applyLocal:function(a){P||(window.PointerEvent||(window.navigator.msPointerEnabled?B.registerSource("ms",L):(B.registerSource("mouse",X),void 0!==window.ontouchstart&&B.registerSource("touch",e)),B.register(document)),window.Element&&!Element.prototype.setPointerCapture&&(a.setPointerCapture=f.bind(a),a.releasePointerCapture=n.bind(a)),a.getAttribute("touch-action")||
a.setAttribute("touch-action","none"))}}})},"esri/views/input/ViewEvents":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./InputHandler","../../geometry/ScreenPoint"],function(A,p,w,l,h){function d(c){return!!a[c]}function u(a){for(var c=0;c<a.length;c++)if(!d(a[c]))return!1;return!0}Object.defineProperty(p,"__esModule",{value:!0});var r,a={click:!0,"double-click":!0,hold:!0,drag:!0,"key-down":!0,"key-up":!0,"pointer-down":!0,"pointer-move":!0,"pointer-up":!0,"mouse-wheel":!0,
"pointer-enter":!0,"pointer-leave":!0};!function(a){a[a.Left=0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right"}(r||(r={}));A=function(){function a(a){this.handlers=new Map;this.counter=0;this.view=a;this.inputManager=null}return a.prototype.connect=function(a){var c=this;a&&this.disconnect();this.inputManager=a;this.handlers.forEach(function(a,d){return c.inputManager.installHandlers(d,[a])})},a.prototype.disconnect=function(){var a=this;this.inputManager&&this.handlers.forEach(function(c,d){return a.inputManager.uninstallHandlers(d)});
this.inputManager=null},a.prototype.destroy=function(){this.disconnect();this.handlers.clear();this.view=null},a.prototype.register=function(a,c,h){var l=this;a=Array.isArray(a)?a:a.split(",");if(!u(a))return a.some(d)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;var q=Array.isArray(c)?c:[];h=Array.isArray(c)?h:c;var t=this.createUniqueGroupName();c=new k(this.view,a,q,h);return this.handlers.set(t,c),this.inputManager&&this.inputManager.installHandlers(t,
[c]),{remove:function(){return l.removeHandler(t)}}},a.prototype.removeHandler=function(a){this.handlers.has(a)&&this.handlers["delete"](a);this.inputManager&&this.inputManager.uninstallHandlers(a)},a.prototype.createUniqueGroupName=function(){return this.counter+=1,"viewEvents_"+this.counter},a}();p.ViewEvents=A;var k=function(a){function c(c,d,k,h){var l=a.call(this,!0)||this;l.view=c;for(c=0;c<d.length;c++)switch(d[c]){case "click":l.registerIncoming("click",k,function(a){return h(l.wrapClick(a))});
break;case "double-click":l.registerIncoming("double-click",k,function(a){return h(l.wrapDoubleClick(a))});break;case "hold":l.registerIncoming("hold",k,function(a){return h(l.wrapHold(a))});break;case "drag":l.registerIncoming("drag",k,function(a){return h(l.wrapDrag(a))});break;case "key-down":l.registerIncoming("key-down",k,function(a){return h(l.wrapKeyDown(a))});break;case "key-up":l.registerIncoming("key-up",k,function(a){return h(l.wrapKeyUp(a))});break;case "pointer-down":l.registerIncoming("pointer-down",
k,function(a){return h(l.wrapPointer(a,"pointer-down"))});break;case "pointer-move":l.registerIncoming("pointer-move",k,function(a){return h(l.wrapPointer(a,"pointer-move"))});break;case "pointer-up":l.registerIncoming("pointer-up",k,function(a){return h(l.wrapPointer(a,"pointer-up"))});break;case "mouse-wheel":l.registerIncoming("mouse-wheel",k,function(a){return h(l.wrapMouseWheel(a))});break;case "pointer-enter":l.registerIncoming("pointer-enter",k,function(a){return h(l.wrapPointer(a,"pointer-enter"))});
break;case "pointer-leave":l.registerIncoming("pointer-leave",k,function(a){return h(l.wrapPointer(a,"pointer-leave"))})}return l}return w(c,a),c.prototype.wrapClick=function(a){var c=a.data.x,d=a.data.y;return{type:"click",button:"touch"===a.data["native"].pointerType?0:a.data["native"].button,x:c,y:d,"native":a.data["native"],timestamp:a.timestamp,screenPoint:new h(c,d),mapPoint:this.view.toMap(c,d),stopPropagation:function(){return a.stopPropagation()}}},c.prototype.wrapDoubleClick=function(a){var c=
a.data.x,d=a.data.y;return{type:"double-click",button:"touch"===a.data["native"].pointerType?0:a.data["native"].button,x:c,y:d,"native":a.data["native"],timestamp:a.timestamp,mapPoint:this.view.toMap(c,d),stopPropagation:function(){return a.stopPropagation()}}},c.prototype.wrapHold=function(a){var c=a.data.x,d=a.data.y;return{type:"hold",button:"touch"===a.data["native"].pointerType?0:a.data["native"].button,x:c,y:d,"native":a.data["native"],timestamp:a.timestamp,mapPoint:this.view.toMap(c,d),stopPropagation:function(){return a.stopPropagation()}}},
c.prototype.wrapDrag=function(a){return{type:"drag",action:a.data.action,x:a.data.currentState.center.x,y:a.data.currentState.center.y,origin:{x:a.data.startState.center.x,y:a.data.startState.center.y},"native":a.data.pointers[0].currentEvent["native"],timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}},c.prototype.wrapKeyDown=function(a){return{type:"key-down",key:a.data.key,repeat:a.data.repeat,"native":a.data["native"],timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}},
c.prototype.wrapKeyUp=function(a){return{type:"key-up",key:a.data.key,"native":a.data["native"],timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}},c.prototype.wrapPointer=function(a,c){return{type:c,x:a.data.x,y:a.data.y,pointerId:a.data["native"].pointerId,pointerType:a.data["native"].pointerType,"native":a.data["native"],timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}},c.prototype.wrapMouseWheel=function(a){return{type:"mouse-wheel",x:a.data.x,
y:a.data.y,deltaY:a.data.deltaY,"native":a.data["native"],timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}},c}(l.InputHandler)})},"esri/views/input/handlers/PreventContextMenu":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(A,p,w,l){Object.defineProperty(p,"__esModule",{value:!0});A=function(h){function d(){var d=h.call(this,!0)||this;return d.registerIncoming("context-menu",function(d){d.data["native"].preventDefault()}),
d}return w(d,h),d}(l.InputHandler);p.PreventContextMenu=A;p["default"]=A})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../input/InputHandler ../../../input/handlers/support ../../state/helpers/PickingHelper ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController".split(" "),function(A,p,w,l,h,d,u,r){Object.defineProperty(p,"__esModule",{value:!0});A=function(a){function k(c,
k){var h=a.call(this,!0)||this;return h.view=c,h.pickingHelper=new d.PickingHelper(c),h.registerIncoming("double-click",k,function(a){return h.handleDoubleClick(a)}),h}return w(k,a),k.prototype.handleDoubleClick=function(a){var c=a.data;if(h.eventMatchesPointerType(c["native"],"primary")){var d=this.view.state.isGlobal?new u.ZoomStepController(this.view,this.pickingHelper,"animation"):new r.ZoomStepController(this.view,this.pickingHelper,"animation");this.view.state.switchCameraController(d);d.zoomStep(Math.log(.5)/
Math.log(.6),[c.x,this.view.height-c.y]);a.stopPropagation()}},k}(l.InputHandler);p.DoubleClickZoom=A})},"esri/views/input/handlers/support":function(){define(["require","exports"],function(A,p){Object.defineProperty(p,"__esModule",{value:!0});p.eventMatchesPointerType=function(p,l){switch(l){case "primary":return"touch"===p.pointerType||0===p.button;case "secondary":return"touch"!==p.pointerType&&2===p.button;case "tertiary":return"touch"!==p.pointerType&&1===p.button}};p.eventMatchesMousePointerType=
function(p,l){if("touch"===p.pointerType)return!1;switch(l){case "primary":return 0===p.button;case "secondary":return 2===p.button;case "tertiary":return 1===p.button}}})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../PointToPointAnimationController ../../../camera/constraintUtils ../../../lib/glMatrix ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),
function(A,p,w,l,h,d,u,r,a){Object.defineProperty(p,"__esModule",{value:!0});A=function(k){function c(a,c,h){c=k.call(this,a.state,c,"interaction"===h?null:void 0)||this;return c.view=a,c.mode=h,c.zoomLocation=d.vec3d.create(),c.tmpCamera=new r,c.panAxis=d.vec3d.create(),c.tmpViewDir=d.vec3d.create(),c.targetOnSphere=d.vec3d.create(),c.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new r,interactionDirection:null},c.sphere={center:d.vec3d.create(),radius:0},
c}return w(c,k),Object.defineProperty(c.prototype,"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0}),c.prototype.zoomStep=function(a,c){if(this.active){var k=this.view.state,h=this.constraintOptions.interactionStartCamera;this.animation.finished?h.copyFrom(k.camera):this.animation.cameraAt(1,h);h=!1;0<a&&this.pickingHelper.pickPointInScreen(c,this.zoomLocation)&&(h=!0);this.tmpCamera.copyFrom(k.camera);h||(this.pickingHelper.pickRaySegment(this.tmpCamera.eye,
this.tmpCamera.center,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:d.vec3d.set(this.tmpCamera.center,this.zoomLocation));this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,c);this.begin(this.tmpCamera)}},c.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:a.outExpo}},c.prototype.updateCamera=function(a,c,k,l){this.sphere.radius=d.vec3d.length(k);d.vec3d.subtract(a.center,a.eye,this.tmpViewDir);var q=d.vec3d.length(this.tmpViewDir),t=q*c;if(1>=
c&&4>t&&(t=4,c=t/q),!(1E-6>Math.abs(q-t))){q=d.vec3d.length(a.center);this.sphere.radius!==q&&d.vec3d.scale(a.center,(this.sphere.radius+c*(q-this.sphere.radius))/q);if(d.vec3d.scale(this.tmpViewDir,-c),d.vec3d.add(a.center,this.tmpViewDir,a.eye),h.applyAll(this.view,a,this.constraintOptions),1E-12<d.vec3d.dist2(k,a.center)&&u.intersectSphereFromScreenPoint(this.sphere,a,l,this.targetOnSphere))c=u.rotationAndAxisFromPoints(k,this.targetOnSphere,this.panAxis),u.applyRotation(a,this.sphere.center,this.panAxis,
c);h.applySurfaceCollision(this.view,a)}},c}(l.PointToPointAnimationController);p.ZoomStepController=A})},"esri/views/3d/state/utils/navigationUtils":function(){define(["require","exports","../../lib/glMatrix","./primitiveIntersectionUtils","../../support/mathUtils"],function(A,p,w,l,h){function d(a,b,c,d,h){void 0===h&&(h=!1);var m=G;return l.createRay(b,c,m,h),l.intersectSphere(a,m,d)?!0:(k(a,m,d),!1)}function u(a,b,c,d){var k=G;return l.createRay(b,c,k,!0),l.intersectSphere(a,k,d)}function r(a,
b,c){w.vec3d.cross(a,b,c);a=w.vec3d.dot(a,b)/(w.vec3d.length(a)*w.vec3d.length(b));return-h.acos(a)}function a(a,b,c,d){var k=D;w.mat4d.identity(k);w.mat4d.rotate(k,d,c);w.vec3d.subtract(a.eye,b);w.mat4d.multiplyVec3(k,a.eye,a.eye);w.vec3d.add(a.eye,b);w.vec3d.subtract(a.center,b);w.mat4d.multiplyVec3(k,a.center,a.center);w.vec3d.add(a.center,b);w.mat4d.multiplyVec3(k,a.up,a.up);a.markViewDirty()}function k(a,b,c){var d=m,k=E,l=B;w.vec3d.subtract(b.origin,a.center,k);w.vec3d.cross(k,b.direction,d);
w.vec3d.cross(d,k,c);w.vec3d.scale(c,1/w.vec3d.length(c)*a.radius);a=-h.asin(a.radius/w.vec3d.length(b.origin));w.mat4d.identity(l);w.mat4d.rotate(l,a,d);w.mat4d.multiplyVec3(l,c)}function c(a,b){w.vec3d.set3(0,0,0,b);for(var c=0;c<a.length;c++)w.vec3d.add(b,a[c]);w.vec3d.scale(b,1/a.length)}Object.defineProperty(p,"__esModule",{value:!0});p.Earth={center:w.vec3d.create(),radius:6378137};p.normalizeCoordinate=function(a,b,c){return c[0]=b[0]/a.width,c[1]=b[1]/a.height,c};p.sphereOrSilhouettePointFromScreenPoint=
d;p.intersectSphereFromScreenPoint=u;p.rotationAndAxisFromPoints=r;p.rotationFromPointsAroundAxis=function(a,b,c){var d=m,k=E,h=J;w.vec3d.set(a,k);w.vec3d.set(b,h);a=w.vec3d.dot(k,c);b=w.vec3d.dot(h,c);w.vec3d.scale(c,a,d);w.vec3d.subtract(k,d);w.vec3d.normalize(k);w.vec3d.scale(c,b,d);w.vec3d.subtract(h,d);w.vec3d.normalize(h);a=w.vec3d.dot(k,h);w.vec3d.cross(c,k,d);c=w.vec3d.dot(h,d);return Math.atan2(c,a)};p.setPlane=function(a,b,c){w.vec3d.set(b,c.normal);c.d=-w.vec3d.dot(b,a)};p.setPlaneD=function(a,
b){b.d=-w.vec3d.dot(b.normal,a)};p.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;return a};p.applyRotation=a;p.closestPointOnSphereSilhouette=k;p.intersectPlaneFromScreenPoint=function(a,b,c,d){var k=G;return l.createRay(b,c,k),l.intersectPlane(a,k,d)};p.applyZoomToPoint=function(a,c,d,k){var h=b;d=1-d;w.vec3d.subtract(c,a.eye,h);var m=w.vec3d.length(h),l=m*(1-d);0<=d&&k>l&&(l=k,d=-(l-m)/m);1E-6>Math.abs(m-l)||(w.vec3d.scale(h,d),w.vec3d.add(a.eye,h),
w.vec3d.lerp(a.center,c,d))};p.applyZoomOnSphere=function(a,c,d){w.vec2d.set2(c.width/2,c.height/2,t);u(a,c,t,c.center);w.vec3d.subtract(c.center,c.eye,b);a=w.vec3d.length(b);1E-6>Math.abs(a-a*d)||(w.vec3d.scale(b,d),w.vec3d.subtract(c.center,b,c.eye),c.markViewDirty())};var t=w.vec2d.create();p.navPointToScreenPoint=function(a,b,c){w.vec2d.set2(b.x,a.height-b.y,c)};p.centroidOnSphere=function(a,b,d){c(b,d);w.vec3d.normalize(d);w.vec3d.scale(d,a)};p.centroid=c;var C;!function(a){a[a.Vertical=0]="Vertical";
a[a.Horizontal=1]="Horizontal"}(C=p.PanMode||(p.PanMode={}));p.VerticalPanTresholds={Elevation:3E4,Angle:8/180*Math.PI};p.pickPointAndInitSphere=function(a,b,c,k){var h=w.vec3d.create(),m={center:w.vec3d.create(),radius:0},l=!0;return a.pickPointInScreen(c,h)?m.radius=w.vec3d.length(h):(m.radius=w.vec3d.length(b.center),m.radius<.9*p.Earth.radius&&(m.radius=p.Earth.radius),m.radius=Math.max(w.vec3d.length(b.center),.9*p.Earth.radius),k?d(m,b,c,h):l=u(m,b,c,h)),{sphere:m,scenePickPoint:l?h:null}};
p.decidePanMode=function(a,b,c){if(w.vec3d.length(a.eye)-p.Earth.radius<p.VerticalPanTresholds.Elevation){if(b.radius>w.vec3d.length(a.eye))return C.Vertical;w.vec3d.normalize(w.vec3d.subtract(a.eye,c,q));return Math.abs(.5*Math.PI-Math.acos(w.vec3d.dot(c,q)/w.vec3d.length(c)))<p.VerticalPanTresholds.Angle?C.Vertical:C.Horizontal}return C.Horizontal};var q=w.vec3d.create();p.applyPanPlanar=function(a,b,c,d){w.vec3d.subtract(c,b,v);w.vec3d.subtract(a.eye,v);w.vec3d.subtract(a.center,v);a.markViewDirty();
d&&d.estimator.addPanValue(d.time,d.endScreenPoint,c,v)};var v=w.vec3d.create();p.applyPanSpherical=function(b,c,d,k,h){d=r(d,k,y);a(c,b.center,y,d);h&&h.estimator.addPanValue(h.time,h.endScreenPoint,k,y)};var y=w.vec3d.create(),B=w.mat4d.create(),D=w.mat4d.create(),b=w.vec3d.create(),m=w.vec3d.create(),E=w.vec3d.create(),J=w.vec3d.create(),G={origin:w.vec3d.create(),direction:w.vec3d.create()}})},"esri/views/3d/state/utils/primitiveIntersectionUtils":function(){define(["require","exports","../../lib/glMatrix"],
function(A,p,w){Object.defineProperty(p,"__esModule",{value:!0});p.createRay=function(d,h,r,a){void 0===a&&(a=!1);w.vec3d.set3(h[0],h[1],0,l);a?w.vec3d.set(d.eye,r.origin):w.vec3d.unproject(l,d.viewMatrix,d.projectionMatrix,d.fullViewport,r.origin);l[2]=1;w.vec3d.unproject(l,d.viewMatrix,d.projectionMatrix,d.fullViewport,r.direction);w.vec3d.subtract(r.direction,r.origin,r.direction);w.vec3d.normalize(r.direction)};p.intersectSphere=function(d,l,r){var a=w.vec3d.subtract(l.origin,d.center,h),k=w.vec3d.dot(l.direction,
l.direction),c=2*w.vec3d.dot(l.direction,a);d=w.vec3d.dot(a,a)-d.radius*d.radius;d=c*c-4*k*d;if(0>d)return!1;a=Math.sqrt(d);d=(-c-a)/(2*k);k=(-c+a)/(2*k);return(0>d||d>k&&0<k)&&(d=k),0<d?(w.vec3d.add(l.origin,w.vec3d.scale(l.direction,d,r),r),!0):!1};p.intersectPlane=function(d,h,l){var a=w.vec3d.dot(d.normal,h.direction);if(0===a)return!1;d=-(w.vec3d.dot(d.normal,h.origin)+d.d)/a;return 0>d?!1:(w.vec3d.add(h.origin,w.vec3d.scale(h.direction,d,l),l),!0)};var l=w.vec3d.create(),h=w.vec3d.create()})},
"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../PointToPointAnimationController ../../../camera/constraintUtils ../../../lib/glMatrix ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),function(A,p,w,l,h,d,u,r){Object.defineProperty(p,"__esModule",{value:!0});A=function(a){function k(c,k,h){k=a.call(this,c.state,k,"interaction"===h?null:void 0)||this;return k.view=c,k.mode=h,k.zoomLocation=
d.vec3d.create(),k.tmpCamera=new u,k.tmpRayDir=d.vec3d.create(),k.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new u,interactionDirection:null},k}return w(k,a),Object.defineProperty(k.prototype,"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0}),k.prototype.zoomStep=function(a,k){if(this.active){var c=this.view.state,h=this.constraintOptions.interactionStartCamera;this.animation.finished?h.copyFrom(c.camera):
this.animation.cameraAt(1,h);this.tmpCamera.copyFrom(c.camera);0<a?this.pickingHelper.pickPointInScreen(k,this.zoomLocation)||this.pickingHelper.pickFreePointInScreen(k,this.zoomLocation):this.pickingHelper.pickRaySegment(this.tmpCamera.eye,this.tmpCamera.center,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:d.vec3d.set(this.tmpCamera.center,this.zoomLocation);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,k);this.begin(this.tmpCamera)}},k.prototype.animationSettings=
function(){return{apex:null,duration:.6,easing:r.outExpo}},k.prototype.updateCamera=function(a,k,l,q){d.vec3d.subtract(l,a.eye,this.tmpRayDir);q=d.vec3d.length(this.tmpRayDir);var c=q*k;1>=k&&4>c&&(c=4,k=c/q);1E-6>Math.abs(q-c)||(d.vec3d.scale(this.tmpRayDir,k),d.vec3d.subtract(l,this.tmpRayDir,a.eye),d.vec3d.lerp(a.center,l,1-k),h.applyAll(this.view,this.tmpCamera,this.constraintOptions))},k}(l.PointToPointAnimationController);p.ZoomStepController=A})},"esri/views/3d/input/handlers/DragRotate":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../input/InputHandler ../../../input/handlers/support ../../state/controllers/RotateController ../../state/helpers/PickingHelper".split(" "),
function(A,p,w,l,h,d,u){Object.defineProperty(p,"__esModule",{value:!0});A=function(l){function a(a,c,d,h){var k=l.call(this,!0)||this;return k.view=a,k.pointerType=c,k.pivotPoint=d,k.pickingHelper=new u.PickingHelper(a),k.registerIncoming("drag",h,function(a){return k.handleDrag(a)}),k}return w(a,l),a.prototype.handleDrag=function(a){var c=a.data;if(!(1<c.pointers.length)){var k=c.pointers[0];if(h.eventMatchesMousePointerType(k.startEvent["native"],this.pointerType)){k=[k.currentEvent.x,this.view.height-
k.currentEvent.y];switch(c.action){case "start":this.cameraController=new d.RotateController(this.view,this.pickingHelper,this.pivotPoint);this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(k);break;case "update":this.cameraController.update(k);break;case "end":this.cameraController.end(),this.cameraController=null}a.stopPropagation()}}},a}(l.InputHandler);p.DragRotate=A})},"esri/views/3d/state/controllers/RotateController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../camera/constraintUtils ./InteractiveController ../../lib/glMatrix ../../support/mathUtils ../../state/utils/navigationUtils ../../state/Constraints".split(" "),
function(A,p,w,l,h,d,u,r,a){Object.defineProperty(p,"__esModule",{value:!0});A=function(k){function c(a,c,h){var l=k.call(this)||this;return l.view=a,l.pickingHelper=c,l.pivot=h,l.lastPoint=d.vec2d.create(),l.tmpWorldUp=d.vec3d.create(),l.tmpViewDir=d.vec3d.create(),l.tmpRotCurPoint=d.vec2d.create(),l.tmpTransf=d.mat4d.create(),l.tmpAxis=d.vec3d.create(),l.pivotPos=d.vec3d.create(),l.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,interactionDirection:null},
l.rotScale="center"===h?3:1.5,l}return w(c,k),c.prototype.begin=function(a){if(this.active){switch(this.pivot){case "eye":d.vec3d.set(this.beginCamera.eye,this.pivotPos);this.constraintOptions.interactionType=3;this.constraintOptions.selection=0;break;case "center":this.pickingHelper.pickRaySegment(this.beginCamera.eye,this.beginCamera.center,this.pivotPos)||(this.view.state.isLocal?this.pickingHelper.pickFreePointFromSegment(this.beginCamera.eye,this.beginCamera.center,this.pivotPos):d.vec3d.set(this.beginCamera.center,
this.pivotPos)),this.beginCamera.center=this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera;r.normalizeCoordinate(this.beginCamera,a,this.lastPoint)}},c.prototype.update=function(a){if(this.active){var c;switch(this.pivot){case "eye":c=this.currentCamera.center;break;case "center":this.currentCamera.center=this.pivotPos,c=this.currentCamera.eye}this.applyRotation(this.currentCamera,a,c,this.pivotPos);
l.applyAll(this.view,this.currentCamera,this.constraintOptions)}},c.prototype.end=function(){this.active&&this.finishController()},c.prototype.applyRotation=function(c,k,h,l){this.view.renderCoordsHelper.worldUpAtPosition(l,this.tmpWorldUp);r.normalizeCoordinate(c,k,this.tmpRotCurPoint);k=(this.tmpRotCurPoint[1]-this.lastPoint[1])*this.rotScale;var q=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;d.vec3d.subtract(h,l,this.tmpViewDir);var t=d.vec3d.length(this.tmpViewDir),t=u.acos(d.vec3d.dot(this.tmpViewDir,
this.tmpWorldUp)/t);if("eye"===this.pivot){var v=.5*Math.PI-t,b=.495*Math.PI;k=v-Math.max(-b,Math.min(b,v+-.5*k))}k=Math.max(a.TiltDefault.min,k+t)-t;d.mat4d.identity(this.tmpTransf);d.vec3d.cross(c.up,this.tmpViewDir,this.tmpAxis);"center"===this.pivot&&(q=-q);d.mat4d.rotate(this.tmpTransf,q,this.tmpWorldUp);d.mat4d.rotate(this.tmpTransf,k,this.tmpAxis);d.mat4d.multiplyVec3(this.tmpTransf,this.tmpViewDir);d.vec3d.add(l,this.tmpViewDir,h);d.mat4d.multiplyVec3(this.tmpTransf,c.up);d.vec2d.set(this.tmpRotCurPoint,
this.lastPoint);c.markViewDirty()},c}(h.InteractiveController);p.RotateController=A})},"esri/views/3d/state/controllers/InteractiveController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./CameraController","../../webgl-engine/lib/Camera"],function(A,p,w,l,h){Object.defineProperty(p,"__esModule",{value:!0});A=function(d){function l(){var l=null!==d&&d.apply(this,arguments)||this;return l.beginCamera=new h,l.currentCamera=new h,l}return w(l,d),Object.defineProperty(l.prototype,
"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0}),l.prototype.stepController=function(h,a){d.prototype.stepController.call(this,h,a);a.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(a)},l.prototype.onControllerStart=function(h){d.prototype.onControllerStart.call(this,h);this.beginCamera.copyFrom(h);this.currentCamera.copyFrom(h)},l.prototype.onControllerEnd=function(h){h.copyViewFrom(this.currentCamera);d.prototype.onControllerEnd.call(this,h)},l}(l.CameraController);
p.InteractiveController=A})},"esri/views/3d/input/handlers/DragZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../input/InputHandler ../../../input/handlers/support ../../state/helpers/PickingHelper ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController".split(" "),function(A,p,w,l,h,d,u,r){Object.defineProperty(p,"__esModule",{value:!0});A=function(a){function k(c,k,h){var l=a.call(this,!0)||this;return l.view=c,l.pointerType=
k,l.pickingHelper=new d.PickingHelper(c),l.registerIncoming("drag",h,function(a){return l.handleDrag(a)}),l}return w(k,a),k.prototype.handleDrag=function(a){var c=a.data;if(!(1<c.pointers.length)){var d=c.pointers[0];if(h.eventMatchesMousePointerType(d.startEvent["native"],this.pointerType)){d=[d.currentEvent.x,this.view.height-d.currentEvent.y];switch(c.action){case "start":this.view.state.isGlobal?this.cameraController=new u.ZoomController(this.view,this.pickingHelper):this.cameraController=new r.ZoomController(this.view,
this.pickingHelper);this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);break;case "update":this.cameraController.update(d);break;case "end":this.cameraController.end(),this.cameraController=null}a.stopPropagation()}}},k}(l.InputHandler);p.DragZoom=A})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../lib/glMatrix".split(" "),
function(A,p,w,l,h,d,u){Object.defineProperty(p,"__esModule",{value:!0});A=function(h){function a(a,c){var d=h.call(this)||this;return d.view=a,d.pickingHelper=c,d.pickPoint=u.vec3d.create(),d.tmpP0=u.vec3d.create(),d.panAxis=u.vec3d.create(),d.tmpRayDir=u.vec3d.create(),d.targetOnSphere=u.vec3d.create(),d.dragBeginPoint=u.vec2d.create(),d.normalizedAnchorPoint=u.vec2d.create(),d.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:null},
d.sphere={center:u.vec3d.create(),radius:0},d.hasPickPoint=!1,d}return w(a,h),a.prototype.begin=function(a){this.active&&(u.vec2d.set(a,this.dragBeginPoint),d.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),a=d.pickPointAndInitSphere(this.pickingHelper,this.beginCamera,a,!1),this.hasPickPoint=!!a.scenePickPoint,this.pickPoint=a.scenePickPoint,this.sphere=a.sphere,this.constraintOptions.interactionStartCamera=this.beginCamera)},a.prototype.update=function(a){if(this.active){this.currentCamera.eye=
this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;this.currentCamera.up=this.beginCamera.up;u.vec3d.subtract(this.currentCamera.center,this.currentCamera.eye,this.tmpRayDir);var c=u.vec3d.length(this.tmpRayDir);d.normalizeCoordinate(this.currentCamera,a,this.tmpP0);var k=12*(this.tmpP0[1]-this.normalizedAnchorPoint[1]),h=c*Math.pow(2,k),q=this.view.state.constraints.minimumPoiDistance;if(0>k&&q>h&&(h=q),!(1E-6>Math.abs(c-h))){this.hasPickPoint&&c>h&&(k=1-(1-h/c)*(1-this.sphere.radius/
u.vec3d.length(this.currentCamera.center)),u.vec3d.scale(this.currentCamera.center,k));if(u.vec3d.scale(this.tmpRayDir,-h/c),u.vec3d.add(this.currentCamera.center,this.tmpRayDir,this.currentCamera.eye),this.constraintOptions.interactionFactor=l.pixelDistanceToInteractionFactor(this.dragBeginPoint,a),l.applyAll(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint)d.sphereOrSilhouettePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere,!0),a=
d.rotationAndAxisFromPoints(this.pickPoint,this.targetOnSphere,this.panAxis),d.applyRotation(this.currentCamera,this.sphere.center,this.panAxis,a);l.applySurfaceCollision(this.view,this.currentCamera)}}},a.prototype.end=function(){this.active&&this.finishController()},a}(h.InteractiveController);p.ZoomController=A})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../InteractiveController ../../../lib/glMatrix ../../../support/mathUtils ../../utils/navigationUtils".split(" "),
function(A,p,w,l,h,d,u,r){Object.defineProperty(p,"__esModule",{value:!0});A=function(a){function k(c,k){var h=a.call(this)||this;return h.view=c,h.pickingHelper=k,h.tmpP=d.vec3d.create(),h.tmpN=d.vec3d.create(),h.tmpP0=d.vec3d.create(),h.tmpPoi=d.vec3d.create(),h.tmpRayDir=d.vec3d.create(),h.dragBeginPoint=d.vec2d.create(),h.normalizedAnchorPoint=d.vec2d.create(),h.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:d.vec3d.create()},
h.plane={normal:d.vec3d.create(),d:0},h}return w(k,a),k.prototype.begin=function(a){this.active&&(d.vec2d.set(a,this.dragBeginPoint),r.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),this.pickingHelper.pickPointInScreen(a,this.tmpP)||this.pickingHelper.pickFreePointInScreen(a,this.tmpP),d.vec3d.normalize(d.vec3d.subtract(this.beginCamera.eye,this.beginCamera.center,this.tmpN)),0>this.tmpN[1]&&d.vec3d.negate(this.tmpN),r.setPlane(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=
this.beginCamera)},k.prototype.update=function(a){if(this.active){r.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||d.vec3d.set(this.currentCamera.center,this.tmpPoi);r.normalizeCoordinate(this.currentCamera,a,this.tmpP0);var c=4*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);d.vec2d.set(this.tmpP0,this.normalizedAnchorPoint);d.vec3d.subtract(this.tmpPoi,this.currentCamera.eye,this.tmpRayDir);var k=d.vec3d.length(this.tmpRayDir),h=k*(1-c);d.vec3d.set(this.tmpRayDir,
this.constraintOptions.interactionDirection);d.vec3d.scale(this.constraintOptions.interactionDirection,u.sign(c)/k);var v=this.view.state.constraints.minimumPoiDistance;0<=c&&v>h&&(h=v,c=-(h-k)/k);1E-6>Math.abs(k-h)||(d.vec3d.scale(this.tmpRayDir,c),d.vec3d.add(this.currentCamera.eye,this.tmpRayDir),d.vec3d.lerp(this.currentCamera.center,this.tmpPoi,c),this.tmpPoi[2]>this.beginCamera.center[2]?this.currentCamera.center[2]=Math.max(this.beginCamera.center[2],this.currentCamera.center[2]):this.currentCamera.center[2]=
Math.min(this.beginCamera.center[2],this.currentCamera.center[2]),this.currentCamera.markViewDirty(),this.constraintOptions.interactionFactor=l.pixelDistanceToInteractionFactor(this.dragBeginPoint,a),l.applyAll(this.view,this.currentCamera,this.constraintOptions))}},k.prototype.end=function(){this.active&&this.finishController()},k}(h.InteractiveController);p.ZoomController=A})},"esri/views/3d/input/handlers/KeyPan":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper",
"../../../input/InputHandler","../../state/controllers/global/PanContinuousController"],function(A,p,w,l,h){Object.defineProperty(p,"__esModule",{value:!0});A=function(d){function l(l,a,k){var c=d.call(this,!0)||this;return c.view=l,c.keyToDirection=(t={},t[a.left]=h.Direction.LEFT,t[a.right]=h.Direction.RIGHT,t[a.forward]=h.Direction.FORWARD,t[a.backward]=h.Direction.BACKWARD,t[a.up]=h.Direction.UP,t[a.down]=h.Direction.DOWN,t),l.state.isGlobal&&(c.registerIncoming("key-down",k,function(a){return c.handleKeyDown(a)}),
c.registerIncoming("key-up",k,function(a){return c.handleKeyUp(a)})),c;var t}return w(l,d),l.prototype.handleKeyDown=function(d){if(!d.data.repeat){var a=this.keyToDirection[d.data.key];null!=a&&(this.cameraController&&this.cameraController.active||(this.cameraController=new h.PanContinuousController(this.view),this.view.state.switchCameraController(this.cameraController)),this.cameraController.active&&this.handleKey(d,a,!0))}},l.prototype.handleKeyUp=function(d){var a=this.keyToDirection[d.data.key];
null!=a&&this.cameraController&&this.cameraController.active&&this.handleKey(d,a,!1)},l.prototype.handleKey=function(d,a,k){k?this.cameraController.addDirection(a):this.cameraController.removeDirection(a);d.stopPropagation()},l}(l.InputHandler);p.KeyPan=A})},"esri/views/3d/state/controllers/global/PanContinuousController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../CameraController ../../../support/earthUtils ../../../support/mathUtils ../../../lib/glMatrix".split(" "),
function(A,p,w,l,h,d,u,r){Object.defineProperty(p,"__esModule",{value:!0});p.Direction={LEFT:1,RIGHT:2,FORWARD:4,BACKWARD:8,UP:16,DOWN:32};var a=r.vec3d,k=r.mat4d;A=function(c){function h(d){var h=c.call(this)||this;return h.view=d,h.directionStatus=0,h.direction=a.create(),h.tmpAxis=a.create(),h.radiusChange=0,h.velocity=0,h.tmpP1=a.create(),h.tmpTransf=k.create(),h}return w(h,c),Object.defineProperty(h.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0}),h.prototype.addDirection=
function(c){(0===this.directionStatus&&a.set3(0,0,0,this.direction),this.directionStatus&c)||((this.directionStatus|=c,c&(p.Direction.LEFT|p.Direction.RIGHT|p.Direction.FORWARD|p.Direction.BACKWARD))?(this.computePanAxis(c,this.tmpAxis),a.add(this.direction,this.tmpAxis)):(c=this.directionStatus&(p.Direction.UP|p.Direction.DOWN),this.radiusChange=c===p.Direction.UP?1:c===p.Direction.DOWN?-1:0),this.velocity=this.computePanVelocity())},h.prototype.removeDirection=function(c){(this.directionStatus&=
~c,0===this.directionStatus&&this.active)?this.finishController():c&(p.Direction.LEFT|p.Direction.RIGHT|p.Direction.FORWARD|p.Direction.BACKWARD)?(this.computePanAxis(c,this.tmpAxis),a.subtract(this.direction,this.tmpAxis),.01>a.length(this.direction)&&a.set3(0,0,0,this.direction)):(c=this.directionStatus&(p.Direction.UP|p.Direction.DOWN),this.radiusChange=c===p.Direction.UP?1:c===p.Direction.DOWN?-1:0)},h.prototype.stepController=function(d,h){c.prototype.stepController.call(this,d,h);d*=this.velocity;
var q=!1;if(0<Math.abs(this.radiusChange)){var q=1+d*this.radiusChange,t=h.viewForward,r=a.normalize(h.center,this.tmpP1);(-.999<a.dot(t,r)||0>this.radiusChange)&&a.scale(h.center,q);a.scale(h.eye,q);this.velocity=this.computePanVelocity();q=!0}.01<a.length2(this.direction)&&(k.identity(this.tmpTransf),k.rotate(this.tmpTransf,d,this.direction),k.multiplyVec3(this.tmpTransf,h.eye),k.multiplyVec3(this.tmpTransf,h.center),k.multiplyVec3(this.tmpTransf,h.up),q=!0);q&&l.applyAll(this.view,h,{selection:14,
interactionType:4,interactionStartCamera:this.view.state.camera,interactionFactor:null,interactionDirection:null})},h.prototype.computePanAxis=function(c,d){var k=this.view.state.camera;a.subtract(k.center,k.eye,d);a.cross(d,k.up);c!==p.Direction.LEFT&&c!==p.Direction.RIGHT||(a.normalize(d),a.cross(d,k.center));c!==p.Direction.RIGHT&&c!==p.Direction.FORWARD||a.negate(d);a.normalize(d)},h.prototype.computePanVelocity=function(){var c=.5*Math.abs(a.length(this.view.state.camera.eye)-d.earthRadius);
return c=u.clamp(c,1,2*d.earthRadius),u.acos(1-c*c/(2*d.earthRadius*d.earthRadius))},h}(h.CameraController);p.PanContinuousController=A})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../input/InputHandler ../../state/helpers/PickingHelper ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController".split(" "),function(A,p,w,l,h,d,u){Object.defineProperty(p,"__esModule",{value:!0});
A=function(l){function a(a,c){var d=l.call(this,!0)||this;return d.view=a,d.pickingHelper=new h.PickingHelper(a),d.registerIncoming("mouse-wheel",c,function(a){return d.handleMouseWheel(a)}),d}return w(a,l),a.prototype.handleMouseWheel=function(a){var c=a.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new d.ZoomStepController(this.view,this.pickingHelper,"interaction"):new u.ZoomStepController(this.view,this.pickingHelper,"interaction"),this.view.state.switchCameraController(this.cameraController));
this.cameraController.zoomStep(-1/60*c.deltaY,[c.x,this.view.height-c.y]);a.stopPropagation()},a}(l.InputHandler);p.MouseWheelZoom=A})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./SingleKey"],function(A,p,w,l){Object.defineProperty(p,"__esModule",{value:!0});A=function(h){function d(d,l,a){a=h.call(this,"esri.views.3d.input.handlers.SingleKeyResetHeading",l,a)||this;return a.view=d,a.key=l,a}return w(d,h),
d.prototype.activate=function(){this.view.goTo({heading:0})},d}(l.SingleKey);p.SingleKeyResetHeading=A})},"esri/views/3d/input/handlers/SingleKey":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(A,p,w,l){Object.defineProperty(p,"__esModule",{value:!0});A=function(h){function d(d,l,a){var k=h.call(this,!0)||this;return k.key=l,k.registerIncoming("key-down",a,function(a){return k._handleKeyDown(a)}),k}return w(d,h),d.prototype._handleKeyDown=
function(d){d.data.key===this.key&&(this.activate(),d.stopPropagation())},d}(l.InputHandler);p.SingleKey=A})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./SingleKey"],function(A,p,w,l){Object.defineProperty(p,"__esModule",{value:!0});A=function(h){function d(d,l,a){a=h.call(this,"esri.views.3d.input.handlers.SingleKeyResetTilt",l,a)||this;return a.view=d,a.key=l,a}return w(d,h),d.prototype.activate=function(){this.view.goTo({tilt:0})},
d}(l.SingleKey);p.SingleKeyResetTilt=A})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(A,p,w,l){Object.defineProperty(p,"__esModule",{value:!0});A=function(h){function d(d,l){var a=h.call(this,!0)||this;return a.view=d,a.registerIncoming("pointer-down",l,function(d){return a.view.state.stopActiveCameraController()}),a}return w(d,h),d}(l.InputHandler);p.PointerDownCancelAnimation=
A})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../input/InputHandler ../../state/helpers/PickingHelper ../../state/controllers/RotateController".split(" "),function(A,p,w,l,h,d){Object.defineProperty(p,"__esModule",{value:!0});A=function(l){function r(a,d){void 0===d&&(d=!1);var c=l.call(this,!0)||this;return c.view=a,c.invert=d,c.pickingHelper=new h.PickingHelper(a),c.registerIncoming("vertical-two-finger-drag",
function(a){return c.handleTwoFinger(a)}),c}return w(r,l),r.prototype.handleTwoFinger=function(a){var k=[0,-a.data.delta*(this.invert?-1:1)];switch(a.data.action){case "begin":this.cameraController=new d.RotateController(this.view,this.pickingHelper,"center");this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(k);break;case "update":this.cameraController.update(k);break;case "end":this.cameraController.end(),this.cameraController=null}},r}(l.InputHandler);p.TwoFingerTilt=
A})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../input/InputHandler ../../../input/handlers/support ../../state/helpers/PickingHelper ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController".split(" "),function(A,p,w,l,h,d,u,r){Object.defineProperty(p,"__esModule",{value:!0});A=function(a){function k(c,k,h){var l=a.call(this,!0)||this;return l.view=c,l.pointerType=
k,l.lastEndTimestamp=0,l.pickingHelper=new d.PickingHelper(c),l.registerIncoming("drag",h,function(a){return l.handleDrag(a)}),l}return w(k,a),k.prototype.handleDrag=function(a){var c=a.data.pointers[0].startEvent["native"];if("mouse"!==c.pointerType||h.eventMatchesMousePointerType(c,this.pointerType)){c=a.timestamp-this.lastEndTimestamp;c=this.momentum&&this.momentum.active&&40>c;switch(a.data.action){case "start":case "update":if(c)break;this.controller&&this.controller.active?.002>(a.data.currentState.timestamp-
a.data.previousState.timestamp)/1E3||this.controller.update(a.data.pointers,a.data.currentState,a.timestamp):(this.view.state.isGlobal?this.controller=new u.PinchAndPanController(this.view,this.pickingHelper):this.controller=new r.PinchAndPanController(this.view,this.pickingHelper),this.view.state.switchCameraController(this.controller),this.controller.begin(a.data.pointers,a.data.currentState,a.timestamp));break;case "end":this.controller&&this.controller.active&&(this.lastEndTimestamp=a.timestamp,
this.momentum=this.controller.end(),this.momentum&&this.view.state.switchCameraController(this.momentum),this.controller=null)}a.stopPropagation()}},k}(l.InputHandler);p.PinchAndPanNavigation=A})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/glMatrix ../../../input/util ../../../webgl-engine/lib/Camera ../InteractiveController ./MomentumController ../../utils/navigationUtils ../../utils/navigationUtils ../../../camera/constraintUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c){Object.defineProperty(p,"__esModule",{value:!0});A=function(t){function u(a,c){var q=t.call(this)||this;return q.view=a,q.pickingHelper=c,q.smoothRotation=new h.ExponentialFalloff(.05),q.rotationAxis=l.vec3d.create(),q.panningCenterScene=l.vec3d.create(),q.panningPlane={normal:l.vec3d.create(),d:0},q.smoothScaling=new h.ExponentialFalloff(.05),q.zoomCenterScreen=l.vec2d.create(),q.beginScenePoints={points:[],center:l.vec3d.create()},q.adjustedSphere={center:l.vec3d.create(),
radius:0},q.panMode=k.PanMode.Horizontal,q.tmp2d=l.vec2d.create(),q.tmp3d=l.vec3d.create(),q.tmpInteractionDirection=l.vec3d.create(),q.beginScreenPoint=l.vec2d.create(),q.screenPickPoint=l.vec2d.create(),q.currentPoints=[],q.currentCenter=l.vec3d.create(),q.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new d,interactionDirection:null},q.momentumController=new r.MomentumController(a),q}return w(u,t),u.prototype.begin=function(c,d,h){if(this.active){this.beginRadius=
d.radius;a.navPointToScreenPoint(this.currentCamera,d.center,this.screenPickPoint);l.vec2d.set(this.screenPickPoint,this.beginScreenPoint);h=a.pickPointAndInitSphere(this.pickingHelper,this.beginCamera,this.screenPickPoint,!0);if(this.scenePickPoint=h.scenePickPoint,this.sphere=h.sphere,this.panMode=a.decidePanMode(this.beginCamera,this.sphere,this.scenePickPoint),this.panMode===k.PanMode.Horizontal)this.computeSpherePoints(c,"startEvent",this.sphere,this.beginCamera,this.beginScenePoints.points),
a.centroidOnSphere(this.sphere.radius,this.beginScenePoints.points,this.beginScenePoints.center);else{l.vec3d.set(this.beginCamera.viewForward,this.panningPlane.normal);l.vec3d.normalize(this.panningPlane.normal);l.vec3d.negate(this.panningPlane.normal);a.setPlane(this.scenePickPoint,this.panningPlane.normal,this.panningPlane);c=l.vec3d.create();l.vec3d.set3(this.screenPickPoint[0],this.currentCamera.height,0,c);h=l.vec3d.create();var q=l.vec3d.length(this.beginCamera.eye);this.adjustedSphere.radius=
q<this.sphere.radius?q-100:this.sphere.radius;a.sphereOrSilhouettePointFromScreenPoint(this.adjustedSphere,this.beginCamera,c,h);this.beginCamera.projectPoint(h,c);this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],.9*c[1]);this.pickingHelper.pickPointInScreen(this.screenPickPoint,this.scenePickPoint)&&a.setPlane(this.scenePickPoint,this.panningPlane.normal,this.panningPlane);a.navPointToScreenPoint(this.currentCamera,d.center,this.tmp2d);a.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,
this.tmp2d,this.panningCenterScene)}this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}},u.prototype.update=function(a,c,d){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var h=1<a.length;this.panMode===k.PanMode.Horizontal?(h&&this.zoomSpherical(c,d),this.panningSpherical(a,c,d),h&&this.rotateSpherical(a,c,d)):(h&&this.zoomPlanar(a,c,d),this.panningPlanar(a,c,d),h&&this.rotatePlanar(a,c,d));this.currentCamera.markViewDirty()}},u.prototype.end=function(){return this.panMode===
k.PanMode.Horizontal?this.momentumController.setParameters(this.sphere.radius,this.panMode,this.zoomCenterScreen,this.beginScenePoints.center):this.momentumController.setParameters(this.sphere.radius,this.panMode,this.zoomCenterScreen,this.panningCenterScene),this.finishController(),this.momentumController.initiate()?this.momentumController:null},u.prototype.computeSpherePoints=function(c,d,k,h,t){t.length=c.length;for(var b=this.tmp2d,m=0;m<t.length;m++)a.navPointToScreenPoint(h,c[m][d],b),void 0===
t[m]&&(t[m]=l.vec3d.create()),a.sphereOrSilhouettePointFromScreenPoint(k,h,b,t[m]);return t},u.prototype.zoomSpherical=function(d,k){var h=this.currentCamera.height,q=this.beginRadius/d.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(d.radius,40),120);this.smoothScaling.update(q);a.applyZoomOnSphere(this.sphere,this.currentCamera,this.smoothScaling.value);l.vec2d.set2(d.center.x,h-d.center.y,this.zoomCenterScreen);this.momentumController.addScaleValue(k,this.smoothScaling.value);this.constraintOptions.interactionType=
1;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(d.radius-this.beginRadius);c.applyAll(this.view,this.currentCamera,this.constraintOptions)},u.prototype.panningSpherical=function(d,k,h){this.currentPoints;this.computeSpherePoints(d,"currentEvent",this.sphere,this.currentCamera,this.currentPoints);a.centroidOnSphere(this.sphere.radius,this.currentPoints,this.currentCenter);a.navPointToScreenPoint(this.currentCamera,k.center,this.tmp2d);a.applyPanSpherical(this.sphere,this.currentCamera,
this.beginScenePoints.center,this.currentCenter,{estimator:this.momentumController,time:h,endScreenPoint:this.tmp2d});this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(this.screenPickPoint,this.tmp2d);c.applyAll(this.view,this.currentCamera,this.constraintOptions)},u.prototype.rotateSpherical=function(d,k,h){var q=d.length;l.vec3d.normalize(this.beginScenePoints.center,this.rotationAxis);this.computeSpherePoints(d,"currentEvent",this.sphere,
this.currentCamera,this.currentPoints);for(var t=d=0;q>t;t++)d+=a.rotationFromPointsAroundAxis(this.currentPoints[t],this.beginScenePoints.points[t],this.rotationAxis);t=this.smoothRotation.value;q=a.normalizeRotationDelta(d/q-t);d=t+q;this.smoothRotation.gain=.00125*Math.min(Math.max(k.radius,40),120);this.smoothRotation.update(d);q=this.smoothRotation.value;this.momentumController.addRotationValue(h,q);a.applyRotation(this.currentCamera,this.sphere.center,this.rotationAxis,q);this.constraintOptions.interactionType=
2;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(k.radius*d);c.applyAll(this.view,this.currentCamera,this.constraintOptions)},u.prototype.panningPlanar=function(d,k,h){a.navPointToScreenPoint(this.currentCamera,k.center,this.tmp2d);a.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,this.tmp2d,this.tmp3d)&&(a.applyPanPlanar(this.currentCamera,this.panningCenterScene,this.tmp3d,{estimator:this.momentumController,time:h,endScreenPoint:this.tmp2d}),this.constraintOptions.interactionType=
4,this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(this.beginScreenPoint,this.tmp2d),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),c.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)},u.prototype.zoomPlanar=function(d,k,h){d=this.beginRadius/k.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(k.radius,40),
120);this.smoothScaling.update(d);this.momentumController.addScaleValue(h,this.smoothScaling.value);this.momentumController.setParametersVertical(this.panningCenterScene);a.applyZoomToPoint(this.currentCamera,this.panningCenterScene,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(k.radius-this.beginRadius);c.applyAll(this.view,this.currentCamera,this.constraintOptions)},
u.prototype.rotatePlanar=function(d,k,h){l.vec3d.set(this.panningCenterScene,this.rotationAxis);var q=k.angle;d=this.smoothRotation.value;q=a.normalizeRotationDelta(q-d);q=d+q;this.smoothRotation.gain=.00125*Math.min(Math.max(k.radius,40),120);this.smoothRotation.update(q);d=this.smoothRotation.value;this.momentumController.addRotationValue(h,d);a.applyRotation(this.currentCamera,this.sphere.center,this.rotationAxis,d);this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=
c.pixelDistanceToInteractionFactor(k.radius*d);c.applyAll(this.view,this.currentCamera,this.constraintOptions)},u}(u.InteractiveController);p.PinchAndPanController=A})},"esri/views/3d/input/util":function(){define(["require","exports"],function(A,p){Object.defineProperty(p,"__esModule",{value:!0});A=function(){function p(l){this._gain=l}return p.prototype.reset=function(l){this._value=l},Object.defineProperty(p.prototype,"gain",{set:function(l){this._gain=l},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,
"value",{get:function(){return void 0===this._value?0:this._value},enumerable:!0,configurable:!0}),p.prototype.update=function(l){void 0===this._value?this._value=l:this._value=this._gain*l+(1-this._gain)*this._value},p}();p.ExponentialFalloff=A})},"esri/views/3d/state/controllers/global/MomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../AnimationController ../../../webgl-engine/lib/Camera ../../../lib/glMatrix ../../utils/navigationUtils ../../../../navigation/Momentum ../../utils/navigationUtils ../../../camera/constraintUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k){Object.defineProperty(p,"__esModule",{value:!0});var c=d.vec3d.create();A=function(l){function t(a){var c=l.call(this)||this;return c.view=a,c.zoom={momentum:null,estimator:new r.ZoomMomentumEstimator(.05),enabled:!0},c.rotation={momentum:null,estimator:new r.RotationMomentumEstimator(.05,3,.05,.95),enabled:!0},c.pan={momentum:null,estimator:new r.ScreenspaceMomentumEstimator(.05,500,12,.82),enabled:!0},c.elapsedTimeSec=0,c._panAxisOrDirection=d.vec3d.create(),c._centerOnScreen=
d.vec2d.create(),c._centerOnSphere=d.vec3d.create(),c._tmpSphereCenter=d.vec3d.create(),c._tmpScaleAxis=d.vec3d.create(),c.sphere={center:d.vec3d.create(),radius:0},c.tmpInteractionDirection=d.vec3d.create(),c._verticalCenter=d.vec3d.create(),c.beginCamera=new h,c.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new h,interactionDirection:null},c}return w(t,l),t.prototype.setParameters=function(a,c,k,h){this.sphere.radius=a;k&&h?(d.vec2d.set(k,this._centerOnScreen),
d.vec3d.set(h,this._centerOnSphere)):(this.zoom.enabled=!1,this.rotation.enabled=!1);this._mode=c},t.prototype.setParametersVertical=function(a){d.vec3d.set(a,this._verticalCenter)},t.prototype.addPanValue=function(a,c,k,h){this.pan.estimator.add(c[0],c[1],k,.001*a);d.vec3d.set(h,this._panAxisOrDirection)},t.prototype.addRotationValue=function(a,c){this.rotation.estimator.add(c,.001*a)},t.prototype.addScaleValue=function(a,c){this.zoom.estimator.add(c,.001*a)},t.prototype.initiate=function(){return this.zoom.enabled&&
(this.zoom.momentum=this.zoom.estimator.evaluateMomentum()),!this.zoom.momentum&&this.rotation.enabled&&(this.rotation.momentum=this.rotation.estimator.evaluateMomentum()),this.zoom.momentum||this.rotation.momentum||!this.pan.enabled||(this.pan.momentum=this.pan.estimator.evaluateMomentum()),null!=(this.zoom.momentum||this.rotation.momentum||this.pan.momentum)},t.prototype.onControllerStart=function(a){this.beginCamera.copyFrom(a);this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera);
l.prototype.onControllerStart.call(this,a)},Object.defineProperty(t.prototype,"steppingFinished",{get:function(){return this.momentumFinished()},enumerable:!0,configurable:!0}),t.prototype.stepController=function(h,l){l.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=h;var q=this._centerOnScreen;h=this._centerOnSphere;if(this.zoom.momentum){var t=this.zoom.momentum.valueDelta(0,this.elapsedTimeSec);this._mode===a.PanMode.Horizontal?(u.applyZoomOnSphere(this.sphere,l,t),this.constraintOptions.selection=
15,this.constraintOptions.interactionType=1,this.constraintOptions.interactionDirection=null,k.applyAll(this.view,l,this.constraintOptions),u.sphereOrSilhouettePointFromScreenPoint(this.sphere,l,q,this._tmpSphereCenter),q=u.rotationAndAxisFromPoints(h,this._tmpSphereCenter,this._tmpScaleAxis),u.applyRotation(l,this.sphere.center,this._tmpScaleAxis,q),this.constraintOptions.interactionType=4):(d.vec3d.set(l.eye,this.tmpInteractionDirection),u.applyZoomToPoint(l,this._verticalCenter,t,this.view.state.constraints.minimumPoiDistance),
this.constraintOptions.interactionType=1,this.constraintOptions.interactionDirection=d.vec3d.direction(this.tmpInteractionDirection,l.eye));k.applyAll(this.view,l,this.constraintOptions)}this.pan.momentum&&(this._mode===a.PanMode.Horizontal?(q=u.rotationAndAxisFromPoints(this.pan.momentum.dataOldest,this.pan.momentum.dataNewest,this._panAxisOrDirection)/this.pan.momentum.dataTimeDelta,q=this.pan.momentum.valueFromInitialVelocity(q,this.elapsedTimeSec),u.applyRotation(l,this.sphere.center,this._panAxisOrDirection,
q)):(q=d.vec3d.dist(this.pan.momentum.dataOldest,this.pan.momentum.dataNewest),q/=this.pan.momentum.dataTimeDelta,q=this.pan.momentum.valueFromInitialVelocity(q,this.elapsedTimeSec),d.vec3d.normalize(this._panAxisOrDirection),d.vec3d.scale(this._panAxisOrDirection,q),d.vec3d.subtract(l.eye,this._panAxisOrDirection),d.vec3d.subtract(l.center,this._panAxisOrDirection),l.markViewDirty(),this.constraintOptions.interactionDirection=this._panAxisOrDirection),this.constraintOptions.interactionType=4,k.applyAll(this.view,
l,this.constraintOptions),this.constraintOptions.interactionDirection=null);this.rotation.momentum&&(q=this.rotation.momentum.valueDelta(0,this.elapsedTimeSec),u.applyRotation(l,c,h,q),this.constraintOptions.interactionType=2,this.constraintOptions.interactionDirection=null,k.applyAll(this.view,l,this.constraintOptions))},t.prototype.momentumFinished=function(){return this.zoom.momentum&&this.zoom.momentum.isFinished(this.elapsedTimeSec)&&(this.zoom.momentum=null),this.rotation.momentum&&this.rotation.momentum.isFinished(this.elapsedTimeSec)&&
(this.rotation.momentum=null),this.pan.momentum&&this.pan.momentum.isFinished(this.elapsedTimeSec)&&(this.pan.momentum=null),!this.zoom.momentum&&!this.rotation.momentum&&!this.pan.momentum},t}(l.AnimationController);p.MomentumController=A})},"esri/views/navigation/Momentum":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./ValueHistory","../3d/lib/glMatrix"],function(A,p,w,l,h){Object.defineProperty(p,"__esModule",{value:!0});var d=function(){function a(a,d,k){this._initialVelocity=
a;this._stopVelocity=d;this._friction=k;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}return Object.defineProperty(a.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),a.prototype.isFinished=function(a){return a>this.duration},Object.defineProperty(a.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0}),a.prototype.value=function(a){a=Math.min(a,this.duration);
var c=1-this._friction;return this._initialVelocity*(Math.pow(c,a)-1)/Math.log(c)},a.prototype.valueDelta=function(a,d){var c=this.value(a);return this.value(a+d)-c},a}();p.Momentum=d;A=function(){function a(a,d,k,h){void 0===a&&(a=.05);this._minimumInitialVelocity=d;this._stopVelocity=k;this._friction=h;this._history=new l.ValueHistory(1E3*a)}return a.prototype.add=function(a,d){void 0!==d&&(d*=1E3);this._history.add(a,d)},a.prototype.reset=function(){this._history.reset()},Object.defineProperty(a.prototype,
"stopVelocity",{get:function(){return this._stopVelocity},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0}),a.prototype.evaluateMomentum=function(){var a=this._evaluateVelocity();return null!==a?new d(a,this._stopVelocity,this._friction):null},a.prototype._evaluateVelocity=function(){var a=this._history,d=a.oldest,a=a.newest;if(d&&a){var k=(a.timeStamp-d.timeStamp)/1E3;if(0<k&&(d=(a.value-d.value)/k,
Math.abs(d)>=this._minimumInitialVelocity))return d}return null},a}();p.MomentumEstimator=A;var u=function(a){function c(c,d,k){return a.call(this,c,d,k)||this}return w(c,a),c.prototype.value=function(c){c=a.prototype.value.call(this,c);return Math.exp(c)},c.prototype.valueDelta=function(c,d){var k=a.prototype.value.call(this,c);c=a.prototype.value.call(this,c+d);return Math.exp(c-k)},c}(d);p.ZoomMomentum=u;var r=function(a){function c(c,d,k,h){return void 0===c&&(c=.05),void 0===d&&(d=4),void 0===
k&&(k=.01),void 0===h&&(h=.95),a.call(this,c,d,k,h)||this}return w(c,a),c.prototype.add=function(c,d){a.prototype.add.call(this,Math.log(c),d)},c.prototype.evaluateMomentum=function(){var a=this._evaluateVelocity();return null!==a?new u(a,this.stopVelocity,this.friction):null},c}(A);p.ZoomMomentumEstimator=r;A=function(a){function c(c,d,k,h){return void 0===c&&(c=.05),void 0===d&&(d=4),void 0===k&&(k=.01),void 0===h&&(h=.95),a.call(this,c,d,k,h)||this}return w(c,a),c.prototype.add=function(c,d){var k=
this._history.newest;if(k){k=k.value;for(c-=k;c>Math.PI;)c-=2*Math.PI;for(;c<-Math.PI;)c+=2*Math.PI;c=k+c}a.prototype.add.call(this,c,d)},c}(A);p.RotationMomentumEstimator=A;var a=function(a){function c(c,d,k,h,l,r){c=a.call(this,c,d,k)||this;return c.dataOldest=h,c.dataNewest=l,c.dataTimeDelta=r,c}return w(c,a),c.prototype.velocityFactor=function(a){return a=Math.min(a,this.duration),Math.pow(1-this.friction,a)},c.prototype.valueFromInitialVelocity=function(a,c){c=Math.min(c,this.duration);var d=
1-this.friction;return a*(Math.pow(d,c)-1)/Math.log(d)},c}(d);p.ScreenspaceMomentum=a;A=function(){function d(a,d,k,h){void 0===a&&(a=.05);this._minimumInitialVelocity=d;this._stopVelocity=k;this._friction=h;this._entryPool=[];this._history=new l.ValueHistory(1E3*a)}return d.prototype.add=function(a,d,k,l){void 0!==l&&(l*=1E3);var c;0!==this._entryPool.length?(c=this._entryPool.pop(),c.x=a,c.y=d,h.vec3d.set(k,c.data)):c={x:a,y:d,data:h.vec3d.create(k)};this._history.add(c,l)},d.prototype.reset=function(){for(var a=
0,d=this._history.values;a<d.length;a++)this._entryPool.push(d[a].value);this._history.reset()},Object.defineProperty(d.prototype,"stopVelocity",{get:function(){return this._stopVelocity},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0}),d.prototype.evaluateMomentum=function(){var c=this._evaluateVelocity(),d=this._history.oldest,k=this._history.newest;return null!==c?new a(c,this._stopVelocity,this._friction,
d.value.data,k.value.data,.001*(k.timeStamp-d.timeStamp)):null},d.prototype._evaluateVelocity=function(){var a=this._history,d=a.oldest,k=a.newest;if(d&&k&&(a=.001*(k.timeStamp-d.timeStamp),0<a)){var h=k.value.x-d.value.x,d=k.value.y-d.value.y,d=Math.sqrt(h*h+d*d)/a;if(Math.abs(d)>=this._minimumInitialVelocity)return d}return null},d}();p.ScreenspaceMomentumEstimator=A})},"esri/views/navigation/ValueHistory":function(){define(["require","exports","../../core/now"],function(A,p,w){Object.defineProperty(p,
"__esModule",{value:!0});A=function(){function l(h){this._maximumAge=h;this._values=[]}return Object.defineProperty(l.prototype,"values",{get:function(){return this._values},enumerable:!0,configurable:!0}),l.prototype.reset=function(){this._values=[]},l.prototype.add=function(h,d){d=void 0!==d?d:w();this._values.push({value:h,timeStamp:d});this._cleanup(d)},Object.defineProperty(l.prototype,"newest",{get:function(){var h=this._values.length;return 0<h?this._values[h-1]:void 0},enumerable:!0,configurable:!0}),
Object.defineProperty(l.prototype,"oldest",{get:function(){return 0<this._values.length?this._values[0]:void 0},enumerable:!0,configurable:!0}),l.prototype._cleanup=function(h){for(;0<this._values.length&&this._values[0].timeStamp+this._maximumAge<h;)this._values.shift()},l}();p.ValueHistory=A})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/glMatrix ../../../input/util ../../../webgl-engine/lib/Camera ../InteractiveController ./MomentumController ../../utils/navigationUtils ../../../camera/constraintUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k){Object.defineProperty(p,"__esModule",{value:!0});var c;!function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"}(c=p.PanMode||(p.PanMode={}));var t=l.vec3d.createFrom(0,0,1),C=16/180*Math.PI;A=function(q){function v(a,c){var k=q.call(this)||this;return k.view=a,k.pickingHelper=c,k.rotationValueSmooth=new h.ExponentialFalloff(.05),k.scalingValueSmooth=new h.ExponentialFalloff(.05),k.planeHorizontal={normal:l.vec3d.create(),d:0},k.planeVertical={normal:l.vec3d.create(),
d:0},k.beginCenterHorizontal=l.vec3d.create(),k.beginCenterVertical=l.vec3d.create(),k.tmpPoints=[],k.beginCenterScreen=l.vec2d.create(),k.tmpCentroid3d=l.vec3d.create(),k.tmpCentroid2d=l.vec2d.create(),k.tmp2d=l.vec2d.create(),k.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new d,interactionDirection:null},k.momentumController=new r.MomentumController(a),k}return w(v,q),v.prototype.begin=function(d,k,h){if(this.active){this.beginRadius=k.radius;this.rotationValueSmooth.reset();
this.scalingValueSmooth.reset();a.navPointToScreenPoint(this.beginCamera,k.center,this.beginCenterScreen);this.planeHorizontal.d=0;l.vec3d.set(t,this.planeHorizontal.normal);k=l.vec3d.create();this.pickingHelper.pickPointInScreen(this.beginCenterScreen,k)||this.pickingHelper.pickFreePointInScreen(this.beginCenterScreen,k);h=l.vec3d.create();l.vec3d.negate(this.beginCamera.viewForward,h);var b=l.vec3d.create();l.vec3d.set(t,b);var m=l.vec3d.dot(h,b);this.panMode=Math.asin(0>m?-m:m)>=C?c.Horizontal:
c.Vertical;a.setPlaneD(k,this.planeHorizontal);0>l.vec3d.dot(this.planeHorizontal.normal,this.beginCamera.eye)+this.planeHorizontal.d&&(l.vec3d.negate(this.planeHorizontal.normal),this.planeHorizontal.d*=-1);this.panMode===c.Vertical&&(l.vec3d.scale(b,m),l.vec3d.subtract(h,b,this.planeVertical.normal),l.vec3d.normalize(this.planeVertical.normal),a.setPlaneD(k,this.planeVertical),this.computePlanePoints(d,"currentEvent",this.planeVertical,this.beginCamera,this.tmpPoints),a.centroid(this.tmpPoints,
this.beginCenterVertical));this.computePlanePoints(d,"currentEvent",this.planeHorizontal,this.beginCamera,this.tmpPoints);a.centroid(this.tmpPoints,this.beginCenterHorizontal);this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}},v.prototype.update=function(d,h,q){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var b=1<d.length,m=this.panMode===c.Horizontal?this.planeHorizontal:this.planeVertical,t=this.panMode===c.Horizontal?this.beginCenterHorizontal:this.beginCenterVertical;
if(b){var r=this.beginRadius/h.radius,v=.001875*Math.min(Math.max(h.radius,40),120);this.scalingValueSmooth.gain=v;this.scalingValueSmooth.update(r);a.applyZoomToPoint(this.currentCamera,t,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.momentumController.addScaleValue(q,this.scalingValueSmooth.value,t);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=k.pixelDistanceToInteractionFactor(Math.abs(h.radius-this.beginRadius));k.applyAll(this.view,
this.currentCamera,this.constraintOptions)}if(this.computePlanePoints(d,"currentEvent",m,this.currentCamera,this.tmpPoints),a.centroid(this.tmpPoints,this.tmpCentroid3d),a.navPointToScreenPoint(this.currentCamera,h.center,this.tmpCentroid2d),a.applyPanPlanar(this.currentCamera,t,this.tmpCentroid3d,{estimator:this.momentumController,time:q,endScreenPoint:this.tmpCentroid2d}),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=k.pixelDistanceToInteractionFactor(this.beginCenterScreen,
this.tmpCentroid2d),k.applyAll(this.view,this.currentCamera,this.constraintOptions),b)d=this.planeHorizontal.normal,l.vec3d.set(this.planeHorizontal.normal,d),b=h.angle,v=this.rotationValueSmooth.value,b=a.normalizeRotationDelta(b-v),b=v+b,v=.00125*Math.min(Math.max(h.radius,40),120),this.rotationValueSmooth.gain=v,this.rotationValueSmooth.update(b),v=this.rotationValueSmooth.value,this.momentumController.addRotationValue(q,t,d,v),a.applyRotation(this.currentCamera,t,d,v),this.constraintOptions.interactionType=
2,this.constraintOptions.interactionFactor=k.pixelDistanceToInteractionFactor(Math.abs(h.radius*v)),k.applyAll(this.view,this.currentCamera,this.constraintOptions);this.currentCamera.markViewDirty()}},v.prototype.end=function(){return this.finishController(),this.momentumController.initiate()?this.momentumController:null},v.prototype.computePlanePoints=function(c,d,k,b,h){h.length=c.length;for(var m=this.tmp2d,q=0;q<h.length;q++){var t=c[q];m[0]=t[d].x;m[1]=this.view.height-t[d].y;void 0===h[q]&&
(h[q]=l.vec3d.create());a.intersectPlaneFromScreenPoint(k,b,m,h[q])}return h},v}(u.InteractiveController);p.PinchAndPanController=A})},"esri/views/3d/state/controllers/local/MomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../AnimationController ../../../webgl-engine/lib/Camera ../../../lib/glMatrix ../../utils/navigationUtils ../../../../navigation/Momentum ../../../camera/constraintUtils".split(" "),function(A,p,w,l,h,d,u,r,a){Object.defineProperty(p,
"__esModule",{value:!0});A=function(k){function c(a){var c=k.call(this)||this;return c.view=a,c.zoom={momentum:null,estimator:new r.ZoomMomentumEstimator(.05),enabled:!0},c.rotation={momentum:null,estimator:new r.RotationMomentumEstimator(.05,3,.05,.95),enabled:!0},c.pan={momentum:null,estimator:new r.ScreenspaceMomentumEstimator(.05,500,12,.82),enabled:!0},c._scaleState={center:d.vec3d.create()},c._rotationState={center:d.vec3d.create(),axis:d.vec3d.create()},c._panState={direction:d.vec3d.create()},
c.elapsedTimeSec=0,c.zoomDirection=d.vec3d.create(),c.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new h,interactionDirection:null},c}return w(c,k),c.prototype.addPanValue=function(a,c,k,h){this.pan.estimator.add(c[0],c[1],k,.001*a);d.vec3d.set(h,this._panState.direction);d.vec3d.normalize(this._panState.direction)},c.prototype.addRotationValue=function(a,c,k,h){this.rotation.estimator.add(h,.001*a);d.vec3d.set(c,this._rotationState.center);d.vec3d.set(k,
this._rotationState.axis)},c.prototype.addScaleValue=function(a,c,k){this.zoom.estimator.add(c,.001*a);d.vec3d.set(k,this._scaleState.center)},c.prototype.initiate=function(){return this.zoom.enabled&&(this.zoom.momentum=this.zoom.estimator.evaluateMomentum()),!this.zoom.momentum&&this.rotation.enabled&&(this.rotation.momentum=this.rotation.estimator.evaluateMomentum()),this.zoom.momentum||this.rotation.momentum||!this.pan.enabled||(this.pan.momentum=this.pan.estimator.evaluateMomentum()),null!=(this.zoom.momentum||
this.rotation.momentum||this.pan.momentum)},Object.defineProperty(c.prototype,"steppingFinished",{get:function(){return this.zoom.momentum&&this.zoom.momentum.isFinished(this.elapsedTimeSec)&&(this.zoom.momentum=null),this.rotation.momentum&&this.rotation.momentum.isFinished(this.elapsedTimeSec)&&(this.rotation.momentum=null),this.pan.momentum&&this.pan.momentum.isFinished(this.elapsedTimeSec)&&(this.pan.momentum=null),!this.zoom.momentum&&!this.rotation.momentum&&!this.pan.momentum},enumerable:!0,
configurable:!0}),c.prototype.onControllerStart=function(a){this.constraintOptions.interactionStartCamera.copyFrom(a);this.constraintOptions.interactionDirection=null;k.prototype.onControllerStart.call(this,a)},c.prototype.stepController=function(c,h){if(k.prototype.stepController.call(this,c,h),this.zoom.momentum){d.vec3d.normalize(d.vec3d.subtract(this._scaleState.center,h.eye,this.zoomDirection));this.constraintOptions.interactionDirection=this.zoomDirection;this.constraintOptions.interactionType=
1;var l=this.zoom.momentum.valueDelta(this.elapsedTimeSec,c);u.applyZoomToPoint(h,this._scaleState.center,l,this.view.state.constraints.minimumPoiDistance);a.applyAll(this.view,h,this.constraintOptions)}this.pan.momentum&&(d.vec3d.normalize(this._panState.direction),l=d.vec3d.dist(this.pan.momentum.dataOldest,this.pan.momentum.dataNewest),l/=this.pan.momentum.dataTimeDelta,l*=this.pan.momentum.velocityFactor(this.elapsedTimeSec),d.vec3d.scale(this._panState.direction,l*c),d.vec3d.subtract(h.eye,this._panState.direction),
d.vec3d.subtract(h.center,this._panState.direction),h.markViewDirty(),this.constraintOptions.interactionType=4,a.applyAll(this.view,h,this.constraintOptions));this.rotation.momentum&&(l=this.rotation.momentum.valueDelta(this.elapsedTimeSec,c),u.applyRotation(h,this._rotationState.center,this._rotationState.axis,l),this.constraintOptions.interactionType=2,a.applyAll(this.view,h,this.constraintOptions));this.elapsedTimeSec+=c},c}(l.AnimationController);p.MomentumController=A})},"esri/views/3d/webgl-engine/Stage":function(){define("require exports ./parts/Model ./parts/View ./lib/Selector ./lib/Camera ./lib/gl-matrix ./lib/Util ./lib/ModelContentType ./lighting/Lightsources".split(" "),
function(A,p,w,l,h,d,u,r,a,k){A=u.vec2d;p=u.vec2;var c=u.vec3d;u=function(){function v(a,d,q){this._intersectTolerance=h.DEFAULT_TOLERANCE;this._viewContent=[];this._externalIntersectionHandlers=[];this.container=d;this.viewingMode=a;this.model=new w;this.view=new l(d,this,this.model.getDirtySet(),q);this._validateHUDSelector=new h(this.viewingMode);this._validateHUDSelector.enableHUDSelection=!1;this.view.setLighting({lights:[new k.MainLight(c.createFrom(.7,.7,.7)),new k.AmbientLight(c.createFrom(.3,
.3,.3))],groundLightingFactor:.5,globalFactor:.5})}return v.prototype.setNeedsRender=function(){this.view.setNeedsRender()},v.prototype.dispose=function(){this.view.dispose();this.model=this.view=null},v.prototype.frame=function(a,k){void 0===k&&(k=0);var h=Math.max(1E-6,a.getBSRadius());k=Math.max(2,k+2);k*=h;var h=this.getCamera(),b=c.create(h.viewForward);c.scale(b,-(1.5*k/Math.tan(h.fov)));c.set(a.getCenter(),h.center);c.add(h.center,b,h.eye);h=new d(h.eye,h.center,h.up);this.setCamera(h)},v.prototype.beginMod=
function(){v.DebugSettings.fineGrainedContentValidation&&this.model.validateContent()},v.prototype.endMod=function(a){void 0===a&&(a=!1);v.DebugSettings.fineGrainedContentValidation&&!a&&this.model.validateContent()},v.prototype.add=function(a,c){this.model.add(a,c);"function"==typeof c.addParentStage&&c.addParentStage(this)},v.prototype.remove=function(a,c){a=this.model.remove(a,c);return"function"==typeof a.removeParentStage&&a.removeParentStage(this),a},v.prototype.notifyDirty=function(a,c,d,b){this.model.notifyDirty(a,
c,d,b)},v.prototype.processDirty=function(){var a=this.model.getDirtySet(),c=a.getDirtyMaterials();if(a.hasDirtyGeometryRecords()||c){v.DebugSettings.endFrameContentValidation&&this.model.validateContent();v.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));var d=a.getAddRemoveUpdateListFilteredByLayers(this._viewContent,!0);(0<d[0].length+d[1].length+d[2].length||c)&&this.view.modify(d[0],d[1],d[2],c);v.DebugSettings.logDirtySet&&(console.log("RGs add: "+
d[0].map(function(a){return a.uniqueName})),console.log("RGs remove: "+d[1].map(function(a){return a.uniqueName})));a.getAddRemoveUpdateList(!0);a.clearDirtyMaterials();this.view.setNeedsRender()}},v.prototype.processDirtyLayer=function(a){var c=this.model.getDirtySet(),d=c.getDirtyMaterials();a=c.getAddRemoveUpdateListFilteredByLayers([a],!0);(0<a[0].length+a[1].length+a[2].length||d)&&this.view.modify(a[0],a[1],a[2],d);c.clearDirtyMaterials();this.view.setNeedsRender()},v.prototype.get=function(a,
c){return this.model.get(a,c)},v.prototype.getAll=function(a){return this.model.getAll(a)},v.prototype.addTextureListener=function(a){this.view.addTextureListener(a)},v.prototype.removeTextureListener=function(a){this.view.removeTextureListener(a)},v.prototype.getContainer=function(){return this.container},v.prototype.getCamera=function(){return this.view.getCamera()},v.prototype.setCamera=function(a){this.view.setCamera(a)},v.prototype.getViewParams=function(a){return this.view.getViewParams(a)},
v.prototype.setViewParams=function(a){this.view.setViewParams(a)},v.prototype.getLayers=function(){return this.model.getAll(a.LAYER)},v.prototype.setLighting=function(a){this.view.setLighting(a)},v.prototype.getCanvas=function(){return this.view.getCanvas()},v.prototype.setRenderParams=function(a){this.view.setRenderParams(a)},v.prototype.getRenderParams=function(){return this.view.getRenderParams()},v.prototype.has=function(a){return this.view.has(a)},v.prototype.getViewContent=function(){return this._viewContent.slice(0)},
v.prototype.setViewContent=function(a){var c=r.array2object(this._viewContent),d=r.array2object(a),b=r.subtractObjects(d,c),c=r.subtractObjects(c,d);this.processDirty();d=this.model.getDirtySet();b=d.getResidentRenderGeometriesFilteredByLayers(r.object2array(b));c=d.getResidentRenderGeometriesFilteredByLayers(r.object2array(c));this.view.modify(b,c,[]);this._viewContent=a.slice(0)},v.prototype.addToViewContent=function(a){for(var c=[],d=0;d<a.length;d++)-1===this._viewContent.indexOf(a[d])&&c.push(a[d]);
0<a.length&&(this.processDirty(),a=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(c),this.view.modify(a,[],[]),this._viewContent.push.apply(this._viewContent,c))},v.prototype.removeFromViewContent=function(a){this.processDirty();for(var c=this.model.getDirtySet(),d=this._viewContent,b=[],k=0;k<a.length;k++){var h=d.indexOf(a[k]);-1<h&&(d[h]=d[d.length-1],d.pop(),b.push(a[k]))}a=c.getResidentRenderGeometriesFilteredByLayers(b);this.view.modify([],a,[])},v.prototype.getViewFrustumObjects=
function(){return this.view.getFrustumObjects()},v.prototype.getLocalOrigin=function(a,c,d){return this.model.getOrigin(a,c,d)},v.prototype.getFrameTask=function(){return this.view.getFrameTask()},v.prototype.requestScreenCapture=function(a,c){this.view.requestScreenCapture(a,c)},v.prototype.getAllTexturesLoaded=function(){return this.view.getAllTexturesLoaded()},v.prototype.getTextureLoaded=function(a){return this.view.getTextureLoaded(a)},v.prototype.addExternalRenderer=function(a,c){return"function"==
typeof c.intersect&&this._externalIntersectionHandlers.push(c),this.view.addExternalRenderer(a,c)},v.prototype.removeExternalRenderer=function(a){var c=this._externalIntersectionHandlers.indexOf(a);return-1<c&&this._externalIntersectionHandlers.splice(c,1),this.view.removeExternalRenderer(a)},v.prototype.getContentDebugStrings=function(a){return this.model.formatDebugInfo(a)},v.prototype.getRenderStats=function(){return this.view.getCombinedStats()},v.prototype.getRenderStatString=function(a){var c=
this.getRenderStats(),d="";if(a){var d=d+"\x3ctable\x3e",b;for(b in c)d+="\x3ctr\x3e\x3ctd\x3e"+b+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Math.round(c[b])+"\x3c/td\x3e\x3c/tr\x3e";d+="\x3c/table\x3e"}else for(b in c)d+=b+": "+c[b]+"\n";return d},v.prototype.pick=function(a,d,k,b){var h=c.create(),l=c.create();return this.view.getPickRay(a,h,l),this.pickRay(h,l,a,a,d,k,b)},v.prototype.pickRayWithBeginPoint=function(a,c,d,b,k){this.view.pickRayWithBeginPoint(a,c,d,b,k)},v.prototype.pickRay=
function(a,d,k,b,m,l,r){b=this.view.getCamera();k||(k=t,b.projectPoint(d,k));var v;if(m){v=Array(m.length);for(var u=0;u<v.length;u++)v[u]=this.model.get(w.ContentType.LAYER,m[u])}else{v=[];m=this.getViewContent();for(var p=this.model.getAll(w.ContentType.LAYER),u=0;u<m.length;u++){var y=p[m[u]];y&&"VISIBLE"===y.getState()&&v.push(y)}}r?r.init(v,a,d,k,b,this._intersectTolerance,l):r=new h(this.viewingMode,v,a,d,k,b,this._intersectTolerance,l);for(u=0;u<this._externalIntersectionHandlers.length;u++)this._externalIntersectionHandlers[u].intersect(r,
a,d,k);if(r.getHudResults().length){u=r.getHudResults();u.sort(function(a,b){return b.dist-a.dist});d=u[u.length-1];m=C;b.projectPoint(d.center,m);m[0]=Math.round(m[0]);m[1]=Math.round(m[1]);p=q;this.view.getPickRay(m,a,p);k=c.dist(d.center,a)/c.dist(a,p)*.99;this._validateHUDSelector.init(v,a,p,m,b,this._intersectTolerance,l);for(u=0;u<this._externalIntersectionHandlers.length;u++)this._externalIntersectionHandlers[u].intersect(this._validateHUDSelector,a,p,m);a=this._validateHUDSelector.getMinResult();
(null==a.dist||k<=a.dist)&&r.getMinResult().copyFrom(d)}return r},v.prototype.getIntersectTolerance=function(){return this._intersectTolerance},v.prototype.setIntersectTolerance=function(a){void 0===a&&(a=1E-5);this._intersectTolerance=a},v.prototype.getTextureGraphicsRenderer=function(){return this.view.getTextureGraphicsRenderer()},v.DebugSettings={fineGrainedContentValidation:!1,endFrameContentValidation:!1,logDirtySet:!1},v.ModelContentType=a,v}();var t=A.create(),C=p.create(),q=c.create();return u})},
"esri/views/3d/webgl-engine/parts/View":function(){define("require exports ../../../../core/sniff ../../../../core/Logger ../lib/GLTextureRep ../lib/GLMaterialRep ../lib/ShaderSnippets ../lib/GLSLShaderRep ../lib/TextureRenderer ../lib/gl-matrix ../lib/webgl-utils ./Model ./Viewport ../materials/repository ../lib/SSAOHelperObscurance ../lib/HighlightHelper ../lib/RenderOccludedHelper ../lib/OffscreenRenderingHelper ../lib/tracer ../../../webgl/RenderingContext ../lib/ProgramRepository ../lighting/Lightsources ../../../support/screenshotUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E,J,G){var K=k.vec3d,M=k.vec4d,U=l.getLogger("esri.views.3d.webgl-engine.parts.View");return function(){function k(b,c,k,m){var l=this;this._backgroundColor=M.createFrom(1,1,1,1);this._lightDirection=K.createFrom(0,1,0);this._didRender=!1;this._idleSuspend=this._needsRender=!0;this._shouldRender=!1;this._screenCaptureQueue=[];this._container=b;this._stage=c;this._initializeContext(m);this._initializeShaders(m);this._textureRep=new h(c.getAll(t.ContentType.TEXTURE),
this._programRepository,function(){return l._viewport.getCamera().viewport},this._rctx);this._materialRep=new d(this._textureRep,this._programRepository);this._viewport=new C(this._programRepository,this._materialRep,this._textureRep,this._rctx);this._initializeViewportCamera();this._textureRenderer=new a(this._rctx,this._canvas,this._programRepository,this._materialRep,this._textureRep,k);this._initializeFrameTask()}return k.prototype._initializeFrameTask=function(){var a=this;this._frameTask={preRender:function(){(b.begin(),
a._stage.processDirty(),a.needsRender())?(a._shouldRender=!0,a._viewport.getCamera().setGLViewport(a._rctx),a._rctx.setClearColor.apply(a._rctx,a._backgroundColor),a._rctx.clear(16640)):a._shouldRender=!1},render:function(){a._shouldRender&&(a._didRender=!0,a._viewport.render(a._lightDirection,null))},postRender:function(){b.end()},update:function(){a._performScreenCaptures();a.resetNeedsRender()}}},k.prototype._initializeViewportCamera=function(){var a=this._container.getBoundingClientRect(),b=this._viewport.getCamera();
b.viewport[2]=a.width;b.viewport[3]=a.height;this._viewport.setCamera(b)},k.prototype._initializeContext=function(a){(this._canvas=a.canvas)||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var d=c.setupWebGL(this._canvas,{alpha:a.alpha||!1,antialias:!1,depth:!0,stencil:null==a.stencil?!0:a.stencil});this._gl=b.instrumentContext(d[0]);this._rctx=new m(d[0],{disabledExtensions:a.deactivatedWebGLExtensions});!a.alpha&&this._rctx.contextAttributes.alpha&&
U.error("WebGL context has alpha channel even though no alpha channel was requested");11<=w("safari")&&(this._container.style.backgroundColor="black");this._container.appendChild(this._canvas)},k.prototype._initializeShaders=function(a){this._shaderSnippets=new u({fsprecisionf:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\nprecision highp sampler2D;\n#else\nprecision mediump float;\nprecision mediump sampler2D;\n#endif\n",vsprecisionf:"\nprecision highp float;\nprecision highp sampler2D;\n",
viewingMode:"global"===a.viewingMode?"#define VIEWING_MODE_GLOBAL 1 \n":" #define VIEWING_MODE_LOCAL 1 \n"});this._shaderRep=new r;this._programRepository=new E;q.initializeShaders(this._shaderSnippets,this._shaderRep,this._programRepository,this._rctx);y.loadShaders(this._shaderSnippets,this._shaderRep,this._programRepository,this._rctx);B.loadShaders(this._shaderSnippets,this._shaderRep,this._programRepository,this._rctx);v.loadShaders(this._shaderSnippets,this._shaderRep,this._programRepository,
this._rctx);D.loadShaders(this._shaderSnippets,this._shaderRep,this._programRepository,this._rctx)},k.prototype.dispose=function(){this._viewport.dispose();this._viewport=null;this._textureRenderer.dispose();this._textureRenderer=null;this._programRepository.dispose();this._programRepository=null;this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._gl=this._canvas=this._container=null},k.prototype.getCombinedStats=function(){return this._viewport.getCombinedStats()},
k.prototype.setNeedsRender=function(){this._didRender=!1;this._needsRender=!0},k.prototype.resetNeedsRender=function(){this._didRender&&(this._needsRender=!1,this._didRender=!1);this._viewport.resetNeedsRender();this._textureRep.resetNeedsRender()},k.prototype.needsRender=function(){return this._needsRender||!this._idleSuspend||this._viewport.needsRender()||this._textureRep.needsRender()},k.prototype.getFrameTask=function(){return this._frameTask},k.prototype.setLighting=function(a){K.set3(0,0,0,
this._lightDirection);for(var b=0,c=a.lights;b<c.length;b++){var d=c[b];if(d instanceof J.MainLight){K.negate(d.direction,this._lightDirection);break}}this._viewport.setLighting(a);this._needsRender=!0},k.prototype.getMainLightDirection=function(){return this._lightDirection},k.prototype.getViewParams=function(a){var b=this._viewport.getViewParams(a);return(!a||a.backgroundColor)&&(b.backgroundColor=this._backgroundColor),b},k.prototype.setViewParams=function(a){this._needsRender=!0;a.backgroundColor&&
(this._backgroundColor=a.backgroundColor);this._viewport.setViewParams(a)},k.prototype.setRenderParams=function(a){this._needsRender=!0;void 0!==a.idleSuspend&&(this._idleSuspend=!!a.idleSuspend);this._viewport.setRenderParams(a)},k.prototype.getRenderParams=function(){var a=this._viewport.getRenderParams();return a.anisotropicFiltering=this._textureRep.getMaxAnisotropy(),a.idleSuspend=this._idleSuspend,a},Object.defineProperty(k.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,
configurable:!0}),k.prototype.has=function(a){return"s3tc"===a?!!this._rctx.extensions.compressedTextureS3TC:"standardDerivatives"===a?!!this._rctx.extensions.standardDerivatives:"shaderTextureLOD"===a?!!this._rctx.extensions.shaderTextureLOD:"angleInstancedArrays"===a?!!this._rctx.extensions.angleInstancedArrays:!1},k.prototype.getFrustumObjects=function(){return this._viewport.getFrustumObjects()},k.prototype.modify=function(a,b,c,d){this._viewport.modify(a,b,c,d)},k.prototype.setCamera=function(a){this._viewport.setCamera(a)},
k.prototype.getCamera=function(){return this._viewport.getCamera()},k.prototype.getPickRay=function(a,b,c){this._viewport.getPickRay(a,b,c)},k.prototype.pickRayWithBeginPoint=function(a,b,c,d,k){this._viewport.pickRayWithBeginPoint(a,b,c,d,k)},k.prototype.getCanvas=function(){return this._canvas},k.prototype.getTextureGraphicsRenderer=function(){return this._textureRenderer},k.prototype.requestScreenCapture=function(a,b){this._screenCaptureQueue.push({settings:a||{},callback:b});this._needsRender=
!0},k.prototype.getAllTexturesLoaded=function(){return 0===this._textureRep.getLoadingCount()},k.prototype.getTextureLoaded=function(a){return this._textureRep.getIsLoaded(a)},k.prototype.addTextureListener=function(a){this._textureRep.addTextureListener(a)},k.prototype.removeTextureListener=function(a){this._textureRep.removeTextureListener(a)},k.prototype.addExternalRenderer=function(a,b){return this._viewport.addExternalRenderer(a,b)?(b.initializeRenderContext({rctx:this._rctx,gl:this._rctx.gl,
shaderSnippets:this._shaderSnippets,shaderRep:this._shaderRep,programRep:this._programRepository,textureRep:this._textureRep}),!0):!1},k.prototype.removeExternalRenderer=function(a){return this._viewport.removeExternalRenderer(a)?(a.uninitializeRenderContext({rctx:this._rctx,gl:this._rctx.gl}),!0):!1},k.prototype._performScreenCaptures=function(){if(0!==this._screenCaptureQueue.length){for(var a=0;a<this._screenCaptureQueue.length;a++){var b=this._screenCaptureQueue[a],c=0,d=0,k=this._canvas.width,
h=this._canvas.height,m=this._canvas.width,l=this._canvas.height,q=b.settings.area;(q&&(c=q.x,d=q.y,k=q.width,h=q.height),void 0!==b.settings.width&&void 0!==b.settings.height)?(q=b.settings.width/b.settings.height,h*q<k?(q*=h,c+=Math.floor((k-q)/2),k=Math.floor(q)):(q=k/q,d+=Math.floor((h-q)/2),h=Math.floor(q)),m=b.settings.width,l=b.settings.height):(m=k,l=h);var g=this._canvas,q=null;if(0!==c||0!==d||k!==this._canvas.width||h!==this._canvas.height||m!==this._canvas.width||l!==this._canvas.height){this._resizeCanvas||
(this._resizeCanvas=document.createElement("canvas"));this._resizeCanvas.width=m;this._resizeCanvas.height=l;var e=this._resizeCanvas.getContext("2d"),q=new Uint8Array(k*h*4);this._gl.readPixels(c,this._canvas.height-(d+h),k,h,6408,5121,q);c=e.getImageData(0,0,m,l);G.resampleHermite(q,k,h,c.data,m,l,!0);e.putImageData(c,0,0);g=this._resizeCanvas;e=null}k={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"}[b.settings.format?b.settings.format.toLowerCase():"png"];h=1;void 0!==b.settings.quality&&(h=
b.settings.quality/100);k={dataURL:g.toDataURL(k,h),x:0,y:0,width:m,height:l};b.settings.returnByteBuffer&&(k.data=q);b.callback(k)}this._screenCaptureQueue=[]}},k}()})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define(["require","exports","./Util"],function(A,p,w){var l=function(){function h(d){this.refCnt=0;this.glMaterial=d}return h.prototype.incRefCnt=function(){++this.refCnt},h.prototype.decRefCnt=function(){--this.refCnt;w.assert(0<=this.refCnt)},h.prototype.getRefCnt=function(){return this.refCnt},
h.prototype.getGLMaterial=function(){return this.glMaterial},h}();return function(){function h(d,h){this.textureRep=d;this.programRep=h;this.id2glMaterialRef={}}return h.prototype.aquire=function(d){return this.aquireExt(d,"color")},h.prototype.aquireDepthShadowMap=function(d){return this.aquireExt(d,"depthShadowMap")},h.prototype.aquireDepth=function(d){return this.aquireExt(d,"depth")},h.prototype.aquireNormal=function(d){return this.aquireExt(d,"normal")},h.prototype.aquireHighlight=function(d){return this.aquireExt(d,
"highlight")},h.prototype.aquireExt=function(d,h){var r;r=d.getId()+"_"+h;var a=this.id2glMaterialRef[r];null==a?(d=(a=d.getGLMaterials()[h])?new a(d,this.programRep,this.textureRep):void 0,a=new l(d),this.id2glMaterialRef[r]=a):d=a.getGLMaterial();return a.incRefCnt(),d&&this.increaseProgramReferences(d),d},h.prototype.release=function(d){this.releaseExt(d,"color")},h.prototype.releaseDepth=function(d){this.releaseExt(d,"depth")},h.prototype.releaseNormal=function(d){this.releaseExt(d,"normal")},
h.prototype.releaseDepthShadowMap=function(d){this.releaseExt(d,"depthShadowMap")},h.prototype.releaseHighlight=function(d){this.releaseExt(d,"highlight")},h.prototype.releaseExt=function(d,h){d=d+"_"+h;h=this.id2glMaterialRef[d];if(h.decRefCnt(),0===h.getRefCnt())(h=h.getGLMaterial())&&(this.decreaseProgramReferences(h),void 0!==h.dispose&&h.dispose()),delete this.id2glMaterialRef[d]},h.prototype.updateMaterialParameters=function(d){var h=this.id2glMaterialRef[d+"_color"];h&&h.getGLMaterial()&&this.updateParamsForMat(h.getGLMaterial());
(h=this.id2glMaterialRef[d+"_depth"])&&h.getGLMaterial()&&this.updateParamsForMat(h.getGLMaterial());(h=this.id2glMaterialRef[d+"_depthShadowMap"])&&h.getGLMaterial()&&this.updateParamsForMat(h.getGLMaterial());(h=this.id2glMaterialRef[d+"_normal"])&&h.getGLMaterial()&&this.updateParamsForMat(h.getGLMaterial());(d=this.id2glMaterialRef[d+"_highlight"])&&d.getGLMaterial()&&this.updateParamsForMat(d.getGLMaterial())},h.prototype.updateParamsForMat=function(d){d.updateParameters&&d.updateParameters()},
h.prototype.increaseProgramReferences=function(d){if(d.getAllPrograms){d=d.getAllPrograms();for(var h=0;h<d.length;h++)this.programRep.increaseRefCount(d[h])}else this.programRep.increaseRefCount(d.getProgram())},h.prototype.decreaseProgramReferences=function(d){if(d.getAllPrograms){d=d.getAllPrograms();for(var h=0;h<d.length;h++)this.programRep.decreaseRefCount(d[h])}else this.programRep.decreaseRefCount(d.getProgram())},h}()})},"esri/views/3d/webgl-engine/lib/ShaderSnippets":function(){define(["require",
"exports","./Util","dojox/xml/parser"],function(A,p,w,l){return function(){function h(d){var h=w.VertexAttrConstants,l;for(l in h)this[h[l]]=w.VertexAttrConstants[l];if(d)for(var a in d)this[a]=d[a]}return h.prototype._parse=function(d){d=l.parse(d).getElementsByTagName("snippet");for(var h=/\$[a-zA-Z0-9]+[ \t]*/,r=/[\$\s]+/g,a=0;a<d.length;a++){var k=d[a].getAttribute("name");w.assert(null==this[k]);for(var c=d[a].textContent;;){var t=c.match(h);if(null==t)break;var p=this[t[0].replace(r,"")];w.assert(void 0!==
p);c=c.replace(t[0],p)}this[k]=c}},h}()})},"esri/views/3d/webgl-engine/lib/GLSLShaderRep":function(){define(["require","exports","./Util"],function(A,p,w){return function(){function l(){this.shaders={}}return l.prototype.add=function(h,d){w.assert(null==this.shaders[h]);this.shaders[h]=d},l.prototype.get=function(h){return w.assert(void 0!==this.shaders[h]),this.shaders[h]},l}()})},"esri/views/3d/webgl-engine/lib/TextureRenderer":function(){define("require exports ./Renderer ./Camera ./Util ./gl-matrix ../materials/internal/TexOnlyGLMaterial ./ModelDirtyTypesTs ./RenderPass ./HighlightUtils ./ComponentUtils ../../../webgl/FramebufferObject ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Util ../../../webgl/Texture ../../support/debugFlags ../lighting/Lightsources ../../../webgl/enums ./DefaultVertexBufferLayouts ./DefaultVertexAttributeLocations".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E){var J=d.vec3d,G=d.vec4d,K=d.mat4d;A=function(){function b(a,b,c,d,k,h){var m=this;this._acquiredTextures={};this._clearColor=G.createFrom(0,0,0,0);this._id2origin={};this._uniqueIdx=0;this._rctx=a;this._canvas=b;this._programRep=c;this._textureRep=k;this._modelDirtySet=h;this._renderer=new w(c,d,k,this._rctx,!0);this._renderer.onHasHighlightsChanged=function(a){m.onHasHighlightsChanged&&m.onHasHighlightsChanged(a)};this._renderer.setLighting({lights:[new D.AmbientLight(J.createFrom(1,
1,1))],groundLightingFactor:1,globalFactor:0})}return b.prototype.dispose=function(){for(var a in this._acquiredTextures)this._acquiredTextures[a].fbo.dispose(),this._textureRep.release(a);this._acquiredTextures=null;this._renderer.dispose();this._renderer=null},b.prototype.addRenderGeometries=function(a){var b=this;a.forEach(function(a){null==a.origin&&(a.origin=b.getOrigin(a.center,a.bsRadius));a.idx=b._uniqueIdx++});this._renderer.modify(a,[])},b.prototype.removeRenderGeometries=function(a){this._renderer.modify([],
a)},b.prototype.updateRenderGeometries=function(a,b){a=a.map(function(a){return{renderGeometry:a,updateType:b}});this._renderer.modify([],[],a,{})},b.prototype.updateRenderOrder=function(a){0<Object.keys(a).length&&this._renderer.modifyRenderOrder(a)},b.prototype.setBackgroundColor=function(a){this._clearColor=a},b.prototype.addRenderGeometryHighlight=function(a,b){var d=a.instanceParameters,h=k.generateHighlightId();return d.componentHighlights=c.addHighlight(d.componentHighlights,null,b,h),this.updateRenderGeometries([a],
32),h},b.prototype.removeRenderGeometryHighlight=function(a,b){var d=a.instanceParameters;d.componentHighlights=c.removeHighlight(d.componentHighlights,b);this.updateRenderGeometries([a],32)},b.prototype.isEmpty=function(){return this._renderer.isEmpty()},b.prototype.processDirtyMaterials=function(){var a=this._modelDirtySet.getDirtyMaterials();a&&this._renderer.modify([],[],[],a);this._modelDirtySet.clearDirtyMaterials()},Object.defineProperty(b.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},
enumerable:!0,configurable:!0}),b.prototype.draw=function(b,c){return this.drawPass(a.MATERIAL,b,c)},b.prototype.drawHighlights=function(b,c){return this.drawPass(a.MATERIAL_HIGHLIGHT,b,c)},b.prototype.drawPass=function(b,c,d){if(this.isEmpty()&&!B.OVERLAY_DRAW_TEST_TEXTURE||(this.processDirtyMaterials(),b===a.MATERIAL_HIGHLIGHT&&!this.hasHighlights)||!d.views.some(function(a){return a.extent[0]!==a.extent[2]&&a.extent[1]!==a.extent[3]}))return!1;var k,h=c.getId(),m=this._rctx,l=m.gl;if(this._acquiredTextures[h])k=
this._acquiredTextures[h].fbo;else{k=this._textureRep.aquire(h).getGLTexture();k=t.createWithAttachments(this._rctx,k,{colorTarget:0,depthStencilTarget:0});var q=Object.keys(this._acquiredTextures).length;this._acquiredTextures[h]={texture:c,fbo:k,idx:q}}c=d.width;q=d.height;k.width===c&&k.height===q||(k.resize(c,q),k.colorTexture.setSamplingMode(9729));U.near=1;U.far=1E4;m.bindFramebuffer(k);m.setDepthTestEnabled(!1);m.setBlendFunctionSeparate(770,771,1,771);m.setClearColor.apply(m,this._clearColor);
m.clear(l.COLOR_BUFFER_BIT);this._renderer.setPixelRatio(d.pixelRatio||1);for(l=0;l<d.views.length;l++)k=d.views[l],U.viewport=k.viewport,K.ortho(0,k.extent[2]-k.extent[0],0,k.extent[3]-k.extent[1],U.near,U.far,U.projectionMatrix),K.identity(U.viewMatrix),K.translate(U.viewMatrix,[-k.extent[0],-k.extent[1],0]),U.setGLViewport(this._rctx),B.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(c,q,M[this._acquiredTextures[h].idx%M.length]),this._renderer.renderGeometryPass(b,U);return m.setDepthTestEnabled(!0),
m.setBlendFunctionSeparate(770,771,1,771),m.bindFramebuffer(null),m.setViewport(0,0,this._canvas.width,this._canvas.height),!0},b.prototype._drawTestTexture=function(a,b,c){var d=this._rctx,k=d.gl;if(!this._testPatternMat){for(var h=new Uint8Array(a*b*4),l=0,t=0;b>t;t++)for(var r=0;a>r;r++){var g=Math.floor(r/10),e=Math.floor(t/10);2>g||2>e||10*g>a-20||10*e>b-20?(h[l++]=255,h[l++]=255,h[l++]=255,h[l++]=255):(h[l++]=255,h[l++]=255,h[l++]=255,1&g&&1&e?h[l++]=1&r^1&t?0:255:h[l++]=1&g^1&e?0:128)}a=new y(d,
{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:a,height:b},h);this._testPatternMat=new u(this._programRep,a,[1,1,1,1],!0,k.ALWAYS);this._testPatternBindParams={proj:K.identity(),view:K.identity(),nearFar:[-1,1],origin:[0,0,0]};k=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,1,1,0,1,1]);this._quadVAO=new C(d,E.Default3D,{geometry:m.Pos3Tex},{geometry:q.createVertex(d,35044,k)})}this._testPatternMat.setColor([c[0],c[1],c[2],1]);this._testPatternMat.bind(d,this._testPatternBindParams);
this._testPatternMat.bindView(d,this._testPatternBindParams);d.bindVAO(this._quadVAO);d.drawArrays(5,0,v.vertexCount(this._quadVAO,"geometry"));this._testPatternMat.release(d)},b.prototype.getOrigin=function(a,b){var c=0;b=10*b/1E4;1<b&&(c=Math.ceil(h.logWithBase(b,2)));b=1E4*Math.pow(2,c);var d=Math.round(a[0]/b),k=Math.round(a[1]/b);a=Math.round(a[2]/b);var c=c+"_"+d+"_"+k+"_"+a,m=this._id2origin[c];return null==m&&(m={vec3:J.createFrom(d*b,k*b,a*b),id:c},this._id2origin[c]=m),m},b}();var M=[[1,
.5,.5],[.5,.5,1],[.5,1,.5]],U=new l;return A})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("require exports ./IntervalUtilities ./ModelDirtyTypesTs ./Float32ArrayList ./InstanceBufferData ../lighting/SceneLighting ./LinearDepthTextureHelper ./NormalTextureHelper ./HighlightTextureHelper ./RenderPass ./RenderSlot ./RenderContext ./ExternalRendererContainer ./StencilRenderingHelper ./Util ./gl-matrix ./ComponentUtils ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Util ./FxaaRenderPass ./SmaaRenderPass ../../../webgl/enums ./DefaultVertexAttributeLocations ../../../webgl/Profiling ../materials/HUDMaterial".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E,J,G,K,M,U,N,W){function R(a){return D.generateVisibleIndexRanges(a.instanceParameters.componentVisibilities,a.componentOffsets)}function V(a,b,c){var d=a.origin.vec3;g(P,-d[0],-d[1],-d[2]);e.multiply(P,a.transformation,b);e.inverse(b,c);e.transpose(c)}function Q(a,e,b){for(var c in a){var d=a[c];e(c,d);for(var f in d.origin2data)b(f,d.origin2data[f])}}function S(a){return!1===a.preinterleaved?O(a.indices).length:a.indexCount}var X,z=y.assert,Z=y.objectEmpty,
O=y.getFirstObjectValue,g=y.setMatrixTranslation3;A=B.vec2d;var e=B.mat4d,f=y.VertexAttrConstants,n=e.identity();y=function(){function l(e,b,c,d,f){this._lighting=new u.SceneLighting;this._mat2DataMerged={};this._mat2DataInstanced={};this._mat2DataPreinterleaved={};this._renderOrder=[];this._externalRenderers=new q;this._renderContext=new C;this._isRendering=!1;this._highlights=[];this._pixelRatio=1;this._threshold=1535;this._needsRender=!0;this._fallbackDepthStencilTexture=null;this._stats=new x;
this.ssaoEnabled=!1;this.renderOptions={antialiasing:"smaa",earlyOcclusionPixelDraw:!1};this._programRep=e;this._materialRep=b;this._orderedRendering=f;this._rctx=d;this._fxaaPass=new G(d);this._smaaPass=new K(d);this._renderContext.lightingData=this._lighting.getOld();d.setDepthTestEnabled(!0);d.setFaceCullingEnabled(!0);d.setBlendingEnabled(!1);d.setBlendFunctionSeparate(770,771,1,771);this._bindParameters={view:null,proj:null,viewInvTransp:null,nearFar:null,lightingData:null,viewport:null,framebufferTex:null,
shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null,instanceParameters:null,depthFBO:null,normalFBO:null,extensions:{angleInstancedArrays:d.extensions.angleInstancedArrays}};this._linearDepthTextureHelper=new r(d);this._normalTextureHelper=new a(d);this._highlightTextureHelper=new k(d);this._stencilRenderingHelper=new v(d);this._initializeFramebufferTexture()}return l.prototype._initializeFramebufferTexture=function(){var a=this._rctx.gl,a=this._rctx.contextAttributes.alpha?a.RGBA:
a.RGB,e=new b(this._rctx,{target:3553,pixelFormat:a,dataType:5121,samplingMode:9728,wrapMode:33071,width:4,height:4});this._framebuffer={format:a,texture:e}},l.prototype.dispose=function(){var a=this,e=function(e){a._releaseMaterials(e)},b=function(a,e){if(e.type===X.Preinterleaved)for(var b in e.instances)e.instances[b].vao.dispose(!0);else e.vao.dispose(!0)};Q(this._mat2DataMerged,e,b);Q(this._mat2DataInstanced,e,b);Q(this._mat2DataPreinterleaved,e,b);this._mat2DataPreinterleaved=this._mat2DataInstanced=
this._mat2DataMerged=null;this._framebuffer.texture.dispose();this._framebuffer.texture=null;this._linearDepthTextureHelper.getEnableState()&&this._linearDepthTextureHelper.disable();this._normalTextureHelper.getEnableState()&&this._normalTextureHelper.disable();this._highlightTextureHelper.getEnableState()&&this._highlightTextureHelper.setEnableState(!1);this._stencilRenderingHelper.getEnableState()&&this._stencilRenderingHelper.setEnableState(!1);this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),
this._fallbackDepthStencilTexture=null)},l.prototype.setLighting=function(a){this._lighting.set(a)},l.prototype.setPixelRatio=function(a){this._pixelRatio=a;this._needsRender=!0},l.prototype.getPixelRatio=function(){return this._pixelRatio},l.prototype.addExternalRenderer=function(a,e){return this._externalRenderers.addRenderer(a,e),!0},l.prototype.removeExternalRenderer=function(a){return this._externalRenderers.removeRenderer(a),!0},l.prototype.getExternalRenderers=function(){return this._externalRenderers},
l.prototype.resetNeedsRender=function(){this._needsRender=!1;this._externalRenderers.resetNeedsRender()},l.prototype.needsRender=function(){return this._needsRender||this._externalRenderers.needsRender()},l.prototype.getCombinedStats=function(){var a=this;this._stats.VBOallocatedSize=0;this._stats.VBOoptimalSize=0;this._stats.VBOusedSize=0;var e=function(){},b=function(e,b){if(b.type===X.Preinterleaved)for(var c in b.instances)e=b.instances[c].buffer,a._stats.VBOallocatedSize+=e.length,a._stats.VBOusedSize+=
e.length,a._stats.VBOoptimalSize+=e.length;else a._stats.VBOallocatedSize+=b.buffer.getArray().length,a._stats.VBOusedSize+=b.buffer.getSize(),a._stats.VBOoptimalSize+=b.optimalCount};return Q(this._mat2DataMerged,e,b),Q(this._mat2DataInstanced,e,b),Q(this._mat2DataPreinterleaved,e,b),this._stats.VBOallocatedSize*=.00390625,this._stats.VBOusedSize*=.00390625,this._stats.VBOoptimalSize*=.00390625,this._stats},l.prototype._addHighlight=function(a){var e=this._getInstance(a);return null===e?void console.error("No instance found for RenderGeometry {name: '"+
a.name+"', uniqueName: '"+a.uniqueName+"'}"):(this._highlights.push(e),this._orderedRendering&&this._sortHighlightsByRenderOrder(),this._needsRender=!0,void(this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights)))},l.prototype._removeHighlight=function(a){var e=this._highlights.length;this._highlights=this._highlights.filter(function(e){return e.uniqueName!==a.uniqueName});e!==this._highlights.length&&(this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights),
this._needsRender=!0)},Object.defineProperty(l.prototype,"hasHighlights",{get:function(){return 0<this._highlights.length},enumerable:!0,configurable:!0}),l.prototype._renderHUDVisibility=function(a){var e=this,b=W.shouldRenderVisibilityDuringRenderPass(a.pass),c=a.offscreenRenderingHelper&&a.offscreenRenderingHelper.getEnableState();b&&c&&a.offscreenRenderingHelper.renderHUDVisibility(function(){e._renderInternalSlot(t.OCCLUSION_PIXELS,a)})},l.prototype.renderGeometrySlots=function(a){this._externalRenderers.render(t.INTERNAL_MATERIAL,
a);this._renderInternalSlot(t.STENCIL_MATERIAL,a);this._externalRenderers.render(t.OPAQUE_TERRAIN,a);this._renderInternalSlot(t.OPAQUE_MATERIAL,a);this._externalRenderers.render(t.OPAQUE_EXTERNAL,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep);this._renderInternalSlot(t.TRANSPARENT_MATERIAL,a);this.renderOptions.earlyOcclusionPixelDraw&&(this._renderHUDVisibility(a),this._renderInternalSlot(t.LINE_CALLOUTS,this._renderContext));this._externalRenderers.render(t.TRANSPARENT_EXTERNAL,a);a.ssaoHelper&&
a.ssaoHelper.bindAll(this._programRep);this._externalRenderers.render(t.TRANSPARENT_TERRAIN,a)},l.prototype._renderHighlights=function(a,e,b){var d=!!b&&b.getEnableState()&&(this.hasHighlights||this._externalRenderers.needsHighlight());if(this._highlightTextureHelper.setEnableState(d),d){d=null;b.profilingCallback&&(d=N.startMeasurement(this._renderContext.rctx));this._highlightTextureHelper.setupFBOs(a);this._highlightTextureHelper.prepareHighlightPass();this.renderGeometryPass(c.MATERIAL_HIGHLIGHT,
a,null,null);this._rctx.clear(this._rctx.gl.DEPTH_BUFFER_BIT);this._renderInternalSlot(t.LINE_CALLOUTS_HUD_DEPTH,this._renderContext);this._renderInternalSlot(t.HUDMATERIAL1,this._renderContext);this._renderInternalSlot(t.HUDMATERIAL2,this._renderContext);this._highlightTextureHelper.finish(e);var f=this._highlightTextureHelper.getHighlightFBO();b.render(a,e,f);null!==d&&b.profilingCallback&&d.stop(function(a){b.profilingCallback&&b.profilingCallback(a)})}},l.prototype._needsRenderOccluded=function(a){for(var e in this._mat2DataInstanced){var b=
this._mat2DataInstanced[e][0];if(b&&b.isRenderOccluded()&&b.beginSlot(a)&&b.isVisible())return!0}return!1},l.prototype._renderOccluded=function(a,e,b){if(e&&b&&b.getEnableState()){var d=this._needsRenderOccluded(t.OPAQUE_MATERIAL)||this._needsRenderOccluded(t.TRANSPARENT_MATERIAL);if(d!==e.getEnableState()&&e.setEnableState(d),d)d=this._renderContext,e.setupFBOs(a),e.prepareColorPass(),d.pass=c.MATERIAL,d.renderOccludedOnly=!0,this._renderInternalSlot(t.OPAQUE_MATERIAL,d),this._renderInternalSlot(t.TRANSPARENT_MATERIAL,
d),d.renderOccludedOnly=!1,e.finish(b.getFramebuffer()),e.apply()}},l.prototype._renderUnordered=function(a,b,d,f){var g=this._rctx;this._isRendering=!0;this._stats.reset();this._updateGlobalUniforms(a.projectionMatrix);this._renderContext.pass=c.MATERIAL;this._renderContext.camera=a;this._renderContext.shadowMap=b;this._renderContext.ssaoHelper=f.ssao;this._renderContext.offscreenRenderingHelper=f.offscreenRendering;this._renderContext.stencilRenderingHelper=this._stencilRenderingHelper;this._renderContext.depth=
this._linearDepthTextureHelper.getDepthFBO();this._renderContext.normals=this._normalTextureHelper.getNormalFBO();this._renderContext.highlight=this._highlightTextureHelper.getHighlightFBO();this._renderContext.options=this.renderOptions;this._renderContext.rctx=this._rctx;this._renderContext.lightingData=this._lighting.getOld();f.offscreenRendering.setEnableState(!0);f.offscreenRendering.initializeFrame(a);this._externalRenderers.render(t.BACKGROUND,this._renderContext);this.renderGeometrySlots(this._renderContext);
this._externalRenderers.render(t.POSTPROCESSING_ATMOSPHERE,this._renderContext);this._externalRenderers.render(t.POSTPROCESSING_EXTERNAL,this._renderContext);this.renderOptions.earlyOcclusionPixelDraw||(this._renderHUDVisibility(this._renderContext),this._renderInternalSlot(t.LINE_CALLOUTS,this._renderContext));this._renderOccluded(a,f.renderOccluded,f.offscreenRendering);b=this.renderOptions.antialiasing;"smaa"===b&&this._smaaPass.ensureEnabled()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:f.offscreenRendering.getColorTexture()},
null)):"fxaa"===b&&this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:f.offscreenRendering.getColorTexture()},null)):(b=a.viewport,b=e.ortho(b[0],b[2],b[1],b[3],-1,1),f.offscreenRendering.drawQuad(b),this._fxaaPass.disable(),this._smaaPass.disable());g.bindFramebuffer(null);this._renderContext.framebufferTex=f.offscreenRendering.getColorTexture();this._renderInternalSlot(t.LINE_CALLOUTS_HUD_DEPTH,this._renderContext);this._renderInternalSlot(t.HUDMATERIAL1,this._renderContext);
this._renderInternalSlot(t.HUDMATERIAL2,this._renderContext);this._renderHighlights(a,d,f.highlight);this._isRendering=!1},l.prototype._renderGeometryPassOrderedHighlight=function(a){this._renderInternalHighlights(this._highlights)},l.prototype._renderGeometryPassOrderedMaterial=function(a){for(var e=null,b=0;b<this._renderOrder.length;b++){var c=this._renderOrder[b][1];if(c.instanced){var d=c.instanced||c.merged,f=d[a.pass];f&&f.isVisible()&&(this._renderInternalInstanced(d,f,this._bindParameters,
1/0),e=null)}c.merged&&(d=c.merged,(f=d[a.pass])&&f.isVisible()&&(c=f.getProgram(),c!==e&&(c.setUniformMatrix4fv("model",n),c.hasUniform("modelNormal")&&c.setUniformMatrix4fv("modelNormal",n)),e=c,this._renderInternalMerged(d,f,this._bindParameters,1/0)))}},l.prototype._renderGeometryPassOrdered=function(a){var e=a.camera;this._bindParameters.view=e.viewMatrix;this._bindParameters.proj=e.projectionMatrix;this._bindParameters.viewInvTransp=e.viewInverseTransposeMatrix;L[0]=e.near;L[1]=e.far;this._bindParameters.nearFar=
L;this._bindParameters.lightingData=this._lighting.getOld();this._bindParameters.viewport=e.fullViewport;this._bindParameters.framebufferTex=this._framebuffer.texture;this._bindParameters.pixelRatio=this._pixelRatio;this._bindParameters.instanceParameters=void 0;this._bindParameters.depthFBO=this._linearDepthTextureHelper.getDepthFBO();this._bindParameters.normalFBO=this._normalTextureHelper.getNormalFBO();a.isHighlightPass?this._renderGeometryPassOrderedHighlight(a):this._renderGeometryPassOrderedMaterial(a)},
l.prototype._renderOrdered=function(a,e){this._stats.reset();this.renderGeometryPass(a,e)},l.prototype.render=function(a,e,b){this._orderedRendering?this._renderOrdered(c.MATERIAL,a):this._renderUnordered(a,b.shadowMap,e,b)},l.prototype.renderAuxiliaryBuffers=function(a,e,b){var d=b.ssao;b=b.shadowMap;var f=this.ssaoEnabled||this._externalRenderers.needsLinearDepth();this._linearDepthTextureHelper.setEnableState(f);f&&(this._linearDepthTextureHelper.setupFBOs(a),this._linearDepthTextureHelper.prepareDepthPass(),
this.renderGeometryPass(c.MATERIAL_DEPTH,a,b,d),this._linearDepthTextureHelper.finish(e));this._normalTextureHelper.setEnableState(this.ssaoEnabled);this.ssaoEnabled&&(this._normalTextureHelper.setupFBOs(a),this._normalTextureHelper.prepareNormalPass(),this.renderGeometryPass(c.MATERIAL_NORMAL,a,b,d),this._normalTextureHelper.finish(e));this.ssaoEnabled&&d.computeSSAO(a,e,this._linearDepthTextureHelper.getDepthFBO(),this._normalTextureHelper.getNormalFBO());d.bindAll(this._programRep)},l.prototype.renderGeometryPass=
function(a,e,b,c){this._isRendering=!0;this._updateGlobalUniforms(e.projectionMatrix);this._renderContext.pass=a;this._renderContext.camera=e;this._renderContext.shadowMap=b;this._renderContext.ssaoHelper=c;this._renderContext.depth=this._linearDepthTextureHelper.getDepthFBO();this._renderContext.normals=this._normalTextureHelper.getNormalFBO();this._renderContext.rctx=this._rctx;this._orderedRendering?this._renderGeometryPassOrdered(this._renderContext):this._renderGeometryPassUnordered(this._renderContext);
this._isRendering=!1},l.prototype._renderGeometryPassUnordered=function(a){this.renderGeometrySlots(a)},l.prototype._renderInternalHighlights=function(a,e){void 0===e&&(e=null);for(var b=0;b<a.length;++b){var d=a[b],f=d.matData[c.MATERIAL_HIGHLIGHT];f&&(null===e||f.beginSlot(e))&&f.isVisible()&&this._renderInternalHighlight(d,this._bindParameters,c.MATERIAL_HIGHLIGHT)}},l.prototype._renderInternalSlotOccluded=function(a,e){for(var b in this._mat2DataInstanced){var c=this._mat2DataInstanced[b],d=c[e.pass];
d&&d.isRenderOccluded()&&d.beginSlot(a)&&d.isVisible()&&this._renderInternalInstanced(c,d,this._bindParameters,a)}},l.prototype._renderInternalSlotMaterial=function(a,e){for(var b in this._mat2DataInstanced){var c=this._mat2DataInstanced[b],d=c[e.pass];d&&d.beginSlot(a)&&d.isVisible()&&this._renderInternalInstanced(c,d,this._bindParameters,a)}for(var c=this._programRep.getProgramsUsingUniform("model"),d=this._programRep.getProgramsUsingUniform("modelNormal"),f=0;f<c.length;f++){var g=c[f];g.setUniformMatrix4fv("model",
n);-1<d.indexOf(g)&&g.setUniformMatrix4fv("modelNormal",n)}for(b in this._mat2DataMerged)c=this._mat2DataMerged[b],(d=c[e.pass])&&d.beginSlot(a)&&d.isVisible()&&this._renderInternalMerged(c,d,this._bindParameters,a);for(b in this._mat2DataPreinterleaved)c=this._mat2DataPreinterleaved[b],(d=c[e.pass])&&d.beginSlot(a)&&d.isVisible()&&this._renderInternalPreinterleaved(c,d,this._bindParameters,a);a===t.STENCIL_MATERIAL&&this._stencilRenderingHelper.finish()},l.prototype._renderInternalSlotHighlights=
function(a,e){this._renderInternalHighlights(this._highlights,a)},l.prototype._renderInternalSlot=function(a,e){this._bindParameters.view=e.camera.viewMatrix;this._bindParameters.proj=e.camera.projectionMatrix;this._bindParameters.viewInvTransp=e.camera.viewInverseTransposeMatrix;this._bindParameters.cameraAboveGround=e.camera.aboveGround;this._bindParameters.fovY=e.camera.fovY;this._bindParameters.poiDistance=e.camera.distance;L[0]=e.camera.near;L[1]=e.camera.far;var b=this._renderContext.offscreenRenderingHelper;
this._bindParameters.nearFar=L;this._bindParameters.lightingData=this._lighting.getOld();this._bindParameters.viewport=e.camera.fullViewport;this._bindParameters.framebufferTex=b?b.getColorTexture():null;this._bindParameters.shadowMap=e.shadowMap;this._bindParameters.shadowMappingEnabled=!!e.shadowMap&&e.shadowMap.getEnableState();this._bindParameters.ssaoEnabled=!!e.ssaoHelper&&e.ssaoHelper.getEnableState();this._bindParameters.pixelRatio=this._pixelRatio;this._bindParameters.instanceParameters=
void 0;this._bindParameters.depthFBO=this._linearDepthTextureHelper.getDepthFBO();this._bindParameters.hudVisibilityTexture=b?b.getHUDVisibilityTexture():null;e.isHighlightPass?this._renderInternalSlotHighlights(a,e):e.renderOccludedOnly?this._renderInternalSlotOccluded(a,e):this._renderInternalSlotMaterial(a,e)},l.prototype._renderInternalInstanced=function(a,e,b,c){var d=this._rctx,f=d.gl,g=!1,k=e.getDrawMode(d),h=this._bindParameters.extensions.angleInstancedArrays,m;for(m in a.origin2data){var n=
a.origin2data[m];b.origin=n.origin;c===t.STENCIL_MATERIAL&&(this._stencilRenderingHelper.setEnableState(!0),this._stencilRenderingHelper.prepareStencilWritePass());var l=!1;if(e.instanced)for(var q in n.perGeometryDataInfo){var r=n.perGeometryDataInfo[q];g||(e.bind(d,b),g=!0);d.bindVAO(r.vao);var v=e.getProgram();J.assertCompatibleVertexAttributeLocations(r.vao,v);l||(e.bindView(d,b),l=!0);var v=r.to-r.from,u=r.refCount;k===f.TRIANGLES&&(this._stats.trianglesRendered+=u*v/3);h.drawArraysInstancedANGLE(k,
r.from,v,u);this._stats.drawCallsAngleInstanced++;this._stats.instancesDrawnAngle+=u}else{var r=n.instances,p;for(p in r)v=r[p],(u=v.displayedIndexRange)&&0===u.length||(g||(e.bind(d,b),g=!0),l||(d.bindVAO(n.vao),e.bindView(d,b),l=!0),e.bindInstance(d,v),this._stats.drawCallsInstanced++,k===f.TRIANGLES&&(this._stats.trianglesRendered+=(v.to-v.from)/3),u?this._drawArraysFaceRange(u,v.from,k):d.drawArrays(k,v.from,v.to-v.from))}}d.bindVAO(null);g&&e.release(d,b)},l.prototype._renderInternalHighlight=
function(a,e,b){var c=this._rctx,d=c.gl;b=a.matData[b];var f=b.getDrawMode(c),g=a.instance,k=g.highlightedIndexRange,h=this._renderContext.offscreenRenderingHelper,h=(h?h.getDepthTexture():null)||this._getFallbackDepthTexture(),m=b.getProgram(),l=this._bindParameters.extensions.angleInstancedArrays;if(e.origin=a.originData.origin,b.instanced&&a.type===X.Instanced)for(a=a.instancedVAO,b.bind(c,e),c.bindVAO(a),J.assertCompatibleVertexAttributeLocations(a,m),b.bindView(c,e),a=0;a<k.length;a++){var q=
k[a],t=q.range?q.range[0]+g.from:g.from,q=q.range?q.range[1]-q.range[0]+1:g.to-g.from;c.bindTexture(h,5);m.setUniform1i("depthTex",5);m.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]);l.drawArraysInstancedANGLE(f,t,q,1);f===d.TRIANGLES&&(this._stats.trianglesRendered+=1*q/3);this._stats.drawCallsHighlight++}else if(a.type===X.Instanced&&b.instanced)console.error("_renderInternalHighlight: incompatible instance type");else{switch(b.bind(c,
e),b.bindView(c,e),a.type){case X.Merged:l=a.originData;c.bindVAO(l.vao);m.setUniformMatrix4fv("model",n);break;case X.Instanced:l=a.originData;c.bindVAO(l.vao);b.bindInstance(c,g);break;case X.Preinterleaved:l=a.originData,a=l.instances[a.uniqueName].vao,c.bindVAO(a),b.bindInstance(c,g)}for(a=0;a<k.length;a++)q=k[a],t=q.range?q.range[0]+g.from:g.from,q=q.range?q.range[1]-q.range[0]+1:g.to-g.from,c.bindTexture(h,5),b.getProgram().setUniform1i("depthTex",5),m.setUniform4f("highlightViewportPixelSz",
0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]),c.drawArrays(f,t,q),f===d.TRIANGLES&&(this._stats.trianglesRendered+=q/3),this._stats.drawCallsHighlight++}c.bindVAO(null);b.release(c,e)},l.prototype._drawArraysFaceRange=function(a,e,b){for(var c=this._rctx,d=0;d<a.length;d++){var f=a[d];c.drawArrays(b,f[0]+e,f[1]-f[0]+1)}this._stats.drawCallsFragmented+=a.length-1},l.prototype._renderInternalMerged=function(a,e,b,c){var d=this._rctx,f=d.gl,g=!1,k;for(k in a.origin2data){var h=
a.origin2data[k];if(b.origin=h.origin,c===t.STENCIL_MATERIAL&&(this._stencilRenderingHelper.setEnableState(!0),this._stencilRenderingHelper.prepareStencilWritePass()),!h.displayedIndexRange||0!==h.displayedIndexRange.length){g||(e.bind(d,b),g=!0);var m=e.getProgram();d.bindVAO(h.vao);J.assertCompatibleVertexAttributeLocations(h.vao,m);e.bindView(d,b);this._stats.drawCallsMerged++;m=e.getDrawMode(d);m===f.TRIANGLES&&(this._stats.trianglesRendered+=h.vao.vertexBuffers.geometry.size/3);h.displayedIndexRange?
this._drawArraysFaceRange(h.displayedIndexRange,0,m):d.drawArrays(m,0,J.vertexCount(h.vao,"geometry"))}}g&&e.release(d,b)},l.prototype._renderInternalPreinterleaved=function(a,e,b,c){var d=this._rctx,f=d.gl,g=!1,k=e.getDrawMode(d),h;for(h in a.origin2data){var m=a.origin2data[h];b.origin=m.origin;var n=!1;c===t.STENCIL_MATERIAL&&(this._stencilRenderingHelper.setEnableState(!0),this._stencilRenderingHelper.prepareStencilWritePass());for(var l in m.instances){var q=m.instances[l],r=q.instance,q=q.vao,
v=r.displayedIndexRange;if(!v||0!==v.length){g||(e.bind(d,b),g=!0);var u=e.getProgram();J.assertCompatibleVertexAttributeLocations(q,u);d.bindVAO(q);n||(e.bindView(d,b),n=!0);e.bindInstance(d,r);this._stats.drawCallsPreinterleaved++;k===f.TRIANGLES&&(this._stats.trianglesRendered+=(r.to-r.from)/3);v?this._drawArraysFaceRange(v,r.from,k):d.drawArrays(k,r.from,r.to-r.from)}}}d.bindVAO(null);g&&e.release(d,b)},l.prototype._updateGlobalUniforms=function(a){for(var e=this._programRep.getProgramsUsingUniform("proj"),
b=0;b<e.length;b++)e[b].setUniformMatrix4fv("proj",a);if(this._lighting){e=this._programRep.getProgramsUsingUniform("lightingMainDirection");for(b=0;b<e.length;b++)this._lighting.setUniforms(e[b]);e=this._programRep.getProgramsUsingUniform("lightDirection");for(b=0;b<e.length;b++)this._lighting.setUniforms(e[b])}},l.prototype.print=function(){var a=Object.keys(this._mat2DataMerged).length,e=Object.keys(this._mat2DataInstanced).length,b=Object.keys(this._mat2DataPreinterleaved).length;console.log("number of materials (merged/instanced/preinterleaved): "+
a+"/"+e+"/"+b);var c=0;Q(this._mat2DataMerged,function(){},function(a,e){c+=Object.keys(e.instances).length});var d=0;Q(this._mat2DataInstanced,function(){},function(a,e){d+=Object.keys(e.instances).length});var f=0;Q(this._mat2DataPreinterleaved,function(){},function(a,e){f+=Object.keys(e.instances).length});console.log("number of instances (merged/instanced/preinterleaved): "+c+"/"+d+"/"+f)},l.prototype.isEmpty=function(){for(var a in this._mat2DataInstanced){var e=this._mat2DataInstanced[a],b;
for(b in e.origin2data)if(!Z(e.origin2data[b].instances))return!1}for(a in this._mat2DataMerged)for(b in e=this._mat2DataMerged[a],e.origin2data)if(!Z(e.origin2data[b].instances))return!1;for(a in this._mat2DataPreinterleaved)for(b in e=this._mat2DataPreinterleaved[a],e.origin2data)if(!Z(e.origin2data[b].instances))return!1;return!0},l.prototype.modify=function(a,e,b,c){this._isRendering&&console.warn("Renderer.modify called while rendering");var d=[],f=[],g=[];this._classifyRenderGeometry(a,d,f,
g);a=[];var k=[],h=[];this._classifyRenderGeometry(e,a,k,h);var m={};b&&this._performUpdates(b,m);b=[];this._modifyMerged(d,a,b,m);this._modifyInstanced(f,k,b);this._modifyPreinterleaved(g,h,b);this._updateMergedFaceranges(m);this._releaseMaterials(b);d=this._highlights.length;e&&0<e.length&&0<d&&(this._highlights=this._highlights.filter(function(a){return!e.some(function(e){return e.uniqueName===a.uniqueName})}),d!==this._highlights.length&&this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights));
this._updateHighlightVAOs();this._modifyMaterials(c);this._needsRender=!0},l.prototype._classifyRenderGeometry=function(a,e,b,c){for(var d=0;d<a.length;d++){var f=a[d];if(1<=S(f.data))switch(this._getType(f)){case X.Merged:e.push(f);break;case X.Instanced:b.push(f);break;case X.Preinterleaved:c.push(f)}}},l.prototype._performUpdates=function(a,e){for(var b=0;b<a.length;b++){var c=a[b],d=c.updateType,c=c.renderGeometry,f=this._getType(c)===X.Merged;if(1<=S(c.data)){if(2&d&&this._updateFaceranges(c,
e),32&d){var g=this._getInstance(c);g&&this._updateHighlightFaceranges(c,g.instance)}4&d||f&&16&d?this._updateVertexAttributes(c,!f):!f&&16&d?this._updateInstanceTransformation(c):8&d&&this._updateColorAttributes(c)}}},l.prototype._updateFaceranges=function(a,e){var b,c=a.material.getId(),d=a.origin.id,f=this._getType(a);if(f===X.Preinterleaved){var g=this._getOriginData(f,c,d);b=g.instances[a.uniqueName].instance}else g=this._getOriginData(f,c,d),(b=g.instances[a.uniqueName])&&f===X.Merged&&(e[this._modifiedMergedFacerangesKey(c,
d)]=g);b&&(b.displayedIndexRange=R(a),this._updateHighlightFaceranges(a,b))},l.prototype._updateHighlightFaceranges=function(a,e){if(e){var b=e.highlightedIndexRange,c;c=D.generateHighlightedIndexRanges(a.instanceParameters.componentVisibilities,a.instanceParameters.componentHighlights,a.componentOffsets);(e.highlightedIndexRange=c)&&!b?this._addHighlight(a):!c&&b&&this._removeHighlight(a)}},l.prototype._updateMergedFaceranges=function(a){for(var e in a){var b=a[e];b.displayedIndexRange=[];var c=
b.instances,d=!0,f;for(f in c){var g=c[f];g.displayedIndexRange?(b.displayedIndexRange.push.apply(b.displayedIndexRange,w.offsetIntervals(g.displayedIndexRange,g.from)),d=!1):b.displayedIndexRange.push([g.from,g.to-1])}d?b.displayedIndexRange=null:b.displayedIndexRange=w.mergeIntervals(b.displayedIndexRange)}},l.prototype._updateVertexAttributes=function(a,e){var b,c,d,f=a.material;b=f.getId();c=a.origin.id;var g=J.getStride(f.getVertexBufferLayout())/4;d=this._getType(a);if(d===X.Preinterleaved)d=
this._getOriginData(d,b,c),e=d.instances[a.uniqueName],b=e.instance,c=e.buffer,d=e.vao;else{d=this._getOriginData(d,b,c);b=d.instances[a.uniqueName];c=d.buffer.getArray();d=d.vao;var k=void 0,h=void 0;e||(V(a,Y,fa),k=Y,h=fa);f.fillInterleaved(a.data,k,h,a.instanceParameters,c,b.from*g)}z(b.from+f.getOutputAmount(S(a.data))/g===b.to,"material VBO layout has changed");d.vertexBuffers.geometry.setSubData(c,b.from*g*4,b.from*g*4,b.to*g*4)},l.prototype._updateInstanceTransformation=function(a){var e=this._getType(a),
b=a.material.getId(),c=a.origin.id;if(e===X.Preinterleaved)e=this._getOriginData(e,b,c),c=e.instances[a.uniqueName].instance,V(a,c.transformation,c.transformationNormal);else if(e=this._getOriginData(e,b,c),c=e.instances[a.uniqueName],e=e.perGeometryDataInfo[a.data.id],b=e.instanceBufferData,V(a,c.transformation,c.transformationNormal),b)a=b.getSlot(a.idx),b.fill(a,0,c.transformation),b.fill(a,16,c.transformationNormal),a=4*b.getOffset(a),c=J.getStride(e.vao.layout.instance),e.vao.vertexBuffers.instance.setSubData(b.getArray(),
a,a,a+c)},l.prototype._updateColorAttributes=function(a){var e,b,c,d=a.material;e=d.getId();b=a.origin.id;var g=J.getStride(d.getVertexBufferLayout())/4;c=this._getType(a);if(c===X.Preinterleaved){c=this._getOriginData(c,e,b);var k=c.instances[a.uniqueName];e=k.instance;b=k.buffer;c=k.vao}else{c=this._getOriginData(c,e,b);e=c.instances[a.uniqueName];b=c.buffer.getArray();c=c.vao;var h=(k={},k[f.COLOR]=!0,k[f.SYMBOLCOLOR]=!0,k);d.fillInterleaved(a.data,void 0,void 0,a.instanceParameters,b,e.from*g,
h)}z(e.from+d.getOutputAmount(S(a.data))/g===e.to,"material VBO layout has changed");c.vertexBuffers.geometry.setSubData(b,e.from*g*4,e.from*g*4,e.to*g*4)},l.prototype._modifyMerged=function(a,b,c,d){var f=this._rctx,k=X.Merged;a=this._compMat2delta(a,b,k);b=this._mat2DataMerged;for(var n in a){var l=a[n],q;for(q in l){var t=l[q],r=t.optimalCount,v=t.material,u=v.getVertexBufferLayout(),p=J.getStride(u)/4,y=b[n];if(null==y){z(0<r);var x=v.getRenderPriority(),y=this._initializeMatData(v);b[n]=y;this._orderedRendering&&
this._insertIntoRenderOrder(y,x,"merged")}x=y.origin2data[q];if(null==x&&(z(0<r),x={type:k,instances:{},vao:new m(f,U.Default3D,{geometry:u},{geometry:E.createVertex(f,35044)}),buffer:new h(r),optimalCount:0,origin:t.origin},y.origin2data[q]=x),0<r){var u=x.buffer.getSize(),C=x.buffer.getArray(),y=r<t.sparseCount/2,B=x.buffer.resize(y?r:t.sparseCount),w=t.toRemove;if(y||B){for(var u=0,D=x.buffer.getArray(),y=0;y<w.length;++y)B=x.instances[w[y].uniqueName],x.optimalCount-=(B.to-B.from)*p,delete x.instances[w[y].uniqueName];
var y={},G;for(G in x.instances)B=x.instances[G],z(null==y[B.from]),y[B.from]=B;for(var K in y){var B=y[K],M=B.from*p,A=B.to*p;D.set(C.subarray(M,A),u);B.from=u/p;u+=A-M;B.to=u/p}z(u===x.optimalCount)}else for(y=0;y<w.length;++y)B=w[y].uniqueName,z(void 0!==x.instances[B]),M=x.instances[B].from*p,A=x.instances[B].to*p,x.buffer.erase(M,A),delete x.instances[B],x.optimalCount-=A-M;g(P,-t.origin[0],-t.origin[1],-t.origin[2]);C=t.toAdd;t=!1;for(y=0;y<C.length;++y)w=C[y],M=w.data,e.multiply(P,w.transformation,
Y),e.inverse(Y,fa),e.transpose(fa),B=u,v.fillInterleaved(M,Y,fa,w.instanceParameters,x.buffer.getArray(),u),M=v.getOutputAmount(S(M)),D=B+M,z(null==x.instances[w.uniqueName]),A=R(w),B=new I(w.name,B/p,D/p,A,void 0,void 0,w.idx),x.instances[w.uniqueName]=B,this._updateHighlightFaceranges(w,B),A&&(t=!0),x.optimalCount+=M,u+=M;z(x.optimalCount===r);r=new Float32Array(x.buffer.getArray().buffer,0,x.buffer.getSize());x.vao.vertexBuffers.geometry.setData(r);(t||x.displayedIndexRange)&&(d[this._modifiedMergedFacerangesKey(n,
q)]=x)}else z(0===r),x.vao.dispose(!0),x.vao=null,delete y.origin2data[q],0===Object.keys(y.origin2data).length&&(c.push(n),delete b[n],this._orderedRendering&&this._removeFromRenderOrder(y,"merged"))}}},l.prototype._modifyInstanced=function(a,b,f){var k=this._rctx,n=X.Instanced;a=this._compMat2delta(a,b,n);b=this._mat2DataInstanced;for(var l in a){var q=a[l],t;for(t in q){var r=q[t];if(0!==r.optimalCount){var v=r.material,u=b[l];if(null==u){var p=v.getRenderPriority(),u=this._initializeMatData(v);
b[l]=u;this._orderedRendering&&this._insertIntoRenderOrder(u,p,"instanced")}var y=v.getVertexBufferLayout(),x=u[c.MATERIAL].instanced?v.getInstanceBufferLayout():void 0,B=x&&J.findAttribute(x,"instanceColor"),C=x&&J.findAttribute(x,"instanceFeatureAttribute"),w=J.getStride(y)/4,p=u.origin2data[t];null==p&&(p={type:n,instances:{},vao:new m(k,U.Default3D,{geometry:y},{geometry:E.createVertex(k,35044)}),buffer:new h(r.optimalCount),optimalCount:0,perGeometryDataInfo:{},origin:r.origin},u.origin2data[t]=
p);var u=p.buffer.getSize(),D=p.buffer.getArray(),G=r.optimalCount<r.sparseCount/2,K=p.buffer.resize(G?r.optimalCount:r.sparseCount),M;for(M in r.perGeometryDelta){var A=p.perGeometryDataInfo[M];if(A&&A.instanceBufferData){var L=r.perGeometryDelta[M].removeCount;0<L&&A.instanceBufferData.prepareFree(L)}}var N=r.toRemove;if(G||K){for(G=0;G<N.length;++G){K=N[G];delete p.instances[K.uniqueName];M=K.data.id;var W=A=p.perGeometryDataInfo[M];0===--W.refCount&&null==r.dataId2refCount[M]?(p.optimalCount-=
(W.to-W.from)*w,delete p.perGeometryDataInfo[M]):A.instanceBufferData&&A.instanceBufferData.free(K.idx)}var u=0,G=p.buffer.getArray(),K={},Q;for(Q in p.perGeometryDataInfo)W=p.perGeometryDataInfo[Q],z(null==K[W.from]),K[W.from]=W;for(var V in K)W=K[V],L=W.from*w,A=W.to*w,G.set(D.subarray(L,A),u),W.from=u/w,u+=A-L,W.to=u/w;for(var O in p.instances)L=p.instances[O],L.from=p.perGeometryDataInfo[L.dataId].from,L.to=p.perGeometryDataInfo[L.dataId].to}else for(G=0;G<N.length;++G)K=N[G],delete p.instances[K.uniqueName],
M=K.data.id,A=p.perGeometryDataInfo[M],0===--A.refCount&&null==r.dataId2refCount[M]?(L=A.from*w,A=A.to*w,p.buffer.erase(L,A),p.optimalCount-=A-L,delete p.perGeometryDataInfo[M]):A.instanceBufferData&&A.instanceBufferData.free(K.idx);g(P,-r.origin[0],-r.origin[1],-r.origin[2]);for(M in r.perGeometryDelta)(A=p.perGeometryDataInfo[M])&&A.instanceBufferData&&(G=r.perGeometryDelta[M].addCount,0<G&&A.instanceBufferData.prepareAllocate(G));D=r.toAdd;for(G=0;G<D.length;++G){K=D[G];L=K.data;M=L.id;A=p.perGeometryDataInfo[M];
if(null==A){v.fillInterleaved(L,void 0,void 0,void 0,p.buffer.getArray(),u);N=v.getOutputAmount(S(L));L=u/w;u+=N;A=u/w;if(p.optimalCount+=N,A={refCount:1,from:L,to:A,vao:null,instanceBufferData:null},x)L=J.getStride(x)/4,A.vao=new m(k,U.Default3D,{geometry:y,instance:x},{geometry:p.vao.vertexBuffers.geometry,instance:E.createVertex(k,35044)}),A.instanceBufferData=new d(L,r.perGeometryDelta[M].addCount);p.perGeometryDataInfo[M]=A}else++A.refCount;z(A.from*w<=p.buffer.getSize()&&A.to*w<=p.buffer.getSize());
L=e.create();e.multiply(P,K.transformation,L);N=R(K);L=new I(K.name,A.from,A.to,N,L,K.instanceParameters,K.idx,M);p.instances[K.uniqueName]=L;this._updateHighlightFaceranges(K,L);if(A=A.instanceBufferData)N=A.allocate(K.idx),A.fill(N,0,L.transformation),A.fill(N,16,L.transformationNormal),B&&A.fill(N,B.offset/4,K.instanceParameters.color),C&&A.fill(N,C.offset/4,K.instanceParameters.featureAttribute)}z(p.optimalCount===r.optimalCount);v=new Float32Array(p.buffer.getArray().buffer,0,p.buffer.getSize());
p.vao.vertexBuffers.geometry.setData(v);for(M in p.perGeometryDataInfo)if(y=p.perGeometryDataInfo[M],y.vao&&(v=y.vao.vertexBuffers.instance))x=r.perGeometryDelta[M],0<x.addCount+x.removeCount&&(y=y.instanceBufferData.compact(),v.setData(y))}else r=b[l],r.origin2data[t].vao.dispose(!0),delete r.origin2data[t],0===Object.keys(r.origin2data).length&&(f.push(l),delete b[l],this._orderedRendering&&this._removeFromRenderOrder(r,"instanced"))}}},l.prototype._modifyPreinterleaved=function(a,b,c){for(var d=
this._rctx,f=X.Preinterleaved,k=this._mat2DataPreinterleaved,h=0;h<a.length;h++){var n=a[h],l=n.material,q=l.getId(),t=n.origin.id,r=n.origin.vec3,v=k[q];null==v&&(v=this._initializeMatData(l),k[q]=v);q=v.origin2data[t];null==q&&(q={type:f,origin:r,count:0,instances:{}},v.origin2data[t]=q);g(P,-r[0],-r[1],-r[2]);v=e.create();e.multiply(P,n.transformation,v);r=R(n);t=n.data;t.preinterleaved?(v=new I(n.name,0,t.indexCount,r,v,n.instanceParameters,n.idx,t.id),l=l.getVertexBufferLayout(),l=new m(d,U.Default3D,
{geometry:l},{geometry:E.createVertex(d,35044)}),l.vertexBuffers.geometry.setData(t.vertexData),q.count+=1,q.instances[n.uniqueName]={instance:v,vao:l,buffer:t.vertexData},this._updateHighlightFaceranges(n,v)):z(!1,"Non-interleaved render geometry processed as pre-interleaved")}for(a=0;a<b.length;a++)n=b[a],r=n.origin,l=n.material,q=l.getId(),t=r.id,n=n.uniqueName,v=k[q],d=v.origin2data[t],d.instances[n].vao.dispose(),delete d.instances[n],--d.count,0===d.count&&delete v.origin2data[t],0===Object.keys(v.origin2data).length&&
(c.push(q),delete k[q])},l.prototype._compMat2delta=function(a,e,b){var c={};return this._updateMat2delta(a,!0,b,c),this._updateMat2delta(e,!1,b,c),c},l.prototype._updateMat2delta=function(a,e,b,c){b=b===X.Instanced;for(var d=0;d<a.length;d++){var f=a[d],g=f.origin,k=f.material,h=k.getId(),m=b?this._mat2DataInstanced[h]:this._mat2DataMerged[h],m=m&&m.origin2data[g.id],n=c[h];null==n&&(n={},c[h]=n);h=n[g.id];if(null==h){if(h={optimalCount:null==m?0:m.optimalCount,sparseCount:null==m?0:m.buffer.getSize(),
material:k,toAdd:[],toRemove:[],perGeometryDelta:null,origin:g.vec3},b){var l={};if(void 0!==m)for(var q in m.perGeometryDataInfo)l[q]=m.perGeometryDataInfo[q].refCount;h.dataId2refCount=l;h.perGeometryDelta={}}n[g.id]=h}g=k.getOutputAmount(S(f.data));b?(k=f.data.id,(m=h.perGeometryDelta[k])||(m={addCount:0,removeCount:0},h.perGeometryDelta[k]=m),e?(m.addCount++,null==h.dataId2refCount[k]&&(h.dataId2refCount[k]=0),1===++h.dataId2refCount[k]&&(h.optimalCount+=g,h.sparseCount+=g),h.toAdd.push(f)):(m.removeCount++,
0===--h.dataId2refCount[k]&&(delete h.dataId2refCount[k],h.optimalCount-=g),h.toRemove.push(f))):e?(h.optimalCount+=g,h.sparseCount+=g,h.toAdd.push(f)):(h.optimalCount-=g,h.toRemove.push(f))}},l.prototype._getType=function(a){if(a.data.preinterleaved)return X.Preinterleaved;var e=!1,b=S(a.data);return e=e||!1===a.material.canBeMerged,e=e||a.material.instanced,e=e||a.material.isBackdrop,e=e||!0===a.material.isRenderOccluded(),a.singleUse||(e=e||b>this._threshold),e?X.Instanced:X.Merged},l.prototype._getTargetMat2Data=
function(a){switch(a){case X.Merged:return this._mat2DataMerged;case X.Instanced:return this._mat2DataInstanced;case X.Preinterleaved:return this._mat2DataPreinterleaved}},l.prototype._getOriginData=function(a,e,b){return this._getTargetMat2Data(a)[e].origin2data[b]},l.prototype._modifiedMergedFacerangesKey=function(a,e){return a+"_"+e},l.prototype._insertIntoRenderOrder=function(a,e,b){for(var d=a[c.MATERIAL].getMaterialId(),f=this._renderOrder.length,g=0;f>g&&this._renderOrder[g][0]>=e;){var k=
this._renderOrder[g][1];if(k.id===d)return z(!k[b],"matData for type already exists"),void(k[b]=a);g++}d={id:d,instanced:null,merged:null};d[b]=a;this._renderOrder.splice(g,0,[e,d])},l.prototype._removeFromRenderOrder=function(a,e){var b=a[c.MATERIAL].getMaterialId();for(a=0;this._renderOrder[a][1].id!==b;)a++;b=this._renderOrder[a][1];b[e]=null;b.instanced||b.merged||this._renderOrder.splice(a,1)},l.prototype._sortHighlightsByRenderOrder=function(){this._highlights.sort(function(a,e){a=a.matData[c.MATERIAL].getRenderPriority();
e=e.matData[c.MATERIAL].getRenderPriority();return a>e?-1:e>a?1:0})},l.prototype._updateRenderOrder=function(a,e){for(var b=e.length,d=0;b>d&&e[d][1].id!==a;)d++;if(b>d){a=e[d][1];a=(a.merged||a.instanced)[c.MATERIAL].getRenderPriority();var f=e[d][0];if(a!==e[d][0])for(e[d][0]=a,f=a>f?-1:1,d+=f;-1<d&&b>d&&f*e[d][0]>f*a;){var g=e[d];e[d]=e[d-f];e[d-f]=g;d+=f}}},l.prototype._modifyMaterials=function(a){for(var e in a)this._materialRep.updateMaterialParameters(e)},l.prototype.modifyRenderOrder=function(a){if(this._orderedRendering){for(var e in a)this._updateRenderOrder(e,
this._renderOrder);this._sortHighlightsByRenderOrder();this._needsRender=!0}},l.prototype._initializeMatData=function(a){var e={origin2data:{}};return e[c.MATERIAL]=this._materialRep.aquire(a),e[c.MATERIAL_DEPTH_SHADOWMAP]=this._materialRep.aquireDepthShadowMap(a),e[c.MATERIAL_NORMAL]=this._materialRep.aquireNormal(a),e[c.MATERIAL_DEPTH]=this._materialRep.aquireDepth(a),e[c.MATERIAL_HIGHLIGHT]=this._materialRep.aquireHighlight(a),e},l.prototype._releaseMaterials=function(a){if(Array.isArray(a))for(var e=
0;e<a.length;e++)this._materialRep.release(a[e]),this._materialRep.releaseDepthShadowMap(a[e]),this._materialRep.releaseNormal(a[e]),this._materialRep.releaseDepth(a[e]),this._materialRep.releaseHighlight(a[e]);else this._materialRep.release(a),this._materialRep.releaseDepthShadowMap(a),this._materialRep.releaseNormal(a),this._materialRep.releaseDepth(a),this._materialRep.releaseHighlight(a)},l.prototype._getInstance=function(a){var e=a.uniqueName,b=a.material.getId(),c=this._getType(a),b=this._getTargetMat2Data(c)[b];
if(!b)return null;a=b.origin2data[a.origin.id];if(!a)return null;var d;return d=a.type===X.Preinterleaved?a.instances[e].instance:a.instances[e],d?{type:c,uniqueName:e,instance:d,matData:b,originData:a,instancedVAO:null,instancedVAOBaseInstance:null}:null},l.prototype._createBaseInstanceVAO=function(a){var e=this._rctx,b=a.instance,c=a.originData;if(a.type===X.Instanced&&c.perGeometryDataInfo){var c=c.perGeometryDataInfo[b.dataId],d=c.instanceBufferData;d&&(c=c.vao,b=d.getSlot(b.idx),a.instancedVAOBaseInstance!==
b&&(d=J.setBaseInstanceOffset(c.layout,b),a.instancedVAO=new m(e,c.locations,d,c.vertexBuffers,c.indexBuffer),a.instancedVAOBaseInstance=b))}},l.prototype._updateHighlightVAOs=function(){for(var a=0;a<this._highlights.length;++a)this._createBaseInstanceVAO(this._highlights[a])},l.prototype._getFallbackDepthTexture=function(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=new b(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},
new Uint8Array([255,255,255,255]))),this._fallbackDepthStencilTexture},l}();var x=function(){function a(){this.reset()}return a.prototype.reset=function(){this.VBOusedSize=this.VBOoptimalSize=this.VBOallocatedSize=this.instancesDrawnAngle=this.drawCallsHighlight=this.drawCallsFragmented=this.drawCallsPreinterleaved=this.drawCallsMerged=this.drawCallsAngleInstanced=this.drawCallsInstanced=this.trianglesRendered=0},a}(),I=function(){return function(a,b,c,d,f,g,k,h){this.name=a;this.from=b;this.to=c;
this.displayedIndexRange=d;this.transformation=f;this.instanceParameters=g;this.idx=k;this.dataId=h;null!=f&&(this.transformationNormal=e.create(),e.set(f,this.transformationNormal),e.inverse(this.transformationNormal,this.transformationNormal),e.transpose(this.transformationNormal,this.transformationNormal))}}();!function(a){a[a.Merged=0]="Merged";a[a.Instanced=1]="Instanced";a[a.Preinterleaved=2]="Preinterleaved"}(X||(X={}));var L=A.create(),P=e.identity(),Y=e.create(),fa=e.create();return y})},
"esri/views/3d/webgl-engine/lib/IntervalUtilities":function(){define(["require","exports"],function(A,p){return function(){function p(){}return p.copyIntervals=function(l){for(var h=[],d=0;d<l.length;d++){var u=l[d];h.push([u[0],u[1]])}return h},p.convertFaceToIndexRange=function(l,h){for(var d=0;d<l.length;d++){var u=l[d];u[0]*=h;u[1]=u[1]*h+(h-1)}},p.sortIntervals=function(l){return l.sort(function(h,d){return h[0]===d[0]?h[1]>d[1]?1:h[1]<d[1]?-1:0:h[0]>d[0]?1:h[0]<d[0]?-1:0})},p.intersectIntervals=
function(l,h){if(0>=l.length)return[];for(var d=[],u=0;u<l.length;u++){var r=l[u];r[1]<h[0]||r[0]>h[1]||(r=[r[0],r[1]],r[0]<h[0]&&(r[0]=h[0]),r[1]>h[1]&&(r[1]=h[1]),d.push(r))}return d},p.mergeIntervals=function(l){if(0>=l.length)return[];var h=[];l=this.sortIntervals(l);h.push(l[0]);for(var d=1;d<l.length;d++){var u=h[h.length-1];u[1]+1<l[d][0]?h.push(l[d]):u[1]<l[d][1]&&(u[1]=l[d][1],h.pop(),h.push(u))}return h},p.invertIntervals=function(l,h){for(var d=[],u=0,r=0;r<l.length;r++){var a=l[r];a[0]>
u&&d.push([u,a[0]-1]);u=a[1]+1}return h>=u&&d.push([u,h]),d},p.offsetIntervals=function(l,h){for(var d=[],u=0;u<l.length;u++){var r=l[u];d.push([r[0]+h,r[1]+h])}return d},p}()})},"esri/views/3d/webgl-engine/lib/Float32ArrayList":function(){define(["require","exports","./Util"],function(A,p,w){return function(){function l(h){null==h?h=16:65536>h&&(h=w.nextHighestPowerOfTwo(h));this.array=new Float32Array(h);this.size=0}return l.prototype.resize=function(h,d){void 0===d&&(d=!1);this.size=h;var l;if(this.size>
this.array.length){for(h=this.array.length||1;h<this.size;)h*=2;return l=new Float32Array(h),d&&l.set(this.array),this.array=l,!0}if(this.size<=this.array.length/2){h=this.array.length;for(var r=2*this.size;h>=r;)h=Math.floor(h/2);return l=new Float32Array(h),d&&l.set(this.array.subarray(0,h)),this.array=l,!0}return!1},l.prototype.append=function(h){var d=this.size;this.resize(this.size+h.length,!0);this.array.set(h,d)},l.prototype.erase=function(h,d){for(;d>h;++h)this.array[h]=0},l.prototype.getArray=
function(){return this.array},l.prototype.getSize=function(){return this.size},l}()})},"esri/views/3d/webgl-engine/lib/InstanceBufferData":function(){define(["require","exports","./Util"],function(A,p,w){return function(){function l(h,d){null==d&&(d=4);var l=w.nextHighestPowerOfTwo(d*h);this.array=new Float32Array(l);this.zeroItem=new Float32Array(h);this.endSlot=0;this.perInstanceDataSize=h;this.emptySlots=[];this.emptySlotsIdx=0;this.id2slot={};this.slot2id=Array(d)}return l.prototype.prepareFree=
function(h){this.emptySlots.length+=h},l.prototype.free=function(h){h=this.id2slot[h];null!=h&&(this.emptySlots[this.emptySlotsIdx++]=h,this.slot2id[h]=void 0)},l.prototype.prepareAllocate=function(h){h-=this.emptySlotsIdx;0<h&&this._resizeArray((this.endSlot+h)*this.perInstanceDataSize)},l.prototype.allocate=function(h){var d;return d=0<this.emptySlotsIdx?this.emptySlots[--this.emptySlotsIdx]:this.endSlot++,this.id2slot[h]=d,this.slot2id[d]=h,d},l.prototype.getSlot=function(h){return this.id2slot[h]},
l.prototype.getOffset=function(h){return h*this.perInstanceDataSize},l.prototype.getArray=function(){return this.array},l.prototype.fill=function(h,d,l){this.array.set(l,h*this.perInstanceDataSize+d)},l.prototype.compact=function(){if(0<this.emptySlotsIdx){this.emptySlots.length=this.emptySlotsIdx;for(this.emptySlots.sort(function(a,d){return a-d});0<this.emptySlotsIdx&&this.emptySlots[this.emptySlotsIdx-1]===this.endSlot;)this.emptySlotsIdx--,this.endSlot--;for(;0<this.emptySlotsIdx;){this.emptySlotsIdx--;
var h=this.endSlot-1,d=this.emptySlots[this.emptySlotsIdx],l=h*this.perInstanceDataSize,r=d*this.perInstanceDataSize;this.array.set(this.array.subarray(l,l+this.perInstanceDataSize),r);this.array.set(this.zeroItem,l);l=this.slot2id[h];this.slot2id[h]=void 0;this.slot2id[d]=l;this.id2slot[l]=d;this.endSlot--}}return this._resizeArray(this.endSlot*this.perInstanceDataSize),this.emptySlots.length=0,this.array},l.prototype._resizeArray=function(h){var d;if(h>this.array.length){for(d=this.array.length||
1;h>d;)d*=2;h=new Float32Array(d);h.set(this.array);this.array=h}else if(h<=this.array.length/2){d=this.array.length;for(h*=2;d>=h;)d/=2;h=new Float32Array(d);h.set(this.array.subarray(0,d));this.array=h}},l}()})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define(["require","exports","./SphericalHarmonics","../../lib/glMatrix"],function(A,p,w,l){Object.defineProperty(p,"__esModule",{value:!0});var h=l.vec3d,d=l.vec4d,u=h.create();A=function(){function l(){this._renderLighting=
{main:{intensity:h.create(),direction:h.createFrom(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}};this._shOrder=2;this._oldDirection=h.create();this._oldSpecular=d.create();this._oldDiffuse=d.create();this._oldAmbient=d.create()}return l.prototype.setUniforms=function(a,d){(void 0===d&&(d=!1),d||a.getDefine("GROUND_NORMAL_SHADING"))?a.setUniform1f("lightingFixedFactor",(1-this._info.groundLightingFactor)*(1-this._info.globalFactor)):a.setUniform1f("lightingFixedFactor",0);a.setUniform1f("lightingGlobalFactor",
this._info.globalFactor);a.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction);a.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity);a.setUniform1f("ambientBoostFactor",.4);d=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?a.setUniform3f("lightingAmbientSH0",d.r[0],d.g[0],d.b[0]):1===this._shOrder?(a.setUniform4f("lightingAmbientSH_R",d.r[0],d.r[1],d.r[2],d.r[3]),a.setUniform4f("lightingAmbientSH_G",d.g[0],d.g[1],d.g[2],d.g[3]),a.setUniform4f("lightingAmbientSH_B",
d.b[0],d.b[1],d.b[2],d.b[3])):2===this._shOrder&&(a.setUniform3f("lightingAmbientSH0",d.r[0],d.g[0],d.b[0]),a.setUniform4f("lightingAmbientSH_R1",d.r[1],d.r[2],d.r[3],d.r[4]),a.setUniform4f("lightingAmbientSH_G1",d.g[1],d.g[2],d.g[3],d.g[4]),a.setUniform4f("lightingAmbientSH_B1",d.b[1],d.b[2],d.b[3],d.b[4]),a.setUniform4f("lightingAmbientSH_R2",d.r[5],d.r[6],d.r[7],d.r[8]),a.setUniform4f("lightingAmbientSH_G2",d.g[5],d.g[6],d.g[7],d.g[8]),a.setUniform4f("lightingAmbientSH_B2",d.b[5],d.b[6],d.b[7],
d.b[8]));a.setUniform3fv("lightDirection",this._oldDirection)},l.prototype.set=function(a){this._info=a;w.combineLights(a.lights,this._shOrder,this._renderLighting.main,this._renderLighting.sphericalHarmonics);h.negate(this._renderLighting.main.direction,this._oldDirection);a=1/Math.PI;this._oldAmbient[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*a;this._oldAmbient[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*a;this._oldAmbient[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*
a;this._oldAmbient[3]=1;this._oldDiffuse[0]=this._renderLighting.main.intensity[0]*a;this._oldDiffuse[1]=this._renderLighting.main.intensity[1]*a;this._oldDiffuse[2]=this._renderLighting.main.intensity[2]*a;this._oldDiffuse[3]=1;a=h.set(this._oldDiffuse,u);h.scale(a,.4*this._info.globalFactor);h.add(this._oldAmbient,a)},Object.defineProperty(l.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0}),l.prototype.getOld=function(){return{ambient:this._oldAmbient,
diffuse:this._oldDiffuse,specular:this._oldSpecular,direction:this._oldDirection,helper:this}},l}();p.SceneLighting=A})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("require exports ./Lightsources ../lib/LongVectorMath ../../lib/glMatrix ../../support/mathUtils".split(" "),function(A,p,w,l,h,d){function u(a){return(a+1)*(a+1)}function r(a){return d.clamp(Math.floor(Math.sqrt(a)-1),0,2)}function a(a,b,c){var d=a[0],k=a[1];a=a[2];c=c||[];return c.length=u(b),0<=b&&(c[0]=
.28209479177),1<=b&&(c[1]=.4886025119*d,c[2]=.4886025119*a,c[3]=.4886025119*k),2<=b&&(c[4]=1.09254843059*d*k,c[5]=1.09254843059*k*a,c[6]=.31539156525*(3*a*a-1),c[7]=1.09254843059*d*a,c[8]=.54627421529*(d*d-k*k)),c}function k(a,b){a=u(a);b=b||{r:[],g:[],b:[]};b.r.length=b.g.length=b.b.length=a;for(var c=0;a>c;c++)b.r[c]=b.g[c]=b.b[c]=0;return b}function c(c,d){for(var k=r(d.r.length),h=0;h<c.length;h++){var q=c[h];C.negate(q.direction,b);a(b,k,B);l.elementwiseProduct(B,m);l.scalarProduct(B,q.intensity[0],
D);l.add(d.r,D);l.scalarProduct(B,q.intensity[1],D);l.add(d.g,D);l.scalarProduct(B,q.intensity[2],D);l.add(d.b,D)}return d}function t(c,d){a(b,0,B);for(var k=0;k<c.length;k++){var h=c[k];d.r[0]+=B[0]*m[0]*h.intensity[0]*4*Math.PI;d.g[0]+=B[0]*m[0]*h.intensity[1]*4*Math.PI;d.b[0]+=B[0]*m[0]*h.intensity[2]*4*Math.PI}return d}Object.defineProperty(p,"__esModule",{value:!0});var C=h.vec3d;p.numberOfCoefficients=u;p.numberOfCoefficientsInBand=function(a){return 2*a+1};p.orderFromNumberOfCoefficients=r;
p.computeCoefficients=a;p.initSHCoefficients=k;p.projectFillLights=c;p.projectAmbientLights=t;p.combineLights=function(a,b,d,h){k(b,h.sh);C.set3(0,0,0,d.intensity);var m=!1,r=q,u=v;b=y;r.length=0;u.length=0;for(var p=b.length=0;p<a.length;p++){var B=a[p];B instanceof w.MainLight&&!m?(C.set(B.direction,d.direction),d.intensity[0]=B.intensity[0],d.intensity[1]=B.intensity[1],d.intensity[2]=B.intensity[2],d.castShadows=B.castShadows,m=!0):B instanceof w.MainLight||B instanceof w.FillLight?r.push(B):
B instanceof w.AmbientLight?u.push(B):B instanceof w.SphericalHarmonicsLight&&b.push(B)}c(r,h.sh);t(u,h.sh);for(a=0;a<b.length;a++)B=b[a],l.add(h.sh.r,B.sh.r),l.add(h.sh.g,B.sh.g),l.add(h.sh.b,B.sh.b)};var q=[],v=[],y=[],B=[0],D=[0],b=C.create(),m=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["require","exports"],function(A,p){Object.defineProperty(p,"__esModule",{value:!0});p.dotProduct=function(p,
l){for(var h=0,d=0;d<p.length;d++)h+=p[d]*l[d];return h};p.elementwiseProduct=function(p,l,h){h=h||p;h.length=p.length;for(var d=0;d<p.length;d++)h[d]=p[d]*l[d];return h};p.scalarProduct=function(p,l,h){h=h||p;h.length=p.length;for(var d=0;d<p.length;d++)h[d]=p[d]*l;return h};p.add=function(p,l,h){h=h||p;h.length=p.length;for(var d=0;d<p.length;d++)h[d]=p[d]+l[d];return h}})},"esri/views/3d/webgl-engine/lib/LinearDepthTextureHelper":function(){define(["require","exports","./Util","../../../webgl/FramebufferObject",
"../../../webgl/enums"],function(A,p,w,l,h){return function(){function d(d){this._rctx=d;this._depthFBO=void 0;this.height=this.width=this.viewportToRestore=null}return d.prototype.setEnableState=function(d){d!==this.getEnableState()&&(d?this.enable():this.disable())},d.prototype.getEnableState=function(){return void 0!==this._depthFBO},d.prototype.getDepthFBO=function(){return this._depthFBO},d.prototype.enable=function(){w.assert(!this.getEnableState());this._depthFBO=l.createWithAttachments(this._rctx,
{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:3})},d.prototype.disable=function(){w.assert(this.getEnableState());this._depthFBO.dispose();this._depthFBO=void 0},d.prototype.setupFBOs=function(d){w.assert(this.getEnableState());this.viewportToRestore=d=d.fullViewport;this.width=d[2];this.height=d[3];this._rctx.setViewport(0,0,this.width,this.height)},d.prototype.prepareDepthPass=function(){w.assert(this.getEnableState());
var d=this._rctx,h=d.gl;this._depthFBO.resize(this.width,this.height);d.bindFramebuffer(this._depthFBO);d.setClearStencil(0);d.setClearColor(0,0,0,0);d.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT|h.STENCIL_BUFFER_BIT);d.setBlendingEnabled(!1)},d.prototype.finish=function(d){var h=this._rctx;h.bindFramebuffer(d);h.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},d}()})},"esri/views/3d/webgl-engine/lib/NormalTextureHelper":function(){define(["require",
"exports","./Util","../../../webgl/FramebufferObject","../../../webgl/enums"],function(A,p,w,l,h){return function(){function d(d){this.rctx=d;this.normalFBO=void 0;this.height=this.width=this.viewportToRestore=null}return d.prototype.setEnableState=function(d){d!==this.getEnableState()&&(d?this.enable():this.disable())},d.prototype.getEnableState=function(){return void 0!==this.normalFBO},d.prototype.getNormalFBO=function(){return this.normalFBO},d.prototype.enable=function(){w.assert(!this.getEnableState());
this.normalFBO=l.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1})},d.prototype.disable=function(){w.assert(this.getEnableState());this.normalFBO.dispose();this.normalFBO=void 0},d.prototype.setupFBOs=function(d){w.assert(this.getEnableState());this.viewportToRestore=d=d.viewport;this.width=d[2];this.height=d[3];this.rctx.setViewport(0,0,this.width,this.height)},d.prototype.prepareNormalPass=
function(){w.assert(this.getEnableState());var d=this.rctx,h=d.gl;this.normalFBO.resize(this.width,this.height);d.bindFramebuffer(this.normalFBO);d.setClearColor(0,0,0,0);d.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT)},d.prototype.finish=function(d){var h=this.rctx;h.bindFramebuffer(d);h.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},d}()})},"esri/views/3d/webgl-engine/lib/HighlightTextureHelper":function(){define(["require","exports",
"./Util","../../../webgl/FramebufferObject","../../../webgl/enums"],function(A,p,w,l,h){return function(){function d(d){this._rctx=d;this.height=this.width=this.viewportToRestore=this.fbo2=this.fbo=null}return d.prototype.setEnableState=function(d){d!==this.getEnableState()&&(d?this.enable():this.disable())},d.prototype.getEnableState=function(){return null!==this.fbo},d.prototype.getHighlightFBO=function(){return this.fbo},d.prototype.getBlurFBO=function(){return this.fbo2},d.prototype.enable=function(){w.assert(!this.getEnableState());
this.fbo=l.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1})},d.prototype.disable=function(){w.assert(this.getEnableState());this.fbo.dispose();this.fbo=null},d.prototype.setupFBOs=function(d){w.assert(this.getEnableState());this.viewportToRestore=d=d.fullViewport;this.width=d[2];this.height=d[3];this._rctx.setViewport(0,0,this.width,this.height)},d.prototype.prepareHighlightPass=function(){w.assert(this.getEnableState());
var d=this._rctx,h=d.gl;this.fbo.resize(this.width,this.height);d.bindFramebuffer(this.fbo);d.setClearColor(0,0,0,0);d.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT)},d.prototype.finish=function(d){var h=this._rctx;h.bindFramebuffer(d);h.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},d}()})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["require","exports","./RenderSlot","./RenderPass"],function(A,p,w,l){return function(){function h(){this.normals=
this.lightingData=this.highlight=this.depth=this.camera=null;this.pass=l.MATERIAL;this.shadowMap=null;this.slot=w.BACKGROUND;this.options=this.rctx=this.framebufferTex=this.stencilRenderingHelper=this.offscreenRenderingHelper=this.ssaoHelper=null;this.renderOccludedOnly=!1}return Object.defineProperty(h.prototype,"isHighlightPass",{get:function(){return this.pass===l.MATERIAL_HIGHLIGHT},enumerable:!0,configurable:!0}),h}()})},"esri/views/3d/webgl-engine/lib/ExternalRendererContainer":function(){define(["require",
"exports","./RenderSlot"],function(A,p,w){return function(){function l(){this.renderersChanged=!1;this.renderers=[];this.slots=[];for(var h=0;h<w.MAX_SLOTS;++h)this.slots[h]=[]}return l.prototype.addRenderer=function(h,d){this.renderers.push(d);for(var l=0;l<h.length;++l)this.slots[h[l]].push(d);this.renderersChanged=!0},l.prototype.removeRenderer=function(h){this.renderers=this.renderers.filter(function(d){return d!==h});for(var d=0;d<this.slots.length;++d)this.slots[d]=this.slots[d].filter(function(d){return d!==
h});this.renderersChanged=!0},l.prototype.render=function(h,d){d.slot=h;var l=0;for(h=this.slots[h];l<h.length;l++){var r=h[l];r.render(d)&&(r.didRender=!0)}},l.prototype.needsRender=function(){if(this.renderersChanged)return!0;for(var h=0,d=this.renderers;h<d.length;h++)if(d[h].needsRender)return!0;return!1},l.prototype.needsHighlight=function(){for(var h=0,d=this.renderers;h<d.length;h++)if(d[h].needsHighlight)return!0;return!1},l.prototype.needsLinearDepth=function(){for(var h=0,d=this.renderers;h<
d.length;h++)if(d[h].needsLinearDepth)return!0;return!1},l.prototype.resetNeedsRender=function(){this.renderersChanged=!1;for(var h=0,d=this.renderers;h<d.length;h++){var l=d[h];l.resetNeedsRender?l.resetNeedsRender():l.didRender&&(l.needsRender=!1,l.didRender=!1)}},l}()})},"esri/views/3d/webgl-engine/lib/StencilRenderingHelper":function(){define(["require","exports","./Util","../../../webgl/enums"],function(A,p,w,l){return function(){function h(d){this._enabled=!1;this._rctx=d}return h.prototype.enable=
function(){this._enabled=!0;this._rctx.setStencilTestEnabled(!0)},h.prototype.disable=function(){this._enabled=!1;this._rctx.setStencilTestEnabled(!1)},h.prototype.getIsSupported=function(){return!!this._rctx.contextAttributes.stencil},h.prototype.setEnableState=function(d){d?this.enable():this.disable()},h.prototype.getEnableState=function(){return this._enabled},h.prototype.prepareStencilWritePass=function(){w.assert(this.getEnableState());var d=this._rctx;d.setStencilFunction(519,1,255);d.setStencilOp(7680,
7680,7681);d.setStencilWriteMask(255)},h.prototype.finish=function(){if(this.getEnableState()){var d=this._rctx;d.setStencilFunction(519,0,0);d.setStencilOp(7680,7680,7680)}},h.prototype.enableStencilRead=function(){this.getEnableState()&&this._rctx.setStencilFunction(517,1,255)},h.prototype.disableStencilRead=function(){this.getEnableState()&&this._rctx.setStencilFunction(519,0,0)},h}()})},"esri/views/3d/webgl-engine/lib/FxaaRenderPass":function(){define("require exports ../../../webgl/Program ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/enums".split(" "),
function(A,p,w,l,h,d){return function(){function d(d){this.isEnabled=!1;this.vertexAttributeLocations={position:0};this.vertexBufferLayout=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=d}return d.prototype.enable=function(){if(!this.isEnabled){var d=this.rctx;this.program=new w(d,"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate \x3d (position + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(position, -1, 1);\n      }",
"\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x \x3d pos.x + float(off.x) * rcpFrame.x;\n        float y \x3d pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -\x3e actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN \x3d FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN \x3d FxaaLuma(rgbN);\n        float lumaW \x3d FxaaLuma(rgbW);\n        float lumaM \x3d FxaaLuma(rgbM);\n        float lumaE \x3d FxaaLuma(rgbE);\n        float lumaS \x3d FxaaLuma(rgbS);\n        float rangeMin \x3d min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax \x3d max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range \x3d rangeMax - rangeMin;\n        if (range \x3c max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL \x3d rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL \x3d (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL \x3d abs(lumaL - lumaM);\n        float blendL \x3d max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL \x3d min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL +\x3d (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *\x3d vec3(1.0/9.0);\n        float lumaNW \x3d FxaaLuma(rgbNW);\n        float lumaNE \x3d FxaaLuma(rgbNE);\n        float lumaSW \x3d FxaaLuma(rgbSW);\n        float lumaSE \x3d FxaaLuma(rgbSE);\n        float edgeVert \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan \x3d edgeHorz \x3e\x3d edgeVert;\n        float lengthSign \x3d horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN \x3d lumaW;\n          lumaS \x3d lumaE;\n        }\n        float gradientN \x3d abs(lumaN - lumaM);\n        float gradientS \x3d abs(lumaS - lumaM);\n        lumaN \x3d (lumaN + lumaM) * 0.5;\n        lumaS \x3d (lumaS + lumaM) * 0.5;\n        if (gradientN \x3c gradientS)\n        {\n          lumaN \x3d lumaS;\n          lumaN \x3d lumaS;\n          gradientN \x3d gradientS;\n          lengthSign *\x3d -1.0;\n        }\n        vec2 posN;\n        posN.x \x3d pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y \x3d pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *\x3d FXAA_SEARCH_THRESHOLD;\n        vec2 posP \x3d posN;\n        vec2 offNP \x3d horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN \x3d lumaN;\n        float lumaEndP \x3d lumaN;\n        bool doneN \x3d false;\n        bool doneP \x3d false;\n        posN +\x3d offNP * vec2(-1.0, -1.0);\n        posP +\x3d offNP * vec2( 1.0,  1.0);\n        for(int i \x3d 0; i \x3c FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN \x3d FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP \x3d FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN \x3d doneN || (abs(lumaEndN - lumaN) \x3e\x3d gradientN);\n          doneP \x3d doneP || (abs(lumaEndP - lumaN) \x3e\x3d gradientN);\n          if(doneN \x26\x26 doneP) { break; }\n          if(!doneN) {\n            posN -\x3d offNP;\n          }\n          if(!doneP) {\n            posP +\x3d offNP;\n          }\n        }\n        float dstN \x3d horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP \x3d horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN \x3d dstN \x3c dstP;\n        lumaEndN \x3d directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) \x3c 0.0) \x3d\x3d ((lumaEndN - lumaN) \x3c 0.0)) {\n          lengthSign \x3d 0.0;\n        }\n        float spanLength \x3d (dstP + dstN);\n        dstN \x3d directionN ? dstN : dstP;\n        float subPixelOffset \x3d (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF \x3d texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord \x3d fCoordinate;\n        // if (screenCoord.x \x3c 0.5) {\n          color.rgb \x3d FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x \x3c 0.501 \x26\x26 screenCoord.x \x3e 0.499) {\n        //   color.rgb \x3d vec3(1,0,0);\n        // } else {\n        //   color \x3d texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a \x3d 1.0;\n        gl_FragColor \x3d color;\n      }",
this.vertexAttributeLocations);var a=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new l(d,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new h(d,34962,35044,a)});this.isEnabled=!0}},d.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)},d.prototype.render=function(d,a){this.enable();var k=this.rctx;k.bindVAO(this.vao);k.bindFramebuffer(a);var c=0,h=0;null!=a?(c=a.descriptor.width,h=a.descriptor.height):
(c=k.gl.canvas.width,h=k.gl.canvas.height);k.bindProgram(this.program);k.bindTexture(d.colorTexture,0);this.program.setUniform1i("uColorTexture",0);this.program.setUniform2f("uRcpFrameDimension",1/c,1/h);k.setFaceCullingEnabled(!1);k.drawArrays(4,0,3)},d}()})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../../webgl/Program ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/FramebufferObject ../../support/imageUtils ../../../webgl/enums".split(" "),
function(A,p,w,l,h,d,u,r,a){var k=null;return function(){function a(a){this.isEnabled=!1;this.vertexAttributeLocations={vPosition:0};this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}return a.prototype.ensureEnabled=function(){if(this.isEnabled)return!0;if(!k)return A(["./SmaaRenderPassData"],function(a){k=a}),!1;var a=this.rctx;this.programEdgeDetect=new w(a,k.edgeDetectShader.vertex,k.edgeDetectShader.fragment,this.vertexAttributeLocations);
this.programBlendWeights=new w(a,k.blendWeightShader.vertex,k.blendWeightShader.fragment,this.vertexAttributeLocations);this.programBlur=new w(a,k.blurShader.vertex,k.blurShader.fragment,this.vertexAttributeLocations);var c=new Float32Array([-1,-1,3,-1,-1,3]);return this.vao=new l(a,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new h(a,34962,35044,c)}),this.tmpFramebufferEdges=u.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,
wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0}),this.tmpFramebufferBlend=u.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0}),this.textureArea=this.loadTextureFromBase64(k.areaTexture,9729,6407),this.textureSearch=this.loadTextureFromBase64(k.searchTexure,9728,6409),this.isEnabled=!0,!0},a.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),
this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)},a.prototype.render=function(a,c){this.ensureEnabled();var d=this.rctx,k=0,
h=0;null!=c?(k=c.descriptor.width,h=c.descriptor.height):(k=d.gl.canvas.width,h=d.gl.canvas.height);d.bindVAO(this.vao);d.setFaceCullingEnabled(!0);d.setCullFace(1029);d.setFrontFace(2305);d.setBlendingEnabled(!1);d.setDepthTestEnabled(!1);d.setViewport(0,0,k,h);this.tmpFramebufferEdges.resize(k,h);d.bindFramebuffer(this.tmpFramebufferEdges);d.setClearColor(0,0,0,1);d.clear(d.gl.COLOR_BUFFER_BIT);d.bindProgram(this.programEdgeDetect);d.bindTexture(a.colorTexture,0);this.programEdgeDetect.setUniform1i("tColor",
0);this.programEdgeDetect.setUniform4f("uResolution",1/k,1/h,k,h);d.drawArrays(4,0,3);this.tmpFramebufferBlend.resize(k,h);d.bindFramebuffer(this.tmpFramebufferBlend);d.setClearColor(0,0,1,1);d.clear(d.gl.COLOR_BUFFER_BIT);d.bindProgram(this.programBlendWeights);this.programBlendWeights.setUniform4f("uResolution",1/k,1/h,k,h);d.bindTexture(this.textureSearch,1);this.programBlendWeights.setUniform1i("tSearch",1);d.bindTexture(this.textureArea,2);this.programBlendWeights.setUniform1i("tArea",2);d.bindTexture(this.tmpFramebufferEdges.colorTexture,
3);this.programBlendWeights.setUniform1i("tEdges",3);d.drawArrays(4,0,3);d.bindFramebuffer(c);d.setClearColor(0,1,0,1);d.clear(d.gl.COLOR_BUFFER_BIT);d.bindProgram(this.programBlur);this.programBlur.setUniform4f("uResolution",1/k,1/h,k,h);d.bindTexture(a.colorTexture,0);this.programBlur.setUniform1i("tColor",0);d.bindTexture(this.tmpFramebufferBlend.colorTexture,1);this.programBlur.setUniform1i("tBlendWeights",1);d.drawArrays(4,0,3);d.setDepthTestEnabled(!0)},a.prototype.loadTextureFromBase64=function(a,
c,k){var h=new d(this.rctx,{pixelFormat:k,dataType:5121,wrapMode:33071,samplingMode:c},null);return r.dataUriToImage(a).then(function(a){h.resize(a.width,a.height);h.setData(a)}),h},a}()})},"esri/views/3d/support/imageUtils":function(){define(["require","exports","dojo/Deferred","../../../core/urlUtils","../../../request"],function(A,p,w,l,h){function d(d){var h=!1,a=new Image,k=new w(function(){h=!0;a.src=""}),c=function(){h||k.reject()};return a.onload=function(){h||k.resolve(a)},a.onerror=c,a.onabort=
c,a.src=d,k.promise}Object.defineProperty(p,"__esModule",{value:!0});p.dataURItoBlob=function(d){var h=atob(d.split(",")[1]);d=d.split(",")[0].split(":")[1].split(";")[0];for(var a=new ArrayBuffer(h.length),k=new Uint8Array(a),c=0;c<h.length;c++)k[c]=h.charCodeAt(c);return new Blob([a],{type:d})};p.dataUriToImage=d;p.requestImage=function(u){return l.isDataProtocol(u)?d(u):h(u,{responseType:"image",allowImageDataAccess:!0}).then(function(d){return d.data})}})},"esri/views/webgl/Profiling":function(){define(["require",
"exports"],function(A,p){Object.defineProperty(p,"__esModule",{value:!0});p.startMeasurement=function(l){if(!l.extensions.disjointTimerQuery)return null;var h=new w;return h.start(l),h};var w=function(){function l(){}return l.prototype.start=function(h){this._rctx=h;h=h.extensions.disjointTimerQuery;this._query=h.createQueryEXT();h.beginQueryEXT(h.TIME_ELAPSED_EXT,this._query)},l.prototype.stop=function(h,d){void 0===d&&(d=50);this._cb=h;this._checkInterval=d;h=this._rctx.extensions.disjointTimerQuery;
h.endQueryEXT(h.TIME_ELAPSED_EXT);this._checkQueryResult()},l.prototype._checkQueryResult=function(){var h=this._rctx.extensions.disjointTimerQuery,d=h.getQueryObjectEXT(this._query,h.QUERY_RESULT_AVAILABLE_EXT),l=this._rctx.gl.getParameter(h.GPU_DISJOINT_EXT);return d&&!l?(h=h.getQueryObjectEXT(this._query,h.QUERY_RESULT_EXT),void this._cb(h/1E6)):l?void this._cb(null):void setTimeout(this._checkQueryResult.bind(this),this._checkInterval)},l}()})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./HUDMaterial.xml ./internal/MaterialUtil ../lib/Util ../../../webgl/Util ./internal/MaterialBase ./internal/GLMaterialTextureBase ../lib/gl-matrix ../lib/RenderSlot ../lib/RenderPass ../lib/ShaderVariations ../lib/ComponentUtils ../../support/aaBoundingRect ../lib/screenSizePerspectiveUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y){function B(a,e){void 0===e&&(e=W);if(a.textureIsSignedDistanceField){var b=a.anchorPos;a=a.distanceFieldBoundingBox;var c=e;c[0]=b[0]*(a[2]-a[0])+a[0];c[1]=b[1]*(a[3]-a[1])+a[1]}else D.set(a.anchorPos,e);return e}var D=k.vec2d,b=k.vec3d,m=k.mat3d,E=k.mat4d,J={"bottom-left":[0,0],bottom:[.5,0],"bottom-right":[1,0],left:[0,.5],center:[.5,.5],right:[1,.5],"top-left":[0,1],top:[.5,1],"top-right":[1,1]},G=[{name:"position",count:3,type:5126,offset:0,stride:76,
normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:76,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:76,normalized:!1},{name:"color",count:4,type:5121,offset:32,stride:76,normalized:!1},{name:"size",count:2,type:5126,offset:36,stride:76,normalized:!1},{name:"auxpos1",count:4,type:5126,offset:44,stride:76,normalized:!1},{name:"auxpos2",count:4,type:5126,offset:60,stride:76,normalized:!1}],K={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,
color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,anchorPos:J.center,shaderPolygonOffset:1E-5,polygonOffset:!1,
textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1};A=function(a){function c(e,b){b=a.call(this,b)||this;return b._textureDirty=!1,b.params=h.copyParameters(e,K),"string"==typeof b.params.anchorPos&&(b.params.anchorPos=J[b.params.anchorPos]),b}return w(c,a),c.prototype.dispose=function(){},c.prototype.getParameterValues=function(){var a=this.params;return{color:a.color,texCoordScale:a.texCoordScale,polygonOffset:a.polygonOffset,anchorPos:a.anchorPos,screenOffset:a.screenOffset,verticalOffset:a.verticalOffset,
screenSizePerspective:a.screenSizePerspective,screenSizePerspectiveAlignment:a.screenSizePerspectiveAlignment,shaderPolygonOffset:a.shaderPolygonOffset,textureIsSignedDistanceField:a.textureIsSignedDistanceField,outlineColor:a.outlineColor,outlineSize:a.outlineSize,distanceFieldBoundingBox:a.distanceFieldBoundingBox,vvSizeEnabled:a.vvSizeEnabled,vvSizeMinSize:a.vvSizeMinSize,vvSizeMaxSize:a.vvSizeMaxSize,vvSizeOffset:a.vvSizeOffset,vvSizeFactor:a.vvSizeFactor,vvColorEnabled:a.vvColorEnabled,vvColorValues:a.vvColorValues,
vvColorColors:a.vvColorColors,textureId:a.textureId,occlusionTest:a.occlusionTest,binaryHighlightOcclusion:a.binaryHighlightOcclusion,centerOffsetUnits:a.centerOffsetUnits,debugDrawBorder:a.debugDrawBorder,drawInSecondSlot:a.drawInSecondSlot}},c.prototype.setParameterValues=function(a){for(var e in a)"textureId"===e&&d.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[e]=a[e];this.notifyDirty("matChanged")},c.prototype.getParams=function(){return this.params},
c.prototype.getOutputAmount=function(a){return 114*a},c.prototype.getInstanceBufferLayout=function(){},c.prototype.getVertexBufferLayout=function(){return G},c.prototype.fillInterleaved=function(a,e,b,c,f,g){var k=4*g,m=a.indices[d.VertexAttrConstants.POSITION],n=a.vertexAttr[d.VertexAttrConstants.POSITION].data,l=g+u.findAttribute(G,d.VertexAttrConstants.POSITION).offset/4;for(c=0;c<m.length;++c){var q=3*m[c];h.fill(n,q,f,l,e,3);l+=19;h.fill(n,q,f,l,e,3);l+=19;h.fill(n,q,f,l,e,3);l+=19;h.fill(n,
q,f,l,e,3);l+=19;h.fill(n,q,f,l,e,3);l+=19;h.fill(n,q,f,l,e,3);l+=19}e=a.indices[d.VertexAttrConstants.NORMAL];n=a.vertexAttr[d.VertexAttrConstants.NORMAL].data;l=g+u.findAttribute(G,d.VertexAttrConstants.NORMAL).offset/4;for(c=0;c<e.length;++c)q=3*e[c],h.fill(n,q,f,l,b,3),l+=19,h.fill(n,q,f,l,b,3),l+=19,h.fill(n,q,f,l,b,3),l+=19,h.fill(n,q,f,l,b,3),l+=19,h.fill(n,q,f,l,b,3),l+=19,h.fill(n,q,f,l,b,3),l+=19;var t,r,v,p;c=a.vertexAttr[d.VertexAttrConstants.UV0].data;null==c||3>=c.length?(t=0,r=0,v=
this.params.texCoordScale[0],p=this.params.texCoordScale[1]):(t=a.vertexAttr[d.VertexAttrConstants.UV0].data[0],r=a.vertexAttr[d.VertexAttrConstants.UV0].data[1],v=a.vertexAttr[d.VertexAttrConstants.UV0].data[2],p=a.vertexAttr[d.VertexAttrConstants.UV0].data[3]);v=Math.min(1.99999,v+1);p=Math.min(1.99999,p+1);q=g+u.findAttribute(G,d.VertexAttrConstants.UV0).offset/4;for(c=0;c<m.length;++c)f[q]=t,f[q+1]=r,q+=19,f[q]=v,f[q+1]=r,q+=19,f[q]=v,f[q+1]=p,q+=19,f[q]=v,f[q+1]=p,q+=19,f[q]=t,f[q+1]=p,q+=19,
f[q]=t,f[q+1]=r,q+=19;t=a.indices[d.VertexAttrConstants.COLOR];r=a.vertexAttr[d.VertexAttrConstants.COLOR].data;k+=u.findAttribute(G,d.VertexAttrConstants.COLOR).offset;v=new Uint8Array(f.buffer);for(c=0;c<t.length;++c)q=4*t[c],h.fill(r,q,v,k,null,4),k+=76,h.fill(r,q,v,k,null,4),k+=76,h.fill(r,q,v,k,null,4),k+=76,h.fill(r,q,v,k,null,4),k+=76,h.fill(r,q,v,k,null,4),k+=76,h.fill(r,q,v,k,null,4),k+=76;q=a.indices[d.VertexAttrConstants.SIZE];k=a.vertexAttr[d.VertexAttrConstants.SIZE].data;t=g+u.findAttribute(G,
d.VertexAttrConstants.SIZE).offset/4;for(c=0;c<q.length;++c)r=k[2*q[c]],v=k[2*q[c]+1],f[t]=r,f[t+1]=v,t+=19,f[t]=r,f[t+1]=v,t+=19,f[t]=r,f[t+1]=v,t+=19,f[t]=r,f[t+1]=v,t+=19,f[t]=r,f[t+1]=v,t+=19,f[t]=r,f[t+1]=v,t+=19;if(null!=a.indices[d.VertexAttrConstants.AUXPOS1]&&null!=a.vertexAttr[d.VertexAttrConstants.AUXPOS1])for(k=a.indices[d.VertexAttrConstants.AUXPOS1],t=a.vertexAttr[d.VertexAttrConstants.AUXPOS1].data,r=g+u.findAttribute(G,"auxpos1").offset/4,c=0;c<k.length;++c)q=4*k[c],h.fill(t,q,f,r,
null,4),r+=19,h.fill(t,q,f,r,null,4),r+=19,h.fill(t,q,f,r,null,4),r+=19,h.fill(t,q,f,r,null,4),r+=19,h.fill(t,q,f,r,null,4),r+=19,h.fill(t,q,f,r,null,4),r+=19;if(null!=a.indices[d.VertexAttrConstants.AUXPOS2]&&null!=a.vertexAttr[d.VertexAttrConstants.AUXPOS2])for(k=a.indices[d.VertexAttrConstants.AUXPOS2],a=a.vertexAttr[d.VertexAttrConstants.AUXPOS2].data,g+=u.findAttribute(G,"auxpos2").offset/4,c=0;c<k.length;++c)q=4*k[c],h.fill(a,q,f,g,null,4),g+=19,h.fill(a,q,f,g,null,4),g+=19,h.fill(a,q,f,g,null,
4),g+=19,h.fill(a,q,f,g,null,4),g+=19,h.fill(a,q,f,g,null,4),g+=19,h.fill(a,q,f,g,null,4),g+=19},c.prototype.intersect=function(a,c,k,h,m,n,l,t){if(h.isSelection&&h.enableHUDSelection&&!q.isAllHidden(c.componentVisibilities,a.data.componentOffsets)){var r=a.getData();a=this.params;m=c=1;if(E.toMat3(k,z),t){m=t(g);c=m[0];m=m[5];t=z;n=t[0];var v=t[1],u=t[2],p=t[3],x=t[4],C=t[5],w=t[6],D=t[7],F=t[8],G=1/Math.sqrt(n*n+v*v+u*u),K=1/Math.sqrt(p*p+x*x+C*C),J=1/Math.sqrt(w*w+D*D+F*F);t[0]=n*G;t[1]=v*G;t[2]=
u*G;t[3]=p*K;t[4]=x*K;t[5]=C*K;t[6]=w*J;t[7]=D*J;t[8]=F*J}t=r.getVertexAttr()[d.VertexAttrConstants.POSITION];n=r.getVertexAttr()[d.VertexAttrConstants.SIZE];r=r.getVertexAttr()[d.VertexAttrConstants.NORMAL];d.assert(3<=t.size);v=h.point;u=h.camera;p=B(a);for(x=0;x<t.data.length/t.size;x++)if(C=x*t.size,b.set3(t.data[C],t.data[C+1],t.data[C+2],R),E.multiplyVec3(k,R,R),C=x*n.size,f[0]=n.data[C]*c,f[1]=n.data[C+1]*m,E.multiplyVec3(u.viewMatrix,R),C=x*r.size,b.set3(r.data[C],r.data[C+1],r.data[C+2],
V),this.applyVerticalOffsetTransformation(R,V,z,u,N),u.applyProjection(R,Q),-1<Q[0])C=Math.floor(Q[0]),D=Math.floor(Q[1]),y.applyPrecomputedScaleFactorVec2(f,N.factor,f),C=C-e-(0<p[0]?f[0]*p[0]:0),w=C+f[0]+2*e,D=D-e-(0<p[1]?f[1]*p[1]:0),F=D+f[1]+2*e,a.textureIsSignedDistanceField&&(G=a.outlineSize/2,K=a.distanceFieldBoundingBox,C+=f[0]*K[0],D+=f[1]*K[1],w-=f[0]*(1-K[2]),F-=f[1]*(1-K[3]),C-=G,w+=G,D-=G,F+=G),v[0]>C&&v[0]<w&&v[1]>D&&v[1]<F&&(w=h.p0,D=h.p1,E.multiplyVec3(E.inverse(u.viewMatrix,Z),R,
X),Q[0]=v[0],Q[1]=v[1],u.unprojectPoint(Q,R),C=b.negate(h.getDirection(),b.create()),w=b.dist(w,R)/b.dist(w,D),l(w,C,-1,1,!0,X))}},c.prototype.normalAndViewAngle=function(a,e,c,d){return void 0===d&&(d=O),m.multiplyVec3(e,a,d.normal),E.multiplyVec3(c.viewInverseTransposeMatrix,d.normal),d.cosAngle=b.dot(S,n),d},c.prototype.updateScaleInfo=function(a,e,b){e=this.params;e.screenSizePerspective?a.factor=y.precomputeScaleFactor(O.cosAngle,b,e.screenSizePerspective,a.factor):(a.factor.scale=1,a.factor.factor=
0,a.factor.minPixelSize=0,a.factor.paddingPixels=0);e.screenSizePerspectiveAlignment?(a.scaleAlignment=y.precomputeScale(O.cosAngle,b,e.screenSizePerspectiveAlignment),a.minPixelSizeAlignment=e.screenSizePerspectiveAlignment.parameters.minPixelSize):(a.scaleAlignment=a.factor.scale,a.minPixelSizeAlignment=a.factor.minPixelSize)},c.prototype.applyVerticalOffsetTransformation=function(a,e,c,d,f,g){var k=this.params;if(16===c.length&&(c=E.toMat3(c,z)),!k.verticalOffset||!k.verticalOffset.screenLength)return f&&
(k.screenSizePerspective||k.screenSizePerspectiveAlignment)?(d=this.normalAndViewAngle(e,c,d),k=b.length(a),this.updateScaleInfo(f,d.cosAngle,k)):f&&(f.factor.scale=1,f.scaleAlignment=1),g?b.set(a,g):a;e=this.normalAndViewAngle(e,c,d);c=b.length(a);d=h.verticalOffsetAtDistance(d,c,k.verticalOffset,e.cosAngle,k.screenSizePerspectiveAlignment||k.screenSizePerspective);return f&&this.updateScaleInfo(f,e.cosAngle,c),b.add(a,b.scale(e.normal,d),g)},c.prototype.getGLMaterials=function(){return{color:M,
depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:U}},c.prototype.getAllTextureIds=function(){return[this.params.textureId]},c.prototype.setTextureDirty=function(){this._textureDirty=!0},c.prototype.calculateRelativeScreenBounds=function(a,e,b){void 0===b&&(b=v.create());var c=this.params,d=b;void 0===d&&(d=W);D.set(c.anchorPos,d);d[0]*=-a[0];d[1]*=-a[1];d[0]+=c.screenOffset[0]*e;d[1]+=c.screenOffset[1]*e;return b[2]=b[0]+a[0],b[3]=b[1]+a[1],b},c.prototype.calculateAnchorPosForRendering=
function(a){return B(this.params,a)},c.loadShaders=function(a,e,b,c){a._parse(l);var d=function(a){a.addDefine("OcclTest","OCCL_TEST");a.addDefine("SDF","SIGNED_DISTANCE_FIELD");a.addDefine("vvSize","VV_SIZE");a.addDefine("vvColor","VV_COLOR");a.addDefine("verticalOffset","VERTICAL_OFFSET");a.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");a.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN")},f=new C("hud",["vertexShaderHUD","fragmentShaderHUD"],null,b,e,a,c);d(f);f.addDefine("debugDrawBorder",
"DEBUG_DRAW_BORDER");b.addShaderVariations("hud-material-shader-variations",f);f=new C("hudHighlight",["vertexShaderHUD","fragmentShaderHUDHighlight"],null,b,e,a,c);d(f);f.addDefine("binaryHighlightOcclusion","BINARY_HIGHLIGHT_OCCLUSION");b.addShaderVariations("hud-material-highlight-shader-variations",f);a=new C("hudOcclusionTestPixel",["vertexShaderOcclusionTestPixel","fragmentShaderSimple"],null,b,e,a,c);a.addDefine("verticalOffset","VERTICAL_OFFSET");a.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");
a.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN");b.addShaderVariations("hud-material-occlusion-test-pixel-shader-variations",a)},c.shouldRenderVisibilityDuringRenderPass=function(a){return a===t.MATERIAL||t.MATERIAL_HIGHLIGHT},c}(r.MaterialBase);a=function(a){function e(e,b,c){c=a.call(this,e,e.getParams(),b,c)||this;return c.programRep=b,c.params=h.copyParameters(e.getParams()),c.selectProgram(),c.selectSlot(),c}return w(e,a),e.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?
c.HUDMATERIAL2:c.HUDMATERIAL1},e.prototype.beginSlot=function(a){return a===this.mainSlot},e.prototype.getProgram=function(){return this.program},e.prototype.getAllPrograms=function(){return[this.program]},e.prototype.updateParameters=function(){var a=this.material.getParams(),e=this.params;e.color=a.color;e.texCoordScale=a.texCoordScale;e.polygonOffset=a.polygonOffset;e.anchorPos=a.anchorPos;e.screenOffset=a.screenOffset;e.verticalOffset=a.verticalOffset;e.screenSizePerspective=a.screenSizePerspective;
e.screenSizePerspectiveAlignment=a.screenSizePerspectiveAlignment;e.shaderPolygonOffset=a.shaderPolygonOffset;e.textureIsSignedDistanceField=a.textureIsSignedDistanceField;e.outlineColor=a.outlineColor;e.outlineSize=a.outlineSize;e.vvSizeEnabled=a.vvSizeEnabled;e.vvSizeMinSize=a.vvSizeMinSize;e.vvSizeMaxSize=a.vvSizeMaxSize;e.vvSizeOffset=a.vvSizeOffset;e.vvSizeFactor=a.vvSizeFactor;e.vvColorEnabled=a.vvColorEnabled;e.vvColorValues=a.vvColorValues;e.vvColorColors=a.vvColorColors;this.updateTexture(a.textureId);
this.selectProgram();this.selectSlot()},e.prototype.bindRender=function(a,e){var b=this.params,c=this.getProgram();this.bindTexture(a,c);c.setUniform1i("hudVisibilityTexture",1);a.bindTexture(e.hudVisibilityTexture,1);a.setActiveTexture(0);c.setUniform4fv("overrideColor",b.color);c.setUniform1f("pixelRatio",e.pixelRatio);b.textureIsSignedDistanceField&&(c.setUniform4fv("outlineColor",b.outlineColor),c.setUniform1f("outlineSize",b.outlineSize));b.vvSizeEnabled&&(c.setUniform3fv("vvSizeMinSize",b.vvSizeMinSize),
c.setUniform3fv("vvSizeMaxSize",b.vvSizeMaxSize),c.setUniform3fv("vvSizeOffset",b.vvSizeOffset),c.setUniform3fv("vvSizeFactor",b.vvSizeFactor));b.vvColorEnabled&&(c.setUniform1fv("vvColorValues",b.vvColorValues),c.setUniform4fv("vvColorColors",b.vvColorColors));c.setUniform2fv("texScale",b.texCoordScale);c.setUniform2f("screenOffset",2*b.screenOffset[0],2*b.screenOffset[1]);c.setUniform2fv("anchorPos",B(b));b.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setBlendingEnabled(!0);
a.setBlendFunction(1,771)},e.prototype.bindProjection=function(a,e){this.material._textureDirty&&(this.renderTexture(a),this.material._textureDirty=!1);var b=e.cameraAboveGround?1:-1,c=this.getProgram(),d=this.params;a.bindProgram(c);c.setUniform1f("cameraGroundRelative",b);c.setUniform1f("polygonOffset",d.shaderPolygonOffset);c.setUniform4fv("viewport",e.viewport);h.bindVerticalOffset(d.verticalOffset,e,c);c.setUniformMatrix4fv("viewNormal",e.viewInvTransp);d.screenSizePerspective&&(h.bindScreenSizePerspective(d.screenSizePerspective,
c,"screenSizePerspective"),h.bindScreenSizePerspective(d.screenSizePerspectiveAlignment||d.screenSizePerspective,c,"screenSizePerspectiveAlignment"))},e.prototype.releaseRender=function(a){a.setPolygonOffsetFillEnabled(!1);a.setBlendFunction(770,771);a.setBlendingEnabled(!1)},e.prototype.bindView=function(a,e){a=e.origin;var b=this.getProgram();h.bindView(a,e.view,b);h.bindCamPos(a,e.viewInvTransp,b)},e.prototype.bindInstance=function(a,e){a=this.getProgram();a.setUniformMatrix4fv("model",e.transformation);
a.setUniformMatrix4fv("modelNormal",e.transformationNormal)},e.prototype.getDrawMode=function(a){return a.gl.TRIANGLES},e}(a.GLMaterialTextureBase);var M=function(a){function e(e,b,c){e=a.call(this,e,b,c)||this;return e.isOcclusionSlot=!1,e}return w(e,a),e.prototype.selectProgram=function(){var a=this.params;this.programOcclusionTestPixel=this.programRep.getShaderVariationsProgram("hud-material-occlusion-test-pixel-shader-variations",[!!a.verticalOffset,!!a.screenSizePerspective,"screen"===a.centerOffsetUnits]);
this.program=this.programRep.getShaderVariationsProgram("hud-material-shader-variations",[a.occlusionTest,a.textureIsSignedDistanceField,!!a.vvSizeEnabled,!!a.vvColorEnabled,!!a.verticalOffset,!!a.screenSizePerspective,"screen"===a.centerOffsetUnits,!!a.debugDrawBorder])},e.prototype.getDrawMode=function(a){a=a.gl;return this.isOcclusionSlot?a.POINTS:a.TRIANGLES},e.prototype.release=function(a){a.setDepthFunction(a.gl.LESS);this.isOcclusionSlot||this.releaseRender(a)},e.prototype.bind=function(a,
e){var b=a.gl;this.bindProjection(a,e);var c=this.getProgram();a.setDepthFunction(b.LEQUAL);this.isOcclusionSlot?c.setUniform4f("color",1,1,1,1):(this.bindRender(a,e),this.bindTexture(a,c))},e.prototype.getProgram=function(){return this.isOcclusionSlot?this.programOcclusionTestPixel:this.program},e.prototype.getAllPrograms=function(){return[this.programOcclusionTestPixel,this.program]},e.prototype.beginSlot=function(a){return this.params.occlusionTest?(this.isOcclusionSlot=a===c.OCCLUSION_PIXELS,
a===c.OCCLUSION_PIXELS||a===this.mainSlot):(this.isOcclusionSlot=!1,a===this.mainSlot)},e}(a),U=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}return w(e,a),e.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getShaderVariationsProgram("hud-material-highlight-shader-variations",[a.occlusionTest,a.textureIsSignedDistanceField,!!a.vvSizeEnabled,!!a.vvColorEnabled,!!a.verticalOffset,!!a.screenSizePerspective,"screen"===a.centerOffsetUnits,a.binaryHighlightOcclusion])},
e.prototype.bind=function(a,e){this.bindProjection(a,e);this.bindRender(a,e)},e.prototype.release=function(a){this.releaseRender(a)},e}(a),N={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},W=[0,0],R=b.create(),V=b.create(),Q=b.create(),S=b.create(),X=b.create(),z=m.create(),Z=E.create(),O={normal:S,cosAngle:0},g=E.create();E.identity(g);var e=1,f=[0,0],n=[0,0,1];return A})},"esri/views/3d/webgl-engine/materials/internal/MaterialBase":function(){define(["require",
"exports","./MaterialUtil","../../lib/ModelContentType"],function(A,p,w,l){Object.defineProperty(p,"__esModule",{value:!0});A=function(){function h(d){this.visible=!0;this.renderOccluded=!1;this.renderPriority=0;this.parentStage=null;this.id=w.__Material_idGen.gen(d)}return h.prototype.getId=function(){return this.id},h.prototype.getParentStage=function(){return this.parentStage},h.prototype.addParentStage=function(d){this.parentStage=d},h.prototype.removeParentStage=function(d){this.parentStage=
null},h.prototype.setVisible=function(d){this.visible!==d&&(this.visible=d,this.notifyDirty("matChanged"))},h.prototype.isVisible=function(){return this.visible},h.prototype.setRenderOccluded=function(d){this.renderOccluded!==d&&(this.renderOccluded=d,this.notifyDirty("matChanged"))},h.prototype.isRenderOccluded=function(){return this.renderOccluded},h.prototype.notifyDirty=function(d){this.parentStage&&this.parentStage.notifyDirty(l.MATERIAL,this,d)},h.prototype.setRenderPriority=function(d){this.renderPriority=
d;this.notifyDirty("matChanged")},h.prototype.getRenderPriority=function(){return this.renderPriority},h}();p.MaterialBase=A;p["default"]=A})},"esri/views/3d/webgl-engine/materials/internal/GLMaterialTextureBase":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","./GLMaterialBase","./MaterialUtil"],function(A,p,w,l,h){Object.defineProperty(p,"__esModule",{value:!0});A=function(d){function l(l,a,k,c,t){void 0===t&&(t=!1);l=d.call(this,l,k,c)||this;return l.params=
a,l.textureRep=c,l.initTransparent=t,l.glTextureRef=h.aquireIfNotUndefined(a.textureId,a.initTexture,c,t),l}return w(l,d),l.prototype.updateTexture=function(d){var a=this.params;a.textureId!==d&&(h.releaseIfNotUndefined(a.textureId,this.textureRep),a.textureId=d,this.glTextureRef=h.aquireIfNotUndefined(a.textureId,a.initTexture,this.textureRep,this.initTransparent))},l.prototype.renderTexture=function(d){(d=this.textureRep.getTexture(this.params.textureId))&&d.dirty&&d.redraw&&d.redraw()},l.prototype.bindTexture=
function(d,a){null!=this.glTextureRef&&(a.setUniform1i("tex",0),d.bindTexture(this.glTextureRef.getGLTexture()))},l.prototype.bindTextureSize=function(d,a){null!=this.glTextureRef&&(d=this.glTextureRef.getGLTexture(),a.setUniform2f("texSize",d.descriptor.width,d.descriptor.height))},l.prototype.dispose=function(){h.releaseIfNotUndefined(this.params.textureId,this.textureRep)},l}(l["default"]);p.GLMaterialTextureBase=A;p["default"]=A})},"esri/views/3d/webgl-engine/materials/internal/GLMaterialBase":function(){define(["require",
"exports","./MaterialUtil"],function(A,p,w){Object.defineProperty(p,"__esModule",{value:!0});A=function(){function l(h,d,l){this.id=w.__GLMaterial_id++;this.material=h}return l.prototype.getId=function(){return this.id},l.prototype.getMaterialId=function(){return this.material.getId()},l.prototype.isVisible=function(){return this.material.isVisible()},l.prototype.isRenderOccluded=function(){return this.material.isRenderOccluded()},l.prototype.getRenderPriority=function(){return this.material.getRenderPriority()},
l}();p.GLMaterialBase=A;p["default"]=A})},"esri/views/3d/webgl-engine/lib/ShaderVariations":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/_base/lang ./Util ../../../webgl/Program ./DefaultVertexAttributeLocations".split(" "),function(A,p,w,l,h,d,u){return function(){function r(a,d,c,l,r,q,v){this.variables=[];this.sealed=!1;this.programCache={};h.assert(2===d.length,"you must specify shader snippet prefixes for vertex and fragment shaders");this.programNamePrefix=
a;this.shaderSnippetPrefixes=d;this.baseDefines=c;this.programRep=l;this.snippets=q;this.rctx=v;this.baseDefines=c?c.slice():[]}return r.prototype.addDefine=function(a,d,c,l){h.assert(!this.sealed,"you cannot add another variable after the first program has been generated");h.assert(!!a,"you must specify a program name suffix");this.variables.push({programNameSuffixes:["",a],shaderNameSuffixes:l||a,defineStr:d,affectsShaderTypes:c||[!0,!0]})},r.prototype.addBinaryShaderSnippetSuffix=function(a,d,
c){h.assert(!this.sealed,"you cannot add another variable after the first program has been generated");h.assert(!!a,"you must specify a program name suffix");this.variables.push({programNameSuffixes:["",a],shaderSnippetSuffixes:["",d],affectsShaderTypes:c||[!0,!0]})},r.prototype.addNaryShaderSnippetSuffix=function(a,d){h.assert(!this.sealed,"you cannot add another variable after the first program has been generated");var c=a.map(function(a){return h.assert(null!=a.value,"value must always be specified"),
a.value});this.variables.push({values:c,programNameSuffixes:a.map(function(a,d){return null!=a.programNameSuffix?a.programNameSuffix:c[d]}),shaderSnippetSuffixes:a.map(function(a,d){return null!=a.shaderSnippetSuffix?a.shaderSnippetSuffix:c[d]}),affectsShaderTypes:d||[!0,!0]})},r.prototype.getShaderVariation=function(a){h.assert(a.length===this.variables.length,"you must specify a value for each variable");for(var d=this.programNamePrefix,c=l.clone(this.shaderSnippetPrefixes),t=l.clone(this.shaderSnippetPrefixes),
r=l.clone(this.baseDefines),q=0;q<this.variables.length;q++){var v=this.variables[q],u=a[q],p=void 0;v.values?(p=v.values.indexOf(u.toString()),h.assert(0<=p,"invalid value "+u+" for variable "+q)):p=u?1:0;d+=v.programNameSuffixes[p];for(u=0;2>u;u++)v.affectsShaderTypes[u]&&(v.shaderSnippetSuffixes&&(c[u]+=v.shaderSnippetSuffixes[p],t[u]+=v.shaderSnippetSuffixes[p]),v.defineStr&&p&&(r.push(v.defineStr),t[u]+=v.shaderNameSuffixes))}return{programName:d,shaderSnippetNames:c,shaderNames:t,defines:r}},
r.prototype.getProgram=function(a,k,c){void 0===k&&(k=this.snippets);void 0===c&&(c=this.rctx);this.sealed=!0;var l=a.reduce(function(a,c){return a+c.toString()},"");if(this.programCache[l])return this.programCache[l];a=this.getShaderVariation(a);var r=this.programRep.get(a.programName);if(r)return r;var q=a.shaderSnippetNames[0],v=k[q];h.assert(null!=v,"shader snippet '"+q+"' does not exist");q=a.shaderSnippetNames[1];k=k[q];return h.assert(null!=k,"shader snippet '"+q+"' does not exist"),r=new d(c,
v,k,u.Default3D,a.defines),this.programCache[l]=r,this.programRep.add(a.programName,r),r},r}()})},"esri/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial":function(){define("require exports dojo/text!./TexOnlyGLMaterial.xml ./MaterialUtil ../../lib/RenderSlot ../../lib/gl-matrix ../../../../webgl/Program ../../../../webgl/enums ../../lib/DefaultVertexAttributeLocations".split(" "),function(A,p,w,l,h,d,u,r,a){var k=d.vec4d.createFrom(1,1,1,1);return function(){function c(a,c,d,k,h){this.id=
l.__GLMaterial_id++;this.program=a.get("texOnly");this.color=d;this.depthFunc=h;this.blend=k;this.texGLName=c}return c.prototype.getId=function(){return this.id},c.prototype.beginSlot=function(a){return a===h.INTERNAL_MATERIAL},c.prototype.getProgram=function(){return this.program},c.prototype.setColor=function(a){this.color=a},c.prototype.bind=function(a,c){a.bindProgram(this.program);this.program.setUniformMatrix4fv("model",l.IDENTITY);this.program.setUniformMatrix4fv("proj",c.proj);this.program.setUniform4fv("color",
void 0!==this.color?this.color:k);this.program.setUniform1i("tex",0);a.bindTexture(this.texGLName,0);this.blend&&(a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA));a.setDepthTestEnabled(!0);void 0!==this.depthFunc&&a.setDepthFunction(this.depthFunc)},c.prototype.release=function(a){void 0!==this.depthFunc&&a.setDepthFunction(513);this.blend&&a.setBlendingEnabled(!1)},c.prototype.bindView=function(a,c){l.bindView(c.origin,
c.view,this.program)},c.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",c.transformation)},c.prototype.getDrawMode=function(a){return a.gl.TRIANGLES},c.loadShaders=function(c,d,k,h){c._parse(w);c=new u(h,c.vertexShaderTexOnly,c.fragmentShaderTexOnly,a.Default3D);k.add("texOnly",c)},c}()})},"esri/views/3d/support/debugFlags":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor".split(" "),
function(A,p,w,l,h,d){return new (function(d){function r(){var a=null!==d&&d.apply(this,arguments)||this;return a.SCENEVIEW_HITTEST_RETURN_SELECTOR=!1,a.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1,a.HIGHLIGHTS_VISUALIZE_BLOCKS=!1,a.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,a.DECONFLICTOR_SHOW_OUTLINES=!1,a.DECONFLICTOR_SHOW_GRID=!1,a.LABELS_SHOW_BORDER=!1,a.OVERLAY_DRAW_TEST_TEXTURE=!1,a.OVERLAY_SHOW_CENTER=!1,a.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS=!1,a.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES=!1,a.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=
!1,a}return w(r,d),l([h.property()],r.prototype,"SCENEVIEW_HITTEST_RETURN_SELECTOR",void 0),l([h.property()],r.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0),l([h.property()],r.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0),l([h.property()],r.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),l([h.property()],r.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0),l([h.property()],r.prototype,"DECONFLICTOR_SHOW_GRID",void 0),l([h.property()],r.prototype,"LABELS_SHOW_BORDER",void 0),l([h.property()],
r.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0),l([h.property()],r.prototype,"OVERLAY_SHOW_CENTER",void 0),l([h.property()],r.prototype,"TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS",void 0),l([h.property()],r.prototype,"DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES",void 0),l([h.property()],r.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),r=l([h.subclass()],r)}(h.declared(d)))})},"esri/views/3d/webgl-engine/lib/webgl-utils":function(){define([],function(){var A=function(p,w){for(var l=
["webgl","experimental-webgl","webkit-3d","moz-webgl"],h=null,d=0;d<l.length;++d){try{h=p.getContext(l[d],w)}catch(u){}if(h)break}return h};return{create3DContext:A,setupWebGL:function(p,w){function l(h){var d=p.parentNode;d&&(d.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+h+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}
return window.WebGLRenderingContext?(w=A(p,w))?[w]:(l('It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e'),[null,'It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e']):(l('This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e'),
[null,'This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e'])},detectWebGL:function(){var p;try{p=window.WebGLRenderingContext}catch(l){p=[!1,0]}var w;try{w=A(document.createElement("canvas"))}catch(l){w=[!1,1]}p?w?(p=w,p=[!0,{VERSION:p.getParameter(p.VERSION),SHADING_LANGUAGE_VERSION:p.getParameter(p.SHADING_LANGUAGE_VERSION),VENDOR:p.getParameter(p.VENDOR),RENDERER:p.getParameter(p.RENDERER),EXTENSIONS:p.getSupportedExtensions(),
MAX_TEXTURE_SIZE:p.getParameter(p.MAX_TEXTURE_SIZE),MAX_RENDERBUFFER_SIZE:p.getParameter(p.MAX_RENDERBUFFER_SIZE),MAX_VERTEX_TEXTURE_IMAGE_UNITS:p.getParameter(p.MAX_VERTEX_TEXTURE_IMAGE_UNITS)}]):p=[!1,1]:p=[!1,0];return p}}})},"esri/views/3d/webgl-engine/parts/Viewport":function(){define("require exports dojo/has ../lib/PerformanceTimer ../lib/Camera ../lib/Util ../lib/gl-matrix ./Visualizer".split(" "),function(A,p,w,l,h,d,u,r){var a=u.vec3;A=u.vec4d;var k=u.mat4d,c=[0,0],t=k.create(),C=[A.create(),
A.create(),A.create(),A.create(),A.create(),A.create()],q=w("dojo-debug-messages");return function(){function v(c,d,k,b){this._content={};this._frustumCullingEnabled=!0;this._maxFarNearRatio=2E4;this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,visualizerRenderTimer:null,viewportRenderTimer:null};this._needsRender=!0;this._rctx=b;this._gl=b.gl;this._visualizer=new r(c,d,k,this._rctx);this._camera=new h(a.createFrom(0,100,-100),a.createFrom(0,0,0));q&&(this._stats.visualizerRenderTimer=
new l(10),this._stats.viewportRenderTimer=new l(10))}return v.prototype.getCombinedStats=function(){var a={},c=this._visualizer.getCombinedStats(),d;for(d in c)a[d]=c[d];if(a.renderGeometriesTotal=this._stats.renderGeometriesTotal,a.renderGeometriesVisible=this._stats.renderGeometriesVisible,q&&(a.visualizerTotalRenderTime=this._stats.visualizerRenderTimer.getTotal(),a.visualizerCurrentRenderTime=this._stats.visualizerRenderTimer.getLastFiltered(),a.viewportTotalRenderTime=this._stats.viewportRenderTimer.getTotal(),
a.viewportCurrentRenderTime=this._stats.viewportRenderTimer.getLastFiltered(),a.totalNumFramesRendered=this._stats.viewportRenderTimer.getNumMeasurements()),void 0!==this._gl.getUsedTextureMemory&&(a.textureMemory=this._gl.getUsedTextureMemory()),void 0!==this._gl.getUsedRenderbufferMemory&&(a.renderbufferMemory=this._gl.getUsedRenderbufferMemory()),void 0!==this._gl.getUsedVBOMemory&&(a.VBOMemory=this._gl.getUsedVBOMemory()),void 0!==this._gl.getUsedTextureMemoryStats){var c=this._gl.getUsedTextureMemoryStats(),
b;for(b in c)a["texMem type: "+b]=c[b]}return a},v.prototype.dispose=function(){this._visualizer.dispose();this._visualizer=null},v.prototype.setLighting=function(a){this._visualizer.setLighting(a)},v.prototype.getViewParams=function(a){var c=this._visualizer.getViewParams(a);return(!a||a.frustumCullingEnabled)&&(c.frustumCullingEnabled=this._frustumCullingEnabled),(!a||a.maxFarNearRatio)&&(c.maxFarNearRatio=this._maxFarNearRatio),c},v.prototype.setViewParams=function(a){void 0!==a.frustumCullingEnabled&&
(this._frustumCullingEnabled=a.frustumCullingEnabled);void 0!==a.maxFarNearRatio&&(-1===a.maxFarNearRatio?this._maxFarNearRatio=2E4:this._maxFarNearRatio=a.maxFarNearRatio);this._visualizer.setViewParams(a);this._needsRender=!0},v.prototype.setRenderParams=function(a){this._visualizer.setRenderParams(a)},v.prototype.getRenderParams=function(){return this._visualizer.getRenderParams()},v.prototype.getFrustumObjects=function(){var a={},c;for(c in this._content)a[this._content[c].name]=1;return a},v.prototype.modify=
function(a,c,d,b){this._visualizer.modify(a,c,d,b);this._content=this._visualizer.getContent()},v.prototype.getContent=function(){return this._content},v.prototype.setCamera=function(a){this._camera.copyFrom(a);this._updateNearFar();this._needsRender=!0},v.prototype.getCamera=function(){return this._camera},v.prototype.getPickRay=function(a,c,d){return this.pickRayWithBeginPoint(a,void 0,this._camera.viewMatrix,c,d)},v.prototype.pickRayWithBeginPoint=function(a,c,d,b,k){return this._visualizer.getPickRay(a,
c,this._camera,d,b,k)},v.prototype.addExternalRenderer=function(a,c){return this._visualizer.addExternalRenderer(a,c)},v.prototype.removeExternalRenderer=function(a){return this._visualizer.removeExternalRenderer(a)},v.prototype.getExternalRenderers=function(){return this._visualizer.getExternalRenderers()},v.prototype.render=function(a,c){q&&this._stats.viewportRenderTimer.start();this._updateNearFar();q&&this._stats.visualizerRenderTimer.start();this._visualizer.render(this._camera,a,c);q&&(this._stats.visualizerRenderTimer.stop(),
this._stats.viewportRenderTimer.stop())},v.prototype.resetNeedsRender=function(){this._needsRender=!1;this._visualizer.resetNeedsRender()},v.prototype.needsRender=function(){return this._needsRender||this._visualizer.needsRender()},v.prototype._updateNearFar=function(){(this._frustumCullingEnabled||0<this._maxFarNearRatio)&&(c[1]=0,this._computeFrustumCullingAndNearFar(this._camera.eye,c),0<this._maxFarNearRatio&&0<c[1]&&(this._camera.far=c[1],this._camera.near=Math.max(c[0],this._camera.far/this._maxFarNearRatio)))},
v.prototype._computeFrustumCullingAndNearFar=function(a,c){k.perspective(this._camera.fovY,this._camera.aspect,1,10,t);d.matrix2frustumPlanes(this._camera.viewMatrix,t,C);this._stats.renderGeometriesTotal=0;this._stats.renderGeometriesVisible=0;a=-Number.MAX_VALUE;var h=-Number.MAX_VALUE,b=C[0][0],m=C[0][1],l=C[0][2],q=C[0][3],r=C[1][0],v=C[1][1],u=C[1][2],p=C[1][3],y=C[2][0],B=C[2][1],w=C[2][2],A=C[2][3],Q=C[3][0],S=C[3][1],X=C[3][2],z=C[3][3],Z=C[4][0],O=C[4][1],g=C[4][2],e=C[4][3],f=C[5][3],n;
for(n in this._content){var x=this._content[n];if(this._stats.renderGeometriesTotal++,!x.material.isBackdrop){var I=x.center,L=I[0],P=I[1],I=I[2],x=x.bsRadius;if(b*L+m*P+l*I+q>x)continue;if(r*L+v*P+u*I+p>x)continue;if(y*L+B*P+w*I+A>x)continue;if(Q*L+S*P+X*I+z>x)continue;P=Z*L+O*P+g*I;L=P+x;P=-P+x;L>a&&(a=L);P>h&&(h=P)}this._stats.renderGeometriesVisible++}n=a!==-Number.MAX_VALUE;0<this._stats.renderGeometriesVisible&&n&&(c[0]=.99*Math.max(1-(a+e),2),c[1]=1.01*Math.max(10+(h+f),c[0]+1))},v}()})},"esri/views/3d/webgl-engine/parts/Visualizer":function(){define("require exports ../lib/Renderer ../lib/SSAOHelperObscurance ../lib/ShadowMap ../lib/NearFarCalc ../lib/Util ../lib/gl-matrix ../lib/RenderPass ../lib/HighlightHelper ../lib/RenderOccludedHelper ../lib/OffscreenRenderingHelper".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t){var C=r.vec3d,q=r.mat4d,v=u.assert;return function(){function r(a,q,b,m){this._drawSSAOMapDebugQuad=this._drawShadowMapDebugQuad=!1;this._needsRender=!0;this._content={};this._rctx=m;this._renderer=new w(a,q,b,this._rctx,!1);this._programRep=a;this._nearFarCalc=new d;this._helpers={shadowMap:new h(a,this._rctx),ssao:new l(a,b,this._rctx,this.setNeedsRender.bind(this)),highlight:new k(a,b,this._rctx),renderOccluded:new c(a,b,this._rctx),offscreenRendering:new t(a,
this._rctx)}}return r.prototype.getCombinedStats=function(){return this._renderer.getCombinedStats()},r.prototype.dispose=function(){this._renderer.dispose();this._helpers.shadowMap.getEnableState()&&this._helpers.shadowMap.setEnableState(!1);this._helpers.shadowMap.dispose();this._helpers.ssao.getEnableState()&&this._helpers.ssao.setEnableState(!1);this._helpers.ssao.dispose();this._helpers.highlight.getEnableState()&&this._helpers.highlight.setEnableState(!1);this._helpers.renderOccluded.getEnableState()&&
this._helpers.renderOccluded.setEnableState(!1);this._helpers.offscreenRendering.getEnableState()&&this._helpers.offscreenRendering.setEnableState(!1)},r.prototype.setLighting=function(a){this._renderer.setLighting(a)},r.prototype.getViewParams=function(a){var c=a||{};return(!a||a.pixelRatio)&&(c.pixelRatio=this._renderer.getPixelRatio()),c},r.prototype.setViewParams=function(a){null!=a.pixelRatio&&this._renderer.setPixelRatio(a.pixelRatio)},r.prototype.setRenderParams=function(a){void 0!==a.shadowMapResolution&&
!1===this._helpers.shadowMap.getEnableState()&&this._helpers.shadowMap.setTextureResolution(a.shadowMapResolution);void 0!==a.shadowMap&&a.shadowMap!==this._helpers.shadowMap.getEnableState()&&this._helpers.shadowMap.setEnableState(a.shadowMap);void 0!==a.shadowMapMaxCascades&&this._helpers.shadowMap.setMaxNumCascades(a.shadowMapMaxCascades);!0!==this._helpers.highlight.getEnableState()&&this._helpers.highlight.setEnableState(!0);void 0!==a.ssao&&a.ssao!==this._helpers.ssao.getEnableState()&&this._helpers.ssao.setEnableState(a.ssao);
void 0!==a.ssaoAttenuation&&this._helpers.ssao.setAttenuation(a.ssaoAttenuation);void 0!==a.ssaoRadius&&this._helpers.ssao.setRadius(a.ssaoRadius);void 0!==a.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter.");void 0!==a.ssaoSamples&&this._helpers.ssao.setSamples(a.ssaoSamples);void 0!==a.drawShadowMapDebugQuad&&(this._drawShadowMapDebugQuad=a.drawShadowMapDebugQuad);void 0!==a.drawSSAODebugQuad&&(this._drawSSAOMapDebugQuad=a.drawSSAODebugQuad);
this._helpers.ssao.getEnableState()?this._renderer.ssaoEnabled=!0:this._renderer.ssaoEnabled=!1;void 0!==a.offscreenRendering&&a.offscreenRendering!==this._helpers.offscreenRendering.getEnableState()&&this._helpers.offscreenRendering.setEnableState(a.offscreenRendering);void 0!==a.antialiasingEnabled&&(a.antialiasingEnabled?this._renderer.renderOptions.antialiasing="smaa":this._renderer.renderOptions.antialiasing="none");void 0!==a.earlyOcclusionPixelDraw&&(this._renderer.renderOptions.earlyOcclusionPixelDraw=
a.earlyOcclusionPixelDraw);void 0!==a.defaultHighlightOptions&&this._helpers.highlight.setDefaultOptions(a.defaultHighlightOptions);this._needsRender=!0},r.prototype.getRenderParams=function(){var a={};return this._helpers.shadowMap.getIsSupported()&&(a.shadowMap=this._helpers.shadowMap.getEnableState(),a.shadowMapResolution=this._helpers.shadowMap.getTextureResolution(),a.shadowMapMaxCascades=this._helpers.shadowMap.getMaxNumCascades()),this._helpers.ssao.getIsSupported()&&(a.ssao=this._helpers.ssao.getEnableState(),
a.ssaoAttenuation=this._helpers.ssao.getAttenuation(),a.ssaoRadius=this._helpers.ssao.getRadius(),a.ssaoFilterRadius=this._helpers.ssao.getFilterRadius(),a.ssaoSamples=this._helpers.ssao.getSamples()),a},r.prototype.modify=function(a,c,b,d){this._renderer.modify(a,c,b,d);for(d=0;d<c.length;++d)delete this._content[c[d].uniqueName];for(d=0;d<a.length;++d)this._content[a[d].uniqueName]=a[d];for(d=0;d<b.length;++d)v(this._content[b[d].renderGeometry.uniqueName]===b[d].renderGeometry)},r.prototype.getContent=
function(){return this._content},r.prototype.getPickRay=function(a,c,b,d,k,h){C.unproject(C.createFrom(a[0],a[1],0),d,b.projectionMatrix,b.fullViewport,k);C.unproject(C.createFrom(a[0],a[1],1),d,b.projectionMatrix,b.fullViewport,h)},r.prototype.getProjectionMatrix=function(a,c,b,d,k){c=u.fovx2fovy(c,a[2],a[3]);q.perspective(180*c/Math.PI,a[2]/a[3],b,d,k)},r.prototype.addExternalRenderer=function(a,c){return this._renderer.addExternalRenderer(a,c)},r.prototype.removeExternalRenderer=function(a){return this._renderer.removeExternalRenderer(a)},
r.prototype.getExternalRenderers=function(){return this._renderer.getExternalRenderers()},r.prototype.resetNeedsRender=function(){this._needsRender=!1;this._renderer.resetNeedsRender()},r.prototype.needsRender=function(){return this._needsRender||this._renderer.needsRender()},r.prototype.setNeedsRender=function(){this._needsRender=!0},r.prototype.render=function(c,d,b){var k,h=c.viewport;if(this._helpers.shadowMap.getEnableState()){k=this._nearFarCalc.calculateSceneNearFar(c,this._content);this._helpers.shadowMap.prepare(c,
d,this._content,k);d=this._helpers.shadowMap.getCascades();for(k=0;k<d.length;++k){var l=d[k];l.camera.setGLViewport(this._rctx);this._renderer.renderGeometryPass(a.MATERIAL_DEPTH_SHADOWMAP,l.camera)}this._helpers.shadowMap.finish(b);c.setGLViewport(this._rctx)}if(this._helpers.shadowMap.bindAll(this._programRep),this._renderer.renderAuxiliaryBuffers(c,b,this._helpers),this._renderer.render(c,b,this._helpers),this._drawShadowMapDebugQuad&&this._helpers.shadowMap.getEnableState())c=q.ortho(h[0],h[2],
h[1],h[3],-1,1),this._helpers.shadowMap.drawDebugQuad(c);this._drawSSAOMapDebugQuad&&this._helpers.ssao.getEnableState()&&(c=q.ortho(h[0],h[2],h[1],h[3],-1,1),this._helpers.ssao.drawQuad(c))},r}()})},"esri/views/3d/webgl-engine/lib/SSAOHelperObscurance":function(){define("require exports ../../../../core/Logger ./Util ./gl-matrix dojo/text!../materials/internal/ssao.xml ../../../webgl/Program ../../../webgl/Texture ../../../webgl/FramebufferObject ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Util ../../support/imageUtils ../../../webgl/enums ./DefaultVertexBufferLayouts ./DefaultVertexAttributeLocations".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y){var B=h.vec3d,D=h.vec4d,b=w.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelperObscurance");A=function(){function h(a,b,c,d){this._enabled=!1;this._BLUR_F=2;this._attenuation=.5;this._radius=3;this._samples=16;this._viewportToRestore=D.create();this._rctx=c;this._programRep=a;this._requestRender=d;this._emptyTexture=new r(c,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:4,height:4},null)}return h.prototype.dispose=function(){this._emptyTexture.dispose();
this._emptyTexture=null},h.prototype.getIsSupported=function(){var a=this._rctx,b=-1!==a.parameters.versionString.indexOf("WebGL 0.93"),c=-1!==a.parameters.versionString.indexOf("WebGL 0.94");return a.extensions.standardDerivatives&&!(b||c)},h.prototype.setEnableState=function(a){a?this.enable():this.disable()},h.prototype.getEnableState=function(){return this._enabled},h.prototype.enable=function(){var c=this;if(!this.getEnableState()){if(!this.getIsSupported())return void b.warn("SSAO is not supported for this browser or hardware");
this._enabled=!0;var d={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},k={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=a.createWithAttachments(this._rctx,d,k);this._blur0FBO=a.createWithAttachments(this._rctx,d,k);this._blur1FBO=a.createWithAttachments(this._rctx,d,k);C.dataUriToImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAqf0lEQVR42gTBB5ydB2EY8G/v8b7v7Xnv9mmcdFp3WpasZUuWFzZgDJgkhgwoSdM2JbTNjzZA06ZNgaRJWtKSEgjDGNuA8UYeWpZkbZ10uj3efu977317j/7/4De/8ef9vCow2VUGGHzRhuQ+t08GvhZb+jy85wOu/68JzwtQSCZedpsvC8SL6NJNNwZoHMaZiMoCrjrPATpGJFxvRCYMKqTCBsyVw8h5B6ROArU3+8HOGLe3Ay+UABow3D4wEcfOakDbjh2h594mikMNcI62ISNzIius0bfeN+QHrv+L7M53FHq1XC29breFgmCjwPHQ/fo88OIg9kvDdQPhB93G8yk6DtRYFT64fR/jQn0NIcIgYHylyFjVHPBboCB7HQ5sXuoZqQCHqKUjtvKNpvxkivqlZe514DOA/Keethib6OkOw204MMTjY3HX8VIGFeITgBEApGRFY3hyKyPeRWK/NNa2huJeLKzBJAimiY7ZQbAh0HwPEP9jxHhs6he37z8+KWqdeD7TCttNwgHftJpfzCq/iOJbKrxap2Ymet8zwVEoNReE7T4aI6t2mBuO4Meyh3vHAeK2+KvLzWHEgSCJpgR5EvP7QPFLyeDWWrqc1iVz6LwPI7GEpOEExCwzVZwtKtDGyzRW5tGyz5WA7HLtfrOIHp9T9kXQB1z7E10eYMytTs5QOuci8E+YIk9W/roj5nxvjVVLaM+30x/09CPGIdQlfsOe/WqxoS9Sf5bVv+drIqyP6uNrQMxFGDPSt1PurVE/UcuV9ci35bmCPTiIjsuZZjZCePj01iMbKBYa7UyVIDI+MDMSAV7sw6CSjKEG0IqwXhEkVtFwFJQ9D3q9q2RE8xEzuxvCN0Bq0pAFH7IMZEW3/zQU6rQ8Dw1bqPE2XCxtht8B/Hsg/yzu3CUcGdb6PW6QCVRs7bYKDwDQfYefmmJO2O/d4LyOzns2kA3kt7Bxrn1ZZ4hlYFs+uYpAnNDyDI36VE+6wLadkEwTwQIdYovCIM8SEVS24D+ktuqjWIT4yWFEN/zEfsqIWkFfKQsW8DNVyLEDKWwZ6ew8x5ojpAmh7DbTuiCGFcW/DXl5hO7Y/BztDCbwqtMaxcanBq59oBYuVIAM2o2twXHduUpDjChd7xinXHoB5OKsvd/jlrN+SnHoir0dn1hWWSbrDzj0Nd6x3PUb1LYyVIpv9AHW9sPW+aEhU8peULyaAG12TddDnq0zVg5S+vfnVLQBwjt3PcU9k0feDfAkCjohqkfBRgeVfcx1xYcTzRYoNbVPbCQ/mmC66x3pMpN7IPDeT7a2+TYYDYj41QNoEoGVQhPLlIPb8k2yMZlM2gNIiEu4nfIZFKeDW08qY9ds2wLoLWIt2yJuYrXnWhNbytRVs1sHIw6qhoE/sYJsJArzFLNdUzxalSOyF3oIBU2ttqZFumoEj6XoZVOHKWSJDoGe+WGZmObQuA4f+uap/u15hOEW1LveusgkSWNvivQRRg7bAQWcd+wUcmN/DTkr6XeHmX/pVnYkebSt/RBNP8PhsXnqFhfUu/ozIH++g98KYa+EnqoRZtFucB/WVPy5MoJEyH+RgSeFoTuDS3Rjpi7Iog/+N2aD7N9oJkprVsWpNOqZ5JsMfDKSID//tUCyQrANUm4Q/czDP1mKVTo2lrM6uuJh9RV3pMc1ylB/5zpYs3EWgR87+hDYZY06VIzFYd+HxTY9FyARG0RytMQAJujsU3Pz/qPlwVVI99+KBosYv4qQOzQP4WWCfPVd5eSjvPMmAkY0LFL9lX5vMfDKgtMADu3pCrNLctVht8XYBr6KRvBkWte8jafxscvmLE7tITB4IxDf4GJ/7YdtklZdgOO6z62Bj4ADitP0UfcQAiwSnoEgw44j+mCCpjb7zL2IcBSOYLS5ArdRgU/EJrsgnLhuAgv6ylO+fTYJZMPiFVUt4bafDNpq8gW2/+Wc1LSVejMjel0a5Yg2kUT1DzSmbB3aGVsieORVfXAq7vYkeQUZKUHxZlufMOFKsneeaJYoxjH4j6q2BObSoPx+o2RkzKti/lyb2uC7h60bB4z9maJ4tnFpvw/fQ8zfJ3IAAiSE6G2X40l/PFI+xGgcAjM+/31BL8p1KGRn8kFaztzEFxsAfOxjR910VTxaqsh6/z5RGNebzyWtoossscYHUPKL91d9BhtQTclREMGf6PoMnmDJ6orHxKl7RZO9DwAIBqRCqlbTHs8hf0fa/1ZcPuxk/I42xYnbafCqgGGatSnGPUaE/1azHhdzw/rok76dX+vslH00lkxaRKfW/wwn3mJTQOH5bu/vzgMJNnTuAvJMFL3p9f90ttxSrfnxNusCI0spKhX0O7XBAHcouivCT56YhuFE+A4vrQr7VfSfeXbsbpt4rbhpwuNPNBagcd8A6DO4PgSzeDQ6lGlIevQ2yGyG3fn49mPgnTNJZqVuLwC8E3FFyBozgL47rtOWlrXOd1s/dRPjgYmLAzl2dWFOGk+bW+PStap2Xm/ERvzJdDYd4fd16N3x3ooL/FzJ8PEPT4H4WRk5ygiRK97yrjHU5p/69gdFfUdLiDlYG0NeFYyjRmZNdLM6mDPgwceejmpR8ek2Pm02WQ3ZqW5nCDTpL9931LtJdladOI0oZjCwoGICD1xZV4cYZxIgzhjekCf9wh4+jDU5IjvsdEm/12T6e0aJ5YqnS7ROWkWBX3FAnboqd7c6kAcAxZwBS3bSAZcH0F6pV/7AkfvSEzW3fzrp1VvQjkL3wetuK7N/CV692ve/zNVq5KYktPLl/CMDhNzFjT6ZOIK3RgxqBaLxgL8Aoc+F8MeP7gFuRpXbCDtlAbL10NvMh/tsocPBVQx9SFIIiN0CNzcipYWwz5GmjGWiarABr7U30U+uUNtF9/saPWDaKnox3JOtzsKvq1INHtwgug+a9C8U+XIiPGGIWaCNg7RE1WFxot+t3g22M6JFGzGOpSzmpS+ODP4Q6RwuwVKDW0f8olQHYv4Iwf51NAr0mmJoXL1TpxX/Jwq9m3b+wiCKtLfiNrWV4I/5xBkDPvnpZ+Q8EN/Czdf1bA+T5A6JpRxP74kwUm8y12j7Jd+fsDMtag5nJvLUigJjbnooZikOBpxD6T+Nk7Ln0kFZlhujYcHz/L1UK05AHRt+gErP4E4f5gKsX+O8TCsbUG1hHj2+vX3Ng7bL0R3a5KytLaPmeay0xND+gBfUj9Phq/2xfYKS87H3ta1Qso4H9Ca6X0hoMdy/IXM7QuhIVg9ZbI2oBRhk6xpX8qoHNrL9POGnrNERY9igV1x61qKLAvFcGoiRcch1N+k7LK/5D0D3eIobCG4s2iADwB67+vJqtk0Tc1TMkgQLKKRG4Bl48I3u2FQq/lO3XbK9g21Br2Wrcyobb2DqyLVhQbWbiwX3JdQGgLjIbjStUiveYGF6IpjdMZj6eyO1pSwXCSByV38TzEY2/VEpeAXdtABk0qq9aZB+cGf+ukGgq26f4iAJfso+9b38L3dfnIImHIwH4TRyf4e78yxS+Uxq6TugN4xw5XDxOoluqXYDJhgyxre24BJr10njnXjpWcTtWbdv4aXNbXQq03s36vFSR1oz9oxk321YuwoQdbNCsfy3tHAmMcnpdcCnnvFu3ffTYs/Ph90bPfqToDdPLPaNcCKivoo0Rwkqbsk1bPVbJpYxGIKUfXH4pK6H8fghaPY13icA4JO+NLuCpoYlHDM9EB75+kNH/n6o9zE+TRnBkkL8xiqWY+Q9ZzaAg4+fLzZjhNfw3w/gUQRFiPz+fPeS0b8aFIJGPC+rr24QY6gIO9YVpEO6A2aaeyYdXRMVVLdKluURo78cBmBt9EtRzeNaKwWKt2E84X3D5pkIp/iAp5BlCgOpbCJAGniU3QBwNA46JmID4zirCmjDcPth6PehZa+zDdAvOqltgXj53q4T5ealBjQn4yoLHxl7ENmhUxeNvsVRYwtikoW6UeUxgr9EMFvwiR9UeuVRYKur4GLqMtLds4H9c7GxNSJGLKubjwZ8TGOXLmgCr4e5uEw7XWCj+lNk1wMUOZOC/mXXfhLtvOu24Kyd7Rq3dEnkuAFo8DA4pyLpJ0zioo44oRxXdESQO1rq81ulq3WDJXbt3ADVNIjWg2a/R+JYnI2PeepVLB6LPzi5eMUa2/jvGWrYA0pIsd2Ax6mPHbLgJuQbN3uQNGGu19WDg/3b6lAnBRn9N3KlQsrLj5LkBOCnwk7P3pLX1ljdnh8cnPPerTvbJmSkWHISCPCTNYii/Dg4JrjaCNS+3DAPRwm9DyJkalkLQz4YsGNLFveiCyw6cE4MzvjUgRAl0jAQclYHdAaYaFVABepI4sP/oeepxPi9oGlSi3tpWIX0FzAOuE71y02MAmdQrbkGPmClGtJGKw+fOHi4cTrPd5qF/4KGkWmwqPqRP9fyB03ZL2FMBtc/W3/43eT17zGJUY+tBegRFjLJktlYf8TKpkmzJai8GvczudWw+UeEPcTZGuLLoFGDpv5YDH7ZFo4P1jmZ3TCjEotNcBqm155Pjm3NzFEKWKF7KcVY72eG4IF507vbNnbj9CwxsimhPW5KBT/cwpfvy/YzvJdcA+6n/B0d85Em9Jpj0SJ6LewBcL7Fw//+NzPSGw1uSqy9jfTmcJuyMzyA57DcJ7BZOkbPIcUXsDPjoMXY/keYYLd0Rax9ZOgJqJzTsb8onXqy1r3kKf8mbdIKVceTSXiiGi4/HR7Pt5tt27+BzW2VM1tj6lqIToB4087XR9bgOfSFKyGf5eeM2J0YhpmrH9/Uu2+28qDSL1av08BUz/i2dTounIci36M4SXJfQvpHifh6TOnD1lTMejVlfZUXf66md5FwdmEaOG1150HxOMK+gQNbgOZs0N1/lb7CJLdA8ILbK7RYCYPhDrXAb+xLMG4f8mFkDpBeyS5+tXLxfxPxJxjk++79i5TfpbnAivqN+HcMfaKsuVEQwkWRTQ6/a5BboYuIP2CsCo3BHucNjYkXfHt7YLxqKU/w4c/bdMrAM0RpawTOtWVdL3+l+Mr9a6KGHjzCdL+Pcs82YJuhXDZ2rh2NZcStekK3eqM4bjnwp/7yMa1OFl1OV3t6QPCo35w0tr2V7Copy7J1Es2x8Vv/HFIPufBxivtOv7nfIH2UelqlYzTdYMRhlOaizWtwONQqix3wIN5egwKRjEqW/h7rM7j0/YG2BRMfQkYeQJUQeo9nCmVps09F9focPDhOOXQUQMjU5dVeslBdgwfdev4kpssy+ovCLglTwJ6SUOXLRMTn3S0pz10x5bTC15u11cl30Nk9Jrzr0xP8nKHV48h0J54cVJqaeI9qlm1gjOB1k0QhXwFP2ObcgC+t0r1ti6P/KzA/SXo/IN0SMFjq9ZuIrLr9A1akw429QOUM5B5UEmUvRmTAe60bM1yWrYMPpCFXI/q4RWB0CWq9rGRvUP6uaKQ/IG34bkpJkt3ViM6N0IEnJx4orp2D+v9I4duJatlZ7BHsJdqYiWJ5E3tNwoeEVCoY2xmtrCoYT1IXAPjUwBP+UKQvs1zFNa06XEMiWsMnUtTlALgZWDlM1hWo28GbMfiUPvgdt/o7pfRflcM/cqANpekRiR1c1GDZum7sabObAKJGAiHtLqegHQC9DUL/UQuHsMQHtHGasfv6lruN/s+g4LNBZ8IJFEA+CQPYmvAjW3wuu8Em2BOLwXwZlFGfMPA9gYvg7ivh8mmQV+jMZCwMKS/nJW8SwW8HazdipRdLct7AJkj40MeOWg3QPwIrXSSc0ovjYScZv/py9VCo137HQyowz7J1BdefseFZXLWQTNmHRNUYHKOArrc1Ld3Tuhw9+iusRlGgUILvkENzEP00tfai71AkRVocwA0+urjxvsVO2au4HpYHBLzTXC5UGH9S7qA+0j8DO6I9fVCSn0La27FII/Qbem53DIga6BQMqMD2zzG2vQobkLxi4skm+av45lv9+w+7UIYVvifAu/74qdQWePGbEC300M0D1rtJrtekESHiIQhLqFk1c20F3oyQ/1MLh3NF2TCvWlpMoB11+RF/m885P9EFQfa2INC4bf0oSDykNB1c7ThJKog6qH/NiRykcxtxc2BiNWPBGQs03Gqy95X23pK3XS3Id6JoO1j/fb+rDEHXOWYCdF5p3D/MD/9Mrf9+0tmM5+43b29zk5/TG88Wc7/BuItg64CzAGDFRsPDYMwC4GPHTsRewpMoEvw7U5wNabW1NhdM5YstTBJvmeCl7EufAXYGheRUrgK3lAcnaBjUtvX7A1YCYrVzG4BI+Fs3u211IAOjITr3qxz1iQhYAzxcC97nqQcC/gNJ/ksGu21JMSvl4BgZhY+tDS2kbAZC/0+j2RmMSIBqxviUr8mBMw5m0irMJ0A6wqp4q7OS54rtv3SYfwE31V4hYBefEWo9yP7E3S6Ry/zAdvd68APdrcHzIBj1kQVNtfTmSN4Y1lvHcX/BxRMGVgizNziT1a+NL4f1ZGrBBLkAbTppStCqqHPLZhyPiDx3SKmtw205TO2WxMEQqkULr7vCn91BzmndvbHWFAu8GiSrgAZyZNMScbS5iAArlhrh5G4HedwL/wH2E6v+bbD1O455A4uBvlNoAUNKwqPsjk9+loTuhkiXwuigelze5UHCb/AJNKw2cc+G4CfE/Z0ZwVsDXSAOfr9R/gpL/ghGMJOL8BA2mOuKNInxFF6AW/7uErMW8sNkEBOBtXXXEbm30CCTJbxe6EOIbec+RTjqvdUflOP7AfgnkC8nhSIm3neEOmts61kCO/o2RP02eqWjJjzYn3A/WgFSoyAwj64gKr0H3nFCK7pZt2FDmwwcSqB3YBMgY3HXWDAoBqr9PHSGIeh/l/QZXZpL2wpO7AylAwZ87Pce3z6xUVvn4SNt0I8zpte4alIJpNWn8cjfSE4UKTvooupk8qPXRvFrmj6smvX17qSIX9baO7HYIjg6IqOvJIEg3tVQ9qyR25F2fx7JpzrMHwCdjgkYRexElPxR1RDICwMQssAVuoCZADE5CJ9ZJS8LV/rUdEFDlFhrI1yQ+/EEZmII9DDLO54bQvrj5cmbQPfa7cH/UOQXdKzucZ2IOklamgTnaRQuwQ/+x1PS39leFqUqIMbQ9x6YH8xs9TiGTviU6lvwehYNuM1i85I+gNg8DiEuTIIk2iOce93t0LQ0udyF6JpSw2dw9G1nJVmKfxT36xJryH6PzgQR9qRD1Mm5e37Mygzm/LbTyeGse9tUbxKBlqB2FtLmQgRT0XuwlEeSNxcWvzw98AE28vXwWr2FlIrAWsXu9Qf2Q3c/wgIo6RZJ5GQlejmceYZfebOaO8nDj/iTnf8s2C9IEEsxD0K57+JXP2Utf9NInQAnGuzKs458w4LXRbgQ9GaWxz4G11+LwAVYeMNM7iHu6gv4qVhtn2OYKeKRJRdJHF61unu1ms8j/2aR7OYTz6aWX1mXRDFnB7aepsLG4BHvkkwVYqa/DYsRNiB3CDPZ2q5Kr5L8oC6j5ULS3/jzu6tf88tQ1tTXmBhfdwgUwXDbbt33gD8woaq7sVQiLnSMXLTtZzY89fkny98x1N8pSu8ETpNAIhg/T8GIQvlae9NA9hx0Nc/krzNurU+PlTodk7+HO9MBugPzcYk8hFtQfN/X7klPxXMLqKf25wcIYKZhb/Htf+L1Uc18kw5jZOGML5c98ZDc5yHfzmVjvWqAh2URb7rTpwH7Z5Z+n7SJeCIdOVzgdwzy80P8Hd9okBHiZ/rd9S+Vrvw4zFlirKiTK6TcVpw1zP5HqVhBXt6RhPfu3IsNMMHfNPSZVSonE3UuRpsMiGM3OJSv93QnDntYsYtdGVuljAmJA47Bndeazv44WQHWORbVjGCIspejDdhnQEoI5OYlcXg5yt52/BHhWJF2Rgxn5H7RStg/JEAf9XnV5j1UAfm2Iy+qgJmEmxTPRFm9jxx0wK5FwlHNEHBPdTZ53Mfs/p00dG2Ren4MbqsBCHPX40CcaD98IfZyAX/LGkYN+CRygtyrER/0WGlb84sVrjlknK7HuCRx0us3BOkONLiBYUCABPNb+cChaP1nBEzlW6DhhQp4wS7EaP8jKzkYuZbKviVem6ZHQsCk7QpfziL22v/or/9J1/1wUns39AYhbg+CwWbwRuSzsQTe07J0eMfvMWHVtaiDsBwCaUJapcqMVu/+bgG9YOOvJ0rvKPZQBrhYhc4Z5hMKxupj1xvFyWmg1W5N56lDJHzoDx/cuAshRzC4RgMiLb4Q2pN8r9bnJc+XUvwe3YZ5fcMVHyusfcuXdpv27i51WA0lbuZsfK3s5de9lWW9zXCCmTWIWhI18QtJZ9RNj1RbAC/ACLbCUo/Cit3JZCjjtKR+f5zdBJtOH2uWGr47tDtauNpKbom3Vu6n4oxtJhFDmzaT2pc62ZPu0gKZ4cnId/Bp195CRRtJRKMX3+4KNbD9NDEARUw+Dj82NV0k8VggVL8EZM8rwKmwWWb4ZiA9mmtNR/6rbulcqybAyYcAajMrvmsCHZJlu0CItUtWhsU38uDA04ET8wqzujLFgSgRRzt+kXEaAKwDm59pL/0Y4byu6kKl7cTK+UR9vb7pvG1tF02qxaRg1uiHnx+g7wOFJdw86CMbIvQEdeeHfeLxFBSPJn5VXZvyXLVsJVZjFpf/G5N9TGEn4xIAIx1aZlnqNx48+fxpszhYt1rUyHKHyqS/reuRCO8KEKE/+p90d4cP7dOZGBZrAe4Q2Cr6VoWFGp7KU8jzB6QbTf++mX28Qt7b0RpHxG638hMdZDlOSXXCsLeIhHkEgDBnDc48xzage9HPIxbGocP0yslbVL0Ed92bnx3d/O9vKImgbfPx20LzQCP7f6r+b/H2tmDTlvc+6g0PHKeaeAe5lUU2I63NVlYI5Hba+5RBXfNRT+s/tQ4/PTEt6013TMhfYY1q4O1CPEUaPZSt/QOqj9rMG3KYH1yhRG/UXcb6yZcW8U+k+wPZPCgBlgpNu8Kf+VLERKyNT9vbszywFAMfMpx9lkOsgwtg4j67egVCDgb+ZEV+Y3qxbUuniUxWX3sxPzIPegZS/ka7kue5Y0IwTZu5WqyB9RSCfE3Uwk57704/vV7o8av3lyOVAoQ+jppahwoMNvpxOGpVqrkEMMvAXy4/1nLZ7CXbF+Kq4DobenxfVH8/pClZz8kcJjJSt/V/IWS/l38JjraIQDwVzDZtH9eDrv81QfiKDZ1jLt12E1ftzmRWhx30rpGsWMCynxugBxI8c3BRcxANJ0r34OFhMkV49Gt40u53T1vkZujkMataE3APzs1g0F8IXsmQDntQsdKFNf6iGH8VLQGmiW3JPBuidQduZTq7OqgW5JykjNnmiYjhbLj8+P7cqCWZYZRrkQTaRDf45QL5RUW9XKQDYn5MF6gY8ryV/nXW3qQrGXcQEKwbvgo4z6HJe/l20BOgwI4GgQJQVMNVFiLM3ZsX3olzj1B2we3+Guo/EO8csQZWY33MdXWPW08uYR5nM+10sH+4/+NzncE/GNbn6voapCiKV4hwCWxfwQ78q7g/B6aP81fbEJ+wCzml/1fZcKYdX5lgUa+LB/huzhEU6bsC/HuPnLhb8Wg6ni/HtV9Ygzwe4IyOGaVdivTDbEOW8wcpQLHx/7eC3Zi8sy8oXu5DhE+kw1u06LV7AqFiBTzxumkfMOCJAaDW1i2H8GXwYpRK1uBaofc2xGWoiG1SfQOZZd0xdeJz8d58GK/YijySB0J9Q+cPTWd/fav6mWhmSO8Q1NbxYhNAcb578XuSsC1uvGTGXkoqnwE2LrPE4WXsNmR+dr37NhPqTXwkhI99/qiruLWDhPRfke3BzfdO0Ym4QFzArH8aMPeu75kh1CseVwnsv8eZgrp91VD2VNU2J07EI+ZuhsZro1D0FpfMsrN9T7l9p9GKTy9r7nBy5t7G3PJk57ic3KRV0fbnLkfXYjF0cMEtFJzX6tUctEsk76FuiYm6EKzekXpHANhG2gts8KgF2qDT9Ady9p3FJLXcvD25D//CQrhEA4ctzFtu/O1u7KgeZ1Lgehq0AnjThaOUIIg7oyTm6DQFQGxYkfvTSD5z57MAe02y8MhnHbc3kWCVWgQS5KFidDa1hijkDgK9HylNiIkH7XUrO8mGx+CxPLJ6RBdr/s20MPBsaIkt9iU5tym3LEP0dJx732kMJwDPoVwVGRLds0r/XgQ5tHsywG8kAgXM0DB7PeFzbWyWa93IoiNSjCBLB+zoOu2+108JuNch6SnYLid74PzEj7llBoIHpx7hDqyxHrF/GasXOcNsJUiWOCPPptVgZcrbrM+/gYSTsRQGWXfwbi+2QpryYDX91ZRFe+c74jbKkPWQeYJdeasX+669/9kssmTPRZwQeXKLpE1E+wMyRDnkcUh+wZGLtPCR7U1wokVAtb7GMvgxlM9qyhlaafSIiZSV2vD+PkAeQIjhlvNRwBAevJgfJOo8qbpPQ2lV3ymUV1TQolwR8JBjKHETgw/91SRAJYKWvUwY46fq3dmcPUTKvlFYHq4cWmVrkV/zqAmy8WLPDahcp4/cpPwdQXMEimgoAXgeHsB/4wcD4WgpYL2kvse//ZIdm06Q86YrrHN/K2SfRJ33m8q3c8ZOC98HW3tg6JanGyYpF7dQgLGiKVfQ9BSfnsWrmyqiJkSrmImzcgVGKVKYrTVWN7tf6d09g6JtyFuSLqhgFsKE9Fy0wFs608u58BMfHhXUar/Ce5muvzisF6JoXe2fcbJTln4mpowiRCwa1bKE6YQTUT9l2z2PjQjcg7OFOC2z8RtLwKey7nwpOL7UIOmIcqMA0iv93CeLhhdhHK4m+WVcKc6sqRqPbXLI16EKsbTpOrc4BMRmvPYq2zwSQVf6zmEllfa8DyVodxwKuwDoOxBniJSY0GaSTDsOqaQq/TpWPIHx64a5xoLT7VUtdG8H8OA3t0HiED0CijKwqttKb740UfZbUfUqGDsNpefiSl7rr/f83Q50h3RzmP+FgiNLqYstIw1HsxCxO+NEcqIwD1RLyafv9PRS1ILpg6J3x9QLGncu4++SB34Fv9pKDJ2lVkflsOoIdszZhLGgK6yT3sT6qIAYAGSBuEik+gu6XOLEgRo4G9MPE8n3jPXHO7aczYZ1+58G+f9MLf5MHd1ldxDeLWLZJoN9pgofnfxs6YhJmWY95DHASjIJ7z4lgpx/SPVFkL0J+49CDoRHdmCHKHKzSLUtPev6OAMuUMQEEHouvSjVNk/k3u7co8aJ+6ADVeEupccQgcHC7UHvmhdNBOLdkMUixyPyK5y5ExMa1LU8oJ3sOnIx+RekN9rAOLaHYPY+Mg+Y7XM8dkgU5p0NAOF36Npi5F2nrS0C9fUadVLAZStsYtK4z94LmF/r8P5vHAT/Fou9Tm8cbjNGvPSpfGe9jhgGmhEpo965JlCczvY8rexaSSe7OVjwZnN2Ob0XkI0+vIwpbCs8lTFWA3WPBZ+j2YdrQXUIbCB4f3E+ES1oGFtWgKXRWKbVP8KnH6tCcoS3ie6H7TTq8e/HEl2l9buU/IptFZByo+5URfMLrQ3UGn29p2sMOyh5u9PYYuA+tOC9Dtsn0O61GrW8Vd1aH6ESfgC5Jg/P8EeGoNSrO1RuOKZ6QOKuKyDdGpj3XS1dR40xjXig7TSGmF9BUEK49IG27ZCocDx5yYHgIKBh8yjbftWO9QPkIibON4Mkgr6TQvea8SNccZVMwuqhXXh1GcPOknL/us4J3nxgC/7gSJD6ZPnuEYD5h5xabgNFEADolRV4z8cp5UeJB0vLK0bCTjKuGoBUQPwToZ9JDn5+w5NxIp4QtgLQBtgfDq1Oc+biHviY+Jm56YXtd9rtk2tlOP76Fb93EUwCcuET2W7HdYPAfxuz11rhA9bgJiSxErg86pGuTrrkL8nelqi1o1VcikcTFPFpXBsQkF9hrfTG5MedxuuME2ltj2r/X8zXK+ZOiW1l5EdKm0wYA6zzCzH/b+cGOyASKNKByGzhU+dk/DSiX2v6GbD0sUznKsJdgSIpDB5vsOUmpSXMKxhQJdBh2zQB9Uga2d7mF1i5Z8Pb/mg0GVkuNZFeFdf6/sQsRJ50cShX0xvFi14EdTAyK5xklct0uG9dU9Ly1BB7e4OdFA2kzjJ4+m4cGSTZsV7nWyCf6oBZWxqinVt+YsTvf6sQA1rUNjuKCtq0KP8EGoOrnXterJwiZH5WDOMJ9wiaTF4E1V6uuU/1KwyzJ+H1nMWLaG9MzrZDB0QJOUnUSxKEth9LU1tb7gYILPvJutypcbbUg/cb8KOPnEjRaCOkwJVQYECuiICK6u6V6FnMA4Qdf4LKiO9CPrEHjf0QCB60rN/YDmrSfSJweSDouFYaper4DVl9KMj8Qq4nhIkrzSCV1VtB8Pv6oXTxphryWz16RTVKqPbbKq9zbQasDtcKWRE9WvP3FNcsICp2kRWQCpSzS+z4+Er1rJgNglbTAWRqrATd8ElRNLkfMfFJWHPwNMPW7vUSOpc9im7UGfizlYOdvT787XWsxMF36s1xPyQov0uMDNuh7HVeyHWziyzKJnJFH1zyJG7twS5yiydQvr+9XtYK/mjNWUEdhgM3TJsWQEK3aaE+HqwUhLE1b65h42a1E3HMqoXuC4BzlnNuEIgryVdgYucd4NsTHd+tf+jBWV+6h6kT2CgOBmdI7gEfBrIYkOCO9tZGY+K770tcEjoG+l/rLT2tDByN06xhRUokM4Ltw8U/fNh/ydTjO4JddSFJ0n6Z9SMiz3lreKURYDM2Z+Szp9+zXvKr6SE29NRrJAGbmRjkSxi3sOErHFrB10tJ2uuT+/tem+j2qexl1P1B2DlgxMa8kS4WHKFWv0vqTQxY7YqnQN8jE+lmv3woeUknMmJciOh8HaLQ2A4uHN+oXYqBkyrckpNz2iLo5vZD/nuEEs/JWzZsCcp2U8YtsPcGQNdIOqvcZRD40+RjBs4WmDr7pU77XhyaIrC93dqsR+qa8BHQOWj4Bu7/Ha59bpCbhRoXY5nTHcgXGvNW2VGXpouirMtJDL3cggbY4AV6rYdtSbnCb2FR0Z3oEVYPa38SZH/o+79XTKl48AVc9BeBWAJbggJXJboVa3PUkSLquk/t1LtVD19MizUfx5LVJ+bJeSq5krVfq1glKB5TIifOV/Do4YI96WDkPPZoWbriIDEdfqy828yhXsnn3/Q6xwJvxVRu4ckHYGnN8zaBRAdlIQwaphWujvdJ4yQCnsPlge7wXDKQuPB5N5wTIyBk/4aw/x/R8SmxQAIM6p4hOxgaYEqGMRpnHcImrDOAMzoXe5VuTKeSPwTmd9FAoKsDOcbGwJsRslfufhCPDSOeWxn4MGty5kg1UIKiP9KtE0xsFPeMLKY0a93YsRVF6su0Tt99uEIYYhogYODAIeFhKqEoyScLyLpjtsnsKTisrwea2HklEPbCjoHgxYi/aPGvA4ZvW8U1dmnMPBgKzwPWT0KUDrRhLPZrT5vB4pMbfon/pNjubIqSAql2YwbQQ66PYVPKvacgMpbKeSS7HSboMBqsLqOFLRlY6bT9QfjaHB7bGfcHQrij1HeGzjphnmbYO359jhvWcLnotM4nsaKU84N3l6nyqRVAQ2K1lrzE659W4Y8ff/hhirkxkgauyvgHNf5Azu8xxk+geLrsjEjx7wK9Z5DodQgqFhp5dO0L4xmvV4M0Y0SFL0OEAVJhhZCKKOnUEM+8TXV/ijaeWGRfwFcNXeQQ4Y7jPytH+ZKzujr6KtApadQaVPlBtAUtg9thT+0kGoo/CvMwOHLTWLuQAvZKzCXc2eFg388gR0yblNUY5JXJ0oFq8N6Et7LKFG367qbWxTUnt3vgemDfAeCT3iMX9+ixihTYoJQGQduFd2K61cIwIDy42PwyyfBAlB69X7pGJWNsTubeIzIBLt1b4a6OQB8ptWFIGIquvVlHu0wqhWx6QJPCQW+8z2h0mDaBT+D9Wddq+oAV60yhIgprTSh7klj8n15U6kkIEZluuJjvLpLZU1QoduLnoIodg37XTJlN/Y0gfKIMzYFZ03d5Wt7iluXVifzY6pDCEoLJ9wOz5Hy6CR/+zuPZFZd4t60NpSxXp6rd3nWq2NfD+YRwSdCNRPK6Lu8LkjZpvlgn+wl0xjLLDD1ixtN0kEMsMAhr8NFsCh6wXAOvrUOc0oEDDrlq9fZH0o8qXnYcv+cXGJweDpW6T2+Lt5q9nFKfv5/JnuxsfcdFm4RMa+wwv/5WLaaPCuv93AxVUQE4R4hKhMQ0H+TkXrcoWciBXUUSWJatVI4SzzvRkzb5PRI+wBz2lOju72rUh1j7mdyWptDkPB/q48dgfBzSCRDyLK/iwy+4+Ndx/I5XmXXV5dlkcnObFaHFJvI5aKgJzGYQ6qpcZ4zooB37BkE9QnAQ5rfxPDVE0hJ2oN6rBryoUXU3OiuuHV/IygkyxwkqeK+YUcsBo5CdWKXw1IC1oZd3U4uKEx93sE1J80d0cKwYmHeqt4jBHVC3p84ObsRrrlbAlJtJcKYXRdj/HwATFUYLcKM1oAAAAABJRU5ErkJggg\x3d\x3d").then(function(a){c._noiseTexture=
new r(c._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:M,height:M},a);c._requestRender()})}},h.prototype.getQuadVAO=function(){if(!this._quadVAO){var a=new Float32Array([-1,-1,1,-1,-1,1,1,1]);this._quadVAO=new k(this._rctx,y.Default3D,{geometry:v.Pos2},{geometry:c.createVertex(this._rctx,35044,a)})}return this._quadVAO},h.prototype.disable=function(){this.getEnableState()&&(this._enabled=!1,this._quadVAO&&this._quadVAO.dispose(!0),this._noiseTexture&&this._noiseTexture.dispose(),
this._blur1FBO.dispose(),this._blur0FBO.dispose(),this._ssaoFBO.dispose(),this._quadVAO=null,this._noiseTexture=null,this._blur1FBO=null,this._blur0FBO=null,this._ssaoFBO=null)},h.prototype.setAttenuation=function(a){this._attenuation=a},h.prototype.getAttenuation=function(){return this._attenuation},h.prototype.setRadius=function(a){this._radius=a},h.prototype.getRadius=function(){return this._radius},h.prototype.getFilterRadius=function(){return 4},h.prototype.setSamples=function(a){this._samples=
a},h.prototype.getSamples=function(){return this._samples},h.prototype.computeSSAO=function(a,b,c,d){if(this._noiseTexture){l.assert(this.getEnableState());var k=this._rctx,h=c.width,q=c.height,r=h/this._BLUR_F,g=q/this._BLUR_F;this._ssaoFBO.resize(h,q);this._blur0FBO.resize(r,g);this._blur1FBO.resize(r,g);r=1*h;g=1*q;k.bindFramebuffer(this._ssaoFBO);D.set(a.fullViewport,this._viewportToRestore);k.setViewport(0,0,h,q);var e=this._programRep.get(8>=this._samples?"ssao8":16>=this._samples?"ssao16":
32>=this._samples?"ssao32":"ssao64"),f=this._programRep.get("blur"),n=a.projectionMatrix;m[0]=-2/(r*n[0]);m[1]=-2/(g*n[5]);m[2]=(1-n[2])/n[0];m[3]=(1+n[6])/n[5];n=0===n[11];e.setUniform2f("rnmScale",h/M,q/M);e.setUniform3fv("pSphere",8>=this._samples?E:16>=this._samples?J:32>=this._samples?G:K);k.bindProgram(e);e.setUniform1f("numSpiralTurns",this._samples<U.length?U[this._samples]:5779);e.setUniform4fv("projInfo",new Float32Array(m));h=1/a.computePixelSizeAtDist(1);e.setUniform1f("projScale",1*h);
e.setUniform2f("screenDimensions",r,g);n?(e.setUniform2f("nearFar",a.near,a.far),e.setUniform2f("zScale",0,-1)):(e.setUniform2f("nearFar",a.near,a.far),e.setUniform2f("zScale",1,0));var v=2*this._radius,q=B.dist(a.eye,a.center),v=20*a.computePixelSizeAtDist(q),v=Math.max(.1,v);e.setUniform1f("radius",v);e.setUniform1f("intensity",4*this._attenuation/Math.pow(v,6));e.setUniform1i("rnm",0);e.setUniform1i("normalMap",1);e.setUniform1i("depthMap",2);k.bindTexture(this._noiseTexture,0);k.bindTexture(d.colorTexture,
1);k.bindTexture(c.colorTexture,2);c=this.getQuadVAO();k.bindVAO(c);k.drawArrays(5,0,t.vertexCount(c,"geometry"));k.bindTexture(this._ssaoFBO.colorTexture,0);k.setViewport(0,0,r/this._BLUR_F,g/this._BLUR_F);k.bindFramebuffer(this._blur0FBO);f.setUniform2f("screenDimensions",r,g);f.setUniform1i("tex",0);f.setUniform1i("normalMap",1);f.setUniform1i("depthMap",2);f.setUniform2f("blurSize",0,1*this._BLUR_F/g);f.setUniform1i("radius",4);f.setUniform1f("g_BlurFalloff",.08);f.setUniform2f("nearFar",a.near,
a.far);5E4<q&&(h=Math.max(0,h-(q-5E4)));f.setUniform1f("projScale",h);n?f.setUniform2f("zScale",0,-1):f.setUniform2f("zScale",1,0);k.drawArrays(5,0,t.vertexCount(c,"geometry"));f.setUniform2f("blurSize",1*this._BLUR_F/r,0);k.bindFramebuffer(this._blur1FBO);k.bindTexture(this._blur0FBO.colorTexture,0);k.drawArrays(5,0,t.vertexCount(c,"geometry"));k.bindFramebuffer(b);k.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}},h.prototype.setUniforms=
function(a){var b=this.getEnableState()&&this._noiseTexture,c=this._rctx;c.bindTexture(b?this._blur1FBO.colorTexture:this._emptyTexture,6);c.setActiveTexture(0);a.setUniform1i("ssaoTex",6);b?a.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):a.setUniform4f("viewportPixelSz",-1,-1,-1,-1)},h.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("viewportPixelSz");for(var b=0;b<a.length;b++)this.setUniforms(a[b])},
h.prototype.drawQuad=function(a){l.assert(this.getEnableState());var b=this._programRep.get("showDepth");this._debugQuadVAO||(this._debugQuadVAO=new k(this._rctx,y.Default3D,{geometry:v.Pos2Tex},{geometry:c.createVertex(this._rctx,35044,N)}));var d=this._rctx;d.setDepthTestEnabled(!1);b.setUniformMatrix4fv("proj",new Float32Array(a));b.setUniform1i("depthTex",0);d.bindTexture(this._ssaoFBO.colorTexture,0);d.bindVAO(this._debugQuadVAO);d.drawArrays(5,0,t.vertexCount(this._debugQuadVAO,"geometry"));
d.setDepthTestEnabled(!0)},h.loadShaders=function(a,b,c,k){l.assert(null==a.samples);a._parse(d);b=new u(k,a.vertexShaderShowDepth,a.fragmentShaderShowDepth,y.Default3D);var h=a.createFsSSAOSrcObscurance,m=new u(k,a.vsUVQuad,h,y.Default3D,{NUM_TAP_SAMPLES:"8"}),q=new u(k,a.vsUVQuad,h,y.Default3D,{NUM_TAP_SAMPLES:"16"}),t=new u(k,a.vsUVQuad,h,y.Default3D,{NUM_TAP_SAMPLES:"32"}),h=new u(k,a.vsUVQuad,h,y.Default3D,{NUM_TAP_SAMPLES:"64"});a=new u(k,a.vsUVQuad,a.fsBlurEdgeAware,y.Default3D,{RADIUS:(4).toString()});
c.add("showDepth",b);c.add("ssao8",m);c.add("ssao16",q);c.add("ssao32",t);c.add("ssao64",h);c.add("blur",a)},h}();var m=D.create(),E=new Float32Array([.186937,0,0,.677503,0,0,-.782832,.128424,.557187,.248064,.460317,-.659755,.062892,.918659,.312829,-.241031,-.814826,.224206,-.642866,.132138,-.45016,.145727,-.590568,-.626141,.005017,-.002234,.012668]),J=new Float32Array([.186937,0,0,.700542,0,0,-.864858,-.481795,-.111713,-.624773,.102853,-.730153,-.387172,.260319,.007229,-.222367,-.642631,-.707697,
-.01336,-.014956,.169662,.122575,.1544,-.456944,-.177141,.85997,-.42346,-.131631,.814545,.524355,-.779469,.007991,.624833,.308092,.209288,.35969,.359331,-.184533,-.377458,.192633,-.482999,-.065284,.233538,.293706,-.055139,.417709,-.386701,.442449,-.301656,-.836426,.408344]),G=new Float32Array([.837372,0,0,.723531,-.467287,.034157,.169582,-.31169,-.881801,.696236,.455215,-.204568,-.304514,.528086,.626381,-.053116,.222507,.037523,.199755,.311291,.916799,-.681552,-.516264,.501792,-.37127,.021088,.737477,
-.029503,.209188,-.95298,-.573731,.009962,-.154202,-.257345,-.905958,.282747,.370779,.527867,-.669424,-.601758,-.191278,-.708243,.271796,.782684,.535565,-.006867,-.015312,-.017276,.419958,.265628,.233036,-.543898,.554747,-.174055,-.079242,.053475,-.099539,.372042,-.339267,-.357362,.015781,-.011352,.042707,-.340564,-.272507,-.067725,.799249,-.127948,.586808,.450015,.01965,-.416454,-.506524,.323229,.206546,-.087316,-.311097,.466049,.146374,-.34528,-.045904,-.152614,-.926686,-.287529,-.665726,-.032904,
.246643,.248703,.637193,-.062541,-.073706,.495925,-.315143,.05946,-.116042,.075586]),K=new Float32Array([.186937,0,0,.605726,-.313457,-.097616,.003541,.781245,.283011,-.225029,-.373279,.274442,-.047511,.04992,-.226365,.627629,-.623617,-.463628,.133094,-.318299,.528128,.262035,.100234,-.09012,.178335,-.426972,-.666048,-.27306,-.207352,.05514,-.613649,-.063395,.060608,-.283391,-.41382,-.087565,.136768,.506126,.484137,-.593808,-.344603,.453164,.675326,.124799,-.697865,-.33502,.411337,-.09337,-.15271,
.002908,-.063582,.366733,-.699739,.401148,-.519536,-.585625,-.508413,.106482,-.428709,-.260221,.012847,-.118806,.016962,-.188182,.49945,.452364,.586617,.722539,-.23302,.111295,.202827,.066695,-.036503,.315842,.896467,-.039109,-.270116,-.080062,.613435,.508787,.538656,-.352275,.566869,-.666275,.887876,-.138341,-.434135,-.444711,.269156,.119506,-.029457,-.077316,.754474,.274125,-.13876,-.37082,-.73268,.332723,.568545,-.203992,.878922,-.430778,.541154,-.546752,.11786,-3.93E-4,-.083318,.059333,-.341406,
-.117017,-.318568,-.262425,-.457913,.848753,.89229,-.30157,.322416,.742328,.032262,.643827,.048091,-.078044,-.49908,.064858,.549944,-.796252,-.230688,.88978,-.010153,.397241,-.27645,.405666,-.46593,.131187,-.600166,.333834,-.078219,.73837,-.870169,-.411658,-.222175,-.492421,.741454,.293757,-.591244,.389112,-.388324,.792346,.578552,.088459,-.121858,-.437241,-.472535,-.374835,.302427,.721264,.057485,.204085,-.126575,.510325,.481492,-.579888,-.29411,-.82136,.156404,-.819717,-.042466,.456573,.079884,
.07019,.179002,.220279,.970222,-.088025,-.299911,-.234627,-.820794,.912112,.243306,.317869,.241336,.161841,-.721568,.301135,-.635993,-.0939,-.514731,-.089673,.850964,-.905087,.314604,-.098397]),M=64,U=[1,1,1,2,3,2,5,2,3,2,3,3,5,5,3,4,7,5,5,7,9,8,5,5,7,7,7,8,5,8,11,12,7,10,13,8,11,8,7,14,11,11,13,12,13,19,17,13,11,18,19,11,11,14,17,21,15,16,17,18,13,17,11,17,19,18,25,18,19,19,29,21,19,27,31,29,21,18,17,29,31,31,23,18,25,26,25,23,19,34,19,27,21,25,39,29,17,21,27,29],N=new Float32Array([0,0,0,0,512,
0,1,0,0,512,0,1,512,512,1,1]);return A})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("./Camera ./Util ./gl-matrix ../../../../core/Logger ../../../webgl/Texture ../../../webgl/FramebufferObject ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/Util".split(" "),function(A,p,w,l,h,d,u,r,a,k,c){var t=w.vec2d,C=w.vec3d,q=w.vec4d,v=w.mat3d,y=w.mat4d,B=w.mat4,D=l.getLogger("esri.views.3d.webgl-engine.lib.ShadowMap");
return function(b,m){function l(a,e){return C.set3(a[e],a[e+3],a[e+6],Pa),Pa}var w,G,K=m.gl,M=4096,U=new h(m,{target:K.TEXTURE_2D,pixelFormat:K.RGBA,dataType:K.UNSIGNED_BYTE,samplingMode:K.NEAREST,width:4,height:4}),N=1,W=2,R=[0,0,0,0,0];this.dispose=function(){U.dispose();U=null};var V,Q,S,X=function(){this.camera=new A;this.lightMat=y.create()},z=[];for(V=0;4>V;++V)z[V]=new X;this.getIsSupported=function(){return m.extensions.standardDerivatives};this.setTextureResolution=function(a){M=a};this.getTextureResolution=
function(){return M};this.setMaxNumCascades=function(a){W=p.clamp(Math.floor(a),1,4)};this.getMaxNumCascades=function(){return W};this.setEnableState=function(a){a?this.enable():this.disable()};this.getEnableState=function(){return void 0!==w};this.getDepthTexture=function(){return w};this.enable=function(){if(!this.getEnableState()){if(!this.getIsSupported())return void D.warn("Shadow maps are not supported for this browser or hardware");w=new h(m,{target:K.TEXTURE_2D,pixelFormat:K.RGBA,dataType:K.UNSIGNED_BYTE,
wrapMode:K.CLAMP_TO_EDGE,samplingMode:K.NEAREST,flipped:!0,width:M,height:M});G=d.createWithAttachments(m,w,{colorTarget:0,depthStencilTarget:1,width:M,height:M})}};this.disable=function(){this.getEnableState()&&G&&(G.dispose(),G=void 0,w=void 0)};var Z=y.create(),O=y.create(),g=q.create(),e=Array(8);for(V=0;8>V;++V)e[V]=q.create();var f=C.create(),n=C.create(),x=t.create(),I=t.create(),L=t.create(),P=t.create(),Y=t.create(),fa=y.create(),ga=C.create();this.prepare=function(a,b,c,d){p.assert(this.getEnableState());
y.multiply(a.projectionMatrix,a.viewMatrix,Z);var k=d[0],h=d[1];2>k&&(k=2);2>h&&(h=2);k>=h&&(k=2,h=4);N=Math.min(1+Math.floor(p.logWithBase(h/k,4)),W);c=Math.pow(h/k,1/N);for(d=0;N+1>d;++d)R[d]=k*Math.pow(c,d);y.inverse(Z,O);y.lookAt([0,0,0],[-b[0],-b[1],-b[2]],[0,1,0],fa);c=a.viewMatrix;a=a.projectionMatrix;for(d=0;N>d;++d){var r=z[d],k=-R[d],h=-R[d+1],k=(a[10]*k+a[14])/Math.abs(a[11]*k+a[15]),h=(a[10]*h+a[14])/Math.abs(a[11]*h+a[15]);p.assert(h>k);for(Q=0;8>Q;++Q)for(q.set4(0===Q%4||3==Q%4?-1:1,
0===Q%4||1==Q%4?-1:1,4>Q?k:h,1,g),y.multiplyVec4(O,g,e[Q]),S=0;3>S;++S)e[Q][S]/=e[Q][3];C.negate(e[0],ga);y.translate(fa,ga,r.camera.viewMatrix);for(Q=0;8>Q;++Q)y.multiplyVec3(r.camera.viewMatrix,e[Q]);C.set(e[0],f);C.set(e[0],n);for(Q=1;8>Q;++Q)for(S=0;3>S;++S)f[S]=Math.min(f[S],e[Q][S]),n[S]=Math.max(n[S],e[Q][S]);f[2]-=200;n[2]+=200;r.camera.near=-n[2];r.camera.far=-f[2];k=1/e[0][3];h=1/e[4][3];p.assert(h>k);var v=k+Math.sqrt(k*h),u=Math.sin(Math.acos(c[2]*b[0]+c[6]*b[1]+c[10]*b[2])),v=v/u,k=e,
B=v,w=u,u=x,E=I,D=L,J=P,v=Y;t.set2(0,0,sa);for(var A=void 0,A=0;4>A;++A)t.add(sa,k[A],sa);t.scale(sa,.25);t.set2(0,0,aa);for(A=4;8>A;++A)t.add(aa,k[A],aa);t.scale(aa,.25);t.lerp(k[4],k[5],.5,ya[0]);t.lerp(k[5],k[6],.5,ya[1]);t.lerp(k[6],k[7],.5,ya[2]);t.lerp(k[7],k[4],.5,ya[3]);for(var U=0,V=t.dist2(ya[0],sa),A=1;4>A;++A){var X=t.dist2(ya[A],sa);V>X&&(V=X,U=A)}t.subtract(ya[U],k[U+4],la);A=la[0];la[0]=-la[1];la[1]=A;t.subtract(aa,sa,za);t.lerp(la,za,w);t.normalize(la);U=w=void 0;w=U=t.dot(t.subtract(k[0],
sa,oa),la);for(A=1;8>A;++A)V=t.dot(t.subtract(k[A],sa,oa),la),w>V?w=V:V>U&&(U=V);t.set(sa,u);t.scale(la,w-B,oa);t.add(u,oa,u);for(var X=-1,ia=1,A=B=V=0;8>A;++A){t.subtract(k[A],u,F);t.normalize(F);var Pa=la[0]*F[1]-la[1]*F[0];0<Pa?Pa>X&&(X=Pa,V=A):ia>Pa&&(ia=Pa,B=A)}p.verify(0<X,"leftArea");p.verify(0>ia,"rightArea");t.scale(la,w,Ia);t.add(Ia,sa,Ia);t.scale(la,U,Ea);t.add(Ea,sa,Ea);Qa[0]=-la[1];Qa[1]=la[0];E=p.rayRay2D(u,k[B],Ea,t.add(Ea,Qa,oa),1,E);D=p.rayRay2D(u,k[V],Ea,oa,1,D);J=p.rayRay2D(u,k[V],
Ia,t.add(Ia,Qa,oa),1,J);k=p.rayRay2D(u,k[B],Ia,oa,1,v);p.verify(E,"rayRay");p.verify(D,"rayRay");p.verify(J,"rayRay");p.verify(k,"rayRay");D=x;k=I;u=P;J=Y;v=r.camera.projectionMatrix;t.scale(t.subtract(u,J,Fa),.5);ea[0]=Fa[0];ea[1]=Fa[1];ea[2]=0;ea[3]=Fa[1];ea[4]=-Fa[0];ea[5]=0;ea[6]=Fa[0]*Fa[0]+Fa[1]*Fa[1];ea[7]=Fa[0]*Fa[1]-Fa[1]*Fa[0];ea[8]=1;ea[6]=-t.dot(l(ea,0),D);ea[7]=-t.dot(l(ea,1),D);D=t.dot(l(ea,0),u)+ea[6];E=t.dot(l(ea,1),u)+ea[7];A=t.dot(l(ea,0),J)+ea[6];J=t.dot(l(ea,1),J)+ea[7];D=-(D+
A)/(E+J);ea[0]+=ea[1]*D;ea[3]+=ea[4]*D;ea[6]+=ea[7]*D;D=1/(t.dot(l(ea,0),u)+ea[6]);E=1/(t.dot(l(ea,1),u)+ea[7]);ea[0]*=D;ea[3]*=D;ea[6]*=D;ea[1]*=E;ea[4]*=E;ea[7]*=E;ea[2]=ea[1];ea[5]=ea[4];ea[8]=ea[7];ea[7]+=1;D=t.dot(l(ea,1),k)+ea[7];E=t.dot(l(ea,2),k)+ea[8];A=t.dot(l(ea,1),u)+ea[7];J=t.dot(l(ea,2),u)+ea[8];D=-.5*(D/E+A/J);ea[1]+=ea[2]*D;ea[4]+=ea[5]*D;ea[7]+=ea[8]*D;D=t.dot(l(ea,1),k)+ea[7];E=t.dot(l(ea,2),k)+ea[8];A=-E/D;ea[1]*=A;ea[4]*=A;ea[7]*=A;v[0]=ea[0];v[1]=ea[1];v[2]=0;v[3]=ea[2];v[4]=
ea[3];v[5]=ea[4];v[6]=0;v[7]=ea[5];v[8]=0;v[9]=0;v[10]=1;v[11]=0;v[12]=ea[6];v[13]=ea[7];v[14]=0;v[15]=ea[8];r.camera.projectionMatrix[10]=2/(f[2]-n[2]);r.camera.projectionMatrix[14]=-(f[2]+n[2])/(f[2]-n[2]);y.multiply(r.camera.projectionMatrix,r.camera.viewMatrix,r.lightMat);k=M/2;r.camera.viewport[0]=0===d%2?0:k;r.camera.viewport[1]=0===Math.floor(d/2)?0:k;r.camera.viewport[2]=k;r.camera.viewport[3]=k}na=void 0;R[N]=100*h;m.bindFramebuffer(G);m.bindTexture(null,7);m.setClearColor(1,1,1,1);m.clear(K.COLOR_BUFFER_BIT|
K.DEPTH_BUFFER_BIT);m.setBlendingEnabled(!1)};var ia=[];this.getCascades=function(){for(var a=0;N>a;++a)ia[a]=z[a];return ia.length=N,ia};this.finish=function(a){p.assert(this.getEnableState());m.bindFramebuffer(a)};this.bind=function(a){var e=this.getEnableState();m.bindTexture(e?w:U,7);m.bindProgram(a);a.setUniform1i("depthTex",7);a.setUniform1f("depthHalfPixelSz",e?.5/M:-1);a.setUniform1i("shadowMapNum",N);a.setUniform4f("shadowMapDistance",R[0],R[1],R[2],R[3])};this.bindAll=function(a){a=a.getProgramsUsingUniform("shadowMapDistance");
for(var e=0;e<a.length;e++)this.bind(a[e])};var na,ka=B.create(),wa=new Float32Array(64);this.bindView=function(a,e){if(this.getEnableState()){if(!na||na[0]!==e[0]||na[1]!==e[1]||na[2]!==e[2]){var b;na=na||C.create();C.set(e,na);for(Q=0;N>Q;++Q)for(B.translate(z[Q].lightMat,e,ka),b=0;16>b;++b)wa[16*Q+b]=ka[b]}a.setUniformMatrix4fv("shadowMapMatrix",wa)}};V=new Float32Array(16);V[0]=0;V[1]=0;V[2]=0;V[3]=0;V[4]=256;V[5]=0;V[6]=1;V[7]=0;V[8]=0;V[9]=256;V[10]=0;V[11]=1;V[12]=256;V[13]=256;V[14]=1;V[15]=
1;var ta=new u(m,a.Default3D,{geometry:k.Pos2Tex},{geometry:r.createVertex(m,K.STATIC_DRAW,V)});this.drawDebugQuad=function(a){p.assert(this.getEnableState());var e=b.get("showDepth");m.setDepthTestEnabled(!1);m.bindProgram(e);e.setUniformMatrix4fv("proj",a);e.setUniform1i("depthTex",0);m.bindTexture(w,0);m.bindVAO(ta);c.assertCompatibleVertexAttributeLocations(ta,e);m.drawArrays(K.TRIANGLE_STRIP,0,c.vertexCount(ta,"geometry"));m.setDepthTestEnabled(!0)};var sa=t.create(),aa=t.create(),ya=[t.create(),
t.create(),t.create(),t.create()],la=t.create(),za=t.create(),oa=t.create(),F=t.create(),Ia=t.create(),Ea=t.create(),Qa=t.create(),Pa=C.create(),Fa=t.create(),ea=v.create()}})},"esri/views/3d/webgl-engine/lib/NearFarCalc":function(){define(["require","exports","./Util","./gl-matrix","./ComponentUtils"],function(A,p,w,l,h){A=l.vec3d;var d=l.vec4d,u=l.mat4d;l=function(){function a(){this._context={content:[],near:[],far:[],nearSpecial:[],farSpecial:[],bestNear:0,bestFar:0,bestNear2:0,bestFar2:0};this._boundingInfoHelper=
new r}return a.prototype._resetContext=function(){var a=this._context;return a.content.length=0,a.near.length=0,a.far.length=0,a.nearSpecial.length=0,a.farSpecial.length=0,a.bestNear=Number.MAX_VALUE,a.bestFar=-Number.MAX_VALUE,this._context},a.prototype.calculateSceneNearFar=function(a,d){var k=this._resetContext(),l=a.viewMatrix,q=l[2],b=l[6],m=l[10],t=l[14],r=0,v;for(v in d)if(l=d[v],!h.isAllHidden(l.instanceParameters.componentVisibilities,l.componentOffsets)&&l.castShadow){var u=void 0,p=void 0;
l.hasShaderTransformation?(u=l.getBoundingSphere(l.getShaderTransformation(),null,c),p=c):(u=l.bsRadius,p=l.center);var C=q*p[0]+b*p[1]+m*p[2]+t,p=C-u,u=C+u;k.content[r]=l;k.near[r]=-u;k.far[r]=-p;++r}if(0===r)return[k.bestNear,k.bestFar];for(d=0;r>d;++d)k.near[d]>k.bestFar&&(k.bestFar=k.near[d]),2<k.near[d]&&k.far[d]<k.bestNear&&(k.bestNear=k.far[d]);k.bestNear2=Math.max(.5*k.bestNear,2);k.bestFar2=2*k.bestFar;for(d=b=q=0;r>d;++d)k.near[d]<k.bestNear&&(k.near[d]>=k.bestNear2?k.bestNear=k.near[d]:
k.nearSpecial[q++]=d),k.far[d]>k.bestFar&&(k.far[d]<=k.bestFar2?k.bestFar=k.far[d]:k.farSpecial[b++]=d);if(0===q&&0===b)return[k.bestNear,k.bestFar];k.nearSpecial.length=q;k.farSpecial.length=b;k.nearSpecial.sort(function(a,b){return k.near[a]<k.near[b]?-1:k.near[a]>k.near[b]?1:0});k.farSpecial.sort(function(a,b){return k.far[a]<k.far[b]?1:k.far[a]>k.far[b]?-1:0});this._boundingInfoHelper.init(a,k);for(d=0;q>d;++d)k.near[k.nearSpecial[d]]<k.bestNear&&(l=k.content[k.nearSpecial[d]],a=l.boundingInfo,
this._boundingInfoHelper.includeNearBoundingInfoRec(a,l.getShaderTransformation()));for(d=0;b>d;++d)k.far[k.farSpecial[d]]>k.bestFar&&(l=k.content[k.farSpecial[d]],a=l.boundingInfo,this._boundingInfoHelper.includeFarBoundingInfoRec(a,l.getShaderTransformation()));return[k.bestNear,k.bestFar]},a}();var r=function(){function k(){this._clippingHelper=new a;this._planes=[d.create(),d.create(),d.create(),d.create(),d.create(),d.create()];this._viewProj=u.create();this._view=u.create()}return k.prototype.init=
function(a,c){this._context=c;u.set(a.viewMatrix,this._view);u.multiply(a.projectionMatrix,this._view,this._viewProj);a.copyFrustumPlanes(this._planes);this._clippingHelper.init(c)},k.prototype.includeNearBoundingInfoRec=function(a,d){var k=a.getBSRadius(),h=a.getCenter();u.multiplyVec3(d,h,c);var h=c[0],l=c[1],b=c[2];if(k*=Math.sqrt(Math.max(Math.max(d[0]*d[0]+d[4]*d[4]+d[8]*d[8],d[1]*d[1]+d[5]*d[5]+d[9]*d[9]),d[2]*d[2]+d[6]*d[6]+d[10]*d[10])),!(this._planes[0][0]*h+this._planes[0][1]*l+this._planes[0][2]*
b+this._planes[0][3]>k||this._planes[1][0]*h+this._planes[1][1]*l+this._planes[1][2]*b+this._planes[1][3]>k||this._planes[2][0]*h+this._planes[2][1]*l+this._planes[2][2]*b+this._planes[2][3]>k||this._planes[3][0]*h+this._planes[3][1]*l+this._planes[3][2]*b+this._planes[3][3]>k))if(h=this._view[2]*h+this._view[6]*l+this._view[10]*b+this._view[14],l=h+k,!(2>-(h-k)||-l>=this._context.bestNear)){if(-l>this._context.bestNear2)return void(this._context.bestNear=-l);if(100<k&&(k=a.getChildren(),void 0!==
k)){for(a=0;8>a;++a)void 0!==k[a]&&this.includeNearBoundingInfoRec(k[a],d);return}this._clippingHelper.intersectFrustumAABB(this._viewProj,d,a.getBBMin(),a.getBBMax())}},k.prototype.includeFarBoundingInfoRec=function(a,d){var k=a.getBSRadius(),h=a.getCenter();u.multiplyVec3(d,h,c);var h=c[0],l=c[1],b=c[2];if(k*=Math.sqrt(Math.max(Math.max(d[0]*d[0]+d[4]*d[4]+d[8]*d[8],d[1]*d[1]+d[5]*d[5]+d[9]*d[9]),d[2]*d[2]+d[6]*d[6]+d[10]*d[10])),!(this._planes[0][0]*h+this._planes[0][1]*l+this._planes[0][2]*b+
this._planes[0][3]>k||this._planes[1][0]*h+this._planes[1][1]*l+this._planes[1][2]*b+this._planes[1][3]>k||this._planes[2][0]*h+this._planes[2][1]*l+this._planes[2][2]*b+this._planes[2][3]>k||this._planes[3][0]*h+this._planes[3][1]*l+this._planes[3][2]*b+this._planes[3][3]>k))if(h=this._view[2]*h+this._view[6]*l+this._view[10]*b+this._view[14]-k,!(-h<=this._context.bestFar)){if(-h<this._context.bestFar2)return void(this._context.bestFar=-h);if(100<k&&(k=a.getChildren(),void 0!==k)){for(a=0;8>a;++a)void 0!==
k[a]&&this.includeFarBoundingInfoRec(k[a],d);return}this._clippingHelper.intersectFrustumAABB(this._viewProj,d,a.getBBMin(),a.getBBMax())}},k}(),a=function(){function a(){this._clipP=Array(8);for(var a=0;8>a;++a)this._clipP[a]=d.create()}return a.prototype.init=function(a){this._context=a},a.prototype.intersectFrustumAABB=function(a,c,d,h){u.multiply(a,c,t);for(a=0;8>a;++a){c=this._clipP[a];var l=0===a||3===a||4===a||7===a?d[0]:h[0],b=0===a||1===a||4===a||5===a?d[1]:h[1],m=4>a?d[2]:h[2];c[0]=t[0]*
l+t[4]*b+t[8]*m+t[12];c[1]=t[1]*l+t[5]*b+t[9]*m+t[13];c[2]=t[2]*l+t[6]*b+t[10]*m+t[14];c[3]=t[3]*l+t[7]*b+t[11]*m+t[15]}for(a=0;12>a;++a){d=this._clipTriangle(this._clipP[k[a][0]],this._clipP[k[a][1]],this._clipP[k[a][2]]);h=!0;for(c=0;c<d.length;++c)if(l=d[c][3],2<=l){h=!1;break}if(!h)for(c=0;c<d.length;++c)l=d[c][3],l<this._context.bestNear&&(this._context.bestNear=l),l>this._context.bestFar&&(this._context.bestFar=l)}},a.prototype._inside=function(a,c){return 0===c?a[0]>=-a[3]:1===c?a[1]>=-a[3]:
2===c?a[0]<=a[3]:3===c?a[1]<=a[3]:void w.assert(!1)},a.prototype._intersect=function(a,c,k){var h=0;return 0===k?h=(-a[3]-a[0])/(c[0]-a[0]+c[3]-a[3]):1===k?h=(-a[3]-a[1])/(c[1]-a[1]+c[3]-a[3]):2===k?h=(a[3]-a[0])/(c[0]-a[0]-c[3]+a[3]):3===k&&(h=(a[3]-a[1])/(c[1]-a[1]-c[3]+a[3])),d.lerp(a,c,h,d.create())},a.prototype._clipTriangle=function(a,c,d){a=[a,c,d];for(c=0;4>c;++c){d=a;a=[];for(var k=0;k<d.length;++k){var h=d[k],b=d[(k+1)%d.length];this._inside(b,c)?(this._inside(h,c)||a.push(this._intersect(h,
b,c)),a.push(b)):this._inside(h,c)&&a.push(this._intersect(h,b,c))}}return a},a}(),k=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],c=A.create(),t=u.create();return l})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("require exports ./Util ./gl-matrix dojo/text!../materials/internal/highlight.xml ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Util ../../../webgl/enums ./DefaultVertexBufferLayouts ./DefaultVertexAttributeLocations ../../support/debugFlags".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q){var v=l.vec4d;return function(){function c(a,c,b){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0};this.blur1Fbo=this.blur0Fbo=this.quadVAO=null;this._rctx=b;this.viewportToRestore=v.create();this.programRep=a;this.defaultOptions={color:new Float32Array([1,0,1,1]),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05}}return c.prototype._gridUpdateResources=
function(c,k){var b=this._rctx,h=this._grid,l=!1;if(null===h.coverageMipmap&&(h.coverageMipmap=[c],l=!0),(h.viewportWidth!==c.width||h.viewportHeight!==c.height)&&(l=!0,h.viewportWidth=c.width,h.viewportHeight=c.height),h.coverageMipmap[0]=c,h.cellPixelSize!==k&&(h.cellPixelSize=k,l=!0),l){for(k=1;k<h.coverageMipmap.length;k++)h.coverageMipmap[k].dispose();h.mipmapLevels=Math.ceil(Math.log(h.cellPixelSize)*Math.LOG2E);h.coverageMipmap.length=h.mipmapLevels+1;for(k=0;k<h.mipmapLevels;k++)l=h.coverageMipmap[k],
l=d.createWithAttachments(b,{target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(l.width/2),height:Math.ceil(l.height/2)},{colorTarget:0,depthStencilTarget:0,width:Math.ceil(l.width/2),height:Math.ceil(l.height/2)}),h.coverageMipmap[k+1]=l}var l=Math.ceil(c.height/h.cellPixelSize),q=Math.ceil(c.width/h.cellPixelSize);if(!h.vao||h.verticalCellCount!==l||h.horizontalCellCount!==q){h.verticalCellCount=l;h.horizontalCellCount=q;c=l+1;k=q+1;for(var l=1/l,q=1/q,
v=new Float32Array(24*c*k),u=0,p=0;c>p;p++)for(var y=0;k>y;y++)v[u+0]=(y-.5)*q*2-1,v[u+1]=(p-.5)*l*2-1,v[u+2]=y*q,v[u+3]=p*l,v[u+4]=(y+.5)*q*2-1,v[u+5]=(p-.5)*l*2-1,v[u+6]=y*q,v[u+7]=p*l,v[u+8]=(y-.5)*q*2-1,v[u+9]=(p+.5)*l*2-1,v[u+10]=y*q,v[u+11]=p*l,v[u+12]=(y-.5)*q*2-1,v[u+13]=(p+.5)*l*2-1,v[u+14]=y*q,v[u+15]=p*l,v[u+16]=(y+.5)*q*2-1,v[u+17]=(p-.5)*l*2-1,v[u+18]=y*q,v[u+19]=p*l,v[u+20]=(y+.5)*q*2-1,v[u+21]=(p+.5)*l*2-1,v[u+22]=y*q,v[u+23]=p*l,u+=24;h.vao&&h.vao.dispose(!0);h.vao=new r(b,C.Default3D,
{geometry:t.Pos2Tex},{geometry:a.createVertex(b,35044,v)})}},c.prototype._gridComputeMipmap=function(){var a=this._rctx,c=this._grid,b=this.programRep.get("conservative-downsample");a.bindVAO(this.quadVAO);for(var d=0;d<c.mipmapLevels;d++){a.bindFramebuffer(c.coverageMipmap[d+1]);a.bindTexture(c.coverageMipmap[d].colorTexture,0);var h=c.coverageMipmap[d+1].width,l=c.coverageMipmap[d+1].height;a.bindProgram(b);b.setUniform1i("tex",0);b.setUniform2f("invFramebufferDim",1/h,1/l);a.setViewport(0,0,h,
l);a.drawArrays(5,0,k.vertexCount(this.quadVAO,"geometry"))}},c.prototype.createQuadVAO=function(){var c=this._rctx,d=new Float32Array([-1,-1,1,-1,-1,1,1,1]);return new r(c,C.Default3D,{geometry:t.Pos2},{geometry:a.createVertex(c,35044,d)})},Object.defineProperty(c.prototype,"profilingCallback",{get:function(){return q.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(a){return console.log(a)}:null},enumerable:!0,configurable:!0}),c.prototype.getIsSupported=function(){return!0},c.prototype.setEnableState=function(a){a?
this.enable():this.disable()},c.prototype.getEnableState=function(){return null!==this.blur0Fbo},c.prototype.enable=function(){this.quadVAO=this.createQuadVAO();var a={colorTarget:0,depthStencilTarget:0,width:0,height:0},c={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=d.createWithAttachments(this._rctx,c,a);this.blur1Fbo=d.createWithAttachments(this._rctx,c,a)},c.prototype.disable=function(){this.getEnableState()&&(this.quadVAO.dispose(!0),
this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.quadVAO=null,this.blur0Fbo=null,this.blur1Fbo=null)},c.prototype.getHighlightFBO=function(){return this.blur0Fbo},c.prototype.render=function(a,c,b){var d=!q.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,h=q.HIGHLIGHTS_VISUALIZE_BLOCKS,l=this._rctx;w.assert(this.getEnableState());v.set(a.fullViewport,this.viewportToRestore);a=Math.ceil(b.width/1);var t=Math.ceil(b.height/1);this.blur0Fbo.resize(a,t);this.blur1Fbo.resize(a,t);l.bindVAO(this.quadVAO);l.setDepthWriteEnabled(!1);
l.setDepthTestEnabled(!1);l.setBlendingEnabled(!1);var r=null,u=r=null,p=null;if(d){var y=this._grid;this._gridUpdateResources(b,32);this._gridComputeMipmap();u=y.vao;p=4;r=this.programRep.get("highlight-blur-grid-5");l.bindProgram(r);l.bindTexture(y.coverageMipmap[y.mipmapLevels].colorTexture,1);r.setUniform1i("coverageTex",1)}else u=this.quadVAO,p=5,r=this.programRep.get("highlight-blur-5"),l.bindProgram(r);(l.bindVAO(u),l.bindFramebuffer(this.blur0Fbo),l.setViewport(0,0,a,t),l.setClearColor(0,
0,0,0),l.clear(l.gl.COLOR_BUFFER_BIT),r.setUniform1i("tex",0),l.bindTexture(b.colorTexture,0),r.setUniform2f("blurSize",1/a,0),l.drawArrays(p,0,k.vertexCount(u,"geometry")),l.bindFramebuffer(this.blur1Fbo),l.clear(l.gl.COLOR_BUFFER_BIT),l.bindTexture(this.blur0Fbo.colorTexture,0),r.setUniform2f("blurSize",0,1/t),l.drawArrays(p,0,k.vertexCount(u,"geometry")),l.bindFramebuffer(c),l.setBlendingEnabled(!0),l.setBlendFunctionSeparate(770,771,1,771),l.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],
this.viewportToRestore[2],this.viewportToRestore[3]),d)?(r=this.programRep.get(h?"highlight-apply-grid-debug":"highlight-apply-grid"),l.bindProgram(r),r.setUniform1i("coverageTex",2),l.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,2)):(r=this.programRep.get("highlight-apply"),l.bindProgram(r));r.setUniform1i("tex",0);l.bindTexture(this.blur1Fbo.colorTexture,0);r.setUniform1i("origin",1);l.bindTexture(b.colorTexture,1);r.setUniform4fv("color",this.defaultOptions.color);
r.setUniform1f("outlineSize",8.6);r.setUniform1f("blurSize",.4);r.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded);l.drawArrays(p,0,k.vertexCount(u,"geometry"));l.bindVAO(null);l.setDepthWriteEnabled(!0);l.setDepthTestEnabled(!0);l.setBlendingEnabled(!1)},c.prototype.setDefaultOptions=function(a){this.defaultOptions=a},c.loadShaders=function(a,c,b,d){a._parse(h);c=0;for(var k=["3",
"5","7","9"];c<k.length;c++){var m=k[c];b.add("highlight-blur-"+m,new u(d,a.vsHighlightBlurFastGaussian,a.fsHighlightBlurFastGaussian,C.Default3D,{GAUSSIAN_SAMPLES:m}));b.add("highlight-blur-grid-"+m,new u(d,a.vsHighlightBlurFastGaussian,a.fsHighlightBlurFastGaussian,C.Default3D,{GAUSSIAN_SAMPLES:m,GRID_OPTIMIZATION:"true"}))}b.add("highlight-apply",new u(d,a.vsHighlightApply,a.fsHighlightApply,C.Default3D));b.add("highlight-apply-grid",new u(d,a.vsHighlightApply,a.fsHighlightApply,C.Default3D,["GRID_OPTIMIZATION"]));
b.add("highlight-apply-grid-debug",new u(d,a.vsHighlightApply,a.fsHighlightApply,C.Default3D,["GRID_OPTIMIZATION","GRID_DEBUG"]));b.add("conservative-downsample",new u(d,a.vsConservativeDownsample,a.fsConservativeDownsample,C.Default3D))},c}()})},"esri/views/3d/webgl-engine/lib/RenderOccludedHelper":function(){define("require exports ./Util ./gl-matrix dojo/text!../materials/internal/occluded.xml ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Util ../../../webgl/enums ./DefaultVertexBufferLayouts ./DefaultVertexAttributeLocations".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C){var q=l.vec4d;return function(){function c(a,c,d){this._quadVAO=null;this._rctx=d;this._colorFBO=void 0;this._viewportToRestore=q.create();this.programRep=a}return Object.defineProperty(c.prototype,"colorFBO",{get:function(){return this._colorFBO},enumerable:!0,configurable:!0}),c.prototype.createQuadVAO=function(){var c=this._rctx,d=new Float32Array([-1,-1,1,-1,-1,1,1,1]);return new r(c,C.Default3D,{geometry:t.Pos2},{geometry:a.createVertex(c,35044,d)})},c.prototype.setEnableState=
function(a){a?this.enable():this.disable()},c.prototype.getEnableState=function(){return void 0!==this._colorFBO},c.prototype.enable=function(){this._quadVAO=this.createQuadVAO();this._colorFBO=d.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1})},c.prototype.disable=function(){this.getEnableState()&&(this._quadVAO.dispose(!0),this._quadVAO=void 0,this._colorFBO.dispose(),this._colorFBO=
void 0)},c.prototype.setupFBOs=function(a){w.assert(this.getEnableState());this._viewportToRestore=a=a.fullViewport;this._width=a[2];this._height=a[3];this._rctx.setViewport(0,0,this._width,this._height)},c.prototype.prepareColorPass=function(){w.assert(this.getEnableState());var a=this._rctx,c=a.gl;this._colorFBO.resize(this._width,this._height);a.bindFramebuffer(this._colorFBO);a.setClearColor(0,0,0,0);a.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT)},c.prototype.finish=function(a){var c=this._rctx;
c.bindFramebuffer(a);c.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])},c.prototype.apply=function(){var a=this._rctx,c=this.programRep.get("render-occluded-apply");a.bindProgram(c);a.bindVAO(this._quadVAO);a.bindTexture(this._colorFBO.colorTexture,0);c.setUniform1i("occludedColorMap",0);a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);a.setBlendingEnabled(!0);a.setBlendFunction(770,771);a.drawArrays(5,0,k.vertexCount(this._quadVAO,
"geometry"));a.bindVAO(null);a.setDepthWriteEnabled(!0);a.setDepthTestEnabled(!0);a.setBlendingEnabled(!1)},c.loadShaders=function(a,c,d,b){a._parse(h);d.add("render-occluded-apply",new u(b,a.vsRenderOccludedApply,a.fsRenderOccludedApply,C.Default3D))},c}()})},"esri/views/3d/webgl-engine/materials/repository":function(){define("dojo/text!./internal/util.xml dojo/text!./internal/hud.xml ./BillboardMaterial ./ColorMaterial ./HUDMaterial ./LineCalloutMaterial ./LeafCardMaterial ./Material ./RibbonLineMaterial ./WaterMaterial ./MeasurementArrowMaterial ./internal/SimpleGLMaterial ./internal/TexOnlyGLMaterial ./internal/BlendLayers".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q){return{initializeShaders:function(v,y,B,D){v._parse(A);v._parse(p);t.loadShaders(v,y,B,D);C.loadShaders(v,y,B,D);r.loadShaders(v,y,B,D);w.loadShaders(v,y,B,D);h.loadShaders(v,y,B,D);d.loadShaders(v,y,B,D);u.loadShaders(v,y,B,D);a.loadShaders(v,y,B,D);k.loadShaders(v,y,B,D);q.loadShaders(v,y,B,D);l.loadShaders(v,y,B,D);c.loadShaders(v,y,B,D)}}})},"esri/views/3d/webgl-engine/materials/BillboardMaterial":function(){define("dojo/text!./BillboardMaterial.xml ./internal/MaterialUtil ../lib/RenderSlot ../../../webgl/Program ../lib/DefaultVertexAttributeLocations ../lib/DefaultVertexBufferLayouts ../../../webgl/Util".split(" "),
function(A,p,w,l,h,d,u){var r=function(h,l){p.basicMaterialConstructor(this,l);var q=d.Pos3NormTex;this.getSize=function(){return 1.05};this.dispose=function(){};this.getTextureId=function(){return h};this.getOutputAmount=function(a){var c=u.getStride(q)/4;return a*c*6};this.getVertexBufferLayout=function(){return q};this.fillInterleaved=function(a,c,d,k,b,h){k=p.fill;var m=a.indices.va,l=a.vertexAttr.va.data,q=a.vertexAttr.tc4.data,t=a.vertexAttr.n0.data,r=a.vertexAttr.n1.data,v=a.vertexAttr.n2.data;
a=a.vertexAttr.n3.data;for(var u=0;u<m.length;++u){var C=4*m[u],y=3*m[u];h+=k(l,C,b,h,c,3);h+=k(t,y,b,h,d,3);b[h++]=q[C];b[h++]=q[C+1];h+=k(l,C,b,h,c,3);h+=k(r,y,b,h,d,3);b[h++]=q[C+2]+1;b[h++]=q[C+1];h+=k(l,C,b,h,c,3);h+=k(v,y,b,h,d,3);b[h++]=q[C+2]+1;b[h++]=q[C+3]+1;h+=k(l,C,b,h,c,3);h+=k(v,y,b,h,d,3);b[h++]=q[C+2]+1;b[h++]=q[C+3]+1;h+=k(l,C,b,h,c,3);h+=k(a,y,b,h,d,3);b[h++]=q[C];b[h++]=q[C+3]+1;h+=k(l,C,b,h,c,3);h+=k(t,y,b,h,d,3);b[h++]=q[C];b[h++]=q[C+1]}};this.intersect=function(){};this.getGLMaterials=
function(){return{color:a,depthShadowMap:c,normal:void 0,depth:k,highlight:void 0}};this.getAllTextureIds=function(){return[h]}},a=function(a,c,d){p.basicGLMaterialConstructor(this,a);var k=w.TRANSPARENT_MATERIAL,h=c.get("billboard");p.singleTextureGLMaterialConstructor(this,d,{textureId:a.getTextureId()});this.beginSlot=function(a){return k===a};this.getProgram=function(){return h};this.bind=function(a,c){a.bindProgram(h);this.bindTexture(a,h);a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,
a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);a.setDepthTestEnabled(!0)};this.release=function(a){};this.bindView=function(a,c){p.bindView(c.origin,c.view,h)};this.bindInstance=function(a,c){h.setUniformMatrix4fv("model",c.transformation);h.setUniformMatrix4fv("modelNormal",c.transformationNormal)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},k=function(a,c,d,k){p.basicGLMaterialConstructor(this,a);var h=w.TRANSPARENT_MATERIAL,l=null==k?c.get("billboardDepth"):c.get("billboardDepthShadowMap");
p.singleTextureGLMaterialConstructor(this,d,{textureId:a.getTextureId()});this.beginSlot=function(a){return h===a};this.getProgram=function(){return l};this.bind=function(a,b){a.bindProgram(l);this.bindTexture(a,l);l.setUniform2fv("nearFar",b.nearFar)};this.release=function(a){};this.bindView=function(a,b){p.bindView(b.origin,b.view,l)};this.bindInstance=function(a,b){l.detUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},c=function(a,c,d){k.call(this,
a,c,d,!0)};return r.loadShaders=function(a,c,d,k){a._parse(A);var q=new l(k,a.vertexShaderBillboard,a.fragmentShaderBillboard,h.Default3D),r=c.get("fsDepthTextured");c=c.get("fsDepthTexturedShadowMap");r=new l(k,a.vertexShaderBillboardDepth,r.source,h.Default3D,r.defines);a=new l(k,a.vertexShaderBillboardDepth,c.source,h.Default3D,c.defines);d.add("billboard",q);d.add("billboardDepth",r);d.add("billboardDepthShadowMap",a)},r})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("dojo/_base/lang dojo/text!./ColorMaterial.xml ./internal/MaterialUtil ../lib/RenderSlot ../lib/Util ../lib/ShaderVariations ../lib/DefaultVertexAttributeLocations ../lib/DefaultVertexBufferLayouts ../../../webgl/Util".split(" "),
function(A,p,w,l,h,d,u,r,a){h=function(d,h){w.basicMaterialConstructor(this,h);d=d||{};d.color=d.color||[1,1,1,1];d.polygonOffset=d.polygonOffset||!1;d.vertexColors=d.vertexColors||!1;var l=r.Pos3Col;this.getParams=function(){return d};this.setColor=function(a){d.color=a;this.notifyDirty("matChanged")};this.getColor=function(){return d.color};this.setTransparent=function(a){d.transparent=a;this.notifyDirty("matChanged")};this.getTransparent=function(a){return d.transparent};this.dispose=function(){};
this.getOutputAmount=function(c){var d=a.getStride(l)/4;return c*d};this.getVertexBufferLayout=function(){return l};this.fillInterleaved=function(a,c,d,k,b,h,q){w.fillInterleaved(a,c,d,k,l,b,h,q)};this.intersect=w.intersectTriangleGeometry;this.getGLMaterials=function(){return{color:k,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:c}};this.getAllTextureIds=function(){return[]}};var k=function(a,c,d){w.basicGLMaterialConstructor(this,a);var k=A.clone(a.getParams()),h=c.getShaderVariationsProgram("colorMaterial",
[k.vertexColors]),q=a.getColor();this.beginSlot=function(a){return a===(1>q[3]?l.TRANSPARENT_MATERIAL:l.OPAQUE_MATERIAL)};this.getProgram=function(){return h};this.updateParameters=function(){k.color=a.getColor();k.transparent=a.getTransparent()};this.bind=function(a,b){a.bindProgram(h);h.setUniform4fv("eColor",k.color);a.setFaceCullingEnabled(!1);k.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(1,1));k.transparent&&(a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,
a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA));a.setDepthTestEnabled(!0)};this.release=function(a){a.setPolygonOffsetFillEnabled(!1);k.transparent&&a.setBlendingEnabled(!1)};this.bindView=function(a,b){w.bindView(b.origin,b.view,h)};this.bindInstance=function(a,b){h.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},c=function(a,c,d){w.basicGLMaterialConstructor(this,a);var k=A.clone(a.getParams()),h=c.getShaderVariationsProgram("colorMaterial",
[k.vertexColors]),q=[1,1,1,1];this.beginSlot=function(a){return a===(1>q[3]?l.TRANSPARENT_MATERIAL:l.OPAQUE_MATERIAL)};this.getProgram=function(){return h};this.updateParameters=function(){k.color=a.getColor();k.transparent=a.getTransparent()};this.bind=function(a,b){a.bindProgram(h);h.setUniform4fv("eColor",k.color);a.setFaceCullingEnabled(!1);k.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(1,1))};this.release=function(a){a.setPolygonOffsetFillEnabled(!1)};this.bindView=function(a,
b){w.bindView(b.origin,b.view,h)};this.bindInstance=function(a,b){h.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){return a.gl.TRIANGLES}};return h.programs=null,h.loadShaders=function(a,c,k,h){a._parse(p);a=new d("colorMaterial",["vertexShaderColorMaterial","fragmentShaderColorMaterial"],null,k,c,a,h,u.Default3D);a.addDefine("Color","VERTEXCOLORS");k.addShaderVariations("colorMaterial",a)},h})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./LineCalloutMaterial.xml ./internal/MaterialUtil ../lib/Util ../../../webgl/Util ./internal/MaterialBase ./internal/GLMaterialBase ../lib/RenderSlot ../lib/ShaderVariations".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c){function t(a,b,c){3===c.length?a.setUniform4f(b,c[0],c[1],c[2],1):a.setUniform4fv(b,c)}var C=d.VertexAttrConstants,q=[{name:"position",count:3,type:5126,offset:0,stride:48,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:48,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:48,normalized:!1},{name:"auxpos1",count:4,type:5126,offset:32,stride:48,normalized:!1}],v={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,
0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world"};A=function(a){function b(c,d){d=a.call(this,d)||this;return d.params=h.copyParameters(c,v),d._uniqueMaterialIdentifier=b.uniqueMaterialIdentifier(d.params),d}return w(b,a),Object.defineProperty(b.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0}),b.prototype.dispose=function(){},b.prototype.getGLMaterials=function(){return{color:y,
depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}},b.prototype.getAllTextureIds=function(){return[]},b.prototype.fillAttributeData=function(a,b,c,d,k,l){var m=a.indices[b];a=a.vertexAttr[b].data;if(m&&a)for(b=c+u.findAttribute(q,b).offset/4,c=0;c<m.length;c++)for(var r=d*m[c],t=0;6>t;t++)h.fill(a,r,l,b,k,d),b+=12},b.prototype.fillInterleaved=function(a,b,c,d,k,h,l){this.fillAttributeData(a,C.POSITION,h,3,b,k);this.fillAttributeData(a,C.NORMAL,h,3,c,k);this.fillAttributeData(a,C.AUXPOS1,
h,4,null,k);a=h+u.findAttribute(q,C.UV0).offset/4;b=0;for(c=B;b<c.length;b++)d=c[b],k[a+0]=d[0],k[a+1]=d[1],a+=12},b.prototype.getOutputAmount=function(a){return 288*a},b.prototype.getInstanceBufferLayout=function(){},b.prototype.getVertexBufferLayout=function(){return q},b.prototype.intersect=function(a,b,c,d,k,h,l,q){},b.prototype.getParameterValues=function(){var a=this.params;return{verticalOffset:a.verticalOffset,screenSizePerspective:a.screenSizePerspective,screenOffset:a.screenOffset,centerOffsetUnits:a.centerOffsetUnits,
color:[a.color[0],a.color[1],a.color[2],a.color[3]],size:a.size,borderColor:a.borderColor,occlusionTest:a.occlusionTest,shaderPolygonOffset:a.shaderPolygonOffset,depthHUDAlignStart:a.depthHUDAlignStart}},b.prototype.setParameterValues=function(a){h.updateParameters(this.params,a)&&(this._uniqueMaterialIdentifier=b.uniqueMaterialIdentifier(this.params),this.notifyDirty("matChanged"))},b.uniqueMaterialIdentifier=function(a){return JSON.stringify({screenOffset:a.screenOffset||[0,0],centerOffsetUnits:a.centerOffsetUnits||
"world"})},b.loadShaders=function(a,b,d,k){a._parse(l);a=new c("lineCallout",["vertexShaderLineCallout","fragmentShaderLineCallout"],null,d,b,a,k);a.addDefine("occlTest","OCCL_TEST");a.addDefine("verticalOffset","VERTICAL_OFFSET");a.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");a.addDefine("depthHud","DEPTH_HUD");a.addDefine("depthHudAlignStart","DEPTH_HUD_ALIGN_START");a.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN");d.addShaderVariations("line-callout-material-shader-variations",
a)},b}(r.MaterialBase);var y=function(a){function b(b,c,d){b=a.call(this,b,c,d)||this;return b.isRenderSlot=!0,b.programRep=c,b.updateParameters(),b}return w(b,a),b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()},b.prototype.selectProgram=function(){var a=this.params;this.renderProgram=this.programRep.getShaderVariationsProgram("line-callout-material-shader-variations",[!!a.occlusionTest,!!a.verticalOffset,!!a.screenSizePerspective,!1,!!a.depthHUDAlignStart,
"screen"===a.centerOffsetUnits]);this.depthProgram=this.programRep.getShaderVariationsProgram("line-callout-material-shader-variations",[!!a.occlusionTest,!!a.verticalOffset,!!a.screenSizePerspective,!0,!!a.depthHUDAlignStart,"screen"===a.centerOffsetUnits])},b.prototype.beginSlot=function(a){switch(a){case k.LINE_CALLOUTS:return this.isRenderSlot=!0,!0;case k.LINE_CALLOUTS_HUD_DEPTH:return this.isRenderSlot=!1,!0}return!1},Object.defineProperty(b.prototype,"program",{get:function(){return this.isRenderSlot?
this.renderProgram:this.depthProgram},enumerable:!0,configurable:!0}),b.prototype.getAllPrograms=function(){return[this.renderProgram,this.depthProgram]},b.prototype.getProgram=function(){return this.program},b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES},b.prototype.bind=function(a,b){var c=b.cameraAboveGround?1:-1,d=this.program,k=this.params;a.bindProgram(d);d.setUniform1f("cameraGroundRelative",c);d.setUniform1f("polygonOffset",k.shaderPolygonOffset);d.setUniform4fv("viewport",b.viewport);
d.setUniformMatrix4fv("viewNormal",b.viewInvTransp);d.setUniform1i("hudVisibilityTexture",0);a.bindTexture(b.hudVisibilityTexture,0);t(d,"color",k.color);d.setUniform2f("screenOffset",k.screenOffset[0],k.screenOffset[1]);this.bindBorder(a,b);h.bindVerticalOffset(k.verticalOffset,b,d);this.bindSizing(a,b);h.bindScreenSizePerspective(k.screenSizePerspective,d);this.isRenderSlot?this.bindRender(a,b):this.bindHUDDepth(a,b)},b.prototype.bindRender=function(a,b){a.setBlendFunctionSeparate(1,771,770,771);
a.setBlendingEnabled(!0);a.setDepthWriteEnabled(!1)},b.prototype.bindHUDDepth=function(a,b){a.setColorMask(!1,!1,!1,!1);a.setDepthWriteEnabled(!0);a.setBlendingEnabled(!1);a.setDepthTestEnabled(!0)},b.prototype.bindView=function(a,b){a=this.program;h.bindView(b.origin,b.view,a);h.bindCamPos(b.origin,b.viewInvTransp,a)},b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)},b.prototype.release=
function(a,b){this.isRenderSlot?this.releaseRender(a,b):this.releaseHUDDepth(a,b)},b.prototype.releaseRender=function(a,b){a.setBlendingEnabled(!1);a.setBlendFunction(770,771);a.setDepthWriteEnabled(!0)},b.prototype.releaseHUDDepth=function(a,b){a.setColorMask(!0,!0,!0,!0)},b.prototype.bindSizing=function(a,b){a=this.program;var c=this.params;a.setUniform2f("pixelToNDC",2/b.viewport[2],2/b.viewport[3]);a.setUniform1f("lineSize",Math.ceil(c.size))},b.prototype.bindBorder=function(a,b){a=this.program;
b=this.params;null!==b.borderColor?(t(a,"borderColor",b.borderColor),a.setUniform1f("borderSize",1)):(a.setUniform4f("borderColor",0,0,0,0),a.setUniform1f("borderSize",0))},b}(a.GLMaterialBase),B=[[0,0],[1,0],[0,1],[1,0],[1,1],[0,1]];return A})},"esri/views/3d/webgl-engine/materials/LeafCardMaterial":function(){define("dojo/text!./LeafCardMaterial.xml ./internal/MaterialUtil ../lib/Util ../lib/gl-matrix ../lib/RenderSlot ../../../webgl/Program ../lib/DefaultVertexAttributeLocations ../../../webgl/Util".split(" "),
function(A,p,w,l,h,d,u,r){function a(){return y=(9301*y+49297)%233280,y/233280}var k=l.vec3,c=l.mat4,t=l.mat4d;l=function(d,h,b,l,u,y){p.basicMaterialConstructor(this,y);var m=[{name:"position",count:3,type:5126,offset:0,stride:44,normalized:!1},{name:"normal",count:4,type:5126,offset:12,stride:44,normalized:!1},{name:"uv0",count:4,type:5126,offset:28,stride:44,normalized:!1}],B=r.getStride(m)/4;this.getAmbient=function(){return h};this.getDiffuse=function(){return b};this.getSpecular=function(){return l};
this.getShininess=function(){return u};this.dispose=function(){};this.getTextureId=function(){return d};this.getOutputAmount=function(a){var b,c=0;for(b=0;a/6>b;b++)0===b%1&&(c+=6);a=c;for(b=c=0;a/6>b;b++)0===b%1&&(c+=6);return c*B};this.getVertexBufferLayout=function(){return m};this.reduce=function(a,b){var c=a.position,d=a.normal;a=a.uv0;for(var k=[],h=[],l=[],m=0,q=0;q<c.length/6;q++)if(0===q%b)for(var r=0;6>r;r++)k[m]=c[6*q+r],h[m]=d[6*q+r],l[m]=a[6*q+r],m++;return{position:k,normal:h,uv0:l}};
this.fillInterleaved=function(b,d,h,l,m,q){l=p.fill;var r=this.reduce(b.indices,1),r=this.reduce(r,1),v=this.getOutputAmount(b.indices.position.length);w.assert(v===r.position.length*B);var u=r.position,C=r.normal,y=r.uv0,r=b.vertexAttr.position.data,E=b.vertexAttr.normal.data,g=b.vertexAttr.uv0.data,e=k.create();b=u.length/6;for(var v=q,f=k.createFrom(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),n=k.createFrom(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),x=0;b>x;++x){for(var D=k.create(),
G=k.create(),K=[100,100,-100,-100],M=k.create(),J=0;6>J;++J){var A=6*x+J,U=3*u[A],N=3*C[A],A=2*y[A];D[0]+=r[U+0];D[1]+=r[U+1];D[2]+=r[U+2];G[0]+=E[N+0];G[1]+=E[N+1];G[2]+=E[N+2];N=g[A+0];A=g[A+1];K[0]=Math.min(K[0],N);K[1]=Math.min(K[1],A);K[2]=Math.max(K[2],N);K[3]=Math.max(K[3],A);0===J&&k.set3(r[U+0],r[U+1],r[U+2],M)}D[0]/=6;D[1]/=6;D[2]/=6;G[0]/=6;G[1]/=6;G[2]/=6;D[0]+=.1*(2*a()-1);D[1]+=.1*(2*a()-1);D[2]+=.1*(2*a()-1);void 0!==d&&(t.multiplyVec3(d,M,M),t.multiplyVec3(d,D,D),t.multiplyVec3(h,
G,G));k.add(D,e,e);k.max(f,D,f);k.min(n,D,n);K[0]+=.01;K[1]+=.01;K[2]-=.01;K[3]-=.01;for(J=0;4>J;J++)K[J]=Math.min(K[J],.99999);J=2*a()*Math.PI;M=1.41*k.dist(M,D);q+=l(D,0,m,q,void 0,3);q+=l(G,0,m,q,void 0,3);m[q++]=0;m[q++]=K[0];m[q++]=K[1];m[q++]=J;m[q++]=M;q+=l(D,0,m,q,void 0,3);q+=l(G,0,m,q,void 0,3);m[q++]=0;m[q++]=K[2]+1;m[q++]=K[1];m[q++]=J;m[q++]=M;q+=l(D,0,m,q,void 0,3);q+=l(G,0,m,q,void 0,3);m[q++]=0;m[q++]=K[2]+1;m[q++]=K[3]+1;m[q++]=J;m[q++]=M;q+=l(D,0,m,q,void 0,3);q+=l(G,0,m,q,void 0,
3);m[q++]=0;m[q++]=K[2]+1;m[q++]=K[3]+1;m[q++]=J;m[q++]=M;q+=l(D,0,m,q,void 0,3);q+=l(G,0,m,q,void 0,3);m[q++]=0;m[q++]=K[0];m[q++]=K[3]+1;m[q++]=J;m[q++]=M;q+=l(D,0,m,q,void 0,3);q+=l(G,0,m,q,void 0,3);m[q++]=0;m[q++]=K[0];m[q++]=K[1];m[q++]=J;m[q++]=M}e[0]/=b;e[1]/=b;e[2]/=b;d=k.create();k.add(f,n,d);k.scale(d,.5,d);q=k.create();k.subtract(f,n,q);q[0]=Math.abs(q[0])/2;q[1]=Math.abs(q[1])/2;q[2]=Math.abs(q[2])/2;u=k.create(e);u[1]-=(f[1]-n[1])/3;f=k.create();n=k.create();r=k.create();C=[k.create(),
k.create(),k.create(),k.create()];e=[0,0,0,0];y=c.create();for(x=0;b>x;++x){k.set3(m[v],m[v+1],m[v+2],r);k.subtract(r,u,f);k.normalize(f,f);n=k.subtract(r,d,n);k.normalize(n,n);g=Math.abs(k.dot(n,[1,0,0]));J=Math.abs(k.dot(n,[0,1,0]));E=Math.abs(k.dot(n,[0,0,1]));g=g*Math.abs(d[0]-r[0])/q[0];g+=J*Math.abs(d[1]-r[1])/q[1];g+=E*Math.abs(d[2]-r[2])/q[2];for(J=0;4>J;J++)c.identity(y),c.rotate(y,.8*(2*a()-1),[0,1,0],y),c.rotate(y,.8*(2*a()-1),[1,0,0],y),c.multiplyVec3(y,f,C[J]),e[J]=.5+.5*g-.2*(2*a()-
1);E=.8+.3*(2*a()-1);for(J=0;6>J;++J){var R;switch(J){case 0:R=0;break;case 1:R=1;break;case 2:R=2;break;case 3:R=2;break;case 4:R=3;break;case 5:R=0}v+=3;v+=l(C[R],0,m,v,h,3);m[v++]=e[R];v+=3;m[v++]*=E}}};this.intersect=function(){};this.getGLMaterials=function(){return{color:C,depthShadowMap:v,normal:void 0,depth:q,highlight:void 0}};this.getAllTextureIds=function(){return[d]}};var C=function(a,c,b){p.basicGLMaterialConstructor(this,a);var d=h.TRANSPARENT_MATERIAL,k=c.get("leafCard");p.singleTextureGLMaterialConstructor(this,
b,{textureId:a.getTextureId()});this.beginSlot=function(a){return d===a};this.getProgram=function(){return k};var l=a.getAmbient(),q=a.getDiffuse(),r=a.getSpecular(),t=a.getShininess();this.bind=function(a,b){a.bindProgram(k);this.bindTexture(a,k);k.setUniform3fv("ambient",l);k.setUniform3fv("diffuse",q);k.setUniform3fv("specular",r);k.setUniform1f("shininess",t);k.setUniform1f("trafoScale",1);a.setBlendingEnabled(!1);a.setDepthTestEnabled(!0)};this.release=function(a){};this.bindView=function(a,
b){p.bindView(b.origin,b.view,k);p.bindCamPos(b.origin,b.viewInvTransp,k)};this.bindInstance=function(a,b){k.setUniformMatrix4fv("model",b.transformation);k.setUniformMatrix4fv("modelNormal",b.transformationNormal);a=b.transformation;k.setUniform1f("trafoScale",(Math.sqrt(a[0]*a[0]+a[4]*a[4]+a[8]*a[8])+Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])+Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))/3)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},q=function(a,c,b,d){p.basicGLMaterialConstructor(this,a);
var k=h.TRANSPARENT_MATERIAL,m=null==d?c.get("leafCardDepth"):c.get("leafCardDepthShadowMap");p.singleTextureGLMaterialConstructor(this,b,{textureId:a.getTextureId()});this.beginSlot=function(a){return k===a};this.getProgram=function(){return m};this.bind=function(a,b){a.bindProgram(m);this.bindTexture(a,m);m.setUniform2fv("nearFar",b.nearFar)};this.release=function(a){};this.bindView=function(a,b){p.bindView(b.origin,b.view,m)};this.bindInstance=function(a,b){m.setUniformMatrix4fv("model",b.transformation);
a=b.transformation;m.setUniform1f("trafoScale",(Math.sqrt(a[0]*a[0]+a[4]*a[4]+a[8]*a[8])+Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])+Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))/3)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},v=function(a,c,b){q.call(this,a,c,b,!0)};l.loadShaders=function(a,c,b,k){a._parse(A);var h=new d(k,a.vertexShaderLeafCard,a.fragmentShaderLeafCard,u.Default3D),m=c.get("fsDepthTextured");c=c.get("fsDepthTexturedShadowMap");m=new d(k,a.vertexShaderLeafCardDepth,m.source,
u.Default3D,m.defines);a=new d(k,a.vertexShaderLeafCardDepth,c.source,u.Default3D,c.defines);b.add("leafCard",h);b.add("leafCardDepth",m);b.add("leafCardDepthShadowMap",a)};var y=1234;return l})},"esri/views/3d/webgl-engine/materials/Material":function(){define("dojo/text!./Material.xml ./internal/MaterialUtil ../../../webgl/Program ../lib/ShaderVariations ../lib/Util ../lib/gl-matrix ../lib/RenderSlot ../lib/DefaultVertexAttributeLocations ../lib/DefaultVertexBufferLayouts ../../../webgl/Util ../../layers/graphics/graphicUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c){function t(a,e){var b=e.vvSizeEnabled;e.vvSizeEnabled?(a.setUniform3fv("vvSizeMinSize",e.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",e.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",e.vvSizeOffset),a.setUniform3fv("vvSizeFactor",e.vvSizeFactor)):b&&a.setUniform3fv("vvSizeValue",e.vvSizeValue);b&&(a.setUniform3fv("vvSymbolAnchor",e.vvSymbolAnchor),c.computeObjectRotation(e.vvSymbolRotation[2],e.vvSymbolRotation[0],e.vvSymbolRotation[1],m.identity(G)),a.setUniformMatrix3fv("vvSymbolRotation",
m.toMat3(G,J)));e.vvColorEnabled&&(a.setUniform1fv("vvColorValues",e.vvColorValues),a.setUniform4fv("vvColorColors",e.vvColorColors))}function C(a,e){a.vvSizeEnabled=e.vvSizeEnabled;a.vvSizeMinSize=e.vvSizeMinSize;a.vvSizeMaxSize=e.vvSizeMaxSize;a.vvSizeOffset=e.vvSizeOffset;a.vvSizeFactor=e.vvSizeFactor;a.vvSizeValue=e.vvSizeValue;a.vvSymbolAnchor=e.vvSymbolAnchor;a.vvSymbolRotation=e.vvSymbolRotation}function q(a,e){return D.set(a,E),D.multiply(e,E)}var v,y=h.assert,B=d.vec3,D=d.vec4,b=d.mat3,m=
d.mat4,E=D.create(),J=b.create(),G=m.create(),K=B.create(),M=B.create(),U=B.createFrom(0,0,1),N=B.create(),W=B.create(),R=B.create(),V=B.create(),Q=function(a,c){p.basicMaterialConstructor(this,c);a=a||{};a.ambient=a.ambient||[.2,.2,.2];a.diffuse=a.diffuse||[.8,.8,.8];a.specular=a.specular||[0,0,0];a.externalColor=a.externalColor||[1,1,1,1];a.colorMixMode=a.colorMixMode||"multiply";a.shininess=a.shininess||10;a.opacity=void 0!==a.opacity?a.opacity:1;a.layerOpacity=void 0!==a.layerOpacity?a.layerOpacity:
1;a.blendModeOneOne=a.blendModeOneOne||!1;a.inverseWindingOrder=a.inverseWindingOrder||!1;a.vertexColors=a.vertexColors||!1;a.symbolColors=a.symbolColors||!1;a.flipV=a.flipV||!1;a.doubleSided=a.doubleSided||!1;a.cullFace=a.cullFace||void 0;a.instanced=a.instanced||!1;this.instanced=!!a.instanced;a.groundNormalShading=a.groundNormalShading||!1;a.writeStencil=a.writeStencil||!1;a.textureId||(a.reflTextureId=void 0);a.receiveSSAO=void 0!==a.receiveSSAO?a.receiveSSAO:!0;a.castShadows=void 0!==a.castShadows?
a.castShadows:!0;a.verticalOffset=a.verticalOffset||null;a.screenSizePerspective=a.screenSizePerspective||null;a.vvSizeEnabled=a.vvSizeEnabled||!1;a.vvSizeMinSize=a.vvSizeMinSize||[1,1,1];a.vvSizeMaxSize=a.vvSizeMaxSize||[100,100,100];a.vvSizeOffset=a.vvSizeOffset||[0,0,0];a.vvSizeFactor=a.vvSizeFactor||[1,1,1];a.vvSizeValue=a.vvSizeValue||[1,1,1];a.vvColorEnabled=a.vvColorEnabled||!1;a.vvColorValues=a.vvColorValues||[0,0,0,0,0,0,0,0];a.vvColorColors=a.vvColorColors||[1,0,0,0,1,0,0,0,1,0,0,0,1,0,
0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0];a.vvSymbolAnchor=a.vvSymbolAnchor||[0,0,0];a.vvSymbolRotation=a.vvSymbolRotation||[0,0,0];var d=Q.getVertexBufferLayout(a),h=null;a.instanced&&(h=[],k.addDescriptor(h,"model",16,5126,!1,1),k.addDescriptor(h,"modelNormal",16,5126,!1,1),-1<a.instanced.indexOf("color")&&k.addDescriptor(h,"instanceColor",4,5126,!1,1),-1<a.instanced.indexOf("featureAttribute")&&k.addDescriptor(h,"instanceFeatureAttribute",4,5126,!1,1));var m=this.isVisible.bind(this);this.isVisible=
function(){return m()&&0<a.opacity&&0<a.layerOpacity};this.dispose=function(){};this.getParams=function(){return a};this.getParameterValues=function(){var e={ambient:a.ambient,diffuse:a.diffuse,specular:a.specular,externalColor:a.externalColor,colorMixMode:a.colorMixMode,shininess:a.shininess,opacity:a.opacity,layerOpacity:a.layerOpacity,transparent:a.transparent,polygonOffset:a.polygonOffset,reflectivity:a.reflectivity,atlasRegions:a.atlasRegions,flipV:a.flipV,doubleSided:a.doubleSided,cullFace:a.cullFace,
writeStencil:a.writeStencil,receiveSSAO:a.receiveSSAO,castShadows:a.castShadows,verticalOffset:a.verticalOffset,screenSizePerspective:a.screenSizePerspective,vvSizeEnabled:a.vvSizeEnabled,vvSizeMinSize:a.vvSizeMinSize,vvSizeMaxSize:a.vvSizeMaxSize,vvSizeOffset:a.vvSizeOffset,vvSizeFactor:a.vvSizeFactor,vvSizeValue:a.vvSizeValue,vvColorEnabled:a.vvColorEnabled,vvColorValues:a.vvColorValues,vvColorColors:a.vvColorColors,groundNormalShading:a.groundNormalShading,vvSymbolAnchor:a.vvSymbolAnchor,vvSymbolRotation:a.vvSymbolRotation};
return a.textureId&&(e.textureId=a.textureId,e.initTexture=a.initTexture),e};this.setParameterValues=function(e){for(var b in e)"textureId"===b&&y(a.textureId,"Can only change texture of material that already has a texture"),"castShadows"===b&&y(e.castShadows===a.castShadows,"Can not change shadow casting behavior."),a[b]=e[b];this.notifyDirty("matChanged")};this.getOutputAmount=function(a){var e=k.getStride(d)/4;return a*e};this.getVertexBufferLayout=function(){return d};this.getInstanceBufferLayout=
function(){return h};this.fillInterleaved=function(a,e,b,c,f,g,k){p.fillInterleaved(a,e,b,c,d,f,g,k)};this.intersect=function(e,c,d,f,g,k,h,m){if(null!=a.verticalOffset){m=f.camera;B.set3(d[12],d[13],d[14],R);var l=B.subtract(R,m.eye,V),n=B.length(l),q=B.scale(l,1/n),r=null,l=null;switch(f.viewingMode){case "global":l=B.normalize(R,N);break;case "local":l=B.set(U,N)}a.screenSizePerspective&&(r=B.dot(l,q));m=p.verticalOffsetAtDistance(m,n,a.verticalOffset,r,a.screenSizePerspective);B.scale(l,m);b.multiplyVec3(f.transformInverseRotation,
l,W);g=B.subtract(g,W,K);k=B.subtract(k,W,M)}p.intersectTriangleGeometry(e,c,d,f,g,k,h)};this.getGLMaterials=function(){return{color:Z,depthShadowMap:a.castShadows?g:null,normal:e,depth:O,highlight:f}};this.getAllTextureIds=function(){var e=[];return a.textureId&&e.push(a.textureId),a.reflTextureId&&e.push(a.reflTextureId),e}};Q.paramsFromOldConstructor=function(a,e,b,c,d,f,g,k,h,m,l,q,r){return{textureId:a,transparent:e,ambient:b,diffuse:c,specular:d,shininess:f,opacity:g,polygonOffset:k,initTexture:h,
reflTextureId:m,reflectivity:l,flipV:q,doubleSided:r,cullFace:void 0}};var S=function(a,e){var b=a.gl;(e.cullFace?"none"===e.cullFace:e.transparent)?a.setFaceCullingEnabled(!1):(a.setFaceCullingEnabled(!0),"front"===e.cullFace&&a.setCullFace(b.FRONT))},X=function(a,e){var b=a.gl;(e.cullFace?"none"===e.cullFace:e.transparent)?a.setFaceCullingEnabled(!0):(a.setFaceCullingEnabled(!1),"front"===e.cullFace&&a.setCullFace(b.BACK))},z=function(a,e){return a?u.TRANSPARENT_MATERIAL:e?u.STENCIL_MATERIAL:u.OPAQUE_MATERIAL},
Z=function(a,e,b){p.basicGLMaterialConstructor(this,a);var c=p.copyParameters(a.getParams()),d=z(c.transparent,c.writeStencil);p.singleTextureGLMaterialConstructor(this,b,c);var f=p.aquireIfNotUndefined(c.reflTextureId,c.reflInitTexture,b);f&&(f=f.getGLTexture());y(!(c.atlasRegions&&c.reflTextureId),"Atlas texture with reflection is not yet supported");var g=c.textureId?c.atlasRegions?"AtlasTextured":"Textured":"none";this.instanced=v&&c.instanced;var k,h=!!this.instanced&&-1<this.instanced.indexOf("color"),
m=!v&&c.instanced&&-1<c.instanced.indexOf("color"),l=[[null,null],[null,null]],n=null;this._loadPrograms=function(){l[0][0]=this._loadProgram(!1,!1);l[1][0]=this._loadProgram(!0,!1);c.receiveSSAO?(l[0][1]=this._loadProgram(!1,!0),l[1][1]=this._loadProgram(!0,!0),k=l[0].concat(l[1])):(l[0][1]=l[0][0],l[1][1]=l[1][0],k=[l[0][0],l[1][0]])};this._loadProgram=function(a,b){return e.getShaderVariationsProgram("material",[g,!!c.reflTextureId,c.vertexColors,c.symbolColors,c.flipV,c.doubleSided,!!this.instanced,
h,a,b,!!c.vvSizeEnabled,!!c.vvColorEnabled,null!=c.verticalOffset,null!=c.screenSizePerspective,c.groundNormalShading])};this._loadPrograms();var r="AtlasTextured"===g,u=this.dispose;this.dispose=function(){u();p.releaseIfNotUndefined(c.reflTextureId,b)};this.beginSlot=function(a){return d===a};this.getProgram=function(){return n||l[0][0]};this.getAllPrograms=function(){return k};this.updateParameters=function(){var e=a.getParams();c.ambient=e.ambient;c.diffuse=e.diffuse;c.specular=e.specular;c.externalColor=
e.externalColor;c.colorMixMode=e.colorMixMode;c.shininess=e.shininess;c.opacity=e.opacity;c.layerOpacity=e.layerOpacity;c.polygonOffset=e.polygonOffset;c.reflectivity=e.reflectivity;c.flipV=e.flipV;c.doubleSided=e.doubleSided;c.cullFace=e.cullFace;c.receiveSSAO=e.receiveSSAO;c.castShadows=e.castShadows;c.verticalOffset=e.verticalOffset;c.screenSizePerspective=e.screenSizePerspective;C(c,e);c.vvColorEnabled=e.vvColorEnabled;c.vvColorValues=e.vvColorValues;c.vvColorColors=e.vvColorColors;c.transparent!=
e.transparent&&(d=z(e.transparent),c.transparent=e.transparent);c.groundNormalShading=e.groundNormalShading;c.initTexture=e.initTexture;this.updateTexture(e.textureId);e.atlasRegions&&(c.atlasRegions=e.atlasRegions);c.blendModeOneOne=e.blendModeOneOne;c.inverseWindingOrder=e.inverseWindingOrder;this._loadPrograms()};this.bind=function(a,e){var b=a.gl;n=l[e.shadowMappingEnabled?1:0][e.ssaoEnabled?1:0];a.bindProgram(n);n.setUniform3fv("ambient",c.ambient);n.setUniform3fv("diffuse",c.diffuse);n.setUniform3fv("specular",
c.specular);n.setUniform4fv("externalColor",c.externalColor);n.setUniform1i("colorMixMode",p.colorMixModes[c.colorMixMode]);n.setUniform1f("shininess",c.shininess);n.setUniform1f("opacity",c.opacity);n.setUniform1f("layerOpacity",c.layerOpacity);p.bindVerticalOffset(c.verticalOffset,e,n);p.bindScreenSizePerspective(c.screenSizePerspective,n);t(n,c);this.bindTexture(a,n);r&&this.bindTextureSize(a,n);a.setBlendFunctionSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);void 0!==
f&&(n.setUniform1i("reflTex",1),a.bindTexture(f,1),n.setUniform1f("reflectivity",c.reflectivity));c.inverseWindingOrder&&a.setFrontFace(b.CW);c.transparent?(a.setBlendingEnabled(!0),c.blendModeOneOne?(a.setBlendFunction(b.ONE,b.ONE),a.setDepthWriteEnabled(!1)):a.setBlendFunctionSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA)):a.setBlendingEnabled(!1);c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(2,2));S(a,c);a.setDepthTestEnabled(!0)};this.release=
function(a,e){e=a.gl;a.setPolygonOffsetFillEnabled(!1);X(a,c);a.setBlendingEnabled(!1);a.setBlendFunctionSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);a.setDepthWriteEnabled(!0);a.setFrontFace(e.CCW)};this.bindView=function(a,e){n=l[e.shadowMappingEnabled?1:0][e.ssaoEnabled?1:0];a=e.origin;p.bindView(a,e.view,n);p.bindCamPos(a,e.viewInvTransp,n);e.shadowMappingEnabled&&e.shadowMap.bindView(n,a)};this.bindInstance=function(a,e){(n.setUniformMatrix4fv("model",e.transformation),
n.setUniformMatrix4fv("modelNormal",e.transformationNormal),e.instanceParameters&&m)&&(a=e.instanceParameters.color)&&n.setUniform4fv("externalColor",q(a,c.externalColor))};this.getDrawMode=function(a){return a.gl.TRIANGLES}},O=function(a,e,b,c){p.basicGLMaterialConstructor(this,a);var d=p.copyParameters(a.getParams());this.instanced=v&&d.instanced;var f=k.hasAttribute(a.getVertexBufferLayout(),"uv0")?(d.atlasRegions,"Textured"):"none",g=e.getShaderVariationsProgram("material-depth",[f,d.flipV,!!this.instanced,
!!c,!!d.vvSizeEnabled,null!=d.verticalOffset,null!=d.screenSizePerspective]),h=z(d.transparent,d.writeStencil);p.singleTextureGLMaterialConstructor(this,b,d);this.beginSlot=function(a){return h===a};this.getProgram=function(){return g};this.updateParameters=function(){var e=a.getParams();d.initTexture=e.initTexture;d.cullFace=e.cullFace;d.inverseWindingOrder=e.inverseWindingOrder;d.flipV=e.flipV;C(d,e);this.updateTexture(e.textureId)};this.bind=function(a,e){var b=a.gl;a.bindProgram(g);g.setUniform2fv("nearFar",
e.nearFar);d.inverseWindingOrder&&a.setFrontFace(b.CW);p.bindVerticalOffset(d.verticalOffset,e,g);p.bindScreenSizePerspective(d.screenSizePerspective,g);t(g,d);this.bindTexture(a,g);S(a,d);a.setDepthTestEnabled(!0)};this.release=function(a){var e=a.gl;X(a,d);d.inverseWindingOrder&&a.setFrontFace(e.CCW)};this.bindView=function(a,e){p.bindView(e.origin,e.view,g);d.screenSizePerspective&&p.bindCamPos(e.origin,e.viewInvTransp,g)};this.bindInstance=function(a,e){g.setUniformMatrix4fv("model",e.transformation)};
this.getDrawMode=function(a){return a.gl.TRIANGLES}},g=function(a,e,b){O.call(this,a,e,b,!0)},e=function(a,e,b){p.basicGLMaterialConstructor(this,a);var c=p.copyParameters(a.getParams()),d=k.hasAttribute(a.getVertexBufferLayout(),"uv0")?(c.atlasRegions,"Textured"):"none";this.instanced=v&&c.instanced;var f=e.getShaderVariationsProgram("material-normal",[d,c.flipV,!!this.instanced,!!c.vvSizeEnabled,null!=c.verticalOffset,null!=c.screenSizePerspective]),g=z(c.transparent,c.writeStencil);p.singleTextureGLMaterialConstructor(this,
b,c);this.beginSlot=function(a){return g===a};this.getProgram=function(){return f};this.updateParameters=function(){var e=a.getParams();c.initTexture=e.initTexture;c.cullFace=e.cullFace;c.inverseWindingOrder=e.inverseWindingOrder;c.flipV=e.flipV;C(c,e);this.updateTexture(e.textureId)};this.bind=function(a,e){var b=a.gl;a.bindProgram(f);this.bindTexture(a,f);f.setUniformMatrix4fv("viewNormal",e.viewInvTransp);p.bindVerticalOffset(c.verticalOffset,e,f);p.bindScreenSizePerspective(c.screenSizePerspective,
f);t(f,c);S(a,c);c.inverseWindingOrder&&a.setFrontFace(b.CW);a.setDepthTestEnabled(!0)};this.release=function(a){var e=a.gl;X(a,c);c.inverseWindingOrder&&a.setFrontFace(e.CCW)};this.bindView=function(a,e){p.bindView(e.origin,e.view,f);c.screenSizePerspective&&p.bindCamPos(e.origin,e.viewInvTransp,f)};this.bindInstance=function(a,e){f.setUniformMatrix4fv("model",e.transformation);f.setUniformMatrix4fv("modelNormal",e.transformationNormal)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},f=function(a,
e,b,c){p.basicGLMaterialConstructor(this,a);var d=p.copyParameters(a.getParams());c=k.hasAttribute(a.getVertexBufferLayout(),"uv0")?(d.atlasRegions,"Textured"):"none";this.instanced=v&&d.instanced;var f=e.getShaderVariationsProgram("material-highlight",[c,d.flipV,!!this.instanced,!!d.vvSizeEnabled,null!=d.verticalOffset,null!=d.screenSizePerspective]),g=z(d.transparent,d.writeStencil);p.singleTextureGLMaterialConstructor(this,b,d);this.beginSlot=function(a){return g===a};this.getProgram=function(){return f};
this.updateParameters=function(){var e=a.getParams();d.initTexture=e.initTexture;d.cullFace=e.cullFace;d.inverseWindingOrder=e.inverseWindingOrder;d.flipV=e.flipV;C(d,e);this.updateTexture(e.textureId)};this.bind=function(a,e){var b=a.gl;a.bindProgram(f);this.bindTexture(a,f);p.bindVerticalOffset(d.verticalOffset,e,f);p.bindScreenSizePerspective(d.screenSizePerspective,f);t(f,d);S(a,d);d.inverseWindingOrder&&a.setFrontFace(b.CW);a.setDepthTestEnabled(!0)};this.release=function(a){var e=a.gl;X(a,d);
d.inverseWindingOrder&&a.setFrontFace(e.CW)};this.bindView=function(a,e){p.bindView(e.origin,e.view,f);d.screenSizePerspective&&p.bindCamPos(e.origin,e.viewInvTransp,f)};this.bindInstance=function(a,e){f.setUniformMatrix4fv("model",e.transformation);f.setUniformMatrix4fv("modelNormal",e.transformationNormal)};this.getDrawMode=function(a){return a.gl.TRIANGLES}};return Q.getVertexBufferLayout=function(e){var b="Pos3";return e.groundNormalShading||(b+="Norm"),e.textureId&&(b+=e.atlasRegions?"TexRegion":
"Tex"),e.vertexColors&&(b+="Col"),e.symbolColors&&(b+="Symcol"),a[b]},Q.loadShaders=function(a,e,b,c){a._parse(A);v=c.extensions.angleInstancedArrays;c.extensions.shaderTextureLOD;c.extensions.standardDerivatives;var d=new l("phong",["vsPhong","fsPhong"],null,b,e,a,c);d.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);d.addBinaryShaderSnippetSuffix("Refl","Refl",[!1,!0]);d.addDefine("Color","VERTEXCOLORS");d.addDefine("symbolColor",
"SYMBOLVERTEXCOLORS");d.addDefine("FlipV","FLIPV");d.addDefine("DoubleSided","DOUBLESIDED");d.addDefine("Instanced","INSTANCED");d.addDefine("InstColor","INSTANCEDCOLOR");d.addDefine("ReceiveShadows","RECEIVE_SHADOWS");d.addDefine("ReceiveSSAO","RECEIVE_SSAO");d.addDefine("vvSize","VV_SIZE");d.addDefine("vvColor","VV_COLOR");d.addDefine("VerticalOffset","VERTICAL_OFFSET");d.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");d.addDefine("groundNormalShading","GROUND_NORMAL_SHADING");b.addShaderVariations("material",
d);d=new l("depth",["vsDepth","fsDepth"],null,b,e,a,c);d.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);d.addDefine("FlipV","FLIPV");d.addDefine("Instanced","INSTANCED");d.addDefine("ShadowMap","BIAS_SHADOWMAP");d.addDefine("vvSize","VV_SIZE");d.addDefine("VerticalOffset","VERTICAL_OFFSET");d.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");b.addShaderVariations("material-depth",d);d=new l("normal",["vsNormal",
"fsNormal"],null,b,e,a,c);d.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);d.addDefine("FlipV","FLIPV");d.addDefine("Instanced","INSTANCED");d.addDefine("vvSize","VV_SIZE");d.addDefine("VerticalOffset","VERTICAL_OFFSET");d.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");b.addShaderVariations("material-normal",d);d=new l("highlight",["vsHighlight","fsHighlight"],null,b,e,a,c);d.addNaryShaderSnippetSuffix([{value:"none",
programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);d.addDefine("FlipV","FLIPV");d.addDefine("Instanced","INSTANCED");d.addDefine("vvSize","VV_SIZE");d.addDefine("VerticalOffset","VERTICAL_OFFSET");d.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");b.addShaderVariations("material-highlight",d);var d=new w(c,a.vsDepth,a.fsDepth,r.Default3D,["BIAS_SHADOWMAP 1"]),f=new w(c,a.vsDepthTextured,a.fsDepthTextured,r.Default3D,["BIAS_SHADOWMAP 1"]),g=new w(c,
a.vsDepth,a.fsDepth,r.Default3D),k=new w(c,a.vsDepthTextured,a.fsDepthTextured,r.Default3D),h=new w(c,a.vsNormal,a.fsNormal,r.Default3D),m=new w(c,a.vsNormalTextured,a.fsNormalTextured,r.Default3D),n=new w(c,a.vsHighlight,a.fsHighlight,r.Default3D);c=new w(c,a.vsHighlightTextured,a.fsHighlightTextured,r.Default3D);b.add("depthShadowMap",d);b.add("depthTexturedShadowMap",f);b.add("depth",g);b.add("depthTextured",k);b.add("normal",h);b.add("normalTextured",m);b.add("highlight",n);b.add("highlightTextured",
c);e.add("fsDepth",{source:a.fsDepth});e.add("fsDepthTextured",{source:a.fsDepthTextured});e.add("fsDepthShadowMap",{source:a.fsDepthShadowMap,defines:["BIAS_SHADOWMAP 1"]});e.add("fsDepthTexturedShadowMap",{source:a.fsDepthTextured,defines:["BIAS_SHADOWMAP 1"]});e.add("vsDepth",{source:a.vsDepth});e.add("fsNormal",{source:a.fsNormal})},Q})},"esri/views/3d/layers/graphics/graphicUtils":function(){define(["require","exports","../../../../geometry","../../../../geometry/support/webMercatorUtils","../../lib/glMatrix"],
function(A,p,w,l,h){function d(a,d){var c=a.spatialReference;c.equals(d)||(c.isWebMercator&&d.wkid===w.SpatialReference.WGS84.wkid?l.webMercatorToGeographic(a,!1,a):d.isWebMercator&&c.wkid===w.SpatialReference.WGS84.wkid&&l.geographicToWebMercator(a,!1,a))}function u(a){if(Array.isArray(a)){for(var c=0;c<a.length;c++)if(!u(a[c]))return!1;return!0}return null==a||0<=a}Object.defineProperty(p,"__esModule",{value:!0});var r=h.vec4d,a=h.mat4d,k=[1,1,1];p.computeCentroid=function(a,k){if("extent"===a.type)return a.center;
if("polygon"===a.type)return a.centroid;for(var c=0,h=0,l=0,r=a.hasZ,t=0,u=0,b=a.paths;u<b.length;u++){for(var m=b[u],p=0,J=m;p<J.length;p++){var G=J[p],c=c+G[0],h=h+G[1];r&&(l+=G[2])}t+=m.length}a=new w.Point({x:c/t,y:h/t,z:r?l/t:void 0,spatialReference:a.spatialReference});return k&&d(a,k),a};p.convertToSR=d;p.enlargeExtent=function(a,d,k){if(a){d||(d=r.create());var c=.5*a.width*(k-1);k=.5*a.height*(k-1);return a.width<1E-7*a.height?c+=k/20:a.height<1E-7*a.width&&(k+=c/20),r.set4(a.xmin-c,a.ymin-
k,a.xmax+c,a.ymax+k,d),d}return null};p.updateVertexAttributeAuxpos1w=function(a,d){for(var c=0;c<a.geometries.length;++c){var k=a.geometries[c].data.vertexAttributes.auxpos1;k&&k.data[3]!==d&&(k.data[3]=d,a.geometryVertexAttrsUpdated(c))}};p.mixinColorAndOpacity=function(a,d){var c=[1,1,1,1];return null!=a&&(c[0]=a[0],c[1]=a[1],c[2]=a[2]),null!==d&&void 0!==d?c[3]=d:null!=a&&3<a.length&&(c[3]=a[3]),c};p.overrideColor=function(a,d,k,h,l){l=[l[0],l[1],l[2],l[3]];for(var c=0;3>c;++c)a&&null!=a[c]?l[c]=
a[c]:k&&null!=k[c]&&(l[c]=k[c]);return null!=d?l[3]=d:null!=h&&(l[3]=h),l};p.computeObjectScale=function(a,d,h,l){void 0===a&&(a=k);void 0===l&&(l=1);var c=Array(3);if(null==d||null==h)c[0]=1,c[1]=1,c[2]=1;else{for(var q=void 0,r=0,t=2;0<=t;t--){var b=a[t],m=void 0,u=null!=b,p=0===t&&!q&&!u,C=h[t];"symbolValue"===b||p?m=0!==C?d[t]/C:1:u&&"proportional"!==b&&isFinite(b)&&(m=0!==C?b/C:1);null!=m&&(c[t]=m,q=m,r=Math.max(r,Math.abs(m)))}for(t=2;0<=t;t--)null==c[t]?c[t]=q:0===c[t]&&(c[t]=.001*r)}for(t=
2;0<=t;t--)c[t]/=l;return c};p.computeSizeWithResourceSize=function(a,d){var c=d.width,k=d.depth,h=d.height;d=d.isPrimitive?10:1;if(null==c&&null==h&&null==k)return[d*a[0],d*a[1],d*a[2]];for(var l,c=[c,k,h],k=0;3>k;k++)if(h=c[k],null!=h){l=h/a[k];break}for(k=0;3>k;k++)null==c[k]&&(c[k]=a[k]*l);return c};p.validateSymbolLayerSize=function(a){return null!=a.isPrimitive&&(a=[a.width,a.depth,a.height]),u(a)?null:"Symbol sizes may not be negative values"};p.computeObjectRotation=function(c,d,k,h){void 0===
h&&(h=a.identity());c=c||0;d=d||0;k=k||0;return 0!==c&&a.rotateZ(h,-c/180*Math.PI,h),0!==d&&a.rotateX(h,d/180*Math.PI,h),0!==k&&a.rotateY(h,k/180*Math.PI,h),h}})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./RibbonLineMaterial.xml ./internal/MaterialUtil ./internal/MaterialBase ./internal/GLMaterialBase ../lib/Util ../lib/gl-matrix ../lib/RenderSlot ../lib/ComponentUtils ../lib/DefaultVertexBufferLayouts ../lib/ShaderVariations ../../../webgl/Util".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q){A=function(d){function k(a,b){b=d.call(this,b)||this;return b.params=h.copyParameters(a,N),"miter"!==b.params.join&&(b.params.miterLimit=0),b.numVertsAtJoin="wall"===b.params.type?2:4,b.numVertsAtCap=2,b.canBeMerged="screen"===b.params.type&&null==b.params.stippleLength,b}return w(k,d),k.prototype.setColor=function(a){this.params.color=a;this.notifyDirty("matChanged")},k.prototype.getColor=function(){return this.params.color},k.prototype.dispose=function(){},
k.prototype.getParams=function(){return this.params},k.prototype.getParameterValues=function(){var a=this.params;return{color:a.color,width:a.width,type:a.type,join:a.join,polygonOffset:a.polygonOffset,miterLimit:a.miterLimit,stippleLength:a.stippleLength}},k.prototype.setParameterValues=function(a){for(var b in a)r.assert("type"!==b,"RibbonLineMaterial: type cannot be changed after creation"),r.assert("stippleLength"!==b||null!=a[b]==(null!=this.params[b]),"RibbonLineMaterial: stippleLength on/off cannot be changed after creation"),
this.params[b]=a[b];"miter"!==this.params.join&&(this.params.miterLimit=0);this.notifyDirty("matChanged")},k.prototype.getOutputAmount=function(a){a=(a/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap;return this.canBeMerged&&(a+=2),a*q.getStride(R)/4},k.prototype.getInstanceBufferLayout=function(){},k.prototype.getVertexBufferLayout=function(){return"wall"===this.params.type?W:R},k.prototype.fillInterleaved=function(a,b,c,d,k,g){c=a.vertexAttr[r.VertexAttrConstants.POSITION].data;d=a.vertexAttr[r.VertexAttrConstants.COLOR]?
a.vertexAttr[r.VertexAttrConstants.COLOR].data:B;var e=a.vertexAttr[r.VertexAttrConstants.SIZE]?a.vertexAttr[r.VertexAttrConstants.SIZE].data:D;(a=a.indices&&a.indices[r.VertexAttrConstants.POSITION])&&a.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");"wall"===this.params.type?this.fillWithoutAuxpos(c,b,k,g):this.fillWithAuxpos(c,d,e,b,k,g)},k.prototype.intersect=function(d,k,h,l,q,g,e,f){if(l.isSelection&&!c.isAllHidden(k.componentVisibilities,d.data.componentOffsets)){var n,
t;k=d.getData();d=k.getVertexAttr()[r.VertexAttrConstants.POSITION].data;k=k.getVertexAttr()[r.VertexAttrConstants.SIZE];k=(k&&k.data[0])+this.params.width;q=Number.MAX_VALUE;g=l.camera;f=l.point;for(var v=0;v<d.length-5;v+=3){if(b[0]=d[v],b[1]=d[v+1],b[2]=d[v+2],a.mat4d.multiplyVec3(h,b),m[0]=d[v+3],m[1]=d[v+4],m[2]=d[v+5],a.mat4d.multiplyVec3(h,m),g.projectPoint(b,G),g.projectPoint(m,K),0>G[2]&&0<K[2])a.vec3d.subtract(b,m,E),n=g.frustumPlanes,t=-(a.vec3d.dot(n[4],b)+n[4][3]),n=t/a.vec3d.dot(E,n[4]),
a.vec3d.scale(E,n,E),a.vec3d.add(b,E,b),g.projectPoint(b,G);else if(0<G[2]&&0>K[2])a.vec3d.subtract(m,b,E),n=g.frustumPlanes,t=-(a.vec3d.dot(n[4],m)+n[4][3]),n=t/a.vec3d.dot(E,n[4]),a.vec3d.scale(E,n,E),a.vec3d.add(m,E,m),g.projectPoint(m,K);else if(0>G[2]&&0>K[2])continue;n=r.pointLineSegmentDistance2D(G,K,f);q>n&&(q=n,a.vec3d.set(b,M),a.vec3d.set(m,U))}h=l.p0;l=l.p1;k/2+4>q&&(d=r.lineSegmentLineSegmentDistance3D(M,U,h,l),k=Number.MAX_VALUE,d[0]&&(a.vec3d.subtract(d[2],h,J),k=a.vec3d.length(J)/a.vec3d.dist(h,
l)),e(k,J))}},k.prototype.getGLMaterials=function(){return{color:v,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:y}},k.prototype.getAllTextureIds=function(){return[]},k.prototype.fillWithAuxpos=function(a,b,c,d,k,g){var e=a.length/3,f=a[0],h=a[1],l=a[2],m=0,r=g,t=q.getStride(this.getVertexBufferLayout())/4;this.canBeMerged&&(g+=t);d&&(f=d[0]*f+d[4]*h+d[8]*l+d[12],h=d[1]*f+d[5]*h+d[9]*l+d[13],l=d[2]*f+d[6]*h+d[10]*l+d[14]);var v=f,u=h,p=l,C=a[3],y=a[4],w=a[5];d&&(C=d[0]*C+d[4]*y+d[8]*
w+d[12],y=d[1]*C+d[5]*y+d[9]*w+d[13],w=d[2]*C+d[6]*y+d[10]*w+d[14]);for(var z=0;e>z;z++){var B=3*z;e-1>z&&(C=a[B+3],y=a[B+4],w=a[B+5],d&&(C=d[0]*C+d[4]*y+d[8]*w+d[12],y=d[1]*C+d[5]*y+d[9]*w+d[13],w=d[2]*C+d[6]*y+d[10]*w+d[14]));m+=Math.sqrt((v-f)*(v-f)+(u-h)*(u-h)+(p-l)*(p-l));k[g++]=v;k[g++]=u;k[g++]=p;k[g++]=m;k[g++]=0===z?-1.2:-1;k[g++]=f;k[g++]=h;k[g++]=l;k[g++]=C;k[g++]=y;k[g++]=w;k[g++]=b[0];k[g++]=b[1];k[g++]=b[2];k[g++]=b[3];k[g++]=c[0];k[g++]=v;k[g++]=u;k[g++]=p;k[g++]=m;k[g++]=0===z?1.2:
1;k[g++]=f;k[g++]=h;k[g++]=l;k[g++]=C;k[g++]=y;k[g++]=w;k[g++]=b[0];k[g++]=b[1];k[g++]=b[2];k[g++]=b[3];k[g++]=c[0];0<z&&e-1>z&&(k[g++]=v,k[g++]=u,k[g++]=p,k[g++]=m,k[g++]=-1.2,k[g++]=f,k[g++]=h,k[g++]=l,k[g++]=C,k[g++]=y,k[g++]=w,k[g++]=b[0],k[g++]=b[1],k[g++]=b[2],k[g++]=b[3],k[g++]=c[0],k[g++]=v,k[g++]=u,k[g++]=p,k[g++]=m,k[g++]=1.2,k[g++]=f,k[g++]=h,k[g++]=l,k[g++]=C,k[g++]=y,k[g++]=w,k[g++]=b[0],k[g++]=b[1],k[g++]=b[2],k[g++]=b[3],k[g++]=c[0]);f=v;h=u;l=p;v=C;u=y;p=w}if(this.canBeMerged){for(z=
r;r+t>z;z++)k[z]=k[z+t];a=g-t;for(z=0;t>z;z++)k[g++]=k[a++]}},k.prototype.fillWithoutAuxpos=function(a,b,c,d){for(var k,g,e,f=a.length/3,h=0,l=a[0],m=a[1],q=a[2],r=0;f>r;r++){var t=3*r;k=l;g=m;e=q;l=a[t];m=a[t+1];q=a[t+2];b&&(l=b[0]*l+b[4]*m+b[8]*q+b[12],m=b[1]*l+b[5]*m+b[9]*q+b[13],q=b[2]*l+b[6]*m+b[10]*q+b[14]);h+=Math.sqrt((l-k)*(l-k)+(m-g)*(m-g)+(q-e)*(q-e));c[d++]=l;c[d++]=m;c[d++]=q;c[d++]=h;c[d++]=-1;c[d++]=l;c[d++]=m;c[d++]=q;c[d++]=h;c[d++]=1}},k.loadShaders=function(a,b,c,d){a._parse(l);
var k=function(a){a.addDefine("Screen","SCREENSCALE");a.addDefine("Strip","STRIP");a.addDefine("Wall","WALL");a.addDefine("Stipple","STIPPLE")},g=new C("ribbon-line",["vsRibbonLine","fsRibbonLine"],null,c,b,a,d);k(g);c.addShaderVariations("ribbon-line-material-shader-variations",g);a=new C("ribbon-line",["vsRibbonLine","fsRibbonLineHighlight"],null,c,b,a,d);k(a);c.addShaderVariations("ribbon-line-material-highlight-shader-variations",a)},k}(d.MaterialBase);var v=function(a){function b(b,c){var d=
a.call(this,b,c)||this;return d.params=h.copyParameters(b.getParams()),delete d.params.join,d.program=c.getShaderVariationsProgram("ribbon-line-material-shader-variations",["screen"===d.params.type,"strip"===d.params.type,"wall"===d.params.type,null!=d.params.stippleLength]),d}return w(b,a),b.prototype.updateParameters=function(){var a=this.material.getParams(),b=this.params;b.polygonOffset=a.polygonOffset;b.color=a.color;b.width=a.width;b.miterLimit="miter"===a.join?a.miterLimit:0;b.stippleLength=
a.stippleLength},b.prototype.beginSlot=function(a){return a===k.TRANSPARENT_MATERIAL},b.prototype.getProgram=function(){return this.program},b.prototype.bind=function(a,b){var c=this.program,d=this.params;(a.bindProgram(c),c.setUniform4fv("eColor",d.color),c.setUniform1f("miterLimit",d.miterLimit),c.setUniform1f("nearPlane",b.nearFar[0]),"screen"===d.type?(c.setUniform2fv("screenSize",[b.viewport[2],b.viewport[3]]),c.setUniform1f("extLineWidth",d.width*b.pixelRatio)):c.setUniform1f("extLineWidth",
d.width),null!=d.stippleLength)&&c.setUniform1f("stippleLengthDoubleInv",d.stippleLength?1/(2*d.stippleLength):0);d.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(1<=d.color[3])},b.prototype.release=function(a){this.params.polygonOffset&&a.setPolygonOffsetFillEnabled(!1);
a.setBlendingEnabled(!1);a.setDepthWriteEnabled(!0)},b.prototype.bindView=function(a,b){h.bindView(b.origin,b.view,this.program)},b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)},b.prototype.getDrawMode=function(a){return a.gl.TRIANGLE_STRIP},b}(u.GLMaterialBase),y=function(a){function b(b,c){var d=a.call(this,b,c)||this;return d.params=h.copyParameters(b.getParams()),delete d.params.join,d.program=c.getShaderVariationsProgram("ribbon-line-material-highlight-shader-variations",
["screen"===d.params.type,"strip"===d.params.type,"wall"===d.params.type,null!=d.params.stippleLength]),d}return w(b,a),b.prototype.updateParameters=function(){var a=this.material.getParams(),b=this.params;b.polygonOffset=a.polygonOffset;b.color=a.color;b.width=a.width;b.miterLimit="miter"===a.join?a.miterLimit:0;b.stippleLength=a.stippleLength},b.prototype.beginSlot=function(a){return a===k.OPAQUE_MATERIAL},b.prototype.getProgram=function(){return this.program},b.prototype.bind=function(a,b){var c=
this.program,d=this.params;(a.bindProgram(c),c.setUniform4fv("eColor",d.color),c.setUniform1f("miterLimit",d.miterLimit),c.setUniform1f("nearPlane",b.nearFar[0]),"screen"===d.type?(c.setUniform2fv("screenSize",[b.viewport[2],b.viewport[3]]),c.setUniform1f("extLineWidth",d.width*b.pixelRatio)):c.setUniform1f("extLineWidth",d.width),null!=d.stippleLength)&&c.setUniform1f("stippleLengthDoubleInv",d.stippleLength?1/(2*d.stippleLength):0);d.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,
-4));a.setFaceCullingEnabled(!1);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(1<=d.color[3])},b.prototype.release=function(a){this.params.polygonOffset&&a.setPolygonOffsetFillEnabled(!1);a.setDepthWriteEnabled(!0)},b.prototype.bindView=function(a,b){h.bindView(b.origin,b.view,this.program)},b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)},b.prototype.getDrawMode=function(a){return a.gl.TRIANGLE_STRIP},b}(u.GLMaterialBase),B=[255,255,255,255],D=
[0,0,0,0],b=a.vec3d.create(),m=a.vec3d.create(),E=a.vec3d.create(),J=a.vec3d.create(),G=a.vec2d.create(),K=a.vec2d.create(),M=a.vec3d.create(),U=a.vec3d.create(),N={color:[1,1,1,1],width:0,type:"screen",join:"miter",miterLimit:5,polygonOffset:!1,stippleLength:null},W=t.Pos3Tex,R=[{name:"position",count:3,type:5126,offset:0,stride:64,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:64,normalized:!1},{name:"auxpos1",count:3,type:5126,offset:20,stride:64,normalized:!1},{name:"auxpos2",count:3,
type:5126,offset:32,stride:64,normalized:!1},{name:"color",count:4,type:5126,offset:44,stride:64,normalized:!1},{name:"size",count:1,type:5126,offset:60,stride:64,normalized:!1}];return A})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("dojo/text!./WaterMaterial.xml ./internal/MaterialUtil ../lib/RenderSlot ../../../webgl/Program ../lib/DefaultVertexAttributeLocations ../lib/DefaultVertexBufferLayouts ../../../webgl/Util".split(" "),function(A,p,w,l,h,d,u){var r=function(k,
c,h,l,q,r){p.basicMaterialConstructor(this,r);var t=d.Pos3;this.dispose=function(){};this.getNoiseTextureId=function(){return k};this.getReflTextureId=function(){return c};this.getColor=function(){return h};this.getScale=function(){return l};this.getSpeed=function(){return q};this.getOutputAmount=function(a){return a*u.getStride(t)/4};this.getVertexBufferLayout=function(){return t};this.fillInterleaved=function(a,c,b,d,k,h,l){p.fillInterleaved(a,c,b,d,t,k,h,l)};this.intersect=p.intersectTriangleGeometry;
this.getGLMaterials=function(){return{color:a,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};this.getAllTextureIds=function(){return[k,c]}},a=function(a,c,d){p.basicGLMaterialConstructor(this,a);var k=w.TRANSPARENT_MATERIAL,h=c.get("water");c={noiseTextureId:a.getNoiseTextureId(),reflTextureId:a.getReflTextureId()};p.multiTextureGLMaterialConstructor(this,d,c,[["noiseTextureId",void 0,"noiseTex"],["reflTextureId",void 0,"reflTex"]]);var l=a.getColor(),r=a.getScale(),t=a.getSpeed(),
u=Date.now();this.beginSlot=function(a){return k===a};this.getProgram=function(){return h};this.bind=function(a,c){a.bindProgram(h);this.bindTextures(a,h);h.setUniform3fv("color",l);h.setUniform1f("scale",r);a=(Date.now()-u)/1E5*t;a-=Math.floor(a);h.setUniform1f("speed",a);c.shadowMappingEnabled||h.setUniform1f("depthHalfPixelSz",-1)};this.release=function(a){};this.bindView=function(a,c){a=c.origin;p.bindView(a,c.view,h);p.bindCamPos(a,c.viewInvTransp,h);c.shadowMappingEnabled&&c.shadowMap.bindView(h,
a)};this.bindInstance=function(a,c){h.setUniformMatrix4fv("model",c.transformation)};this.getDrawMode=function(a){return a.gl.TRIANGLES}};return r.loadShaders=function(a,c,d,r){a._parse(A);a=new l(r,a.vertexShaderWater,a.fragmentShaderWater,h.Default3D);d.add("water",a)},r})},"esri/views/3d/webgl-engine/materials/MeasurementArrowMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./MeasurementArrowMaterial.xml ./internal/MaterialUtil ../lib/Util ../../../webgl/Util ./internal/MaterialBase ./internal/GLMaterialBase ../lib/gl-matrix ../lib/RenderSlot ../lib/ShaderVariations".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t){var C=k.vec3d,q=k.mat4d,v=[{name:d.VertexAttrConstants.POSITION,count:3,type:5126,offset:0,stride:36,normalized:!1},{name:d.VertexAttrConstants.NORMAL,count:3,type:5126,offset:12,stride:36,normalized:!1},{name:d.VertexAttrConstants.UV0,count:2,type:5126,offset:24,stride:36,normalized:!1},{name:d.VertexAttrConstants.AUXPOS1,count:1,type:5126,offset:32,stride:36,normalized:!1}],y={width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,
1],stripeOddColor:[1,.5,0,1],polygonOffset:!1};A=function(a){function c(b,c){c=a.call(this,c)||this;return c.canBeMerged=!1,c.params=h.copyParameters(b,y),c}return w(c,a),c.prototype.dispose=function(){},c.prototype.getParameterValues=function(){var a=this.params;return{width:a.width,outlineSize:a.outlineSize,outlineColor:a.outlineColor,stripeLength:a.stripeLength,stripeEvenColor:a.stripeEvenColor,stripeOddColor:a.stripeOddColor,polygonOffset:a.polygonOffset}},c.prototype.setParameterValues=function(a){h.updateParameters(this.params,
a)&&this.notifyDirty("matChanged")},c.prototype.getParams=function(){return this.params},c.prototype.getOutputAmount=function(a){return 18*(a/2+1)},c.prototype.getInstanceBufferLayout=function(){},c.prototype.getVertexBufferLayout=function(){return v},c.prototype.fillInterleaved=function(a,c,k,l,r,t){l=a.vertexAttr[d.VertexAttrConstants.POSITION].data;var p=a.vertexAttr[d.VertexAttrConstants.NORMAL].data,y=l.length/3;(a=a&&a.indices&&a.indices.position)&&a.length!==2*(y-1)&&console.warn("MeasurementArrowMaterial does not support indices");
a=t+u.findAttribute(v,d.VertexAttrConstants.POSITION).offset/4;var w=t+u.findAttribute(v,d.VertexAttrConstants.NORMAL).offset/4,z=t+u.findAttribute(v,d.VertexAttrConstants.UV0).offset/4;t+=u.findAttribute(v,d.VertexAttrConstants.AUXPOS1).offset/4;for(var B=D,G=b,g=m,e=E,f=J,n=0,x=0;y>x;++x){var K=3*x;if(C.set3(l[K],l[K+1],l[K+2],B),y-1>x)K=3*(x+1),C.set3(l[K],l[K+1],l[K+2],G),C.set3(p[K],p[K+1],p[K+2],f),C.normalize(f),C.subtract(G,B,g),C.normalize(g),C.cross(f,g,e),C.normalize(e);K=C.dist(B,G);c&&
k&&(q.multiplyVec3(c,B),q.multiplyVec3(c,G),q.multiplyVec3(k,e));h.fill(B,0,r,a,void 0,3);a+=9;h.fill(B,0,r,a,void 0,3);a+=9;h.fill(e,0,r,w,void 0,3);w+=9;h.fill(e,0,r,w,void 0,3);w+=9;r[z]=n;r[z+1]=-1;z+=9;r[z]=n;r[z+1]=1;z+=9;y-1>x&&(n+=K)}for(x=0;y>x;++x)r[t]=n,t+=9,r[t]=n,t+=9},c.prototype.intersect=function(a,b,c,d,k,h,l,m){},c.prototype.getGLMaterials=function(){return{color:B,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}},c.prototype.getAllTextureIds=function(){return[]},
c.loadShaders=function(a,b,c,d){a._parse(l);a=new t("measurement-arrow",["vsMeasurementArrow","fsMeasurementArrow"],null,c,b,a,d);c.addShaderVariations("measurement-arrow-material-shader-variations",a)},c}(r.MaterialBase);var B=function(a){function b(b,c,d){d=a.call(this,b,c,d)||this;return d.programRep=c,d.params=h.copyParameters(b.getParams()),d.selectProgram(),d}return w(b,a),b.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("measurement-arrow-material-shader-variations",
[])},b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()},b.prototype.beginSlot=function(a){return a===c.OPAQUE_MATERIAL},b.prototype.getProgram=function(){return this.program},b.prototype.getDrawMode=function(a){return a.gl.TRIANGLE_STRIP},b.prototype.bind=function(a,b){b=this.program;a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(!0);a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!1);this.params.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),
a.setPolygonOffset(0,-4));a.bindProgram(b);b.setUniform1f("width",this.params.width);b.setUniform1f("outlineSize",this.params.outlineSize);b.setUniform4fv("outlineColor",this.params.outlineColor);b.setUniform1f("stripeLength",this.params.stripeLength);b.setUniform4fv("stripeEvenColor",this.params.stripeEvenColor);b.setUniform4fv("stripeOddColor",this.params.stripeOddColor)},b.prototype.bindView=function(a,b){a=b.origin;var c=this.getProgram();h.bindView(a,b.view,c)},b.prototype.bindInstance=function(a,
b){this.getProgram().setUniformMatrix4fv("model",b.transformation)},b.prototype.release=function(a){a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(!0);a.setBlendingEnabled(!1);this.params.polygonOffset&&a.setPolygonOffsetFillEnabled(!1)},b}(a.GLMaterialBase),D=C.create(),b=C.create(),m=C.create(),E=C.create(),J=C.create();a=q.create();return q.identity(a),A})},"esri/views/3d/webgl-engine/materials/internal/SimpleGLMaterial":function(){define("require exports dojo/text!./SimpleGLMaterial.xml ./MaterialUtil ../../lib/RenderSlot ../../../../webgl/Program ../../../../webgl/enums ../../lib/DefaultVertexAttributeLocations".split(" "),
function(A,p,w,l,h,d,u,r){return function(){function a(a,c,d,h){void 0===h&&(h=4);this.id=l.__GLMaterial_id++;this.program=a.get("simple");this.color=c;this.depthFunc=d;this.drawMode=h}return a.prototype.getId=function(){return this.id},a.prototype.beginSlot=function(a){return a===h.INTERNAL_MATERIAL},a.prototype.getProgram=function(){return this.program},a.prototype.bind=function(a,c){a.bindProgram(this.program);this.program.setUniformMatrix4fv("model",l.IDENTITY);this.program.setUniformMatrix4fv("proj",
c.proj);this.program.setUniform4fv("color",this.color);a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);a.setDepthTestEnabled(!0);void 0!==this.depthFunc&&a.setDepthFunction(this.depthFunc)},a.prototype.release=function(a){void 0!==this.depthFunc&&a.setDepthFunction(513);a.setBlendingEnabled(!1)},a.prototype.bindView=function(a,c){l.bindView(c.origin,c.view,this.program)},a.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",
c.transformation)},a.prototype.getDrawMode=function(a){return this.drawMode},a.loadShaders=function(a,c,h,l){a._parse(w);a=new d(l,a.vertexShaderSimple,a.fragmentShaderSimple,r.Default3D);h.add("simple",a)},a}()})},"esri/views/3d/webgl-engine/materials/internal/BlendLayers":function(){define(["dojo/text!./BlendLayers.xml","../../../../webgl/Program","../../lib/DefaultVertexAttributeLocations"],function(A,p,w){return{loadShaders:function(l,h,d,u){l._parse(A);l=new p(u,l.vertexShaderBlendLayers,l.fragmentShaderBlendLayers,
w.Default3D);d.add("blendLayers",l)}}})},"esri/views/3d/webgl-engine/lib/tracer":function(){define(["require","exports","./webgl-debug"],function(A,p,w){Object.defineProperty(p,"__esModule",{value:!0});var l=null,h=[];p.enabled=!1;p.begin=function(){p.enabled&&(l=[])};p.trace=function(d){p.enabled&&null!=l&&l.push(d)};p.end=function(){if(p.enabled){var d=l;return l=null,d&&(h.forEach(function(h){return h(d)}),h.length=0),d}};p.instrumentContext=function(d){return p.enabled?w.makeDebugContext(d,void 0,
function(d,h){p.enabled&&l&&l.push("gl."+d+"("+w.glFunctionArgsToString(d,h)+")")}):d};p.request=function(d){h.push(d)}})},"esri/views/3d/webgl-engine/lib/webgl-debug":function(){define([],function(){function A(c){if(null==a){a={};k={};for(var d in c)"number"==typeof c[d]&&(a[c[d]]=d,k[d]=c[d])}}function p(){if(null==a)throw"WebGLDebugUtils.init(ctx) not called";}function w(c){p();var d=a[c];return void 0!==d?"gl."+d:"/*UNKNOWN WebGL ENUM*/ 0x"+c.toString(16)}function l(a,d,h,l){a=r[a];if(void 0!==
a&&(a=a[d],void 0!==a&&a[h])){if("object"==typeof a[h]&&void 0!==a[h].enumBitwiseOr){d=a[h].enumBitwiseOr;h=0;a=[];for(var c=0;c<d.length;++c){var q=k[d[c]];0!==(l&q)&&(h|=q,a.push(w(q)))}return h===l?a.join(" | "):w(l)}return w(l)}return null===l?"null":void 0===l?"undefined":l.toString()}function h(a,d,k){a.__defineGetter__(k,function(){return d[k]});a.__defineSetter__(k,function(a){d[k]=a})}function d(a,k,r,q){function c(a,b){return function(){r&&r(b,arguments);var c=a[b].apply(a,arguments),d=
q.getError();return 0!=d&&(t[d]=!0,k(d,b,arguments)),c}}q=q||a;A(a);k=k||function(a,b,c){for(var d="",k=c.length,h=0;k>h;++h)d+=(0==h?"":", ")+l(b,k,h,c[h]);a="WebGL error "+w(a)+" in "+b+"("+d+")";window.console&&window.console.error?window.console.error(a):window.console&&window.console.log&&window.console.log(a)};var t={},u={},p;for(p in a)if("function"==typeof a[p])if("getExtension"!=p)u[p]=c(a,p);else{var b=c(a,p);u[p]=function(){var c=b.apply(a,arguments);return d(c,k,r,q)}}else h(u,a,p);return u.getError=
function(){for(var b in t)if(t.hasOwnProperty(b)&&t[b])return t[b]=!1,b;return a.NO_ERROR},u}function u(a){var c=a.getParameter(a.MAX_VERTEX_ATTRIBS),d=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,d);for(var k=0;c>k;++k)a.disableVertexAttribArray(k),a.vertexAttribPointer(k,4,a.FLOAT,!1,0,0),a.vertexAttrib1f(k,0);a.deleteBuffer(d);c=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(k=0;c>k;++k)a.activeTexture(a.TEXTURE0+k),a.bindTexture(a.TEXTURE_CUBE_MAP,null),a.bindTexture(a.TEXTURE_2D,null);a.activeTexture(a.TEXTURE0);
a.useProgram(null);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.disable(a.BLEND);a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);a.blendColor(0,0,0,0);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.ONE,a.ZERO);a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(-1);a.colorMask(!0,!0,!0,!0);a.cullFace(a.BACK);a.depthFunc(a.LESS);a.depthMask(!0);a.depthRange(0,
1);a.frontFace(a.CCW);a.hint(a.GENERATE_MIPMAP_HINT,a.DONT_CARE);a.lineWidth(1);a.pixelStorei(a.PACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);a.UNPACK_COLORSPACE_CONVERSION_WEBGL&&a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL);a.polygonOffset(0,0);a.sampleCoverage(1,!1);a.scissor(0,0,a.canvas.width,a.canvas.height);a.stencilFunc(a.ALWAYS,0,4294967295);a.stencilMask(4294967295);
a.stencilOp(a.KEEP,a.KEEP,a.KEEP);a.viewport(0,0,a.canvas.width,a.canvas.height);for(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);a.getError(););}var r={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},
getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,
1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,
1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},a=null,k=null;return{init:A,mightBeEnum:function(c){return p(),void 0!==a[c]},glEnumToString:w,glFunctionArgToString:l,
glFunctionArgsToString:function(a,d){for(var c="",k=d.length,h=0;k>h;++h)c+=(0==h?"":", ")+l(a,k,h,d[h]);return c},makeDebugContext:d,makeLostContextSimulatingCanvas:function(a){function c(a){return"function"==typeof a?a:function(b){a.handleEvent(b)}}function d(){for(var a=Object.keys(R),b=0;b<a.length;++b)delete R[a]}function k(){++U;G||A==U&&a.loseContext()}function l(a,b){var c=a[b];return function(){if(k(),!G)return c.apply(a,arguments)}}function r(a){return{statusMessage:a,preventDefault:function(){N=
!0}}}function p(a){for(var c in a)"function"==typeof a[c]?b[c]=l(a,c):h(b,a,c);b.getError=function(){if(k(),!G)for(var a;a=w.getError();)R[a]=!0;for(a in R)if(R[a])return delete R[a],a;return b.NO_ERROR};var d="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");for(c=0;c<d.length;++c){var m=d[c];b[m]=function(b){return function(){if(k(),G)return null;var c=b.apply(a,arguments);return c.__webglDebugContextLostId__=J,K.push(c),c}}(a[m])}d="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");
for(c=0;c<d.length;++c)m=d[c],b[m]=function(b){return function(){return k(),G?null:b.apply(a,arguments)}}(b[m]);d="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(c=0;c<d.length;++c)m=d[c],b[m]=function(b){return function(){return k(),G?!1:b.apply(a,arguments)}}(b[m]);return b.checkFramebufferStatus=function(c){return function(){return k(),G?b.FRAMEBUFFER_UNSUPPORTED:c.apply(a,arguments)}}(b.checkFramebufferStatus),b.getAttribLocation=function(b){return function(){return k(),
G?-1:b.apply(a,arguments)}}(b.getAttribLocation),b.getVertexAttribOffset=function(b){return function(){return k(),G?0:b.apply(a,arguments)}}(b.getVertexAttribOffset),b.isContextLost=function(){return G},b}var w,b,m=[],E=[];b={};var J=1,G=!1,K=[],A=0,U=0,N=!1,W=0,R={};a.getContext=function(c){return function(){var d=c.apply(a,arguments);if(d instanceof WebGLRenderingContext){if(d!=w){if(w)throw"got different context";w=d;b=p(w)}return b}return d}}(a.getContext);return function(a){var b=a.addEventListener;
a.addEventListener=function(d,k,h){switch(d){case "webglcontextlost":m.push(c(k));break;case "webglcontextrestored":E.push(c(k));break;default:b.apply(a,arguments)}}}(a),a.loseContext=function(){if(!G){G=!0;A=0;for(++J;w.getError(););d();R[w.CONTEXT_LOST_WEBGL]=!0;var b=r("context lost"),c=m.slice();setTimeout(function(){for(var d=0;d<c.length;++d)c[d](b);0<=W&&setTimeout(function(){a.restoreContext()},W)},0)}},a.restoreContext=function(){G&&E.length&&setTimeout(function(){if(!N)throw"can not restore. webglcontestlost listener did not call event.preventDefault";
for(var a=0;a<K.length;++a){var b=K[a];b instanceof WebGLBuffer?w.deleteBuffer(b):b instanceof WebGLFramebuffer?w.deleteFramebuffer(b):b instanceof WebGLProgram?w.deleteProgram(b):b instanceof WebGLRenderbuffer?w.deleteRenderbuffer(b):b instanceof WebGLShader?w.deleteShader(b):b instanceof WebGLTexture&&w.deleteTexture(b)}u(w);G=!1;U=0;N=!1;for(var a=E.slice(),b=r("context restored"),c=0;c<a.length;++c)a[c](b)},0)},a.loseContextInNCalls=function(a){if(G)throw"You can not ask a lost contet to be lost";
A=U+a},a.getNumCalls=function(){return U},a.setRestoreTimeout=function(a){W=a},a},resetToInitialState:u}})},"esri/views/webgl/RenderingContext":function(){define(["require","exports","./enums","./Extensions"],function(A,p,w,l){return function(){function h(d,h){this.gl=null;this._extensions=void 0;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};this._colorMaskState=
{r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=
1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._lineWidth=1;this._clearColor={r:0,g:0,b:0,a:0};this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap={};this.gl=d;this._extensions=new l(d,h);h=d.getParameter(d.VIEWPORT);this._viewport={x:h[0],y:h[1],width:h[2],height:h[3]};h=this.extensions.textureFilterAnisotropic;this._parameters={versionString:d.getParameter(d.VERSION),maxVertexTextureImageUnits:d.getParameter(d.MAX_VERTEX_TEXTURE_IMAGE_UNITS),
maxVertexAttributes:d.getParameter(d.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:h?d.getParameter(h.MAX_TEXTURE_MAX_ANISOTROPY_EXT):void 0,maxTextureImageUnits:d.getParameter(d.MAX_TEXTURE_IMAGE_UNITS)};this.enforceState()}return Object.defineProperty(h.prototype,"extensions",{get:function(){return this._extensions},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,
"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0}),h.prototype.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap={};this.gl=null},h.prototype.setBlendingEnabled=function(d){this._blendEnabled!==d&&(!0===d?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=d)},h.prototype.setBlendColor=function(d,h,l,a){(d!==this._blendColorState.r||h!==this._blendColorState.g||l!==this._blendColorState.b||
a!==this._blendColorState.a)&&(this.gl.blendColor(d,h,l,a),this._blendColorState.r=d,this._blendColorState.g=h,this._blendColorState.b=l,this._blendColorState.a=a)},h.prototype.setBlendFunction=function(d,h){(d!==this._blendFunctionState.srcRGB||h!==this._blendFunctionState.dstRGB)&&(this.gl.blendFunc(d,h),this._blendFunctionState.srcRGB=d,this._blendFunctionState.srcAlpha=d,this._blendFunctionState.dstRGB=h,this._blendFunctionState.dstAlpha=h)},h.prototype.setBlendFunctionSeparate=function(d,h,l,
a){(this._blendFunctionState.srcRGB!==d||this._blendFunctionState.srcAlpha!==l||this._blendFunctionState.dstRGB!==h||this._blendFunctionState.dstAlpha!==a)&&(this.gl.blendFuncSeparate(d,h,l,a),this._blendFunctionState.srcRGB=d,this._blendFunctionState.srcAlpha=l,this._blendFunctionState.dstRGB=h,this._blendFunctionState.dstAlpha=a)},h.prototype.setBlendEquation=function(d){this._blendEquationState.mode!==d&&(this.gl.blendEquation(d),this._blendEquationState.mode=d,this._blendEquationState.modeAlpha=
d)},h.prototype.setBlendEquationSeparate=function(d,h){(this._blendEquationState.mode!==d||this._blendEquationState.modeAlpha!==h)&&(this.gl.blendEquationSeparate(d,h),this._blendEquationState.mode=d,this._blendEquationState.modeAlpha=h)},h.prototype.setColorMask=function(d,h,l,a){(this._colorMaskState.r!==d||this._colorMaskState.g!==h||this._colorMaskState.b!==l||this._colorMaskState.a!==a)&&(this.gl.colorMask(d,h,l,a),this._colorMaskState.r=d,this._colorMaskState.g=h,this._colorMaskState.b=l,this._colorMaskState.a=
a)},h.prototype.setClearColor=function(d,h,l,a){(this._clearColor.r!==d||this._clearColor.g!==h||this._clearColor.b!==l||this._clearColor.a!==a)&&(this.gl.clearColor(d,h,l,a),this._clearColor.r=d,this._clearColor.g=h,this._clearColor.b=l,this._clearColor.a=a)},h.prototype.setFaceCullingEnabled=function(d){this._polygonCullingEnabled!==d&&(!0===d?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=d)},h.prototype.setPolygonOffsetFillEnabled=function(d){this._polygonOffsetFillEnabled!==
d&&(!0===d?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=d)},h.prototype.setPolygonOffset=function(d,h){this._polygonOffset[0]===d&&this._polygonOffset[1]===h||(this._polygonOffset[0]=d,this._polygonOffset[1]=h,this.gl.polygonOffset(d,h))},h.prototype.setCullFace=function(d){this._cullFace!==d&&(this.gl.cullFace(d),this._cullFace=d)},h.prototype.setFrontFace=function(d){this._frontFace!==d&&(this.gl.frontFace(d),this._frontFace=
d)},h.prototype.setScissorTestEnabled=function(d){this._scissorTestEnabled!==d&&(!0===d?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=d)},h.prototype.setScissorRect=function(d,h,l,a){(this._scissorRect.x!==d||this._scissorRect.y!==h||this._scissorRect.width!==l||this._scissorRect.height!==a)&&(this.gl.scissor(d,h,l,a),this._scissorRect.x=d,this._scissorRect.y=h,this._scissorRect.width=l,this._scissorRect.height=a)},h.prototype.setDepthTestEnabled=
function(d){this._depthTestEnabled!==d&&(!0===d?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=d)},h.prototype.setClearDepth=function(d){this._clearDepth!==d&&(this.gl.clearDepth(d),this._clearDepth=d)},h.prototype.setDepthFunction=function(d){this._depthFunction!==d&&(this.gl.depthFunc(d),this._depthFunction=d)},h.prototype.setDepthWriteEnabled=function(d){this._depthWriteEnabled!==d&&(this.gl.depthMask(d),this._depthWriteEnabled=d)},h.prototype.setDepthRange=
function(d,h){(this._depthRange.zNear!==d||this._depthRange.zFar!==h)&&(this.gl.depthRange(d,h),this._depthRange.zNear=d,this._depthRange.zFar=h)},h.prototype.setStencilTestEnabled=function(d){this._stencilTestEnabled!==d&&(!0===d?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=d)},h.prototype.setClearStencil=function(d){d!==this._clearStencil&&(this.gl.clearStencil(d),this._clearStencil=d)},h.prototype.setStencilFunction=function(d,h,l){(this._stencilFunction.func!==
d||this._stencilFunction.ref!==h||this._stencilFunction.mask!==l)&&(this.gl.stencilFunc(d,h,l),this._stencilFunction.face=1032,this._stencilFunction.func=d,this._stencilFunction.ref=h,this._stencilFunction.mask=l)},h.prototype.setStencilFunctionSeparate=function(d,h,l,a){(this._stencilFunction.face!==d||this._stencilFunction.func!==h||this._stencilFunction.ref!==l||this._stencilFunction.mask!==a)&&(this.gl.stencilFuncSeparate(d,h,l,a),this._stencilFunction.face=d,this._stencilFunction.func=h,this._stencilFunction.ref=
l,this._stencilFunction.mask=a)},h.prototype.setStencilWriteMask=function(d){this._stencilWriteMask!==d&&(this.gl.stencilMask(d),this._stencilWriteMask=d)},h.prototype.setStencilOp=function(d,h,l){(this._stencilOperation.fail!==d||this._stencilOperation.zFail!==h||this._stencilOperation.zPass!==l)&&(this.gl.stencilOp(d,h,l),this._stencilOperation.face=1032,this._stencilOperation.fail=d,this._stencilOperation.zFail=h,this._stencilOperation.zPass=l)},h.prototype.setStencilOpSeparate=function(d,h,l,
a){(this._stencilOperation.face!==d||this._stencilOperation.fail!==h||this._stencilOperation.zFail!==l||this._stencilOperation.zPass!==a)&&(this.gl.stencilOpSeparate(d,h,l,a),this._stencilOperation.face=d,this._stencilOperation.face=d,this._stencilOperation.fail=h,this._stencilOperation.zFail=l,this._stencilOperation.zPass=a)},h.prototype.setLineWidth=function(d){var h=this._lineWidth;return this._lineWidth!==d&&(this.gl.lineWidth(d),this._lineWidth=d),h},h.prototype.setActiveTexture=function(d){var h=
this._activeTextureUnit;return 0<=d&&d!==this._activeTextureUnit&&(this.gl.activeTexture(w.BASE_TEXTURE_UNIT+d),this._activeTextureUnit=d),h},h.prototype.clear=function(d){d&&this.gl.clear(d)},h.prototype.drawArrays=function(d,h,l){this.gl.drawArrays(d,h,l)},h.prototype.drawElements=function(d,h,l,a){return 5123===l?void this.gl.drawElements(d,h,l,a):void(5125===l&&this._extensions.elementIndexUint?this.gl.drawElements(d,h,l,a):console.warn("Data type is uint however extension OES_Element_index_unit is not supported therefore this draw call cannot be made"))},
h.prototype.drawArraysInstanced=function(d,h,l,a){this._extensions.angleInstancedArrays?this._extensions.angleInstancedArrays.drawArraysInstancedANGLE(d,h,l,a):console.error("Extension ANGLE_instanced_arrays isn't supported!")},h.prototype.drawElementsInstanced=function(d,h,l,a,k){this._extensions.angleInstancedArrays?5125!==l||this._extensions.elementIndexUint?this._extensions.angleInstancedArrays.drawElementsInstancedANGLE(d,h,l,a,k):console.error("Extension OES_Element_index_unit is not supported!"):
console.error("Extension ANGLE_instanced_arrays isn't supported!")},h.prototype.setViewport=function(d,h,l,a){var k=this._viewport;k.x===d&&k.y===h&&k.width===l&&k.height===a||(k.x=d,k.y=h,k.width=l,k.height=a,this.gl.viewport(d,h,l,a))},h.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}},h.prototype.bindProgram=function(d){return d?void(this._activeShaderProgram!==d&&(d.initialize(),this.gl.useProgram(d.glName),
this._activeShaderProgram=d)):(this.gl.useProgram(null),void(this._activeShaderProgram=null))},h.prototype.bindTexture=function(d,l){void 0===l&&(l=0);-1===h._MAX_TEXTURE_IMAGE_UNITS&&(h._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));(l>=h._MAX_TEXTURE_IMAGE_UNITS||0>l)&&console.error("Input texture unit is out of range of available units!");var r=this._textureUnitMap[l];return this.setActiveTexture(l),null==d||null==d.glName?(null!=r&&(this.gl.bindTexture(r.descriptor.target,
null),r.setBoundToUnit(l,!1)),void(this._textureUnitMap[l]=null)):r&&r.id===d.id?void d.applyChanges():(this.gl.bindTexture(d.descriptor.target,d.glName),d.setBoundToUnit(l,!0),d.applyChanges(),void(this._textureUnitMap[l]=d))},h.prototype.bindFramebuffer=function(d){return d?void(this._activeFramebuffer!==d&&(d.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,d.glName),this._activeFramebuffer=d)):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),void(this._activeFramebuffer=null))},h.prototype.bindBuffer=
function(d){d&&(34962===d.bufferType?this._activeVertexBuffer=h._bindBuffer(this.gl,d,d.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=h._bindBuffer(this.gl,d,d.bufferType,this._activeIndexBuffer))},h.prototype.unbindBuffer=function(d){34962===d?this._activeVertexBuffer=h._bindBuffer(this.gl,null,d,this._activeVertexBuffer):this._activeIndexBuffer=h._bindBuffer(this.gl,null,d,this._activeIndexBuffer)},h.prototype.bindVAO=function(d){return d?void(this._activeVertexArrayObject&&this._activeVertexArrayObject.id===
d.id||(d.bind(),this._activeVertexArrayObject=d)):void(this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null))},h.prototype.getBoundTexture=function(d){return this._textureUnitMap[d]},h.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer},h.prototype.getBoundVAO=function(){return this._activeVertexArrayObject},h.prototype.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);
this.unbindBuffer(34963);for(var d=0;d<this.parameters.maxTextureImageUnits;d++)this.bindTexture(null,d);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);
this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)},h.prototype.enforceState=function(){var d=this.gl,h=this._extensions.vao;h&&h.bindVertexArrayOES(null);for(var l=0;l<this.parameters.maxVertexAttributes;l++)d.disableVertexAttribArray(l);
if(this._activeVertexBuffer?d.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):d.bindBuffer(34962,null),this._activeIndexBuffer?d.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):d.bindBuffer(34963,null),h&&this._activeVertexArrayObject)(h=this._activeVertexArrayObject)&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null),this.bindVAO(h);d.bindFramebuffer(d.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:
null);d.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null);d.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);!0===this._blendEnabled?d.enable(this.gl.BLEND):d.disable(this.gl.BLEND);d.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);d.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);
d.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);d.clearDepth(this._clearDepth);d.clearStencil(this._clearStencil);d.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);d.cullFace(this._cullFace);d.depthFunc(this._depthFunction);d.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST);d.depthMask(this._depthWriteEnabled);d.frontFace(this._frontFace);
d.lineWidth(this._lineWidth);!0===this._polygonCullingEnabled?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE);d.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?d.enable(d.POLYGON_OFFSET_FILL):d.disable(d.POLYGON_OFFSET_FILL);d.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?d.enable(d.SCISSOR_TEST):d.disable(d.SCISSOR_TEST);d.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,
this._stencilFunction.mask);d.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);!0===this._stencilTestEnabled?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST);d.stencilMask(this._stencilWriteMask);for(h=0;h<this.parameters.maxTextureImageUnits;h++)d.activeTexture(w.BASE_TEXTURE_UNIT+h),d.bindTexture(3553,null),(l=this._textureUnitMap[h])&&d.bindTexture(l.descriptor.target,l.glName);d.activeTexture(w.BASE_TEXTURE_UNIT+
this._activeTextureUnit);d.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)},h._bindBuffer=function(d,h,l,a){return h?a===h?a:(d.bindBuffer(l,h.glName),h):(d.bindBuffer(l,null),null)},h._MAX_TEXTURE_IMAGE_UNITS=-1,h}()})},"esri/views/webgl/Extensions":function(){define(["require","exports"],function(A,p){return function(){function p(l,h){if(this._vaoInit=!1,this._angleInstancedArraysInit=!1,this._standardDerivativesInit=!1,this._elementIndexUintInit=!1,this._depthTextureInit=
!1,this._textureFilterAnisotropicInit=!1,this._shaderTextureLODInit=!1,this._compressedTextureS3TCInit=!1,this._disjointTimerQueryInit=!1,this._textureFloatInit=!1,this._textureFloatLinearInit=!1,this._colorBufferFloatInit=!1,this._gl=l,h&&h.disabledExtensions)l=h.disabledExtensions,l.vao&&(this._vao=null,this._vaoInit=!0),l.angleInstancedArrays&&(this._angleInstancedArrays=null,this._angleInstancedArraysInit=!0),l.standardDerivatives&&(this._standardDerivatives=null,this._standardDerivativesInit=
!0),l.elementIndexUint&&(this._elementIndexUint=null,this._elementIndexUintInit=!0),l.depthTexture&&(this._depthTexture=null,this._depthTextureInit=!0),l.textureFilterAnisotropic&&(this._textureFilterAnisotropic=null,this._textureFilterAnisotropicInit=!0),l.compressedTextureS3TC&&(this._compressedTextureS3TC=null,this._compressedTextureS3TCInit=!0),l.shaderTextureLOD&&(this._shaderTextureLOD=null,this._shaderTextureLODInit=!0),l.disjointTimerQuery&&(this._disjointTimerQuery=null,this._disjointTimerQueryInit=
!0),l.textureFloat&&(this._textureFloat=null,this._textureFloatInit=!0),l.textureFloatLinear&&(this._textureFloatLinear=null,this._textureFloatLinearInit=!0),l.colorBufferFloat&&(this._colorBufferFloat=null,this._colorBufferFloatInit=!0)}return Object.defineProperty(p.prototype,"vao",{get:function(){return this._vaoInit||(this._vao=this._gl.getExtension("OES_vertex_array_object")||this._gl.getExtension("MOZ_OES_vertex_array_object")||this._gl.getExtension("WEBKIT_OES_vertex_array_object"),this._vaoInit=
!0),this._vao},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"angleInstancedArrays",{get:function(){return this._angleInstancedArraysInit||(this._angleInstancedArrays=this._gl.getExtension("ANGLE_instanced_arrays"),this._angleInstancedArraysInit=!0),this._angleInstancedArrays},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"standardDerivatives",{get:function(){return this._standardDerivativesInit||(this._standardDerivatives=this._gl.getExtension("OES_standard_derivatives"),
this._standardDerivativesInit=!0),this._standardDerivatives},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"elementIndexUint",{get:function(){return this._elementIndexUintInit||(this._elementIndexUint=this._gl.getExtension("OES_element_index_uint"),this._elementIndexUintInit=!0),this._elementIndexUint},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"depthTexture",{get:function(){return this._depthTextureInit||(this._depthTexture=this._gl.getExtension("WEBGL_depth_texture")||
this._gl.getExtension("MOZ_WEBGL_depth_texture")||this._gl.getExtension("WEBKIT_WEBGL_depth_texture"),this._depthTextureInit=!0),this._depthTexture},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"textureFilterAnisotropic",{get:function(){return this._textureFilterAnisotropicInit||(this._textureFilterAnisotropic=this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),
this._textureFilterAnisotropicInit=!0),this._textureFilterAnisotropic},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"shaderTextureLOD",{get:function(){return this._shaderTextureLODInit||(this._shaderTextureLOD=this._gl.getExtension("EXT_shader_texture_lod"),this._shaderTextureLODInit=!0),this._shaderTextureLOD},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"compressedTextureS3TC",{get:function(){return this._compressedTextureS3TCInit||(this._compressedTextureS3TC=
this._gl.getExtension("WEBGL_compressed_texture_s3tc"),this._compressedTextureS3TCInit=!0),this._compressedTextureS3TC},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"disjointTimerQuery",{get:function(){return this._disjointTimerQueryInit||(this._disjointTimerQuery=this._gl.getExtension("EXT_disjoint_timer_query"),this._disjointTimerQueryInit=!0),this._disjointTimerQuery},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"textureFloat",{get:function(){return this._textureFloatInit||
(this._textureFloat=this._gl.getExtension("OES_texture_float"),this._textureFloatInit=!0),this._textureFloat},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"textureFloatLinear",{get:function(){return this._textureFloatLinearInit||(this._textureFloatLinear=this._gl.getExtension("OES_texture_float_linear"),this._textureFloatLinearInit=!0),this._textureFloatLinear},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"colorBufferFloat",{get:function(){return this._colorBufferFloatInit||
(this._colorBufferFloat=this._gl.getExtension("EXT_color_buffer_float"),this._colorBufferFloatInit=!0),this._colorBufferFloat},enumerable:!0,configurable:!0}),p}()})},"esri/views/3d/webgl-engine/lib/ProgramRepository":function(){define(["require","exports","./Util"],function(A,p,w){return function(){function l(){this.shaderVariators={};this._nextId=0;this._programsByName={};this._namesById=[];this._programRefCount=[];this._commonUniforms={model:[],modelNormal:[],lightDirection:[],proj:[],shadowMapDistance:[],
viewportPixelSz:[],lightingMainDirection:[]}}return l.prototype.dispose=function(){for(var h in this._programsByName)this._programsByName[h].dispose();this._programRefCount=this._namesById=this._programsByName=null},l.prototype.add=function(h,d){w.assert(null==this._programsByName[h]);this._programsByName[h]=d;this._namesById[d.id]=h},l.prototype.get=function(h){return this._programsByName[h]},l.prototype.addShaderVariations=function(h,d){this.shaderVariators[h]=d},l.prototype.getShaderVariations=
function(h){return this.shaderVariators[h]},l.prototype.getShaderVariationsProgram=function(h,d,l,r){return(h=this.getShaderVariations(h))&&h.getProgram(d,l,r)},l.prototype.getProgramsUsingUniform=function(h){return this._commonUniforms[h]||[]},l.prototype.increaseRefCount=function(h){var d=h.id;this._programRefCount[d]?this._programRefCount[d]++:(this._programRefCount[d]=1,this._findCommonUniforms(h))},l.prototype.decreaseRefCount=function(h){var d=h.id;1<this._programRefCount[d]?this._programRefCount[d]--:
(this._forgetCommonUniforms(h),this._programRefCount[d]=0)},l.prototype._getNextId=function(){return this._nextId++},l.prototype._findCommonUniforms=function(h){for(var d in this._commonUniforms)h.hasUniform(d)&&(w.assert(-1===this._commonUniforms[d].indexOf(h),"common uniforms of program have already been determined"),this._commonUniforms[d].push(h))},l.prototype._forgetCommonUniforms=function(h){for(var d in this._commonUniforms){var l=this._commonUniforms[d],r=l.indexOf(h);-1<r&&(l[r]=l[l.length-
1],l.pop())}},l}()})},"esri/views/3d/support/CombinedElevationProvider":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ./Evented".split(" "),function(A,p,w,l,h,d,u){return function(d){function a(a){var c=d.call(this)||this;return c.providers={im:[],ground:[],scene:[]},c.handles=new Map,c.elevationChange=function(a){c.emit("elevation-change",a)},c}return w(a,d),a.prototype.getElevation=
function(a,c){var d=-(1/0),k=!1;if("scene"===c)for(var h=0,l=this.providers.im;h<l.length;h++){var r=l[h],r=r.getElevation(a,c);null!=r&&(d=Math.max(r,d),!k&&isFinite(d)&&(k=!0))}if(!k)for(k=0,h=this.providers.ground;k<h.length;k++)r=h[k],r=r.getElevation(a,c),null!=r&&(d=Math.max(r,d));if("scene"===c)for(k=0,h=this.providers.scene;k<h.length;k++)r=h[k],r=r.getElevation(a,c),null!=r&&(d=Math.max(r,d));return isFinite(d)?d:null},a.prototype.register=function(a,c){this.handles.set(c,c.on("elevation-change",
this.elevationChange));this.providers[a].push(c)},a.prototype.unregister=function(a){this.handles.has(a)&&(this.handles.get(a).remove(),this.handles["delete"](a));for(var c=0,d=Object.keys(this.providers);c<d.length;c++){var k=d[c],h=this.providers[k].indexOf(a);-1<h&&this.providers[k].splice(h,1)}},l([h.property({constructOnly:!0})],a.prototype,"view",void 0),l([h.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],a.prototype,"spatialReference",void 0),a=l([h.subclass("esri.views.3d.support.CombinedElevationProvider")],
a)}(h.declared(d,u.Evented))})},"esri/views/3d/support/HighlightOptions":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../Color".split(" "),function(A,p,w,l,h,d,u){return function(d){function a(){var a=null!==d&&d.apply(this,arguments)||this;return a.color=new u([0,255,255]),a.haloOpacity=1,a.fillOpacity=.25,a}return w(a,d),a.toEngineOptions=function(a){return{color:new Float32Array(u.toUnitRGBA(a.color)),
haloOpacity:a.haloOpacity,haloOpacityOccluded:.25*a.haloOpacity,fillOpacity:a.fillOpacity,fillOpacityOccluded:.25*a.fillOpacity}},l([h.property({type:u})],a.prototype,"color",void 0),l([h.property()],a.prototype,"haloOpacity",void 0),l([h.property()],a.prototype,"fillOpacity",void 0),a=l([h.subclass()],a)}(h.declared(d))})},"esri/views/3d/support/RenderCoordsHelper":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../geometry/SpatialReference ../../../geometry/Point ../../../geometry/support/scaleUtils ../lib/glMatrix ./earthUtils ./projectionUtils ../webgl-engine/lib/BufferVectorMath ../webgl-engine/lib/Util".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c){Object.defineProperty(p,"__esModule",{value:!0});p.createRenderCoordsHelper=function(a,c){return"global"===a?new t(c):new C(c)};A=function(){function c(a,b){this.spatialReference=a;this.unitInMeters=b}return c.prototype.toRenderCoords=function(c,b,d){return c instanceof h?a.pointToVector(c,b,this.spatialReference):a.vectorToVector(c,b,d,this.spatialReference)},c.prototype.fromRenderCoords=function(c,b,d){return b instanceof h?a.vectorToPoint(c,this.spatialReference,
b,d):b instanceof l?a.vectorToPoint(c,this.spatialReference,b):a.vectorToVector(c,this.spatialReference,b,d)},c}();p.RenderCoordsHelper=A;var t=function(d){function h(b){return d.call(this,b||a.SphericalECEFSpatialReference,1)||this}return w(h,d),h.prototype.getAltitude=function(a,c){void 0===c&&(c=0);return k.Vec3Compact.length(a,c)-r.earthRadius},h.prototype.setAltitude=function(a,c){a=(a+r.earthRadius)/k.Vec3Compact.length(c,0);k.Vec3Compact.scale(c,0,a)},h.prototype.setAltitudeOfTransformation=
function(a,c){a=(a+r.earthRadius)/k.Vec3Compact.length(c,12);k.Vec3Compact.scale(c,12,a)},h.prototype.worldUpAtPosition=function(a,c){return u.vec3d.normalize(a||[0,0,0],c)},h.prototype.intersectManifold=function(a,d,k,h){return void 0===h&&(h=u.vec3d.create()),c.raySphere(a,d,null,r.earthRadius+k,v)?0>u.vec3d.dot(u.vec3d.direction(v,a,y),d)?!1:(u.vec3d.set(v,h),!0):!1},h}(A),C=function(a){function k(b){b=a.call(this,b,d.getMetersPerUnitForSR(b))||this;return b.worldUp=[0,0,1],b}return w(k,a),k.prototype.getAltitude=
function(a,c){return c?a[c+2]:a[2]},k.prototype.setAltitude=function(a,c){c[2]=a},k.prototype.setAltitudeOfTransformation=function(a,c){c[14]=a},k.prototype.worldUpAtPosition=function(a,c){return u.vec3d.set(this.worldUp,c)},k.prototype.intersectManifold=function(a,d,k,h){return void 0===h&&(h=u.vec3d.create()),u.vec4d.set4(this.worldUp[0],this.worldUp[1],this.worldUp[2],-k,q),c.rayPlane(a,d,q,v)?0>u.vec3d.dot(u.vec3d.direction(v,a,y),d)?!1:(u.vec3d.set(v,h),!0):!1},k}(A),q=u.vec4d.create(),v=u.vec3d.create(),
y=u.vec3d.create()})},"esri/views/3d/support/MapCoordsHelper":function(){define("dojo/Evented dojo/Deferred ../../../core/declare ../../../portal/support/geometryServiceUtils ../../../tasks/support/ProjectParameters ../../../geometry/SpatialReference ../../../geometry/Point ../../../geometry/support/scaleUtils".split(" "),function(A,p,w,l,h,d,u,r){return w(A,{unitInMeters:1,spatialReference:null,constructor:function(a,d,c){this.spatialReference=d;this.unitInMeters=r.getMetersPerUnitForSR(this.spatialReference);
(this.geometryService=c)||l.create(a&&a.portalItem).then(function(a){this.geometryService=a}.bind(this)).otherwise(function(){})},toGeographic:function(a){var k=new p,c=!0,l=this.spatialReference;if(!this.geometryService)return k.reject("Must specify geometryService in esri/config"),k;Array.isArray(a[0])&&"number"!=typeof a[0]||(a=[a],c=!1);a.forEach(function(c,d){c instanceof u||(a[d]=new u(c,l))});var r=new h({geometries:a,outSR:d.WGS84});return this.geometryService.project(r).then(function(a){try{a=
a.map(function(a){return[a.x,a.y]}),k.resolve(c?a:a[0])}catch(v){k.reject(v)}},function(a){k.reject(a)}),k.promise},canProject:function(){return!!this.geometryService}})})},"esri/views/3d/support/ResourceController":function(){define("../../../core/declare ../../../core/Scheduler ../../../core/HandleRegistry ./StreamDataSupplier ./StreamDataLoader ./PreallocArray ../webgl-engine/lib/Util".split(" "),function(A,p,w,l,h,d,u){function r(a){this.budget=this.begin=0;this.performance=a;this.enabled=!0}
var a=u.assert,k={TERRAIN:"terrain",SCENE:"scene",SYMBOLOGY:"symbols"},c=new d(20);r.prototype.now=function(){return this.performance.now()};r.prototype.reset=function(a){this.begin=this.now();this.budget=this.enabled?a:Number.MAX_VALUE};r.prototype.done=function(){return this.enabled&&this.elapsed()>=this.budget};r.prototype.remaining=function(){return Math.max(this.budget-this.elapsed(),0)};r.prototype.elapsed=function(){return this.now()-this.begin};A=A(null,{constructor:function(a,c,d){d=d||u.performance;
this._clients=[];this._frameWorker=null;this._budget=new r(d);this._idleFrameWorkers=[];this._idleFrameWorkerRobin=0;this._idleUpdatesStartFired=!1;this._lastTargetChangeTime=d.now();this.navigationTimeout=300;this.animatingFrameTimeBudget=10;this.idleFrameWorkerBudget=30;this.idleFrameTimeBudget=50;d={};for(var l in k)d[k[l]]=0;d[k.TERRAIN]=15;d[k.SCENE]=20;d[k.SYMBOLOGY]=5;this._maxGpuMemory=500;this.streamDataLoader=new h(d);this._cameraListeners=new w;this._cameraListeners.add([a.watch("state.camera",
this._cameraChangedHandler.bind(this),!0)]);c||(c=p);this._frameTask=c.addFrameTask({update:this._frameUpdate.bind(this)});this._view=a;this.stats={frameUpdateTime:new t,idleUpdateTime:new t};this.frameUpdateNavigation=null},destroy:function(){this._frameTask.remove();this._frameTask=null;this._cameraListeners.remove();this.streamDataLoader.destroy();this.streamDataLoader=null},setEnableBudget:function(a){this._budget.enabled=!!a},registerClient:function(a,c,d){return this._clients.push({client:a,
type:c}),"function"==typeof a.setMaxGpuMemory&&a.setMaxGpuMemory(this._maxGpuMemory),new l(c,this.streamDataLoader,d)},deregisterClient:function(a){for(var c=0;c<this._clients.length;c++)if(this._clients[c].client===a)return this._clients[c]=this._clients[this._clients.length-1],void this._clients.pop();console.warn("deregistering an unregistered client.")},setMaxGpuMemory:function(a){this._maxGpuMemory=a;for(var c=0;c<this._clients.length;c++){var d=this._clients[c].client;"function"==typeof d.setMaxGpuMemory&&
d.setMaxGpuMemory(a)}},registerIdleFrameWorker:function(c,d){var k=this._idleFrameWorkers.some(function(a){return a.client===c});a(!k,"Can only register idle frame workers once per client/layer");a(!d.idleFrame||d.needsUpdate,"needsUpdate has to be specified if idleFrame is specified");this._idleFrameWorkers.push({client:c,callbacks:d});this._isIdle()&&this._idleUpdatesStartFired&&d.idleBegin&&d.idleBegin.call(c)},deregisterIdleFrameWorker:function(a){for(var c=this._idleFrameWorkers,d=0;d<c.length;d++){var k=
c[d];if(k.client===a)return this._idleUpdatesStartFired&&k.callbacks.idleEnd&&k.callbacks.idleEnd.call(a),c[d]=c[c.length-1],void c.pop()}},registerFrameWorker:function(c){a(!this._frameWorker,"Only one (non-idle) per-frame worker supported at the moment");this._frameWorker=c},deregisterFrameWorker:function(){this._frameWorker=null},_cameraChangedHandler:function(){this._lastTargetChangeTime=this._budget.now();this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._callWorkersNoScheduling("idleEnd"))},
_frameUpdate:function(a){var c=this._isIdle()?this.idleFrameWorkerBudget:this.animatingFrameTimeBudget;this._budget.reset(c-a.spendInFrame);this._view.stateManager&&this._view.stateManager.step(a.deltaTime/1E3);this._view.inputManager&&this._view.inputManager._pinchNavigation&&this._view.inputManager._pinchNavigation.momentum.doFrameUpdate(a.deltaTime);this._frameWorker&&(this._frameWorker(this._budget),this.stats.frameUpdateTime.addSample(this._budget.elapsed()));this._isIdle()&&(this._idleUpdatesStartFired||
(this._callWorkersNoScheduling("idleBegin"),this._idleUpdatesStartFired=!0),this._budget.reset(this.idleFrameTimeBudget-this._budget.elapsed()),3<this._budget.remaining()&&(this._callWorkersStrictScheduling("idleFrame",this._budget),this.stats.idleUpdateTime.addSample(this._budget.elapsed())))},_isIdle:function(){return this._budget.now()-this._lastTargetChangeTime>this.navigationTimeout},_callWorkersNoScheduling:function(a){for(var c=this._idleFrameWorkers,d=0;d<c.length;d++){var k=c[d];k.callbacks[a]&&
k.callbacks[a].call(k.client)}},_callWorkersStrictScheduling:function(a,d){var k,h,l,q=this._idleFrameWorkers,b=q.length;c.clear();h=0;for(l=this._idleFrameWorkerRobin;b>h;h++)k=q[l++%b],k.callbacks.needsUpdate&&k.callbacks.needsUpdate.call(k.client)&&(0===c.length&&(this._idleFrameWorkerRobin=l),c.push(k));k=d.now();for(h=k+d.remaining();0<c.length&&h>k;)d.reset((h-k)/c.length),k=c.pop(),k.callbacks[a].call(k.client,d),k=d.now()}});A.ClientType=k;var t=function(){this.addSample=function(a){this.min=
Math.min(this.min,a);this.max=Math.max(this.max,a);this.total+=a;this.numSamples++};this.getAverage=function(){return this.total/this.numSamples};this.reset=function(){this.numSamples=this.total=0;this.min=Number.MAX_VALUE;this.max=-Number.MAX_VALUE};this.reset()};return A})},"esri/views/3d/support/StreamDataSupplier":function(){define(["require","exports"],function(A,p){return function(){function p(l,h,d){this._clientType=l;this._loader=h;this._activeRequests=null;d&&d.trackRequests&&(this._activeRequests=
new Map)}return p.prototype.request=function(l,h,d){var p=this;h=this._loader.request(l,h,this._clientType,d);this._activeRequests&&(this._activeRequests.set(l,h),d=function(){p._activeRequests["delete"](l)},h.then(d,d));return h},p.prototype.isRequested=function(l){return this._loader.isRequested(l)},p.prototype.cancelRequest=function(l){this._loader.cancel(l)},p.prototype.cancelAll=function(){var l=this;this._activeRequests&&(this._activeRequests.forEach(function(h){l._loader.cancel(h)}),this._activeRequests.clear())},
p.prototype.hasPendingDownloads=function(){return this._loader.hasPendingDownloads()},p}()})},"esri/views/3d/support/StreamDataLoader":function(){define("../../../core/declare ../../../request ../../../core/urlUtils ./PromiseLightweight ./AsyncQuotaRoundRobinQueue ../webgl-engine/lib/Util".split(" "),function(A,p,w,l,h,d){var u=d.assert,r={QUEUED:1,DOWNLOADING:2,CANCELLED:4};A=A(null,{constructor:function(a){this.alreadyLoading={};this.loadQueue=new h(k,this._doneLoadingCallback,this,a);this._urlInfo=
{hasSameOrigin:{},canUseXhr:{}}},destroy:function(){for(var a in this.alreadyLoading){for(var d=this.alreadyLoading[a],k=0;k<d.clientPromises.length;k++){var h=d.clientPromises[k];h.isRejected()||h.reject(d.url,null,d.docType,d.clientMetadata[k])}this._cancelTask(d)}this.loadQueue.clear();this.alreadyLoading=this.loadQueue=null},request:function(a,d,k,h){h=h||{};var c=new l.Promise(function(){this.cancel(c)}.bind(this));c.requestURL=a;var q=this.alreadyLoading[a];return q?(q.clientPromises.push(c),
q.clientMetadata.push(h.metadata)):(q={url:a,docType:d,clientType:k,status:r.QUEUED,clientMetadata:[h.metadata],clientPromises:[c],downloadObj:null,_cancelledInQueue:!1},this.alreadyLoading[a]=q,this.loadQueue.push(q)),c},isRequested:function(a){return void 0!==this.alreadyLoading[a]},cancel:function(a){var c=this.alreadyLoading[a.requestURL];c&&this._removeRequestPromiseFromTask(c,a)},hasPendingDownloads:function(){return!d.objectEmpty(this.alreadyLoading)},_removeRequestPromiseFromTask:function(a,
d){var c=a.clientPromises.length;1<c?(d=a.clientPromises.indexOf(d),u(-1<d,"request to be cancelled is already cancelled or invalid"),a.clientPromises[d]=a.clientPromises[c-1],a.clientPromises.pop(),a.clientMetadata[d]=a.clientMetadata[c-1],a.clientMetadata.pop()):(u(a.clientPromises[0]===d,"request to be cancelled is already cancelled or invalid"),this._cancelTask(a))},_cancelTask:function(a){if(a.status===r.DOWNLOADING){if(this.loadQueue.workerCancelled(a),"image"===a.docType&&w.isDataProtocol(a.url)){var c=
a.downloadObj;c.removeAttribute("onload");c.removeAttribute("onerror");c.removeAttribute("src")}else a.status=r.CANCELLED,a.downloadObj.cancel();a.downloadObj=null}a.status=r.CANCELLED;a.clientPromises=void 0;a.clientMetadata=void 0;delete this.alreadyLoading[a.url]},_doneLoadingCallback:function(a,d){var c;if(u(a.status===r.DOWNLOADING),delete this.alreadyLoading[a.url],d)for(c=0;c<a.clientPromises.length;c++)a.clientPromises[c].isRejected()||a.clientPromises[c].reject(a.url,d,a.docType,a.clientMetadata[c]);
else for(c=0;c<a.clientPromises.length;c++)a.clientPromises[c].done(a.url,a.result,a.docType,a.clientMetadata[c])}});var a=function(a,d,k){a.onload=function(){d.status!==r.CANCELLED&&(d.result=a,a.removeAttribute("onload"),a.removeAttribute("onerror"),k(d))};a.onerror=function(){d.status!==r.CANCELLED&&(a.removeAttribute("onload"),a.removeAttribute("onerror"),k(d,{status:404}))}},k=function(c,k){if(c.status===r.CANCELLED)return!1;if(c.status=r.DOWNLOADING,"image"===c.docType&&w.isDataProtocol(c.url)){var h=
new Image;return a(h,c,k),h.src=c.url,c.downloadObj=h,!0}var l;switch(c.docType){case "binary":l="array-buffer";h=0;break;case "image":l="image";break;default:l="json"}return c.downloadObj=p(c.url,{responseType:l,timeout:h,allowImageDataAccess:"image"===c.docType}),c.downloadObj.then(function(a){c.duration=d.performance.now()-c.startTime;c.size=0;c.result=a.data;k(c)},function(a){c.downloadObj.isCanceled()||k(c,a)}),!0};return A.TaskStatus=r,A})},"esri/views/3d/support/PromiseLightweight":function(){!function(A){function p(h){this._callbacks=
[];this._errbacks=[];this._cancelCallback=h;this._iserr=this._isdone=this._iscancelled=!1}function w(h,d){var l=new p;return 0===h.length?l.done.apply(l,d):h[0].apply(null,d).then(function(){h.splice(0,1);w(h,arguments).then(function(){l.done.apply(l,arguments)})}),l}p.prototype.cancel=function(h){this._callbacks=[];this._errbacks=[];this._iscancelled=!0;this._cancelCallback&&this._cancelCallback(h)};p.prototype.then=function(h,d,l){var r;if(!this._iscancelled)return this._isdone?r=h.apply(l,this.result):
this._iserr&&d?r=d.apply(l,this.result):(this._callbacks.push(function(){return h.apply(l,arguments)}),d&&this._errbacks.push(function(){return d.apply(l,arguments)})),r};p.prototype.done=function(){this.result=arguments;this._isdone=!0;for(var h=0;h<this._callbacks.length;h++)this._callbacks[h].apply(null,arguments);this._callbacks=[];this._errbacks=[]};p.prototype.resolve=p.prototype.done;p.prototype.reject=function(){if(!this._iscancelled){this.result=arguments;this._iserr=!0;for(var h=0;h<this._errbacks.length;h++)this._errbacks[h].apply(null,
arguments);this._callbacks=[];this._errbacks=[]}};p.prototype.isRejected=function(){return this._iserr};p.prototype.isFulfilled=function(){return this._isdone||this._iserr};p.prototype.isResolved=function(){return this._isdone};p.prototype.isCancelled=function(){return this._iscancelled};var l={Promise:p,join:function(h){function d(d,h){return function(){h&&(c=!0);a+=1;k[d]=Array.prototype.slice.call(arguments);a===r&&(c?l.reject():l.done(k))}}for(var l=new p,r=h.length,a=0,k=[],c=!1,t=0;r>t;t++)h[t].then(d(t,
!1),d(t,!0));return 0===h.length&&l.done(),l},chain:w};"function"==typeof define&&define.amd?define([],function(){return l}):A.promise=l}(this)},"esri/views/3d/support/AsyncQuotaRoundRobinQueue":function(){define(["../../../core/arrayUtils","../webgl-engine/lib/Util"],function(A,p){return function(w,l,h,d,u){function r(){return"workers: "+t+", queues: "+c.map(function(a){return a.length})}var a=0,k={},c=[],t=[],C=[],q=[],v=0,y=0,B;for(B in d)c[a]=[],t[a]=0,q[a]={requests:0,size:0,duration:0,speed:0},
C[a]=d[B],k[B]=a++,y+=d[B];var D=c.length,a=0;this.setWorkerQuota=function(a){p.assert(A.equals(Object.keys(this.typeWorkerAllication),Object.keys(a)));this.typeWorkerAllication=a;y=0;for(var b in a)C[k[b]]=a[b],y+=a[b]};this.setWorkerFunc=function(a){w=a};this.push=function(a){var b=k[a.clientType];y>v?(t[b]++,v++,u&&console.log("queue start type "+b+", "+r()),w(a,E)):(c[b].push(a),u&&console.log("queue push type "+b+", "+r()))};this._getStatsForType=function(a){a=k[a];return{quota:C[a],workers:t[a],
queueSize:c[a].length,requestStats:q[a]}};this.removeTasks=function(a,b){for(var d=[],h=c[k[b]],l=0;l<h.length;l++){var m=h[l];-1<a.indexOf(m)||d.push(m)}c[k[b]]=d};this.workerCancelled=function(a){b(a);a._cancelledInQueue=!0};this.clear=function(){for(var a=0;a<c.length;a++)c[a]=[]};var b=function(b){var c=k[b.clientType];t[c]--;v--;q[c].requests++;q[c].size+=b.size||0;q[c].duration+=b.duration||0;q[c].speed=0<q[c].duration?q[c].size/q[c].duration:0;p.assert(0<=t[c]);b=a;c=!1;do t[b]<C[b]&&m(b)&&
(c=!0),b=(b+1)%D;while(!c&&b!=a);if(!c){do m(b)&&(c=!0),b=(b+1)%D;while(!c&&b!=a)}!c&&u&&console.log("queue sink, "+r());a=b},m=function(a){for(;0<c[a].length;){if(w(c[a].shift(),E))return u&&console.log("queue startqueued clientType "+a+", "+r()),t[a]++,v++,!0;u&&console.log("queue task cancelled, "+r())}return!1},E=function(a){a._cancelledInQueue||(l.apply(h,arguments),b(a))}}})},"esri/views/3d/support/PreallocArray":function(){define(["../../../core/declare","./HeapSort"],function(A,p){return A([],
{constructor:function(p,l){if(this.data=Array(p),this.length=0,l){for(var h=0;p>h;h++)this.data[h]=l(h);this._allocator=l;this._hasAllocator=!0}else this._allocator=this._nullAllocator,this._hasAllocator=!1},_nullAllocator:function(){return null},grow:function(p){for(;this.data.length<p;)this.data.push(this._allocator(this.data.length))},next:function(){return this._hasAllocator?(this.data.length===this.length&&this.grow(2*this.length),this.data[this.length++]):null},swap:function(p,l){var h=this.data[p];
this.data[p]=this.data[l];this.data[l]=h},push:function(p){this.data.length===this.length&&this.grow(2*this.length);this.data[this.length++]=p},pushArray:function(p){var l=this.length+p.length;l>=this.data.length&&this.grow(Math.max(2*this.length,l));for(l=0;l<p.length;l++)this.data[this.length++]=p[l]},pushEither:function(p){Array.isArray(p)?this.pushArray(p):this.push(p)},pop:function(){if(0===this.length)return null;var p=this.data[--this.length];return this._hasAllocator||(this.data[this.length]=
null),p},slice:function(p,l){return void 0===l&&(l=this.length),this.data.slice(p,l)},clear:function(){if(!this._hasAllocator)for(var p=0;p<this.length;p++)this.data[p]=null;this.length=0},peek:function(){return 0===this.length?null:this.data[this.length-1]},sort:function(w){return p.sort(this.data,0,this.length,w),this}})})},"esri/views/3d/support/HeapSort":function(){define([],function(){function A(p,l,h,d){for(var u=l,r=h>>>1,a=p[u-1];r>=l;){l=u<<1;h>l&&0>d(p[l-1],p[l])&&++l;var k=p[l-1];if(0>=
d(k,a))break;p[u-1]=k;u=l}p[u-1]=a}function p(p,l){return l>p?-1:p>l?1:0}return{sort:function(w,l,h,d){void 0===l&&(l=0);void 0===h&&(h=w.length);void 0===d&&(d=p);for(var u=h>>>1;u>l;u--)A(w,u,h,d);for(var r=l+1,u=h-1;u>l;u--)h=w[l],w[l]=w[u],w[u]=h,A(w,r,u,d);return w}}})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["require","exports","../../../core/sniff"],function(A,p,w){var l={low:{sceneService:{"3dObject":{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},
pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5},antialiasingEnabled:!1,gpuMemoryLimit:200},high:{sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1},antialiasingEnabled:!0,gpuMemoryLimit:500}};return function(){function h(){}return h.isValidProfile=function(d){return d in l},h.getDefaultProfile=
function(){return w("trident")||w("safari")||w("esri-mobile")?"low":"high"},h.apply=function(d,h){d=l[d];h.qualitySettings.sceneService["3dObject"].lodFactor=d.sceneService["3dObject"].lodFactor;h.qualitySettings.sceneService.point.lodFactor=d.sceneService.point.lodFactor;h.qualitySettings.sceneService.integratedMesh.lodFactor=d.sceneService.integratedMesh.lodFactor;h.qualitySettings.sceneService.pointCloud.lodFactor=d.sceneService.pointCloud.lodFactor;h.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled=
d.sceneService.uncompressedTextureDownsamplingEnabled;h.qualitySettings.tiledSurface.lodBias=d.tiledSurface.lodBias;h.qualitySettings.tiledSurface.angledSplitBias=d.tiledSurface.angledSplitBias;h.qualitySettings.antialiasingEnabled=d.antialiasingEnabled;h.qualitySettings.gpuMemoryLimit=d.gpuMemoryLimit},h}()})},"esri/views/3d/support/QualitySettings":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/typescript ../../../core/Accessor".split(" "),
function(A,p,w,l,h,d){var u=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return w(c,a),l([h.property({value:1})],c.prototype,"lodFactor",void 0),c=l([h.subclass()],c)}(d),r=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return w(c,a),c.prototype.getDefaults=function(){return{"3dObject":new u,point:new u,integratedMesh:new u,pointCloud:new u,uncompressedTextureDownsamplingEnabled:!1}},l([h.property()],c.prototype,"3dObject",void 0),l([h.property()],
c.prototype,"point",void 0),l([h.property()],c.prototype,"integratedMesh",void 0),l([h.property()],c.prototype,"pointCloud",void 0),l([h.property()],c.prototype,"uncompressedTextureDownsamplingEnabled",void 0),c=l([h.subclass()],c)}(d),a=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return w(c,a),l([h.property({value:0})],c.prototype,"lodBias",void 0),l([h.property({value:1})],c.prototype,"angledSplitBias",void 0),c=l([h.subclass()],c)}(d);return function(d){function c(){return null!==
d&&d.apply(this,arguments)||this}return w(c,d),c.prototype.getDefaults=function(){return{sceneService:new r,tiledSurface:new a,antialiasingEnabled:!0}},l([h.property()],c.prototype,"sceneService",void 0),l([h.property()],c.prototype,"tiledSurface",void 0),l([h.property()],c.prototype,"antialiasingEnabled",void 0),l([h.property()],c.prototype,"gpuMemoryLimit",void 0),c=l([h.subclass()],c)}(d)})},"esri/core/accessorSupport/typescript":function(){define(["../declare","../typescript","../JSONSupport",
"dojo/_base/lang"],function(A,p,w,l){function h(d,l){if(!d)return l;if(!l)return d;for(var r in l){var a=d[r],k=l[r];Array.isArray(k)&&Array.isArray(a)?d[r]=a.concat(k):"object"==typeof k&&"object"==typeof a?d[r]=h(a,k):d[r]=k}return d}return{subclass:function(d,u){return function(r){r=p.declareDefinition(r,d);a&&(r.instanceMembers.properties=h(a,r.instanceMembers.properties));var a=r.instanceMembers.properties;if(a)for(var k in a){var c=a[k];c&&!c.reader&&c.type&&(c.type===Date?c.reader=function(a){return null!=
a?new Date(a):null}:-1!==c.type._meta.bases.indexOf(w)&&(c.reader=function(a){return function(c){return a.fromJSON(c)}}(c.type)))}return l.mixin(A(r.bases,r.instanceMembers),r.classMembers)}},shared:p.shared,property:function(d){return function(h,l){var a=Object.getPrototypeOf(h),a=a&&a.properties;h.properties&&h.properties!==a||(h.properties={});h.properties=h.properties||{};h.properties[l]=d||{}}}}})},"esri/core/typescript":function(){define(["./declare","dojo/_base/lang"],function(A,p){var w={declareDefinition:function(l,
h){var d,p=[],r=Object.getPrototypeOf(l.prototype);if(r!==Object.prototype){var a=r.constructor;d=a.prototype;p.push(a)}h&&(p=p.concat(h));h={};for(var a=Object.getOwnPropertyNames(l.prototype),k=0;k<a.length;k++){var c=a[k];if("constructor"!==c){var t=c;"dojoConstructor"===c&&(t="constructor");d&&l.prototype[c]===d[c]||(h[t]=l.prototype[c])}}a=Object.getOwnPropertyNames(l);d=Object.getOwnPropertyNames(r.constructor);r={};for(k=0;k<a.length;k++)c=a[k],-1===d.indexOf(c)&&(r[c]=l[c]);return{bases:p,
instanceMembers:h,classMembers:r}},subclass:function(l){return function(h){h=w.declareDefinition(h,l);return p.mixin(A(h.bases,h.instanceMembers),h.classMembers)}},shared:function(l){return function(h,d){h[d]=l}}};return w})},"esri/views/3d/support/SharedSymbolResources":function(){define("require exports ./TextureCollection ./ResourceController ../../../core/watchUtils ../../../core/HandleRegistry ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),function(A,p,w,l,h,d,u){Object.defineProperty(p,
"__esModule",{value:!0});A=function(){function a(a){this.streamDataSupplier=this.textures=null;this.graphicsOwners=[];this.screenSizePerspectiveHandles=null;var c=l.ClientType.SYMBOLOGY;this.viewState=a.viewState;this.stage=a.stage;this.pointsOfInterest=a.pointsOfInterest;this.resourceController=a.resourceController;this.streamDataSupplier=this.resourceController.registerClient(this,c);this.textures=new w(this.streamDataSupplier,a.stage,{preMultiplyAlpha:!0,wrapClamp:!0});this.screenSizePerspectiveSettings=
u.getSettings(a.viewingMode);this.screenSizePerspectiveSettingsLabels=u.getLabelSettings(a.viewingMode)}return a.prototype.destroy=function(){this.resourceController.deregisterClient(this);this.streamDataSupplier=this.textures=null},a.prototype.addGraphicsOwner=function(a){var c=this;this.graphicsOwners.push(a);var d=null;return a.layerView&&(d=h.init(a.layerView,"layer.screenSizePerspectiveEnabled",function(){return c.updateScreenSizePerspectiveEnabled()})),{remove:function(){d&&(d.remove(),d=null,
c.updateScreenSizePerspectiveEnabled())}}},a.prototype.updateScreenSizePerspectiveEnabled=function(){var a=this,c=this.graphicsOwners.some(function(a){return a.layerView&&!0===a.layerView.get("layer.screenSizePerspectiveEnabled")});c&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new d,c=function(){return a.updateScreenSizePerspectiveSettings()},this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",c,!0),this.pointsOfInterest.events.on("camera-parameters-changed",
c)]),this.updateScreenSizePerspectiveSettings()):!c&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)},a.prototype.updateScreenSizePerspectiveSettings=function(){r.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;r.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(r);this.screenSizePerspectiveSettingsLabels.update(r);this.stage.setNeedsRender()},a}();p.SharedSymbolResources=A;var r={distance:0,
fovY:0};p["default"]=A})},"esri/views/3d/support/TextureCollection":function(){define("../../../core/declare ../../../core/urlUtils dojo/Deferred dojo/_base/lang ../webgl-engine/Stage ../webgl-engine/lib/Texture ../webgl-engine/lib/Util".split(" "),function(A,p,w,l,h,d,u){var r=u.assert;return A(null,{constructor:function(a,d,c){this._streamDataSupplier=a;this._stage=d;this._textureRecords={};this._loadedHandler=this._loadedHandler.bind(this);this._errorHandler=this._errorHandler.bind(this);this._textureOptions=
c||{}},acquire:function(a,d,c){var k;if(k=this._textureRecords[a])return k.referenceCount++,k.texture||k.clientDfd;if(d)return c=d(a),this._stage.add(h.ModelContentType.TEXTURE,c),k={texture:c,referenceCount:1},this._textureRecords[a]=k,c;k=new w;d=this._streamDataSupplier.request(a,"image");return this._textureRecords[a]={clientDfd:k,loaderDfd:d,texture:null,size:Math.ceil(c||0),referenceCount:1},d.then(this._loadedHandler,this._errorHandler),k.promise},release:function(a){var d=this._textureRecords[a];
d?(1>d.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),d.referenceCount--,1>d.referenceCount&&(d.texture?(this._stage.remove(h.ModelContentType.TEXTURE,d.texture.getId()),d.texture=null):this._streamDataSupplier.cancelRequest(d.loaderDfd),delete this._textureRecords[a])):console.warn("TextureCollection: texture doesn't exist: "+a)},isInUse:function(a){a=this._textureRecords[a];return r(!a||0<a.referenceCount,"texture record with zero reference count"),!!a},_loadedHandler:function(a,
k,c){c=this._textureRecords[a];if(r(c&&!c.texture),p.isSVG(a)&&(c.size||0===k.width&&0===k.height)){a=k.width?k.height/k.width:1;var t=c.size||64;1<a?(k.width=Math.round(t/a),k.height=t):(k.width=t,k.height=Math.round(t*a))}a=l.mixin({width:k.width,height:k.height},this._textureOptions);k=new d(k,"symbol",a);this._stage.add(h.ModelContentType.TEXTURE,k);c.texture=k;c.clientDfd.resolve(k)},_errorHandler:function(a){a=this._textureRecords[a];r(a&&!a.texture);a.clientDfd.reject()}})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../core/HandleRegistry ../../../../core/Accessor ../../../../geometry/Point ../../lib/glMatrix ../Evented ../PropertiesPool ./CenterOnSurface ./ContentGeometryUpdates ./disposeMembers ./SurfaceGeometryUpdates ./StableSurfaceCenter ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Selector".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D){Object.defineProperty(p,"__esModule",{value:!0});A=function(p){function u(a){a=p.call(this,a)||this;return a.handles=new d,a.lastSeenCameraParameters=new B,a.surfaceAltitudeAtCenter=0,a.surfaceAltitudeAtCenterDirty=!0,a.surfaceAltitudeAtCenterWithContent=0,a.surfaceAltitudeAtCenterWithContentDirty=!0,a.propertiesPool=new c["default"]({pointOfView:r,renderPointOfView:Array},a),a.updateSurfaceAltitudeFrequentInterval=E,a.updateSurfaceAltitudeInfrequentInterval=
J,a.events=new k.Evented,a.renderPointOfView=[0,0,0],a}return w(u,p),u.prototype.initialize=function(){var a=this,b=this.view.state,c=this.view.basemapTerrain,d=this.view.renderCoordsHelper;this.surfaceSelector=new D(b.mode);b.isGlobal?this.surfaceSelector.enableBackfacesTerrain=!1:this.surfaceSelector.enableBackfacesTerrain=!0;this.surfaceSelector.enableInvisibleTerrain=!1;this.contentSelector=new D(b.mode);this.contentSelector.enableTerrain=!1;var k=this.estimateSurfaceAltitudeAtCenter.bind(this);
this._set("centerOnSurfaceInfrequent",new t["default"]({state:b,surface:c,renderCoordsHelper:d,estimateSurfaceAltitudeAtCenter:k,altitudeEstimationInterval:this.updateSurfaceAltitudeInfrequentInterval}));this._set("centerOnSurfaceFrequent",new t["default"]({state:b,surface:c,renderCoordsHelper:d,estimateSurfaceAltitudeAtCenter:k,altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));this._set("centerOnContent",new t["default"]({state:b,surface:c,renderCoordsHelper:d,estimateSurfaceAltitudeAtCenter:this.estimateSurfaceAltitudeAtCenterWithContent.bind(this),
altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));this._set("surfaceGeometryUpdates",new v["default"]({state:b,surface:c,renderCoordsHelper:d,centerOnSurfaceInstances:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new C["default"]({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:d}));this._set("surfaceOrigin",new y["default"]({view:this.view}));this.handles.add(b.watch("camera",function(b){return a.cameraChanged(b)},
!0));this.handles.add(this.surfaceGeometryUpdates.events.on("request-update",function(){return a.updateCenterPointsOfInterest()}));this.handles.add(c.watch("extent",function(){return a.updateCenterPointsOfInterest()}));this.handles.add(this.contentGeometryUpdates.events.on("request-update",function(){return a.updateCenterOnContent()}));this.cameraChanged(this.view.state.camera);this.forceUpdate()},u.prototype.destroy=function(){q["default"](this,"handles","centerOnSurfaceInfrequent","centerOnSurfaceFrequent",
"centerOnContent","surfaceOrigin","propertiesPool")},Object.defineProperty(u.prototype,"pointOfView",{get:function(){var a=this.propertiesPool.get("pointOfView");return this.view.renderCoordsHelper.fromRenderCoords(this.renderPointOfView,a,this.view.state.spatialReference),a},enumerable:!0,configurable:!0}),u.prototype.forceUpdate=function(){this.surfaceGeometryUpdates.forceUpdate();this.centerOnSurfaceInfrequent.forceUpdate();this.centerOnSurfaceFrequent.forceUpdate();this.centerOnContent.forceUpdate()},
u.prototype.hasPendingUpdates=function(){return this.surfaceGeometryUpdates.hasPendingUpdates()||this.centerOnContent.hasPendingUpdates()||this.centerOnSurfaceInfrequent.hasPendingUpdates()||this.centerOnSurfaceFrequent.hasPendingUpdates()},u.prototype.estimateSurfaceAltitudeAtCenterWithContent=function(){if(!this.surfaceAltitudeAtCenterWithContentDirty)return this.surfaceAltitudeAtCenterWithContent;this.surfaceAltitudeAtCenterWithContentDirty=!1;var a=this.view.state.camera;return this.view._stage.pickRay(a.eye,
a.center,null,null,null,!1,this.contentSelector),this.contentSelector.minResult.getIntersectionPoint(m)?this.surfaceAltitudeAtCenterWithContent=this.view.renderCoordsHelper.getAltitude(m):this.surfaceAltitudeAtCenterWithContent=this.estimateSurfaceAltitudeAtCenter(),this.surfaceAltitudeAtCenterWithContent},u.prototype.estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;if(!this.surfaceAltitudeAtCenterDirty)return this.surfaceAltitudeAtCenter;this.surfaceAltitudeAtCenterDirty=
!1;var a=this.view.state.camera;return this.surfaceSelector.init(null,a.eye,a.center,null,a,null,!1),this.view.basemapTerrain.intersect(this.surfaceSelector,a.eye,a.center),this.surfaceSelector.minResult.getIntersectionPoint(m)&&(this.surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(m)),this.surfaceAltitudeAtCenter},u.prototype.cameraChanged=function(c){this.updateCenterPointsOfInterest(c);this.cameraParametersChanged(this.lastSeenCameraParameters,c)&&(this.lastSeenCameraParameters.copyFrom(c),
b.camera=c,this.events.emit("camera-parameters-changed",b));c=c.eye;this.renderPointOfView[0]===c[0]&&this.renderPointOfView[1]===c[1]&&this.renderPointOfView[2]===c[2]||this._set("renderPointOfView",a.vec3d.set(c,this.propertiesPool.get("renderPointOfView")))},u.prototype.updateCenterPointsOfInterest=function(a){void 0===a&&(a=this.view.state.camera);this.surfaceAltitudeAtCenterWithContentDirty=this.surfaceAltitudeAtCenterDirty=!0;this.centerOnSurfaceFrequent.update(a);this.centerOnSurfaceInfrequent.update(a);
this.centerOnContent.update(a)},u.prototype.updateCenterOnContent=function(){this.surfaceAltitudeAtCenterWithContentDirty=!0;this.centerOnContent.update(this.view.state.camera)},u.prototype.cameraParametersChanged=function(a,b){return a.fov!==b.fov?!0:a.fullViewport[0]!==b.fullViewport[0]||a.fullViewport[1]!==b.fullViewport[1]||a.fullViewport[2]!==b.fullViewport[2]||a.fullViewport[3]!==b.fullViewport[3]?!0:a.padding[0]!==b.padding[0]||a.padding[1]!==b.padding[1]||a.padding[2]!==b.padding[2]||a.padding[3]!==
b.padding[3]?!0:!1},l([h.property({constructOnly:!0})],u.prototype,"updateSurfaceAltitudeFrequentInterval",void 0),l([h.property({constructOnly:!0})],u.prototype,"updateSurfaceAltitudeInfrequentInterval",void 0),l([h.property({readOnly:!0})],u.prototype,"centerOnContent",void 0),l([h.property({readOnly:!0})],u.prototype,"centerOnSurfaceFrequent",void 0),l([h.property({readOnly:!0})],u.prototype,"centerOnSurfaceInfrequent",void 0),l([h.property({readOnly:!0})],u.prototype,"surfaceOrigin",void 0),l([h.property({readOnly:!0})],
u.prototype,"contentGeometryUpdates",void 0),l([h.property({readOnly:!0})],u.prototype,"events",void 0),l([h.property({readOnly:!0,dependsOn:["renderPointOfView"]})],u.prototype,"pointOfView",null),l([h.property({readOnly:!0})],u.prototype,"renderPointOfView",void 0),l([h.property({readOnly:!0})],u.prototype,"surfaceGeometryUpdates",void 0),l([h.property({constructOnly:!0})],u.prototype,"view",void 0),u=l([h.subclass("esri.views.3d.support.PointsOfInterest")],u)}(h.declared(u));p.PointsOfInterest=
A;var b={camera:null},m=a.vec3d.create(),E=200,J=3E3;p["default"]=A})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../core/throttle ../../../../geometry/Point ../../lib/glMatrix ../earthUtils ../PropertiesPool ../mathUtils ../debugFlags ./PointOfInterest".split(" "),function(A,p,w,l,h,d,u,r,a,k,c,t,C){Object.defineProperty(p,
"__esModule",{value:!0});A=function(p){function y(a){a=p.call(this,a)||this;return a.propertiesPool=new k["default"]({location:u,renderLocation:Array},a),a.currentSurfaceAltitude=0,a.latestSurfaceAltitude=0,a.distance=0,a.renderLocation=[0,0,0],a}return w(y,p),C=y,y.prototype.initialize=function(){this.measureSurfaceAltitudeThrottle=d.throttle(this.measureSurfaceAltitude,this.altitudeEstimationInterval,this);this.handles.add(this.measureSurfaceAltitudeThrottle);this.measureSurfaceAltitude()},Object.defineProperty(y.prototype,
"location",{get:function(){var a=this.propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference),a},enumerable:!0,configurable:!0}),y.prototype.update=function(a){this.measureSurfaceAltitudeThrottle();this.updateCenterOnSurface()},y.prototype.forceUpdate=function(){this.measureSurfaceAltitudeThrottle.forceUpdate();this.updateCenterOnSurface()},y.prototype.hasPendingUpdates=function(){return this.measureSurfaceAltitudeThrottle.hasPendingUpdates()},
Object.defineProperty(y.prototype,"estimatedSurfaceAltitude",{get:function(){return this.latestSurfaceAltitude},enumerable:!0,configurable:!0}),y.prototype.measureSurfaceAltitude=function(){this.latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this.updateCenterOnSurface()},y.prototype.updateCenterOnSurface=function(){var a=q,c=this.calculateSurfaceIntersection(this.currentSurfaceAltitude,a),d=this.currentSurfaceAltitude!==this.latestSurfaceAltitude;!c&&d&&(c=this.calculateSurfaceIntersection(this.latestSurfaceAltitude,
a),c&&(this.currentSurfaceAltitude=this.latestSurfaceAltitude));d=v;(c&&this.latestSurfaceAltitudeChangesDistanceSignificantly(a,d)&&(r.vec3d.set(d,a),this.currentSurfaceAltitude=this.latestSurfaceAltitude),c)?(c=r.vec3d.dist(this.state.camera.eye,a),c!==this._get("distance")&&this._set("distance",c)):(c=this.state.camera,r.vec3d.add(r.vec3d.scale(c.viewForward,this._get("distance"),a),c.eye));c=this._get("renderLocation");c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2]||this._set("renderLocation",r.vec3d.set(a,
this.propertiesPool.get("renderLocation")))},y.prototype.calculateSurfaceIntersection=function(b,d){var k=this.state.camera;if(!this.renderCoordsHelper.intersectManifold(k.eye,k.viewForward,b,d))return!1;if(this.state.isGlobal){b=a.earthRadius+b;var h=r.vec3d.length2(k.eye),l=b*b>h,m=r.vec3d.dist(k.eye,d);if(l&&m>a.earthRadius/4)return r.vec3d.add(r.vec3d.scale(k.viewForward,b-Math.sqrt(h),d),k.eye),!0}else(k=this.surface.ready&&this.surface.extent)&&(d[0]=c.clamp(d[0],k[0],k[2]),d[1]=c.clamp(d[1],
k[1],k[3]));return!0},y.prototype.latestSurfaceAltitudeChangesDistanceSignificantly=function(a,c){if(this.latestSurfaceAltitude===this.currentSurfaceAltitude||null==a)return!1;if(this.calculateSurfaceIntersection(this.latestSurfaceAltitude,c)){var b=this.state.camera.eye;a=r.vec3d.dist(b,a);c=r.vec3d.dist(b,c);if(t.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS||Math.abs(c-a)/a>C.RELATIVE_ALTITUDE_CHANGE_THRESHOLD)return!0}return!1},y.RELATIVE_ALTITUDE_CHANGE_THRESHOLD=.05,l([h.property({constructOnly:!0})],
y.prototype,"altitudeEstimationInterval",void 0),l([h.property({readOnly:!0})],y.prototype,"distance",void 0),l([h.property({constructOnly:!0})],y.prototype,"estimateSurfaceAltitudeAtCenter",void 0),l([h.property({readOnly:!0,dependsOn:["renderLocation"]})],y.prototype,"location",null),l([h.property({readOnly:!0})],y.prototype,"renderLocation",void 0),y=C=l([h.subclass("esri.views.3d.support.CenterOnSurface")],y);var C}(h.declared(C.PointOfInterest));p.CenterOnSurface=A;var q=r.vec3d.create(),v=r.vec3d.create();
p["default"]=A})},"esri/core/throttle":function(){define(["require","exports"],function(A,p){function w(l,h,d,p){var r=null,a=1E3;"number"==typeof h?(a=h,p=d):(r=h,a=d);var k,c=0,t=function(){c=0;l.apply(p,k)};h=function(){for(var d=[],h=0;h<arguments.length;h++)d[h]=arguments[h];r&&r.apply(p,d);k=d;a?c||(c=setTimeout(t,a)):t()};return h.remove=function(){c&&(clearTimeout(c),c=0)},h.forceUpdate=function(){c&&(clearTimeout(c),t())},h.hasPendingUpdates=function(){return!!c},h}Object.defineProperty(p,
"__esModule",{value:!0});p.throttle=w;p["default"]=w})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../core/HandleRegistry ../../../../core/Accessor ./disposeMembers".split(" "),function(A,p,w,l,h,d,u,r){Object.defineProperty(p,"__esModule",{value:!0});A=function(a){function k(c){c=a.call(this)||this;return c.handles=
new d,c}return w(k,a),k.prototype.destroy=function(){r["default"](this,"handles")},l([h.property({constructOnly:!0})],k.prototype,"renderCoordsHelper",void 0),l([h.property({constructOnly:!0})],k.prototype,"surface",void 0),l([h.property({constructOnly:!0})],k.prototype,"state",void 0),k=l([h.subclass("esri.views.3d.support.PointOfInterest")],k)}(h.declared(u));p.PointOfInterest=A;p["default"]=A})},"esri/views/3d/support/pointsOfInterest/disposeMembers":function(){define(["require","exports","../../../../core/Accessor"],
function(A,p,w){function l(h){for(var d=[],l=1;l<arguments.length;l++)d[l-1]=arguments[l];if(h instanceof w&&h.destroyed)try{throw Error("instance is already destroyed");}catch(k){console.warn(k.stack)}else for(l=0;l<d.length;l++){var r=d[l];if(!(r in h))throw Error("Property '"+r+"' does not exist and cannot be disposed");var a=h[r];a&&("function"==typeof a.destroy?a.destroy():"function"==typeof a.dispose?a.dispose():"function"==typeof a.remove&&a.remove());h instanceof w&&r in h.__accessor__.metadatas?
h._set(r,null):h[r]=null}}Object.defineProperty(p,"__esModule",{value:!0});p.disposeMembers=l;p["default"]=l})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["require","exports","../../../../core/HandleRegistry","../Evented"],function(A,p,w,l){Object.defineProperty(p,"__esModule",{value:!0});A=function(){function d(d){this.handles=new w;this.events=new l.Evented;this.contentLayerViews=d.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",this.layerViewsChanged.bind(this)));
this.layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}return d.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)},d.prototype.layerViewsChanged=function(d){var h=this;d.added.forEach(function(a){"esri.views.3d.layers.SceneLayerView3D"===a.declaredClass&&h.handles.add(a.on("visible-geometry-changed",h.contentChanged.bind(h)),a.uid)});d.removed.forEach(function(a){return h.handles.remove(a.uid)})},d.prototype.contentChanged=
function(){this.events.emit("request-update",h)},d}();p.ContentGeometryUpdates=A;var h={};p["default"]=A})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("require exports ../../../../core/HandleRegistry ../../../../core/Scheduler ../../lib/glMatrix ../Evented ../aaBoundingRect ../debugFlags".split(" "),function(A,p,w,l,h,d,u,r){Object.defineProperty(p,"__esModule",{value:!0});A=function(){function h(a){var c=this;this.handles=new w;this.tileGeometryUpdateExtent=
u.create(u.NEGATIVE_INFINITY);this.tileGeometryUpdateSpatialReference=null;this.hasPendingTileGeometryChanges=!0;this.events=new d.Evented;this.centerOnSurfaceInstances=a.centerOnSurfaceInstances;this.renderCoordsHelper=a.renderCoordsHelper;this.state=a.state;this.handles.add(a.surface.on("elevation-change",function(a){return c.tileGeometryChangeHandler(a)}))}return h.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)},h.prototype.forceUpdate=function(){this.handles.has("tile-geometry-update")&&
this.updateCenterOnGeometryUpdate();this.hasPendingTileGeometryChanges&&(this.events.emit("request-update",a),this.hasPendingTileGeometryChanges=!1)},h.prototype.hasPendingUpdates=function(){return this.handles.has("tile-geometry-update")},h.prototype.tileGeometryChangeHandler=function(a){var c=this;this.tileGeometryUpdateSpatialReference=a.spatialReference;u.expand(this.tileGeometryUpdateExtent,a.tile.extent);this.handles.has("tile-geometry-update")||this.handles.add(l.schedule(function(){return c.updateCenterOnGeometryUpdate()}),
"tile-geometry-update")},h.prototype.updateCenterOnGeometryUpdate=function(){this.handles.remove("tile-geometry-update");this.centerIntersectsExtent(this.tileGeometryUpdateExtent,this.tileGeometryUpdateSpatialReference)&&(r.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES?this.hasPendingTileGeometryChanges=!0:this.events.emit("request-update",a));u.set(this.tileGeometryUpdateExtent,u.NEGATIVE_INFINITY)},h.prototype.furthestCenterOnSurface=function(){for(var a=this.centerOnSurfaceInstances[0],c=1;c<
this.centerOnSurfaceInstances.length;c++){var d=this.centerOnSurfaceInstances[c];d.distance>a.distance&&(a=d)}return a},h.prototype.centerIntersectsExtent=function(a,d){var h=this.state.camera.eye,l=t,q=this.furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(h,k,d),this.renderCoordsHelper.fromRenderCoords(q.renderLocation,c,d),k[0]<c[0]?(l[0]=k[0],l[2]=c[0]):(l[0]=c[0],l[2]=k[0]),k[1]<c[1]?(l[1]=k[1],l[3]=c[1]):(l[1]=c[1],l[3]=k[1]),u.intersects(l,a)},h}();p.SurfaceGeometryUpdates=
A;var a={},k=h.vec3d.create(),c=h.vec3d.create(),t=u.create(u.NEGATIVE_INFINITY);p["default"]=A})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/HandleRegistry ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../aaBoundingRect".split(" "),function(A,p,w,l,h,d,u,r,a,k){Object.defineProperty(p,
"__esModule",{value:!0});A=function(c){function h(a){a=c.call(this,a)||this;return a.location=null,a._updatePromise=null,a._handles=new d,a}return w(h,c),Object.defineProperty(h.prototype,"renderLocation",{get:function(){if(!this.location)return null;var a=[0,0,0];return this.view.renderCoordsHelper.toRenderCoords(this.location,a),a},enumerable:!0,configurable:!0}),h.prototype.initialize=function(){var a=this;this.view.state.isLocal&&(this._handles.add([this.watch("surfaceView.extent",function(){return a._update()}),
u.on(this,"surface.layers","change",function(){return a._update()})]),this._update())},h.prototype.destroy=function(){this._handles.destroy()},h.prototype._update=function(){var c=this;if(this._updatePromise&&(this._updatePromise.cancel("cancel"),this._updatePromise=null),!this.surfaceView||!this.surfaceView.extent)return void this._set("location",null);var d=k.center(this.surfaceView.extent),d=new a({x:d[0],y:d[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?
(this._set("location",null),this._updatePromise=this.surface.queryElevation(d,{noDataValue:0}).then(function(a){c._updatePromise=null;c._set("location",a.geometry)}).otherwise(function(a){"cancel"!==a&&console.error("StableSurfaceCenter failed to update: ",a)})):this._set("location",d)},l([r.property({constructOnly:!0})],h.prototype,"view",void 0),l([r.property({readOnly:!0,aliasOf:"view.map.ground"})],h.prototype,"surface",void 0),l([r.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],h.prototype,
"surfaceView",void 0),l([r.property({readOnly:!0})],h.prototype,"location",void 0),l([r.property({readOnly:!0,dependsOn:["location"]})],h.prototype,"renderLocation",null),h=l([r.subclass("esri.views.3d.terrain.StableSurfaceCenter")],h)}(r.declared(h));p.StableSurfaceCenter=A;p["default"]=A})},"esri/views/3d/terrain/TerrainSurface":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/ObjectPool ../../../core/Logger ../../../core/watchUtils ../../../core/HandleRegistry ../../../geometry/Point ../lib/glMatrix ../support/aaBoundingRect ../support/Evented ../support/mathUtils ../support/PreallocArray ../support/projectionUtils ../support/PromiseLightweight ../support/ResourceController ./OverlayManager ./PlanarTile ./SphericalTile ./SurfaceExtentHelper ./SurfaceTilingSchemeLogic ./TerrainConst ./TerrainRenderer ./terrainUtils ./TileGeometryFactory ./TilemapOnlyTile ./tileUtils ./tileUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E,J,G,K,M,U,N,W,R,V,Q,S,X){function z(a,e){return a[0]===e[0]&&a[1]===e[1]&&a[2]===e[2]}function Z(a){return a&&("cancel"===a||"cancel"===a.dojoType)}function O(a,e){var b=!1;e=e||a;var c=0;for(a=a.children;c<a.length;c++){var d=a[c];if(d){for(var f in d.layerInfo)for(var g in d.layerInfo[f]){var k=d.layerInfo[f][g].upsampleFromTile;if(k&&k.tile===e)return!0}b=b||O(d,e)}}return b}var g=q.vec3d,e=q.vec4d,f=q.mat4d,n=R.weakAssert,x=k.getLogger("esri.views.3d.terrain.TerrainSurface");
A=function(d){function k(){var b=d.call(this)||this;b.defaultTileBackground=N.DEFAULT_TILE_BACKGROUND;b.hideSkirtsDistanceFromExtentMargin=I;b.hideSkirtsMinimumCameraTilt=L;b._clippingExtent=null;b._dataExtent=null;b._elevationBounds=[0,0];b._rootExtent=[0,0,0,0];b._iteratorPool=new a(X.IteratorPreorder);b._postorderIterator=new X.IteratorPostorder;b.visible=!1;b.suspended=!1;b._pendingUpdates=!1;b._lvPendingUpdates=!1;b._updateNextFrame=0;b._vectorTileLayerRequests=0;b._curOverlayOpacity=1;b._curEyePos=
g.create();b._curSplitLimits=[0,0,0,0,0,0];b._curFrustumPlanes=Array(6);b._viewProjectionMatrix=f.identity();b.tilemapStats={tilemapRequestsSent:0,tilemapRequestsPending:0,tilemapRequestErrors:0,fullTilemaps:0,emptyTilemaps:0,tilesRequested:0,tileRequestsSent:0,tileRequestErrors:0,tilesNotPresent:0};b._layerViews=[[],[]];b._layerIndexByLayerViewId=[{},{}];b._basemapLayerViewHandles={};b._handles=new t;b._frameUpdateLowerPrio=new D(500);b._topLevelTilemapOnlyTiles=Array(N.TILEMAP_SIZE_EXP+1);b.loaded=
!1;b.maxTextureScale=1.2;b.rootTiles=null;for(var c=0;c<b._topLevelTilemapOnlyTiles.length;c++)b._topLevelTilemapOnlyTiles[c]=new Q([c-N.TILEMAP_SIZE_EXP,0,0]);for(c=0;6>c;c++)b._curFrustumPlanes[c]=e.create();return b}return w(k,d),k.prototype.normalizeCtorArgs=function(a,e){return this._view=a,this._stage=a._stage,this._set("manifold",e),{}},k.prototype.initialize=function(){var a=this;this.tilePool="planar"===this.manifold?G.Pool:K.Pool;this._renderer=new W(this.manifold,null,this._view.pointsOfInterest);
this._renderer.loaded=this._setLoaded.bind(this);this._renderer.updateTileBackground(this.tileBackground);this._renderer.install(this._view._stage);this._set("overlayManager",new J({terrainSurface:this,view:this._view}));this._handles.add(this.watch("overlayManager.hasHighlights",this._handleHasHighlights.bind(this)),"overlayManager");var e={layers:this._view.map.allLayers,layerViews:this._view.allLayerViews,spatialReference:this._view.spatialReference};this.extentHelper="spherical"===this.manifold?
new M.SurfaceExtentHelperGlobal(e):new M.SurfaceExtentHelperLocal(e);this._handles.add(c.init(this.extentHelper,"stencilEnabledExtents",function(e){a._renderer.setStencilEnabledLayerExtents(e)}),"extentHelper");e=this._view.defaultsFromMap?new r({root:this._view.map,rootCollectionNames:this._view.defaultsFromMap.mapCollectionPaths,getChildrenFunction:function(a){return a.layers}}):this._view.map.allLayers;e=new U({layers:e,extentHelper:this.extentHelper,manifold:this.manifold,viewSpatialReference:this._view.spatialReference});
this._set("tilingSchemeLogic",e);this._handles.add([this.tilingSchemeLogic.watch("tilingScheme",this._updateTilingSchemeAndExtent.bind(this),!0),this.tilingSchemeLogic.watch("extent",this._updateTilingSchemeAndExtent.bind(this),!0)],"tilingSchemeLogic");this._updateTilingSchemeAndExtent();this._streamDataSupplier=this._view.resourceController.registerClient(this,E.ClientType.TERRAIN);e={needsUpdate:this._needsIdleUpdate,idleFrame:this._idleUpdate};this._view.resourceController.registerFrameWorker(this._frameUpdate.bind(this));
this._view.resourceController.registerIdleFrameWorker(this,e);this._viewChangeUpdate=this._viewChangeUpdate.bind(this);this._handles.add([this._view.on("resize",this._viewChangeUpdate),this._view.watch("state.camera",this._viewChangeUpdate,!0),this._view.watch("qualitySettings.tiledSurface.lodBias",this._viewChangeUpdate),this._view.watch("clippingArea",this._clippingChanged.bind(this))],"view");this._handles.add(this._view.allLayerViews.on("change",this._handleLayerViewChanges.bind(this)),"allLayerViews");
this._handleLayerViewChanges({added:this._view.allLayerViews.toArray(),removed:[],moved:[],target:this._view.allLayerViews});this._updateClippingExtent();this.notifyChange("extent")},k.prototype.destroy=function(){this._handles.destroy();this._removeAllTiles();this.tilingSchemeLogic.destroy();this._set("tilingSchemeLogic",null);this.extentHelper.destroy();this.extentHelper=null;for(var a in this._basemapLayerViewHandles)this._unregisterTiledLayerView(a);this._view.resourceController.deregisterFrameWorker();
this._view.resourceController.deregisterIdleFrameWorker(this);this._view.resourceController.deregisterClient(this);this.overlayManager&&(this.overlayManager.destroy(),this._set("overlayManager",null));this._renderer.destroy(this._stage);this._streamDataSupplier=this._stage=this._view=this._renderer=null},Object.defineProperty(k.prototype,"cullBackFaces",{set:function(a){this._renderer.setCullBackFaces(a);this._set("cullBackFaces",a)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,
"extent",{get:function(){return this._clippingExtent||this._rootExtent},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"frontMostTransparent",{set:function(a){this._renderer.setFrontMostTransparent(a);this._set("frontMostTransparent",a)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"opacity",{set:function(a){this._renderer.setOpacity(a);this._set("opacity",a)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"ready",{get:function(){return!!this.rootTiles},
enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"renderOrder",{set:function(a){this._renderer.setRenderOrder(a);this._set("renderOrder",a)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"skirts",{set:function(a){this._renderer.setDrawSkirts(a);this._set("skirts",a)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"tileBackground",{set:function(a){a!==this.tileBackground&&this._renderer.updateTileBackground(a);this._set("tileBackground",a)},enumerable:!0,
configurable:!0}),Object.defineProperty(k.prototype,"velvetOverground",{set:function(a){a!==this.velvetOverground&&this._renderer.setVelvetOverground(a);this._set("velvetOverground",a)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"wireframe",{set:function(a){this._renderer.setWireframe(a);this._set("wireframe",a);this._view._stage.setRenderParams({earlyOcclusionPixelDraw:a})},enumerable:!0,configurable:!0}),k.prototype.setVisibility=function(a){a!==this.visible&&(this.visible=
a,this._renderer.setVisibility(a),this.setUpdatesDisabled(!a),a&&this._viewChangeUpdate())},k.prototype.isVisible=function(){return this.visible&&this.ready},k.prototype.isSeeThrough=function(){return this._renderer.isTransparent()},k.prototype.setUpdatesDisabled=function(a){(this.suspended=a)||this._viewChangeUpdate()},k.prototype.intersect=function(a,e,b){this._renderer.intersect(a,e,b)},k.prototype.getElevation=function(a){if(!this.ready)return null;var e=this.rootTiles;if(0===e[0].layerInfo[N.LayerClass.ELEVATION].length)return null;
if(a instanceof C){if(!b.pointToVector(a,ga,this.tilingScheme.spatialReference))return x.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;a=ga}for(var c,d=0;d<e.length;d++){var f=e[d];if(S.isPosWithinTile(f,a)){for(;f&&!f.renderData;)e=0,a[0]>.5*(f.extent[0]+f.extent[2])&&(e+=1),a[1]<.5*(f.extent[1]+f.extent[3])&&(e+=2),f=f.children[e];c=(e=f.renderData)&&e.geometryState?e.geometryState.samplerData:null;break}}return c?V.elevationSampler(a[0],
a[1],c):null},k.prototype.getElevationBounds=function(){return this._elevationBounds},k.prototype.getScale=function(a){if(this.tilingScheme){if(!b.pointToVector(a,ga,this.spatialReference))return x.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;if(this.rootTiles)for(var e=0;e<this.rootTiles.length;e++)if(a=this.rootTiles[e],S.isPosWithinTile(a,ga)){for(;a.children[0];)e=0,ga[0]>a.children[0].extent[2]&&(e+=1),ga[1]<a.children[0].extent[1]&&
(e+=2),a=a.children[e];return this._getLodBiasCorrectedScale(a.lij[0])}}return 1E100},k.prototype.queryVisibleScaleRange=function(a,e,b,c){e=e?this.tilingScheme.levelAtScale(e):0;b=b?this.tilingScheme.levelAtScale(b):1/0;var d=this._getLodBias();this._renderer.queryVisibleLevelRange(a,e+d,b+d,c)},k.prototype._setLoaded=function(){this.loaded||this._set("loaded",!0)},k.prototype._updateTilingSchemeAndExtent=function(){var a=this.tilingSchemeLogic.extent,e=this.tilingSchemeLogic.tilingScheme,b=!1;a&&
!v.equals(a,this._dataExtent)&&(b=!0,this._dataExtent?v.set(this._dataExtent,a):this._dataExtent=v.create(a));e!==this.tilingScheme&&(n(!!e,"tiling scheme cannot be reset to undefined"),b=!0,this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize[0]),this.overlayManager.setSpatialReference(e.spatialReference,"spherical"===this.manifold)));b&&this._updateRootTiles()},k.prototype._acquireTile=
function(a,e,b,c){var d=this.tilePool.acquire();return ia[0]=a,ia[1]=e,ia[2]=b,d.init(ia,c,this,this.tilingScheme),d},k.prototype._releaseTile=function(a){a.dispose();a.parent=null;a.parentSurface=null;this.tilePool.release(a)},k.prototype._updateRootTiles=function(){var a=this,b=this._clippingExtent||this._dataExtent,c=this.tilingScheme;if(b&&c){var d=ga,f=c.rootTilesInExtent(b,d,1/0);if(this.rootTiles){if(f.length>P)return void x.warn(N.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);var b=this.rootTiles.map(function(a){return a.lij}),
g=u.difference(b,f,z);if(0<g.removed.length||0<g.added.length){var k=this.rootTiles.filter(function(e){return-1<u.findIndex(g.removed,z.bind(null,e.lij))?(a._purgeChildTiles(e),a._purgeTile(e),!1):!0});g.added.forEach(function(e){e=a._acquireTile(0,e[1],e[2],null);k.push(e);a._loadTile(e)});this._set("rootTiles",k);this._renderer.setRootTiles(this.rootTiles)}}else f.length>P&&(x.warn(N.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),f=c.rootTilesInExtent(b,d,P)),this._set("rootTiles",f.map(function(e){e=a._acquireTile(0,
e[1],e[2],null);return a._loadTile(e),e})),this._renderer.setRootTiles(this.rootTiles);u.equals(d,this._rootExtent)||(this._rootExtent=e.create(d),this._hasFixedExtent()||this.notifyChange("extent"));this.setVisibility(!0);this._viewChangeUpdate();this.overlayManager.setOverlayDirty();this.notifyChange("ready")}},k.prototype._viewChangeUpdate=function(){this._stage&&!this.suspended&&this.tilingScheme&&this.visible&&(this._updateViewDependentParameters(),this._updateOverlayOpacity(this._curEyePos),
this._updateTiles(this.rootTiles))},k.prototype._updateTiles=function(a){var e=this._iteratorPool.acquire();e.reset(a);var b,c,d=this._curSplitLimits,f=this._curFrustumPlanes,g=this._curEyePos;for(S.hasVisibleSiblings(a)?(b=this._elevationBounds[0],c=this._elevationBounds[1]):(b=1/0,c=-(1/0));!e.done;){a=e.next();a.updateClippingStatus(this._clippingExtent);var k=!0;if(a.updateVisibility(f,g)){a.updateScreenDepth(this._viewProjectionMatrix);a.renderData&&(b=Math.min(a.elevationBounds[0],b),c=Math.max(a.elevationBounds[1],
c));var h=a.shouldSplit(d,g);h===fa.SPLIT?(a.pendingUpdates&=~fa.MERGE,a.renderData?(k=!1,a.pendingUpdates|=fa.SPLIT,e.skip()):k=!1):(a.pendingUpdates&=~fa.SPLIT,h===fa.VSPLITMERGE&&a.updateAgents(N.LayerClass.ELEVATION),e.skip())}else e.skip();if(k&&!a.renderData){a.pendingUpdates|=fa.MERGE;a.pendingUpdates&=~fa.SPLIT;k=this._iteratorPool.acquire();for(k.reset(a);!k.done;)h=k.next(),h.updateVisibility(f,g),h.visible&&h.updateScreenDepth(this._viewProjectionMatrix);this._iteratorPool.release(k)}0!==
a.pendingUpdates&&(this._pendingUpdates=!0)}this._iteratorPool.release(e);isFinite(b)&&isFinite(c)&&(this._elevationBounds[0]!==b||this._elevationBounds[1]!==c)&&(this._elevationBounds[0]=b,this._elevationBounds[1]=c,this.emit("elevation-bounds-change",null))},k.prototype._updateViewDependentParameters=function(){var a=this._view.state.camera,e=Math.tan(.5*a.fovX),b=Math.tan(.5*a.fovY),c=this.tilingScheme.pixelSize,d=Math.pow(2,-this._getLodBias());this._curSplitLimits[0]=e;this._curSplitLimits[1]=
c[0]/a.width*this.maxTextureScale*d;this._curSplitLimits[2]=b;this._curSplitLimits[3]=c[1]/a.height*this.maxTextureScale*d;this._curSplitLimits[4]=this.tilingScheme.getMaxLod();this._curSplitLimits[5]=this._view.qualitySettings.tiledSurface.angledSplitBias;a.copyFrustumPlanes(this._curFrustumPlanes);f.multiply(a.projectionMatrix,a.viewMatrix,this._viewProjectionMatrix);g.set(a.eye,this._curEyePos);R.autoUpdateSkirtsVisibility(this,this._curEyePos)},k.prototype._setLayerViewsUpdating=function(){for(var a=
0;a<N.LayerClass.LAYER_CLASS_COUNT;a++)for(var e=this._layerViews[a],b=0;b<e.length;b++)e[b]._evaluateUpdatingState(this._pendingUpdates)},k.prototype._frameUpdateTraversal=function(a){if(!this.suspended){this._frameUpdateLowerPrio.clear();var e=this._renderer.resourceCounter.numTileTexturesComposited,b=this._iteratorPool.acquire();b.reset(this.rootTiles);for(var c=!1,d=!1;!b.done&&(1<a.remaining()||!c)&&this._renderer.resourceCounter.numTileTexturesComposited-e<Y;){var f=b.next();f.pendingUpdates&
fa.MERGE?(this._mergeTile(f),f.pendingUpdates&=~fa.MERGE,c=!0,b.skip()):f.pendingUpdates&fa.SPLIT?(this._splitTile(f),f.pendingUpdates&=~fa.SPLIT,c=!0,b.skip()):0<f.pendingUpdates&&this._frameUpdateLowerPrio.push(f);0!==f.pendingUpdates&&(d=!0)}return this._pendingUpdates=d||!b.done,this._iteratorPool.release(b),c}},k.prototype._updateTileGeometry=function(a){this._renderer._updateTileGeometry(a);na.spatialReference=this.spatialReference;na.tile=a;na.extent=a.extent;this.emit("elevation-change",na)},
k.prototype._updateTileTexture=function(a){this._renderer.updateTileTexture(a)},k.prototype._frameUpdate=function(a){if(this.rootTiles){for(var e=this._frameUpdateTraversal(a);(1<a.remaining()||!e)&&0<this._frameUpdateLowerPrio.length;){var b=this._frameUpdateLowerPrio.pop();b.pendingUpdates&fa.DECODE_ELEVATION?(this._decodeElevation(b),b.pendingUpdates&=~fa.DECODE_ELEVATION,e=!0):b.pendingUpdates&fa.UPDATE_GEOMETRY?(this._renderer.updateTileGeometryNeedsUpdate(b),this._updateTileGeometry(b),e=!0,
b.pendingUpdates&=~fa.UPDATE_GEOMETRY):b.pendingUpdates&fa.UPDATE_TEXTURE&&(this._updateTileTexture(b),b.pendingUpdates&=~fa.UPDATE_TEXTURE,e=!0);0!==b.pendingUpdates&&(this._pendingUpdates=!0)}0<this._frameUpdateLowerPrio.length&&(this._pendingUpdates=!0);(this._streamDataSupplier.hasPendingDownloads()||0!==this._vectorTileLayerRequests)&&(this._pendingUpdates=!0);this._pendingUpdates!==this._lvPendingUpdates&&(this._pendingUpdates||20===++this._updateNextFrame)&&(this._setLayerViewsUpdating(),this._lvPendingUpdates=
this._pendingUpdates,this._updateNextFrame=0)}},k.prototype._needsIdleUpdate=function(){return this.isVisible()&&this.overlayManager&&this.overlayManager.overlaysNeedUpdate()},k.prototype._idleUpdate=function(){this.overlayManager.updateOverlay();this._updateOverlayOpacity(this._curEyePos)},k.prototype._updateClippingExtent=function(){if(!this.spatialReference)return!1;var a=[0,0,0,0],e=null;return b.extentToBoundingRect(this._view.clippingArea,a,this.spatialReference)&&(e=a),u.equals(e,this._clippingExtent)?
!1:(this._clippingExtent=e,this._renderer.clippingExtent=e,this.notifyChange("extent"),this.overlayManager.setOverlayDirty(),!0)},k.prototype._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()},k.prototype._getLodBias=function(){return Math.round(this._view.qualitySettings.tiledSurface.lodBias)},k.prototype._getLodBiasCorrectedScale=function(a){var e=this.tilingScheme.levels;a=B.clamp(a-this._getLodBias(),0,e.length-1);return e[a].scale},k.prototype._cancelTilemapRequests=
function(a){for(var e=0;e<N.LayerClass.LAYER_CLASS_COUNT;e++){var b=a.layerInfo[e];if(b)for(var c=0;c<b.length;c++){var d=b[c];d.tilemapRequest&&(d.tilemapRequest.cancel(),d.tilemapRequest=null)}}},k.prototype._removeAllTiles=function(){var a=this;this.rootTiles&&(this.rootTiles.forEach(function(e){a._purgeChildTiles(e);a._purgeTile(e)}),this._set("rootTiles",null),this.notifyChange("ready"));for(var e=0;e<this._topLevelTilemapOnlyTiles.length;e++)this._cancelTilemapRequests(this._topLevelTilemapOnlyTiles[e]);
this.setVisibility(!1)},k.prototype._purgeChildTiles=function(a){var e=this._postorderIterator;for(e.reset(a);!e.done;){for(var b=e.next(),c=0;4>c;c++)b.children[c]=null;b!==a&&this._purgeTile(b)}},k.prototype._purgeTile=function(a){a.unload(this._renderer);this._cancelTilemapRequests(a);a.parent=null;this._releaseTile(a)},k.prototype._splitTile=function(a){var e=a.lij[0]+1,b=2*a.lij[1],c=2*a.lij[2];a.children[0]=this._createTile(e,b,c,a);a.children[1]=this._createTile(e,b,c+1,a);a.children[2]=this._createTile(e,
b+1,c,a);a.children[3]=this._createTile(e,b+1,c+1,a);a.unload(this._renderer);ka.spatialReference=this.spatialReference;ka.extent=a.extent;ka.scale=this._getLodBiasCorrectedScale(e);this.emit("scale-change",ka)},k.prototype._createTile=function(a,e,b,c){n(!!c,"_createTile sanity check");a=this._acquireTile(a,e,b,c);if(a.updateClippingStatus(this._clippingExtent),a.updateVisibility(this._curFrustumPlanes,this._curEyePos),a.visible)a.updateScreenDepth(this._viewProjectionMatrix),a.shouldSplit(this._curSplitLimits,
this._curEyePos)===fa.SPLIT&&(a.pendingUpdates|=fa.SPLIT,this._pendingUpdates=!0);return this._loadTile(a),a},k.prototype._mergeTile=function(a){n(!a.renderData,"_mergeTile sanity check");this._loadTile(a);this._purgeChildTiles(a);ka.spatialReference=this.spatialReference;ka.extent=a.extent;ka.scale=this._getLodBiasCorrectedScale(a.lij[0]);this.emit("scale-change",ka)},k.prototype._loadTile=function(a){a.load(this._renderer);this.overlayManager&&this.overlayManager.hasOverlays()&&this.overlayManager.setOverlayParamsOfTile(a,
a.renderData,this._curOverlayOpacity);na.spatialReference=this.spatialReference;na.tile=a;na.extent=a.extent;this.emit("elevation-change",na)},k.prototype._handleHasHighlights=function(a){this._renderer.setNeedsHighlight(a)},k.prototype._decodeElevation=function(a){var e=N.LayerClass.ELEVATION,b=a.layerInfo[e];if(b)for(var c=0;c<b.length;c++){var d=b[c];if(d.pendingUpdates&=~fa.DECODE_ELEVATION,d.rawData){var f=a.decodeElevationData(d.rawData);if(d.rawData=null,f){d.data=f;var d=a.lij[0],g=this._iteratorPool.acquire();
for(g.reset(a);!g.done;){var k=g.next();k.findElevationBoundsForLayer(c,d);k.computeElevationBounds()}this._iteratorPool.release(g);a.dataArrived(c,e,f);this._updateTiles(a)}}}},k.prototype._handleLayerViewChanges=function(a){var e=this,b=!1;a.added.forEach(function(a){var c=a.layer;R.isTiledLayerView(a)?(e._registerTiledLayer(a),c.loaded&&(b=!0)):a.supportsDraping&&e.overlayManager&&e.overlayManager.registerLayerView(a)});a.removed.forEach(function(a){R.isTiledLayerView(a)?(b=!0,e._unregisterTiledLayerView(a.uid)):
a.supportsDraping&&e.overlayManager&&e.overlayManager.unregisterLayerView(a)});(b=b||0<a.moved.filter(R.isTiledLayerView).length)&&this._updateTiledLayers()},k.prototype._registerTiledLayer=function(a){var e=this,b=[];b.push(a.watch("suspended",function(){e._updateTiledLayers()}));b.push(a.watch("fullOpacity",function(){return e._updateTileTextures()}));a.on("data-changed",function(){var b=R.isElevationLayerView(a)?N.LayerClass.ELEVATION:N.LayerClass.MAP,c=e._layerIndexByLayerViewId[b][a.uid];null!=
c&&e._invalidateLayerData(c,b)});this._basemapLayerViewHandles[a.uid]=b},k.prototype._unregisterTiledLayerView=function(a){var e=this._basemapLayerViewHandles[a];if(e){for(var b=0;b<e.length;b++)e[b].remove();delete this._basemapLayerViewHandles[a]}},k.prototype._updateTiledLayers=function(){var a=this;if(this.tilingScheme){var e=this._view.allLayerViews,b=[[],[]],c=N.LayerClass,d=null,f=v.create(v.NEGATIVE_INFINITY);e.forEach(function(e){var g=e.layer;if(e.layer&&e&&!e.suspended&&R.isTiledLayerView(e)){var k=
e.fullExtent;if(k){if(!a.tilingScheme.compatibleWith(e.tileInfo))return void x.warn("Terrain: tiling scheme of layer "+g.id+" is incompatible with other tiled layers, will not be drawn");v.expand(f,k);R.isElevationLayerView(e)?b[c.ELEVATION].push(e):(e.maxDataLevel!==1/0&&(null===d||e.maxDataLevel>d)&&(d=e.maxDataLevel),b[c.MAP].push(e))}else x.warn("Terrain: Map or elevation layer does not have fullExtent: "+g.id)}},this);for(var e=function(a){var e=g._layerViews[a],d=b[a];d.reverse();var f=e.length!==
d.length,k=d.length,h=Array(k),l=Array(e.length);g._layerIndexByLayerViewId[a]={};for(var m=0;k>m;m++){g._layerIndexByLayerViewId[a][d[m].uid]=m;var n=e.indexOf(d[m]);h[m]=n;m!==n&&(f=!0);-1<n&&(l[n]=m)}if(f){g._topLevelTilemapOnlyTiles.forEach(function(e){return e.modifyLayers(l,h,a)});e=g._postorderIterator;if(g.rootTiles)for(e.reset(g.rootTiles);!e.done;)e.next().modifyLayers(l,h,a);if(g._layerViews[a]=d,g.rootTiles){for(e.reset(g.rootTiles);!e.done;)d=e.next(),d.restartAgents(a),a===c.ELEVATION&&
d.computeElevationBounds();g._updateTiles(g.rootTiles)}}},g=this,k=0;k<c.LAYER_CLASS_COUNT;k++)e(k);this.tilingScheme.levels.length-1<d&&(this.tilingScheme.ensureMaxLod(d),this._viewChangeUpdate())}},k.prototype._hasFixedExtent=function(){return!!this._clippingExtent},k.prototype.layerViewByIndex=function(a,e){return this._layerViews[e][a]},k.prototype.numLayers=function(a){return this._layerViews[a].length},k.prototype.numTotalLayers=function(){return this._layerViews.reduce(function(a,e){return e.length+
a},0)},k.prototype._updateTileTextures=function(){var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;)a.next().updateTexture();this._iteratorPool.release(a)},k.prototype._invalidateLayerData=function(a,e){var b=this._iteratorPool.acquire();for(b.reset(this.rootTiles);!b.done;)b.next().removeLayerAgent(a,e);for(b.reset(this.rootTiles);!b.done;)b.next().invalidateLayerData(a,e);this._iteratorPool.release(b)},k.prototype.requestTileData=function(a,e,b){var c=this;this.tilemapStats.tilesRequested++;
var d=this.layerViewByIndex(e,b),f=d.layer;if(f.tilemapCache){var g=this.getTilemapTile(a),k=g.layerInfo[b][e];if(!k.tilemap){k.tilemapRequest||(k.tilemapRequest=this.requestTilemap(g,e,b,d,f));var h,l=new m.Promise(function(){h&&h.cancel()});return k.tilemapRequest.always(function(){if(k.tilemapRequest=null,!l.isCancelled()){var e=c._layerIndexByLayerViewId[b][d.uid];null!=e&&(g.tileDataAvailable(a,e,b)?(h=c._requestTileData(a,e,b,d),h.then(function(){return l.resolve()})):(c.tilemapStats.tilesNotPresent++,
c._dispatchDataEvent(a,"dataMissing",b,d,{notInTilemap:!0}),l.reject()))}}),l}if(!g.tileDataAvailable(a,e,b))return this.tilemapStats.tilesNotPresent++,this._dispatchDataEvent(a,"dataMissing",b,d,{notInTilemap:!0}),e=new m.Promise,e.reject(),e}return this._requestTileData(a,e,b,d)},k.prototype._requestTileData=function(a,e,b,c){return this.tilemapStats.tileRequestsSent++,b===N.LayerClass.ELEVATION?this._requestElevationTileData(a,e,b,c):this._requestMapTileData(a,e,b,c)},k.prototype._requestElevationTileData=
function(a,e,b,c){function d(e){var d=k._layerIndexByLayerViewId[b][c.uid];null!=d?(d=a.layerInfo[b][d],d.rawData=e,a.pendingUpdates|=fa.DECODE_ELEVATION,d.pendingUpdates|=fa.DECODE_ELEVATION,k._pendingUpdates=!0):x.warn("TerrainSurface: received data from unknown layer %d %s",b,a.lij.toString())}function f(e){Z(e)||(k.tilemapStats.tileRequestErrors++,k._dispatchDataEvent(a,"dataMissing",b,c,e))}var g,k=this;R.isElevationLayerView(c)?(e=c.layer,R.useFetchTileForLayer(e)?(g=e.fetchTile(a.lij[0],a.lij[1],
a.lij[2],N.ELEVATION_NODATA_VALUE),g.then(function(a){return d(a)},f)):(e=c.getTileUrl(a.lij[0],a.lij[1],a.lij[2]),g=this._streamDataSupplier.request(e,"binary"),g.then(function(a,e){e.url=a;d(e)},f))):n(!1,"_requestElevationTileData can only be called for elevation layer views");return g},k.prototype._requestMapTileData=function(a,e,b,c){function d(e){g._dispatchDataEvent(a,"dataArrived",b,c,e)}function f(e){Z(e)||(g._dispatchDataEvent(a,"dataMissing",b,c,e),g.tilemapStats.tileRequestErrors++)}var g=
this;if(R.isVectorTileLayerView(c)){var k=c.tileHandler;e=c.schemeHelper.getCompatibleLevelRowCol(a.lij);e=k.getVectorTileWithLRC(e[0],e[1],e[2],0);e.then(d).otherwise(f).always(function(){g._vectorTileLayerRequests=k.ongoingRequestCount});this._vectorTileLayerRequests=k.ongoingRequestCount}else R.useFetchTileForLayer(c.layer)&&R.isTileLayerView(c)?(e=c.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2]),e.then(d).otherwise(f)):(e=c.getTileUrl(a.lij[0],a.lij[1],a.lij[2]),e=this._streamDataSupplier.request(e,
"image"),e.then(function(a,e){return d(e)},f));return e},k.prototype.requestTilemap=function(a,e,b,c,d){var f=this,g=a.lij[0]+N.TILEMAP_SIZE_EXP,k=a.lij[1]<<N.TILEMAP_SIZE_EXP,h=a.lij[2]<<N.TILEMAP_SIZE_EXP;return this.tilemapStats.tilemapRequestsSent++,this.tilemapStats.tilemapRequestsPending++,d.tilemapCache.fetchTilemap(g,k,h,{timeout:6E3}).then(function(d){f.tilemapStats.tilemapRequestsPending--;e=f._layerIndexByLayerViewId[b][c.uid];null!=e&&(a.layerInfo[b][e].tilemap=d)}).otherwise(function(a){f.tilemapStats.tilemapRequestsPending--;
f.tilemapStats.tilemapRequestErrors++})},k.prototype.getTilemapTile=function(a){var e=a.lij[0];return e>N.TILEMAP_SIZE_EXP?S.getTileNLevelsUp(a,N.TILEMAP_SIZE_EXP):this._topLevelTilemapOnlyTiles[e]},k.prototype._dispatchDataEvent=function(a,e,b,c,d){c=this._layerIndexByLayerViewId[b][c.uid];null!=c?a[e](c,b,d):x.warn("TerrainSurface: received data from unknown layer")},k.prototype._updateTileOverlayParams=function(){if(this.rootTiles){var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;){var e=
a.next();e.renderData&&this.overlayManager&&this.overlayManager.setOverlayParamsOfTile(e,e.renderData,this._curOverlayOpacity)}this._iteratorPool.release(a);this._renderer.setNeedsRender()}},k.prototype._updateOverlayOpacity=function(a){if(this.overlayManager&&(a=this.overlayManager.updateOpacity(a),!isNaN(a))){if(a!==this._curOverlayOpacity&&this.rootTiles){var e=this._iteratorPool.acquire();for(e.reset(this.rootTiles);!e.done;){var b=e.next();b.renderData&&b.renderData.overlayTexId&&(b.renderData.overlayOpacity=
a)}this._iteratorPool.release(e)}this._curOverlayOpacity=a;this._renderer.setNeedsRender()}},k.prototype.getStats=function(){var a=0,e=0,b=0,c=[],d=this._iteratorPool.acquire();for(d.reset(this.rootTiles);!d.done;){var f=d.next();if(a++,f.renderData&&(e++,f.visible))b++,f=f.lij[0],c[f]=null!=c[f]?c[f]+1:1}return this._iteratorPool.release(d),{numNodes:a,numLeaves:e,numVisible:b,numVisiblePerLevel:c}},k.prototype.getMemoryUsage=function(){var a=0,e=0,b=0,c=0,d=0,f=0,g=this._iteratorPool.acquire();
g.reset(this.rootTiles);for(var k=this.tilingScheme.pixelSize,k=k[0]*k[1]*4;!g.done;){var h=g.next(),l=O(h),m;for(m in h.layerInfo[N.LayerClass.MAP]){var n=h.layerInfo[N.LayerClass.MAP][m].data,q=n&&n.descriptor?1.3*n.descriptor.width*n.descriptor.height*4:0,n=n&&!n.descriptor?k:0;h.renderData||l?(a+=n,c+=q):(e+=n,d+=q)}for(m in h.layerInfo[N.LayerClass.ELEVATION])n=h.layerInfo[N.LayerClass.ELEVATION][m].data,a+=n?k:0;h.renderData&&(l=h.renderData.texture,c+=l&&l.descriptor?1.3*l.descriptor.width*
l.descriptor.height*4:0,h=h.renderData.geometryInfo.geometry,f+=h.data.estimateGpuMemoryUsage(),b+=2*h.data.getIndices("terrain").length,b+=4*h.data.getAttribute("terrain").data.length)}return this._iteratorPool.release(g),{cpuVisibleImageData:a,cpuInvisibleImageData:e,cpuGeometryData:b,gpuVisibleImageData:c,gpuInvisibleImageData:d,gpuGeometryData:f}},k.prototype.getTile=function(a){var e=a.split("/").map(function(a){return+a});if(0===e[0])return this.rootTiles.forEach(function(a){return a.lij[1]===
e[1]&&a.lij[2]===e[2]?a:void 0}),null;var b,c=Math.pow(2,e[0]),d=Math.floor(e[1]/c),f=Math.floor(e[2]/c);if(this.rootTiles.some(function(a){return a.lij[1]===d&&a.lij[2]===f?(b=a,!0):!1}),b){for(c=1<<e[0]-1;b.lij[0]<e[0];){var g=e[1]&c?2:0;if(0<(e[2]&c)&&g++,!b.children[g])return console.log("Tile "+a+" doesn't exist, smallest ancestor is "+S.tile2str(b)),null;b=b.children[g];c>>=1}return n(b.lij[0]===e[0]&&b.lij[1]===e[1]&&b.lij[2]===e[2],"not the right tile?"),b}return null},k.prototype.hasPendingUpdates=
function(){if(this._streamDataSupplier.hasPendingDownloads()||0!==this._vectorTileLayerRequests)return!0;var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;)if(0<a.next().pendingUpdates)return this._iteratorPool.release(a),!0;return this._iteratorPool.release(a),!1},k.prototype.setBorders=function(a){this._renderer.setBorders(a)},k.prototype.setDisableRendering=function(a){this._renderer.setDisableRendering(a)},l([h.property({value:!1})],k.prototype,"cullBackFaces",null),l([h.property({readOnly:!0})],
k.prototype,"extent",null),l([h.property({value:!1})],k.prototype,"frontMostTransparent",null),l([h.property({readOnly:!0})],k.prototype,"loaded",void 0),l([h.property({value:1})],k.prototype,"opacity",null),l([h.property({readOnly:!0})],k.prototype,"overlayManager",void 0),l([h.property({readOnly:!0})],k.prototype,"manifold",void 0),l([h.property()],k.prototype,"maxTextureScale",void 0),l([h.property({readOnly:!0})],k.prototype,"ready",null),l([h.property({value:1})],k.prototype,"renderOrder",null),
l([h.property({readOnly:!0})],k.prototype,"rootTiles",void 0),l([h.property({value:!0})],k.prototype,"skirts",null),l([h.property({readOnly:!0,aliasOf:"tilingScheme.spatialReference"})],k.prototype,"spatialReference",void 0),l([h.property({value:N.DEFAULT_TILE_BACKGROUND})],k.prototype,"tileBackground",null),l([h.property({readOnly:!0})],k.prototype,"tilingScheme",void 0),l([h.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],k.prototype,"tilingSchemeLocked",void 0),l([h.property({readOnly:!0,
aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],k.prototype,"tilingSchemeDone",void 0),l([h.property({readOnly:!0})],k.prototype,"tilingSchemeLogic",void 0),l([h.property({value:!0})],k.prototype,"velvetOverground",null),l([h.property({value:!1})],k.prototype,"wireframe",null),k=l([h.subclass("esri.views.3d.terrain.TerrainSurface")],k)}(h.declared(d,y.Evented));var I=1.2,L=80/180*Math.PI,P=N.MAX_ROOT_TILES,Y=12,fa=N.TileUpdateTypes,ga=e.create(),ia=[0,0,0],na={spatialReference:null,tile:null,extent:null},
ka={spatialReference:null,extent:null,scale:0};return A})},"esri/views/3d/terrain/OverlayManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/on ../../../core/Logger ../../../core/Accessor ../../../core/HandleRegistry ../../../core/accessorSupport/decorators ../../../geometry/Point ../lib/glMatrix ../state/utils/viewUtils ../support/mathUtils ../support/earthUtils ../support/projectionUtils ../support/aaBoundingRect ../support/debugFlags ../webgl-engine/Stage ../webgl-engine/lib/Texture ../webgl-engine/lib/Selector ../support/debugFlags ../../../symbols/SimpleMarkerSymbol ../../../Graphic".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E,J,G){var K,M=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]],U=d.getLogger("esri.views.3d.OverlayManager"),N=function(d){function g(){var a=null!==d&&d.apply(this,arguments)||this;return a._handles=new r,a._overlaySR=null,a._renderSR=null,a._overlaySREqualsRenderSR=!0,a._connectedLayers={},a._scale=0,a._dirty=!1,a._isSpherical=!1,a._latestOriginId=0,a.opacity=0,
a}return w(g,d),Object.defineProperty(g.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0}),g.prototype.initialize=function(){var a=this;this._stage=this.view._stage;this._renderer=this._stage.getTextureGraphicsRenderer();this._renderer.onHasHighlightsChanged=function(){return a.onHasHighlightsChanged()};this._initialEmptyTexture=new b(new Uint8Array([0,0,0,0]),"overlayEmpty",{width:1,height:1,wrapClamp:!0});this.groundSelector=new m(this.view.viewingMode);
this.groundSelector.enableBackfacesTerrain=!0;this.groundSelector.enableInvisibleTerrain=!0;this.groundSelector.enableHUDSelection=!1;this._stage.add(D.ModelContentType.TEXTURE,this._initialEmptyTexture);this._handles.add(this.view.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location"],function(){return a.setOverlayDirty()}))},g.prototype.destroy=function(){for(var a in this._connectedLayers)this.unregisterLayerView(this._connectedLayers[a].layerView);this._disposeOverlays();
this._stage.remove(D.ModelContentType.TEXTURE,this._initialEmptyTexture.getId());this._handles&&(this._handles.destroy(),this._handles=null)},g.prototype.onHasHighlightsChanged=function(){this.setOverlayDirty();this.notifyChange("hasHighlights")},g.prototype.hasOverlays=function(){return!!this._overlays},g.prototype.setSpatialReference=function(a,b){(this._overlaySR=a)?(this._renderSR=this.view.renderSpatialReference,this._overlaySREqualsRenderSR=this._overlaySR.equals(this._renderSR),this._isSpherical=
b,b?this._longitudeCyclical=a.isWebMercator?new C.Cyclical(-2.0037508342788905E7,2.0037508342788905E7):new C.Cyclical(-180,180):this._longitudeCyclical=null):(this._disposeOverlays(),this._longitudeCyclical=null)},g.prototype.registerLayerView=function(a){var e=this,b=a.layer.uid;if(this._connectedLayers[b])return void U.warn("[OverlayManager#registerLayerView]: Layer "+b+" is already connected");var c=h(a,"draped-data-change",function(){return e.setOverlayDirty()});if(this._connectedLayers[b]={eventHandles:[c],
layerView:a},a.setDrapingExtent&&this._overlays)for(b=0;b<this._overlays.length;b++)c=this._overlays[b],a.setDrapingExtent(b,c.extent,this._overlaySR,2048,c.renderLocalOrigin);this.setOverlayDirty();this._setLayerViewOverlayUpdating(a,this._dirty)},g.prototype.unregisterLayerView=function(a){for(var e in this._connectedLayers){var b=this._connectedLayers[e];if(b.layerView===a){if(b.eventHandles)for(var c=0;c<b.eventHandles.length;c++)b.eventHandles[c].remove();delete this._connectedLayers[e];this.setOverlayDirty();
a.destroyed||(a._overlayUpdating=!1,a._evaluateUpdatingState())}}},g.prototype.setOverlayDirty=function(){this._dirty||(this._setOverlayUpdating(!0),this._dirty=!0)},g.prototype._setLayerViewOverlayUpdating=function(a,b){(!b||!a.suspended&&a.hasDraped)&&(a._overlayUpdating=b,a._evaluateUpdatingState())},g.prototype._setOverlayUpdating=function(a){for(var e in this._connectedLayers)this._setLayerViewOverlayUpdating(this._connectedLayers[e].layerView,a);(e=this.view._graphicsView)&&(e._overlayUpdating=
a,e._evaluateUpdatingState())},g.prototype.updateOverlay=function(){if(this._overlaySR){var a=this._computeOverlayExtents();if(a){this._overlays||this._initOverlays();for(var b=0;b<this._overlays.length;b++){var d=this._overlays[b],g;a:{g=a[b];for(var k=d.extent,h=B.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS?0:N.EXTENTS_DIFFER_THRESHOLD*Math.max(g[2]-g[0],g[3]-g[1],k[2]-k[0],k[3]-k[1]),l=0;4>l;l++)if(Math.abs(k[l]-g[l])>h){g=!0;break a}g=!1}if(g){c.vec4d.set(a[b],d.extent);d.renderLocalOrigin={id:"OV_"+
this._latestOriginId++,vec3:y.center(d.extent,c.vec3d.create())};for(var m in this._connectedLayers)g=this._connectedLayers[m].layerView,g.setDrapingExtent&&g.setDrapingExtent(b,a[b],this._overlaySR,2048,d.renderLocalOrigin)}}this._setOverlayUpdating(!1);this._drawOverlays();this.terrainSurface._updateTileOverlayParams();this._dirty=!1}}},g.prototype.overlaysNeedUpdate=function(){return this._dirty&&!!this._overlaySR},g.prototype.updateOpacity=function(a){var e=1;if(this._overlays){var b=this._scale;
a=this.view.renderCoordsHelper.getAltitude(a);b>3.5*a&&(e=(a-b/10)/(b/3.5-b/10),e=Math.sqrt(C.clamp(e,0,1)))}return e},g.prototype.setOverlayParamsOfTile=function(a,b,d){var e=a.extent;a=this._overlayForTile(a);if(!a)return b.overlayTexId=null,void(b.highlightOverlayTexId=null);var f=a.extent;b.overlayTexScale[0]=(e[2]-e[0])/(f[2]-f[0]);b.overlayTexScale[1]=(e[3]-e[1])/(f[3]-f[1]);var g=e[0];if(this._longitudeCyclical){var g=this._longitudeCyclical.minimalMonotonic(f[0],g),k=this._longitudeCyclical.minimalMonotonic(f[0],
e[2]);g>k&&(g=k-(e[2]-e[0]))}c.vec2d.set2((g-f[0])/(f[2]-f[0]),(e[1]-f[1])/(f[3]-f[1]),b.overlayTexOffset);a.valid?b.overlayTexId=a.texture.getId():b.overlayTexId=this._initialEmptyTexture.getId();a.highlightValid?b.highlightOverlayTexId=a.highlightTexture.getId():b.highlightOverlayTexId=this._initialEmptyTexture.getId();void 0!==d?b.overlayOpacity=d:b.overlayOpacity=1},g.prototype.overlayPixelSizeInMapUnits=function(a){var e;return this._overlays&&(this._overlays[0]&&this._pointIsInExtent(a,this._overlays[0].extent)?
e=this._overlays[0].extent:this._overlays[1]&&(e=this._overlays[1].extent)),e?(e[2]-e[0])/2048:0},g.prototype._overlayForTile=function(a){var e=a.extent;a=a.clippingArea?y.intersection(e,a.clippingArea,Q):e;return this._rectInsideRect(a,this._overlays[0].extent)?this._overlays[0]:this._rectanglesOverlap(a,this._overlays[1].extent)?this._overlays[1]:null},g.prototype._createEmptyOverlay=function(){var a=new b(null,"overlay",{wrapClamp:!0,mipmap:!0});this._stage.add(D.ModelContentType.TEXTURE,a);var d=
new b(null,"highlightOverlay",{wrapClamp:!0,mipmap:!0});return this._stage.add(D.ModelContentType.TEXTURE,d),{extent:c.vec4d.create(),texture:a,valid:!1,highlightTexture:d,highlightValid:!1,renderLocalOrigin:{id:"O",vec3:[0,0,0]}}},g.prototype._initOverlays=function(){this._overlays=[this._createEmptyOverlay(),this._createEmptyOverlay()]},g.prototype._disposeOverlays=function(){if(this._overlays){var a=this._stage;this._overlays.forEach(function(e){a.remove(D.ModelContentType.TEXTURE,e.texture.getId());
a.remove(D.ModelContentType.TEXTURE,e.highlightTexture.getId())});this._overlays=null}},g.prototype._intersectGroundFromView=function(a,b,d,g){var e=c.vec3d.createFrom(b*this.view.width,d*this.view.height,1);c.vec3d.unproject(e,a.viewMatrix,a.projectionMatrix,a.fullViewport,e);b=c.vec3d.createFrom(b*this.view.width,d*this.view.height,0);return c.vec3d.unproject(b,a.viewMatrix,a.projectionMatrix,a.fullViewport,b),this.groundSelector.init([],b,e,null,a,null,!1),this.view.basemapTerrain.intersect(this.groundSelector,
b,e),this.groundSelector.minResult.getIntersectionPoint(g)},g.prototype._findHorizonBasedPointOfInterest=function(a,b,d){var e=.5;if("global"===this.view.viewingMode){e=c.vec3d.create(a.eye);c.vec3d.normalize(e);c.vec3d.negate(e);b=c.vec3d.length(b);b=Math.asin(b/c.vec3d.length(a.eye));var f=Math.acos(c.vec3d.dot(a.viewForward,e)),e=C.clamp((b-(f-.5*a.fovY))/a.fovY,0,1);b=C.clamp((-b-(f-.5*a.fovY))/a.fovY,0,1);e=1===e&&0===b?.5:b+.55*(e-b)}else e=c.mat4d.multiplyVec4(a.projectionMatrix,c.vec4d.createFrom(0,
Math.tan(.5*Math.PI-Math.acos(-a.viewForward[2])),1,0))[1],e=C.clamp(.5+.5*e,0,1),e=1===e||0===e?.5:0<a.eye[2]?.55*e:1-.55*(1-e);return this._intersectGroundFromView(a,.5,e,d)?!0:!1},g.prototype._computeOverlayExtents=function(){var a=this.view.state.camera,b=this.terrainSurface.extent,d=c.vec3d.create(),g=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;this._findHorizonBasedPointOfInterest(a,this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,d)||c.vec3d.set(g,d);
this._scale=this.view.renderCoordsHelper.getAltitude(a.eye);var h=c.vec3d.dist(a.eye,d),g=t.viewAngle(this.view.renderCoordsHelper,g,a.eye),g=Math.PI/2-Math.abs(g-Math.PI/2);if(E.OVERLAY_SHOW_CENTER){var l=new J({color:[255,0,0],outline:{color:[255,255,255],width:2}}),m=new k;v.vectorToPoint(d,this._renderSR,m,this._overlaySR);l=new G({geometry:m,symbol:l});void 0!==K&&this.view.graphics.remove(K);this.view.graphics.add(l);K=l}this._overlaySREqualsRenderSR||v.vectorToVector(d,this._renderSR,d,this._overlaySR);
l=1024*a.perPixelRatio*h*2;h=!1;m=1/0;this._isSpherical&&(this._overlaySR.isWebMercator?(l/=Math.cos(v.webMercator.y2lat(d[1])),m=this.terrainSurface.extent[3],m*=.999):(h=!0,l/=q.metersPerDegree,m=90),l>=m&&(l=m,d[1]=0,this._overlaySR.isWebMercator&&(d[0]=0)));var r=1;h&&(r=1/Math.max(.2,Math.cos(Math.abs(C.deg2rad(d[1])))),180<l*r&&(r=180/l));var p=l*r,u=X[0];u[0]=d[0]-p;u[1]=d[1]-l;u[2]=d[0]+p;u[3]=d[1]+l;this._isSpherical&&this._shiftExtentToFitBounds(u,1/0,m);h=X[1];(c.vec4d.set(u,h),6*p>b[2]-
b[0])?c.vec4d.set(b,h):g<=.25*Math.PI?(h[0]-=p,h[1]-=l,h[2]+=p,h[3]+=l):(v.vectorToVector(a.eye,this._renderSR,S,this._overlaySR),c.vec2d.subtract(d,S,Q),a=-Math.atan2(Q[1],Q[0])+.125*Math.PI,0>a&&(a+=2*Math.PI),c.vec4d.scale(M[Math.floor(a/(.25*Math.PI))],2*l,Q),Q[0]*=r,Q[2]*=r,c.vec4d.add(h,Q,h));if(this._isSpherical&&(h[0]=this._longitudeCyclical.clamp(h[0]),h[2]=this._longitudeCyclical.clamp(h[2]),h[1]=Math.max(h[1],-m),h[3]=Math.min(h[3],m)),!this._isSpherical&&b)a=y.intersection(u,b,z),b=y.intersection(h,
b,Z),y.contains(a,b)&&(h[2]=h[0],h[3]=h[1]);return this.opacity=1,X},g.prototype._drawOverlays=function(){for(var a=this._overlays[0].extent[2]-this._overlays[0].extent[0],b=this._renderer,d=0;d<this._overlays.length;d++){var g=this._overlays[d].extent,k=this._longitudeCyclical?g[2]>this._longitudeCyclical.max:!1,h=this._longitudeCyclical?g[0]<this._longitudeCyclical.min:!1;if(k||h){W.views=V;var h=void 0,h=k?this._longitudeCyclical.max-g[0]:this._longitudeCyclical.min-g[0],h=Math.round(h/(g[2]-g[0])*
2048),l=W.views[0];c.vec4d.set4(0,0,h,2048,l.viewport);c.vec4d.set4(g[0],g[1],this._longitudeCyclical.max,g[3],l.extent);k||(l.extent[0]+=this._longitudeCyclical.range);l=W.views[1];c.vec4d.set4(h,0,2048-h,2048,l.viewport);c.vec4d.set4(this._longitudeCyclical.min,g[1],g[2],g[3],l.extent);k&&(l.extent[2]-=this._longitudeCyclical.range)}else W.views=R,c.vec4d.set(g,W.views[0].extent),c.vec4d.set4(0,0,2048,2048,W.views[0].viewport);W.width=2048;W.height=2048;W.pixelRatio=a/(g[2]-g[0]);this._overlays[d].valid=
b.draw(this._overlays[d].texture,W);this._overlays[d].highlightValid=b.drawHighlights(this._overlays[d].highlightTexture,W)}},g.prototype._rectanglesOverlap=function(a,b){return this._longitudeCyclical?(this._longitudeCyclical.contains(b[0],b[2],a[0])||this._longitudeCyclical.contains(b[0],b[2],a[2])||this._longitudeCyclical.contains(a[0],a[2],b[0]))&&!(a[1]>b[3]||a[3]<b[1]):y.intersects(a,b)},g.prototype._rectInsideRect=function(a,b){return this._longitudeCyclical?this._longitudeCyclical.contains(b[0],
b[2],a[0])&&this._longitudeCyclical.contains(b[0],b[2],a[2])&&a[1]>b[1]&&a[3]<b[3]:y.contains(b,a)},g.prototype._pointIsInExtent=function(a,b){if(this._longitudeCyclical)return this._longitudeCyclical.contains(b[0],b[2],a.x)&&a.y>=b[1]&&a.y<=b[3];var e=a.x;a=a.y;return e>b[0]&&e<b[2]&&a>b[1]&&a<b[3]},g.prototype._shiftExtentToFitBounds=function(a,b,c){var e=0,d=0;a[0]<-b?e=a[0]+b:a[2]>b&&(e=b-a[2]);a[1]<-c?d=a[1]+c:a[3]>c&&(d=c-a[3]);y.offset(a,e,d)},g.EXTENTS_DIFFER_THRESHOLD=1E-5,l([a.property()],
g.prototype,"view",void 0),l([a.property()],g.prototype,"terrainSurface",void 0),l([a.property({type:Boolean})],g.prototype,"hasHighlights",null),g=l([a.subclass("esri.views.3d.terrain.OverlayManager")],g)}(a.declared(u)),W={width:0,height:0,pixelRatio:0,views:null},R=[{viewport:c.vec4d.create(),extent:c.vec4d.create()}],V=[R[0],{viewport:c.vec4d.create(),extent:c.vec4d.create()}],Q=c.vec4d.create(),S=c.vec3d.create(),X=[c.vec4d.create(),c.vec4d.create()],z=y.create(),Z=y.create();return N})},"esri/views/3d/terrain/PlanarTile":function(){define(["./TileBase",
"./TileGeometryFactory","../../../core/ObjectPool","../support/mathUtils","../lib/glMatrix"],function(A,p,w,l,h){var d=h.vec3d.createFrom(0,0,1);h=function(h,l,a,k){A.call(this);this.tileUp=d;void 0!==h&&this.init(h,l,a,k)};return h.prototype=new A,h.prototype.constructor=h,h.prototype.init=function(d,h,a,k){A.prototype.init.call(this,d,h,a,k);this.edgeLen=this.extent[2]-this.extent[0];this.curvatureHeight=0;this.centerAtSeaLevel[0]=l.lerp(this.extent[0],this.extent[2],.5);this.centerAtSeaLevel[1]=
l.lerp(this.extent[1],this.extent[3],.5);this.centerAtSeaLevel[2]=0;this.updateRadiusAndCenter()},h.prototype.updateRadiusAndCenter=function(){A.prototype.updateRadiusAndCenter.call(this);var d=(this.extent[2]-this.extent[0])*Math.SQRT1_2,h=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this.radius=Math.sqrt(d*d+h*h)},h.prototype.isVisible=function(d){if(!this.intersectsClippingArea)return!1;var h=this.extent[0],a=this.extent[1],k=this.elevationBounds[0],c=this.extent[2],l=this.extent[3],p=
this.elevationBounds[1];return 0<d[0][0]*(0<d[0][0]?h:c)+d[0][1]*(0<d[0][1]?a:l)+d[0][2]*(0<d[0][2]?k:p)+d[0][3]?!1:0<d[1][0]*(0<d[1][0]?h:c)+d[1][1]*(0<d[1][1]?a:l)+d[1][2]*(0<d[1][2]?k:p)+d[1][3]?!1:0<d[2][0]*(0<d[2][0]?h:c)+d[2][1]*(0<d[2][1]?a:l)+d[2][2]*(0<d[2][2]?k:p)+d[2][3]?!1:0<d[3][0]*(0<d[3][0]?h:c)+d[3][1]*(0<d[3][1]?a:l)+d[3][2]*(0<d[3][2]?k:p)+d[3][3]?!1:0<d[4][0]*(0<d[4][0]?h:c)+d[4][1]*(0<d[4][1]?a:l)+d[4][2]*(0<d[4][2]?k:p)+d[4][3]?!1:0<d[5][0]*(0<d[5][0]?h:c)+d[5][1]*(0<d[5][1]?
a:l)+d[5][2]*(0<d[5][2]?k:p)+d[5][3]?!1:!0},h.prototype._numSubdivisionsAtLevel=[2,2,2,2,2,2,2,2],h.prototype.createGeometry=function(d,h,a){return d.needsUpdate=!1,p.createPlanarGlobeTile(d.numVertsPerRow,this.extent,d.samplerData,h,a,d.clippingArea)},h.Pool=new w(h),h})},"esri/views/3d/terrain/TileBase":function(){define("./terrainUtils ./tileUtils ./TerrainConst ./ElevationData ./TilePerLayerInfo ./ElevationTileAgent ./MapTileAgent ../support/mathUtils ../lib/glMatrix ../../../core/arrayUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k){var c=a.vec3d,t=a.vec2d,C=a.vec4d,q=a.mat4d,v=A.weakAssert,y=c.create(),B=C.create(),D=C.create(),b=c.create(),m=u.AGENT_DONE,E=w.LayerClass.LAYER_CLASS_COUNT,J=w.LayerClass.MAP,G=w.LayerClass.ELEVATION,K=w.TileUpdateTypes;a=function(a,d,k){this.lij=[0,0,0];this.extent=C.create();this.extentWGS84Rad=C.create();this.centerAtSeaLevel=c.create();this.center=c.create();this.tileUp=b;this.elevationBounds=t.create();this.children=[null,null,null,null];this.layerInfo=Array(E);
this.intersectsClippingArea=this.isWithinClippingArea=!0;this.clippingArea=null;this._maxTesselation=0};return a.prototype.init=function(a,b,c,d){this.lij[0]=a[0];this.lij[1]=a[1];this.lij[2]=a[2];d.getExtent(a[0],a[1],a[2],this.extent,this.extentWGS84Rad);this.intersectsClippingArea=this.isWithinClippingArea=!0;this.clippingArea=null;this.radius=this.edgeLen=0;this.vlevel=a?a[0]:0;b&&b.elevationBounds?t.set(b.elevationBounds,this.elevationBounds):t.set2(0,0,this.elevationBounds);this.parent=b;for(a=
0;4>a;a++)this.children[a]=null;this.pendingUpdates=0;this.renderData=null;this.renderOrder=this.screenDepth=0;this.visible=!1;this.parentSurface=c;for(a=0;E>a;a++)if(c){var k;b=c.numLayers(a);this.layerInfo[a]?(k=this.layerInfo[a],k.length=b):(k=Array(b),this.layerInfo[a]=k);for(var l=0;b>l;l++)k[l]=h.makeEmptyLayerInfo(a,k[l]),a==G&&this.findElevationBoundsForLayer(l,-1)}else this.layerInfo[a]=null;this.computeElevationBounds();this._maxTesselation=Math.min(d.pixelSize[0],w.MAX_TILE_TESSELATION)},
a.prototype.dispose=function(){for(var a=0;E>a;a++)for(var b=this.layerInfo[a],c=0;c<b.length;c++)b[c].dispose()},a.prototype.updateScreenDepth=function(a){c.set(this.center,D);D[3]=1;q.multiplyVec4(a,D,D);this.screenDepth=D[2]/D[3]},a.prototype.shouldSplit=function(a,b){var d=this.lij[0];if(1>d)return K.SPLIT;c.subtract(this.center,b,y);var k=c.length(y),h=this.edgeLen/(a[0]*k*2),k=this.edgeLen/(a[2]*k*2),l=a[1],m=a[3],q=a[4];a=a[5];return l>h?this.vlevel!==this.lij[0]?(this.vlevel=this.lij[0],K.VSPLITMERGE):
K.NONE:d>=q?(k=d+Math.ceil(-r.log2(l/h)),k!==this.vlevel?(this.vlevel=k,K.VSPLITMERGE):K.NONE):6<d&&(c.scale(this.tileUp,c.dot(this.tileUp,y),B),c.subtract(B,y),c.length2(B)>this.radius*this.radius)&&(c.scale(B,this.radius/c.length(B)),c.add(B,this.center),c.subtract(b,B,B),b=this.elevationBounds[1]-this.elevationBounds[0],b=Math.min(1,(Math.abs(c.dot(B,this.tileUp))+.5*b+this.curvatureHeight)/c.length(B)),.1/a*m>b*k)?K.NONE:K.SPLIT},a.prototype.decodeElevationData=function(a){var b;if(a instanceof
ArrayBuffer)try{b=l.createFromLERC(this.lij,this.extent,a,w.noDataValueOpt)}catch(N){console.warn("Error decoding %s: %s",a.url,N.message)}else b=l.createFromFetchTileResult(this.lij,this.extent,a);return b},a.prototype.getWGS84Extent=function(){return this.extentWGS84Rad.map(r.rad2deg)},a.prototype.load=function(a){for(var b=0;E>b;b++)this.layerInfo[b]&&this._createOrUpdateAgents(0,b);a.loadTile(this)},a.prototype.unload=function(a){this.renderData&&a.unloadTile(this);for(a=0;E>a;a++)for(var b=this.layerInfo[a],
c=0;c<b.length;c++){var k=b[c];k.loadingAgent&&k.loadingAgent!==m&&(k.loadingAgent.dispose(),(a===w.LayerClass.ELEVATION?d:u).Pool.release(k.loadingAgent),k.loadingAgent=null);k.pendingUpdates=0}this.pendingUpdates&=~w.TileUpdateTypes.UPDATE_GEOMETRY;this.pendingUpdates&=~w.TileUpdateTypes.UPDATE_TEXTURE},a.prototype.updateClippingStatus=function(a){k.equals(a,this.clippingArea)||(a?(this.intersectsClippingArea=this.intersectsExtent(a),this.isWithinClippingArea=this.isWithinExtent(a)):(this.intersectsClippingArea=
!0,this.isWithinClippingArea=!0),this.clippingArea=a,this.renderData&&this.updateGeometry())},a.prototype.updateVisibility=function(a,b,c){a=c||this.isVisible(a,b)&&this.intersectsClippingArea;if(a!==this.visible)for(this.visible=a,b=this.layerInfo[0],c=0;c<b.length;c++){var d=b[c];d.loadingAgent&&d.loadingAgent!==m&&d.loadingAgent.setSuspension(!a)}return a},a.prototype.getLayerInfo=function(a,b){return this.layerInfo[b][a]},a.prototype.hasLayerData=function(a,b){return(a=this.layerInfo[b][a])&&
a.data&&!a.dataInvalidated},a.prototype.tileDataAvailable=function(a,b,c){return(b=this.layerInfo[c][b].tilemap)?"unavailable"!==b.getAvailability(a.lij[1],a.lij[2]):!0},a.prototype.requestLayerData=function(a,b,c){w.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d requested by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a];if(-1<d.waitingAgents.indexOf(c))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",
this.lij.toString(),c.tile.lij.toString(),b,a),!0;if(d.data&&!d.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),d.waitingAgents.push(c),setTimeout(c.dataArrived.bind(c,this),0),!0;if(d.pendingUpdates&K.DECODE_ELEVATION)return d.waitingAgents.push(c),!0;if(d.waitingAgents.push(c),!d.requestPromise){var k=this.parentSurface.requestTileData(this,a,b);if(k.isFulfilled())return!1;a=function(){d.requestPromise===
k&&(d.requestPromise=null)};return d.requestPromise=k,k.then(a,a),!!k}return!0},a.prototype.descendants=function(a){a||(a=[]);for(var b=0;4>b;b++){var c=this.children[b];c&&(c.descendants(a),a.unshift(this.children[b]))}return a},a.prototype.isLij=function(a){return this.lij[0]===a[0]&&this.lij[1]===a[1]&&this.lij[2]==a[2]},a.prototype.findByLij=function(a){if(this.isLij(a))return this;for(var b=0;4>b;b++){var c=this.children[b];if(c&&(c=c.findByLij(a)))return c}return null},a.prototype.unrequestLayerData=
function(a,b,c){w.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d canceled by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a],k=d.waitingAgents;c=k.indexOf(c);if(v(-1<c,"agent has not requested this piece of map data"),k[c]=k[k.length-1],k.length--,1>k.length)k=d.requestPromise,c=!1,b===J&&(c=this.parentSurface.layerViewByIndex(a,J),c=A.isVectorTileLayerView(c)),c||v(k||d.rawData,"no pending operations on layerInfo that agents were waiting for"),k&&!k.isFulfilled()&&
(k.cancel(),d.requestPromise=null),w.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d request/loading canceled",this.lij.toString(),b,a)},a.prototype.dataArrived=function(a,b,c){a=this.layerInfo[b][a];a.data=c;a.dataInvalidated=!1;for(c=0;c<a.waitingAgents.length;c++)a.waitingAgents[c].dataArrived(this);a.waitingAgents.length=0},a.prototype.dataMissing=function(a,b,c){c.notInTilemap||console.error("Tile %s layer %d/%d error",this.lij.toString(),b,a);a=this.layerInfo[b][a];a.dataMissing=!0;
for(b=0;b<a.waitingAgents.length;b++)a.waitingAgents[b].dataMissing(this);a.waitingAgents.length=0},a.prototype.updateTexture=function(a){this.renderData&&(a?this.parentSurface._renderer.updateTileTexture(this):(this.pendingUpdates|=w.TileUpdateTypes.UPDATE_TEXTURE,this.parentSurface._pendingUpdates=!0))},a.prototype.invalidateLayerData=function(a,b){this.layerInfo[b][a].invalidateSourceData();this.restartAgents(b)},a.prototype.computeElevationBounds=function(){t.set2(Number.MAX_VALUE,-Number.MAX_VALUE,
this.elevationBounds);for(var a=this.layerInfo[G],b=!1,c=0;c<a.length;c++){var d=a[c];d.elevationBounds&&(this.elevationBounds[0]=Math.min(this.elevationBounds[0],d.elevationBounds[0]),this.elevationBounds[1]=Math.max(this.elevationBounds[1],d.elevationBounds[1]),b=!0)}b||t.set2(0,0,this.elevationBounds);this.updateRadiusAndCenter()},a.prototype.updateRadiusAndCenter=function(){c.scale(this.tileUp,.5*(this.elevationBounds[0]+this.elevationBounds[1]),B);c.add(this.centerAtSeaLevel,B,this.center)},
a.prototype.findElevationBoundsForLayer=function(a,b){var d=this.layerInfo[G][a];if(!d.elevationBounds||d.elevationBounds[2]<b)if(b=this.parentSurface.layerViewByIndex(a,G),p.fallsWithinLayer(this,b.layer,!1)){b=!1;if(d.data)t.set(d.data.bounds,B),B[2]=this.lij[0],b=!0;else{for(var k=this.parent,h=0,l=null,m=d.data;k&&(!m||h<w.ELEVATION_DESIRED_RESOLUTION_LEVEL)&&(h=this.vlevel-k.lij[0],l=m||l,m=k.layerInfo[G][a].data,!(!m&&l&&h>=w.ELEVATION_DESIRED_RESOLUTION_LEVEL));)k=k.parent;(m=m||l)&&(m.computeMinMaxValue(this.lij[0],
this.lij[1],this.lij[2],B),B[0]!==1/0&&(B[2]=m.level,b=!0))}b&&(d.elevationBounds?c.set(B,d.elevationBounds):d.elevationBounds=[B[0],B[1],B[2]])}},a.prototype.updateGeometry=function(){this.pendingUpdates|=w.TileUpdateTypes.UPDATE_GEOMETRY;this.parentSurface._pendingUpdates=!0},a.prototype.modifyLayers=function(a,b,c){for(var k=b.length,l=this.layerInfo[c],q=Array(k),r=0;r<l.length;r++){var t=l[r];t.loadingAgent&&t.loadingAgent!==m&&(t.loadingAgent.dispose(),(c===w.LayerClass.ELEVATION?d:u).Pool.release(t.loadingAgent),
t.loadingAgent=null);t.waitingAgents.length=0}if(c===J)for(r=0;r<l.length;r++)void 0===a[r]&&l[r].dispose();for(r=0;k>r;r++)a=b[r],q[r]=-1<a?l[a]:h.makeEmptyLayerInfo(c);this.layerInfo[c]=q},a.prototype.restartAgents=function(a){if(this.renderData)if(this._createOrUpdateAgents(0,a),a===G){this.updateGeometry();a=this.layerInfo[a];for(var b=0;b<a.length;b++)a[b].pendingUpdates|=w.TileUpdateTypes.UPDATE_GEOMETRY;this.parentSurface._pendingUpdates=!0}else this.updateTexture(!0)},a.prototype.updateAgents=
function(a){if(this.renderData){for(var b=this.layerInfo[a],c=0;c<b.length;c++){var d=b[c];d.loadingAgent===m&&(d.loadingAgent=null)}this._createOrUpdateAgents(0,a)}},a.prototype.removeLayerAgent=function(a,b){a=this.layerInfo[b][a];a.loadingAgent&&a.loadingAgent!==m&&a.loadingAgent.dispose();a.loadingAgent=null},a.prototype.agentDone=function(a,b){var c=this.layerInfo[b],d=c[a];d.loadingAgent=m;d.data||d.upsampleFromTile||a<c.length-1&&this._createOrUpdateAgents(a+1,b)},a.prototype._createOrUpdateAgents=
function(a,b){var c;c=b===G?!1:!this.visible;for(var k=this.layerInfo[b];a<k.length;){var h=k[a],l=!1,q=this.parentSurface.layerViewByIndex(a,b);if(null!==h.loadingAgent&&h.loadingAgent!==m)l=h.loadingAgent.update();else if(h.loadingAgent!==m&&p.fallsWithinLayer(this,q.layer,!1)){var r=b===w.LayerClass.ELEVATION?d:u,t=r.Pool.acquire();(l=t.init(this,a,b,c))?h.loadingAgent=t:(t.dispose(),r.Pool.release(t),h.loadingAgent=m)}if(l&&!q.isTransparent)break;a++}},a.prototype.geometryState=function(a){var b,
c=this._getElevationInfo(a?a.samplerData:null),d=this.lij[0],h=!1;c.samplerData?(b=this.vlevel-d,b=Math.max(d-c.maxTileLevel,w.ELEVATION_DESIRED_RESOLUTION_LEVEL-b),d=this._maxTesselation,b=r.clamp((d>>b)+1,2,d+1)):b=8>d?this._numSubdivisionsAtLevel[d]+1:2;d=this.clippingArea;return(!this.intersectsClippingArea||this.isWithinClippingArea)&&(d=null),a?(a.numVertsPerRow!==b&&(a.numVertsPerRow=b,h=!0),c.changed&&(a.samplerData=c.samplerData,h=!0),k.equals(a.clippingArea,d)||(a.clippingArea=d,h=!0),a.needsUpdate=
h):a={numVertsPerRow:b,samplerData:c.samplerData,needsUpdate:!0,clippingArea:d},a},a.prototype._getElevationInfo=function(a){for(var b=this.layerInfo[G],c=b.length,d=Array(c),k=0,h=0,l=!1,m=0;c>m;m++){var q=b[m];if(q.upsampleFromTile){var q=q.upsampleFromTile.tile,r=q.layerInfo[G][m].data;a&&a[k]===r.samplerData||(l=!0);d[k++]=r.samplerData;h=Math.max(h,q.lij[0])}else q.data&&(r=this.parentSurface.layerViewByIndex(m,G),p.fallsWithinLayer(this,r.layer,!1)&&(a&&a[k]===q.data.samplerData||(l=!0),d[k++]=
q.data.samplerData,h=this.lij[0]))}return a&&a.length!==k&&(l=!0),0<k?d.length=k:d=null,{changed:l,samplerData:d,maxTileLevel:h}},a.prototype.isWithinExtent=function(a){var b=this.extent;return b[0]>=a[0]&&a[2]>=b[2]&&b[1]>=a[1]&&a[3]>=b[3]},a.prototype.intersectsExtent=function(a){var b=this.extent;return b[2]>=a[0]&&a[2]>=b[0]&&b[3]>=a[1]&&a[3]>=b[1]},a})},"esri/views/3d/terrain/tileUtils":function(){define(["require","exports","./UpsampleInfo","../support/PreallocArray"],function(A,p,w,l){function h(a,
d,c,l){l=d.call(c,a,l);for(var k=0;4>k;k++){var q=a.children[k];q&&h(q,d,c,l)}}function d(a,d,c){if(Array.isArray(a))for(var k=0;k<a.length;k++)u(a[k],d,c);else u(a,d,c)}function u(a,k,c){for(var h=0;4>h;h++){var l=a.children[h];l&&d(l,k,c)}k.call(c,a)}Object.defineProperty(p,"__esModule",{value:!0});A=function(){function a(a){void 0===a&&(a=100);this.q=new l(a);this._last=null;this.done=!0}return a.prototype.reset=function(a){this.q.clear();a&&this.q.pushEither(a);this._last=null;this.done=0===this.q.length},
a.prototype.skip=function(){this._last=null;0===this.q.length&&(this.done=!0)},a.prototype.next=function(){if(this.done)return null;if(null!==this._last){var a=this._last.children;if(a[0])for(var c=4;0<=c;c--){var d=a[c];d&&this.q.push(d)}this._last=null}return this._last=this.q.pop(),0!==this.q.length||this._last.children[0]||(this.done=!0),this._last},a}();p.IteratorPreorder=A;A=function(){function a(a){void 0===a&&(a=100);this.q=new l(a);this.done=!0}return a.prototype.reset=function(a){this.q.clear();
this.q.pushEither(a);for(a=0;a<this.q.length;)for(var c=this.q.data[a++],d=0;4>d;d++){var k=c.children[d];k&&this.q.push(k)}this.done=0===this.q.length},a.prototype.next=function(){var a=this.q.pop();return this.done=0===this.q.length,a},a}();p.IteratorPostorder=A;p.lij2str=function(a,d,c){return a+"/"+d+"/"+c};p.tile2str=function(a){return a.lij[0]+"/"+a.lij[1]+"/"+a.lij[2]};p.traverseTilesPreorder=function(a,d,c,l){if(Array.isArray(a))for(var k=0;k<a.length;k++)h(a[k],d,c,l);else h(a,d,c,l)};p.traverseTilesPostorder=
d;p.fallsWithinLayer=function(a,d,c){if(!d)return!1;var k=d.fullExtent,h=a.extent;if(c){if(h[0]<k.xmin||h[1]<k.ymin||h[2]>k.xmax||h[3]>k.ymax)return!1}else if(k.xmin>h[2]||k.ymin>h[3]||k.xmax<h[0]||k.ymax<h[1])return!1;a=a.parentSurface.tilingScheme.levels[a.lij[0]].scale;return 0<d.minScale&&a>1.00000001*d.minScale?!1:0<d.maxScale&&a<.99999999*d.maxScale?!1:!0};p.isPosWithinTile=function(a,d){a=a.extent;return d[0]>=a[0]&&d[1]>=a[1]&&d[0]<=a[2]&&d[1]<=a[3]};p.getTileNLevelsUp=function(a,d){for(;0<
d;)a=a.parent,d--;return a};p.nextTileInAncestry=function(a,d){var c=a.lij[0]-d.lij[0]-1,k=a.lij[2]>>c,h=0;return 1&a.lij[1]>>c&&(h+=2),1&k&&(h+=1),d.children[h]};p.computeUpsampleInfoForAncestor=function(a,d){for(var c=1,k=0,h=0;a!==d;)if(c*=.5,k*=.5,h*=.5,1&a.lij[2]&&(k+=.5),0===(1&a.lij[1])&&(h+=.5),a=a.parent,null==a)throw Error("tile was not a descendant of ancestorTile");a=w.Pool.acquire();return a.init(d,k,h,c),a};var r=[null];p.hasVisibleSiblings=function(a){var d;Array.isArray(a)?d=a:(r[0]=
a,d=r);for(a=0;a<d.length;a++){var c=d[a],h=c.parent;if(h)for(var l=0;4>l;l++){var q=h.children[l];if(q&&q!==c&&q.visible)return!0}}return!1}})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["require","exports","../lib/glMatrix","../../../core/ObjectPool"],function(A,p,w,l){var h=w.vec2d;return function(){function d(d,l,a,k){this.scale=0;this.tile=null;this.offset=h.create();void 0!==d&&this.init(d,l,a,k)}return d.prototype.init=function(d,h,a,k){this.tile=d;this.offset[0]=h;this.offset[1]=
a;this.scale=k},d.prototype.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0},d.Pool=new l(d),d}()})},"esri/views/3d/terrain/ElevationData":function(){define(["require","exports","../../../layers/support/rasterFormats/LercCodec","./TerrainConst","../support/mathUtils"],function(A,p,w,l,h){return function(){function d(d,h,a,k){this.samplerData=null;this.level=d;this.i=h;this.j=a;this.extent=k}return d.prototype.computeMinMaxValue=function(d,r,a,k){var c=1/0,t=-(1/0);d-=
this.level;var p=Math.pow(2,d);if(Math.floor(r/p)===this.i&&Math.floor(a/p)===this.j&&0<d){var q=this.samplerData.width,v=this.samplerData.pixelData,u=.5*l.ELEVATION_NODATA_VALUE;d=(q-1)/p;a=(a-this.j*p)*d;r=(r-this.i*p)*d;if(1>d){var p=Math.floor(a),w=Math.floor(r),D=p+w*q,b=v[D],m=v[D+1],E=v[D+q],D=v[D+q+1];if(u>b+m+E+D)return c=h.bilerp(b,m,E,D,a-p,r-w),t=h.bilerp(b,m,E,D,a-p+d,r-w),q=h.bilerp(b,m,E,D,a-p,r-w+d),d=h.bilerp(b,m,E,D,a-p+d,r-w+d),k[0]=Math.min(c,t,q,d),k[1]=Math.max(c,t,q,d),k;a=
p;r=w;d=1}else a=Math.floor(a),r=Math.floor(r),d=Math.ceil(d);for(p=a;a+d>=p;p++)for(w=r;r+d>=w;w++)D=p+w*q,b=v[D],u>b?(c=Math.min(c,b),t=Math.max(t,b)):(c=0<c?0:c,t=0>t?0:t)}return k[0]=c,k[1]=t,k},d.createFromLERC=function(h,l,a,k){a=w.decode(a,k);h=new d(h[0],h[1],h[2],l);h.samplerData={pixelData:a.pixelData,width:a.width,height:a.height,minValue:a.minValue,maxValue:a.maxValue,noDataValue:a.noDataValue,safeWidth:.99999999*(a.width-1),dx:(a.width-1)/(h.extent[2]-h.extent[0]),dy:(a.width-1)/(h.extent[3]-
h.extent[1]),x0:h.extent[0],y1:h.extent[3]};return h.bounds=[h.samplerData.minValue,-3E38<h.samplerData.maxValue?h.samplerData.maxValue:0],h},d.createFromFetchTileResult=function(h,l,a){h=new d(h[0],h[1],h[2],l);l=a.values;for(var k=a.noDataValue,c=1/0,r=-(1/0),p=!0,q=0;q<l.length;q++){var v=l[q];v!==k&&(c=c>v?v:c,r=v>r?v:r,p=!1)}return p&&(c=0,r=0),h.samplerData={pixelData:a.values,width:a.width,height:a.height,minValue:c,maxValue:r,noDataValue:k,safeWidth:.99999999*(a.width-1),dx:(a.width-1)/(h.extent[2]-
h.extent[0]),dy:(a.width-1)/(h.extent[3]-h.extent[1]),x0:h.extent[0],y1:h.extent[3]},h.bounds=[c,r],h},d}()})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("require exports ./TileAgentBase ./TerrainConst ./UpsampleInfo ../../webgl/Texture ../../vectorTiles/VectorTileDisplayObject".split(" "),function(A,p,w,l,h,d,u){return function(){function r(a){this.waitingAgents=[];this.rawData=this.requestPromise=this.loadingAgent=this.upsampleFromTile=this.tilemapRequest=this.tilemap=this.data=
null;this.pendingUpdates=0;this.elevationBounds=void 0;this.init(a)}return r.prototype.init=function(a){this.waitingAgents.length=0;this.data=null;this.dataInvalidated=this.dataMissing=!1;this.rawData=this.requestPromise=this.loadingAgent=this.upsampleFromTile=this.tilemapRequest=this.tilemap=null;this.pendingUpdates=0;a===l.LayerClass.ELEVATION&&(this.elevationBounds=null)},r.prototype.invalidateSourceData=function(){this.tilemap=null;this.dataInvalidated=!0;this.dataMissing=!1;this.upsampleFromTile&&
(h.Pool.release(this.upsampleFromTile),this.upsampleFromTile=null)},r.prototype.dispose=function(){this.loadingAgent&&this.loadingAgent!==w.AGENT_DONE&&(this.loadingAgent.dispose(),this.loadingAgent=null);this.requestPromise&&(this.requestPromise.cancel(),this.requestPromise=null);this.tilemap=null;this.tilemapRequest&&(this.tilemapRequest.cancel(),this.tilemapRequest=null);this.upsampleFromTile&&(h.Pool.release(this.upsampleFromTile),this.upsampleFromTile=null);this.rawData=null;this.pendingUpdates=
0;this.disposeData()},r.prototype.disposeData=function(){var a=this.data;a&&(a instanceof d?a.dispose():a instanceof u&&a.dispose(),this.data=null)},r.makeEmptyLayerInfo=function(a,d){return d?(d.init(a),d):new r(a)},r}()})},"esri/views/3d/terrain/TileAgentBase":function(){define(["require","exports","./UpsampleInfo","./tileUtils"],function(A,p,w,l){function h(l,a,k,c,t,p,q){return!l.parent||q>d?null:(c*=.5,t*=.5,p*=.5,1&l.lij[2]&&(t+=.5),0===(1&l.lij[1])&&(p+=.5),l.parent.hasLayerData(a,k))?(a=w.Pool.acquire(),
a.init(l.parent,t,p,c),a):h(l.parent,a,k,c,t,p,q+1)}var d=6,u=Error("Abstract method called on TileAgentBase");return function(){function d(){}return d.prototype.init=function(a,d,c,h){this.tile=a;this.layerIdx=d;this.layerClass=c;this.suspended=h;this._tileLayerInfo=a.getLayerInfo(d,c);this._dataRequested=null;a=this._findAncestorWithData();return a?(this._setUpsamplingTile(a.tile),w.Pool.release(a)):(this._tileLayerInfo.upsampleFromTile&&w.Pool.release(this._tileLayerInfo.upsampleFromTile),this._tileLayerInfo.upsampleFromTile=
null),this._requestNext(!0)},d.prototype.dispose=function(){this._dataRequested&&(this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this),this._dataRequested=null);this._tileLayerInfo=this.tile=null},d.prototype.setSuspension=function(a){a!==this.suspended&&(this.suspended=a,a?this._dataRequested&&(this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this),this._dataRequested=null):this._tileLayerInfo.data||this.update())},d.prototype.update=function(){var a=this._findAncestorWithData();
return a&&this._tileLayerInfo.upsampleFromTile&&a.tile!==this._tileLayerInfo.upsampleFromTile.tile?this._setUpsamplingTile(a.tile):a&&w.Pool.release(a),this._requestNext()},d.prototype.dataArrived=function(a){throw u;},d.prototype.dataMissing=function(a){this._dataRequested=null;this._tileLayerInfo.disposeData();this._requestNext()},d.prototype._agentDone=function(){this.tile.agentDone(this.layerIdx,this.layerClass);this.dispose()},d.prototype._requestNext=function(a){if(void 0===a&&(a=!1),this.suspended)return!0;
var d=this._findNextDownload();if(this._dataRequested){if(d===this._dataRequested)return!0;this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this);this._dataRequested=null}d?d.requestLayerData(this.layerIdx,this.layerClass,this)&&(this._dataRequested=d):a||this._agentDone();return!!this._dataRequested},d.prototype._findNextDownload=function(){for(var a,k=this.layerIdx,c=this.layerClass,h=this.tile.parentSurface.layerViewByIndex(k,c),r=h.minDataLevel,q=h.maxDataLevel,v=this._desiredMinLevelDelta(),
p=d.START_LOADING_LEVEL_DELTA+v,u=this._scaleRangeEnabled,w=this.tile,b=0,m=w.lij[0],E=this._tileLayerInfo.upsampleFromTile?this._tileLayerInfo.upsampleFromTile.tile.lij[0]:-1,A=this.tile.parentSurface,G=A.tilemapStats,K=A.getTilemapTile(w),M=!1;w&&(!u||l.fallsWithinLayer(w,h.layer,!1))&&w.lij[0]>=r;){var U=w.layerInfo[c][k];if(U.data&&b>=v){w.lij[0]>E&&this._setUpsamplingTile(w);U.dataInvalidated&&(a=w);break}if(K&&!K.tileDataAvailable(w,k,c))M=!0;else if(w.lij[0]<=q&&!U.data&&!U.dataMissing&&(a=
w,b>=p))break;(w=w.parent)&&K&&(K=K.parent||A.getTilemapTile(w));b++}return a&&m-a.lij[0]<v&&this._tileLayerInfo.upsampleFromTile&&(a=null),!a&&M&&G.tilesNotPresent++,a},d.prototype._findAncestorWithData=function(){return h(this.tile,this.layerIdx,this.layerClass,1,0,0,0)},d.prototype._desiredMinLevelDelta=function(){throw u;},d.prototype._setUpsamplingTile=function(a){throw u;},d.prototype._unsetUpsamplingTile=function(){this._tileLayerInfo.upsampleFromTile&&w.Pool.release(this._tileLayerInfo.upsampleFromTile);
this._tileLayerInfo.upsampleFromTile=null},d.START_LOADING_LEVEL_DELTA=4,d.AGENT_DONE=new d,d}()})},"esri/views/3d/terrain/ElevationTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TerrainConst ./TileAgentBase ./UpsampleInfo".split(" "),function(A,p,w,l,h,d,u){return function(d){function a(){var a=null!==d&&d.apply(this,arguments)||this;return a._scaleRangeEnabled=!1,a}return w(a,d),a.prototype.dataArrived=function(a){a!==this.tile?this._setUpsamplingTile(a):
(this._unsetUpsamplingTile(),this.updateGeometry());this._dataRequested=null;this._requestNext()},a.prototype.updateGeometry=function(){this._tileLayerInfo.pendingUpdates|=h.TileUpdateTypes.UPDATE_GEOMETRY;this.tile.updateGeometry()},a.prototype._findAncestorWithData=function(){for(var a,c=this.layerClass,d=this.layerIdx,l=this.tile,q=l.vlevel;l&&!(l.layerInfo[c][d].data&&(a=l,q-l.lij[0]>=h.ELEVATION_DESIRED_RESOLUTION_LEVEL));)l=l.parent;return a?(c=u.Pool.acquire(),c.init(a,0,0,1),c):null},a.prototype._desiredMinLevelDelta=
function(){return h.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-this.tile.lij[0])},a.prototype._setUpsamplingTile=function(a){this._unsetUpsamplingTile();var c=u.Pool.acquire();c.init(a,0,0,1);this._tileLayerInfo.upsampleFromTile=c;this.updateGeometry()},a.Pool=new l(a),a}(d)})},"esri/views/3d/terrain/MapTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TileAgentBase ./tileUtils".split(" "),function(A,p,w,l,h,d){return function(h){function r(){var a=
h.call(this)||this;return a._scaleRangeEnabled=!0,a}return w(r,h),r.prototype.dataArrived=function(a){a!==this.tile?this._setUpsamplingTile(a):(this._unsetUpsamplingTile(),this.tile.updateTexture());this._dataRequested=null;a!==this.tile&&this._requestNext()},r.prototype._desiredMinLevelDelta=function(){return 0},r.prototype._setUpsamplingTile=function(a){this._tileLayerInfo.upsampleFromTile&&this._tileLayerInfo.upsampleFromTile.tile===a||(this._unsetUpsamplingTile(),this._tileLayerInfo.upsampleFromTile=
d.computeUpsampleInfoForAncestor(this.tile,a),this.tile.updateTexture())},r.Pool=new l(r),r}(h)})},"esri/views/3d/terrain/TileGeometryFactory":function(){define("../webgl-engine/lib/Geometry ../webgl-engine/lib/GeometryData ../lib/glMatrix ../support/earthUtils ../support/mathUtils ./TerrainConst".split(" "),function(A,p,w,l,h,d){function u(a,b,c,d,k){a<d[0]&&(d[0]=a);a>k[0]&&(k[0]=a);b<d[1]&&(d[1]=b);b>k[1]&&(k[1]=b);c<d[2]&&(d[2]=c);c>k[2]&&(k[2]=c)}function r(a,b,c){for(var k=0;k<c.length;k++){var l=
c[k];if(l){var m=l.safeWidth,q=l.width,r=l.pixelData,t=h.clamp(l.dy*(l.y1-b),0,m),l=h.clamp(l.dx*(a-l.x0),0,m),m=Math.floor(t),v=Math.floor(l),p=m*q+v,u=p+q,y=r[p],q=r[u],p=r[p+1],r=r[u+1];if(y+q+p+r<.5*d.ELEVATION_NODATA_VALUE)return t-=m,l-=v,a=y+(p-y)*l,a+(q+(r-q)*l-a)*t}}return null}var a=l.earthRadius,k=w.vec3d,c=h.lerp,t=function(){var a,b,c,d=k.create(),h=k.create(),l=k.create();this.init=function(m,q){b=m;c=q;k.subtract(l,h,d);a=.5*k.length(d);k.lerp(h,l,.5,d)};this.getCenter=function(){return d};
this.getBSRadius=function(){return a};this.getBBMin=function(){return h};this.getBBMax=function(){return l};this.getPosition=function(){return b};this.getIndices=function(){return c};this.getPrimitiveIndices=function(){};this.getChildren=function(){}},C=function(b,c,d,k){b*=a;for(var h=0;c>=h;h++)d[5*k]=0,d[5*k+1]=0,d[5*k+2]=b,k++},q=new function(){var a=Array(50),b=0,c={};this.get=function(k){var h=c[k];h||(h={ptr:0,data:Array(50)},c[k]=h);var l;if(0<h.ptr?(d.vertexArrayHits++,l=h.data[--h.ptr],
h.data[h.ptr]=null):(d.vertexArrayMisses++,l=new Float32Array(k)),0<b)return d.geometryHits++,k=a[--b],a[b]=null,k.getData().getVertexAttr().terrain.data=l,k;d.geometryMisses++;k={};k.terrain={size:5,data:l};l=new t;return new A(new p(k,{terrain:null}),"tile",l)};this.put=function(d){var k=d.getData(),h=k.getVertexAttr(),l=h.terrain.data,m=c[l.length];50>m.ptr&&(m.data[m.ptr++]=l);h.terrain.data=null;k.indices.terrain=null;50>b&&(a[b++]=d)};var d={geometryHits:0,geometryMisses:0,vertexArrayHits:0,
vertexArrayMisses:0};this.stats=d;this._pools={geometry:a,vertexArray:c}},v=[],y=Array(d.MAX_TILE_TESSELATION+1),B=Array(d.MAX_TILE_TESSELATION+1),D=Array(d.MAX_TILE_TESSELATION+1),b=Array(d.MAX_TILE_TESSELATION+1),m={values:null,numSurfaceIndices:0,numSkirtIndices:0},E=function(a,b,c){return c||(a.values=b.values),a.numSurfaceIndices=b.numSurfaceIndices,a.numSkirtIndices=b.numSkirtIndices,a},J=function(a,b,c,d,k){var h;h=m;var l=2&c,q=b+(d?1024:0)+(l?2048:0),r=v[q];if(h||(h={}),r)h=(E(h,r),h);else{var t,
r=b-1,p=b-1,u=b*b;t=2*r+2*p;var y=r*p*6,w=6*t,g=6*(2*r+p-1);d&&(y*=2,w*=2,g*=2);t=65536<u+t?new Uint32Array(y+w):new Uint16Array(y+w);for(var e,f,n,x,C=0,B=0,D=y,G=0,K=0;p>=K;K++){l&&(G=0===K?g:K===p?-g:0);for(var D=D+G,A=0;r>=A;A++){var J=-1,M=-1;if(0===K&&(J=u+A,A!==r&&(M=C+1)),A===r&&(J=u+r+K,p>K&&(M=C+r+1)),K===p&&(J=u+r+p+(r-A),0<A&&(M=C-1)),0===A&&0<K&&(J=u+2*r+p+(p-K),M=C-(r+1)),-1<J){var U=0===A&&1===K?u:J+1;-1<M&&(e=C,f=J,n=U,x=M,d?(t[D+0]=e,t[D+1]=f,t[D+2]=f,t[D+3]=n,t[D+4]=n,t[D+5]=e,t[D+
6]=n,t[D+7]=x,t[D+8]=x,t[D+9]=e,t[D+10]=e,t[D+11]=n,D+=12):(t[D+0]=e,t[D+1]=f,t[D+2]=n,t[D+3]=n,t[D+4]=x,t[D+5]=e,D+=6))}++C;r>A&&p>K&&(e=K*(r+1)+A,f=e+1,n=f+(r+1),x=n-1,d?(t[B+0]=e,t[B+1]=f,t[B+2]=f,t[B+3]=n,t[B+4]=n,t[B+5]=e,t[B+6]=n,t[B+7]=x,t[B+8]=x,t[B+9]=e,t[B+10]=e,t[B+11]=n,B+=12):(t[B+0]=e,t[B+1]=f,t[B+2]=n,t[B+3]=n,t[B+4]=x,t[B+5]=e,B+=6))}D-=G}h=(h.values=t,h.numSurfaceIndices=y,h.numSkirtIndices=w,v[q]=E({},h),h)}l=a.getData();q=l.getAttribute("terrain");return l.indices.terrain=h.values,
a.getBoundingInfo().init(q,h.values),k||(k={}),k.geometry=a,k.numWithoutSkirtIndices=h.numSurfaceIndices+(c?6*(b-1)*(d?2:1):0),k.numVertsPerRow=b,E(k,h,!0)};return{createPlanarGlobeTile:function(a,b,c,d,h,l,m){var t,v,p=b[0],y=b[1],w=b[2]-p;b=b[3]-y;var C=.1*w,B=a-1,g=a-1,e=a*a,f=q.get(5*(e+(2*B+2*g))),n=f.getData().getVertexAttr().terrain.data,x=0;t=f.getBoundingInfo();var E=t.getBBMin(),D=t.getBBMax();k.set3(1E7,1E7,1E7,E);k.set3(-1E7,-1E7,-1E7,D);for(v=0;g>=v;v++){var G=v/g,K=y+G*b;l&&(K<l[1]?
(K=l[1],G=(K-y)/b):K>l[3]&&(K=l[3],G=(K-y)/b));for(t=0;B>=t;t++){var A=t/B,M=p+A*w;l&&(M<l[0]?(M=l[0],A=(M-p)/w):M>l[2]&&(M=l[2],A=(M-p)/w));var U=c?r(M,K,c)||0:0,M=M-d[0],R=K-d[1],U=U-d[2];u(M,R,U,E,D);n[5*x]=M;n[5*x+1]=R;n[5*x+2]=U;n[5*x+3]=A;n[5*x+4]=G;var N=-1;0===v&&(N=e+t);t===B&&(N=e+B+v);v===g&&(N=e+B+g+(B-t));0===t&&0<v&&(N=e+2*B+g+(g-v));-1<N&&(n[5*N]=M,n[5*N+1]=R,n[5*N+2]=U-C,n[5*N+3]=A,n[5*N+4]=G,u(M,R,U-C,E,D));++x}}return J(f,a,0,h,m)},createSphericalGlobeTile:function(d,h,l,m,t,v,p,
w,E){var G=l[0],K=l[1],z=l[2],A=l[3],M=Math.max(.9,1-.5*(z-G));l=d-1;var g=d-1,e=d*d,f=q.get(5*(e+(2*l+2*g))),n=f.getData().getVertexAttr().terrain.data,x=h[2]-h[0],I=h[3]-h[1],U=z-G,z=v[0],R=v[1];v=v[2];var N=f.getBoundingInfo(),W=N.getBBMin(),N=N.getBBMax();k.set3(1E7,1E7,1E7,W);k.set3(-1E7,-1E7,-1E7,N);var Q;for(Q=0;l>=Q;Q++){var V=Q/l,na=G+V*U;y[Q]=Math.sin(na);B[Q]=Math.cos(na);D[Q]=V;b[Q]=h[0]+V*x}for(G=x=0;g>=G;G++){var ka,U=G/g;Q=c(K,A,U);var na=Math.cos(Q),wa=Math.sin(Q);m?(ka=a/2*Math.log((1+
wa)/(1-wa)),U=(ka-h[1])/I):ka=180*Q/Math.PI;for(Q=0;l>=Q;Q++){var V=D[Q],ta=y[Q],sa=B[Q],aa=a;t&&(aa+=r(b[Q],ka,t)||0);var sa=sa*na*aa,ta=ta*na*aa,aa=wa*aa,ya=sa-z,la=ta-R,za=aa-v;u(ya,la,za,W,N);var oa=5*x;n[oa+0]=ya;n[oa+1]=la;n[oa+2]=za;n[oa+3]=V;n[oa+4]=U;oa=-1;if(0===G&&(oa=e+Q),Q===l&&(oa=e+l+G),G===g&&(oa=e+l+g+(l-Q)),0===Q&&0<G&&(oa=e+2*l+g+(g-G)),-1<oa)sa=sa*M-z,ta=ta*M-R,aa=aa*M-v,u(sa,ta,aa,W,N),oa*=5,n[oa+0]=sa,n[oa+1]=ta,n[oa+2]=aa,n[oa+3]=V,n[oa+4]=U;++x}}m&&(h=!!(2&p),1&p&&C(-1,l,n,
e),h&&C(1,l,n,e+l+g));return J(f,d,m?p:0,w,E)},releaseGeometry:q.put,elevationSampler:r,_geometryObjectPool:q}})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("require exports ./IdGen ./Util ./BoundingInfo ./ComponentUtils ./Util".split(" "),function(A,p,w,l,h,d,u){return function(){function r(a,d,c){this.singleUse=!1;this.componentAABB=null;this.id=r.__idGen.gen(d);this.data=a;this.boundingInfo=c}return r.prototype.getId=function(){return this.id},r.prototype.getData=function(){return this.data},
r.prototype.getComponentCount=function(){return d.componentCount(this.data.componentOffsets)},r.prototype.getComponentAABB=function(a,d){null==this.componentAABB&&(this.componentAABB=this._computeComponentAABB());for(var c=0;6>c;c++)d[c]=this.componentAABB[6*a+c];return d},r.prototype._computeComponentAABB=function(){for(var a=this.getComponentCount(),d=new Float32Array(6*a),c=0;a>c;c++)this._calculateAABB(c,d,6*c);return d},r.prototype._calculateAABB=function(a,d,c){void 0===c&&(c=0);var k=this.data.getIndices(u.VertexAttrConstants.POSITION),
h=this.data.getAttribute(u.VertexAttrConstants.POSITION),l=this.data.componentOffsets,r=l.length?l[a+1]:k.length,p=1/0,w=1/0,D=1/0,b=-(1/0),m=-(1/0),E=-(1/0),A=h.offsetIdx,G=h.strideIdx;for(a=l.length?l[a]:0;r>a;a++)var K=A+G*k[a],l=h.data[K],M=h.data[K+1],K=h.data[K+2],p=Math.min(p,l),w=Math.min(w,M),D=Math.min(D,K),b=Math.max(b,l),m=Math.max(m,M),E=Math.max(E,K);return d?(d[c]=p,d[c+1]=w,d[c+2]=D,d[c+3]=b,d[c+4]=m,d[c+5]=E):d=[p,w,D,b,m,E],d},r.prototype.calculateBoundingInfo=function(){var a=this.data.getIndices(u.VertexAttrConstants.POSITION),
d=this.data.getAttribute(u.VertexAttrConstants.POSITION),c="triangle"===this.data.primitiveType?3:1;if(0===a.length)for(var a=new Uint32Array(c),r=0;c>r;++r)a[r]=r;r=a.length;l.assert(0===r%c);for(var p=r/c,q=new Uint32Array(p),r=0;p>r;++r)q[r]=r;return new h(q,c,a,d)},r.prototype.getBoundingInfo=function(){return null==this.boundingInfo&&(this.boundingInfo=this.calculateBoundingInfo()),this.boundingInfo},r.prototype.invalidateBoundingInfo=function(){this.boundingInfo=null},r.__idGen=new w,r}()})},
"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["require","exports","./Util","./gl-matrix"],function(A,p,w,l){var h=l.vec3d;return function(){function d(d,l,a,k){w.assert(1<=d.length);w.assert(0===a.length%l);w.assert(a.length>=d.length*l);w.assert(3===k.size||4===k.size);this.primitiveIndices=d;this.indices=a;this._position=k;this._numIndexPerPrimitive=l;var c=k.data,r=k.offsetIdx;k=k.strideIdx;var p=d.length,q=r+k*a[l*d[0]];this.bbMin=h.createFrom(c[q],c[q+1],c[q+2]);this.bbMax=
h.create(this.bbMin);for(var v=0;p>v;++v)for(var u=l*d[v],B=0;l>B;++B)for(var q=r+k*a[u+B],D=0;3>D;++D){var b=c[q+D];b<this.bbMin[D]?this.bbMin[D]=b:b>this.bbMax[D]&&(this.bbMax[D]=b)}this.center=h.create();h.lerp(this.bbMin,this.bbMax,.5,this.center);for(v=this.bsRadius=0;p>v;++v)for(u=l*d[v],B=0;l>B;++B)q=r+k*a[u+B],D=c[q]-this.center[0],b=c[q+1]-this.center[1],q=c[q+2]-this.center[2],q=D*D+b*b+q*q,q>this.bsRadius&&(this.bsRadius=q);this.bsRadius=Math.sqrt(this.bsRadius)}return d.prototype.getCenter=
function(){return this.center},d.prototype.getBSRadius=function(){return this.bsRadius},d.prototype.getBBMin=function(){return this.bbMin},d.prototype.getBBMax=function(){return this.bbMax},d.prototype.getPrimitiveIndices=function(){return this.primitiveIndices},d.prototype.getIndices=function(){return this.indices},d.prototype.getPosition=function(){return this._position},d.prototype.getChildren=function(){if(this.children)return this.children;if(1<h.dist2(this.bbMin,this.bbMax)){for(var l=h.lerp(this.bbMin,
this.bbMax,.5,h.create()),r=this.primitiveIndices.length,a=new Uint8Array(r),k=Array(8),c=0;8>c;++c)k[c]=0;for(var c=this._position,t=c.data,p=c.offsetIdx,q=c.strideIdx,c=0;r>c;++c){for(var v=0,y=this._numIndexPerPrimitive*this.primitiveIndices[c],w=p+q*this.indices[y],D=t[w],b=t[w+1],m=t[w+2],E=1;E<this._numIndexPerPrimitive;++E){var w=p+q*this.indices[y+E],A=t[w],G=t[w+1],w=t[w+2];D>A&&(D=A);b>G&&(b=G);m>w&&(m=w)}D<l[0]&&(v|=1);b<l[1]&&(v|=2);m<l[2]&&(v|=4);a[c]=v;++k[v]}for(c=l=0;8>c;++c)0<k[c]&&
++l;if(2>l)return;l=Array(8);for(c=0;8>c;++c)l[c]=0<k[c]?new Uint32Array(k[c]):void 0;for(c=0;8>c;++c)k[c]=0;for(c=0;r>c;++c)v=a[c],l[v][k[v]++]=this.primitiveIndices[c];this.children=Array(8);for(c=0;8>c;++c)void 0!==l[c]&&(this.children[c]=new d(l[c],this._numIndexPerPrimitive,this.indices,this._position))}return this.children},d}()})},"esri/views/3d/terrain/SphericalTile":function(){define("./TileBase ./TileGeometryFactory ../../../core/ObjectPool ../support/mathUtils ../support/earthUtils ../lib/glMatrix".split(" "),
function(A,p,w,l,h,d){var u=d.vec3d,r=h.earthRadius,a=function(a,c,d,h){d=r+d;var k=Math.cos(a);h[0]=Math.cos(c)*k*d;h[1]=Math.sin(c)*k*d;h[2]=Math.sin(a)*d};h=function(a,c,d,h){A.call(this);this.tileUp=u.create();this.obb=Array(8);this._isWebMercator=!1;for(var k=0;8>k;k++)this.obb[k]=u.create();void 0!==a&&this.init(a,c,d,h)};return h.prototype=new A,h.prototype.constructor=h,h.prototype.init=function(d,c,h,p){A.prototype.init.call(this,d,c,h,p);this._isWebMercator=p.spatialReference.isWebMercator;
c=this.extentWGS84Rad[0];h=this.extentWGS84Rad[1];p=this.extentWGS84Rad[2];var k=this.extentWGS84Rad[3];d=d[0];var t=l.lerp(h,k,.5),y=l.lerp(c,p,.5);this.edgeLen=(p-c)*Math.cos(0===d?0:Math.min(Math.abs(h),Math.abs(k)))*r;this.curvatureHeight=r-Math.sqrt(r*r-this.edgeLen*this.edgeLen/4);a(t,y,0,this.centerAtSeaLevel);u.set(this.centerAtSeaLevel,this.tileUp);u.normalize(this.tileUp);this._updateOBB();this.updateRadiusAndCenter()},h.prototype.isVisible=function(a,c){if(!this.intersectsClippingArea)return!1;
if(9<this.lij[0]){c=this.obb;for(var d=0;6>d;d++){for(var k=0;8>k&&!(0>a[d][0]*c[k][0]+a[d][1]*c[k][1]+a[d][2]*c[k][2]+a[d][3]);k++);if(8===k)return!1}}else if(c=this.radius,d=this.center,a[0][0]*d[0]+a[0][1]*d[1]+a[0][2]*d[2]+a[0][3]>c||a[1][0]*d[0]+a[1][1]*d[1]+a[1][2]*d[2]+a[1][3]>c||a[2][0]*d[0]+a[2][1]*d[1]+a[2][2]*d[2]+a[2][3]>c||a[3][0]*d[0]+a[3][1]*d[1]+a[3][2]*d[2]+a[3][3]>c||a[4][0]*d[0]+a[4][1]*d[1]+a[4][2]*d[2]+a[4][3]>c||a[5][0]*d[0]+a[5][1]*d[1]+a[5][2]*d[2]+a[5][3]>c)return!1;return!0},
h.prototype.computeElevationBounds=function(){A.prototype.computeElevationBounds.call(this);this._updateOBB()},h.prototype.updateRadiusAndCenter=function(){if(0===this.lij[0])u.set3(0,0,0,this.center),this.radius=r+this.elevationBounds[1];else{A.prototype.updateRadiusAndCenter.call(this);var a=Math.max(u.dist2(this.center,this.obb[0]),u.dist2(this.center,this.obb[1]));this.radius=Math.sqrt(a)}},h.prototype._numSubdivisionsAtLevel=[128,64,32,16,16,8,8,4],h.prototype.createGeometry=function(a,c,d){var k=
this._isPole(this.lij[1],this.lij[0]);return a.needsUpdate=!1,p.createSphericalGlobeTile(a.numVertsPerRow,this.extent,this.extentWGS84Rad,this._isWebMercator,a.samplerData,c,k,d)},h.prototype._updateOBB=function(){var d,c=this.extentWGS84Rad,h=this.obb;for(d=0;2>d;d++){var l=this.elevationBounds[d],q=4*d;a(c[1],c[0],l,h[q++]);a(c[3],c[0],l,h[q++]);a(c[3],c[2],l,h[q++]);a(c[1],c[2],l,h[q++])}this._isWebMercator&&(d=this._isPole(this.lij[1],this.lij[0]),2===d?(u.set3(0,0,r,h[1]),u.set3(0,0,r,h[2]),
u.set3(0,0,r,h[5]),u.set3(0,0,r,h[6])):1===d&&(u.set3(0,0,-r,h[0]),u.set3(0,0,-r,h[3]),u.set3(0,0,-r,h[4]),u.set3(0,0,-r,h[7])))},h.prototype._isPole=function(a,c){var d=0;return a===(1<<c)-1&&(d+=1),0===a&&(d+=2),d},h.Pool=new w(h),h})},"esri/views/3d/terrain/SurfaceExtentHelper":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../core/arrayUtils ../../../core/HandleRegistry ../../../geometry/support/webMercatorUtils ../../../views/3d/support/aaBoundingRect ./terrainUtils ./TerrainConst".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t){function C(c,d){return c&&!c.spatialReference.equals(d)&&(c=a.canProject(c.spatialReference,d)?a.project(c,d):null),c}Object.defineProperty(p,"__esModule",{value:!0});A=function(a){function c(c){c=a.call(this,c)||this;return c._changeListeners=new r,c}return w(c,a),c.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layerViews.on("change",function(){return a.notifyChange("stencilEnabledExtents")})])},c.prototype.destroy=function(){this._changeListeners.destroy();
this._changeListeners=null},Object.defineProperty(c.prototype,"layerViewsExtent",{get:function(){return this._computeLayerViewsExtent()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"tiledLayersExtent",{get:function(){return this._computeTiledLayersExtent()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"stencilEnabledExtents",{get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,
"spatialReference",{set:function(a){this.tilingScheme||this._set("spatialReference",a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"tilingScheme",{set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)},enumerable:!0,configurable:!0}),c.prototype._computeStencilEnabledExtents=function(a,c){var d=[],b=0;for(a=a.items;b<a.length;b++){var k=a[b].layer;"IntegratedMeshLayer"===k.operationalLayerType&&null!=c&&(k=C(k.fullExtent,c),null!=k&&d.push([k.xmin,
k.ymin,k.xmax,k.ymax]))}return d},l([h.property({readOnly:!0})],c.prototype,"layerViewsExtent",null),l([h.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],c.prototype,"tiledLayersExtent",null),l([h.property({readOnly:!0,dependsOn:["spatialReference"]})],c.prototype,"stencilEnabledExtents",null),l([h.property()],c.prototype,"spatialReference",null),l([h.property()],c.prototype,"tilingScheme",null),l([h.property()],c.prototype,"defaultTiledLayersExtent",void 0),l([h.property({constructOnly:!0})],
c.prototype,"layers",void 0),l([h.property({constructOnly:!0})],c.prototype,"layerViews",void 0),c=l([h.subclass()],c)}(h.declared(d));d=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return w(c,a),c.prototype._computeLayerViewsExtent=function(){return this._getGlobalExtent()},c.prototype._computeTiledLayersExtent=function(){return this._getGlobalExtent()},c.prototype._getGlobalExtent=function(){return this.spatialReference.isWebMercator?t.WEBMERCATOR_WORLD_EXTENT:t.GEOGRAPHIC_WORLD_EXTENT},
l([h.property({dependsOn:["spatialReference"]})],c.prototype,"layerViewsExtent",void 0),c=l([h.subclass()],c)}(h.declared(A));p.SurfaceExtentHelperGlobal=d;A=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}return w(d,a),d.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layers.on("change",function(){return a.notifyChange("tiledLayersExtent")}),this.layerViews.on("change",function(){return a.notifyChange("layerViewsExtent")})])},d.prototype._computeLayerViewsExtent=
function(){var a=k.create(k.NEGATIVE_INFINITY),c=this.spatialReference;this.layerViews.forEach(function(b){b.isResolved()&&(b=b.fullExtentInViewSpatialReference||b.layer.fullExtent,(b=C(b,c))&&k.expand(a,b))});var d=k.allFinite(a)?a:null,b=this._get("layerViewsExtent");return u.equals(d,b)?b:d},d.prototype._computeTiledLayersExtent=function(){var a=this.tilingScheme;if(!a)return null;var d=this.spatialReference,h=k.create(k.NEGATIVE_INFINITY);this.layers.forEach(function(b){if(b.loaded&&c.isTiledLayer(b)){var l=
c.getTiledLayerInfo(b,d,"local");b=l.tileInfo;l=l.fullExtent;b&&a.compatibleWith(b)&&l&&l.spatialReference.equals(d)&&k.expand(h,l)}});this.defaultTiledLayersExtent&&k.expand(h,this.defaultTiledLayersExtent);var b=k.allFinite(h)?h:null,l=this._get("tiledLayersExtent");return u.equals(b,l)?l:b},d=l([h.subclass()],d)}(h.declared(A));p.SurfaceExtentHelperLocal=A})},"esri/views/3d/terrain/SurfaceTilingSchemeLogic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../core/HandleRegistry ./terrainUtils ./TilingScheme".split(" "),
function(A,p,w,l,h,d,u,r,a){return function(d){function c(a){a=d.call(this,a)||this;return a._changeHandles=new u,a}return w(c,d),c.prototype.initialize=function(){var a=this;this._changeHandles.add(this.layers.on("change",function(){return a._update()}));this._changeHandles.add(this.extentHelper.watch("layerViewsExtent",function(){return a._setAdHocTilingScheme()}));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()},c.prototype.destroy=function(){this._changeHandles.destroy();
this._changeHandles=null},c.prototype._update=function(){var c=this;if(this._waitTask=null,!this.tilingSchemeLocked){this._set("tilingSchemeDone",!1);var d=this.layers.find(function(a){return r.isTiledLayer(a)?a.isFulfilled()?a.isRejected()?!1:!!r.getTiledLayerInfo(a,c.viewSpatialReference,c.manifold).tileInfo:!0:!1});if(d)if(d.isResolved()){var k=r.getTiledLayerInfo(d,this.viewSpatialReference,this.manifold).tileInfo,k=new a(k),d=r.getKnownTiledServiceLevelCap(d.url);1/0>d&&k.capMaxLod(d);this._set("tilingSchemeDone",
!0);this._lockTilingScheme(k)}else this._updateWhen(d);else this._set("tilingSchemeDone",!0)}},c.prototype._updateWhen=function(a){var c=this,d=a.when().always(function(){d===c._waitTask&&c._update()});this._waitTask=d},c.prototype._lockTilingScheme=function(c){var d=this;if("spherical"===this.manifold){var k=c.levels.length-1;c=c.spatialReference.isWebMercator?a.makeWebMercatorAuxiliarySphere(k):a.makeWGS84WithTileSize(c.pixelSize[0],k)}this.tilingSchemeLocked=!0;this.tilingScheme=c;this.extentHelper.tilingScheme=
this.tilingScheme;this._updateTiledLayerExtent();this._changeHandles.removeAll();this._changeHandles.add(this.extentHelper.watch("tiledLayersExtent",function(){return d._updateTiledLayerExtent()}))},c.prototype._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent},c.prototype._setAdHocTilingScheme=function(){if("spherical"===this.manifold)this.tilingScheme=this.extentHelper.spatialReference.isWebMercator?a.WebMercatorAuxiliarySphere:a.makeWGS84WithTileSize(256),this.extent=
this.extentHelper.layerViewsExtent;else{var c=this.extentHelper.layerViewsExtent;c&&(this.tilingScheme=a.fromExtent(c,this.extentHelper.spatialReference),this.extent=c)}},l([h.property()],c.prototype,"tilingScheme",void 0),l([h.property()],c.prototype,"extent",void 0),l([h.property({value:!1})],c.prototype,"tilingSchemeLocked",void 0),l([h.property({readOnly:!0,value:!1})],c.prototype,"tilingSchemeDone",void 0),l([h.property({constructOnly:!0})],c.prototype,"viewSpatialReference",void 0),l([h.property({constructOnly:!0})],
c.prototype,"layers",void 0),l([h.property({constructOnly:!0})],c.prototype,"extentHelper",void 0),l([h.property({constructOnly:!0})],c.prototype,"manifold",void 0),c=l([h.subclass()],c)}(h.declared(d))})},"esri/views/3d/terrain/TerrainRenderer":function(){define("dojo/when ./tileUtils ./TerrainConst ./TileGeometryFactory ./TileRenderData ./ResourceCounter ./TileRenderer ../support/PreallocArray ../../../core/ObjectPool ../../../core/promiseUtils ../support/imageUtils ../webgl-engine/lib/ShaderVariations dojo/text!./TerrainMaterial.xml ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/lib/Util ../lib/glMatrix ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/tracer ../../webgl/Texture ../../webgl/VertexArrayObject ../../webgl/BufferObject ../../webgl/Program ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl/Util".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E,J,G,K,M,U,N){var W=v.assert;v=y.vec2d;var R=y.vec3d,V=y.vec4d,Q=y.mat4d.identity(),S=[2,2],X=D.OPAQUE_TERRAIN,z=D.TRANSPARENT_TERRAIN,Z=R.create(),O=v.create();y=function(g,e,f){function n(a,e){a=a.screenDepth;e=e.screenDepth;return e>a?-Pa:a>e?Pa:0}function v(a,e){return 0===a.tiles.length?-Pa:0===e.tiles.length?Pa:n(a.tiles.data[0],e.tiles.data[0])}e=e||256;var y,D,P,Y=!1,fa=null,ga=null,ia=null,na={},ka=new a(h),wa=new r(10,function(){return{root:null,
tiles:new r(300)}}),ta=!0,sa=new p.IteratorPreorder,aa=null,ya=!0,la=1,za=!0,oa=!1,F={mode:"none",width:1.5,falloff:1.5,wireOpacity:1,surfaceOpacity:0,color:[1,1,1,0],resolution:64},Ia=!1,Ea=!1,Qa=!1,Pa=1,Fa=!0,ea=!0,Na=null,Ga=null,La=null,ib=!1,ha=[];this.updateTileBackground=function(a){return La&&La.cancel(),La=a?c.requestImage(a).otherwise(function(){return null}):k.resolve(null),this.renderTileBackground(),La};var Ua=0,Ma=0,qa=0,db=0;this.resourceCounter=new d;this.castShadows=!0;this.clippingExtent=
null;this.loaded=function(){};var Va=!1;this.needsRender=!0;this.receiveShadows=this.needsHighlight=this.didRender=!1;var va=new r(10),bb=0,da=new r(30),Ba=new a(function(){this.extent=V.create();this.maxLevel=this.minLevel=0;this.callback=null},!1);this.renderTileBackground=function(){return D&&La&&Ga?La.then(function(a){Ga&&(ib=!0,Ga.setGridImage(a),fa&&p.traverseTilesPreorder(fa,function(a){Ga.updateTileTexture(a)}.bind(this)))}.bind(this)):void 0};this.initializeRenderContext=function(a){D=a.rctx;
P=a.rctx.gl;var b=function(a){A(a).then(function(){Y=!0;this.setNeedsRender()}.bind(this)).otherwise(b)}.bind(this);b(this.renderTileBackground());y=a.textureRep;var c=a.shaderSnippets,d=a.shaderRep;a=a.programRep;c.vsTerrain||c._parse(C);D.extensions.standardDerivatives;var f=new t("terrain",["vsTerrain","fsTerrain"],null,a,d,c,D);f.addDefine("Spherical","SPHERICAL");f.addDefine("Overlay","OVERLAY");f.addDefine("Atmosphere","ATMOSPHERE");f.addDefine("Wireframe","WIREFRAME");f.addDefine("TileBorders",
"TILE_BORDERS");f.addBinaryShaderSnippetSuffix("Wireframe","Wireframe",[!1,!0]);f.addDefine("ReceiveShadows","RECEIVE_SHADOWS");f.addDefine("ScreenSizePerspective","SCREEN_SIZE_PERSPECTIVE");d=new t("terrainNormal",["vsTerrainNormal","fsNormal"],null,a,d,c,D);d.addDefine("Spherical","SPHERICAL");d.addDefine("AlphaZero","ALPHA_ZERO");ia={depth:a.get("depth"),depthShadowMap:a.get("depthShadowMap"),depthOnly:new G(D,c.vsTerrainDepthOnly,c.fsTerrainDepthOnly,K.Default3D),highlight:new G(D,c.vsTerrainHighlight,
c.fsTerrainHighlight,K.Default3D)};ga={color:f,normal:d};this._updatePrograms();Ga=new u(D,e,a,this.resourceCounter,this.setNeedsRender.bind(this));this.renderTileBackground();Na=new m(D,{target:P.TEXTURE_2D,pixelFormat:P.RGBA,dataType:P.UNSIGNED_BYTE,samplingMode:P.NEAREST,width:4,height:4})};this.uninitializeRenderContext=function(a){null!=Na&&(Na.dispose(),Na=null);Ga&&(Ga.dispose(),Ga=null)};this._updatePrograms=function(){var a="spherical"===g,e="shader"===F.mode;ia.color=ga.color.getProgram([a,
!0,a&&ea,e,Ia,e||Ia,this.receiveShadows,oa]);ia.normal=ga.normal.getProgram([a,!0]);this.setNeedsRender()};this.destroy=function(a){this.uninstall(a);La&&(La.cancel(),La=null)};this.install=function(a){a.addExternalRenderer([X,z],this)};this.uninstall=function(a){a.removeExternalRenderer(this)};this.setRootTiles=function(a){fa=a;this.setNeedsRender()};this.setNeedsHighlight=function(a){this.needsHighlight=a;this.setNeedsRender()};this.setStencilEnabledLayerExtents=function(a){ha=a;this.setNeedsRender()};
this.setTileSize=function(a){e=a;Ga&&(Ga.tileSize=a);this.setNeedsRender()};this.loadTile=function(a){W(null===a.renderData);a.renderData=ka.acquire();a.renderData.init();var e=this.getLocalOriginOfTile(a),b=a.createGeometry(a.renderData.updateGeometryState(a),e,"debug"===F.mode,a.renderData.geometryInfo);a.renderData.localOrigin=e;this._setTileGeometry(a,b);ib&&Ga.updateTileTexture(a)};this.queryVisibleLevelRange=function(a,e,b,c){var d=Ba.acquire();V.set(a,d.extent);e?d.minLevel=e:d.minLevel=-Number.MAX_VALUE;
null!=b?d.maxLevel=b:d.maxLevel=Number.MAX_VALUE;d.callback=c;da.push(d);this.setNeedsRender()};this.updateTileTexture=function(a){Ga&&ib&&Ga.updateTileTexture(a)};this.updateTileGeometryNeedsUpdate=function(a){return a.renderData.updateGeometryState(a).needsUpdate};this._updateTileGeometry=function(a){for(var e=a.renderData.geometryState,b=a.layerInfo[w.LayerClass.ELEVATION],c=0;c<b.length;c++)b[c].pendingUpdates&=~w.TileUpdateTypes.UPDATE_GEOMETRY;return e.needsUpdate?(a.renderData.vao&&this._releaseTileGeometry(a),
e=a.createGeometry(e,a.renderData.localOrigin,"debug"===F.mode,a.renderData.geometryInfo),this._setTileGeometry(a,e),!0):!1};this.updateTileGeometry=function(a){return a.renderData.updateGeometryState(a),this._updateTileGeometry(a)};this.unloadTile=function(a){this._releaseTileGeometry(a);a.renderData.texture&&a.renderData.texture.dispose();ka.release(a.renderData);a.renderData=null};this.getLocalOriginOfTile=function(a){if(10<=a.lij[0]){for(;7<a.lij[0];)a=a.parent;return a.centerAtSeaLevel}if("spherical"===
g)return Z;for(;a.parent;)a=a.parent;return a.centerAtSeaLevel};this.setVisibility=function(a){ya=a;this.setNeedsRender()};this.getStats=function(){return{numTilesRendered:Ma,numTilesCulled:qa,numTrianglesRendered:Ua,numOriginsRendered:db}};this.setDisableRendering=function(a){Ea=!!a;this.setNeedsRender()};this.getOpacity=function(){return la};this.getWireframeEnabled=function(){return"shader"===F.mode};this.setDebugScreenSizePerspective=function(a){a!==oa&&(oa=a,this._updatePrograms())};this.setWireframe=
function(a){if(a&&!0!==a||(a={mode:a?"shader":"none"}),void 0!==a.mode&&F.mode!==a.mode){var b="debug"===F.mode,c="debug"===a.mode;F.mode=a.mode;this._updatePrograms();b!==c&&fa&&p.traverseTilesPreorder(fa,function(a){if(a.renderData){a.renderData.vao&&this._releaseTileGeometry(a);var e=a.createGeometry(a.renderData.updateGeometryState(a),a.renderData.localOrigin,c,a.renderData.geometryInfo);this._setTileGeometry(a,e)}}.bind(this))}for(var d in a)F.hasOwnProperty(d)&&(F[d]=a[d]),this.setNeedsRender();
F.resolution&&(F.resolution=Math.min(F.resolution,e),F.resolution=1<<Math.round(Math.log(F.resolution)/Math.LN2))};this.setOpacity=function(a){la=a;this.setNeedsRender()};this.setDrawSkirts=function(a){za=a;this.setNeedsRender()};this.setCullBackFaces=function(a){Qa=a;this.setNeedsRender()};this.setRenderOrder=function(a){Pa=a;this.setNeedsRender()};this.setBorders=function(a){Ia!==a&&(Ia=a,this._updatePrograms())};this.setFrontMostTransparent=function(a){Fa!==a&&(Fa=a,this.setNeedsRender())};this.setVelvetOverground=
function(a){ea!==a&&(ea=a,this._updatePrograms())};this.setNeedsRender=function(){this.needsRender=!0;this.didRender=!1;ta=!0};this.resetNeedsRender=function(){this.didRender&&(this.needsRender=0!==da.length,this.didRender=!1)};var T=R.create();this.isTransparent=function(){return 1>la||"shader"===F.mode&&(1>F.wireOpacity||1>F.surfaceOpacity)};this._renderMaterialPass=function(a,e){var b=this.isTransparent(),c=a.shadowMap&&a.shadowMap.getEnableState();this.receiveShadows!=c&&(this.receiveShadows=
c,this._updatePrograms());c=a.camera;(D.setDepthTestEnabled(!0),D.setBlendingEnabled(b),b&&D.setBlendFunctionSeparate(P.SRC_ALPHA,P.ONE_MINUS_SRC_ALPHA,P.ONE,P.ONE_MINUS_SRC_ALPHA),b&&Fa)?(b=ia.depthOnly,D.bindProgram(b),D.setColorMask(!1,!1,!1,!1),D.setDepthWriteEnabled(!0),this._renderTilesAuxiliary(a,b,e),D.setColorMask(!0,!0,!0,!0),D.setDepthFunction(P.EQUAL),D.setDepthWriteEnabled(!1)):D.setDepthFunction(P.LESS);b=ia.color;D.bindProgram(b);b.setUniform1f("opacity",la);("shader"===F.mode||Ia)&&
(b.setUniform1f("wireframe.width",F.width),b.setUniform1f("wireframe.falloff",Math.min(F.width,F.falloff)),b.setUniform1f("wireframe.wireOpacity",F.wireOpacity*la),b.setUniform1f("wireframe.surfaceOpacity",F.surfaceOpacity*la),b.setUniform4fv("wireframe.color",F.color));c=a.camera;a.shadowMap&&a.shadowMap.bind(b);a.ssaoHelper&&a.ssaoHelper.setUniforms(b);b.setUniform1i("tex",4);b.setUniform1i("overlayTex",5);b.setUniformMatrix4fv("viewNormal",c.viewInverseTransposeMatrix);b.setUniformMatrix4fv("proj",
c.projectionMatrix);a.lightingData.helper.setUniforms(b,!0);c=c.viewMatrix;R.set3(c[12],c[13],c[14],T);R.normalize(T);b.setUniform3fv("viewDirection",T);for(db=Ua=qa=Ma=0;va.length<va.data.length&&0<da.length;)c=da.pop(),va.push(c);bb=va.length;this._renderTiles(a,b,e);D.setBlendingEnabled(!1);D.setDepthFunction(P.LESS);D.setDepthWriteEnabled(!0);for(a=0;a<va.length;a++)e=va.data[a],Ba.release(e),e.callback(a>=bb),e.callback=null;va.clear();0<Ma&&!Va&&(Va=!0,this.loaded&&this.loaded())};this._renderDepthPass=
function(a,e,b){var c=a.camera;D.bindProgram(e);D.setBlendingEnabled(!1);D.setDepthTestEnabled(!0);D.setDepthFunction(P.LESS);e.setUniformMatrix4fv("model",Q);e.setUniformMatrix4fv("viewNormal",c.viewInverseTransposeMatrix);O[0]=c.near;O[1]=c.far;e.setUniform2fv("nearFar",O);this._renderTilesAuxiliary(a,e,b)};this._renderNormalPass=function(a,e){var b=a.camera,c=ia.normal;D.bindProgram(c);D.setBlendingEnabled(!1);D.setDepthTestEnabled(!0);D.setDepthFunction(P.LESS);c.setUniformMatrix4fv("viewNormal",
b.viewInverseTransposeMatrix);this._renderTilesAuxiliary(a,c,e)};this._renderHighlightPass=function(a,e){var b=ia.highlight;D.bindProgram(b);D.setBlendingEnabled(!1);D.setDepthTestEnabled(!0);D.setDepthFunction(P.LESS);var c=a.offscreenRenderingHelper;D.bindTexture(c.getDepthTexture(),6);b.setUniform1i("depthTex",6);b.setUniform4f("highlightViewportPixelSz",0,0,1/c.width,1/c.height);this._renderTilesAuxiliary(a,b,e,!0)};this.render=function(a){if(Y&&!Ea&&ya&&fa&&ib){var e=this.isTransparent()?z:X;
if(a.slot===e){b.trace("# BEGIN RENDER TERRAIN");e=a.pass;D.setFaceCullingEnabled(Qa);var c=1===a.lightingData.helper.globalFactor;e===B.MATERIAL?this._renderMaterialPass(a,this._updatePerOriginTileData()):e===B.MATERIAL_DEPTH_SHADOWMAP&&this.castShadows&&c?this._renderDepthPass(a,ia.depthShadowMap,this._updatePerOriginTileData()):e===B.MATERIAL_DEPTH?this._renderDepthPass(a,ia.depth,this._updatePerOriginTileData()):e===B.MATERIAL_NORMAL?this._renderNormalPass(a,this._updatePerOriginTileData()):e===
B.MATERIAL_HIGHLIGHT&&this.needsHighlight&&(this._renderHighlightPass(a,this._updatePerOriginTileData()),D.clear(D.gl.DEPTH_BUFFER_BIT));return Qa&&D.setFaceCullingEnabled(!1),b.trace("# END RENDER TERRAIN"),!0}}};this._updatePerOriginTileData=function(){if(!ta)return wa;if(aa=null,this._renderCollectOrigins(),0!==Pa){for(var a=0;a<wa.length;a++)this._sortFrontToBack(wa.data[a].tiles,n);this._sortFrontToBack(wa,v)}return ta=!1,wa};this._renderCollectOrigins=function(){wa.clear();for(var a=0;a<fa.length;a++){var e=
fa[a],b=wa.next();b.root=e;"spherical"===g?b.origin=Z:b.origin=e.centerAtSeaLevel;b.tiles.clear();this._renderCollectOriginsForRoot(b)}return!0};this._renderCollectOriginsForRoot=function(a){for(sa.reset(a.root);!sa.done;){var e=sa.next(),b=e.renderData;if(!b||e.visible){var c=wa.peek();if(7===e.lij[0]&&((c===a||0!==c.tiles.length)&&(c=wa.next(),c.tiles.clear()),c.root=e,c.origin=e.centerAtSeaLevel),b)10<=e.lij[0]?wa.peek().tiles.push(e):a.tiles.push(e),(!aa||e.vlevel>aa.vlevel)&&(aa=e),sa.skip()}else qa++,
sa.skip()}};this._sortFrontToBack=function(a,e){a.sort(e)};this._updateStencilReadStateForTile=function(a,e){if(a.stencilRenderingHelper&&a.stencilRenderingHelper.getEnableState()){for(var b=!1,c=0;c<ha.length;c++)if(e.intersectsExtent(ha[c])){b=!0;break}b?a.stencilRenderingHelper.enableStencilRead():a.stencilRenderingHelper.disableStencilRead()}};this._renderTilesAuxiliary=function(a,e,b,c){var d=a.camera,f=d.viewMatrix,g=a.rctx;e.setUniformMatrix4fv("proj",d.projectionMatrix);c&&e.setUniform1i("overlayTex",
5);for(d=0;d<b.length;d++){var k=b.data[d];e.setUniform3fv("origin",k.origin);q.bindView(k.origin,f,e);for(var h=0;h<k.tiles.length;h++){var l=k.tiles.data[h],m=l.renderData;c&&(m.highlightOverlayTexId?ra(e,m,m.highlightOverlayTexId):g.bindTexture(Na,5));this._updateStencilReadStateForTile(a,l);g.bindVAO(m.vao);N.assertCompatibleVertexAttributeLocations(m.vao,e);l=m.vao.indexBuffer.size;za||(l=m.geometryInfo.numWithoutSkirtIndices);g.drawElements(P.TRIANGLES,l,m.vao.indexBuffer.indexType,0)}}g.bindVAO(null);
g.stencilRenderingHelper&&g.stencilRenderingHelper.disableStencilRead()};this._renderTiles=function(a,c,d){var k=a.camera.viewMatrix;if(oa){var h=U.getSettings(g);h.update({distance:f.distanceToSurface,fovY:f.fovY});q.bindScreenSizePerspective(h,c,"screenSizePerspective")}for(h=0;h<d.length;h++){var l=d.data[h];c.setUniform3fv("origin",l.origin);q.bindView(l.origin,k,c);a.shadowMap&&a.shadowMap.bindView(c,l.origin);db++;var m=l.tiles;if(0!==m.length){var n=P.TRIANGLES;"debug"===F.mode&&(n=P.LINES);
var r,t,v=aa;v?(r=v.vlevel,t=e/F.resolution):(r=16,t=e/64);for(v=0;v<m.length;v++){var p=m.data[v],l=p.renderData;this._updateStencilReadStateForTile(a,p);b.trace("# RENDER TILE "+p.lij[0]+"/"+p.lij[1]+"/"+p.lij[2]+", screenDepth:"+p.screenDepth);c.setUniform2fv("texOffset",l.texOffset);c.setUniform1f("texScale",l.texScale);(D.bindTexture(l.textureReference||l.texture,4),l.overlayTexId?ra(c,l,l.overlayTexId):(c.setUniform2fv("overlayTexOffset",S),D.bindTexture(Na,5)),"shader"===F.mode||Ia)&&c.setUniform1f("wireframe.subdivision",
t*(1<<r-p.vlevel));var u=l.vao.indexBuffer.size;za||(u=l.geometryInfo.numWithoutSkirtIndices);D.bindVAO(l.vao);N.assertCompatibleVertexAttributeLocations(l.vao,c);D.drawElements(n,u,l.vao.indexBuffer.indexType,0);p.renderOrder=Ma;Ma++;Ua+=u/3;l=p.extent;p=p.lij[0];for(u=0;bb>u;){var x=va.data[u],w=x.extent;p>=x.minLevel&&p<=x.maxLevel&&w[0]<=l[2]&&w[2]>=l[0]&&w[1]<=l[3]&&w[3]>=l[1]?(va.swap(u,bb-1),bb--):u++}}}}D.bindVAO(null);a.stencilRenderingHelper&&a.stencilRenderingHelper.disableStencilRead()};
var ra=function(a,e,b){var c=na[b];c||(c=y.aquire(b).getGLTexture(),W(c),na[b]=c);a.setUniform2fv("overlayTexOffset",e.overlayTexOffset);a.setUniform2fv("overlayTexScale",e.overlayTexScale);a.setUniform1f("overlayOpacity",e.overlayOpacity);D.bindTexture(c,5)},ua=R.create(),Aa=R.create(),ma=R.create(),pa=this.clippingExtent;this.intersect=function(a,e,b){if(fa&&(!a.isSelection||!this.isTransparent())&&a.enableTerrain){R.subtract(b,e,ua);var c=a.getMinResult(),d=a.getMaxResult();sa.reset(fa);for(var f=
{};!sa.done;){var g=sa.next();if(null!==g.renderData){if(a.enableInvisibleTerrain){if(!g.visible&&pa&&!g.intersectsExtent(pa))continue}else if(!g.visible)continue;var k=g.renderData.geometryInfo.geometry,h=g.renderData.localOrigin;R.subtract(e,h,Aa);R.subtract(b,h,ma);q.intersectTriangleGeometry(k,f,void 0,a,Aa,ma,function(e,b,f){if((za||!(3*f>=g.renderData.geometryInfo.numWithoutSkirtIndices))&&0<=e&&(a.enableBackfacesTerrain||0>R.dot(b,ua))){var k;(void 0===c.dist||e<c.dist)&&(k=p.lij2str(g.lij[0],
g.lij[1],g.lij[2]),c.set(void 0,k,e,b,void 0),c.setIntersector("terrain"));(void 0===d.dist||e>d.dist)&&(k=p.lij2str(g.lij[0],g.lij[1],g.lij[2]),d.set(void 0,k,e,b,void 0),d.setIntersector("terrain"))}})}}}};this._setTileGeometry=function(a,e){a=a.renderData;var b=e.geometry.getData(),c=b.getVertexAttr().terrain.data,b=b.indices.terrain;a.vao=new E(D,K.Default3D,{geometry:M.Pos3Tex},{geometry:J.createVertex(D,P.STATIC_DRAW,c)},J.createIndex(D,P.STATIC_DRAW,b));a.geometryInfo.geometry&&l.releaseGeometry(a.geometryInfo.geometry);
a.geometryInfo=e;this.setNeedsRender()};this._releaseTileGeometry=function(a){a=a.renderData;a.vao.dispose(!0);a.vao=null;a.geometryInfo.geometry&&l.releaseGeometry(a.geometryInfo.geometry);a.geometryInfo.geometry=null;this.setNeedsRender()}};return y.TileRenderData=h,y})},"esri/views/3d/terrain/TileRenderData":function(){define(["require","exports","../lib/glMatrix"],function(A,p,w){var l=w.vec2d;return function(){function h(){this.overlayTexOffset=l.create();this.texOffset=l.create();this.geometryInfo=
{geometry:null,numSurfaceIndices:0,numSkirtIndices:0,numWithoutSkirtIndices:0,numVertsPerRow:0};this.init()}return h.prototype.init=function(){this.geometryInfo.geometry=null;this.geometryInfo.numSurfaceIndices=0;this.geometryInfo.numSkirtIndices=0;this.geometryInfo.numWithoutSkirtIndices=0;this.geometryInfo.numVertsPerRow=0;this.textureReference=this.texture=this.vao=this.geometryState=null;l.set2(0,0,this.texOffset);this.texScale=1;this.highlightOverlayTexId=this.overlayTexId=null;this.overlayTexScale=
[1,1];this.overlayOpacity=1;this.localOrigin=null},h.prototype.updateGeometryState=function(d){return this.geometryState=d.geometryState(this.geometryState),this.geometryState},h}()})},"esri/views/3d/terrain/ResourceCounter":function(){define(["require","exports"],function(A,p){return function(){function p(){this._numTileTexturesComposited=0}return Object.defineProperty(p.prototype,"numTileTexturesComposited",{get:function(){return this._numTileTexturesComposited},enumerable:!0,configurable:!0}),
p.prototype.incrementNumTileTexturesComposited=function(){this._numTileTexturesComposited++},p.prototype.resetNumTileTexturesComposited=function(){this._numTileTexturesComposited=0},p}()})},"esri/views/3d/terrain/TileRenderer":function(){define("require exports ../lib/glMatrix ../../webgl/FramebufferObject ../../webgl/VertexArrayObject ../../webgl/Texture ../../webgl/BufferObject ../../webgl/Util ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../../vectorTiles/VectorTileDisplayObject ../../vectorTiles/tileRendererHelper3D ./TerrainConst".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C){var q=w.vec2d,v=Array(20),y=[0,0];return function(){function p(c,b,d,l,q){this._gridTex=null;this.tileSize=256;this._context=c;this.tileSize=b;this._resourceCounter=l;this._setNeedsRender=q;c.extensions.textureFilterAnisotropic&&(this._maxAnisotropy=Math.min(8,c.parameters.maxMaxAnisotropy));b=new Float32Array(20);b[0]=-1;b[1]=-1;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=-1;b[7]=0;b[8]=1;b[9]=0;b[10]=-1;b[11]=1;b[12]=0;b[13]=0;b[14]=1;b[15]=1;b[16]=1;b[17]=0;b[18]=1;b[19]=
1;this._vaoQuad=new h(c,a.Default3D,{geometry:k.Pos3Tex},{geometry:u.createVertex(c,35044,b)});this._blendLayersProgram=d.get("blendLayers")}return p.prototype.dispose=function(){this._fbo&&(this._fbo.dispose(),this._fbo=null);this._vaoQuad&&(this._vaoQuad.dispose(),this._vaoQuad=null);this._gridTex&&(this._gridTex.dispose(),this._gridTex=null);this._blendLayersProgram&&(this._blendLayersProgram.dispose(),this._blendLayersProgram=null);this._context&&(this._context=null)},p.prototype.updateTileTexture=
function(a){for(var b=C.LayerClass.MAP,c=a.layerInfo[b],d=0;d<c.length;d++)c[d].pendingUpdates&=~C.TileUpdateTypes.UPDATE_TEXTURE;if(a.renderData){for(var k,h,l,r=a.renderData,t=0,p=!0,d=0;d<c.length;d++){k=c[d];var u=a.parentSurface.layerViewByIndex(d,b);if(v[d]=u.fullOpacity,(k.data||k.upsampleFromTile)&&(t++,!u.isTransparent)){p=!1;break}}d===c.length&&d--;0===t&&this._gridTex?(r.textureReference=this._gridTex,q.set2(0,0,r.texOffset),r.texScale=1):1!==t||p?(this._composeMapLayers(a,c,d,p,v),r.textureReference=
null,q.set2(0,0,r.texOffset),r.texScale=1):(k=c[d],k.data?(h=k,q.set2(0,0,r.texOffset),r.texScale=1):(l=k.upsampleFromTile,h=l.tile.layerInfo[b][d],q.set(l.offset,r.texOffset),r.texScale=l.scale),h&&(h.data instanceof HTMLImageElement&&(h.data=this._buildTexture(h.data)),r.textureReference=h.data));this._setNeedsRender()}},p.prototype.setGridImage=function(a){this._gridTex=this._buildTexture(a)},p.prototype._buildTexture=function(a){var b,c={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,
samplingMode:9729,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},k=this._context;if(a)try{b=new d(k,c,a)}catch(J){c.width=c.height=this.tileSize,b=new d(k,c),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}else c.width=c.height=this.tileSize,b=new d(k,c);return k.bindTexture(b),b.generateMipmap(),b},p.prototype._drawVectorData=function(a,b,c,d,k,h,l,q,r){void 0===r&&(r=1);t(this._context,c,a,b.renderer,b.schemeHelper,c[0],d,k,0,h,l,q,
r)},p.prototype._drawRasterData=function(a,b,c,d){void 0===d&&(d=1);var k=this._context,h=this._blendLayersProgram,l=this._vaoQuad;k.bindProgram(h);k.bindVAO(l);r.assertCompatibleVertexAttributeLocations(l,h);k.bindTexture(a,0);h.setUniform1i("tex",0);h.setUniform1f("scale",b);h.setUniform2f("offset",c[0],c[1]);h.setUniform1f("opacity",d);k.drawArrays(5,0,r.vertexCount(l,"geometry"))},p.prototype._composeMapLayers=function(a,b,d,k,h){var m=C.LayerClass.MAP,q=this._context;a.renderData.texture||(a.renderData.texture=
this._buildTexture());var r=a.renderData.texture,t=this._fbo;t&&t.width===r.descriptor.width&&t.height===r.descriptor.height||(t=l.create(q,{colorTarget:0,depthStencilTarget:1,width:r.descriptor.width,height:r.descriptor.height}),this._fbo=t);var v=q.gl;q.bindFramebuffer(t);q.setViewport(0,0,this.tileSize,this.tileSize);q.setClearColor(0,0,0,0);q.setClearDepth(1);q.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT);q.setDepthTestEnabled(!1);q.setBlendFunctionSeparate(1,771,1,771);q.setBlendEquation(32774);
q.setBlendingEnabled(!0);var p,u,w,B;for(k&&this._gridTex&&this._drawRasterData(this._gridTex,1,y);0<=d;d--)k=null,(p=b[d],p.data)?(k=p,u=y,w=1):p.upsampleFromTile&&(w=p.upsampleFromTile,k=w.tile.layerInfo[m][d],B=w.tile.lij[0],u=w.offset,w=w.scale),k&&(((k.data instanceof HTMLImageElement||k.data instanceof HTMLCanvasElement)&&(k.data=this._buildTexture(k.data)),k.data instanceof c)?(t=a.parentSurface.layerViewByIndex(d,m),this._drawVectorData(k.data,t,a.lij,r.descriptor.width,r.descriptor.height,
w,u,B,h[d])):this._drawRasterData(k.data,w,u,h[d]));q.bindTexture(r);v.copyTexImage2D(q.gl.TEXTURE_2D,0,r.descriptor.pixelFormat,0,0,r.descriptor.width,r.descriptor.height,0);r.generateMipmap();q.bindFramebuffer(null);q.setBlendFunctionSeparate(770,771,1,771);q.setBlendingEnabled(!1);this._resourceCounter.incrementNumTileTexturesComposited()},p}()})},"esri/views/vectorTiles/tileRendererHelper3D":function(){define(["require","exports","dojo/has","../../core/libs/gl-matrix/vec3","../../core/libs/gl-matrix/mat4"],
function(A,p,w,l,h){var d={extent:{xmin:0,ymin:0,xmax:0,ymax:0,spatialReference:{wkid:102100,isWrappable:!0},intersects:function(d){return!1}},center:[0,0],scale:1,resolution:1,rotation:0,width:1,height:1,pixelRatio:1,size:[256,256],spatialReference:{wkid:102100,isWrappable:!0},worldScreenWidth:1,viewpoint:{},toMap:function(d,a){return[0,0]},toScreen:function(d,a){return[0,0]},clone:function(){return null},copy:function(d){return this}},u=l.create();return function(l,a,k,c,t,p,q,v,y,B,D,b,m){y=[a[0],
a[1],a[2]];for(var r=B;1>r;r*=2)y[0]--,y[1]>>=1,y[2]>>=1;a={context:l,budget:null,state:d,stationary:!0,devicePixelRatio:1,displayLevel:t.adjustLevel(p),requiredLevel:t.adjustLevel(a[0]),drawphase:0,renderer:c,layerOpacity:m};if(q!==v)throw Error("It is expected that tiles are square!");p=1/B;m=t.getSchemaShift(y,p);r=m[1];k.tileTransform.displayCoord[0]=-1-2*p*D[0]-m[0];k.tileTransform.displayCoord[1]=1+2*p*(1-D[1]-B)+r;B=k.tileTransform.transform;h.identity(B);t.isWGS84&&512===t.lockedSchemaPixelSize&&
(p*=2);0===b&&(p/=2);t=.25*p/q;u.set([t,-t,1]);h.scale(B,B,u);l.setBlendFunctionSeparate(1,771,1,771);l.setClearDepth(1);l.clear(l.gl.DEPTH_BUFFER_BIT);a.state.size=[q,v];a.state.width=q;a.state.height=v;c.setStateParams(a.state,a.devicePixelRatio,y[0]);k.attach(a);l.setFaceCullingEnabled(!1);l.setDepthFunction(515);l.setBlendingEnabled(!1);l.setDepthTestEnabled(!0);l.setDepthWriteEnabled(!0);k.processRender(a);l.setDepthWriteEnabled(!1);l.setBlendingEnabled(!0);a.drawphase=1;k.processRender(a);a.drawphase=
2;k.processRender(a);w("esri-vector-tiles-debug")&&c.renderTileInfo(l,k);l.setDepthWriteEnabled(!0);l.setDepthTestEnabled(!1);l.setFaceCullingEnabled(!0)}})},"esri/views/3d/terrain/TilemapOnlyTile":function(){define(["require","exports","./TerrainConst","./TilePerLayerInfo"],function(A,p,w,l){return function(){function h(d){this.parent=null;this.lij=d;this.layerInfo=Array(w.LayerClass.LAYER_CLASS_COUNT)}return h.prototype.tileDataAvailable=function(d,h,l){return(h=this.layerInfo[l][h].tilemap)?"unavailable"!==
h.getAvailability(d.lij[1],d.lij[2]):!0},h.prototype.modifyLayers=function(d,h,r){d=h.length;for(var a=this.layerInfo[r],k=Array(d),c=0;d>c;c++){var t=h[c];k[c]=-1<t?a[t]:new l(r)}this.layerInfo[r]=k},h}()})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/watchUtils ../../../../core/HandleRegistry ../../../../core/Logger ../../support/aaBoundingRect ../../support/PreallocArray ./deconflictorDebug ../../lib/glMatrix ../../webgl-engine/lib/Util ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/materials/internal/MaterialUtil ../../webgl-engine/materials/HUDMaterial".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q){function v(a){return!!a&&"selection"===a.type}var y=k.vec2d;A=k.vec4d;var B=c.VertexAttrConstants,D=d.getLogger("esri.views.3d.graphics.Deconflictor"),b=A.create(),m=A.create(),E=A.create(),J=A.create(),G=y.create(),K=u.create(),M=u.create(),U=new Set,N=c.lerp,W=new r(100),R=new r(100),V=function(){function a(a,b){this.creator=a;this.disposer=b;this.list=[];this.currentIndex=0}return a.prototype.alloc=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];
return this.currentIndex>=this.list.length&&this.list.push(new this.creator(a)),this.list[this.currentIndex++]},a.prototype.freeAll=function(){for(var a=this.currentIndex,b=this.disposer,c=this.list;0<=--a;)b(c[a]);this.currentIndex=0},a}(),Q=function(){function a(){this.graphics3DGraphic=null;this.positions=[y.create(),y.create(),y.create(),y.create()];this.posView=this.yMax=this.yMin=this.xMax=this.xMin=0;this.graphicsOwner=null;this.graphicId=this.id=0}return a.release=function(a){a.graphics3DGraphic=
null;a.graphicsOwner=null},a}();d=function(){function c(a){var b=this;this.graphicsOwners=[];this.deconflictTimeoutId=0;this.handles=new h;this.graphicInfoPool=new V(Q,Q.release);this.nextGraphicInfoId=0;this.accBinsNumX=15;this.accBinsNumY=20;this.accBinsSizeY=this.accBinsSizeX=0;this.accBins=null;this.accNumTests=0;this.iconMarginFactor=-.1;this.view=a;this.handles.add([a.watch("state.camera",function(){return b.scheduleRun()}),l.whenNot(a,"ready",function(){return b.clearDeconflictTimeout()})])}
return c.prototype.destroy=function(){this.handles.destroy();this.handles=null;this.clearDeconflictTimeout();this.graphicInfoPool.freeAll();this.view=this.graphicInfoPool=null},c.prototype.clearDeconflictTimeout=function(){this.deconflictTimeoutId&&(clearTimeout(this.deconflictTimeoutId),this.deconflictTimeoutId=0)},c.prototype.addGraphicsOwner=function(a){var b=this;this.graphicsOwners.push(a);this.setDirty();a.layer&&"function"==typeof a.layer.watch&&a.layer.watch("featureReduction",function(c,
e){v(c)?b.setDirty():v(e)&&(b._removeIconVisibilityFlags(a),b.setDirty())})},c.prototype.removeGraphicsOwner=function(a){a=this.graphicsOwners.indexOf(a);0<=a&&this.graphicsOwners.splice(a,1);this.setDirty()},c.prototype.setDirty=function(){this.scheduleRun(10)},c.prototype.initializeLabelVisibility=function(a){a.setVisibilityFlag(2,!1,1)},c.prototype.doesIntersectExistingPoly=function(a){var b=a.graphicId,c=a.positions;U.clear();for(var e=Math.floor(a.xMin/this.accBinsSizeX);e<=Math.floor(a.xMax/
this.accBinsSizeX);e++)if(!(0>e||e>=this.accBinsNumX))for(var d=Math.floor(a.yMin/this.accBinsSizeY);d<=Math.floor(a.yMax/this.accBinsSizeY);d++)if(!(0>d||d>=this.accBinsNumY)){var k=this.accBins[e][d],h=0;a:for(;h<k.length;h++){var l=k.data[h];if(l.graphicId!==b&&!U.has(l.id)){U.add(l.id);l=l.positions;this.accNumTests++;for(var m=0;2>m;m++){var q=0===m?c:l,r=0===m?l:c,t=0;b:for(;4>t;t++){var v=q[t],p=q[(t+1)%4],u=q[(t+2)%4];G[0]=p[0]-v[0];G[1]=p[1]-v[1];p=y.normalize(G);C=[-p[1],p[0]];p[0]=C[0];
p[1]=C[1];v=p[0]*v[0]+p[1]*v[1];u=p[0]*u[0]+p[1]*u[1]<v;for(C=0;4>C;C++){var w=r[C],w=p[0]*w[0]+p[1]*w[1];if(u&&v>w||!u&&w>v)continue b}continue a}}return!0}}}return!1;var C},c.prototype.initBins=function(a,b){if(null==this.accBins){this.accBins=[];for(var c=0;c<this.accBinsNumX;c++){this.accBins.push([]);for(var e=this.accBins[this.accBins.length-1],d=0;d<this.accBinsNumY;d++)e.push(new r(10))}}for(c=0;c<this.accBinsNumX;c++)for(d=0;d<this.accBinsNumY;d++)this.accBins[c][d].clear();this.accBinsSizeX=
a/this.accBinsNumX;this.accBinsSizeY=b/this.accBinsNumY;this.accNumTests=0},c.prototype.addToBins=function(a){for(var b=Math.floor(a.xMin/this.accBinsSizeX);b<=Math.floor(a.xMax/this.accBinsSizeX);b++)if(!(0>b||b>=this.accBinsNumX))for(var c=Math.floor(a.yMin/this.accBinsSizeY);c<=Math.floor(a.yMax/this.accBinsSizeY);c++)0>c||c>=this.accBinsNumY||this.accBins[b][c].push(a)},c.prototype.scheduleRun=function(a){var b=this;void 0===a&&(a=200);0===this.deconflictTimeoutId&&(this.deconflictTimeoutId=setTimeout(function(){return b.run()},
a))},c.prototype.run=function(){var b=this.view;if(this.clearDeconflictTimeout(),!b.ready)return void this.setDirty();var c=b.state.camera;this.graphicInfoPool.freeAll();this.nextGraphicInfoId=0;var d=c.fullWidth,e=c.fullHeight;a.prepare(b);W.clear();R.clear();for(var b=!1,f=0;f<this.graphicsOwners.length;f++){var k=this.graphicsOwners[f];if(null!=k.getGraphics3DGraphics&&null!=k.getGraphics3DGraphicsKeys){var h=null!=k.labelsEnabled&&k.labelsEnabled(),l=v(k.layer?k.layer.featureReduction:null);if(h||
l){b||(this.initBins(d,e),b=!0);for(var m=k.getGraphics3DGraphics(),q=k.getGraphics3DGraphicsKeys(),r=0;r<q.length;r++){var t=m[q[r]];t.areVisibilityFlagsSet(void 0,2)&&(l&&this._collectGraphics(t,!1,k,c,W,this.iconMarginFactor),h&&this._collectGraphics(t,!0,k,c,R))}}}}W.sort(function(a,e){return e.posView-a.posView});R.sort(function(a,e){return e.posView-a.posView});this._deconflictVisibleObjects(W,!1);R.length&&this._deconflictVisibleObjects(R,!0);a.drawAccelerationStruct(this,W);a.drawAccelerationStruct(this,
R)},c.prototype._collectGraphics=function(a,c,d,e,f,k){void 0===k&&(k=0);var g=c?a._labelGraphics:a._graphics,h=c?1:0;if(g.length){var l,n,r;c=u.set(K,u.NEGATIVE_INFINITY);for(var v=0;v<g.length;v++){var p=g[v];if(!p.isDraped()){var w=p.stageObject,y=w?w.getNumGeometryRecords():0;if(!(1>y)){var z=w.getGeometryRecord(0),G=z.materials[0];if(G instanceof q)if(1<y)D.warn("Graphic objects with more than 1 geometry record are not supported");else{y=z.geometry.getData().getVertexAttr();if(!n){n=w.getCenter();
r=z.origin.vec3;n=C.transformToWorld(n,r,b);n=C.transformToView(n,r,e.viewMatrix,m);G.applyVerticalOffsetTransformation(n,y[B.NORMAL].data,w.objectTransformation,e,S);w=y[B.AUXPOS1].data;y="screen"!==G.getParams().centerOffsetUnits;r=C.transformToProjection(n,e.projectionMatrix,y?w:[0,0,0],E);r=C.transformToNDC(r,J);y||(r[0]+=w[0]/e.fullWidth*2,r[1]+=w[1]/e.fullHeight*2);if(-1>r[0]||-1>r[1]||-1>r[2]||1<=r[0]||1<=r[1])break;l=n[2];a.areVisibilityFlagsSet(2,void 0,h)&&(l*=.7)}p=p.getScreenSize(X);t.applyPrecomputedScaleFactorVec2(p,
S.factor,p);G=u.offset(G.calculateRelativeScreenBounds(p,S.scaleAlignment,M),N(0,e.fullWidth,.5+.5*r[0]),N(0,e.fullHeight,.5+.5*r[1]));0!==k&&(p=k*Math.min(u.width(G),u.height(G)),G[0]-=p,G[1]-=p,G[2]+=p,G[3]+=p);u.expand(c,G)}}}}null!=l&&(e=this.graphicInfoPool.alloc(),e.id=this.nextGraphicInfoId++,e.graphicId=a.graphic.uid,e.xMin=c[0],e.yMin=c[1],e.xMax=c[2],e.yMax=c[3],e.positions[0][0]=c[0],e.positions[0][1]=c[1],e.positions[1][0]=c[0],e.positions[1][1]=c[3],e.positions[2][0]=c[2],e.positions[2][1]=
c[3],e.positions[3][0]=c[2],e.positions[3][1]=c[1],e.graphics3DGraphic=a,e.posView=l,e.graphicsOwner=d,f.push(e))}},c.prototype._deconflictVisibleObjects=function(b,c){for(var d=c?1:0,e=0;e<b.length;e++){var f=b.data[e],k=f.graphics3DGraphic,h=!(c&&!1===k.areVisibilityFlagsSet(2,void 0))&&!this.doesIntersectExistingPoly(f);h&&this.addToBins(f);k.setVisibilityFlag(2,h,d);a.drawPoly(f.positions,h?"green":"red")}},c.prototype._removeIconVisibilityFlags=function(a){if(null!=a.getGraphics3DGraphics&&null!=
a.getGraphics3DGraphicsKeys){var b=a.getGraphics3DGraphics(),c=0;for(a=a.getGraphics3DGraphicsKeys();c<a.length;c++)b[a[c]].setVisibilityFlag(2,void 0)}},c}();var S={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},X=y.create();return d})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../lib/glMatrix","../../support/debugFlags"],function(A,p,w,l,h){function d(a,
c){if(k){var d=u.height,h=r;h.beginPath();h.lineWidth=1;h.strokeStyle=c;h.moveTo(a[0][0],d-a[0][1]);for(c=1;4>c;c++)h.lineTo(a[c][0],d-a[c][1]),h.stroke();h.lineTo(a[0][0],d-a[0][1]);h.stroke();h.closePath()}}Object.defineProperty(p,"__esModule",{value:!0});var u,r,a=l.vec2d,k=!1,c=!1;p.drawAccelerationStruct=function(k,h){if(c&&r){for(var l=r,t=[a.create(),a.create(),a.create(),a.create()],p=0,u=0;u<k.accBinsNumX;u++)for(var w=0;w<k.accBinsNumY;w++){var b=k.accBins[u][w],p=p+b.length,m=u*k.accBinsSizeX,
C=(u+1)*k.accBinsSizeX,A=w*k.accBinsSizeY,G=(w+1)*k.accBinsSizeY;t[0][0]=m;t[0][1]=A;t[1][0]=C;t[1][1]=A;t[2][0]=C;t[2][1]=G;t[3][0]=m;t[3][1]=G;l.fillText(b.length.toFixed(),m+5,A+15);d(t,"blue")}l.fillText("total totalShownLabels: "+p,70,40);l.fillText("total visible labels: "+h.length,70,50);l.fillText("total numTests: "+k.accNumTests,70,30)}};p.prepare=function(a){k=h.DECONFLICTOR_SHOW_OUTLINES;c=h.DECONFLICTOR_SHOW_GRID;(k||c)&&(null==u&&(u=document.createElement("canvas"),u.setAttribute("id",
"canvas2d"),a.surface.parentElement.style.position="relative",a.surface.parentElement.appendChild(u)),u.setAttribute("width",a.width+"px"),u.setAttribute("height",a.height+"px"),u.setAttribute("style","position:absolute;left:0px;top:0px;display:block;pointer-events:none;"),r=u.getContext("2d"),r.clearRect(0,0,a.width,a.height),r.font="8px Arial")};p.drawPoly=d})},"esri/views/3d/layers/GraphicsView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../layers/GraphicsView ./graphics/Graphics3DCore ./graphics/Graphics3DSpatialIndex ./graphics/Graphics3DElevationAlignment ../support/PromiseLightweight ../../../core/promiseUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c){return function(d){function t(){var a=null!==d&&d.apply(this,arguments)||this;return a.graphicsCore=null,a.spatialIndex=null,a.elevationAlignment=null,a.supportsDraping=!0,a._overlayUpdating=!1,a._eventHandles=[],a}return w(t,d),Object.defineProperty(t.prototype,"graphics",{set:function(a){a!==this.loadedGraphics&&(this.loadedGraphics=a);this._set("graphics",a)},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var a=this;this.mockLayerId="__sceneView.graphics-"+
Date.now().toString(16);this.spatialIndex=new r;this.spatialIndex.whenLoaded().then(function(){return a.deferredInitialize()})},t.prototype.deferredInitialize=function(){var c=this;if(!this.destroyed){this.loadedGraphics=this.graphics;this.graphicsCore=new u;this.elevationAlignment=new a;var d={id:this.mockLayerId,uid:this.mockLayerId};this.spatialIndex.initialize(this,d,this.view.spatialReference,this.graphicsCore);this.elevationAlignment.initialize(this,function(a,d,k){c.spatialIndex.intersects(a,
d,k)},this.graphicsCore,this.view.elevationProvider);this.graphicsCore.initialize(this,d,this.elevationAlignment,null,this.spatialIndex,null,null,null,null,this.view.basemapTerrain);this._eventHandles.push(this.view.watch("clippingArea",function(){return c.updateClippingExtent()}));this.updateClippingExtent();this.view.resourceController.registerIdleFrameWorker(this,{needsUpdate:this._needsIdleUpdate,idleFrame:this._idleUpdate})}},t.prototype.destroy=function(){this._eventHandles.forEach(function(a){return a.remove()});
this._eventHandles=null;this.view.resourceController.deregisterIdleFrameWorker(this);this.spatialIndex&&(this.spatialIndex.destroy(),this.spatialIndex=null);this.elevationAlignment&&(this.elevationAlignment.destroy(),this.elevationAlignment=null);this.graphicsCore&&(this.graphicsCore.destroy(),this.graphicsCore=null);this.loadedGraphics=null},t.prototype.getGraphicsFromStageObject=function(a,c){var d=a.getMetadata().graphicId,h=null;this.loadedGraphics&&this.loadedGraphics.some(function(a){return a.uid===
d?(h=a,!0):!1});a=new k.Promise;return null!==h?a.done(h):a.reject(),a},t.prototype.whenGraphicBounds=function(a){var d=this;return this.spatialIndex?this.spatialIndex.whenLoaded().then(function(){return d.graphicsCore?d.graphicsCore.whenGraphicBounds(a):c.reject()}):c.reject()},t.prototype._needsIdleUpdate=function(){return this.elevationAlignment.needsIdleUpdate()},t.prototype._idleUpdate=function(a){this.elevationAlignment.idleUpdate(a)},t.prototype._notifySuspendedChange=function(){},t.prototype._notifyDrapedDataChange=
function(){this.view.basemapTerrain&&this.view.basemapTerrain.overlayManager.setOverlayDirty()},t.prototype._evaluateUpdatingState=function(){if(this.elevationAlignment){var a;a=0+this.elevationAlignment.numNodesUpdating();a+=this.graphicsCore.numNodesUpdating();this.updating=a=(a=(a=(a=0<a||this._overlayUpdating)||this.spatialIndex.isUpdating())||this.elevationAlignment.isUpdating())||this.graphicsCore.needsIdleUpdate()}else this.updating=!1},t.prototype.updateClippingExtent=function(){this.graphicsCore.setClippingExtent(this.view.clippingArea,
this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()},l([h.property()],t.prototype,"graphics",null),l([h.property()],t.prototype,"loadedGraphics",void 0),l([h.property({value:!0})],t.prototype,"updating",void 0),l([h.property({value:!1})],t.prototype,"suspended",void 0),t=l([h.subclass("esri.views.3d.layers.GraphicsView3D")],t)}(h.declared(d))})},"esri/views/layers/GraphicsView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor ../../core/Collection ../../Graphic".split(" "),
function(A,p,w,l,h,d,u,r){return function(a){function d(){var c=null!==a&&a.apply(this,arguments)||this;return c.graphics=null,c.renderer=null,c.view=null,c}return w(d,a),l([h.property({type:u.ofType(r)})],d.prototype,"graphics",void 0),l([h.property()],d.prototype,"renderer",void 0),l([h.property()],d.prototype,"view",void 0),d=l([h.subclass("esri.views.layers.GraphicsView")],d)}(h.declared(d))})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/watchUtils ../../../../core/arrayUtils ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../support/projectionUtils ../../../../renderers/UniqueValueRenderer ../../../../renderers/support/rendererConversion ../../../../renderers/support/diffUtils ../../../../geometry/Point ../../../../geometry/Extent ../../webgl-engine/Stage ../../webgl-engine/lib/Util ../../webgl-engine/lib/Layer ../../webgl-engine/lib/FloatingBoxLocalOriginFactory ../../../../symbols/WebStyleSymbol ../../../../symbols/LabelSymbol3D ../../../../symbols/TextSymbol ../../../../symbols/support/symbolConversion ../../../../symbols/support/unitConversionUtils ../../lib/glMatrix ./featureExpressionInfoUtils ./Graphics3DGraphic ./Graphics3DWebStyleSymbol ./graphicUtils ./Graphics3DSymbolFactory ./Graphics3DOwner ./ElevationQuery ../../support/aaBoundingBox ../../support/mathUtils dojo/Deferred".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E,J,G,K,M,U,N,W,R,V,Q,S,X,z,Z){function O(a){(a=a.elevationInfo&&a.elevationInfo.unit)&&!K.supportsUnit(a)&&f.warn("elevationInfo.unit","'"+a+"' is not a valid unit")}A=M.vec3d;var g=new q,e=A.create(),f=r.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");return function(){function n(a){void 0===a&&(a=!0);this.elevationFeatureExpressionEnabled=a;this.graphics={};this.graphicsDrapedIds={};this.graphicsBySymbol={};this.graphicsKeys=[];this.symbols=
{};this.graphicsWithoutSymbol={};this.computedExtent=null;this.symbolCreationContext=new Q.Graphics3DSymbolCreationContext;this.hasDraped=!1;this.updatingGraphicIds=new Set;this.graphicTransformFunc=this.onComputedExtentChange=this.stage=this.labelStageLayer=this.stageLayer=this.tilingSchemeHandle=this.lastFastUpdate=null;this.eventHandles=[];this.sharedSymbolResourcesOwnerHandle=this.highlights=this.elevationQueryService=this.labeling=this.spatialIndex=this.scaleVisibility=this.elevation=this.layer=
this.layerView=this.viewSR=null;this.whenGraphics3DGraphicRequests={}}return n.prototype.initialize=function(a,e,b,c,d,g,k,l,m,q){var r=this;this.layerView=a;this.layer=e;this.viewSR=a.view.spatialReference;this.elevation=b;this.scaleVisibility=c;this.spatialIndex=d;this.labeling=g;this.highlights=k;this.onComputedExtentChange=l;this.graphicTransformFunc=m;var t=this.layerView.view;this.elevationQueryService=new S.ElevationQuery(this.viewSR,function(){return t.map.ground},{maximumAutoTileRequests:4});
this.initializeStage(t,this.layer.uid);this.symbolCreationContext.sharedResources=t.sharedSymbolResources;this.sharedSymbolResourcesOwnerHandle=t.sharedSymbolResources.addGraphicsOwner(this);this.symbolCreationContext.renderer=this.layer.renderer;this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataSupplier=t.sharedSymbolResources.streamDataSupplier;this.symbolCreationContext.renderSpatialReference=t.renderSpatialReference;this.symbolCreationContext.renderCoordsHelper=
t.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.layerView=this.layerView;this.symbolCreationContext.layerOrder=0;this.symbolCreationContext.localOriginFactory=n.createLocalOriginFactory();this.symbolCreationContext.elevationProvider=t.elevationProvider;O(this.layer);e=U.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=U.createContext(e,this.viewSR,f);t.deconflictor.addGraphicsOwner(this);
this.symbolCreationContext.screenSizePerspectiveEnabled=t.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.tilingSchemeHandle=h.when(q,"tilingScheme",function(a){a.spatialReference.equals(r.symbolCreationContext.overlaySR)||(r.symbolCreationContext.overlaySR=q.spatialReference,r.recreateAllGraphics())});this.eventHandles.push(this.layerView.watch("suspended",function(){return r.suspendedChange()}));this.eventHandles.push(this.layerView.watch("layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled",
function(){r.symbolCreationContext.screenSizePerspectiveEnabled=t.screenSizePerspectiveEnabled&&r.layer.screenSizePerspectiveEnabled;r.recreateAllGraphics()}));this.eventHandles.push(h.on(a,"loadedGraphics","change",function(a){return r.graphicsCollectionChanged(a)},function(){r.clearSymbolsAndGraphics();r.graphicsCollectionChanged({added:r.layerView.loadedGraphics.toArray(),removed:[]})}));this.validateRenderer(this.layer.renderer)},n.prototype.destroy=function(){var a=this;if(this.layerView.view.deconflictor.removeGraphicsOwner(this),
this.clear(),this.stage){var e=[this.stageLayer.getId()];this.labelStageLayer&&e.push(this.labelStageLayer.getId());this.stage.removeFromViewContent(e);e.forEach(function(e){return a.stage.remove(y.ModelContentType.LAYER,e)});this.stage=this.labelStageLayer=this.stageLayer=null}this.tilingSchemeHandle&&(this.tilingSchemeHandle.remove(),this.tilingSchemeHandle=null);this.eventHandles.forEach(function(a){return a.remove()});this.layerView=this.labeling=this.scaleVisibility=this.viewSR=this.onComputedExtentChange=
this.eventHandles=null;for(var b in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[b].reject(new u("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null;this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null)},n.prototype.clear=function(){var a=!1,e;for(e in this.graphics){var b=this.graphics[e],a=a||b.isDraped();b.destroy()}this.graphics={};this.graphicsKeys=
null;for(var c in this.symbols)(e=this.symbols[c])&&e.destroy();this.symbols={};this.graphicsBySymbol={};this.graphicsWithoutSymbol={};this.hasDraped=!1;a&&this.layerView._notifyDrapedDataChange()},n.prototype.initializeStage=function(a,e){this.stage=a._stage;this.stageLayer=new D(e,{state:this.layerView.suspended?"HIDDEN":"VISIBLE"},e);this.stage.add(y.ModelContentType.LAYER,this.stageLayer);a=[this.stageLayer.getId()];this.labeling&&(this.labelStageLayer=new D(e,{state:this.layerView.suspended?
"HIDDEN":"IGNORED"},e+"_labels"),this.stage.add(y.ModelContentType.LAYER,this.labelStageLayer),a.push(this.labelStageLayer.getId()));this.stage.addToViewContent(a)},n.prototype.setDrawingOrder=function(a){this.symbolCreationContext.layerOrder=a;var e={},b={},c;for(c in this.graphics)this.graphics[c].setDrawOrder(a,e,b);for(var d in b)(b=this.symbols[d])&&b.setDrawOrder(a,e);B.objectEmpty(e)||(this.stage.getTextureGraphicsRenderer().updateRenderOrder(e),this.layerView._notifyDrapedDataChange())},n.prototype.suspendedChange=
function(){!0===this.layerView.suspended?(this.stageLayer.setState("HIDDEN"),this.labelStageLayer&&this.labelStageLayer.setState("HIDDEN"),this.hideAllGraphics()):!1===this.layerView.suspended&&(this.stageLayer.setState("VISIBLE"),this.labelStageLayer&&this.labelStageLayer.setState("IGNORED"),this.updateAllGraphicsVisibility())},n.prototype.getGraphics3DGraphics=function(){return this.graphics},n.prototype.getGraphics3DGraphicById=function(a){return this.graphics[a]},n.prototype.getGraphics3DGraphicsKeys=
function(){return null===this.graphicsKeys&&(this.graphicsKeys=Object.keys(this.graphics)),this.graphicsKeys},n.prototype.labelsEnabled=function(){return!(!this.labeling||!this.labeling.layerLabelsEnabled())},n.prototype.getSymbolUpdateType=function(){var a=0,e=0,b=0,c;for(c in this.symbols){var d=this.symbols[c];d&&(d=d.getFastUpdateStatus(),a+=d.loading,b+=d.fast,e+=d.slow)}return 0<a?"unknown":0<=b&&0===e?"fast":0<=e&&0===b?"slow":"mixed"},n.prototype.numNodesUpdating=function(){return this.updatingGraphicIds.size},
n.prototype.needsIdleUpdate=function(){return!!this.lastFastUpdate&&500<performance.now()-this.lastFastUpdate},n.prototype.idleUpdate=function(a){a.done()||(this.lastFastUpdate&&(this.labeling&&this.labeling.updateLabelingInfo(),this.lastFastUpdate=null),this.layerView._evaluateUpdatingState())},n.prototype.whenGraphics3DGraphic=function(e){var b=this.graphics[e.uid];if(b)return a.resolve(b);b=this.whenGraphics3DGraphicRequests[e.uid];return b||(b=new Z,this.whenGraphics3DGraphicRequests[e.uid]=b),
b.promise},n.prototype.boundsForGraphics3DGraphic=function(a){return l(this,void 0,void 0,function(){var b,c,d,f,h,l,m,n,q;return w(this,function(r){switch(r.label){case 0:return b=this.layerView.view.spatialReference,c=this.layerView.view.renderSpatialReference,d=this.layerView.view.basemapTerrain.spatialReference,f=function(a,e,d){return k.bufferToBuffer(a,c,e,a,b,e,d)},h=function(a,e,c){return k.bufferToBuffer(a,d,e,a,b,e,c)},[4,a.getProjectedBoundingBox(f,h,this.elevationQueryService)];case 1:return(l=
r.sent())?(m=l.boundingBox,l.requiresDrapedElevation&&(n=this.symbolCreationContext.elevationProvider,n&&(X.center(m,e),g.x=e[0],g.y=e[1],g.z=void 0,g.spatialReference=b,q=n.getElevation(g)||0,m[2]=Math.min(m[2],q),m[5]=Math.max(m[5],q))),[2,{boundingBox:m,screenSpaceObjects:l.screenSpaceObjects}]):[2,null]}})})},n.prototype.whenGraphicBounds=function(a){var e=this;return h.whenOnce(this.layerView,"loadedGraphics").then(function(){var b=e.layerView.layer&&e.layerView.layer.objectIdField,c=e.layerView.loadedGraphics.find(function(e){return e===
a?!0:b&&e.attributes&&a.attributes&&e.attributes[b]===a.attributes[b]?!0:!1});if(c)return e.whenGraphics3DGraphic(c);throw new u("internal:graphic-not-part-of-view","Graphic is not part of this view");}).then(function(a){return e.boundsForGraphics3DGraphic(a)})},n.prototype.graphicsCollectionChanged=function(a){var e=this.graphicTransformFunc?this.graphicTransformFunc(a.added):a.added;this.add(e);this.remove(a.removed)},n.prototype.graphicUpdateHandler=function(a){var e=this.graphics[a.graphic.uid];
if(e)switch(a.property){case "visible":e.setVisibilityFlag(0,a.newValue)&&(e.isDraped()&&this.layerView._notifyDrapedDataChange(),this.labeling&&this.layerView.view.deconflictor.setDirty())}},n.prototype.beginGraphicUpdate=function(a){this.updatingGraphicIds.add(a.uid);"symbolsUpdating"in this.layerView&&!this.layerView.get("symbolsUpdating")&&this.layerView.set("symbolsUpdating",!0);this.layerView._evaluateUpdatingState()},n.prototype.endGraphicUpdate=function(a){a&&this.updatingGraphicIds["delete"](a.uid);
"symbolsUpdating"in this.layerView&&this.layerView.get("symbolsUpdating")&&0===this.updatingGraphicIds.size&&(this.layerView.view.flushDisplayModifications(),this.layerView.set("symbolsUpdating",!1));this.layerView._evaluateUpdatingState()},n.prototype.expandComputedExtent=function(a){var e,b,c,d,f,g;if("point"===a.type)e=b=a.x,c=d=a.y,a.z&&(f=g=a.z);else if("polygon"===a.type||"polyline"===a.type||"multipoint"===a.type){g=a.extent;if(!g)return;e=g.xmin;b=g.xmax;c=g.ymin;d=g.ymax;f=g.zmin;g=g.zmax}var h=
this.viewSR,l=n.tmpVec;!a.spatialReference.equals(h)&&k.xyzToVector(e,c,0,a.spatialReference,l,h)&&(e=l[0],c=l[1],k.xyzToVector(b,d,0,a.spatialReference,l,h),b=l[0],d=l[1]);z.isFinite(e)&&z.isFinite(b)&&z.isFinite(c)&&z.isFinite(d)&&((h=this.computedExtent)?(e<h.xmin&&(h.xmin=e),b>h.xmax&&(h.xmax=b),c<h.ymin&&(h.ymin=c),d>h.ymax&&(h.ymax=d)):(h=new v(e,c,b,d,a.spatialReference),this.computedExtent=h),z.isFinite(f)&&!z.isFinite(g)&&((null==h.zmin||f<h.zmin)&&(h.zmin=f),(null==h.zmax||g>h.zmax)&&(h.zmax=
g)),this.onComputedExtentChange&&this.onComputedExtentChange())},n.prototype.updateHasDraped=function(){this.hasDraped=!1;for(var a in this.graphicsDrapedIds)if(this.graphicsDrapedIds.hasOwnProperty(a)){this.hasDraped=!0;break}},n.prototype.elevationInfoChange=function(){O(this.layer);var a=U.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=U.createContext(a,this.viewSR,f);this.labeling&&this.labeling.elevationInfoChange();
this.layer.renderer!==this.symbolCreationContext.renderer&&this.rendererChange(this.layer.renderer);for(var e in this.graphicsBySymbol){var b=this.symbols[e],a=this.graphicsBySymbol[e];if(b&&b.layerPropertyChanged("elevationInfo",a)){for(var c in a){var d=a[c],b=d.graphic,d=d._labelGraphics;this.elevation&&this.elevation.markGraphicElevationDirty(b.uid);for(var g=0;g<d.length;g++){var k=d[g];k.graphics3DSymbolLayer.updateGraphicElevationContext(b,k)}}this.layerView._evaluateUpdatingState()}else this._recreateSymbol(e)}},
n.prototype.clearSymbolsAndGraphics=function(){this.clear();this.elevation&&this.elevation.clear();this.labeling&&this.labeling.clear()},n.prototype.recreateAllGraphics=function(){this.clearSymbolsAndGraphics();this.computedExtent=null;this.onComputedExtentChange&&this.onComputedExtentChange();this.layerView.loadedGraphics&&this.layerView.view.basemapTerrain.tilingScheme&&this.add(this.layerView.loadedGraphics.toArray())},n.prototype._recreateSymbol=function(a){var e=this.graphicsBySymbol[a],b=[],
c=!1,d;for(d in e){var f=e[d];f.isDraped()&&(delete this.graphicsDrapedIds[d],c=!0);b.push(f.graphic);f.destroy();delete this.graphics[d]}this.graphicsBySymbol[a]={};(e=this.symbols[a])&&e.destroy();delete this.symbols[a];this.updateHasDraped();c&&this.layerView._notifyDrapedDataChange();this.add(b)},n.prototype.add=function(a){if(this.layerView.view.basemapTerrain&&this.layerView.view.basemapTerrain.tilingScheme){for(var e=a.length,b=Array(e),c=Array(e),d=Array(e),g=!1,k=0;e>k;k++){var h=a[k],l=
h.geometry;l&&(this.expandComputedExtent(l),l=this.layerView.getRenderingInfo?this.layerView.getRenderingInfo(h):{symbol:h.symbol},(this.graphicsWithoutSymbol[h.uid]=h,l&&l.symbol)?(c[k]=l.symbol,d[k]=l,(l=this.getOrCreateGraphics3DSymbol(c[k],l.renderer))&&(b[k]=l,this.beginGraphicUpdate(h))):g||(g=!0,f.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render")))}for(k=0;e>k;k++)this.waitForSymbol(b[k],c[k],a[k],d[k])}},n.prototype.waitForSymbol=function(a,e,b,c){var d=this;a&&
a.then(function(){d.createGraphics3DGraphic(a,b,c);d.endGraphicUpdate(b);d.labeling&&d.layerView.view.deconflictor.setDirty()},function(){d.endGraphicUpdate(b)})},n.prototype.remove=function(a){for(var e=!1,b=a.length,c=0;b>c;c++){var d=a[c].uid,f=this.graphics[d];if(f){f.isDraped()&&(delete this.graphicsDrapedIds[d],e=!0);var g=f.graphics3DSymbol.symbol.id;f.destroy();delete this.graphics[d];delete this.graphicsBySymbol[g][d];delete this.graphicsWithoutSymbol[d];this.graphicsKeys=null}}this.updateHasDraped();
e&&this.layerView._notifyDrapedDataChange();this.layerView.view.deconflictor.setDirty()},n.prototype.hasLabelingContext=function(a){if(a instanceof E||a instanceof J){var e=this.symbolCreationContext.layer;return e.labelingInfo?e.labelingInfo.some(function(e){return e.symbol===a}):!1}return!1},n.prototype.hasValidSymbolCreationContext=function(a){return a instanceof E&&!this.hasLabelingContext(a)?(f.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),
!1):!0},n.prototype.createGraphics3DSymbol=function(a,e){if(!this.hasValidSymbolCreationContext(a))return null;a=G.to3D(a,!0,!1,this.hasLabelingContext(a));if(a.symbol){var b=void 0;e&&e.backgroundFillSymbol&&(e=G.to3D(e.backgroundFillSymbol,!1,!0),e.symbol&&(b=e.symbol.symbolLayers));return V.make(a.symbol,this.symbolCreationContext,b)}return a.error&&f.error(a.error.message),null},n.prototype.getOrCreateGraphics3DSymbol=function(a,e){var b=this,c=this.symbols[a.id];return void 0===c&&(c=a instanceof
m?new W(a,function(a){return b.createGraphics3DSymbol(a,e)}):this.createGraphics3DSymbol(a,e),this.symbols[a.id]=c),c},n.prototype.createGraphics3DGraphic=function(a,e,b){if(delete this.graphicsWithoutSymbol[e.uid],!this.symbols[a.symbol.id])return void this.add([e]);this.graphics[e.uid]||(b=a.createGraphics3DGraphic(e,b),this.graphics[e.uid]=b,this.graphicsKeys=null,this.graphicsBySymbol[a.symbol.id]||(this.graphicsBySymbol[a.symbol.id]={}),this.graphicsBySymbol[a.symbol.id][e.uid]=b,b.initialize(this.stageLayer,
this.stage),b.isDraped()&&(this.graphicsDrapedIds[e.uid]=!0,this.hasDraped=!0,this.layerView._notifyDrapedDataChange()),b.centroid=null,"point"!==e.geometry.type&&b instanceof N&&(b.centroid=R.computeCentroid(e.geometry,this.viewSR)),a=this.scaleVisibility&&this.scaleVisibility.scaleRangeActive(),this.spatialIndex&&this.spatialIndex.shouldAddToSpatialIndex(e,b,a)&&this.spatialIndex.addGraphicToSpatialIndex(e,b),this.labeling&&this.labeling.layerLabelsEnabled()&&this.labeling.createLabelsForGraphic(e,
b),a&&this.scaleVisibility.updateGraphicScaleVisibility(e,b),b.setVisibilityFlag(0,e.visible&&!this.layerView.suspended),(a=this.whenGraphics3DGraphicRequests[e.uid])&&(delete this.whenGraphics3DGraphicRequests[e.uid],a.resolve(b)),this.highlights&&this.highlights.graphicCreated(b))},n.prototype.rendererChange=function(a){var e=this.symbolCreationContext.renderer;if(a!==e){this.validateRenderer(a);var b=C.diff(e,a);if(this.updateUnchangedSymbolMappings(b,a,e),this.symbolCreationContext.renderer=a,
b)if("complete"===b.type)this.recreateAllGraphics();else if("partial"===b.type){if(!this.applyRendererDiff(b,a,e))return void this.recreateAllGraphics();this.volatileGraphicsUpdated()}}},n.prototype.diffHasSymbolChange=function(a){for(var e in a.diff)switch(e){case "visualVariables":break;case "defaultSymbol":break;case "uniqueValueInfos":break;case "authoringInfo":case "fieldDelimiter":delete a.diff[e];break;default:return!0}return!1},n.prototype.applySymbolSetDiff=function(a,e,b,c){c=!1;a=a||[];
e=e||[];for(var d=[],f=0;f<e.length;f++){var g=e[f],k=this.graphicsBySymbol[g.id],h;for(h in k){var l=k[h],m=l.graphic;(g!==b.defaultSymbol||b.getSymbol(m)!==b.defaultSymbol)&&(l.isDraped()&&(delete this.graphicsDrapedIds[h],c=!0),a.length||b.defaultSymbol?d.push(m):this.graphicsWithoutSymbol[h]=m,l.destroy(),this.highlights&&this.highlights.graphicDeleted(this.graphics[h]),delete k[h],delete this.graphics[h],this.graphicsKeys=null)}if(void 0===k||0===Object.keys(k).length)delete this.graphicsBySymbol[g.id],
(k=this.symbols[g.id])&&k.destroy(),delete this.symbols[g.id]}if(a.length||d.length){for(h in this.graphicsWithoutSymbol)d.push(this.graphicsWithoutSymbol[h]);this.graphicsWithoutSymbol={};this.add(d)}this.updateHasDraped();c&&this.layerView._notifyDrapedDataChange();this.layerView.view.deconflictor.setDirty()},n.prototype.applyUniqueValueRendererDiff=function(a,e,b){var c=a.diff.defaultSymbol,d=a.diff.uniqueValueInfos;if(c||d){var f=d?d.added.map(function(a){return a.symbol}):[],g=d?d.removed.map(function(a){return a.symbol}):
[];if(d)for(var k=0;k<d.changed.length;k++)f.push(d.changed[k].newValue.symbol),g.push(d.changed[k].oldValue.symbol);return c?(b.defaultSymbol&&g.push(b.defaultSymbol),e.defaultSymbol&&f.push(e.defaultSymbol)):b.defaultSymbol&&f.length&&g.push(e.defaultSymbol),this.applySymbolSetDiff(f,g,e,b),delete a.diff.defaultSymbol,delete a.diff.uniqueValueInfos,!0}return!1},n.prototype.calculateUnchangedSymbolMapping=function(a,e,b){if(e instanceof c&&b instanceof c)if(a){if("partial"===a.type){var d=a.diff;
a=d.defaultSymbol;var d=d.uniqueValueInfos,f=void 0;return f=d?d.unchanged.map(function(a){return{oldId:a.oldValue.symbol.id,newId:a.newValue.symbol.id}}):b.uniqueValueInfos.map(function(a,b){return{oldId:a.symbol.id,newId:e.uniqueValueInfos[b].symbol.id}}),!a&&b.defaultSymbol&&f.push({oldId:b.defaultSymbol.id,newId:e.defaultSymbol.id}),f}}else if(b&&b.defaultSymbol)return[{oldId:b.defaultSymbol.id,newId:e.defaultSymbol.id}];return[]},n.prototype.updateUnchangedSymbolMappings=function(a,e,b){var c=
0;for(a=this.calculateUnchangedSymbolMapping(a,e,b);c<a.length;c++)if(b=a[c],e=b.oldId,b=b.newId,e&&e!==b){var d=this.graphicsBySymbol[e];delete this.graphicsBySymbol[e];void 0!==d&&(this.graphicsBySymbol[b]=d);d=this.symbols[e];delete this.symbols[e];void 0!==d&&(this.symbols[b]=d,d.symbol.id=b)}},n.prototype.applyRendererDiff=function(a,e,b){var d=!1;if(this.diffHasSymbolChange(a))return!1;if(e instanceof c&&b instanceof c&&this.applyUniqueValueRendererDiff(a,e,b)&&0===Object.keys(a.diff).length)return!0;
for(var f in this.graphicsBySymbol)if(b=this.symbols[f]){var g=this.graphicsBySymbol[f];if(!b.applyRendererDiff(a,e,g))return!1;if(!d)for(var k in g)if(g[k].isDraped()){this.layerView._notifyDrapedDataChange();d=!0;break}}return!0},n.prototype.opacityChange=function(){var a=!1,e;for(e in this.graphicsBySymbol){var b=this.symbols[e];if(b){var c=this.graphicsBySymbol[e];if(b.layerPropertyChanged("opacity"),!a)for(var d in c)if(c[d].isDraped()){this.layerView._notifyDrapedDataChange();a=!0;break}}}},
n.prototype.setClippingExtent=function(a,e){var b=this.symbolCreationContext.clippingExtent,c=[];return k.extentToBoundingRect(a,c,e)?this.symbolCreationContext.clippingExtent=[c[0],c[1],-(1/0),c[2],c[3],1/0]:this.symbolCreationContext.clippingExtent=null,!d.equals(this.symbolCreationContext.clippingExtent,b)},n.prototype.forEachGraphics3DGraphic=function(a){var e=this;if(this.layerView.loadedGraphics){var b=!1,c=!1;this.layerView.loadedGraphics.forEach(function(d){var f=e.getGraphics3DGraphicById(d.uid);
f&&a(f,d)&&(b=!0,c=c||f.isDraped())});b&&this.layerView.view.deconflictor.setDirty();c&&this.layerView._notifyDrapedDataChange()}},n.prototype.updateAllGraphicsVisibility=function(){var a=this;this.forEachGraphics3DGraphic(function(e,b){var c=e.setVisibilityFlag(0,b.visible),d=!1;return a.scaleVisibility&&(d=a.scaleVisibility.updateGraphicScaleVisibility(b,e)),c||d})},n.prototype.hideAllGraphics=function(){this.forEachGraphics3DGraphic(function(a){return a.setVisibilityFlag(0,!1)})},n.prototype.validateRenderer=
function(a){(a=t.validateTo3D(a))&&f.warn("Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView",a.message)},n.prototype.volatileGraphicsUpdated=function(){this.labeling&&(this.lastFastUpdate=performance.now());this.stageLayer.invalidateSpatialQueryAccelerator();this.stageLayer.shaderTransformationChanged();this.layerView._evaluateUpdatingState()},n.createLocalOriginFactory=function(){return new b(5E6,16)},n.prototype.snapshotInternals=
function(){var a=this;return{graphics:Object.keys(this.graphics).sort(),symbols:Object.keys(this.symbols).sort(),graphicsBySymbol:Object.keys(this.graphicsBySymbol).sort().map(function(e){return{symbolId:e,graphics:Object.keys(a.graphicsBySymbol[e]).sort()}}),graphicsWithoutSymbol:Object.keys(this.graphicsWithoutSymbol).sort(),graphicsDrapedIds:Object.keys(this.graphicsDrapedIds).sort()}},n.tmpVec=M.vec3d.create(),n}()})},"esri/core/tsSupport/generatorHelper":function(){define([],function(){return function(A,
p){function w(a){return function(c){return l([a,c])}}function l(k){if(h)throw new TypeError("Generator is already executing.");for(;a;)try{if(h=1,d&&(u=d[2&k[0]?"return":k[0]?"throw":"next"])&&!(u=u.call(d,k[1])).done)return u;switch(d=0,u&&(k=[0,u.value]),k[0]){case 0:case 1:u=k;break;case 4:return a.label++,{value:k[1],done:!1};case 5:a.label++;d=k[1];k=[0];continue;case 7:k=a.ops.pop();a.trys.pop();continue;default:if(u=a.trys,!(u=0<u.length&&u[u.length-1])&&(6===k[0]||2===k[0])){a=0;continue}if(3===
k[0]&&(!u||k[1]>u[0]&&k[1]<u[3]))a.label=k[1];else if(6===k[0]&&a.label<u[1])a.label=u[1],u=k;else if(u&&a.label<u[2])a.label=u[2],a.ops.push(k);else{u[2]&&a.ops.pop();a.trys.pop();continue}}k=p.call(A,a)}catch(c){k=[6,c],d=0}finally{h=u=0}if(5&k[0])throw k[1];return{value:k[0]?k[1]:void 0,done:!0}}var h,d,u,r,a={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return r={next:w(0),"throw":w(1),"return":w(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),
r}})},"esri/core/tsSupport/awaiterHelper":function(){define(["dojo/Deferred","dojo/when"],function(A,p){return function(w,l,h,d){function u(c){try{a(d.next(c))}catch(t){k.reject(t)}}function r(c){try{a(d["throw"](c))}catch(t){k.reject(t)}}function a(a){a.done?p(a.value).then(k.resolve,k.reject):p(a.value).then(u,r)}var k=new A;return a((d=d.apply(w,l||[])).next()),k.promise}})},"esri/renderers/UniqueValueRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/accessorSupport/decorators ../core/lang ../core/urlUtils ../core/Logger ../core/arrayUtils ../core/Error ../core/accessorSupport/ensureType ../portal/Portal ../support/arcadeUtils ../symbols/WebStyleSymbol ../symbols/support/jsonUtils ../symbols/support/styleUtils ../symbols/support/typeUtils ./Renderer ./support/LegendOptions ./support/UniqueValueInfo ./support/diffUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E,J){var G=a.getLogger("esri.renderers.UniqueValueRenderer"),K=t.ensureType(E["default"]);return function(a){function b(b){b=a.call(this)||this;return b._valueInfoMap={},b._isDefaultSymbolDerived=!1,b.type="unique-value",b.field=null,b.field2=null,b.field3=null,b.valueExpression=null,b.valueExpressionTitle=null,b.legendOptions=null,b.defaultLabel=null,b.fieldDelimiter=null,b.portal=null,b.styleOrigin=null,b.diff={uniqueValueInfos:function(a,b){if(a||
b){if(!a||!b)return{type:"complete",oldValue:a,newValue:b};for(var c=!1,d={type:"collection",added:[],removed:[],changed:[],unchanged:[]},h=function(h){var l=k.find(a,function(a){return a.value===b[h].value});l?J.diff(l,b[h])?(d.changed.push({type:"complete",oldValue:l,newValue:b[h]}),c=!0):(d.unchanged.push({oldValue:l,newValue:b[h]}),c=!0):(d.added.push(b[h]),c=!0)},l=0;l<b.length;l++)h(l);h=function(h){k.find(b,function(b){return b.value===a[h].value})||(d.removed.push(a[h]),c=!0)};for(l=0;l<a.length;l++)h(l);
return c?d:void 0}}},b._set("uniqueValueInfos",[]),b}return w(b,a),p=b,b.prototype.writeType=function(a,b,c,d){b.type="uniqueValue"},b.prototype.castField=function(a){return null==a?a:"function"==typeof a?a:t.ensureString(a)},b.prototype.writeField=function(a,b,d,k){"string"==typeof a?b[d]=a:k&&k.messages?k.messages.push(new c("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):G.error(".field: cannot write field to JSON since it's not a string value")},
Object.defineProperty(b.prototype,"compiledFunc",{get:function(){return q.createFunction(this.valueExpression)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"defaultSymbol",{set:function(a){this._isDefaultSymbolDerived=!1;this._set("defaultSymbol",a)},enumerable:!0,configurable:!0}),b.prototype.readDefaultSymbol=function(a,b,c){return y.read(a,b,c)},b.prototype.writeDefaultSymbolWebScene=function(a,b,c,d){this._isDefaultSymbolDerived||y.writeTarget(a,b,c,d)},b.prototype.writeDefaultSymbol=
function(a,b,c,d){this._isDefaultSymbolDerived||y.writeTarget(a,b,c,d)},b.prototype.readPortal=function(a,b,c){return c.portal||C.getDefault()},b.prototype.readStyleOrigin=function(a,b,c){if(b.styleName)return Object.freeze({styleName:b.styleName});if(b.styleUrl)return a=r.read(b.styleUrl,c),Object.freeze({styleUrl:a})},b.prototype.writeStyleOrigin=function(a,b,c,d){a.styleName?b.styleName=a.styleName:a.styleUrl&&(b.styleUrl=r.write(a.styleUrl,d),r.isAbsolute(b.styleUrl)&&(b.styleUrl=r.normalize(b.styleUrl)))},
Object.defineProperty(b.prototype,"uniqueValueInfos",{set:function(a){return this.styleOrigin?void G.error("#uniqueValueInfos\x3d","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",a),void this._updateValueInfoMap())},enumerable:!0,configurable:!0}),b.prototype.addUniqueValueInfo=function(a,b){if(this.styleOrigin)return void G.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");
a="object"==typeof a?K(a):new E["default"]({value:a,symbol:b});this.uniqueValueInfos.push(a);this._valueInfoMap[a.value]=a},b.prototype.removeUniqueValueInfo=function(a){if(this.styleOrigin)return void G.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");for(var b=0;b<this.uniqueValueInfos.length;b++)if(this.uniqueValueInfos[b].value===a+""){delete this._valueInfoMap[a];this.uniqueValueInfos.splice(b,1);break}},b.prototype.getUniqueValueInfo=
function(a,b){var c,d=this.field,k=a.attributes;this.valueExpression?c=q.executeFunction(this.compiledFunc,q.createExecContext(a,q.getViewInfo(b))):"function"!=typeof d&&this.field2?(a=this.field2,b=this.field3,c=[],d&&c.push(k[d]),a&&c.push(k[a]),b&&c.push(k[b]),c=c.join(this.fieldDelimiter||"")):"function"==typeof d?c=d(a):d&&(c=k[d]);return this._valueInfoMap[c+""]},b.prototype.getSymbol=function(a,b){return(a=this.getUniqueValueInfo(a,b))&&a.symbol||this.defaultSymbol},b.prototype.getSymbols=
function(){for(var a=[],b=0,c=this.uniqueValueInfos;b<c.length;b++){var d=c[b];d.symbol&&a.push(d.symbol)}return this.defaultSymbol&&a.push(this.defaultSymbol),a},b.prototype.clone=function(){var a=new p({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:u.clone(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:u.clone(this.visualVariables),legendOptions:u.clone(this.legendOptions),
authoringInfo:this.authoringInfo&&this.authoringInfo.clone()});this._isDefaultSymbolDerived&&(a._isDefaultSymbolDerived=!0);a._set("portal",this.portal);var b=u.clone(this.uniqueValueInfos);return this.styleOrigin&&(a._set("styleOrigin",Object.freeze(u.clone(this.styleOrigin))),Object.freeze(b)),a._set("uniqueValueInfos",b),a._updateValueInfoMap(),a},b.prototype.collectRequiredFields=function(a){this.inherited(arguments);[this.field,this.field2,this.field3].forEach(function(b){b&&"string"==typeof b&&
(a[b]=!0)});this.valueExpression&&q.extractFieldNames(this.valueExpression).forEach(function(b){a[b]=!0})},b.prototype.populateFromStyle=function(){var a=this;return B.fetchStyle(this.styleOrigin,{portal:this.portal}).then(function(b){var c=[];return a._valueInfoMap={},b&&b.data&&Array.isArray(b.data.items)&&b.data.items.forEach(function(d){var k=new v({styleUrl:b.styleUrl,styleName:b.styleName,portal:a.portal,name:d.name});a.defaultSymbol||d.name!==b.data.defaultItem||(a.defaultSymbol=k,a._isDefaultSymbolDerived=
!0);k=new E["default"]({value:d.name,symbol:k});c.push(k);a._valueInfoMap[d.name]=k}),a._set("uniqueValueInfos",Object.freeze(c)),!a.defaultSymbol&&a.uniqueValueInfos.length&&(a.defaultSymbol=a.uniqueValueInfos[0].symbol,a._isDefaultSymbolDerived=!0),a})},b.prototype._updateValueInfoMap=function(){var a=this;this._valueInfoMap={};this.uniqueValueInfos.forEach(function(b){return a._valueInfoMap[b.value+""]=b})},b.fromPortalStyle=function(a,b){var c=new p(b&&b.properties);c._set("styleOrigin",Object.freeze({styleName:a}));
c._set("portal",b&&b.portal||C.getDefault());b=c.populateFromStyle();return b.otherwise(function(b){G.error("#fromPortalStyle('"+a+"'[, ...])","Failed to create unique value renderer from style name",b)}),b},b.fromStyleUrl=function(a,b){b=new p(b&&b.properties);b._set("styleOrigin",Object.freeze({styleUrl:a}));b=b.populateFromStyle();return b.otherwise(function(b){G.error("#fromStyleUrl('"+a+"'[, ...])","Failed to create unique value renderer from style URL",b)}),b},l([d.property()],b.prototype,"type",
void 0),l([d.writer("type")],b.prototype,"writeType",null),l([d.property({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],b.prototype,"field",void 0),l([d.cast("field")],b.prototype,"castField",null),l([d.writer("field")],b.prototype,"writeField",null),l([d.property({type:String,json:{write:!0}})],b.prototype,"field2",void 0),l([d.property({type:String,json:{write:!0}})],b.prototype,"field3",void 0),l([d.property({type:String,json:{write:!0}})],b.prototype,"valueExpression",void 0),
l([d.property({type:String,json:{write:!0}})],b.prototype,"valueExpressionTitle",void 0),l([d.property({dependsOn:["valueExpression"]})],b.prototype,"compiledFunc",null),l([d.property({type:m["default"],json:{write:!0}})],b.prototype,"legendOptions",void 0),l([d.property({type:String,json:{write:!0}})],b.prototype,"defaultLabel",void 0),l([d.property({types:D.types})],b.prototype,"defaultSymbol",null),l([d.reader("defaultSymbol")],b.prototype,"readDefaultSymbol",null),l([d.writer("web-scene","defaultSymbol",
{defaultSymbol:{types:D.types3D}})],b.prototype,"writeDefaultSymbolWebScene",null),l([d.writer("defaultSymbol")],b.prototype,"writeDefaultSymbol",null),l([d.property({type:String,json:{write:!0}})],b.prototype,"fieldDelimiter",void 0),l([d.property({type:C,readOnly:!0})],b.prototype,"portal",void 0),l([d.reader("portal",["styleName"])],b.prototype,"readPortal",null),l([d.property({readOnly:!0})],b.prototype,"styleOrigin",void 0),l([d.reader("styleOrigin",["styleName","styleUrl"])],b.prototype,"readStyleOrigin",
null),l([d.writer("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],b.prototype,"writeStyleOrigin",null),l([d.property({type:[E["default"]],json:{write:{overridePolicy:function(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],b.prototype,"uniqueValueInfos",null),l([d.property({dependsOn:["field","field2","field3","valueExpression"],readOnly:!0})],b.prototype,"requiredFields",void 0),l([h(1,d.cast(D.ensureType))],b.prototype,"addUniqueValueInfo",null),b=p=l([d.subclass("esri.renderers.UniqueValueRenderer")],
b);var p}(d.declared(b))})},"esri/symbols/support/styleUtils":function(){define("require exports ../Symbol3D ./jsonUtils ./Thumbnail ./StyleOrigin ../../core/urlUtils ../../core/promiseUtils ../../core/Error ../../request ../../portal/Portal ../../portal/PortalQueryParams".split(" "),function(A,p,w,l,h,d,u,r,a,k,c,t){function C(a,b){return D(a).then(function(b){return{data:b.data,baseUrl:u.removeFile(a),styleUrl:a}})}function q(a,d){var k;d=d.portal||c.getDefault();var h=d.url+" - "+(d.user&&d.user.username)+
" - "+a;return b[h]||(b[h]=v(a,d).then(function(a){return k=a,a.fetchData()}).then(function(b){return{data:b,baseUrl:k.itemUrl,styleName:a}})),b[h]}function v(b,c){return c.load().then(function(){var a=new t({disableExtraQuery:!0,query:"owner:"+m+" AND type:"+E+' AND typekeywords:"'+b+'"'});return c.queryItems(a)}).then(function(c){c=c.results;var d=null,k=b.toLowerCase();if(c&&Array.isArray(c))for(var h=0;h<c.length;h++){var l=c[h];if(l.typeKeywords.some(function(a){return a.toLowerCase()===k})&&
l.type===E&&l.owner===m){d=l;break}}if(d)return d.load();throw new a("symbolstyleutils:style-not-found","The style '"+b+"' could not be found",{styleName:b});})}function y(b,c){return b.styleUrl?C(b.styleUrl,c):b.styleName?q(b.styleName,c):r.reject(new a("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function B(b,c,k){for(var m=b.data,q={portal:k.portal,url:u.urlToObject(b.baseUrl),origin:"portal-item"},t=function(a){if(a.name!==c)return"continue";
var m=u.read(a.webRef,q),r={portal:k.portal,url:u.urlToObject(u.removeFile(m)),origin:"portal-item"};return{value:D(m).then(function(m){if((m=l.fromJSON(m.data,r))&&m.isInstanceOf(w)){if(a.thumbnail)if(a.thumbnail.href){var t=u.read(a.thumbnail.href,q);m.thumbnail=new h["default"]({url:t})}else a.thumbnail.imageData&&(m.thumbnail=new h["default"]({url:"data:image/png;base64,"+a.thumbnail.imageData}));b.styleUrl?m.styleOrigin=new d({portal:k.portal,styleUrl:b.styleUrl,name:c}):b.styleName&&(m.styleOrigin=
new d({portal:k.portal,styleName:b.styleName,name:c}))}return m})}},p=0,m=m.items;p<m.length;p++){var v=t(m[p]);if("object"==typeof v)return v.value}return r.reject(new a("symbolstyleutils:symbol-name-not-found","The symbol name '"+c+"' could not be found",{symbolName:c}))}function D(a){var b={responseType:"json"};return b.query={f:"json"},k(u.normalize(a),b)}Object.defineProperty(p,"__esModule",{value:!0});var b={};p.fetchStyle=y;p.resolveWebStyleSymbol=function(b,c){return b.name?y(b,c).then(function(a){return B(a,
b.name,c)}):r.reject(new a("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))};p.fetchSymbolFromStyle=B;p.styleNameFromItem=function(a){var b=0;for(a=a.typeKeywords;b<a.length;b++){var c=a[b];if(/^Esri.*Style$/.test(c)&&"Esri Style"!==c)return c}};var m="esri_en",E="Style"})},"esri/renderers/Renderer":function(){define("../core/declare ../core/Accessor ../core/JSONSupport ../core/kebabDictionary ../core/screenUtils ../core/lang ../core/Error ../support/arcadeUtils dojo/_base/lang ../Color ./support/utils ./support/AuthoringInfo".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t){var C=l({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),q=l({widthAndDepth:"width-and-depth"}),v=l({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"}),y=(l({classedSize:"classed-size",classedColor:"classed-color",univariateColorSize:"univariate-color-size"}),
l({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),l({percentTotal:"percent-of-total"}),Math.PI);return A([p,w],{declaredClass:"esri.renderers.Renderer",properties:{authoringInfo:{type:t,value:null,json:{write:!0}},requiredFields:{dependsOn:["visualVariables"],get:function(){var a=Object.create(null);return this.collectRequiredFields(a),Object.keys(a)}},
type:{type:String,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}},visualVariables:{json:{read:{source:["visualVariables","rotationType","rotationExpression"],reader:function(a,c){return this._readVariables(a,c)}},write:function(a,c,b,d){var k=[];a.forEach(function(a,b){"size"===a.type?k.push(this._writeSizeInfo(a,d,b)):"color"===a.type?k.push(this._writeColorInfo(a,d,b)):"opacity"===a.type?k.push(this._writeOpacityInfo(a,d,b)):"rotation"===a.type&&k.push(this._writeRotationInfo(a,d,b))},this);
c.visualVariables=k}}}},constructor:function(){this._cache={}},_rotationRE:/^\[([^\]]+)\]$/i,_viewScaleRE:/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,_visualVariablesSetter:function(a){var c=this._cache;this.visualVariables&&this.visualVariables.forEach(function(a,d){c.hasOwnProperty(d)&&(c[d]=null)},this);a&&a.some(function(a){return!!a.target})&&a.sort(function(a,c){return a.target===c.target?0:a.target?1:-1});a&&a.forEach(function(a,d){"color"===a.type?c[d]=this._processColorInfo(a):"opacity"===
a.type?c[d]=this._processOpacityInfo(a):"size"===a.type?c[d]=this._processSizeInfo(a):"rotation"===a.type&&(c[d]=this._processRotationInfo(a))},this);this._set("visualVariables",a)},getSymbol:function(a,c){},getVisualVariableValues:function(c,d){var b,k=this.visualVariables;return k&&(b=k.map(function(b){var k,h=b.type,l=h+"Info";switch(d=a.mixin({},d),d[l]=b,h){case "size":k=this.getSize(c,d);break;case "color":k=this.getColor(c,d);break;case "opacity":k=this.getOpacity(c,d);break;case "rotation":k=
this.getRotationAngle(c,d)}return{variable:b,value:k}},this).filter(function(a){return null!=a.value},this)),b},hasVisualVariables:function(a,c){return a?!!this.getVisualVariablesForType(a,c):!!(this.getVisualVariablesForType("size",c)||this.getVisualVariablesForType("color",c)||this.getVisualVariablesForType("opacity",c)||this.getVisualVariablesForType("rotation",c))},getVisualVariablesForType:function(a,c){var b,d=this.visualVariables;return d&&(b=d.filter(function(b){return b.type===a&&("string"==
typeof c?b.target===c:!1===c?!b.target:!0)}),b&&0===b.length&&(b=void 0)),b},getSize:function(a,c){var b=this._getVarInfo(c&&c.sizeInfo,"size"),d=b.variable,b=this._cache[b.cacheKey],k=null;if(d)var h=d.minSize,k=d.maxSize,h="object"==typeof h&&h?this._getSize(a,h,b&&b.minSize,c):h,k="object"==typeof k&&k?this._getSize(a,k,b&&b.maxSize,c):k,k=this._getSize(a,d,b&&b.root,c,[h,k]);return k},getSizeRangeAtScale:function(a,c){var b,d=this._getVarInfo(a,"size"),k=this._cache[d.cacheKey],h={scale:c};if(a=
d.variable,a&&c)if(c=a.minSize,a=a.maxSize,c="object"==typeof c&&c?this._getSize({},c,k&&k.minSize,h):c,k="object"==typeof a&&a?this._getSize({},a,k&&k.maxSize,h):a,null!=c||null!=k)c>k&&(c=k=c),b={minSize:c,maxSize:k};return b},getColor:function(a,c){var b=this._getVarInfo(c&&c.colorInfo,"color");return this._getColorComponent(a,b.variable,this._cache[b.cacheKey],c)},getOpacity:function(a,c){var b=this._getVarInfo(c&&c.opacityInfo,"opacity");return this._getColorComponent(a,b.variable,this._cache[b.cacheKey],
c,!0)},getRotationAngle:function(c,d){var b=this._getVarInfo(d&&d.rotationInfo,"rotation"),k=b.variable,h=this._cache[b.cacheKey],l=k.axis||"heading",b="heading"===l&&"arithmetic"===k.rotationType?90:0,l="heading"===l&&"arithmetic"===k.rotationType?-1:1,k=k.field,h=h&&h.compiledFunc,q=c.attributes,t=0;return(k||h)&&(h?t=r.executeFunction(h,r.createExecContext(c,r.getViewInfo(d))):a.isFunction(k)?t=k.apply(this,arguments):q&&(t=q[k]||0),t="number"!=typeof t||isNaN(t)?null:b+l*t),t},collectRequiredFields:function(a){var c=
[];this.visualVariables&&(c=c.concat(this.visualVariables));c.forEach(function(b){b&&(b.field&&(a[b.field]=!0),b.normalizationField&&(a[b.normalizationField]=!0),b.valueExpression&&r.extractFieldNames(b.valueExpression).forEach(function(b){a[b]=!0}))})},_getVarInfo:function(a,c){var b;a&&a.type===c&&this.visualVariables?(b=this.visualVariables.indexOf(a),a=this.visualVariables[b]):this.visualVariables&&(a=(a=this.getVisualVariablesForType(c))&&a[0],b=this.visualVariables.indexOf(a));return{variable:a,
cacheKey:b}},_readSizeInfo:function(a){return a.axis&&(a.axis=q.fromJSON(a.axis)),a.valueUnit&&(a.valueUnit=v.fromJSON(a.valueUnit)),a},_readColorInfo:function(c){return c&&(c.colors&&c.colors.forEach(function(d,b){a.isArray(d)?c.colors[b]=k.fromJSON(d):c.colors[b]=new k(d)}),c.stops&&c.stops.forEach(function(d,b){d.color&&a.isArray(d.color)?c.stops[b].color=k.fromJSON(d.color):d.color&&(c.stops[b].color=new k(d.color))})),c},_readOpacityInfo:function(c){var d;return c&&(d=a.mixin({},c),d.transparencyValues&&
(d.opacityValues=d.transparencyValues.map(function(a){return 1-a/100}),delete d.transparencyValues),d.stops&&(d.stops=d.stops.map(function(b){return b=a.mixin({},b),b.opacity=1-b.transparency/100,delete b.transparency,b}))),d},_readVariables:function(a,c){a&&(a=a.map(function(a){return a=d.clone(a),a.type=C.fromJSON(a.type),"size"===a.type?a=this._readSizeInfo(a):"color"===a.type?a=this._readColorInfo(a):"opacity"===a.type&&(a=this._readOpacityInfo(a)),a},this));var b=c.rotationType;if(c=c.rotationExpression)b=
{type:"rotation",rotationType:b},(c=c.match(this._rotationRE))&&c[1]&&(b.field=c[1],a||(a=[]),a.push(b));return a},_createCache:function(a){var c=a&&a.valueExpression,b=r.createSyntaxTree(c),b=r.createFunction(b),d=!(!a||!a.expression)||this._viewScaleRE.test(c);return{ipData:this._interpolateData(a),hasExpr:!!c,compiledFunc:b,isScaleDriven:d}},_processColorInfo:function(a){return a&&(a.colors&&a.colors.forEach(function(c,b){c instanceof k||(a.colors[b]=new k(c))}),a.stops&&a.stops.forEach(function(c,
b){!c.color||c.color instanceof k||(a.stops[b].color=new k(c.color))}),this._sortStops(a.stops)),this._createCache(a)},_processOpacityInfo:function(a){return this._sortStops(a&&a.stops),this._createCache(a)},_processSizeInfo:function(a){return a.stops&&Array.isArray(a.stops)?a.stops=this._processSizeInfoStops(a.stops):(a.minSize=a.minSize&&this._processSizeInfoSize(a.minSize),a.maxSize=a.maxSize&&this._processSizeInfoSize(a.maxSize)),{root:this._createCache(a),minSize:this._createCache(a.minSize),
maxSize:this._createCache(a.maxSize)}},_processSizeInfoSize:function(a){return"object"==typeof a?a.stops=this._processSizeInfoStops(a.stops):a=h.toPt(a),a},_processSizeInfoStops:function(a){return a&&Array.isArray(a)&&(a.forEach(function(a){a.size=h.toPt(a.size)}),this._sortStops(a)),a},_sortStops:function(a){a&&Array.isArray(a)&&a.sort(function(a,b){return a.value-b.value})},_processRotationInfo:function(a){return this._createCache(a)},_getSize:function(d,k,b,h,l){var m=d.attributes,q=k.field,t=
k.stops,p=0,v=b&&b.hasExpr,u=b&&b.compiledFunc,w=b&&b.ipData,C=b&&b.isScaleDriven,E="number"==typeof d,B=E?d:null;if(q||C||v){var D,A=h&&h.scale,z=l?l[0]:k.minSize,Z=l?l[1]:k.maxSize,O=k.minDataValue,g=k.maxDataValue,e=k.valueUnit||"unknown",f=k.valueRepresentation,n=k.scaleBy,x=k.normalizationField,I=m?parseFloat(m[x]):void 0,L=h&&h.shape;if(C?B=null==A?this._getAverageValue(k):A:"number"!=typeof B&&(v?B=r.executeFunction(u,r.createExecContext(d,r.getViewInfo(h))):a.isFunction(q)?B=q.apply(this,
arguments):m&&(B=m[q])),null==B||x&&!E&&(isNaN(I)||0===I))return null;if(isNaN(I)||E||(B/=I),t){var P,Y,Z=this._lookupData(B,w);D=Z[0];z=Z[1];D===z?p=t[D].size:(P=t[D].size,Y=t[z].size,p=P+(Y-P)*Z[2])}else null!=z&&null!=Z&&null!=O&&null!=g?O>=B?p=z:B>=g?p=Z:(D=(B-O)/(g-O),"area"===n&&L)?(t=(p="circle"===L)?y*Math.pow(z/2,2):z*z,t+=D*((p?y*Math.pow(Z/2,2):Z*Z)-t),p=p?2*Math.sqrt(t/y):Math.sqrt(t)):p=z+D*(Z-z):"unknown"===e?null!=z&&null!=O?(z&&O?(D=B/O,p="circle"===L?2*Math.sqrt(D*Math.pow(z/2,2)):
"square"===L||"diamond"===L||"image"===L?Math.sqrt(D*Math.pow(z,2)):D*z):p=B+(z||O),p=z>p?z:p,null!=Z&&p>Z&&(p=Z)):p=B:(t=(h&&h.resolution?h.resolution:1)*c.meterIn[e],"area"===f?(p=Math.sqrt(B/y)/t,p*=2):(p=B/t,("radius"===f||"distance"===f)&&(p*=2)),null!=z&&z>p&&(p=z),null!=Z&&p>Z&&(p=Z))}else k&&(p=t&&t[0]&&t[0].size,null==p&&(p=k.minSize));return p=isNaN(p)?0:p},_getAverageValue:function(a){var c,b,d=a.stops;return d?(c=d[0].value,b=d[d.length-1].value):(c=a.minDataValue||0,b=a.maxDataValue||
0),(c+b)/2},_getColorComponent:function(c,d,b,k,h,l){var m,q=c.attributes,t=d&&d.field,p="number"==typeof c,v=p?c:null,u=b&&b.hasExpr,w=b&&b.compiledFunc,y=b&&b.ipData;if(t||u){var C=d.normalizationField,E=q?parseFloat(q[C]):void 0;"number"!=typeof v&&(u?v=r.executeFunction(w,r.createExecContext(c,r.getViewInfo(k))):a.isFunction(t)?v=t.apply(this,arguments):q&&(v=q[t]));null==v||C&&!p&&(isNaN(E)||0===E)||(isNaN(E)||p||(v/=E),m=h?this._getOpacity(v,d,y):this._getColor(v,d,y))}else d&&(q=d.stops,h?
(m=q&&q[0]&&q[0].opacity,null==m&&(m=d.opacityValues&&d.opacityValues[0])):m=q&&q[0]&&q[0].color||d.colors&&d.colors[0]);return l&&(l.data=v,l.value=m),l||m},_interpolateData:function(a){var c;if(a)if(a.colors||a.opacityValues){var b=(a.colors||a.opacityValues).length,d=a.minDataValue,k=(a.maxDataValue-d)/(b-1);c=[];for(a=0;b>a;a++)c[a]=d+a*k}else a.stops&&(c=a.stops.map(function(a){return a.value}));return c},_getOpacity:function(a,c,b){var d;a=this._lookupData(a,b);if(c=c||this.opacityInfo,a){var k,
h;b=a[0];var l=a[1];b===l?d=this._getOpacValue(c,b):(k=this._getOpacValue(c,b),h=this._getOpacValue(c,l),d=k+(h-k)*a[2])}return d},_getOpacValue:function(a,c){return a.opacityValues?a.opacityValues[c]:a.stops[c].opacity},_getColor:function(a,c,b){var d;a=this._lookupData(a,b);if(c=c||this.colorInfo,a)d=a[0],b=a[1],d=d===b?this._getColorObj(c,d):k.blendColors(this._getColorObj(c,d),this._getColorObj(c,b),a[2]),d=new k(d);return d},_getColorObj:function(a,c){return a.colors?a.colors[c]:a.stops[c].color},
_lookupData:function(a,c){var b;if(c){var d=0,k=c.length-1;c.some(function(b,c){return b>a?(k=c,!0):(d=c,!1)});b=[d,k,(a-c[d])/(c[k]-c[d])]}return b},_processForContext:function(a,c,b){if(c&&"web-scene"===c.origin){var d=null!=a.expression,k=null!=a.valueExpressionTitle&&"rotation"===a.type;c.messages&&(d&&c.messages.push(new u("property:unsupported",a.type+"VisualVariable.expression is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:b+".expression",
context:c})),k&&c.messages.push(new u("property:unsupported",a.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:b+".valueExpressionTitle",context:c})));d&&delete a.expression;k&&delete a.valueExpressionTitle}else"size"===a.type&&this._convertExpressionToArcade(a)},_writeRotationInfo:function(c,k,b){return c&&(c=a.mixin({},c),this._processForContext(c,k,"visualVariables["+b+"]"),c.type=C.toJSON(c.type),
c=d.fixJson(c,!0)),c},_convertExpressionToArcade:function(a){a&&a.expression&&(a.valueExpression="$view.scale")},_writeSizeInfo:function(c,k,b){if(c){c=a.mixin({},c);this._processForContext(c,k,"string"==typeof b?b:"visualVariables["+b+"]");var h=c.minSize,l=c.maxSize;h&&(c.minSize="number"==typeof h?h:this._writeSizeInfo(h,k,"visualVariables["+b+"].minSize"));l&&(c.maxSize="number"==typeof l?l:this._writeSizeInfo(l,k,"visualVariables["+b+"].maxSize"));k=c.legendOptions;b=c.axis;c.type=C.toJSON(c.type);
b&&(c.axis=q.toJSON(b));k&&(c.legendOptions=a.mixin({},k),k=k.customValues,k&&(c.legendOptions.customValues=k.slice(0)));c.stops&&(c.stops=c.stops.map(function(b){return b=a.mixin({},b),null===b.label&&delete b.label,b}));c=d.fixJson(c,!0)}return c},_writeColorInfo:function(c,h,b){return c&&(c=a.mixin({},c),this._processForContext(c,h,"visualVariables["+b+"]"),c.type=C.toJSON(c.type),c.colors&&(c.colors=c.colors.map(function(a){return k.toJSON(a)})),c.stops&&(c.stops=c.stops.map(function(b){return b=
a.mixin({},b),b.color&&(b.color=k.toJSON(b.color)),null===b.label&&delete b.label,b})),c.legendOptions&&(c.legendOptions=a.mixin({},c.legendOptions)),c=d.fixJson(c,!0)),c},_writeOpacityInfo:function(c,k,b){var h;return c&&(h=a.mixin({},c),this._processForContext(h,k,"visualVariables["+b+"]"),h.type=C.toJSON(h.type),h.opacityValues&&(h.transparencyValues=h.opacityValues.map(function(a){return Math.max(0,Math.min(Math.round(100*(1-a)),100))}),delete h.opacityValues),h.stops&&(h.stops=h.stops.map(function(b){b=
a.mixin({},b);return b.transparency=Math.max(0,Math.min(Math.round(100*(1-b.opacity)),100)),delete b.opacity,null===b.label&&delete b.label,b})),h.legendOptions&&(h.legendOptions=a.mixin({},h.legendOptions)),h=d.fixJson(h,!0)),h}})})},"esri/renderers/support/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/date/locale ../../Color ../../core/numberUtils dojo/i18n!dojo/cldr/nls/gregorian".split(" "),function(A,p,w,l,h,d){function u(a){return a&&p.map(a,function(a){return new l(a)})}function r(a,
c,d){var h="";return 0===c?h=k.lt+" ":c===d&&(h=k.gt+" "),h+a}var a={},k={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%",ld:"\u2013"},c={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},t={millisecond:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},
day:{selector:"date",dateOptions:{formatLength:"long"}},month:{selector:"date",dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},C={formatLength:"short",fullYear:!0},q={formatLength:"short"};return A.mixin(a,{meterIn:{inches:1/.0254,feet:1/.3048,"us-feet":3.28084,yards:1/.9144,miles:1/1609.344,"nautical-miles":1/1852,millimeters:1E3,centimeters:100,decimeters:10,meters:1,kilometers:.001,"decimal-degrees":180/20015077},timelineDateFormatOptions:{selector:"date",
dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(a,c){var k,h=[];null==a||a instanceof Date||(a=new Date(a));c=c||{};c=A.mixin({},c);var b=c.selector?c.selector.toLowerCase():null,l=!b||-1<b.indexOf("time"),b=!b||-1<b.indexOf("date");return l&&(c.timeOptions=c.timeOptions||q,c.timeOptions&&(c.timeOptions=A.mixin({},c.timeOptions),c.timeOptions.selector=c.timeOptions.selector||"time",h.push(c.timeOptions))),b&&(c.dateOptions=c.dateOptions||C,c.dateOptions&&(c.dateOptions=A.mixin({},
c.dateOptions),c.dateOptions.selector=c.dateOptions.selector||"date",h.push(c.dateOptions))),h&&h.length?(h=p.map(h,function(b){return w.format(a,b)}),k=1==h.length?h[0]:d["dateTimeFormat-medium"].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(a,b){return h[b]})):k=w.format(a),k},createColorStops:function(c){var d=c.values,k=c.colors,l=c.labelIndexes,b=c.isDate,m=c.dateFormatOptions;return p.map(d,function(c,q){var t=null;if(!l||-1<p.indexOf(l,q)){var v;(v=b?a.formatDate(c,m):h.format(c))&&(t=r(v,
q,d.length-1))}return{value:c,color:k[q],label:t}})},updateColorStops:function(c){var d,k=c.stops,l=c.changes,b=c.isDate,m=c.dateFormatOptions,q=[],t=p.map(k,function(a){return a.value});p.forEach(l,function(a){q.push(a.index);t[a.index]=a.value});d=h.round(t,{indexes:q});p.forEach(k,function(c,l){if(c.value=t[l],null!=c.label){var q,p=null;(q=b?a.formatDate(d[l],m):h.format(d[l]))&&(p=r(q,l,k.length-1));c.label=p}})},createClassBreakLabel:function(a){var c=a.minValue,d=a.maxValue,l=a.isFirstBreak?
"":k.gt+" ";a="percent-of-total"===a.normalizationType?k.pct:"";return c=null==c?"":h.format(c),d=null==d?"":h.format(d),l+c+a+" "+k.ld+" "+d+a},setLabelsForClassBreaks:function(c){var d=c.classBreakInfos,k=c.classificationMethod,l=c.normalizationType,b=[];d&&d.length&&("standard-deviation"===k?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):c.round?(b.push(d[0].minValue),p.forEach(d,function(a){b.push(a.maxValue)}),b=h.round(b),
p.forEach(d,function(c,d){c.label=a.createClassBreakLabel({minValue:0===d?b[0]:b[d],maxValue:b[d+1],isFirstBreak:0===d,normalizationType:l})})):p.forEach(d,function(b,c){b.label=a.createClassBreakLabel({minValue:b.minValue,maxValue:b.maxValue,isFirstBreak:0===c,normalizationType:l})}))},updateClassBreak:function(c){var d,k=c.classBreaks,h=c.normalizationType,b=c.change,l=b.index,b=b.value,q=-1,r=-1,t=k.length;return"standard-deviation"===c.classificationMethod?void console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):
(0===l?q=l:l===t?r=l-1:(r=l-1,q=l),-1<q&&t>q&&(d=k[q],d.minValue=b,d.label=a.createClassBreakLabel({minValue:d.minValue,maxValue:d.maxValue,isFirstBreak:0===q,normalizationType:h})),void(-1<r&&t>r&&(d=k[r],d.maxValue=b,d.label=a.createClassBreakLabel({minValue:d.minValue,maxValue:d.maxValue,isFirstBreak:0===r,normalizationType:h}))))},calculateDateFormatInterval:function(a){var d,k,h,b,l,q,r,t,v,u=a.length,w=1/0;a=p.map(a,function(a){return new Date(a)});for(d=0;u-1>d;d++){h=a[d];l=[];r=1/0;t="";
for(k=d+1;u>k;k++)b=a[k],b=h.getFullYear()!==b.getFullYear()&&"year"||h.getMonth()!==b.getMonth()&&"month"||h.getDate()!==b.getDate()&&"day"||h.getHours()!==b.getHours()&&"hour"||h.getMinutes()!==b.getMinutes()&&"minute"||h.getSeconds()!==b.getSeconds()&&"second"||"millisecond",q=c[b],r>q&&(r=q,t=b),l.push(b);w>r&&(w=r,v=t)}return v},createUniqueValueLabel:function(c){var d=c.value,k=c.fieldInfo,l=c.domain;c=c.dateFormatInterval;var b=String(d),l=l&&l.codedValues?l.getName(d):null;return l?b=l:"number"==
typeof d&&(b=k&&"date"===k.type?a.formatDate(d,c&&t[c]):h.format(d)),b},cloneColorVariable:function(a){var c;return a&&(c=A.mixin({},a),c.colors=u(c.colors),c.stops=c.stops&&p.map(c.stops,function(a){return a=A.mixin({},a),a.color&&(a.color=new l(a.color)),a}),c.legendOptions&&(c.legendOptions=A.mixin({},c.legendOptions))),c},cloneOpacityVariable:function(a){var c;a&&(c=A.mixin({},a),(a=c.opacityValues)&&(c.opacityValues=a.slice(0)),(a=c.stops)&&(c.stops=p.map(a,function(a){return A.mixin({},a)})),
(a=c.legendOptions)&&(c.legendOptions=A.mixin({},a)));return c},cloneSizeVariable:function(c){var d;c&&(d=A.mixin({},c),d.stops&&(d.stops=p.map(d.stops,function(a){return A.mixin({},a)})),(c=d.minSize)&&"object"==typeof c&&(d.minSize=a.cloneSizeVariable(c)),(c=d.maxSize)&&"object"==typeof c&&(d.maxSize=a.cloneSizeVariable(c)),(c=d.legendOptions)&&(d.legendOptions=A.mixin({},c),c=c.customValues,c&&(d.legendOptions.customValues=c.slice(0))));return d}}),a})},"esri/core/numberUtils":function(){define(["dojo/number",
"dojo/i18n!dojo/cldr/nls/number"],function(A,p){function w(d,a){return d-a}var l=/^-?(\d+)(\.(\d+))?$/i,h=new RegExp("\\"+p.decimal+"0+$","g"),d=/(\d)0*$/g,u={numDigits:function(d){var a=String(d),k=a.match(l);d={integer:0,fractional:0};if(k&&k[1])d.integer=k[1].split("").length,d.fractional=k[3]?k[3].split("").length:0;else if(-1<a.toLowerCase().indexOf("e")){var c,h,k=a.split("e"),a=k[0],k=k[1];a&&k&&(a=Number(a),k=Number(k),h=0<k,h||(k=Math.abs(k)),c=u.numDigits(a),h?(c.integer+=k,k>c.fractional?
c.fractional=0:c.fractional-=k):(c.fractional+=k,k>c.integer?c.integer=1:c.integer-=k),d=c)}return d},percentChange:function(d,a,k,c){var h,l,q,r={previous:null,next:null};return null!=k&&(h=d-k,l=a-k,q=l-h,r.previous=Math.floor(Math.abs(100*q/h))),null!=c&&(h=c-d,l=c-a,q=l-h,r.next=Math.floor(Math.abs(100*q/h))),r},round:function(d,a){var k,c,h,l,q,r,p,B,D,b;d=d.slice(0);var m=a&&null!=a.tolerance?a.tolerance:2,E=a&&a.indexes,A=a&&null!=a.strictBounds?a.strictBounds:!1;if(E)E.sort(w);else for(E=
[],p=0;p<d.length;p++)E.push(p);for(p=0;p<E.length;p++)if(b=E[p],k=d[b],a=0===b?null:d[b-1],c=b===d.length-1?null:d[b+1],h=u.numDigits(k),l=h.fractional){B=0;for(D=!1;l>=B&&!D;){r=k;D=B;var G=q=void 0;r=(q=Number(r.toFixed(D)),r>q?G=q+1/Math.pow(10,D):(G=q,q-=1/Math.pow(10,D)),q=Number(q.toFixed(D)),G=Number(G.toFixed(D)),[q,G]);q=A&&0===p?r[1]:r[0];D=m;r=G=void 0;var K=u.percentChange(k,q,a,c);D=(G=null==K.previous||K.previous<=D,r=null==K.next||K.next<=D,G&&r||K.previous+K.next<=2*D);B++}D&&(d[b]=
q)}return d},format:function(l,a){a=a||{places:20,round:-1};l=A.format(l,a);return l&&(l=l.replace(d,"$1").replace(h,"")),l}};return u})},"esri/renderers/support/AuthoringInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/JSONSupport ../../core/kebabDictionary ./AuthoringInfoVisualVariable".split(" "),function(A,p,w,l,h,d,u,r){var a=u({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",
esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),k=u({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size"});return function(c){function d(a){a=c.call(this)||this;return a.lengthUnit=null,a.visualVariables=null,a}return w(d,c),p=d,Object.defineProperty(d.prototype,"classificationMethod",{get:function(){if("class-breaks-size"===this.type||"class-breaks-color"===this.type){var a=
this._get("classificationMethod");return a?a:"manual"}return null},set:function(a){this._set("classificationMethod",a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"fields",{get:function(){return"predominance"===this.type?this._get("fields"):null},set:function(a){this._set("fields",a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"standardDeviationInterval",{get:function(){return"standard-deviation"===this.classificationMethod?this._get("standardDeviationInterval"):
null},set:function(a){this._set("standardDeviationInterval",a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"type",{get:function(){return this._get("type")},set:function(a){var c=a;"classed-size"===a?c="class-breaks-size":"classed-color"===a&&(c="class-breaks-color");this._set("type",c)},enumerable:!0,configurable:!0}),d.prototype.clone=function(){return new p({classificationMethod:this.classificationMethod,fields:this.fields&&this.fields.slice(0),lengthUnit:this.lengthUnit,
standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(function(a){return a.clone()})})},l([h.property({type:String,value:null,dependsOn:["type"],json:{read:a.read,write:a.write}})],d.prototype,"classificationMethod",null),l([h.property({type:[String],value:null,dependsOn:["type"],json:{write:!0}})],d.prototype,"fields",null),l([h.property({type:String,json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],
d.prototype,"lengthUnit",void 0),l([h.property({type:Number,value:null,dependsOn:["classificationMethod"],json:{write:!0}})],d.prototype,"standardDeviationInterval",null),l([h.property({type:String,value:null,json:{read:k.read,write:k.write}})],d.prototype,"type",null),l([h.property({type:[r],json:{write:!0}})],d.prototype,"visualVariables",void 0),d=p=l([h.subclass("esri.renderers.support.AuthoringInfo")],d);var p}(h.declared(d))})},"esri/renderers/support/AuthoringInfoVisualVariable":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/accessorSupport/decorators/cast ../../core/JSONSupport ../../core/kebabDictionary".split(" "),
function(A,p,w,l,h,d,u,r){var a=r({percentTotal:"percent-of-total"}),k=r({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity"});return function(c){function r(a){a=c.call(this)||this;return a.endTime=null,a.field=null,a.maxSliderValue=null,a.minSliderValue=null,a.startTime=null,a.type=null,a.units=null,a}return w(r,c),p=r,r.prototype.castEndTime=function(a){return"string"==typeof a||"number"==typeof a?a:null},r.prototype.castStartTime=function(a){return"string"==typeof a||"number"==typeof a?
a:null},Object.defineProperty(r.prototype,"style",{get:function(){return"color"===this.type?this._get("style"):null},set:function(a){this._set("style",a)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"theme",{get:function(){return"color"===this.type?this._get("theme")||"high-to-low":null},set:function(a){this._set("theme",a)},enumerable:!0,configurable:!0}),r.prototype.clone=function(){return new p({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,
startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})},l([h.property({json:{write:!0}})],r.prototype,"endTime",void 0),l([d.cast("endTime")],r.prototype,"castEndTime",null),l([h.property({type:String,json:{write:!0}})],r.prototype,"field",void 0),l([h.property({type:Number,json:{write:!0}})],r.prototype,"maxSliderValue",void 0),l([h.property({type:Number,json:{write:!0}})],r.prototype,"minSliderValue",void 0),l([h.property({json:{write:!0}})],r.prototype,"startTime",
void 0),l([d.cast("startTime")],r.prototype,"castStartTime",null),l([h.property({type:String,value:null,dependsOn:["type"],json:{read:a.read,write:a.write}})],r.prototype,"style",null),l([h.property({type:String,value:null,dependsOn:["type"],json:{write:!0}})],r.prototype,"theme",null),l([h.property({type:String,json:{read:k.read,write:k.write}})],r.prototype,"type",void 0),l([h.property({type:String,json:{write:!0}})],r.prototype,"units",void 0),r=p=l([h.subclass("esri.renderers.support.AuthoringInfoVisualVariable")],
r);var p}(h.declared(u))})},"esri/renderers/support/LegendOptions":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/JSONSupport".split(" "),function(A,p,w,l,h,d){Object.defineProperty(p,"__esModule",{value:!0});A=function(d){function r(){var a=null!==d&&d.apply(this,arguments)||this;return a.title=null,a}return w(r,d),a=r,r.prototype.clone=function(){return new a({title:this.title})},l([h.property({type:String,
json:{write:!0}})],r.prototype,"title",void 0),r=a=l([h.subclass("esri.renderers.support.LegendOptions")],r);var a}(h.declared(d));p.LegendOptions=A;p["default"]=A})},"esri/renderers/support/UniqueValueInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/JSONSupport ../../symbols/support/typeUtils ../../symbols/support/jsonUtils".split(" "),function(A,p,w,l,h,d,u,r){Object.defineProperty(p,
"__esModule",{value:!0});A=function(a){function d(){var c=null!==a&&a.apply(this,arguments)||this;return c.description=null,c.label=null,c.symbol=null,c.value=null,c}return w(d,a),c=d,d.prototype.clone=function(){return new c({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})},l([h.property({type:String,json:{write:!0}})],d.prototype,"description",void 0),l([h.property({type:String,json:{write:!0}})],d.prototype,"label",void 0),l([h.property({types:u.types,
json:{origins:{"web-scene":{read:r.read,write:{target:{symbol:{types:u.types3D}},writer:r.writeTarget}}},read:r.read,write:r.writeTarget}})],d.prototype,"symbol",void 0),l([h.property({type:String,json:{write:!0}})],d.prototype,"value",void 0),d=c=l([h.subclass("esri.renderers.support.UniqueValueInfo")],d);var c}(h.declared(d));p.UniqueValueInfo=A;p["default"]=A})},"esri/renderers/support/diffUtils":function(){define("require exports dojo/_base/lang ../../core/Accessor ../../core/Collection ../../core/accessorSupport/utils".split(" "),
function(A,p,w,l,h,d){function u(a){return a instanceof h?Object.keys(a.items):a instanceof l?d.getProperties(a).keys():a?Object.keys(a):[]}function r(a,c){return a instanceof h?a.items[c]:a[c]}function a(a,c){return Array.isArray(a)&&Array.isArray(c)?a.length!==c.length:!1}function k(d,h){var l=d.diff;if(l&&w.isFunction(l))return l(d,h);var t=u(d),p=u(h);if(0!==t.length||0!==p.length){if(!t.length||!p.length||a(d,h))return{type:"complete",oldValue:d,newValue:h};var C=p.filter(function(a){return-1===
t.indexOf(a)}),D=t.filter(function(a){return-1===p.indexOf(a)}),C=t.filter(function(a){return-1<p.indexOf(a)&&r(d,a)!==r(h,a)}).concat(C,D).sort();if((D=d?d.declaredClass:null)&&-1<c.indexOf(D)&&C.length)return{type:"complete",oldValue:d,newValue:h};var b,m;for(m in C){var D=C[m],E=r(d,D),A=r(h,D),G=void 0;w.isFunction(E)||w.isFunction(A)||E!==A&&(null!=E||null!=A)&&(G=l&&l[D]&&w.isFunction(l[D])?l[D](E,A):"object"==typeof E&&"object"==typeof A&&(E?E.declaredClass:null)===(A?A.declaredClass:null)?
k(E,A):{type:"complete",oldValue:E,newValue:A},G&&(b=b||{type:"partial",diff:{}},b.diff[D]=G))}return b}}Object.defineProperty(p,"__esModule",{value:!0});var c=["esri.Color","esri.portal.Portal"];p.diff=function(a,c){return w.isFunction(a)||w.isFunction(c)||!a&&!c?void 0:!a||!c||"object"==typeof a&&"object"==typeof a&&(a?a.declaredClass:null)!==(c?c.declaredClass:null)?{type:"complete",oldValue:a,newValue:c}:k(a,c)}})},"esri/renderers/support/rendererConversion":function(){define(["require","exports",
"../../core/Error","../../symbols/support/symbolConversion"],function(A,p,w,l){function h(d,a){if(!a)return null;var k;if(k=Array.isArray(a)?a:[a],0<k.length){var c=k.map(function(a){return a.details.symbol.type||a.details.symbol.declaredClass}).filter(function(a){return!!a});c.sort();var h=[];return c.forEach(function(a,d){0!==d&&a===c[d-1]||h.push(a)}),new w("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+h.join(", ")+") which are not supported in 3D",{renderer:d,symbolErrors:k})}return null}
function d(d){var a=d.uniqueValueInfos.map(function(a){return l.to3D(a.symbol).error}).filter(function(a){return!!a}),k=l.to3D(d.defaultSymbol);return k.error&&a.unshift(k.error),h(d,a)}function u(d){var a=d.classBreakInfos.map(function(a){return l.to3D(a.symbol).error}).filter(function(a){return!!a}),k=l.to3D(d.defaultSymbol);return k.error&&a.unshift(k.error),h(d,a)}Object.defineProperty(p,"__esModule",{value:!0});p.validateTo3D=function(r){return r?"simple"===r.type?h(r,l.to3D(r.symbol).error):
"unique-value"===r.type?d(r):"class-breaks"===r.type?u(r):new w("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+(r.type||r.declaredClass)+"'",{renderer:r}):null}})},"esri/views/3d/webgl-engine/lib/Layer":function(){define("require exports dojo/has ./IdGen ./Octree ./PerformanceTimer ./Util ./gl-matrix ./ModelContentType".split(" "),function(A,p,w,l,h,d,u,r,a){var k=r.vec3d,c=w("dojo-debug-messages");return function(){function r(a,c,d){this._parentStages=[];this._children=
[];this.id=r._idGen.gen(d);this.name=a;c=c||{};this.group=c.group||"";this.state=c.state||"VISIBLE";this.interaction=c.interaction||"PICKABLE";this.translation=k.create(c.translation);this._extent=[k.createFrom(0,0,0),k.createFrom(1E3,1E3,1E3)];this._extentDirty=!0}return r.prototype.getId=function(){return this.id},r.prototype.getParentStages=function(){return this._parentStages},r.prototype.addParentStage=function(a){-1===this._parentStages.indexOf(a)&&this._parentStages.push(a)},r.prototype.removeParentStage=
function(a){a=this._parentStages.indexOf(a);-1<a&&this._parentStages.splice(a,1)},r.prototype.getName=function(){return this.name},r.prototype.getGroup=function(){return this.group},r.prototype.getState=function(){return this.state},r.prototype.getInteraction=function(){return this.interaction},r.prototype.getTranslation=function(){return this.translation},r.prototype.getObjectIds=function(){return this._children.map(function(a){return a.getId()})},r.prototype.getObjects=function(){return this._children},
r.prototype.setState=function(a){this.state=a},r.prototype.getExtent=function(){return this._updateExtent(),this._extent},r.prototype.addObject=function(a){this._children.push(a);a.addParentLayer(this);this.notifyDirty("layObjectAdded",a);this._invalidateExtent();this._spatialAccelerator&&this._spatialAccelerator.add(a)},r.prototype.hasObject=function(a){return-1<this._children.indexOf(a)},r.prototype.removeObject=function(a){return null!=u.arrayRemove(this._children,a)?(a.removeParentLayer(this),
this.notifyDirty("layObjectRemoved",a),this._invalidateExtent(),this._spatialAccelerator&&this._spatialAccelerator.remove(a),!0):!1},r.prototype.replaceObject=function(a,c){var d=this._children.indexOf(a);u.assert(-1<d,"Layer.replaceObject: layer doesn't contain specified object");this._children[d]=c;a.removeParentLayer(this);c.addParentLayer(this);this.notifyDirty("layObjectReplaced",[a,c]);this._invalidateExtent();this._spatialAccelerator&&(this._spatialAccelerator.remove(a),this._spatialAccelerator.add(c))},
r.prototype.notifyObjectBBChanged=function(a,c){this._spatialAccelerator&&this._spatialAccelerator.update(a,c)},r.prototype.getCenter=function(){this._updateExtent();var a=k.create();return k.lerp(this._extent[0],this._extent[1],.5,a)},r.prototype.getBSRadius=function(){return this._updateExtent(),.5*k.dist(this._extent[0],this._extent[1])},r.prototype.getSpatialQueryAccelerator=function(){return this._spatialAccelerator?this._spatialAccelerator:50<this._children.length?(this._createOctree(),this._spatialAccelerator):
void 0},r.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)},r.prototype.invalidateSpatialQueryAccelerator=function(){this._spatialAccelerator=null},r.prototype.notifyDirty=function(c,d,k,h){k=k||a.LAYER;h=h||this;for(var l=0;l<this._parentStages.length;l++)this._parentStages[l].notifyDirty(k,h,c,d)},r.prototype._createOctree=function(){for(var a=this.getExtent(),l=0,r=0;3>r;r++)l=Math.max(l,a[1][r]-a[0][r]);r=k.create();k.lerp(a[0],a[1],.5,r);var t;
if(c&&(t=new d(1),t.start()),this._spatialAccelerator=new h(r,1.2*l),this._spatialAccelerator.add(this._children),t)a=t.stop(),console.info("Octree for layer "+this.id+" created in "+Math.round(a)+" ms")},r.prototype._invalidateExtent=function(){this._extentDirty=!0},r.prototype._updateExtent=function(){if(this._extentDirty){if(0===this._children.length)return void(this._extent=[[0,0,0],[0,0,0]]);var a=this._children[0];this._extent=[k.create(a.getBBMin()),k.create(a.getBBMax())];for(a=0;a<this._children.length;++a)for(var c=
this._children[a],d=c.getBBMin(),c=c.getBBMax(),h=0;3>h;++h)this._extent[0][h]=Math.min(this._extent[0][h],d[h]),this._extent[1][h]=Math.max(this._extent[1][h],c[h]);this._extentDirty=!1}},r._idGen=new l,r}()})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("require exports ./gl-matrix ./Util dojo/has ./PerformanceTimer".split(" "),function(A,p,w,l,h,d){function u(a,b,c){return c=c||a,c[0]=a[0]+b,c[1]=a[1]+b,c[2]=a[2]+b,c}var r=w.vec3d,a=h("dojo-debug-messages");A=function(){function c(a,
b,c){this._maximumObjectsPerNode=10;this._maximumDepth=20;this._autoResize=!0;this._outsiders=[];c&&(void 0!==c.maximumObjectsPerNode&&(this._maximumObjectsPerNode=c.maximumObjectsPerNode),void 0!==c.maximumDepth&&(this._maximumDepth=c.maximumDepth),void 0!==c.autoResize&&(this._autoResize=c.autoResize));isNaN(a[0])||isNaN(a[1])||isNaN(a[2])||isNaN(b)?this._root=new k(null,r.createFrom(0,0,0),.5):this._root=new k(null,a,b/2)}return Object.defineProperty(c.prototype,"center",{get:function(){return this._root.center},
enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"outsiders",{get:function(){return this._outsiders.slice()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,
configurable:!0}),Object.defineProperty(c.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"autoResize",{get:function(){return this._autoResize},enumerable:!0,configurable:!0}),c.prototype.add=function(a){a=this._objectOrObjectsArray(a);this._grow(a);for(var b=k.acquire(),c=0;c<a.length;c++){var d=a[c];b.init(this._root);0===d.getBSRadius()||isNaN(d.getBSRadius())||!this._autoResize&&!this._fitsInsideTree(this._boundingSphereFromObject(d,
B))?this._outsiders.push(d):this._add(d,b)}k.release(b)},c.prototype.remove=function(a,b){a=this._objectOrObjectsArray(a);for(var c=k.acquire(),d=!0,h=0;h<a.length;h++){var m=a[h],q=this._boundingSphereFromObject(b||m,B);0===q.radius||isNaN(q.radius)||!this._autoResize&&!this._fitsInsideTree(q)?d=null!=l.arrayRemove(this._outsiders,m):(c.init(this._root),d=this._remove(m,q,c))}return k.release(c),this._shrink(),d},c.prototype.update=function(a,b){this.remove(a,b);this.add(a)},c.prototype.forEachAlongRay=
function(a,b,c){this._forEachTest(function(c){return u(c.center,2*-c.halfSize,q),u(c.center,2*c.halfSize,v),l.rayBoxTest(a,b,q,v)},c)},c.prototype.forEachInBoundingBox=function(a,b,c){this._forEachTest(function(c){for(var d=2*c.halfSize,k=0;3>k;k++)if(c.center[k]+d<a[k]||c.center[k]-d>b[k])return!1;return!0},c)},c.prototype.forEachNode=function(a){this._forEachNode(this._root,function(b){return a(b.node,b.center,2*b.halfSize)})},c.prototype._forEachTest=function(a,b){this._outsiders.forEach(b);this._forEachNode(this._root,
function(c){return a(c)?(c=c.node,c.terminals.forEach(b),null!==c.residents&&c.residents.forEach(b),!0):!1})},c.prototype._forEachNode=function(a,b){a=k.acquire().init(a);for(var c=[a];0!==c.length;){if(a=c.pop(),b(a)&&!a.isLeaf())for(var d=0;d<a.node.children.length;d++)a.node.children[d]&&c.push(k.acquire().init(a).advance(d));k.release(a)}},c.prototype._objectOrObjectsArray=function(a){return Array.isArray(a)||(t[0]=a,a=t),a},c.prototype._remove=function(a,b,c){y.length=0;var d,k;if(c.advanceTo(b,
function(a,b){y.push(a.node,b)})?(d=null!=l.arrayRemove(c.node.terminals,a),k=0===c.node.terminals.length):(d=null!=l.arrayRemove(c.node.residents,a),k=0===c.node.residents.length),k)for(a=y.length-2;0<=a&&this._purge(y[a],y[a+1]);a-=2);return d},c.prototype._nodeIsEmpty=function(a){if(0!==a.terminals.length)return!1;if(null!==a.residents)return 0===a.residents.length;for(var b=0;b<a.children.length;b++)if(a.children[b])return!1;return!0},c.prototype._purge=function(a,b){return 0<=b&&(a.children[b]=
null),this._nodeIsEmpty(a)?(null===a.residents&&(a.residents=[]),!0):!1},c.prototype._add=function(a,b){b.advanceTo(this._boundingSphereFromObject(a,B))?b.node.terminals.push(a):(b.node.residents.push(a),b.node.residents.length>this._maximumObjectsPerNode&&b.depth<this._maximumDepth&&this._split(b))},c.prototype._split=function(a){var b=a.node.residents;a.node.residents=null;for(var c=0;c<b.length;c++){var d=k.acquire().init(a);this._add(b[c],d);k.release(d)}},c.prototype._grow=function(b){if(0!==
b.length&&this._autoResize&&(b=this._boundingSphereFromObjects(b,this._boundingSphereFromObject,D),!isNaN(b.radius)&&0!==b.radius&&!this._fitsInsideTree(b))){var c,h;if(a&&(c=new d(1),c.start()),this._nodeIsEmpty(this._root.node))r.set(b.center,this._root.center),this._root.halfSize=1.25*b.radius,h="grow-empty";else{var l=k.acquire();this._rootBoundsForRootAsSubNode(b,l);this._placingRootViolatesMaxDepth(l)?(this._rebuildTree(b,l),h="rebuild"):(this._growRootAsSubNode(l),h="sub-node");k.release(l)}a&&
(c=c.stop(),console.info("Octree grown in "+Math.round(c)+" ms (strategy: "+h+")"))}},c.prototype._rebuildTree=function(a,c){var d=this;r.set(c.center,b.center);b.radius=c.halfSize;a=this._boundingSphereFromObjects([a,b],function(a){return a},m);c=k.acquire().init(this._root);this._root.initFrom(null,a.center,1.25*a.radius);this._forEachNode(c,function(a){return d.add(a.node.terminals),null!==a.node.residents&&d.add(a.node.residents),!0});k.release(c)},c.prototype._placingRootViolatesMaxDepth=function(a){var b=
0;this._forEachNode(this._root,function(a){return b=Math.max(b,a.depth),!0});return b+Math.log(a.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth},c.prototype._rootBoundsForRootAsSubNode=function(a,b){var c=a.radius,d=a.center;a=-(1/0);for(var k=this._root.center,h=this._root.halfSize,l=0;3>l;l++){var m=Math.max(0,Math.ceil((k[l]-h-(d[l]-c))/(2*h))),q=Math.max(0,Math.ceil((d[l]+c-(k[l]+h))/(2*h)))+1;a=Math.max(a,Math.pow(2,Math.ceil(Math.log(m+q)*Math.LOG2E)));E[l].min=m;E[l].max=q}for(l=
0;3>l;l++)m=E[l].min,q=E[l].max,c=(a-(m+q))/2,m+=Math.ceil(c),q+=Math.floor(c),C[l]=k[l]-h-m*h*2+(q+m)*h;return b.initFrom(null,C,a*h,0)},c.prototype._growRootAsSubNode=function(a){var b=this._root.node;r.set(this._root.center,D.center);D.radius=this._root.halfSize;this._root.init(a);a.advanceTo(D,null,!0);a.node.children=b.children;a.node.residents=b.residents;a.node.terminals=b.terminals},c.prototype._shrink=function(){if(this._autoResize)for(;;){var a=this._findShrinkIndex();if(-1===a)break;this._root.advance(a);
this._root.depth=0}},c.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var a=null,b=this._root.node.children,c=0,d=0;d<b.length&&null==a;)c=d++,a=b[c];for(;d<b.length;)if(b[d++])return-1;return c},c.prototype._fitsInsideTree=function(a){var b=this._root.center,c=this._root.halfSize,d=a.center;return c>=a.radius&&d[0]>=b[0]-c&&d[0]<=b[0]+c&&d[1]>=b[1]-c&&d[1]<=b[1]+c&&d[2]>=b[2]-c&&d[2]<=b[2]+c},c.prototype._boundingSphereFromObject=function(a,
b){return r.set(a.getCenter(),b.center),b.radius=a.getBSRadius(),b},c.prototype._boundingSphereFromObjects=function(a,b,c){if(1===a.length){var d=b(a[0],D);r.set(d.center,c.center);c.radius=d.radius}else{q[0]=1/0;q[1]=1/0;q[2]=1/0;v[0]=-(1/0);v[1]=-(1/0);v[2]=-(1/0);for(var k=0;k<a.length;k++){var d=b(a[k],D),h=q,l=d.center,m=d.radius;h[0]=Math.min(h[0],l[0]-m);h[1]=Math.min(h[1],l[1]-m);h[2]=Math.min(h[2],l[2]-m);h=v;l=d.center;d=d.radius;h[0]=Math.max(h[0],l[0]+d);h[1]=Math.max(h[1],l[1]+d);h[2]=
Math.max(h[2],l[2]+d)}r.scale(r.add(q,v,c.center),.5);c.radius=Math.max(v[0]-q[0],v[1]-q[1],v[2]-q[2])/2}return c},c}();var k=function(){function a(a,b,c,d){void 0===c&&(c=0);void 0===d&&(d=0);this.center=r.create();this.initFrom(a,b,c,0)}return a.prototype.init=function(a){return this.initFrom(a.node,a.center,a.halfSize,a.depth)},a.prototype.initFrom=function(b,c,d,k){return void 0===b&&(b=null),void 0===d&&(d=this.halfSize),void 0===k&&(k=this.depth),this.node=b||a.createEmptyNode(),c&&r.set(c,
this.center),this.halfSize=d,this.depth=k,this},a.prototype.advance=function(b){var d=this.node.children[b];d||(d=a.createEmptyNode(),this.node.children[b]=d);this.node=d;this.halfSize/=2;this.depth++;b=c[b];return this.center[0]+=b[0]*this.halfSize,this.center[1]+=b[1]*this.halfSize,this.center[2]+=b[2]*this.halfSize,this},a.prototype.advanceTo=function(a,b,c){for(void 0===c&&(c=!1);;){if(this.isTerminalFor(a))return b&&b(this,-1),!0;if(this.isLeaf()&&!c)return b&&b(this,-1),!1;this.isLeaf()&&(this.node.residents=
null);var d=this._childIndex(a);b&&b(this,d);this.advance(d)}},a.prototype.isLeaf=function(){return null!=this.node.residents},a.prototype.isTerminalFor=function(a){return a.radius>this.halfSize/2},a.prototype._childIndex=function(a){a=a.center;for(var b=this.center,c=0,d=0;3>d;d++)b[d]<a[d]&&(c|=1<<d);return c},a.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:[],residents:[]}},a.acquire=function(){if(0===this._pool.length)return new a;var b=this._pool[this._pool.length-
1];return this._pool.length--,b},a.release=function(a){this._pool.push(a)},a._pool=[],a}(),c=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],t=[null],C=r.create(),q=r.create(),v=r.create(),y=[],B={center:r.create(),radius:0},D={center:r.create(),radius:0},b={center:r.create(),radius:0},m={center:r.create(),radius:0},E=[{min:0,max:0},{min:0,max:0},{min:0,max:0}];return A})},"esri/views/3d/webgl-engine/lib/FloatingBoxLocalOriginFactory":function(){define(["require","exports",
"./gl-matrix"],function(A,p,w){var l=w.vec3d;A=function(){function d(d,h){this._origins=[];this._boxSize=d;this._maxNumOrigins=h}return d.prototype.getOrigin=function(p){for(var r,a=this._origins.length,k=!1,c=Number.MAX_VALUE,t=0;a>t;t++){var u=this._origins[t];l.subtract(p,u.vec3,h);h[0]=Math.abs(h[0]);h[1]=Math.abs(h[1]);h[2]=Math.abs(h[2]);var q=h[0]+h[1]+h[2];c>q&&(r=u,c=q,k=h[0]<this._boxSize&&h[1]<this._boxSize&&h[2]<this._boxSize)}k||r&&null!=this._maxNumOrigins&&!(this._origins.length<this._maxNumOrigins)||
(r=d.OFFSET,r={vec3:[p[0]+r,p[1]+r,p[2]+r],id:d.ORIGIN_PREFIX+this._origins.length},this._origins.push(r));return r},d.OFFSET=1.11,d.ORIGIN_PREFIX="fb_",d}();var h=l.create();return A})},"esri/symbols/support/unitConversionUtils":function(){define(["require","exports","../../renderers/support/utils"],function(A,p,w){Object.defineProperty(p,"__esModule",{value:!0});p.supportsUnit=function(l){return null!=w.meterIn[l]};p.getMetersPerUnit=function(l){return 1/(w.meterIn[l]||1)}})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["require",
"exports","../../../../support/arcadeUtils"],function(A,p,w){Object.defineProperty(p,"__esModule",{value:!0});p.createContext=function(l,h,d){var p=null;l=l&&l.expression;if("string"==typeof l){var r="0"===l?0:null;null!=r?p={cachedResult:r}:(l=w.createSyntaxTree(l),w.dependsOnView(l)?(null!=d&&d.error("Expressions containing '$view' are not supported on ElevationInfo"),p={cachedResult:0}):p={arcade:{func:w.createFunction(l),context:w.createExecContext(null,{sr:h})}})}return p};p.createFeature=function(l){return w.createFeature(l)};
p.setContextFeature=function(l,h){null==l||null!=l.cachedResult||w.updateExecContext(l.arcade.context,h)};p.execute=function(l){if(null!=l){if(null!=l.cachedResult)return l.cachedResult;var h=l.arcade,h=w.executeFunction(h.func,h.context);return"number"!=typeof h&&(l.cachedResult=0,h=0),h}return 0};p.extractExpressionInfo=function(l,h){void 0===h&&(h=!1);var d=(l=l&&l.featureExpressionInfo)&&l.expression;return h||"0"===d||(l=null),l};p.zeroContext={cachedResult:0}})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/ObjectPool ../../support/aaBoundingBox ../../support/aaBoundingRect ./featureExpressionInfoUtils".split(" "),
function(A,p,w,l,h,d,u,r,a){var k=new d(Array,function(a){return u.set(a,u.ZERO)},null,10,5),c=r.create();return function(){function d(c,d,k){this.addedToSpatialIndex=!1;this._labelGraphics=[];this._auxiliaryGraphics=[];for(var h=Array(2),l=0;l<h.length;l++)h[l]=Array(3);this._visibilityFlags=h;this._featureExpressionFeature=null;this.graphics3DSymbol=d;this.graphic=c;this._graphics=k;this._featureExpressionFeature=a.createFeature(c)}return d.prototype.initialize=function(a,c){var d=this;this._layer=
a;this._stage=c;this.forEachSymbolLayerGraphic(function(k){k.initialize(a,c);k.setVisibility(d.isVisible())})},d.prototype.destroy=function(){this.forEachRenderedGraphic(function(a){return a.destroy()});this._graphics.length=0;this._labelGraphics.length=0;this._auxiliaryGraphics.length=0},d.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(a){return a.destroy()});this._labelGraphics.length=0},d.prototype.addLabelGraphic=function(a,c,d){this._labelGraphics.push(a);a.initialize(c,
d);a.setVisibility(this.isVisible(1))},d.prototype.addAuxiliaryGraphic=function(a){this._auxiliaryGraphics.push(a);this._layer&&(a.initialize(this._layer,this._stage),a.setVisibility(this.isVisible()))},d.prototype.isDraped=function(){var a=!1;return this.forEachSymbolLayerGraphic(function(c){c.isDraped()&&(a=!0)}),a},d.prototype.setDrawOrder=function(a,c,d){var k=this;d[this.graphics3DSymbol.symbol.id]=!0;this.forEachSymbolLayerGraphic(function(h,l){h.setDrawOrder(a+(1-(1+l)/k._graphics.length),
c,d)})},d.prototype.areVisibilityFlagsSet=function(a,c,d){void 0===d&&(d=0);d=this._visibilityFlags[d];if(null!=a)return d[a];a=!0;for(var k=0;k<d.length;k++)if(k!==c){var h=d[k];a=a&&(null==h||!0===h)}return a},d.prototype.isVisible=function(a){void 0===a&&(a=0);for(var c=!0,d=0;a>=d;d++)for(var k=this._visibilityFlags[d],h=0;h<k.length;h++)var l=k[h],c=c&&(null==l||!0===l);return c},d.prototype.setVisibilityFlag=function(a,c,d){void 0===d&&(d=0);var k=this.isVisible(d);this._visibilityFlags[d][a]=
c;var h=this.isVisible(d);if(k!==h){if(1===d)this.forEachLabelGraphic(function(a){return a.setVisibility(h)});else{this.forEachSymbolLayerGraphic(function(a){return a.setVisibility(h)});var l=this.isVisible(1);this.forEachLabelGraphic(function(a){return a.setVisibility(l)})}return!0}return!1},d.prototype.getBSRadius=function(){var a=0;return this.forEachSymbolLayerGraphic(function(c){a=Math.max(a,c.getBSRadius())}),a},d.prototype.getCenterObjectSpace=function(){return this._graphics[0].getCenterObjectSpace()},
d.prototype.getProjectedBoundingBox=function(a,d,t,p){return l(this,void 0,void 0,function(){var q=this;return w(this,function(v){switch(v.label){case 0:return p||(p={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),p.boundingBox?u.set(p.boundingBox,u.NEGATIVE_INFINITY):p.boundingBox=u.create(u.NEGATIVE_INFINITY),p.requiresDrapedElevation=!1,[4,h.forEach(this._graphics,function(b){return l(q,void 0,void 0,function(){var c,h,l;return w(this,function(m){switch(m.label){case 0:return b?
(c=b.isDraped()?d:a,h=k.acquire(),[4,b.getProjectedBoundingBox(c,t,h,p.screenSpaceObjects)]):[2];case 1:return l=m.sent(),isFinite(l[2])&&isFinite(l[5])||(p.requiresDrapedElevation=!0),l&&u.expand(p.boundingBox,h),k.release(h),[2]}})})})];case 1:return v.sent(),u.allFinite(p.boundingBox)||r.allFinite(u.toRect(p.boundingBox,c))?[2,p]:[2,null]}})})},d.prototype.needsElevationUpdates=function(){for(var a=0,c=this._graphics;a<c.length;a++){var d=c[a];if(d&&d.needsElevationUpdates)return!0}a=0;for(c=this._labelGraphics;a<
c.length;a++)if((d=c[a])&&d.needsElevationUpdates)return!0;return!1},d.prototype.alignWithElevation=function(a,c){var d=this;this.forEachRenderedGraphic(function(k){k.alignWithElevation(a,c,d._featureExpressionFeature)})},d.prototype.addHighlight=function(a,c){this.forEachSymbolLayerGraphic(function(d){return d.addHighlight(a,c)})},d.prototype.removeHighlight=function(a){this.forEachSymbolLayerGraphic(function(c){return c.removeHighlight(a)})},d.prototype.forEachGraphicList=function(a,c){a.forEach(function(a,
d){return a&&c(a,d)})},d.prototype.forEachSymbolLayerGraphic=function(a){this.forEachGraphicList(this._graphics,a);this.forEachGraphicList(this._auxiliaryGraphics,a)},d.prototype.forEachLabelGraphic=function(a){this.forEachGraphicList(this._labelGraphics,a)},d.prototype.forEachRenderedGraphic=function(a){this.forEachSymbolLayerGraphic(a);this.forEachLabelGraphic(a)},d}()})},"esri/core/asyncUtils":function(){define(["require","exports","./tsSupport/generatorHelper","./tsSupport/awaiterHelper","./promiseUtils"],
function(A,p,w,l,h){Object.defineProperty(p,"__esModule",{value:!0});p.forEach=function(d,p,r){return l(this,void 0,void 0,function(){return w(this,function(a){switch(a.label){case 0:return[4,h.eachAlways(d.map(function(a,c){return p.apply(r,[a,c])}))];case 1:return a.sent(),[2]}})})};p.map=function(d,p,r){return l(this,void 0,void 0,function(){var a;return w(this,function(k){switch(k.label){case 0:return[4,h.eachAlways(d.map(function(a,d){return p.apply(r,[a,d])}))];case 1:return a=k.sent(),[2,a.map(function(a){return a.value})]}})})}})},
"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../support/PromiseLightweight"],function(A,p,w,l){return function(h){function d(d,l){var a=h.call(this)||this;return a.symbol=null,a.graphics3DSymbol=null,a.symbol=d,d.fetchSymbol().then(function(d){if(a.isRejected())throw Error();a.graphics3DSymbol=l(d)}).then(function(){if(a.isRejected())throw Error();a.graphics3DSymbol.then(function(){a.isRejected()||a.resolve()},
function(d){a.isRejected()||a.reject(d)})}).otherwise(function(d){a.isRejected()||a.reject(d)}),a}return w(d,h),d.prototype.createGraphics3DGraphic=function(d,h){return this.graphics3DSymbol.createGraphics3DGraphic(d,h,this)},d.prototype.layerPropertyChanged=function(d,h){return this.graphics3DSymbol.layerPropertyChanged(d,h)},d.prototype.applyRendererDiff=function(d,h,a){return this.graphics3DSymbol.applyRendererDiff(d,h,a)},d.prototype.getFastUpdateStatus=function(){return this.graphics3DSymbol?
this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}},d.prototype.setDrawOrder=function(d,h){return this.graphics3DSymbol.setDrawOrder(d,h)},d.prototype.destroy=function(){this.isFulfilled()||this.reject();this.graphics3DSymbol&&this.graphics3DSymbol.destroy()},d}(l.Promise)})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["require","exports","./Graphics3DSymbol","./Graphics3DPointSymbol"],function(A,p,w,l){Object.defineProperty(p,"__esModule",{value:!0});
p.make=function(h,d,p){var r;switch(h.type){case "point-3d":r=l;break;default:r=w}return new r(h,d,p)}})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../support/PromiseLightweight ./Graphics3DGraphic ./Graphics3DSymbolLayerFactory".split(" "),function(A,p,w,l,h,d){return function(l){function r(a,k,c){var h=l.call(this)||this;h.symbol=a;a=a.symbolLayers;c&&(a=c.concat(a));c=a.length;h.childGraphics3DSymbols=Array(a.length);
h.childGraphics3DSymbolPromises=Array(a.length);for(var r=k.layerOrder,q=0,p=0,u=!1,w=function(a,b){b&&(this.childGraphics3DSymbols[a]=b,p++);q--;!this.isRejected()&&u&&1>q&&(0<p?this.resolve():this.reject())},D=0;c>D;D++){var b=a.getItemAt(D);!1!==b.enabled&&(k.layerOrder=r+(1-(1+D)/c),k.layerOrderDelta=1/c,(b=d.make(h.symbol,b,k,b._ignoreDrivers))&&(q++,h.childGraphics3DSymbolPromises[D]=b,b.then(w.bind(h,D,b),w.bind(h,D,null))))}return k.layerOrder=r,u=!0,!h.isRejected()&&1>q&&h.resolve(),h}return w(r,
l),r.prototype.createGraphics3DGraphic=function(a,d,c){for(var k=Array(this.childGraphics3DSymbols.length),l=0;l<this.childGraphics3DSymbols.length;l++){var q=this.childGraphics3DSymbols[l];q&&(k[l]=q.createGraphics3DGraphic(a,d))}return new h(a,c||this,k)},r.prototype.layerPropertyChanged=function(a,d){for(var c=this.childGraphics3DSymbols.length,k=function(c){var k=h.childGraphics3DSymbols[c],l=function(a){return a._graphics[c]};return k&&!k.layerPropertyChanged(a,d,l)?{value:!1}:void 0},h=this,
l=0;c>l;l++){var r=k(l);if("object"==typeof r)return r.value}return!0},r.prototype.applyRendererDiff=function(a,d,c){return this.isResolved()?this.childGraphics3DSymbols.reduce(function(k,h,l){return k&&(!h||h.applyRendererDiff(a,d,c,l))},!0):!1},r.prototype.getFastUpdateStatus=function(){var a=0,d=0,c=0;return this.childGraphics3DSymbolPromises.forEach(function(k){k&&!k.isFulfilled()?a++:k&&k.isFastUpdatesEnabled()?c++:k&&d++}),{loading:a,slow:d,fast:c}},r.prototype.setDrawOrder=function(a,d){for(var c=
this.childGraphics3DSymbols.length,k=1/c,h=0;c>h;h++){var l=this.childGraphics3DSymbols[h];l&&l.setDrawOrder(a+(1-(1+h)/c),k,d)}},r.prototype.destroy=function(){this.isFulfilled()||this.reject();for(var a=0;a<this.childGraphics3DSymbolPromises.length;a++)this.childGraphics3DSymbolPromises[a]&&this.childGraphics3DSymbolPromises[a].destroy()},r}(l.Promise)})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("require exports ../../../../core/Logger ./Graphics3DIconSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DFillSymbolLayer ./Graphics3DExtrudeSymbolLayer ./Graphics3DTextSymbolLayer".split(" "),
function(A,p,w,l,h,d,u,r,a,k){Object.defineProperty(p,"__esModule",{value:!0});var c=w.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");p.make=function(a,d,k,h){var l=t[d.type];return l?new l(a,d,k,h):(c.error("GraphicsLayerFactory#make","unknown symbol type "+d.type),null)};var t={icon:l,object:h,line:d,path:u,fill:r,extrude:a,text:k}})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/_base/lang dojo/when dojo/errors/CancelError ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./Graphics3DDrapedGraphicLayer ./ElevationAligners ./Graphics3DSymbolCommonCode ./SignedDistanceFunctions ../support/FastSymbolUpdates ./graphicUtils ../../../../core/screenUtils ../../../../core/sniff ../../../../core/Error ../../../../symbols/support/symbolUtils ../../../../Color ../../../../geometry/Polygon ../../support/projectionUtils ../../lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial ../../../../core/urlUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E,J,G,K,M,U,N,W,R){function V(a){var b,c=e,d=c*f;switch("primitive:"===a.substring(0,10)&&(a=a.substring(10)),a){case x.PRIM_CIRCLE:b=t.computeSignedDistancefieldCicle(c,d);break;case x.PRIM_SQUARE:b=t.computeSignedDistancefieldSquare(c,d,!1);break;case x.PRIM_KITE:b=t.computeSignedDistancefieldSquare(c,d,!0);break;case x.PRIM_CROSS:b=t.computeSignedDistancefieldCrossAndX(c,d,!1);break;case x.PRIM_X:b=t.computeSignedDistancefieldCrossAndX(c,d,!0)}return new N(b,
"sdf_"+a,{mipmap:!1,wrapClamp:!0,width:e,height:e,components:4})}var Q=J.vec3d;A=J.vec4d;var S=J.mat4d.identity(),X=[0,0,1],z=[0,0,0,0],Z=[0,0,0],O=[1,1,1],g="center bottom top left right bottom-left bottom-right top-left top-right".split(" "),e=128,f=.5,n=[f/2,f/2,1-f/2,1-f/2],x={PRIM_CIRCLE:"circle",PRIM_SQUARE:"square",PRIM_CROSS:"cross",PRIM_X:"x",PRIM_KITE:"kite"},I=[e*f,e*f];u=function(e){function t(){var a=null!==e&&e.apply(this,arguments)||this;return a._elevationOptions={supportsOffsetAdjustment:!0,
supportsOnTheGround:!0},a}return w(t,e),t.prototype._prepareResources=function(){var a=this.symbol,b=Math.round(null!=a.size?v.pt2px(a.size):16);this._size=null;this._symbolTextureRatio=1;this._primitive=null;var e=this._getStageIdHint();if(!this._isPropertyDriven("size")){var c=q.validateSymbolLayerSize(b);if(c)return this._logWarning(c),void this.reject()}this._isPropertyDriven("size")&&64>b&&(b=64);var d=a.resource||{primitive:"circle",href:void 0},c={anchorPos:this._getAnchorPos(a)},g=this.symbolContainer;
if(this._hasVisibleVerticalOffset(g)){var g=g.verticalOffset,k=g.minWorldLength,h=g.maxWorldLength;c.verticalOffset={screenLength:v.pt2px(g.screenLength),minWorldLength:k||0,maxWorldLength:null!=h?h:1/0}}if(this._context.screenSizePerspectiveEnabled&&(c.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),d.href)this._outlineSize=this._getOutlineSize(a,null),c.color=this._getFillColor(a,null),c.outlineColor=this._getOutlineColor(a),c.outlineSize=this._outlineSize,c.textureIsSignedDistanceField=
!1,this._prepareImageResources(b,c,e);else{d=d.primitive||"circle";g="primitive:"+d;if(this._primitive=d,this._outlineSize=this._getOutlineSize(a,d),c.color=this._getFillColor(a,d),c.outlineColor=this._getOutlineColor(a),c.outlineSize=this._outlineSize,("cross"===d||"x"===d)&&0===c.outlineSize)return void this.reject();this.texture=this._context.sharedResources.textures.acquire(g,V);this._textureURI=g;c.textureIsSignedDistanceField=!0;c.distanceFieldBoundingBox=n;c.textureId=this.texture.getId();
this._size=[b,b];this._symbolTextureRatio=1/f;this._createMaterialsAndAddToStage(c,this._context.stage,e);this.resolve()}},t.prototype._getOutlineSize=function(a,b){var e=0;return e=a.outline&&null!=a.outline.size?v.pt2px(a.outline.size):"cross"===b||"x"===b?1.5:0,Math.max(e,0)},t.prototype._getOutlineColor=function(a){var e=this._getLayerOpacity();if(a.outline&&null!=a.outline.color){var c=b.toUnitRGB(a.outline.color);return[c[0],c[1],c[2],a.outline.color.a*e]}return[0,0,0,e]},t.prototype._getFillColor=
function(a,b){return"cross"===b||"x"===b?z:this._getMaterialOpacityAndColor()},t.prototype._getAnchorPos=function(a){return-1<g.indexOf(a.anchor)?a.anchor:"center"},t.prototype._prepareImageResources=function(a,b,e){var c=this,f=D.getIconHref(this.symbolContainer,this.symbol);if(!y("esri-canvas-svg-support")&&R.isSVG(f))return this._logWarning("IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)"),void this.reject(new B("SVG Not Supported","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)"));
h(this._context.sharedResources.textures.acquire(f,null,a),function(d){if(!c.isRejected()){var f=d.params,g=f.width/f.height;a?1<g?c._size=[a,Math.round(a/g)]:c._size=[Math.round(a*g),a]:c._size=[f.width,f.height];b.textureId=d.getId();c._createMaterialsAndAddToStage(b,c._context.stage,e);c.resolve()}},function(a){a instanceof d?c.reject():(a="IconSymbol3DLayer failed to load (Request for icon resource failed: "+f+")",c._logWarning(a),c.reject(new B("Request Failed",a)))});this._textureURI=f},t.prototype._createMaterialsAndAddToStage=
function(a,b,e){this._fastUpdates=C.initFastSymbolUpdatesState(this._context.renderer,this._supportsShaderVisualVariables(),this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&l.mixin(a,this._fastUpdates.materialParameters);var c=l.mixin({},a);c.verticalOffset=null;c.screenSizePerspective=null;c.occlusionTest=!1;c.shaderPolygonOffset=0;this._drapedMaterial=new W(c,e+"_iconDraped");b.add(G.ModelContentType.MATERIAL,this._drapedMaterial);a.occlusionTest=!0;this._material=new W(a,e+
"_icon");b.add(G.ModelContentType.MATERIAL,this._material)},t.prototype.destroy=function(){e.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(G.ModelContentType.MATERIAL,this._material.getId()),this._material=null);this._drapedMaterial&&(this._context.stage.remove(G.ModelContentType.MATERIAL,this._drapedMaterial.getId()),this._drapedMaterial=null);this._textureURI&&(this._context.sharedResources.textures.release(this._textureURI),this._textureURI=
null)},t.prototype._getGeometry=function(a){a=this._validateGeometry(a.geometry);return"extent"===a.type?c.placePointOnPolygon(m.fromExtent(a)):"polyline"===a.type?c.placePointOnPolyline(a):"polygon"===a.type?c.placePointOnPolygon(a):"point"===a.type?a:(this._logWarning("unsupported geometry type for icon symbol: "+a.type),null)},t.prototype._getScaleFactor=function(a){if(this._isPropertyDriven("size")&&a.size){for(var b=0;3>b;b++){var e=a.size[b];e&&"symbolValue"!==e&&"proportional"!==e&&(a.size[b]=
v.pt2px(e))}b=this._size[0]>this._size[1]?this._size[0]:this._size[1];if("symbolValue"===a.size[0])return 1;if(isFinite(+a.size[0]))return+a.size[0]/b;if(isFinite(+a.size[2]))return+a.size[2]/b}return 1},t.prototype.createGraphics3DGraphic=function(a,b){var e=this._getGeometry(a);if(null===e)return null;var c="graphic"+a.uid,d=this._getVertexOpacityAndColor(b),f=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(f=this._getScaleFactor(b));f*=this._symbolTextureRatio;b=[this._size[0]*
f,this._size[1]*f];f=this.getGraphicElevationContext(a);return"on-the-ground"===f.mode?this._createAsOverlay(a,e,d,b,f,c,a.uid):this._createAs3DShape(a,e,d,b,f,c,a.uid)},t.prototype.layerPropertyChanged=function(a,b,e){if("opacity"===a)return b=this._getFillColor(this.symbol,this._primitive),this._drapedMaterial.setParameterValues({color:b}),this._material.setParameterValues({color:b}),b=this._getOutlineColor(this.symbol),this._drapedMaterial.setParameterValues({outlineColor:b}),this._material.setParameterValues({outlineColor:b}),
!0;if("elevationInfo"===a){a=this._elevationContext.mode;this._updateElevationContext();var d=this._elevationContext.mode;if("on-the-ground"===a&&"on-the-ground"===d)return!0;if(a!==d&&("on-the-ground"===a||"on-the-ground"===d))return!1;a=c.needsElevationUpdates2D(d)||"absolute-height"===d;for(var f in b){var g=b[f];(d=e(g))&&!d.isDraped()&&(g=this.getGraphicElevationContext(g.graphic),d.needsElevationUpdates=a,d.elevationContext.set(g))}return!0}return!1},t.prototype.applyRendererDiff=function(a,
b,e,c){for(var d in a.diff)switch(d){case "visualVariables":if(!C.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))return!1;this._material.setParameterValues(this._fastUpdates.materialParameters);this._drapedMaterial.setParameterValues(this._fastUpdates.materialParameters);break;default:return!1}return!0},t.prototype.setDrawOrder=function(a,b,e){this._drapedMaterial&&(this._drapedMaterial.setRenderPriority(a),e[this._drapedMaterial.getId()]=!0)},t.prototype._defaultElevationInfoNoZ=
function(){return L},t.prototype._createAs3DShape=function(a,b,e,d,f,g,h){var l=this,m=this._getFastUpdateAttrValues(a);a=m?function(a){return C.evaluateModelTransform(l._fastUpdates.materialParameters,m,a)}:null;e=M.createPointGeometry(X,null,e,d,P,null,m);e=[new K(e,g)];g=c.createStageObjectForPoint.call(this,b,e,[[this._material]],null,null,f,g,this._context.layer.uid,h,!0,a);if(null===g)return null;var n=new r(this,g.object,e,null,null,k.perObjectElevationAligner,f);return n.alignedTerrainElevation=
g.terrainElevation,n.needsElevationUpdates=c.needsElevationUpdates2D(f.mode)||"absolute-height"===f.mode,n.getScreenSize=this._createScreenSizeGetter(d,a),n.calculateRelativeScreenBounds=function(a){return l._material.calculateRelativeScreenBounds(n.getScreenSize(),1,a)},c.extendPointGraphicElevationContext(n,b,this._context.elevationProvider),n},t.prototype._createAsOverlay=function(b,e,d,f,g,k,h){var l=this;this._drapedMaterial.setRenderPriority(this._symbolLayerOrder);h=Q.create();E.pointToVector(e,
h,this._context.overlaySR);h[2]=this._getDrapedZ();if((e=this._context.clippingExtent)&&!c.pointInBox2D(h,e))return null;var m=this._getFastUpdateAttrValues(b);b=m?function(a){return C.evaluateModelTransform(l._fastUpdates.materialParameters,m,a)}:null;d=M.createPointGeometry(X,h,d,f,null,null,m);e=new U(d);e.material=this._drapedMaterial;e.center=h;e.bsRadius=0;e.transformation=S;e.name=k;e.uniqueName=k+"#"+d.id;var n=new a(this,[e],null,null,null,g);return n.getScreenSize=this._createScreenSizeGetter(f,
b),n.calculateRelativeScreenBounds=function(a){return l._drapedMaterial.calculateRelativeScreenBounds(n.getScreenSize(),1,a)},n},t.prototype._createScreenSizeGetter=function(a,b){var e=this._outlineSize+2;if(this._fastUpdates.enabled){var c=a[0]/this._symbolTextureRatio,d=a[1]/this._symbolTextureRatio;return function(a){void 0===a&&(a=Array(2));var f=b(S);return a[0]=f[0]*c+e,a[1]=f[5]*d+e,a}}var f=a[0]/this._symbolTextureRatio+e,g=a[1]/this._symbolTextureRatio+e;return function(a){return void 0===
a&&(a=Array(2)),a[0]=f,a[1]=g,a}},t.prototype._supportsShaderVisualVariables=function(){return!0},t.prototype._fastVisualVariableConvertOptions=function(){var a=this._size[0]>this._size[1]?this._size[0]:this._size[1],b=[a,a,a],e=v.px2pt(1),a=a*e;return{modelSize:b,symbolSize:[a,a,a],unitInMeters:e,transformation:{anchor:Z,scale:O,rotation:Z}}},t.prototype._hasVisibleVerticalOffset=function(a){return this.symbolContainer&&"point-3d"===this.symbolContainer.type&&this.symbolContainer.hasVisibleVerticalOffset()},
t.PRIMITIVE_SIZE=I,t.VALID_ANCHOR_STRINGS=g,t}(u);var L={mode:"relative-to-ground",offset:0},P=A.createFrom(0,0,0,1);return u})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../support/PromiseLightweight ./featureExpressionInfoUtils ./ElevationContext ./graphicUtils ./Graphics3DSymbolCommonCode ./constants ../../../../core/Logger ../../../../Color ../../../../core/Scheduler".split(" "),function(A,p,w,l,h,d,u,r,
a,k,c,t){function C(a,b){a=null!=a?b.attributes[a]:0;return null!=a&&isFinite(a)||(a=0),a}var q=new d,v=k.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer"),y={mode:"on-the-ground",offset:0,unit:"meters"},B={mode:"absolute-height",offset:0,unit:"meters"};return function(k){function b(a,b,c,h){var l=k.call(this)||this;return l._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},l.symbolContainer=a,l.symbol=b,l._context=c,l._symbolLayerOrder=c.layerOrder,l._symbolLayerOrderDelta=
c.layerOrderDelta,l._elevationContext=new d,l._material=null,l._geometryCreationWarningHandle=null,l._updateDrivenProperties(h),l._updateElevationContext(),l._prepareResources(),l}return w(b,k),b.prototype._logWarning=function(a){v.warn(a)},b.prototype._logGeometryCreationWarnings=function(a,b,c,d){var k=this;if(null==this._geometryCreationWarningHandle){var h=a.geometryData&&a.geometryData.polygons;d+=" geometry failed to be created";var l=null;a.projectionSuccess?!b.length||1===b.length&&!b[0].length?
l=d+" (no "+c+" were defined)":Array.isArray(b)&&Array.isArray(b[0])?b.some(function(a){return 1===a.length})?l=d+" ("+c+" should contain at least 2 vertices)":h&&0===h.length&&"rings"===c&&(l=d+" (filled "+c+" should use clockwise winding - try reversing the order of vertices)"):l=d+" ("+c+" should be defined as a 2D array)":l=d+" (failed to project geometry to view spatial reference)";l&&(this._geometryCreationWarningHandle=t.schedule(function(){return k._onNextTick()}),this._logWarning(l))}},b.prototype._onNextTick=
function(){this._geometryCreationWarningHandle=null},b.prototype._validateGeometry=function(a){switch(a.type){case "point":if(null==a.x||null==a.y){this._logWarning("point coordinate is null - setting to default value");var b=a.clone();return b.x=a.x||0,b.y=a.y||0,b}}return a},b.prototype._prepareResources=function(a){throw Error("This is an abstract base class");},b.prototype._defaultElevationInfoNoZ=function(){return y},b.prototype._defaultElevationInfoZ=function(){return B},b.prototype._updateElevationContext=
function(){this._elevationContext.setDefaults();var a=this._context.layer.elevationInfo;a&&this._elevationContext.mixinApi(a);(a=this.symbol&&this.symbol.elevationInfo)&&this._elevationContext.mixinApi(a);this._elevationContext.featureExpressionInfoContext=this._context.featureExpressionInfoContext},b.prototype.getGraphicElevationContext=function(b){var c=b.geometry.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ();q.setUnit(null!=this._elevationContext.unit?this._elevationContext.unit:
c.unit);q.mode=this._elevationContext.mode||c.mode;q.setOffsetMeters(null!=this._elevationContext.meterUnitOffset?this._elevationContext.meterUnitOffset:c.offset);q.featureExpressionInfoContext=this._elevationContext.featureExpressionInfoContext;q.hasOffsetAdjustment=!1;this._elevationOptions.supportsOnTheGround||"on-the-ground"!==q.mode||(q.mode="relative-to-ground",q.setOffsetMeters(0),q.featureExpressionInfoContext=h.zeroContext);c=h.createFeature(b);return h.setContextFeature(q.featureExpressionInfoContext,
c),r.needsOffsetAdjustment(q,this._elevationOptions,b.geometry,this.symbolContainer)&&(q.setOffsetRenderUnits(a.defaultIconElevationOffset),q.hasOffsetAdjustment=!0),q},b.prototype._getDrapedZ=function(){return-2},b.prototype._updateDrivenProperties=function(a){var b={color:!1,opacity:!1,size:!1};a||(a=this._context.renderer)&&(b.color=!!a.colorInfo,b.size=!!a.sizeInfo,a.visualVariables&&a.visualVariables.forEach(function(a){switch(a.type){case "color":if(b.color=!0,a.colors)for(var c=0;c<a.colors.length;c++){var d=
a.colors[c];d&&(Array.isArray(d)&&3<d.length&&255!==d[3]||void 0!==d.a&&255!==d.a)&&(b.opacity=!0)}if(a.stops)for(c=0;c<a.stops.length;c++)(d=a.stops[c].color)&&(Array.isArray(d)&&3<d.length&&255!==d[3]||void 0!==d.a&&255!==d.a)&&(b.opacity=!0);break;case "opacity":b.opacity=!0;break;case "size":b.size=!0}}));this._drivenProperties=b},b.prototype._isPropertyDriven=function(a){return this._drivenProperties[a]},b.prototype._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;
var a=this._context.layer.opacity;return null==a?1:a},b.prototype._getMaterialOpacity=function(){var a;a=1*this._getLayerOpacity();var b=this.symbol&&this.symbol.material;return b&&!this._isPropertyDriven("opacity")&&b.color&&(a*=b.color.a),a},b.prototype._getMaterialOpacityAndColor=function(){var a=this.symbol&&this.symbol.material,b=this._getMaterialOpacity(),a=!this._isPropertyDriven("color")&&a&&a.color?c.toUnitRGB(a.color):null;return u.mixinColorAndOpacity(a,b)},b.prototype._getVertexOpacityAndColor=
function(a,b,c){var d=this._isPropertyDriven("color")?a.color:null;a=this._isPropertyDriven("opacity")?a.opacity:null;d=u.mixinColorAndOpacity(d,a);return c&&(d[0]*=c,d[1]*=c,d[2]*=c,d[3]*=c),b?new b(d):d},b.prototype._getStageIdHint=function(){return this._context.layer.id+"_symbol"},b.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled},b.prototype.setDrawOrder=function(a,b,c){this._material&&(this._material.setRenderPriority(a),c[this._material.getId()]=
!0)},b.prototype.createGraphics3DGraphic=function(a,b){for(var c=2;c<arguments.length;c++);throw Error("This is an abstract base class");},b.prototype.destroy=function(){this._geometryCreationWarningHandle&&(this._geometryCreationWarningHandle.remove(),this._geometryCreationWarningHandle=null)},b.prototype.layerPropertyChanged=function(a,b,c){return!1},b.prototype.applyRendererDiff=function(a,b,c,d){return!1},b.prototype._getFastUpdateAttrValues=function(a){if(!this._fastUpdates.enabled)return null;
var b=this._fastUpdates.visualVariables,c=b.size?C(b.size.field,a):0;a=b.color?C(b.color.field,a):0;return[c,a,0,0]},b}(l.Promise)})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["require","exports","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(A,p,w,l){return function(){function h(d){d?this.set(d):this.setDefaults()}return Object.defineProperty(h.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,
configurable:!0}),Object.defineProperty(h.prototype,"unit",{get:function(){return this._unit},enumerable:!0,configurable:!0}),h.prototype.setUnit=function(d){this._unit=d;this._metersPerElevationInfoUnit=w.getMetersPerUnit(d)},h.prototype.setDefaults=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this.featureExpressionInfoContext=null;this.hasOffsetAdjustment=!1;this.setUnit("meters")},h.prototype.set=function(d){this.mode=d.mode;this._meterUnitOffset=d._meterUnitOffset||
0;this._renderUnitOffset=d._renderUnitOffset||0;this.featureExpressionInfoContext=d.featureExpressionInfoContext;this.hasOffsetAdjustment=d.hasOffsetAdjustment;this.setUnit(d.unit)},h.prototype.setOffsetMeters=function(d){this._meterUnitOffset=d;this._renderUnitOffset=0},h.prototype.setOffsetElevationInfoUnits=function(d){this._meterUnitOffset=d*this._metersPerElevationInfoUnit;this._renderUnitOffset=0},h.prototype.setOffsetRenderUnits=function(d){this._meterUnitOffset=0;this._renderUnitOffset=d},
h.prototype.addOffsetRenderUnits=function(d){this._renderUnitOffset+=d},h.prototype.mixinApi=function(d){null!=d.mode&&(this.mode=d.mode);null!=d.unit&&this.setUnit(d.unit);null!=d.offset&&this.setOffsetElevationInfoUnits(d.offset)},h.prototype.calculateOffsetRenderUnits=function(d){var h=this._meterUnitOffset,r=this.featureExpressionInfoContext;return null!=r&&(h+=l.execute(r)*this._metersPerElevationInfoUnit),h/d.unitInMeters+this._renderUnitOffset},h}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolCommonCode":function(){define("require exports ../../../../geometry/Point ../../../../symbols/callouts/calloutUtils ../../../../geometry/support/coordsUtils ./graphicUtils ../../support/projectionUtils ../../lib/glMatrix ../../webgl-engine/lib/Object3D".split(" "),
function(A,p,w,l,h,d,u,r,a){function k(a,b,c,d,k){var h=0,l=b.z||0,m=0,q=c.mode;d=c.calculateOffsetRenderUnits(d);c=c.featureExpressionInfoContext;return"on-the-ground"===q?(m=a.getElevation(b,"ground")||0,h=m,k&&(k.verticalDistanceToGround=0,k.terrainElevation=m)):"relative-to-ground"===q?(m=a.getElevation(b,"ground")||0,h=d,null==c&&(h+=l),k&&(k.verticalDistanceToGround=h,k.terrainElevation=m),h+=m):"relative-to-scene"===q?(m=a.getElevation(b,"scene")||0,h=d,k&&(k.verticalDistanceToGround=h,k.terrainElevation=
m),h+=m):"absolute-height"===q&&(h=d,null==c&&(h+=l),k&&(m=a.getElevation(b,"ground")||0,k.verticalDistanceToGround=h-m,k.terrainElevation=m)),h}function c(a){for(var b=0,c=a.length-1,d=0;c>d;d++)b+=a[d][0]*a[d+1][1]-a[d+1][0]*a[d][1];return 0<=b}function t(a,b,c,d,k,h){d*=3;for(var l=0;k>l;++l){var m=a[b++];c[d++]=m[0];c[d++]=m[1];c[d++]=h?m[2]:0}return d/3}function C(a,b){for(var d=a.length,k=Array(d),h=Array(d),l=Array(d),m=0,q=0,r=0,p=0,v=0;d>v;++v)p+=a[v].length;for(var p=new Float64Array(3*
p),u=0,w=d-1;0<=w;w--){var y=a[w];if(c(y))k[m++]=y;else{for(var g=y.length,v=0;m>v;++v)g+=k[v].length;v={index:u,pathLengths:Array(m+1),count:g,holeIndices:Array(m)};v.pathLengths[0]=y.length;0<y.length&&(l[r++]={index:u,count:y.length});u=t(y,0,p,u,y.length,b);for(y=0;m>y;++y)g=k[y],v.holeIndices[y]=u,v.pathLengths[y+1]=g.length,0<g.length&&(l[r++]={index:u,count:g.length}),u=t(g,0,p,u,g.length,b);m=0;0<v.count&&(h[q++]=v)}}for(y=0;m>y;++y)g=k[y],0<g.length&&(l[r++]={index:u,count:g.length}),u=t(g,
0,p,u,g.length,b);return d>q&&(h.length=q),d>r&&(l.length=r),{vertexData:p,polygons:h,outlines:l}}function q(a,b,c,d,k){b*=3;d*=3;for(var h=0;k>h;++h)c[d++]=a[b++],c[d++]=a[b++],c[d++]=a[b++]}function v(a,b,c,d,k,h,l){return u.bufferToBuffer(a,c,b,d,h,k,l)}function y(a,b,c){u.pointToVector(a,b,c)}function B(a,b){return!(a[0]>b[3]||a[0]<b[0]||a[1]>b[4]||a[1]<b[1])}function D(a,b){return!(b[0]>a[3]||b[3]<a[0]||b[1]>a[4]||b[4]<a[1])}Object.defineProperty(p,"__esModule",{value:!0});A=r.mat4d;var b=r.vec3d.create(),
m=A.identity(),E=new w({x:0,y:0,z:0,spatialReference:null});p.createStageObjectForPoint=function(c,h,l,q,r,t,p,v,w,C,E){var z=h?h.length:0,D=this._context.clippingExtent;if(y(c,b,this._context.elevationProvider.spatialReference),D&&!B(b,D))return null;y(c,b,this._context.renderSpatialReference);D=this._context.localOriginFactory.getOrigin(b);p=new a({castShadow:!1,metadata:{layerUid:v,graphicId:w,usesVerticalDistanceToGround:!!C},idHint:p});for(v=0;z>v;v++)p.addGeometry(h[v],l[v],q?q[v]:m,r,D,E);
h=this._context.renderSpatialReference;q=this._context.elevationProvider;r=this._context.renderCoordsHelper;var A;l=0;p.metadata.usesVerticalDistanceToGround?(l=k(q,c,t,r,J),d.updateVertexAttributeAuxpos1w(p,J.verticalDistanceToGround),A=J.terrainElevation):(E="absolute-height"!==t.mode,l=k(q,c,t,r,E?J:null),E&&(A=J.terrainElevation));t=p.getObjectTransformation();b[0]=c.x;b[1]=c.y;b[2]=l;c=(u.computeLinearTransformation(c.spatialReference,b,t,h)?p.setObjectTransformation(t):console.warn("Could not locate symbol object properly, it might be misplaced"),
{terrainElevation:A});return{object:p,terrainElevation:c.terrainElevation}};p.extendPointGraphicElevationContext=function(a,c,d){a=a.elevationContext;d=d.spatialReference;y(c,b,d);a.centerPointInElevationSR=new w({x:b[0],y:b[1],z:c.hasZ?b[2]:0,spatialReference:d})};p.placePointOnPolyline=function(a){var b=a.paths[0];if(!b||0===b.length)return null;b=h.getPointOnPath(b,h.getPathLength(b)/2);return new w({x:b[0],y:b[1],z:b[2],spatialReference:a.spatialReference})};p.placePointOnPolygon=function(a){return d.computeCentroid(a)};
p.computeElevation=k;p.getSingleSizeDriver=function(a,b){return void 0===b&&(b=0),isFinite(a[b])?a[b]:null};p.isCounterClockwise=c;p.copyPointData=t;p.copyPathData=C;p.copyVertices=q;p.chooseOrigin=function(a,b,c,d){b=Math.floor(b+(c-1)/2);d[0]=a[3*b+0];d[1]=a[3*b+1];d[2]=a[3*b+2]};p.subtractCoordinates=function(a,b,c,d){b*=3;for(var k=0;c>k;++k)a[b++]-=d[0],a[b++]-=d[1],a[b++]-=d[2]};p.setZ=function(a,b,c,d){b*=3;for(var k=0;c>k;++k)a[b+2]=d,b+=3};p.offsetZ=function(a,b,c,d){b*=3;for(var k=0;c>k;++k)a[b+
2]+=d,b+=3};p.scaleZ=function(a,b,c,d){b*=3;for(var k=0;c>k;++k)a[b+2]*=d,b+=3};p.flatArrayToArrayOfArrays=function(a,b,c){var d=[];b*=3;for(var k=0;c>k;++k)d.push([a[b++],a[b++],a[b++]]);return d};p.reproject=v;p.reprojectPoint=y;p.getGeometryVertexData3D=function(a,b,c,d,k,h,l){var m=k.spatialReference;a=C(a,b);b=a.vertexData;var r=b.length/3,t=new Float64Array(b.length),p=!0;c.equals(m)?q(b,0,t,0,b.length):p=v(b,0,c,t,0,m,r);var u=0,w=0,y=l.mode,g=0,e=0;c=0;h=l.calculateOffsetRenderUnits(h);l=
l.featureExpressionInfoContext;E.spatialReference=k.spatialReference;for(var u=3*u,w=3*w,f=0;r>f;++f)E.x=t[u+0],E.y=t[u+1],E.z=t[u+2],"on-the-ground"===y?(g=k.getElevation(E)||0,e=g,c+=g):"relative-to-ground"===y?(g=k.getElevation(E)||0,e=g+h,null==l&&(e+=E.z),c+=g):"relative-to-scene"===y?(g=k.getElevation(E,"scene")||0,e=g+h,c+=g):"absolute-height"===y&&(e=h,null==l&&(e+=E.z)),b[w+0]=t[u+0],b[w+1]=t[u+1],b[w+2]=e,u+=3,w+=3;k=(c/=r,{terrainElevation:c});return m.equals(d)||v(b,0,m,b,0,d,r),{geometryData:a,
vertexData:b,eleVertexData:t,terrainElevation:k.terrainElevation,projectionSuccess:p}};p.getGeometryVertexDataDraped=function(a,b,c){a=C(a,!1);var d=a.vertexData,k=d.length/3,h=!0;return b.equals(c)||(h=u.bufferToBuffer(d,b,0,d,c,0,k)),{geometryData:a,vertexData:d,projectionSuccess:h}};p.computeBoundingBox=function(a,b,c,d){d[0]=Number.MAX_VALUE;d[1]=Number.MAX_VALUE;d[2]=Number.MAX_VALUE;d[3]=-Number.MAX_VALUE;d[4]=-Number.MAX_VALUE;d[5]=-Number.MAX_VALUE;b*=3;for(var k=0;c>k;++k){var h=a[b++],l=
a[b++],m=a[b++];h<d[0]&&(d[0]=h);l<d[1]&&(d[1]=l);m<d[2]&&(d[2]=m);h>d[3]&&(d[3]=h);l>d[4]&&(d[4]=l);m>d[5]&&(d[5]=m)}return d};p.pointInBox2D=B;p.boxesIntersect2D=D;p.boundingBoxClipped=function(a,b){return b?!D(a,b):!1};p.needsElevationUpdates2D=function(a){return"relative-to-ground"===a||"relative-to-scene"===a};p.needsElevationUpdates3D=function(a){return"absolute-height"!==a};p.needsOffsetAdjustment=function(a,b,c,d){if(!1===b.needsOffsetAdjustment||!1===b.supportsOffsetAdjustment||"on-the-ground"===
a.mode)return!1;if(0===a.meterUnitOffset){if(!0===b.needsOffsetAdjustment)return!0;if(l.isCalloutSupport(d)&&d.hasVisibleVerticalOffset())return!1;if("relative-to-ground"===a.mode&&(!c.hasZ||a.featureExpressionInfoContext)||"relative-to-scene"===a.mode)return!0}return!1};var J={verticalDistanceToGround:0,terrainElevation:0}})},"esri/views/3d/layers/graphics/constants":function(){define(["require","exports"],function(A,p){Object.defineProperty(p,"__esModule",{value:!0});p.defaultIconElevationOffset=
1})},"esri/views/3d/layers/graphics/Graphics3DGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ./Graphics3DGraphicElevationContext ./featureExpressionInfoUtils ../../webgl-engine/Stage ../../lib/glMatrix ../../support/aaBoundingBox".split(" "),function(A,p,w,l,h,d,u,r,a,k){A=a.vec3d;var c=a.mat4d,t=[0,0,0];a=function(){function a(c,k,b,h,l,q,r,t){this._addedToStage=!1;this.alignedTerrainElevation=
0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=c;this.uniqueMaterials=h;this.uniqueGeometries=b;this.uniqueTextures=l;this.stageObject=k;this.elevationAligner=q;this.elevationContext=new d(r);this.stageLayer=this.stage=null;this._visible=!1;this.visibilityMode=null!=t?t:a.VisibilityModes.HIDE_FACERANGE}return a.prototype.initialize=function(a,c){if(this.stageLayer=a,this.stage=c,this.uniqueMaterials)for(a=0;a<this.uniqueMaterials.length;a++)c.add(r.ModelContentType.MATERIAL,this.uniqueMaterials[a]);
if(this.uniqueGeometries)for(a=0;a<this.uniqueGeometries.length;a++)c.add(r.ModelContentType.GEOMETRY,this.uniqueGeometries[a]);if(this.uniqueTextures)for(a=0;a<this.uniqueTextures.length;a++)c.add(r.ModelContentType.TEXTURE,this.uniqueTextures[a]);c.add(r.ModelContentType.OBJECT,this.stageObject)},a.prototype.isDraped=function(){return!1},a.prototype.setVisibility=function(c){return null!=this.stage?this._visible!==c?(this._visible=c,this._visible?this._addedToStage?this.stageObject.unhideAllComponents():
(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===a.VisibilityModes.HIDE_FACERANGE?this.stageObject.hideAllComponents():(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1),!0):!1:void 0},a.prototype.destroy=function(){var a=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var c=0;c<this.uniqueMaterials.length;c++)a.remove(r.ModelContentType.MATERIAL,this.uniqueMaterials[c].getId());if(this.uniqueGeometries)for(c=0;c<this.uniqueGeometries.length;c++)a.remove(r.ModelContentType.GEOMETRY,
this.uniqueGeometries[c].getId());if(this.uniqueTextures)for(c=0;c<this.uniqueTextures.length;c++)a.remove(r.ModelContentType.TEXTURE,this.uniqueTextures[c].getId())}a.remove(r.ModelContentType.OBJECT,this.stageObject.getId());this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);this._visible=!1;this.stage=this.stageLayer=null},a.prototype.alignWithElevation=function(a,c,b){this.elevationAligner&&(u.setContextFeature(this.elevationContext.featureExpressionInfoContext,
b),a=this.elevationAligner(this.stageObject,this.elevationContext,a,c),null!=a&&(this.alignedTerrainElevation=a))},a.prototype.setDrawOrder=function(a,c,b){},a.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()},a.prototype.getCenterObjectSpace=function(){return this.stageObject.getCenter(!0)},a.prototype.getBoundingBoxObjectSpace=function(a){var c=this.stageObject;return a||(a=k.create()),k.setMin(a,c.getBBMin(!0)),k.setMax(a,c.getBBMax(!0)),a},a.prototype.getProjectedBoundingBox=
function(a,d,b,m){return h(this,void 0,void 0,function(){var h,r,p,u,w,y,B,D;return l(this,function(l){switch(l.label){case 0:h=this.getBoundingBoxObjectSpace(b);r=v;p=k.isPoint(h)?1:r.length;for(u=0;p>u;u++)w=r[u],q[0]=h[w[0]],q[1]=h[w[1]],q[2]=h[w[2]],c.multiplyVec3(this.stageObject.objectTransformation,q),C[3*u+0]=q[0],C[3*u+1]=q[1],C[3*u+2]=q[2];if(!a(C,0,p))return[3,6];k.set(h,k.NEGATIVE_INFINITY);y=null;this.calculateRelativeScreenBounds&&(y=this.calculateRelativeScreenBounds());for(u=0;3*p>
u;u+=3){for(B=0;3>B;B++)h[B]=Math.min(h[B],C[u+B]),h[B+3]=Math.max(h[B+3],C[u+B]);y&&m.push({location:C.slice(u,u+3),screenSpaceBoundingRect:y})}if(!d||(k.center(h,t),"absolute-height"===this.elevationContext.mode))return[3,5];D=void 0;l.label=1;case 1:return l.trys.push([1,3,,4]),[4,d.queryElevation(t[0],t[1])];case 2:return D=l.sent(),[3,4];case 3:return l.sent(),D=null,[3,4];case 4:null!=D&&k.offset(h,0,0,-this.alignedTerrainElevation+D),l.label=5;case 5:return[2,h];case 6:return[2,null]}})})},
a.prototype.addHighlight=function(a,c){c=this.stageObject.highlightAllComponents(c);a.addObject(this.stageObject,c)},a.prototype.removeHighlight=function(a){a.removeObject(this.stageObject)},a.VisibilityModes={REMOVE_OBJECT:0,HIDE_FACERANGE:1},a}();var C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],q=A.create(),v=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return a})},"esri/views/3d/layers/graphics/Graphics3DGraphicElevationContext":function(){define(["require","exports",
"../../../../core/tsSupport/extendsHelper","./ElevationContext"],function(A,p,w,l){return function(h){function d(d){d=h.call(this,d)||this;return d.centerPointInElevationSR=null,d}return w(d,h),d}(l)})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ./ElevationContext ../../support/aaBoundingBox ../../support/aaBoundingRect ../../webgl-engine/Stage".split(" "),
function(A,p,w,l,h,d,u,r,a){A=function(){function r(a,c,k,h,l,b){this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.renderGeometries=c;this.uniqueMaterials=k;this.uniqueTextures=h;this.boundingBox=l;this.elevationContext=new d(b);this.stage=null;this._visible=!1}return r.prototype.initialize=function(c,d){if(this.stage=d,this.uniqueMaterials)for(c=0;c<this.uniqueMaterials.length;c++)d.add(a.ModelContentType.MATERIAL,this.uniqueMaterials[c]);if(this.uniqueTextures)for(c=0;c<this.uniqueTextures.length;c++)d.add(a.ModelContentType.TEXTURE,
this.uniqueTextures[c])},r.prototype.isDraped=function(){return!0},r.prototype.setVisibility=function(a){return null!=this.stage?this._visible!==a?(this._visible=a,this._visible?this.stage.getTextureGraphicsRenderer().addRenderGeometries(this.renderGeometries):this.stage.getTextureGraphicsRenderer().removeRenderGeometries(this.renderGeometries),!0):!1:void 0},r.prototype.destroy=function(){if(this.stage){var c=this.stage;if(this._visible&&c.getTextureGraphicsRenderer().removeRenderGeometries(this.renderGeometries),
this._visible=!1,this.uniqueMaterials)for(var d=0;d<this.uniqueMaterials.length;d++)c.remove(a.ModelContentType.MATERIAL,this.uniqueMaterials[d].getId());if(this.uniqueTextures)for(d=0;d<this.uniqueTextures.length;d++)c.remove(a.ModelContentType.TEXTURE,this.uniqueTextures[d].getId());this.stage=null}},r.prototype.alignWithElevation=function(a,c,d){},r.prototype.setDrawOrder=function(a,c,d){var k=this;this.uniqueMaterials&&this.uniqueMaterials.forEach(function(d){d.setRenderPriority(a);k._visible&&
(c[d.getId()]=!0)})},r.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(a,c){return Math.max(a,c.bsRadius)},0)},r.prototype.getCenterObjectSpace=function(){return[0,0,0]},r.prototype.addHighlight=function(a,c){var d=this.stage.getTextureGraphicsRenderer();this.renderGeometries.forEach(function(k){var h=d.addRenderGeometryHighlight(k,c);a.addRenderGeometry(k,d,h)})},r.prototype.removeHighlight=function(a){this.renderGeometries.forEach(function(c){a.removeRenderGeometry(c)})},
r.prototype.getProjectedBoundingBox=function(a,c,d,r){return h(this,void 0,void 0,function(){var h,b,m;return l(this,function(l){switch(l.label){case 0:u.set(d,u.NEGATIVE_INFINITY);for(h=0;h<this.renderGeometries.length;h++)b=this.renderGeometries[h],this._getRenderGeometryProjectedBoundingRect(b,k,a,r),u.expand(d,k);if(!c)return[3,5];u.center(d,t);m=void 0;l.label=1;case 1:return l.trys.push([1,3,,4]),[4,c.queryElevation(t[0],t[1])];case 2:return m=l.sent(),[3,4];case 3:return l.sent(),m=null,[3,
4];case 4:null!=m&&(d[2]=Math.min(d[2],m),d[5]=Math.max(d[5],m)),l.label=5;case 5:return[2,d]}})})},r.prototype._getRenderGeometryProjectedBoundingRect=function(a,d,k,h){if(this.boundingBox)u.set(c,this.boundingBox);else{var l=a.center;a=a.bsRadius;c[0]=l[0]-a;c[1]=l[1]-a;c[2]=l[2]-a;c[3]=l[0]+a;c[4]=l[1]+a;c[5]=l[2]+a}return k(c,0,2),this.calculateRelativeScreenBounds&&h.push({location:u.center(c),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),u.toRect(c,d)},r}();var k=r.create(),
c=[0,0,0,0,0,0],t=[0,0,0];return A})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("require exports ../../../../geometry/Point ../../lib/glMatrix ../../support/projectionUtils ../../support/debugFlags ../../webgl-engine/lib/Util ./Graphics3DSymbolCommonCode ./graphicUtils".split(" "),function(A,p,w,l,h,d,u,r,a){Object.defineProperty(p,"__esModule",{value:!0});var k=u.VertexAttrConstants;A=l.vec3d;var c=new w,t=A.create(),C=A.create(),q=A.create(),v={verticalDistanceToGround:0,
terrainElevation:0};p.perVertexElevationAligner=function(a,h,l,b){c.spatialReference=l.spatialReference;for(var m=a.getGeometryRecords(),u=m.length,w="absolute-height"!==h.mode,y=0,B=0;u>B;B++){var D=m[B].geometry,A=m[B].getShaderTransformation(),N=D.getData();C[0]=A[12];C[1]=A[13];C[2]=A[14];D.invalidateBoundingInfo();for(var A=N.getVertexAttr(),N=A[k.POSITION],D=N.data,A=A.mapPos.data,N=N.size,W=D.length/N,R=0,V=0,Q=!1,S=0,X=0;W>X;X++){c.x=A[V++];c.y=A[V++];c.z=A[V++];q[0]=D[R];q[1]=D[R+1];q[2]=
D[R+2];var z=r.computeElevation(l,c,h,b,w?v:null);(w&&(S+=v.terrainElevation),t[0]=D[R]+C[0],t[1]=D[R+1]+C[1],t[2]=D[R+2]+C[2],b.setAltitude(z,t),D[R]=t[0]-C[0],D[R+1]=t[1]-C[1],D[R+2]=t[2]-C[2],d.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS)?Q=!0:(z=p.updateThresholdInMeters/b.unitInMeters,(Math.abs(q[0]-D[R])>=z||Math.abs(q[1]-D[R+1])>=z||Math.abs(q[2]-D[R+2])>=z)&&(Q=!0));R+=N}y+=S/W;Q&&a.geometryVertexAttrsUpdated(B)}return y/u};p.perObjectElevationAligner=function(c,k,l,b,m){var q=k.centerPointInElevationSR,
u=0;m=0;if(c.metadata.usesVerticalDistanceToGround)u=r.computeElevation(l,q,k,b,v),a.updateVertexAttributeAuxpos1w(c,v.verticalDistanceToGround),m=v.terrainElevation;else{var w="absolute-height"!==k.mode,u=r.computeElevation(l,q,k,b,w?v:null);w&&(m=v.terrainElevation)}k=c.getObjectTransformation();l=[k[12],k[13],k[14]];d.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(t[0]=q.x,t[1]=q.y,t[2]=u,h.computeLinearTransformation(q.spatialReference,t,k,b.spatialReference)&&c.setObjectTransformation(k)):b.setAltitudeOfTransformation(u,
k);b=p.updateThresholdInMeters/b.unitInMeters;return(Math.abs(k[12]-l[0])>=b||Math.abs(k[13]-l[1])>=b||Math.abs(k[14]-l[2])>=b)&&c.setObjectTransformation(k),m};p.updateThresholdInMeters=.01;p.iterativeUpdatesEnabled=!0})},"esri/views/3d/layers/graphics/SignedDistanceFunctions":function(){define(["require","exports","../../support/mathUtils"],function(A,p,w){function l(a){return a-Math.floor(a)}function h(a,k,c){a=w.clamp(a,0,.9999991);var h=l(a*d[0]),r=l(a*d[1]),q=l(a*d[2]);a=l(a*d[3]);k[c+0]=256*
(h-h*u[0]);k[c+1]=256*(r-h*u[1]);k[c+2]=256*(q-r*u[2]);k[c+3]=256*(a-q*u[3])}Object.defineProperty(p,"__esModule",{value:!0});var d=[16777216,65536,256,1],u=[0,1/256,1/256,1/256],r=[1/16777216,1/65536,1/256,1];p.packFloat=h;p.unpackFloat=function(a,d){var c=a[d+1]/256,k=a[d+2]/256,h=a[d+3]/256,l=0;return l+=a[d+0]/256*r[0],l+=c*r[1],l+=k*r[2],l+=h*r[3]};p.computeSignedDistancefieldCicle=function(a,d){var c=new Uint8Array(4*a*a),k=a/2-.5;d/=2;for(var l=0;a>l;l++)for(var q=0;a>q;q++){var r=q+a*l,p=
q-k,u=l-k,p=Math.sqrt(p*p+u*u)-d,p=p/a+.5;h(p,c,4*r)}return c};p.computeSignedDistancefieldSquare=function(a,d,c){c&&(d/=Math.SQRT2);for(var k=new Uint8Array(4*a*a),l=0;a>l;l++)for(var q=0;a>q;q++){var r=q-.5*(a-.5),p=l-.5*(a-.5),u=l*a+q;if(c)var w=(r+p)/Math.SQRT2,p=(p-r)/Math.SQRT2,r=w;r=Math.max(Math.abs(r),Math.abs(p))-.5*d;r=r/a+.5;h(r,k,4*u)}return k};p.computeSignedDistancefieldCrossAndX=function(a,d,c){c&&(d*=Math.SQRT2);d*=.5;for(var k=new Uint8Array(4*a*a),l=0;a>l;l++)for(var q=0;a>q;q++){var r=
q-.5*a+0,p=l-.5*a+0,u=l*a+q;if(c)var w=(r+p)/Math.SQRT2,p=(p-r)/Math.SQRT2,r=w;r=Math.abs(r);p=Math.abs(p);w=void 0;w=r>p?r>d?Math.sqrt((r-d)*(r-d)+p*p):p:p>d?Math.sqrt(r*r+(p-d)*(p-d)):r;w=w/a+.5;h(w,k,4*u)}return k}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define(["require","exports","../../../../renderers/support/utils","../../lib/glMatrix","../graphics/graphicUtils"],function(A,p,w,l,h){function d(a){return null!==a&&void 0!==a}function u(a){return"number"==typeof a}function r(a,
b){a&&a.push(b);k(b)}function a(a){J&&console.warn("[FastSymbolUpdates] "+a)}function k(a){J&&console.info("[FastSymbolUpdates] "+a)}function c(a,b,c,k,h){var l=a.minSize,m=a.maxSize;if(a.expression)return r(h,"Could not convert size info: expression not supported"),!1;if(a.useSymbolValue)return a=k.symbolSize[c],b.minSize[c]=a,b.maxSize[c]=a,b.offset[c]=b.minSize[c],b.factor[c]=0,b.type[c]=1,!0;if(d(a.field))return d(a.stops)?2===a.stops.length&&u(a.stops[0].size)&&u(a.stops[1].size)?(t(a.stops[0].size,
a.stops[1].size,a.stops[0].value,a.stops[1].value,b,c),b.type[c]=1,!0):(r(h,"Could not convert size info: stops only supported with 2 elements"),!1):u(l)&&u(m)&&d(a.minDataValue)&&d(a.maxDataValue)?(t(l,m,a.minDataValue,a.maxDataValue,b,c),b.type[c]=1,!0):null!=w.meterIn[a.valueUnit]?(b.minSize[c]=-(1/0),b.maxSize[c]=1/0,b.offset[c]=0,b.factor[c]=1/w.meterIn[a.valueUnit],b.type[c]=1,!0):"unknown"===a.valueUnit?(r(h,"Could not convert size info: proportional size not supported"),!1):(r(h,"Could not convert size info: scale-dependent size not supported"),
!1);if(!d(a.field)){if(a.stops&&a.stops[0]&&u(a.stops[0].size))return b.minSize[c]=a.stops[0].size,b.maxSize[c]=a.stops[0].size,b.offset[c]=b.minSize[c],b.factor[c]=0,b.type[c]=1,!0;if(u(l))return b.minSize[c]=l,b.maxSize[c]=l,b.offset[c]=l,b.factor[c]=0,b.type[c]=1,!0}return r(h,"Could not convert size info: unsupported variant of sizeInfo"),!1}function t(a,b,c,d,k,h){d=0<Math.abs(d-c)?(b-a)/(d-c):0;k.minSize[h]=0<d?a:b;k.maxSize[h]=0<d?b:a;k.offset[h]=a-c*d;k.factor[h]=d}function C(a,b,d,k){if(a.normalizationField||
a.valueRepresentation)return r(k,"Could not convert size info: unsupported property"),null;var h=a.field;if(null!=h&&"string"!=typeof h)return r(k,"Could not convert size info: field is not a string"),null;if(b.size){if(a.field)if(b.size.field){if(a.field!==b.size.field)return r(k,"Could not convert size info: multiple fields in use"),null}else b.size.field=a.field}else b.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};var l;switch(a.axis){case "width":return l=
c(a,b.size,0,d,k),l?b:null;case "height":return l=c(a,b.size,2,d,k),l?b:null;case "depth":return l=c(a,b.size,1,d,k),l?b:null;case "width-and-depth":return l=c(a,b.size,0,d,k),l&&c(a,b.size,1,d,k),l?b:null;case null:case void 0:case "all":return l=c(a,b.size,0,d,k),l=l&&c(a,b.size,1,d,k),l=l&&c(a,b.size,2,d,k),l?b:null;default:return r(k,'Could not convert size info: unknown axis "'+a.axis+'""'),null}}function q(a,b,c){for(var d=0;3>d;++d){var k=b.unitInMeters;1===a.type[d]&&(k*=b.modelSize[d],a.type[d]=
2);a.minSize[d]/=k;a.maxSize[d]/=k;a.offset[d]/=k;a.factor[d]/=k}if(0!==a.type[0])b=0;else if(0!==a.type[1])b=1;else{if(0===a.type[2])return r(c,"No size axis contains a valid size or scale"),!1;b=2}for(d=0;3>d;++d)0===a.type[d]&&(a.minSize[d]=a.minSize[b],a.maxSize[d]=a.maxSize[b],a.offset[d]=a.offset[b],a.factor[d]=a.factor[b],a.type[d]=a.type[b]);return!0}function v(a,b,c){a[4*b+0]=c.r/255;a[4*b+1]=c.g/255;a[4*b+2]=c.b/255;a[4*b+3]=c.a}function y(a,b,c){if(a.normalizationField)return r(c,"Could not convert color info: unsupported property"),
null;if("string"==typeof a.field)if(a.stops){if(8<a.stops.length)return r(c,"Could not convert color info: too many color stops"),null;b.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};a=a.stops;for(c=0;8>c;++c){var k=a[Math.min(c,a.length-1)];b.color.values[c]=k.value;v(b.color.colors,c,k.color)}}else{if(!a.colors)return r(c,"Could not convert color info: missing stops or colors"),null;if(!d(a.minDataValue)||!d(a.maxDataValue))return r(c,
"Could not convert color info: missing data values"),null;if(2!==a.colors.length)return r(c,"Could not convert color info: invalid colors array"),null;b.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};b.color.values[0]=a.minDataValue;v(b.color.colors,0,a.colors[0]);b.color.values[1]=a.maxDataValue;v(b.color.colors,1,a.colors[1]);for(c=2;8>c;++c)b.color.values[c]=a.maxDataValue,v(b.color.colors,c,a.colors[1])}else{if(!(a.stops&&
0<=a.stops.length||a.colors&&0<=a.colors.length))return r(c,"Could not convert color info: no field and no colors/stops"),null;a=a.stops&&0<=a.stops.length?a.stops[0].color:a.colors[0];b.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(c=0;8>c;c++)b.color.values[c]=1/0,v(b.color.colors,c,a)}return b}function B(a,b,c,d){a=2===c&&"arithmetic"===a.rotationType;b.offset[c]=a?90:0;b.factor[c]=a?-1:1;b.type[c]=1}function D(a,b,c){if("string"!=
typeof a.field)return r(c,"Could not convert rotation info: field is not a string"),null;if(b.rotation){if(a.field)if(b.rotation.field){if(a.field!==b.rotation.field)return r(c,"Could not convert rotation info: multiple fields in use"),null}else b.rotation.field=a.field}else b.rotation={field:a.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(a.axis){case "tilt":return B(a,b.rotation,0,c),b;case "roll":return B(a,b.rotation,1,c),b;case null:case void 0:case "heading":return B(a,b.rotation,
2,c),b;default:return r(c,'Could not convert rotation info: unknown axis "'+a.axis+'""'),null}}function b(a,b,c){if(!a)return null;var d=!b.supportedTypes||!!b.supportedTypes.size,k=!b.supportedTypes||!!b.supportedTypes.color,h=!b.supportedTypes||!!b.supportedTypes.rotation;J&&(c=c||[]);return(a=a.reduce(function(a,l){if(!a)return a;if(l.valueExpression)return r(c,"Could not convert visual variables: arcade expressions not supported"),null;switch(l.type){case "size":return d?C(l,a,b,c):a;case "color":return k?
y(l,a,c):a;case "rotation":return h?D(l,a,c):a;default:return r(c,"Could not convert visual variables: unsupported type "+l.type),null}},{size:null,color:null,rotation:null}))&&a.size&&!q(a.size,b,c)?null:a}function m(b,c,d){if(!!b!=!!c)return a("State update failed ({$name} enabled/disabled)"),!1;if(b&&b.field!==c.field)return a("State update failed ({$name} field changed)"),!1;if(b&&"rotation"===d)for(d=0;3>d;d++)if(b.type[d]!==c.type[d]||b.offset[d]!==c.offset[d]||b.factor[d]!==c.factor[d])return!1;
return!0}function E(a,b){var c={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvSymbolAnchor:null,vvSymbolRotation:null},d=a&&null!=a.size;return a&&a.size?(c.vvSizeEnabled=!0,c.vvSizeMinSize=a.size.minSize,c.vvSizeMaxSize=a.size.maxSize,c.vvSizeOffset=a.size.offset,c.vvSizeFactor=a.size.factor):a&&d&&(c.vvSizeValue=b.transformation.scale),a&&d&&(c.vvSymbolAnchor=b.transformation.anchor,
c.vvSymbolRotation=b.transformation.rotation),a&&a.color&&(c.vvColorEnabled=!0,c.vvColorValues=a.color.values,c.vvColorColors=a.color.colors),c}Object.defineProperty(p,"__esModule",{value:!0});var J=!1;p.convertVisualVariables=b;p.initFastSymbolUpdatesState=function(c,d,h){return d?c?c.disableFastUpdates?(a("State not initialized, fast updates disabled (renderer.disableFastUpdates set)"),{enabled:!1}):(c=b(c.visualVariables,h))?(k("State initialized, fast updates enabled"),{enabled:!0,visualVariables:c,
materialParameters:E(c,h),customTransformation:c&&null!=c.size}):(a("State not initialized, fast updates disabled (conversion failed)"),{enabled:!1}):(a("State not initialized, fast updates disabled (no renderer)"),{enabled:!1}):(a("State not initialized, fast updates disabled (no shader support)"),{enabled:!1})};p.updateFastSymbolUpdatesState=function(c,d,h){if(!d||!c.enabled)return!1;var l=c.visualVariables;return(d=b(d.visualVariables,h))?m(l.size,d.size,"size")&&m(l.color,d.color,"color")&&m(l.rotation,
d.rotation,"rotation")?(c.visualVariables=d,c.materialParameters=E(d,h),c.customTransformation=d&&null!=d.size,k("State updated"),!0):!1:(a("State update failed (conversion failed)"),!1)};p.getMaterialParams=E;var G;!function(a){var b=l.mat4d,c=l.vec3,d=b.create(),k=c.create();a.evaluateModelTransform=function(a,c,l){if(!a.vvSizeEnabled)return l;if(b.identity(d),b.multiply(l,d,d),h.computeObjectRotation(a.vvSymbolRotation[2],a.vvSymbolRotation[0],a.vvSymbolRotation[1],d),a.vvSizeEnabled){for(l=0;3>
l;++l){var m=a.vvSizeOffset[l]+c[0]*a.vvSizeFactor[l],q=a.vvSizeMinSize[l],r=a.vvSizeMaxSize[l];k[l]=q>m?q:m>r?r:m}b.scale(d,k,d)}else b.scale(d,a.vvSizeValue,d);return b.translate(d,a.vvSymbolAnchor,d),d}}(G||(G={}));p.evaluateModelTransform=G.evaluateModelTransform})},"esri/symbols/support/symbolUtils":function(){define(["require","exports","../../core/sniff"],function(A,p,w){Object.defineProperty(p,"__esModule",{value:!0});p.isVolumetricSymbol=function(h){return(h=h&&h.symbolLayers)?h.some(function(d){d=
d.type;return"object"===d||"path"===d||"extrude"===d}):!1};p.getIconHref=function(h,d){d=d.resource.href;return!w("esri-canvas-svg-support")&&h.styleOrigin&&l.test(d)?d.replace(l,"/resource/png/$1.png"):d};var l=/\/resource\/(.*?)\.svg$/})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/_base/lang dojo/errors/CancelError ../../../../Color ../../../../core/screenUtils ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./ElevationAligners ./Graphics3DSymbolCommonCode ./graphicUtils ../support/FastSymbolUpdates ./objectResourceUtils ../../lib/glMatrix ../../../../symbols/ObjectSymbol3DLayer ../../support/aaBoundingBox ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/materials/Material".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E){var J=v.mat4d,G=v.vec3d,K=[1,1,1],M=[1,1,1,1],U=[0,0,0];A=[-.5,-.5,-.5,.5,.5,.5];p=[-.5,-.5,0,.5,.5,1];var N={sphere:A,cube:A,cylinder:p,cone:p,"inverted-cone":p,tetrahedron:[-.5,-.5,0,.5,.5,.5],diamond:A},W=[D.ModelContentType.MATERIAL,D.ModelContentType.TEXTURE,D.ModelContentType.GEOMETRY];return function(r){function p(){return null!==r&&r.apply(this,arguments)||this}return w(p,r),p.prototype._prepareResources=function(){var a=this.symbol,b=this._getStageIdHint();
if(!this._isPropertyDriven("size")){var c=t.validateSymbolLayerSize(this.symbol);if(c)return this._logWarning(c),void this.reject()}a.resource&&a.resource.href?this._prepareModelResources(a.resource.href,b):this._preparePrimitiveResources(a.resource?a.resource.primitive:"sphere",b)},p.prototype._preparePrimitiveResources=function(a,c){var k=this.symbol;if("sphere"===a)this._geometryData=m.createPolySphereGeometry(.5,2,!0);else if("cube"===a)this._geometryData=m.createBoxGeometry(1);else if("cylinder"===
a)this._geometryData=m.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);else{if("cone"===a)this._geometryData=m.createConeGeometry(1,.5,15,!1);else if("inverted-cone"===a)this._geometryData=m.createConeGeometry(1,.5,15,!0);else if("tetrahedron"===a)this._geometryData=m.createTetrahedronGeometry(1);else{if("diamond"!==a)return this._logWarning("Unknown object symbol primitive: "+a),void this.reject();this._geometryData=m.createDiamondGeometry(1)}m.cgToGIS(this._geometryData)}this._geometry=new b(this._geometryData,
c);this._context.stage.add(D.ModelContentType.GEOMETRY,this._geometry);this._resourceBoundingBox=N[a];this._resourceSize=B.size(this._resourceBoundingBox);this._symbolSize=t.computeSizeWithResourceSize(this._resourceSize,k);a=this._getMaterialOpacity();a={specular:[0,0,0],shininess:3,opacity:a,transparent:1>a||this._isPropertyDriven("opacity"),instanced:["transformation"],ambient:K,diffuse:K};var h=this.symbolContainer;if("point-3d"===h.type&&h.verticalOffset){var h=h.verticalOffset,q=h.minWorldLength,
r=h.maxWorldLength;a.verticalOffset={screenLength:u.pt2px(h.screenLength),minWorldLength:q||0,maxWorldLength:null!=r?r:1/0};a.castShadows=!1}(this._context.screenSizePerspectiveEnabled&&(a.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._isPropertyDriven("color"))?a.externalColor=M:(k=k.material?d.toUnitRGBA(k.material.color):M,a.externalColor=k);this._fastUpdates=C.initFastSymbolUpdatesState(this._context.renderer,this._supportsShaderVisualVariables(),this._fastVisualVariableConvertOptions());
this._fastUpdates.enabled?(l.mixin(a,this._fastUpdates.materialParameters),a.instanced.push("featureAttribute")):this._hasPerInstanceColor()&&a.instanced.push("color");this._material=new E(a,c+"_objectmat");this._context.stage.add(D.ModelContentType.MATERIAL,this._material);this.resolve()},p.prototype._prepareModelResources=function(a,b){var c=this,d=["transformation"];b={materialParamsMixin:{instanced:d},idHint:b,streamDataSupplier:this._context.streamDataSupplier};this._fastUpdates=C.initFastSymbolUpdatesState(this._context.renderer,
this._supportsShaderVisualVariables(),this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(l.mixin(b.materialParamsMixin,this._fastUpdates.materialParameters),d.push("featureAttribute")):this._hasPerInstanceColor()&&d.push("color");d=this.symbolContainer;if("point-3d"===d.type&&d.verticalOffset){var d=d.verticalOffset,k=d.minWorldLength,m=d.maxWorldLength;b.materialParamsMixin.verticalOffset={screenLength:u.pt2px(d.screenLength),minWorldLength:k||0,maxWorldLength:null!=m?m:1/0};b.materialParamsMixin.castShadows=
!1}this._symbolLoaderPromise=q.fetch(a,b);this._symbolLoaderPromise.then(function(a){if(c._symbolLoaderPromise=null,!c.isRejected()){var b=c._context,d=a.stageResources,g=b.stage,k=c._getExternalColorParameters(c.symbol.material),h=c._getMaterialOpacity(),l=c._isPropertyDriven("opacity"),m=d[D.ModelContentType.MATERIAL];a.originalMaterialOpacities=Array(m.length);m.forEach(function(c,e){var d=c.getParameterValues();c.setParameterValues(k);a.originalMaterialOpacities[e]=d.opacity;e=d.opacity*h;c.setParameterValues({opacity:e,
transparent:1>e||l||d.transparent});b.screenSizePerspectiveEnabled&&c.setParameterValues({screenSizePerspective:b.sharedResources.screenSizePerspectiveSettings})});W.forEach(function(a){for(var b=d[a],c=0;b&&c<b.length;c++)g.add(a,b[c])});c._resourceBoundingBox=q.computeBoundingBox(a);c._resourceSize=B.size(c._resourceBoundingBox);c._pivotOffset=a.pivotOffset;c._symbolSize=t.computeSizeWithResourceSize(c._resourceSize,c.symbol);c._i3sModel=a;C.updateFastSymbolUpdatesState(c._fastUpdates,c._context.renderer,
c._fastVisualVariableConvertOptions())&&m.forEach(function(a){return a.setParameterValues(c._fastUpdates.materialParameters)});c.resolve()}},function(a){if(c._symbolLoaderPromise=null,!c.isFulfilled()){if(!(a instanceof h)){var b="ObjectSymbol3DLayer failed to load";a&&a.message&&(b+=" ("+a.message+")");c._logWarning(b)}c.reject()}})},p.prototype._forEachMaterial=function(a){this._i3sModel?this._i3sModel.stageResources[D.ModelContentType.MATERIAL].forEach(a):a(this._material)},p.prototype._getExternalColorParameters=
function(a){var b={};return this._isPropertyDriven("color")?b.externalColor=M:a&&a.color?b.externalColor=d.toUnitRGBA(a.color):(b.externalColor=M,b.colorMixMode="ignore"),b},p.prototype.destroy=function(){r.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._symbolLoaderPromise&&this._symbolLoaderPromise.cancel();var a=this._context.stage;if(this._i3sModel){var b=this._i3sModel.stageResources;W.forEach(function(c){for(var d=b[c],k=0;d&&k<d.length;k++)a.remove(c,d[k].getId())})}else this._material&&
a.remove(D.ModelContentType.MATERIAL,this._material.getId()),this._geometry&&a.remove(D.ModelContentType.GEOMETRY,this._geometry.getId())},p.prototype._getGeometry=function(a){a=this._validateGeometry(a.geometry);return"polyline"===a.type?c.placePointOnPolyline(a):"polygon"===a.type?c.placePointOnPolygon(a):"extent"===a.type?a.center:"point"!==a.type?(this._logWarning("unsupported geometry type for object symbol: "+a.type),null):a},p.prototype.createGraphics3DGraphic=function(a,b){var c=this._getGeometry(a);
if(null===c)return null;var d="graphic"+a.uid,k=this.getGraphicElevationContext(a);return this._createAs3DShape(a,c,b,k,d,a.uid)},p.prototype.layerPropertyChanged=function(a,b,d){var k=this;if("opacity"===a){var h=this._isPropertyDriven("opacity");if(this._i3sModel){var l=this._getMaterialOpacity();this._i3sModel.stageResources[D.ModelContentType.MATERIAL].forEach(function(a,b){b=k._i3sModel.originalMaterialOpacities[b]*l;a.setParameterValues({opacity:b,transparent:1>b||h})})}else b=this._getMaterialOpacity(),
this._material.setParameterValues({opacity:b,transparent:1>b||h});return!0}if("elevationInfo"===a){this._updateElevationContext();for(var g in b){var e=b[g];if(a=d(e))e=this.getGraphicElevationContext(e.graphic),a.needsElevationUpdates=c.needsElevationUpdates3D(e.mode),a.elevationContext.set(e)}return!0}return!1},p.prototype.applyRendererDiff=function(a,b,c,d){var k=this,h;for(h in a.diff)switch(h){case "visualVariables":if(!C.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))return!1;
this._forEachMaterial(function(a){return a.setParameterValues(k._fastUpdates.materialParameters)});break;default:return!1}return!0},p.prototype._createAs3DShape=function(b,d,h,l,m,q){var g=this,e=null,f=null;(b=this._getFastUpdateAttrValues(b))&&(e=e||{},e.featureAttribute=b,f=function(a){return C.evaluateModelTransform(g._fastUpdates.materialParameters,e.featureAttribute,a)});!this._fastUpdates.enabled&&this._hasPerInstanceColor()&&(e=e||{},e.color=t.mixinColorAndOpacity(h.color,h.opacity));b=this._context.layer.uid;
var n=J.identity();if(this._applyObjectRotation(h,n),this._applyObjectRotation(this.symbol,n),this._applyObjectScale(h,n),this._applyAnchor(n),this._i3sModel){h=this._i3sModel.stageResources[D.ModelContentType.GEOMETRY];for(var r=this._i3sModel.materialsByComponent,p=Array(h.length),v=0;v<n.length;v++)p[v]=n;m=c.createStageObjectForPoint.call(this,d,h,r,p,e,l,m,b,q,null,f)}else m=c.createStageObjectForPoint.call(this,d,[this._geometry],[[this._material]],[n],e,l,m,b,q,null,f);if(null===m)return null;
if(this._fastUpdates.enabled){var u=C.getMaterialParams(this._fastUpdates.visualVariables,this._fastVisualVariableConvertOptions());this._forEachMaterial(function(a){return a.setParameterValues(u)})}m.object.setCastShadow(!0);q=new a(this,m.object,null,null,null,k.perObjectElevationAligner,l,a.VisibilityModes.REMOVE_OBJECT);return q.alignedTerrainElevation=m.terrainElevation,q.needsElevationUpdates=c.needsElevationUpdates3D(l.mode),c.extendPointGraphicElevationContext(q,d,this._context.elevationProvider),
q},p.prototype._applyObjectScale=function(a,b){this._fastUpdates.enabled&&this._fastUpdates.customTransformation||(a=this._isPropertyDriven("size")&&a.size?a.size:this._symbolSize,a=t.computeObjectScale(a,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters),1===a[0]&&1===a[1]&&1===a[2]||J.scale(b,a))},p.prototype._applyObjectRotation=function(a,b){return this._fastUpdates.enabled&&this._fastUpdates.customTransformation&&a instanceof y?void 0:t.computeObjectRotation(a.heading,
a.tilt,a.roll,b)},p.prototype._computeAnchor=function(){switch(this.symbol.anchor){case "center":return G.scale(B.center(this._resourceBoundingBox),-1);case "top":var a=B.center(this._resourceBoundingBox);return[-a[0],-a[1],-this._resourceBoundingBox[5]];case "bottom":return a=B.center(this._resourceBoundingBox),[-a[0],-a[1],-this._resourceBoundingBox[2]];default:return this._pivotOffset?G.scale(this._pivotOffset,-1,Array(3)):U}},p.prototype._applyAnchor=function(a){if(!this._fastUpdates.enabled||
!this._fastUpdates.customTransformation){var b=this._computeAnchor();b&&J.translate(a,b)}},p.prototype._hasPerInstanceColor=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")},p.prototype._supportsShaderVisualVariables=function(){return this._context.stage.has("angleInstancedArrays")?!0:!1},p.prototype._fastVisualVariableConvertOptions=function(){var a=this._resourceBoundingBox?B.size(this._resourceBoundingBox):K,b=this._resourceBoundingBox?this._computeAnchor():
U,c=this._context.renderCoordsHelper.unitInMeters,d=t.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,c);return{modelSize:a,symbolSize:this._symbolSize||K,unitInMeters:c,transformation:{anchor:b,scale:d,rotation:[this.symbol.tilt||0,this.symbol.roll||0,this.symbol.heading||0]}}},p.PRIMITIVE_BOUNDING_BOX=N,p}(r)})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/sniff dojo/_base/lang dojo/Deferred dojo/errors/CancelError ../../../../request ../../../../core/Error ../../../../core/Version ../../../../core/Logger ../../lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/materials/Material ../../webgl-engine/lib/Texture ../../support/aaBoundingBox".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D){function b(b){return new a("","Request for object resource failed: "+b)}function m(a,b){var c,d,m=[],r=[],p=[],t=[],u=[],w=k.Version.parse(a.version||"1.0","wosr");J.validate(w);var w="meshsymbol_"+a.model.name,C=a.textureDefinitions,z={},D;for(D in C){var A=C[D];if(c=A.images[0].data){d=A.encoding+";base64,"+c;c="/textureDefinitions/"+D;var g={noUnpackFlip:!0,wrapClamp:!1};l("enable-feature:jkieboom/alpha-channel-usage")&&(g.wrapClamp=!0);d=new B(d,w,
g);u.push(d);z[c]={engineTexObj:d,alphaChannelUsage:"rgba"===A.channels?A.alphaChannelUsage||"transparency":"none"}}else E.warn("Externally referenced texture data is not yet supported")}D=a.model.geometries;C=a.materialDefinitions;for(A=0;A<D.length;A++){d=g=D[A];var e=d.params,f=e.topology;c=!0;switch(e.vertexAttributes||(E.warn("Geometry must specify vertex attributes"),c=!1),e.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:if(e.faces){if(e.vertexAttributes)for(f in f=
void 0,e.vertexAttributes){var n=e.faces[f];n&&n.values?(null!=n.valueType&&"UInt32"!==n.valueType&&(E.warn("Unsupported indexed geometry indices type '"+n.valueType+"', only UInt32 is currently supported"),c=!1),null!=n.valuesPerElement&&1!==n.valuesPerElement&&(E.warn("Unsupported indexed geometry values per element '"+n.valuesPerElement+"', only 1 is currently supported"),c=!1)):(E.warn("Indexed geometry does not specify face indices for '"+f+"' attribute"),c=!1)}}else E.warn("Indexed geometries must specify faces"),
c=!1;break;default:E.warn("Unsupported topology '"+f+"'"),c=!1}d.params.material||(E.warn("Geometry requires material"),c=!1);d=d.params.vertexAttributes;e=void 0;for(e in d)d[e].values||(E.warn("Geometries with externally defined attributes are not yet supported"),c=!1);if(c){d=g.params;c=d.material;d=d.texture;var f=g.params.vertexAttributes,e={},x;for(x in f)n=f[x],e[x]={data:n.values,size:n.valuesPerElement};p.push([]);f={};if("PerAttributeArray"===g.params.topology){for(var g=e.position.data.length/
e.position.size,n=new Uint32Array(g),G=0;g>G;G++)n[G]=G;var g=n,K;for(K in e)f[K]=g}else for(var P in g.params.faces)f[P]=new Uint32Array(g.params.faces[P].values);g=d?z[d]:null;n=t[c]?t[c][d]:null;n||(n=c.substring(c.lastIndexOf("/")+1),n=C[n].params,1===n.transparency&&(n.transparency=0),n={ambient:n.diffuse,diffuse:n.diffuse,specular:[0,0,0],shininess:0,opacity:1-(n.transparency||0),transparent:0<n.transparency,textureId:g?g.engineTexObj.getId():void 0,doubleSided:!0,cullFace:"none",flipV:!1,colorMixMode:n.externalColorMixMode||
"tint"},l("enable-feature:jkieboom/alpha-channel-usage")&&(!g||"transparency"!==g.alphaChannelUsage&&"maskAndTransparency"!==g.alphaChannelUsage||(n.transparent=!0)),b&&b.materialParamsMixin&&h.mixin(n,b.materialParamsMixin),n=new y(n,w),t[c]||(t[c]={}),t[c][d]=n,r.push(n));p[A].push(n);c=new q(new v(e,f),w);m.push(c)}}return{stageResources:{textures:u,materials:r,geometries:m},materialsByComponent:p,pivotOffset:a.model.pivotOffset}}Object.defineProperty(p,"__esModule",{value:!0});var E=c.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),
J=new k.Version(1,1,"wosr");p.fetch=function(a,c){c=c||{};var k=c.streamDataSupplier;if(k){var h=k.request(a,"json"),l=new d(function(){return k.cancelRequest(h)});return h.then(function(a,b){try{var d=m(b,c);return l.resolve(d)}catch(X){return l.reject(X)}},function(a){l.reject(a instanceof u?a:b(a))}),l.promise}var q=r(a),p=new d(function(){return q.cancel()});return q.then(function(a){try{var b=m(a.data,c);return p.resolve(b)}catch(S){return p.reject(S)}},function(c){p.reject(c instanceof u?c:
b(a))}),p.promise};p.computeBoundingBox=function(a){a=a.stageResources[C.ModelContentType.GEOMETRY];for(var b=D.create(D.NEGATIVE_INFINITY),c=[0,0,0],d=[0,0,0],k=0;k<a.length;k++){var h=a[k].getBoundingInfo();t.vec3d.set(h.getBBMin(),c);t.vec3d.set(h.getBBMax(),d);for(h=0;3>h;++h)b[h]=Math.min(b[h],c[h]),b[h+3]=Math.max(b[h+3],d[h])}return b};p.createStageResources=m})},"esri/core/Version":function(){define(["require","exports","./Error"],function(A,p,w){Object.defineProperty(p,"__esModule",{value:!0});
A=function(){function l(h,d,l){void 0===l&&(l="");this.major=h;this.minor=d;this._context=l}return l.prototype.lessThan=function(h,d){return this.major<h||h===this.major&&this.minor<d},l.prototype.since=function(h,d){return!this.lessThan(h,d)},l.prototype.validate=function(h){if(this.major!==h.major)throw new w((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:h});
},l.prototype.clone=function(){return new l(this.major,this.minor,this._context)},l.parse=function(h,d){void 0===d&&(d="");var p=h.split("."),r=p[0],p=p[1],a=/^\s*\d+\s*$/;if(!r||!r.match||!r.match(a))throw new w((d&&d+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:h});if(!p||!p.match||!p.match(a))throw new w((d&&d+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:h});h=parseInt(r,10);r=parseInt(p,10);return new l(h,
r,d)},l}();p.Version=A})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./Graphics3DDrapedGraphicLayer ./ElevationAligners ./Graphics3DSymbolCommonCode ./lineUtils ../../../../core/screenUtils ../../../../geometry/Polygon ../../lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/RenderGeometry ./graphicUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B){var D=t.vec3d,b=t.mat4d;return function(l){function m(){return null!==l&&l.apply(this,arguments)||this}return w(m,l),m.prototype._prepareResources=function(){var b=this.symbol,c=this._isPropertyDriven("size")||this._isPropertyDriven("color")||this._isPropertyDriven("opacity"),b={idHint:this._getStageIdHint(),width:this._getWidth(b),color:this._getMaterialOpacityAndColor()};if(!this._isPropertyDriven("size")){var d=B.validateSymbolLayerSize(b.width);if(d)return this._logWarning(d),
void this.reject()}if(c||1.5<=b.width)this._isPropertyDriven("size")&&(b.width=0),this._material=a.createRibbonMaterial(b);else{if(!(0<b.width))return void this.reject();this._material=a.createNativeMaterial(b)}this._context.stage.add(C.ModelContentType.MATERIAL,this._material);this.resolve()},m.prototype._getWidth=function(a){return null!=a.size?k.pt2px(a.size):1},m.prototype.destroy=function(){l.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(C.ModelContentType.MATERIAL,
this._material.getId()),this._material=null)},m.prototype.createGraphics3DGraphic=function(a,b){var c=this._validateGeometry(a.geometry);if("polyline"!==c.type&&"polygon"!==c.type&&"extent"!==c.type)return this._logWarning("unsupported geometry type for line symbol: "+c.type),null;var c="polygon"===c.type||"extent"===c.type?"rings":"paths",d="graphic"+a.uid,h=this._getVertexOpacityAndColor(b,Float32Array,255),l=0;b.size&&this._isPropertyDriven("size")&&(l=r.getSingleSizeDriver(b.size),l=k.pt2px(l));
b=this.getGraphicElevationContext(a);return"on-the-ground"===b.mode?this._createAsOverlay(a,c,h,l,b,d):this._createAs3DShape(a,c,h,l,b,d,a.uid)},m.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)return b=this._material.getColor(),this._material.setColor([b[0],b[1],b[2],this._getMaterialOpacity()]),!0;if("elevationInfo"===a){a=this._elevationContext.mode;this._updateElevationContext();var d=this._elevationContext.mode;if(null==a||null==d)return!1;if("on-the-ground"===a&&"on-the-ground"===
d)return!0;if(a!==d&&("on-the-ground"===a||"on-the-ground"===d))return!1;a=r.needsElevationUpdates2D(d);for(var k in b){var h=b[k];(d=c(h))&&!d.isDraped()&&(h=h.graphic,d.needsElevationUpdates=a,d.elevationContext.set(this.getGraphicElevationContext(h)))}return!0}return!1},m.prototype._getOutlineGeometry=function(a,b){return b},m.prototype._getGeometry=function(a){a=this._validateGeometry(a.geometry);return"extent"===a.type&&(a=c.fromExtent(a)),a},m.prototype._createAs3DShape=function(c,d,k,l,m,p,
t){var w=this._getGeometry(c),y=w.hasZ,C=w[d],E=this._getOutlineGeometry(w,C);c=[];var B=[],z=[],A=D.create(),G=Array(6),w=r.getGeometryVertexData3D(E,y,w.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,m);if(this._logGeometryCreationWarnings(w,C,d,"LineSymbol3DLayer"),0<E.length){for(var C=w.geometryData.outlines,E=w.eleVertexData,y=w.vertexData,g=0;g<C.length;++g){var e=C[g];if(!(1>=e.count)){var f=e.index,n=e.count;this._context.clippingExtent&&
(r.computeBoundingBox(E,f,n,G),r.boundingBoxClipped(G,this._context.clippingExtent))||(r.chooseOrigin(y,f,n,A),r.subtractCoordinates(y,f,n,A),e=new Float64Array(E.buffer,3*f*E.BYTES_PER_ELEMENT,3*n),f=new Float64Array(y.buffer,3*f*y.BYTES_PER_ELEMENT,3*n),f=a.createPolylineGeometry(f,e,"rings"===d,k,l),f=new v(f,p+"path"+g),f.singleUse=!0,c.push(f),B.push([this._material]),f=b.identity(),b.translate(f,A,f),z.push(f))}}if(0<c.length)return d=new q({geometries:c,materials:B,transformations:z,castShadow:!1,
metadata:{layerUid:this._context.layer.uid,graphicId:t},idHint:p}),d=new h(this,d,c,null,null,u.perVertexElevationAligner,m),d.alignedTerrainElevation=w.terrainElevation,d.needsElevationUpdates=r.needsElevationUpdates2D(m.mode),d}return null},m.prototype._createAsOverlay=function(c,k,h,l,m,q){var p=this._getGeometry(c);this._material.setRenderPriority(this._symbolLayerOrder);var t=p[k],v=this._getOutlineGeometry(p,t);c=[];var u=Array(6),w=D.create(),p=r.getGeometryVertexDataDraped(v,p.spatialReference,
this._context.overlaySR);if(this._logGeometryCreationWarnings(p,t,k,"LineSymbol3DLayer"),0<v.length){t=p.vertexData;v=p.geometryData.outlines;for(p=0;p<v.length;++p){var C=v[p],z=C.index,C=C.count;if(r.computeBoundingBox(t,z,C,u),!r.boundingBoxClipped(u,this._context.clippingExtent)){r.chooseOrigin(t,z,C,w);r.subtractCoordinates(t,z,C,w);r.setZ(t,z,C,this._getDrapedZ());C=new Float64Array(t.buffer,3*z*t.BYTES_PER_ELEMENT,3*C);z=b.identity();b.translate(z,w,z);var C=a.createPolylineGeometry(C,null,
"rings"===k,h,l),E=new y(C);E.material=this._material;E.center=[.5*(u[0]+u[3]),.5*(u[1]+u[4]),0];E.bsRadius=.5*Math.sqrt((u[3]-u[0])*(u[3]-u[0])+(u[4]-u[1])*(u[4]-u[1]));E.transformation=z;E.name=q;E.uniqueName=q+"#"+C.id;c.push(E)}}return new d(this,c,null,null,u,m)}return null},m}(l)})},"esri/views/3d/layers/graphics/lineUtils":function(){define("require exports ../../webgl-engine/materials/RibbonLineMaterial ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util".split(" "),
function(A,p,w,l,h,d){function u(a){var d=a.length;return a[0]===a[d-3]&&a[1]===a[d-2]&&a[2]===a[d-1]}Object.defineProperty(p,"__esModule",{value:!0});var r=d.VertexAttrConstants;p.createRibbonMaterial=function(a){var d={width:a.width,color:a.color,miterLimit:a.miterLimit,polygonOffset:!0};return"miter"===a.join||"bevel"===a.join?d.join=a.join:(d.join="miter",a.join&&console.warn("unsupported join type for line symbol: "+a.join)),new w(d,a.idHint+"_ribbonlinemat")};p.createNativeMaterial=function(a){return new l(a.width,
a.color,a.idHint+"_nativelinemat")};p.isClosed=u;p.createPolylineGeometry=function(a,d,c,l,p){var k,t,w;if(c=c&&!u(a)){c=new Float32Array(a.length+3);for(t=0;t<a.length;t++)c[t]=a[t];t=c.length;c[t-3]=a[0];c[t-2]=a[1];c[t-1]=a[2];k=a.length/3+1;t=new Uint32Array(2*(k-1));w=new Uint32Array(2*(k-1))}else k=a.length/3,t=new Uint32Array(2*(k-1)),w=new Uint32Array(2*(k-1)),c=a;a=new Float32Array(1);a[0]=p;for(var C=p=0,A=0;k-1>A;A++)t[p++]=A,t[p++]=A+1,w[C++]=0,w[C++]=0;p={};k={};p[r.POSITION]=t;p[r.COLOR]=
w;p[r.SIZE]=w;k[r.POSITION]={size:3,data:c,offsetIdx:0,strideIdx:3};k[r.COLOR]={size:4,data:l,offsetIdx:0,strideIdx:4};k[r.SIZE]={size:1,data:a,offsetIdx:0,strideIdx:1};d&&(p.mapPos=t,k.mapPos={size:3,data:d,offsetIdx:0,strideIdx:3});return new h(k,p,h.DefaultOffsets,"line")}})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("./internal/MaterialUtil ../lib/Util ../lib/gl-matrix ../lib/RenderSlot ../lib/DefaultVertexBufferLayouts ../lib/ComponentUtils ../../../webgl/Util".split(" "),
function(A,p,w,l,h,d,u){var r=w.vec3d,a=w.vec2d,k=w.mat4d,c=p.VertexAttrConstants,t=r.create(),C=r.create(),q=r.create(),v=r.create(),y=a.create(),B=a.create(),D=r.create(),b=r.create(),m=[],E=function(a,b){A.basicGLMaterialConstructor(this,a);var c=b.get("simple"),d=a.getColor();this.beginSlot=function(a){return a===l.OPAQUE_MATERIAL};this.getProgram=function(){return c};this.bind=function(a,b){a.bindProgram(c);c.setUniform4fv("color",d);a.setBlendingEnabled(1>d[3]);a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,
a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);a.setDepthTestEnabled(!0)};this.release=function(a){1>d[3]&&a.setBlendingEnabled(!1)};this.bindView=function(a,b){A.bindView(b.origin,b.view,c)};this.bindInstance=function(a,b){c.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){return a.gl.LINES}},J=function(a,b){A.basicGLMaterialConstructor(this,a);var c=b.get("highlight");this.beginSlot=function(a){return a===l.OPAQUE_MATERIAL};this.getProgram=function(){return c};
this.bind=function(a,b){a.bindProgram(c);a.setDepthTestEnabled(!0)};this.release=function(a){};this.bindView=function(a,b){A.bindView(b.origin,b.view,c)};this.bindInstance=function(a,b){c.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){return a.gl.LINES}};return function(a,l,w){A.basicMaterialConstructor(this,w);var G=h.Pos3,K=u.getStride(G)/4;this.canBeMerged=!0;this.setColor=function(a){l=a;this.notifyDirty("matChanged")};this.getColor=function(){return l};this.dispose=
function(){};this.getOutputAmount=function(a){return a*K};this.getVertexBufferLayout=function(){return G};this.fillInterleaved=function(a,b,d,k,h,l){d=a.vertexAttr[c.POSITION].data;if(b){var q=d;d=m;for(k=0;k<q.length;k+=3){var r=q[k],p=q[k+1],g=q[k+2];d[k]=b[0]*r+b[4]*p+b[8]*g+b[12];d[k+1]=b[1]*r+b[5]*p+b[9]*g+b[13];d[k+2]=b[2]*r+b[6]*p+b[10]*g+b[14]}}a=a.indices[c.POSITION];for(k=0;k<a.length;k++)b=3*a[k],h[l++]=d[b],h[l++]=d[b+1],h[l++]=d[b+2]};this.intersect=function(a,c,h,l,m,u,w){if(l.isSelection&&
!d.isAllHidden(c.componentVisibilities,a.data.componentOffsets)){var z,E;c=a.getData().getVertexAttr("position").position.data;a=Number.MAX_VALUE;m=l.camera;u=l.point;for(var g=0;g<c.length-5;g+=3){if(t[0]=c[g],t[1]=c[g+1],t[2]=c[g+2],k.multiplyVec3(h,t),C[0]=c[g+3],C[1]=c[g+4],C[2]=c[g+5],k.multiplyVec3(h,C),m.projectPoint(t,y),m.projectPoint(C,B),0>y[2]&&0<B[2])r.subtract(t,C,q),z=m.frustumPlanes,E=-(r.dot(z[4],t)+z[4][3]),z=E/r.dot(q,z[4]),r.scale(q,z,q),r.add(t,q,t),m.projectPoint(t,y);else if(0<
y[2]&&0>B[2])r.subtract(C,t,q),z=m.frustumPlanes,E=-(r.dot(z[4],C)+z[4][3]),z=E/r.dot(q,z[4]),r.scale(q,z,q),r.add(C,q,C),m.projectPoint(C,B);else if(0>y[2]&&0>B[2])continue;z=p.pointLineSegmentDistance2D(y,B,u);a>z&&(a=z,r.set(t,D),r.set(C,b))}h=l.p0;l=l.p1;2>a&&(a=p.lineSegmentLineSegmentDistance3D(D,b,h,l),c=Number.MAX_VALUE,a[0]&&(r.subtract(a[2],h,v),a=r.length(v),r.scale(v,1/a),c=a/r.dist(h,l)),w(c,v))}};this.getGLMaterials=function(){return{color:E,depthShadowMap:void 0,normal:void 0,depth:void 0,
highlight:J}};this.getAllTextureIds=function(){return[]}}})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./Graphics3DSymbolCommonCode ../../../../geometry/Point ../../support/projectionUtils ../../../../views/3d/lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/materials/Material ../../webgl-engine/lib/Util ./graphicUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y){function B(a,b,c,k){for(var h=a.getGeometryRecords(),l=h.length,q="absolute-height"!==b.mode,r=0,p=0;l>p;p++){var t=h[p].geometry,v=[h[p].transformation[12],h[p].transformation[13],h[p].transformation[14]],g=t.getData().getVertexAttr(),e=g[E.POSITION].data,f=g.zOffset.data,g=g.mapPos.data,n=g.length/3;m(e.length/3===n*M+2,"unexpected tube geometry");var u=0,w=0;G.spatialReference=c.spatialReference;for(var y=0,C=0;n>C;C++){G.x=g[3*C];G.y=g[3*C+1];G.z=g[3*
C+2];var B=d.computeElevation(c,G,b,k,q?K:null);q&&(y+=K.terrainElevation);var A=M;0!==C&&C!==n-1||A++;for(var D=0;A>D;D++)J[0]=e[u]+v[0],J[1]=e[u+1]+v[1],J[2]=e[u+2]+v[2],k.setAltitude(B+f[w],J),e[u]=J[0]-v[0],e[u+1]=J[1]-v[1],e[u+2]=J[2]-v[2],u+=3,w+=1;t.invalidateBoundingInfo()}a.geometryVertexAttrsUpdated(p);r+=y/n}return r/l}var D=a.vec3d,b=a.mat4d,m=v.assert;A=function(a){function l(){return null!==a&&a.apply(this,arguments)||this}return w(l,a),l.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=
y.validateSymbolLayerSize(this._getSymbolSize());if(a)return this._logWarning(a),void this.reject()}var a=this._getStageIdHint(),b=this._getMaterialOpacityAndColor(),c=D.create(b),b=b[3],c={diffuse:c,ambient:c,opacity:b,transparent:1>b||this._isPropertyDriven("opacity"),vertexColors:this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};this._material=new q(c,a+"_3dlinemat");this._context.stage.add(k.ModelContentType.MATERIAL,this._material);this.resolve()},l.prototype.destroy=function(){a.prototype.destroy.call(this);
this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(k.ModelContentType.MATERIAL,this._material.getId()),this._material=null)},l.prototype.createGraphics3DGraphic=function(a,b){var c=this._validateGeometry(a.geometry);if("polyline"!==c.type)return this._logWarning("unsupported geometry type for path symbol: "+c.type),null;var c="graphic"+a.uid,d=this.getGraphicElevationContext(a);return this._createAs3DShape(a,b,d,c,a.uid)},l.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===
a)return b=this._getMaterialOpacity(),c=1>b||this._isPropertyDriven("opacity"),this._material.setParameterValues({opacity:b,transparent:c}),!0;if("elevationInfo"===a){this._updateElevationContext();for(var k in b){var h=b[k];if(a=c(h))h=this.getGraphicElevationContext(h.graphic),a.needsElevationUpdates=d.needsElevationUpdates3D(h.mode),a.elevationContext.set(h)}return!0}return!1},l.prototype._getPathSize=function(a){var b;return b=a.size&&this._isPropertyDriven("size")?d.getSingleSizeDriver(a.size):
this._getSymbolSize(),b/=this._context.renderCoordsHelper.unitInMeters},l.prototype._getSymbolSize=function(){return this.symbol.size||1},l.prototype._createAs3DShape=function(a,k,l,m,q){var p=a.geometry,v=p.hasZ,u=p.paths;a=[];var w=[],g=[],e=D.create(),f=this._context.renderSpatialReference===r.SphericalECEFSpatialReference,n=Array(6),x=this._getPathSize(k),p=d.getGeometryVertexData3D(u,v,p.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,
l);if(this._logGeometryCreationWarnings(p,u,"paths","PathSymbol3DLayer"),0<u.length){for(var u=p.geometryData.outlines,v=p.eleVertexData,y=p.vertexData,E=0;E<u.length;++E){var A=u[E];if(!(1>=A.count)){var G=A.index,J=A.count;if(!this._context.clippingExtent||(d.computeBoundingBox(v,G,J,n),!d.boundingBoxClipped(n,this._context.clippingExtent))){d.chooseOrigin(y,G,J,e);d.subtractCoordinates(y,G,J,e);A=new Float64Array(v.buffer,3*G*v.BYTES_PER_ELEMENT,3*J);G=d.flatArrayToArrayOfArrays(y,G,J);G=C.createTubeGeometry(G,
.5*x,M,f,e);if(G.getVertexAttr().mapPos={size:3,data:A,offsetIdx:0,strideIdx:3},this._material.getParams().vertexColors)A=this._getVertexOpacityAndColor(k),G=C.addVertexColors(G,A);A=new t(G,m+"path"+E);A.singleUse=!0;a.push(A);w.push([this._material]);A=b.identity();b.translate(A,e,A);g.push(A)}}}if(0<a.length)return k=new c({geometries:a,materials:w,transformations:g,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicId:q},idHint:m}),k=new h(this,k,a,null,null,B,l),k.alignedTerrainElevation=
p.terrainElevation,k.needsElevationUpdates=d.needsElevationUpdates3D(l.mode),k}return null},l}(l);var E=v.VertexAttrConstants,J=D.create(),G=new u,K={verticalDistanceToGround:0,terrainElevation:0},M=10;return A})},"esri/views/3d/layers/graphics/Graphics3DFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./Graphics3DDrapedGraphicLayer ./ElevationAligners ./Graphics3DSymbolCommonCode ./lineUtils ./graphicUtils ../../../../geometry/Polygon ../../../../Color ../../lib/glMatrix ../../support/aaBoundingBox ../../webgl-engine/Stage ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/lib/Util ./earcut/earcut".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E,J,G){var K=J.VertexAttrConstants;A=q.vec3d;var M=q.mat4d;h=function(h){function q(){var a=null!==h&&h.apply(this,arguments)||this;return a._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},a}return w(q,h),q.prototype._prepareResources=function(){this._prepareFillResources();this._prepareOutlineResources();this.resolve()},q.prototype._prepareFillResources=function(){var a=this._getStageIdHint(),b=this._getMaterialOpacityAndColor(),
b={color:b,transparent:1>b[3]||this._isPropertyDriven("opacity"),polygonOffset:!1,vertexColors:!0};this._material=new E(b,a+"_colormat");this._context.stage.add(y.ModelContentType.MATERIAL,this._material)},q.prototype._prepareOutlineResources=function(){var a=this.symbol.outline;if(this._hasOutline=!!(a&&a.size&&0<a.size&&a.color),this._hasOutline)a={idHint:this._getStageIdHint()+"_outline",color:this._getOutlineColor(),width:l.pt2px(a.size)},2<a.width?this._outlineMaterial=k.createRibbonMaterial(a):
this._outlineMaterial=k.createNativeMaterial(a),this._context.stage.add(y.ModelContentType.MATERIAL,this._outlineMaterial)},q.prototype.destroy=function(){h.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(y.ModelContentType.MATERIAL,this._material.getId()),this._material=null);this._outlineMaterial&&(this._context.stage.remove(y.ModelContentType.MATERIAL,this._outlineMaterial.getId()),this._outlineMaterial=null)},q.prototype.createGraphics3DGraphic=
function(a,b){var c=this._validateGeometry(a.geometry);if("polyline"!==c.type&&"polygon"!==c.type&&"extent"!==c.type)return this._logWarning("unsupported geometry type for fill symbol: "+c.type),null;c="graphic"+a.uid;b=this._getVertexOpacityAndColor(b,Uint8Array,255);var d=this.getGraphicElevationContext(a);return"on-the-ground"===d.mode?this._createAsOverlay(a,b,d,c):this._createAs3DShape(a,b,d,c,a.uid)},q.prototype.layerPropertyChanged=function(b,c,d){if("opacity"===b){c=this._material.getColor();
if(c[3]=this._getMaterialOpacity(),this._material.setColor(c),this._material.setTransparent(1>c[3]),this._outlineMaterial)c=this._outlineMaterial.getColor(),this._outlineMaterial.setColor([c[0],c[1],c[2],this._getOutlineOpacity()]);return!0}if("elevationInfo"===b){b=this._elevationContext.mode;this._updateElevationContext();var k=this._elevationContext.mode;if(null==b||null==k)return!1;if("on-the-ground"===b&&"on-the-ground"===k)return!0;if(b!==k&&("on-the-ground"===b||"on-the-ground"===k))return!1;
b=a.needsElevationUpdates2D(k);for(var h in c){var g=c[h];(k=d(g))&&!k.isDraped()&&(g=g.graphic,k.needsElevationUpdates=b,k.elevationContext.set(this.getGraphicElevationContext(g)))}return!0}return!1},q.prototype.setDrawOrder=function(a,b,c){this._material&&(this._material.setRenderPriority(a+b/2),c[this._material.getId()]=!0);this._outlineMaterial&&(this._outlineMaterial.setRenderPriority(a),c[this._outlineMaterial.getId()]=!0)},q.prototype._createAs3DShape=function(b,c,k,h,l){var g=this._getPolyGeometry(b),
e=g.hasZ;b=g.rings;var f=this._getOutlineGeometry(g,b),g=a.getGeometryVertexData3D(f,e,g.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,k);R.idHint=h;R.color=c;R.data=g;var m;this._hasOutline&&(m=new g.vertexData.constructor(g.vertexData));if(R.outNum=0,R.outGeometries=[],R.outTransforms=[],R.outMaterials=[],this._createAs3DShapeFill(R),R.data.vertexData=m,this._createAs3DShapeOutline(R),this._logGeometryCreationWarnings(R.data,
b,"rings","FillSymbol3DLayer"),0===R.outNum)return null;c=new B({geometries:R.outGeometries,materials:R.outMaterials,transformations:R.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicId:l},idHint:h});c=new d(this,c,R.outGeometries,null,null,r.perVertexElevationAligner,k);return c.alignedTerrainElevation=g.terrainElevation,c.needsElevationUpdates=a.needsElevationUpdates2D(k.mode),c},q.prototype._createAs3DShapeFill=function(b){for(var c=b.data.geometryData.polygons,d=
b.data.eleVertexData,k=b.data.vertexData,h=function(e){var f=c[e];e=f.count;var h=f.index;if(g._context.clippingExtent&&(a.computeBoundingBox(d,h,e,U),a.boundingBoxClipped(U,g._context.clippingExtent)))return"continue";var l=new Float64Array(d.buffer,3*h*d.BYTES_PER_ELEMENT,3*e),m=new Float64Array(k.buffer,3*h*k.BYTES_PER_ELEMENT,3*e),f=f.holeIndices.map(function(a){return a-h}),f=G(l,f,3);if(0===f.length)return"continue";a.chooseOrigin(k,h,e,N);a.subtractCoordinates(k,h,e,N);e=g._createFillGeometry(f,
0,m,l,b.color);e=new D(e,b.idHint);e.singleUse=!0;l=M.identity();M.translate(l,N,l);b.outGeometries.push(e);b.outMaterials.push([g._material]);b.outTransforms.push(l);b.outNum++},g=this,e=0;e<c.length;++e)h(e)},q.prototype._createAs3DShapeOutline=function(b){if(this._hasOutline)for(var c=b.data.geometryData.outlines,d=b.data.eleVertexData,h=b.data.vertexData,l=0;l<c.length;++l){var g=c[l],e=g.index,f=g.count;this._context.clippingExtent&&(a.computeBoundingBox(d,e,f,U),a.boundingBoxClipped(U,this._context.clippingExtent))||
(a.chooseOrigin(h,e,f,N),a.subtractCoordinates(h,e,f,N),g=new Float64Array(d.buffer,3*e*d.BYTES_PER_ELEMENT,3*f),e=new Float64Array(h.buffer,3*e*h.BYTES_PER_ELEMENT,3*f),e=k.createPolylineGeometry(e,g,b.isRings,W,0),e=new D(e,b.idHint+"outline"+l),e.singleUse=!0,g=M.identity(),M.translate(g,N,g),b.outGeometries.push(e),b.outMaterials.push([this._outlineMaterial]),b.outTransforms.push(g),b.outNum++)}},q.prototype._createAsOverlay=function(b,c,d,k){var h=this._getPolyGeometry(b);b=h.rings;var g=this._getOutlineGeometry(h,
b);this._material.setRenderPriority(this._symbolLayerOrder+this._symbolLayerOrderDelta/2);this._hasOutline&&this._outlineMaterial.setRenderPriority(this._symbolLayerOrder);h=a.getGeometryVertexDataDraped(g,h.spatialReference,this._context.overlaySR);R.idHint=k;R.color=c;R.data=h;var e;this._hasOutline&&(e=new h.vertexData.constructor(h.vertexData));return R.outNum=0,R.outGeometries=[],R.outBoundingBox=v.create(v.NEGATIVE_INFINITY),this._createAsOverlayFill(R),R.data.vertexData=e,this._createAsOverlayOutline(R),
this._logGeometryCreationWarnings(R.data,b,"rings","FillSymbol3DLayer"),0<R.outNum?new u(this,R.outGeometries,null,null,R.outBoundingBox,d):null},q.prototype._createAsOverlayFill=function(b){for(var c=b.data.vertexData,d=b.data.geometryData.polygons,k=function(e){var f=d[e];e=f.count;var g=f.index,k=new Float64Array(c.buffer,3*g*c.BYTES_PER_ELEMENT,3*e),f=f.holeIndices.map(function(a){return a-g}),k=G(k,f,3);if(0===k.length||(a.computeBoundingBox(c,g,e,U),a.boundingBoxClipped(U,h._context.clippingExtent)))return"continue";
v.expand(b.outBoundingBox,U);a.chooseOrigin(c,g,e,N);a.subtractCoordinates(c,g,e,N);a.setZ(c,g,e,h._getDrapedZ());e=M.identity();M.translate(e,N,e);k=h._createFillGeometry(k,g,c,null,b.color);f=new m(k);f.material=h._material;var l=U;f.center=[.5*(l[0]+l[3]),.5*(l[1]+l[4]),0];f.bsRadius=.5*Math.sqrt((l[3]-l[0])*(l[3]-l[0])+(l[4]-l[1])*(l[4]-l[1]));f.transformation=e;f.name=b.idHint;f.uniqueName=b.idHint+"#"+k.id;b.outGeometries.push(f);b.outNum++},h=this,g=0;g<d.length;++g)k(g)},q.prototype._createAsOverlayOutline=
function(b){if(this._hasOutline)for(var c=b.data.vertexData,d=b.data.geometryData.outlines,h=0;h<d.length;++h){var l=d[h],g=l.index,l=l.count;if(a.computeBoundingBox(c,g,l,U),!a.boundingBoxClipped(U,this._context.clippingExtent)){v.expand(b.outBoundingBox,U);a.chooseOrigin(c,g,l,N);a.subtractCoordinates(c,g,l,N);a.setZ(c,g,l,this._getDrapedZ());l=new Float64Array(c.buffer,3*g*c.BYTES_PER_ELEMENT,3*l);g=M.identity();M.translate(g,N,g);var l=k.createPolylineGeometry(l,null,!0,W,0),e=new m(l);e.material=
this._outlineMaterial;var f=U;e.center=[.5*(f[0]+f[3]),.5*(f[1]+f[4]),0];e.bsRadius=.5*Math.sqrt((f[3]-f[0])*(f[3]-f[0])+(f[4]-f[1])*(f[4]-f[1]));e.transformation=g;e.name=b.idHint+"outline";e.uniqueName=b.idHint+"outline#"+l.id;b.outGeometries.push(e);b.outNum++}}},q.prototype._getOutlineGeometry=function(a,b){return b},q.prototype._getOutlineOpacity=function(){return this._getLayerOpacity()*this.symbol.outline.color.a},q.prototype._getOutlineColor=function(){var a=this.symbol.outline.color,b=this._getOutlineOpacity();
return c.mixinColorAndOpacity(C.toUnitRGB(a),b)},q.prototype._getPolyGeometry=function(a){a=a.geometry;return"extent"===a.type?t.fromExtent(a):a},q.prototype._createFillGeometry=function(a,c,d,k,h){for(var g=a.length,e=new Uint32Array(g),f=new Uint32Array(g),l=0;g>l;l++)e[l]=a[l]+c,f[l]=0;a={};c={};return a[K.POSITION]=e,a[K.COLOR]=f,c[K.POSITION]={size:3,data:d},c[K.COLOR]={size:4,data:h},k&&(c.mapPos={size:3,data:k},a.mapPos=e),new b(c,a)},q}(h);var U=v.create(),N=A.create(),W=new Float32Array([255,
255,255,255]),R={idHint:null,color:null,data:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};return h})},"esri/views/3d/layers/graphics/earcut/earcut":function(){define([],function(){function A(a,c,k){k=k||2;var b=c&&c.length,m=b?c[0]*k:a.length,t=p(a,0,m,k,!0),v=[];if(!t)return v;var u,y,C,E;if(b){var B=k,A,D,X;E=[];b=0;for(A=c.length;A>b;b++)D=c[b]*B,X=A-1>b?c[b+1]*B:a.length,D=p(a,D,X,B,!1),D===D.next&&(D.steiner=!0),E.push(r(D));E.sort(h);for(b=0;b<E.length;b++){c=
E[b];B=t;if(B=d(c,B))c=q(B,c),w(c,c.next);t=w(t,t.next)}}if(a.length>80*k){u=C=a[0];y=b=a[1];for(B=k;m>B;B+=k)E=a[B],c=a[B+1],u>E&&(u=E),y>c&&(y=c),E>C&&(C=E),c>b&&(b=c);C=Math.max(C-u,b-y)}return l(t,v,k,u,y,C),v}function p(a,d,k,h,l){var b;if(l===0<D(a,d,k,h))for(l=d;k>l;l+=h)b=v(l,a[l],a[l+1],b);else for(l=k-h;l>=d;l-=h)b=v(l,a[l],a[l+1],b);return b&&c(b,b.next)&&(y(b),b=b.next),b}function w(a,d){if(!a)return a;d||(d=a);var b=a;do if(a=!1,b.steiner||!c(b,b.next)&&0!==k(b.prev,b,b.next))b=b.next;
else{if(y(b),b=d=b.prev,b===b.next)return null;a=!0}while(a||b!==d);return d}function l(b,d,h,r,p,v,B){if(b){if(!B&&v){var m=b,E=m;do null===E.z&&(E.z=u(E.x,E.y,r,p,v)),E.prevZ=E.prev,E=E.nextZ=E.next;while(E!==m);E.prevZ.nextZ=null;E.prevZ=null;var m=E,A,D,G,J,K,M,z=1;do{E=m;J=m=null;for(K=0;E;){K++;D=E;for(A=M=0;z>A&&(M++,D=D.nextZ,D);A++);for(A=z;0<M||0<A&&D;)0===M?(G=D,D=D.nextZ,A--):0!==A&&D?E.z<=D.z?(G=E,E=E.nextZ,M--):(G=D,D=D.nextZ,A--):(G=E,E=E.nextZ,M--),J?J.nextZ=G:m=G,G.prevZ=J,J=G;E=
D}J.nextZ=null;z*=2}while(1<K)}for(E=b;b.prev!==b.next;){G=b.prev;m=b.next;if(v)a:{D=b;A=r;var Z=p,O=v;J=D.prev;K=D;M=D.next;if(0<=k(J,K,M))D=!1;else{var g=J.x>K.x?J.x>M.x?J.x:M.x:K.x>M.x?K.x:M.x,e=J.y>K.y?J.y>M.y?J.y:M.y:K.y>M.y?K.y:M.y,z=u(J.x<K.x?J.x<M.x?J.x:M.x:K.x<M.x?K.x:M.x,J.y<K.y?J.y<M.y?J.y:M.y:K.y<M.y?K.y:M.y,A,Z,O);A=u(g,e,A,Z,O);for(Z=D.nextZ;Z&&Z.z<=A;){if(Z!==D.prev&&Z!==D.next&&a(J.x,J.y,K.x,K.y,M.x,M.y,Z.x,Z.y)&&0<=k(Z.prev,Z,Z.next)){D=!1;break a}Z=Z.nextZ}for(Z=D.prevZ;Z&&Z.z>=
z;){if(Z!==D.prev&&Z!==D.next&&a(J.x,J.y,K.x,K.y,M.x,M.y,Z.x,Z.y)&&0<=k(Z.prev,Z,Z.next)){D=!1;break a}Z=Z.prevZ}D=!0}}else a:if(D=b,J=D.prev,K=D,M=D.next,0<=k(J,K,M))D=!1;else{for(z=D.next.next;z!==D.prev;){if(a(J.x,J.y,K.x,K.y,M.x,M.y,z.x,z.y)&&0<=k(z.prev,z,z.next)){D=!1;break a}z=z.next}D=!0}if(D)d.push(G.i/h),d.push(b.i/h),d.push(m.i/h),y(b),E=b=m.next;else if(b=m,b===E){if(B)if(1===B){B=d;G=h;m=b;do E=m.prev,D=m.next.next,!c(E,D)&&t(E,m,m.next,D)&&C(E,D)&&C(D,E)&&(B.push(E.i/G),B.push(m.i/G),
B.push(D.i/G),y(m),y(m.next),m=b=D),m=m.next;while(m!==b);b=m;l(b,d,h,r,p,v,2)}else{if(2===B)a:{B=b;do{for(G=B.next.next;G!==B.prev;){if(m=B.i!==G.i){m=B;E=G;D=void 0;if(D=m.next.i!==E.i&&m.prev.i!==E.i){D=void 0;b:{D=m;do{if(D.i!==m.i&&D.next.i!==m.i&&D.i!==E.i&&D.next.i!==E.i&&t(D,D.next,m,E)){D=!0;break b}D=D.next}while(D!==m);D=!1}D=!D}J=void 0;if(J=D&&C(m,E)&&C(E,m)){D=m;J=!1;K=(m.x+E.x)/2;E=(m.y+E.y)/2;do D.y>E!=D.next.y>E&&K<(D.next.x-D.x)*(E-D.y)/(D.next.y-D.y)+D.x&&(J=!J),D=D.next;while(D!==
m)}m=J}if(m){b=q(B,G);B=w(B,B.next);b=w(b,b.next);l(B,d,h,r,p,v);l(b,d,h,r,p,v);break a}G=G.next}B=B.next}while(B!==b)}}else l(w(b),d,h,r,p,v,1);break}}}}function h(a,c){return a.x-c.x}function d(b,c){var d,k=c,h=b.x,l=b.y,m=-(1/0);do{if(l<=k.y&&l>=k.next.y){var q=k.x+(l-k.y)*(k.next.x-k.x)/(k.next.y-k.y);if(h>=q&&q>m){if(m=q,q===h){if(l===k.y)return k;if(l===k.next.y)return k.next}d=k.x<k.next.x?k:k.next}}k=k.next}while(k!==c);if(!d)return null;if(h===m)return d.prev;var r;c=d;for(var q=d.x,p=d.y,
t=1/0,k=d.next;k!==c;)h>=k.x&&k.x>=q&&a(p>l?h:m,l,q,p,p>l?m:h,l,k.x,k.y)&&(r=Math.abs(l-k.y)/(h-k.x),(t>r||r===t&&k.x>d.x)&&C(k,b)&&(d=k,t=r)),k=k.next;return d}function u(a,c,d,k,h){return a=32767*(a-d)/h,c=32767*(c-k)/h,a=16711935&(a|a<<8),a=252645135&(a|a<<4),a=858993459&(a|a<<2),a=1431655765&(a|a<<1),c=16711935&(c|c<<8),c=252645135&(c|c<<4),c=858993459&(c|c<<2),c=1431655765&(c|c<<1),a|c<<1}function r(a){var b=a,c=a;do b.x<c.x&&(c=b),b=b.next;while(b!==a);return c}function a(a,c,d,k,h,l,q,r){return 0<=
(h-q)*(c-r)-(a-q)*(l-r)&&0<=(a-q)*(k-r)-(d-q)*(c-r)&&0<=(d-q)*(l-r)-(h-q)*(k-r)}function k(a,c,d){return(c.y-a.y)*(d.x-c.x)-(c.x-a.x)*(d.y-c.y)}function c(a,c){return a.x===c.x&&a.y===c.y}function t(a,d,h,l){return c(a,d)&&c(h,l)||c(a,l)&&c(h,d)?!0:0<k(a,d,h)!=0<k(a,d,l)&&0<k(h,l,a)!=0<k(h,l,d)}function C(a,c){return 0>k(a.prev,a,a.next)?0<=k(a,c,a.next)&&0<=k(a,a.prev,c):0>k(a,c,a.prev)||0>k(a,a.next,c)}function q(a,c){var b=new B(a.i,a.x,a.y),d=new B(c.i,c.x,c.y),k=a.next,h=c.prev;return a.next=
c,c.prev=a,b.next=k,k.prev=b,d.next=b,b.prev=d,h.next=d,d.prev=h,d}function v(a,c,d,k){a=new B(a,c,d);return k?(a.next=k.next,a.prev=k,k.next.prev=a,k.next=a):(a.prev=a,a.next=a),a}function y(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function B(a,c,d){this.i=a;this.x=c;this.y=d;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function D(a,c,d,k){for(var b=0,h=d-k;d>c;c+=k)b+=(a[h]-a[c])*(a[c+1]+a[h+1]),h=c;return b}
return A.deviation=function(a,c,d,k){var b=c&&c.length,h=Math.abs(D(a,0,b?c[0]*d:a.length,d));if(b)for(var b=0,l=c.length;l>b;b++)h-=Math.abs(D(a,c[b]*d,l-1>b?c[b+1]*d:a.length,d));for(b=c=0;b<k.length;b+=3){var l=k[b]*d,m=k[b+1]*d,q=k[b+2]*d;c+=Math.abs((a[l]-a[q])*(a[m+1]-a[l+1])-(a[l]-a[m])*(a[q+1]-a[l+1]))}return 0===h&&0===c?0:Math.abs((c-h)/h)},A.flatten=function(a){for(var b=a[0][0].length,c={vertices:[],holes:[],dimensions:b},d=0,k=0;k<a.length;k++){for(var h=0;h<a[k].length;h++)for(var l=
0;b>l;l++)c.vertices.push(a[k][h][l]);0<k&&(d+=a[k-1].length,c.holes.push(d))}return c},A})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./Graphics3DSymbolCommonCode ../../../../geometry/Polygon ../../../../geometry/Point ../../support/projectionUtils ../../lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/materials/Material ../../webgl-engine/lib/Util ./earcut/earcut ./graphicUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D){function b(a,b,c,e,d,f,g,k,h,l,m,q,r,p){var n=c.length/3,t=0;m+=2*e.count;var v=e.index,u=e.count,w=h,x=m;K.set(r,N);var y=0<q?1:-1,v=3*v,z=w;r=3*z;for(var C=w+u,w=3*C,B=0;u>B;++B)p&&(N[0]=a[v+0],N[1]=a[v+1],N[2]=a[v+2],K.normalize(N)),d[r+0]=a[v+0],d[r+1]=a[v+1],d[r+2]=a[v+2],f[r+0]=b[v+0],f[r+1]=b[v+1],f[r+2]=b[v+2],g[r+0]=-y*N[0],g[r+1]=-y*N[1],g[r+2]=-y*N[2],k[z]=0,d[w+0]=a[v+0]+q*N[0],d[w+1]=a[v+1]+q*N[1],d[w+2]=a[v+2]+q*N[2],f[w+0]=b[v+0],f[w+1]=
b[v+1],f[w+2]=b[v+2],g[w+0]=y*N[0],g[w+1]=y*N[1],g[w+2]=y*N[2],k[C]=q,r+=3,w+=3,v+=3,z+=1,C+=1;v=0;r=3*x;w=3*(x+n);r=3*(x+n);w=3*x;a=W;b=R;0>q&&(a=R,b=W);for(B=0;n>B;++B)l[r+0]=c[v+a[0]],l[r+1]=c[v+a[1]],l[r+2]=c[v+a[2]],l[w+0]=c[v+b[0]]+u,l[w+1]=c[v+b[1]]+u,l[w+2]=c[v+b[2]]+u,r+=3,w+=3,v+=3;h+=2*e.count;m=m+2*n-(2*e.count+2*n);E(d,f,k,g,t,e.pathLengths[0],e.count,h,l,m,q);h+=4*e.pathLengths[0];m+=2*e.pathLengths[0];t+=e.pathLengths[0];for(c=1;c<e.pathLengths.length;++c)E(d,f,k,g,t,e.pathLengths[c],
e.count,h,l,m,q),h+=4*e.pathLengths[c],m+=2*e.pathLengths[c],t+=e.pathLengths[c]}function m(a,b,c,e,d,f,g){e[f]=e[g];g*=3;f*=3;a[f+0]=a[g+0];a[f+1]=a[g+1];a[f+2]=a[g+2];b[f+0]=b[g+0];b[f+1]=b[g+1];b[f+2]=b[g+2];c[f+0]=d[0];c[f+1]=d[1];c[f+2]=d[2]}function E(a,b,c,e,d,f,k,h,l,q,r){var n=d,p=d+1,t=d+k,v=d+k+1,u=h,w=h+1,x=h+2*f;h=h+2*f+1;0>r&&(n=d+k+1,v=d);q*=3;for(var y=0;f>y;++y){y===f-1&&(0<r?(p=d,v=d+k):(p=d,n=d+k));var C=a,E=n,B=p,D=t,A=S,E=3*E,B=3*B,D=3*D;K.set3(C[E++],C[E++],C[E++],X);K.set3(C[B++],
C[B++],C[B++],z);K.set3(C[D++],C[D++],C[D++],Z);K.subtract(z,X,O);K.subtract(Z,X,g);K.cross(g,O,A);K.normalize(A,A);m(a,b,e,c,S,u,n);m(a,b,e,c,S,w,p);m(a,b,e,c,S,x,t);m(a,b,e,c,S,h,v);l[q++]=u;l[q++]=x;l[q++]=h;l[q++]=u;l[q++]=h;l[q++]=w;n++;p++;t++;v++;u+=2;w+=2;x+=2;h+=2}}function J(a,b,c,g){var k=g.setAltitude;V.spatialReference=c.spatialReference;for(var h=a.getGeometryRecords(),l=h.length,m="absolute-height"!==b.mode,n=0,q=0;l>q;q++){var r=h[q].geometry,p=h[q].transformation,t=r.getData();f[0]=
p[12];f[1]=p[13];f[2]=p[14];r.invalidateBoundingInfo();for(var t=t.getVertexAttr(),r=t[G.POSITION].data,p=t[G.SIZE].data,t=t.mapPos.data,v=r.length/3,u=0,w=0,x=!1,y=0,z=0;v>z;z++){V.x=t[w];V.y=t[w+1];V.z=t[w+2];e[0]=r[u];e[1]=r[u+1];e[2]=r[u+2];var C=d.computeElevation(c,V,b,g,m?Q:null);m&&(y+=Q.terrainElevation);U[0]=r[u]+f[0];U[1]=r[u+1]+f[1];U[2]=r[u+2]+f[2];k(C+p[u/3],U);r[u]=U[0]-f[0];r[u+1]=U[1]-f[1];r[u+2]=U[2]-f[2];C=.01/g.unitInMeters;(Math.abs(e[0]-r[u])>C||Math.abs(e[1]-r[u+1])>C||Math.abs(e[2]-
r[u+2])>C)&&(x=!0);w+=3;u+=3}x&&a.geometryVertexAttrsUpdated(q);n+=y/v}return n/l}var G=y.VertexAttrConstants,K=k.vec3d,M=k.mat4d,U=K.create(),N=K.create(),W=[0,2,1],R=[0,1,2],V=new r,Q={verticalDistanceToGround:0,terrainElevation:0};A=function(e){function f(){return null!==e&&e.apply(this,arguments)||this}return w(f,e),f.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=D.validateSymbolLayerSize(this._getSymbolSize());if(a)return this._logWarning(a),void this.reject()}var a=
this._getStageIdHint(),b=this._getMaterialOpacityAndColor(),e=K.create(b),b=b[3],e={diffuse:e,ambient:e,opacity:b,transparent:1>b||this._isPropertyDriven("opacity"),vertexColors:!0};this._material=new v(e,a+"_3dlinemat");this._context.stage.add(c.ModelContentType.MATERIAL,this._material);this.resolve()},f.prototype.destroy=function(){e.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&this._context.stage.remove(c.ModelContentType.MATERIAL,this._material.getId())},f.prototype.createGraphics3DGraphic=
function(a,b){var c=this._validateGeometry(a.geometry);if("polygon"!==c.type&&"extent"!==c.type)return this._logWarning("unsupported geometry type for extrude symbol: "+c.type),null;var c="polygon"===c.type||"extent"===c.type?"rings":"paths",e="graphic"+a.uid,d=this._getVertexOpacityAndColor(b,Float32Array,255),f=this.getGraphicElevationContext(a);return this._createAs3DShape(a,c,b,d,f,e,a.uid)},f.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)return b=this._getMaterialOpacity(),
c=1>b||this._isPropertyDriven("opacity"),this._material.setParameterValues({opacity:b,transparent:c}),!0;if("elevationInfo"===a){this._updateElevationContext();for(var e in b){var f=b[e];if(a=c(f))f=this.getGraphicElevationContext(f.graphic),a.needsElevationUpdates=d.needsElevationUpdates3D(f.mode),a.elevationContext.set(f)}return!0}return!1},f.prototype._getExtrusionSize=function(a){var b;return b=a.size&&this._isPropertyDriven("size")?d.getSingleSizeDriver(a.size,2):this._getSymbolSize(),b/=this._context.renderCoordsHelper.unitInMeters},
f.prototype._getSymbolSize=function(){return this.symbol.size||1},f.prototype._createAs3DShape=function(c,e,f,g,k,l,m){var n=c.geometry;"extent"===n.type&&(n=u.fromExtent(n));c=n[e];var q=n.hasZ,r=[],p=[],v=[],w=K.create(),y=Array(6),x=this._context.renderSpatialReference===a.SphericalECEFSpatialReference,z=this._getExtrusionSize(f),E=K.create();x||this._context.renderCoordsHelper.worldUpAtPosition(null,E);f=d.getGeometryVertexData3D(c,q,n.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,
this._context.renderCoordsHelper,k);if(this._logGeometryCreationWarnings(f,c,e,"ExtrudeSymbol3DLayer"),0<c.length){var F=f.geometryData.polygons,D=f.eleVertexData,A=f.vertexData;e=A.length/3;var G=new Float64Array(18*e),I=new Float64Array(18*e),L=new Float64Array(18*e),N=new Float64Array(6*e),O=0;e=function(a){var c=F[a],e=c.count,f=c.index;if(P._context.clippingExtent&&(d.computeBoundingBox(D,f,e,y),d.boundingBoxClipped(y,P._context.clippingExtent)))return"continue";var k=new Float64Array(D.buffer,
3*f*G.BYTES_PER_ELEMENT,3*e),h=c.holeIndices.map(function(a){return a-f}),k=B(k,h,3);if(0<k.length){d.chooseOrigin(A,f,e,w);var h=new Uint32Array(6*e+2*k.length),m=6*e,n=new Float64Array(G.buffer,3*O*G.BYTES_PER_ELEMENT,3*m),q=new Float64Array(I.buffer,3*O*I.BYTES_PER_ELEMENT,3*m),t=new Float64Array(L.buffer,3*O*L.BYTES_PER_ELEMENT,3*m),u=new Float64Array(N.buffer,1*O*N.BYTES_PER_ELEMENT,1*m);b(A,D,k,c,n,t,q,u,0,h,0,z,E,x);d.subtractCoordinates(n,0,m,w);O+=6*e;c=P._createExtrudeGeometry(h,{positions:n,
elevation:t,normals:q,heights:u},g);a=new C(c,l+"path"+a);a.singleUse=!0;r.push(a);p.push([P._material]);a=M.identity();M.translate(a,w,a);v.push(a)}};var P=this;for(c=0;c<F.length;++c)e(c);if(0<r.length)return m=new t({geometries:r,materials:p,transformations:v,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicId:m},idHint:l}),m=new h(this,m,r,null,null,J,k),m.alignedTerrainElevation=f.terrainElevation,m.needsElevationUpdates=d.needsElevationUpdates3D(k.mode),m}return null},f.prototype._createExtrudeGeometry=
function(a,b,c){for(var e=a.length,d=new Uint32Array(e),f=0;e>f;f++)d[f]=0;e={};f={};return e[G.POSITION]=a,e[G.NORMAL]=a,e[G.COLOR]=d,f[G.POSITION]={size:3,data:b.positions},f[G.NORMAL]={size:3,data:b.normals},f[G.COLOR]={size:4,data:c},f[G.SIZE]={size:1,data:b.heights},b.elevation&&(f.mapPos={size:3,data:b.elevation},e.mapPos=a),new q(f,e)},f}(l);var S=K.create(),X=K.create(),z=K.create(),Z=K.create(),O=K.create(),g=K.create(),e=K.create(),f=K.create();return A})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ../../../../symbols/callouts/calloutUtils ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./ElevationAligners ./Graphics3DSymbolCommonCode ./graphicUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v){var y=[1,1,1,1],B=[0,0,1],D={mode:"relative-to-ground",offset:0},b=[0,0,0,1];return function(m){function p(){var a=null!==m&&m.apply(this,arguments)||this;return a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},a}return w(p,m),p.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=c.validateSymbolLayerSize(this._getTextSize());if(a)return this._logWarning(a),void this.reject()}this._anchor="center";this.resolve()},
p.prototype.destroy=function(){m.prototype.destroy.call(this);this.isFulfilled()||this.reject()},p.prototype.createGraphics3DGraphic=function(a,b,c,d){var k="polyline"===a.geometry.type,h=this._getGeometry(a);if(!h)return this._logWarning("unsupported geometry type for text symbol: "+a.geometry.type),null;var l=this._context.layer.id+"_label_"+a.uid,m=b.text||this.symbol.text;if(!m||1>m.length)return null;b&&null!=b.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=b.needsOffsetAdjustment);
var q=this.getGraphicElevationContext(a,b.elevationOffset||0);return this._createAs3DShape(this.symbol,h,m,q,l,a.uid,b,c,d,k)},p.prototype.getGraphicElevationContext=function(a,b){void 0===b&&(b=0);a=m.prototype.getGraphicElevationContext.call(this,a);return a.addOffsetRenderUnits(b),a},p.prototype._getGeometry=function(a){a=this._validateGeometry(a.geometry);return"polyline"===a.type?k.placePointOnPolyline(a):"polygon"===a.type?k.placePointOnPolygon(a):"extent"===a.type?a.center:"point"!==a.type?
null:a},p.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)this._logWarning("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");else if("elevationInfo"===a){if(this._updateElevationContext(),b)for(var d in b){a=b[d];var k=c(a);k&&this.updateGraphicElevationContext(a.graphic,k)}return!0}return!1},p.prototype.updateGraphicElevationContext=function(a,b){a=this.getGraphicElevationContext(a,b.metadata.elevationOffset);b.elevationContext.set(a);b.needsElevationUpdates=
k.needsElevationUpdates2D(a.mode)||"absolute-height"===a.mode},p.prototype._defaultElevationInfoNoZ=function(){return D},p.prototype._createAs3DShape=function(c,m,p,u,w,E,D,A,V,Q){var G=D.centerOffset||b,J=D.screenOffset||[0,0],z=D.debugDrawBorder||!1,K=D.translation||[0,0,0],M=D.anchor||this._anchor||"center";this._anchor=M;var g,e=c.material?l.toUnitRGBA(c.material.color):y,f=c.halo&&c.halo.color&&0<c.halo.size,n=f?l.toUnitRGBA(c.halo.color):y,f=f?h.pt2px(c.halo.size):0,x=this._getTextSize(c);c=
new q(p,{size:x,color:e,font:{family:c.font&&c.font.family?c.font.family:"Arial",weight:c.font&&c.font.weight?c.font.weight:"normal",style:c.font&&c.font.style?c.font.style:"normal"},halo:{size:f,color:n}},w);V=(e=V&&V.canHoldTextTexture(c))?V.addTextTexture(c):null;A?g=D:d.isCalloutSupport(this.symbolContainer)&&this.symbolContainer.hasVisibleVerticalOffset()&&(g=this.symbolContainer);J={textureId:e?V.texture.getId():c.getId(),texCoordScale:e?[1,1]:c.getTexcoordScale(),occlusionTest:!0,screenOffset:J,
anchorPos:M,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:D.centerOffsetUnits,debugDrawBorder:z,drawInSecondSlot:!0};g&&g.verticalOffset&&(g=g.verticalOffset,z=g.minWorldLength,M=g.maxWorldLength,J.verticalOffset={screenLength:h.pt2px(g.screenLength),minWorldLength:z||0,maxWorldLength:null!=M?M:1/0});this._context.screenSizePerspectiveEnabled&&(g=this._context.sharedResources,z=g.screenSizePerspectiveSettings,J.screenSizePerspective=g.screenSizePerspectiveSettingsLabels.overridePadding(f),J.screenSizePerspectiveAlignment=
z);Q&&(J.shaderPolygonOffset=1E-4);Q=null;f=JSON.stringify(J);null!=A?(Q=A.getMaterial(f),null==Q?(Q=new v(J,w),A.addMaterial(f,Q)):e&&Q.setTextureDirty()):Q=new v(J,w);Q=[Q];f=[c.getTextWidth(),c.getTextHeight()];G=C.createPointGeometry(B,K,void 0,f,G,V?V.uvMinMax:null);G=[new t(G,w)];w=k.createStageObjectForPoint.call(this,m,G,[Q],null,null,u,w,this._context.layer.uid,E,!0);A=new r(this,w.object,G,null==A?Q:null,e?null:[c],a.perObjectElevationAligner,u);A.alignedTerrainElevation=w.terrainElevation;
A.needsElevationUpdates=k.needsElevationUpdates2D(u.mode)||"absolute-height"===u.mode;var I=e?c.getTextWidth():c.getWidth(),L=e?c.getTextHeight():c.getHeight();return A.getScreenSize=function(a){return void 0===a&&(a=Array(2)),a[0]=I,a[1]=L,a},A.metadata={labelText:p,elevationOffset:D.elevationOffset||0},k.extendPointGraphicElevationContext(A,m,this._context.elevationProvider),A},p.prototype._getTextSize=function(a){return h.pt2px((a||this.symbol).size)||12},p}(u)})},"esri/views/3d/webgl-engine/lib/TextTexture":function(){define("require exports ./Texture ./Util ../../../webgl/Texture ../../../webgl/enums".split(" "),
function(A,p,w,l,h,d){function u(){var a=document.createElement("canvas");return a.width=k,a.height=k,a}function r(a){return"rgb("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+")"}function a(a){return"rgba("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+","+a[3]+")"}var k=512;A=function(){function d(c,d,k,h){void 0===h&&(h=!0);this._idHint=k;this._text=c;this._textLines=c.split(/\r?\n/);this._params=d;this._haloSize=Math.round(this._params.halo.size);this._fillStyle=
a(this._params.color);this._haloStyle=r(this._params.halo.color);this._textWidth=this._computeTextWidth();this._lineHeight=this._computeLineHeight();this._textHeight=this._computeTextHeight();h?this._scaleFactor=Math.min(1,Math.min(2048/this._textWidth,2048/this._textHeight)):this._scaleFactor=1;this._renderedWidth=Math.round(this._textWidth*this._scaleFactor);this._renderedHeight=Math.round(this._textHeight*this._scaleFactor);h&&l.assert(2048>=this._renderedWidth&&2048>=this._renderedHeight);this._width=
l.nextHighestPowerOfTwo(this._renderedWidth);this._height=l.nextHighestPowerOfTwo(this._renderedHeight)}return d.prototype.getId=function(){return null==this._id&&(this._id=w.idGen.gen(this._idHint)),this._id},d.prototype.getParams=function(){return this._params},d.prototype.getText=function(){return this._text},d.prototype.deferredLoading=function(){return!1},d.prototype.getWidth=function(){return this._width},d.prototype.getHeight=function(){return this._height},d.prototype.getTextWidth=function(){return this._textWidth},
d.prototype.getTextHeight=function(){return this._textHeight},d.prototype.getRenderedWidth=function(){return this._renderedWidth},d.prototype.getRenderedHeight=function(){return this._renderedHeight},d.prototype.initializeThroughRender=function(a,c){var d=this._getTextCanvas();d.width=this._width;d.height=this._height;var k=d.getContext("2d");k.save();c.samplingMode=9987;c.wrapMode=33071;c.flipped=!0;c.preMultiplyAlpha=!0;c.hasMipmap=!0;this.renderText(this._renderedWidth,this._renderedHeight,k,0,
this._height-this._renderedHeight);a=new h(a,c,d);return k.restore(),a},d.prototype.getTexcoordScale=function(){return[this._renderedWidth/this._width,this._renderedHeight/this._height]},d.prototype.setUnloadFunc=function(a){this._unloadFunc=a},d.prototype.unload=function(){this._unloadFunc&&(this._unloadFunc(this._id),this._unloadFunc=null)},d.prototype.renderText=function(a,d,h,l,r){void 0===l&&(l=0);void 0===r&&(r=0);d=this._lineHeight*this._scaleFactor;var q=this._haloSize,b=h.textAlign;a=("center"===
b?.5*a:"right"===b?a:0)+q;h.save();var m=3>q;if(0<q){var b=q,p=this._getHaloCanvas();p.width=Math.max(k,this._renderedWidth);p.height=Math.max(k,this._renderedHeight);var t=p.getContext("2d");if(t.clearRect(0,0,p.width,p.height),this._setFontProperties(t,this._params.size*this._scaleFactor),t.fillStyle=this._haloStyle,t.strokeStyle=this._haloStyle,t.lineJoin=m?"miter":"round",m)for(var v=0,u=this._textLines;v<u.length;v++){for(var m=u[v],w=0,y=c;w<y.length;w++){var C=y[w];t.fillText(m,a+q*C[0],q+
q*C[1])}b+=d}else for(v=0,u=this._textLines;v<u.length;v++){m=u[v];w=2*q;for(y=0;5>y;y++)t.lineWidth=(.6+.1*y)*w,t.strokeText(m,a,b);b+=d}h.globalAlpha=this._params.halo.color[3];h.drawImage(p,l,r);p.width=k;p.height=k;h.globalAlpha=1}this._setFontProperties(h,this._params.size*this._scaleFactor);b=r+q;r=0;for(q=this._textLines;r<q.length;r++)m=q[r],h.globalCompositeOperation="destination-out",h.fillStyle="rgb(0, 0, 0)",h.fillText(m,l+a,b),h.globalCompositeOperation="source-over",h.fillStyle=this._fillStyle,
h.fillText(m,l+a,b),b+=d;h.restore()},d.preferredAtlasSize=function(){return k},d.prototype._getTextCanvas=function(){return null==d._textCanvas2D&&(d._textCanvas2D=u()),d._textCanvas2D},d.prototype._getHaloCanvas=function(){return null==d._haloCanvas2D&&(d._haloCanvas2D=u()),d._haloCanvas2D},d.prototype._setFontProperties=function(a,c){var d=this._params.font;a.font=d.style+" "+d.weight+" "+c+"px "+d.family;a.textAlign="left";a.textBaseline="top"},d.prototype._computeTextWidth=function(){var a=this._getTextCanvas().getContext("2d");
this._setFontProperties(a,this._params.size);for(var c=0,d=0,k=this._textLines;d<k.length;d++){var h=a.measureText(k[d]).width;h>c&&(c=h)}d=this._params.font;return("italic"===d.style||"oblique"===d.style||"string"==typeof d.weight&&("bold"===d.weight||"bolder"===d.weight)||"number"==typeof d.weight&&600<d.weight)&&(c+=.3*a.measureText("A").width),c+=2*this._haloSize,c=Math.round(c)},d.prototype._computeLineHeight=function(){return Math.floor(1.275*this._params.size+2*this._haloSize)},d.prototype._computeTextHeight=
function(){return this._computeLineHeight()*this._textLines.length},d}();var c=[];for(p=0;360>p;p+=22.5)c.push([Math.cos(Math.PI*p/180),Math.sin(Math.PI*p/180)]);return A})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./Graphics3DSymbol","./Graphics3DCalloutSymbolLayerFactory"],function(A,p,w,l,h){return function(d){function l(l,a,k){l=d.call(this,l,a,k)||this;return l.calloutSymbolLayer=null,l.symbol.hasVisibleCallout()&&
(l.calloutSymbolLayer=h.make(l.symbol,a)),l}return w(l,d),l.prototype.destroy=function(){d.prototype.destroy.call(this)},l.prototype.createGraphics3DGraphic=function(h,a,k){k=d.prototype.createGraphics3DGraphic.call(this,h,a,k);this.calloutSymbolLayer&&(h=this.createCalloutGraphic(h,a))&&k.addAuxiliaryGraphic(h);return k},l.prototype.layerPropertyChanged=function(h,a){var k=this;return d.prototype.layerPropertyChanged.call(this,h,a)?this.calloutSymbolLayer?this.calloutSymbolLayer.layerPropertyChanged(h,
a,function(a){var c=0;for(a=a._auxiliaryGraphics;c<a.length;c++){var d=a[c];if(d.graphics3DSymbolLayer===k.calloutSymbolLayer)return d}}):!0:!1},l.prototype.createCalloutGraphic=function(d,a){return this.calloutSymbolLayer.createGraphics3DGraphic(d,{renderer:a.renderer,symbol:a.symbol,needsOffsetAdjustment:a.needsOffsetAdjustment,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null})},l}(l)})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["require",
"exports","../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(A,p,w,l,h){Object.defineProperty(p,"__esModule",{value:!0});var d=w.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");p.make=function(h,a){if(!l.isCalloutSupport(h))return d.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+h.type+"' does not support callouts"),null;if(!h.callout)return null;var k=u[h.callout.type];return k?new k(h,
a):(d.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+h.callout.type),null)};var u={line:h}})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./Graphics3DSymbolCommonCode ./ElevationAligners ../../../../core/screenUtils ../../../../Color ../../../../geometry/Polygon ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Util ../../webgl-engine/lib/GeometryData ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v){var y,B,D=C.VertexAttrConstants;A=function(l){function p(a,b){a=l.call(this,a,null,b,!0)||this;return a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},a}return w(p,l),p.prototype.destroy=function(){l.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(c.ModelContentType.MATERIAL,this._material.getId()),this._material=null)},p.prototype._prepareResources=function(){var a=this._getStageIdHint();
this._createMaterialsAndAddToStage(this._context.stage,a);this.resolve()},p.prototype.perInstanceMaterialParameters=function(a){var b=this.materialParameters;return b.screenOffset=a.screenOffset||[0,0],b.centerOffsetUnits=a.centerOffsetUnits||"world",b},Object.defineProperty(p.prototype,"materialParameters",{get:function(){var b=this.symbolContainer,c=b.callout,d=a.toUnitRGBA(c.color);d[3]*=this._getLayerOpacity();var k=r.pt2px(c.size||0),h=null;if(b.verticalOffset)var h=b.verticalOffset,l=h.minWorldLength,
m=h.maxWorldLength,h={screenLength:r.pt2px(h.screenLength),minWorldLength:l||0,maxWorldLength:null!=m?m:1/0};c=c.border&&c.border.color?a.toUnitRGBA(c.border.color):null;l="object"===b.symbolLayers.getItemAt(0).type;return{color:d,size:k,verticalOffset:h,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:c,occlusionTest:!l,shaderPolygonOffset:l?0:void 0,depthHUDAlignStart:"label-3d"===
b.type}},enumerable:!0,configurable:!0}),p.prototype._createMaterialsAndAddToStage=function(a,b){this._material=new v(this.materialParameters,b+"_lineCallout_common");a.add(c.ModelContentType.MATERIAL,this._material)},p.prototype._defaultElevationInfoNoZ=function(){return E},p.prototype._getGeometry=function(a){a=this._validateGeometry(a.geometry);return"extent"===a.type?d.placePointOnPolygon(k.fromExtent(a)):"polyline"===a.type?d.placePointOnPolyline(a):"polygon"===a.type?d.placePointOnPolygon(a):
"point"===a.type?a:(this._logWarning("unsupported geometry type for point symbol: "+a.type),null)},p.prototype.createGraphics3DGraphic=function(a,b){null!=b.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=b.needsOffsetAdjustment);var c=this.getGraphicElevationContext(a,b.elevationOffset||0),d=b.symbol,k="on-the-ground"===this._elevationContext.mode&&!d.symbolLayers.some(function(a){return"object"===a.type||"text"===a.type});if("label-3d"!==d.type&&k)return null;d=this._getGeometry(a);
return null===d?null:this._createAs3DShape(a,d,c,b,"graphic"+a.uid,a.uid)},p.prototype.layerPropertyChanged=function(a,b,c){switch(a){case "opacity":return this.layerOpacityChanged(b,c);case "elevationInfo":return this.layerElevationInfoChanged(b,c)}return!1},p.prototype.layerOpacityChanged=function(a,b){return this._material.setParameterValues(this.materialParameters),!0},p.prototype.layerElevationInfoChanged=function(a,b){var c=this._elevationContext.mode;this._updateElevationContext();var d=this._elevationContext.mode;
if(c!==d&&("on-the-ground"===c||"on-the-ground"===d))return!1;for(var k in a)c=a[k],(d=b(c))&&this.updateGraphicElevationContext(c.graphic,d);return!0},p.prototype.getGraphicElevationContext=function(a,b){void 0===b&&(b=0);a=l.prototype.getGraphicElevationContext.call(this,a);return a.addOffsetRenderUnits(b),a},p.prototype.updateGraphicElevationContext=function(a,b){a=this.getGraphicElevationContext(a,b.metadata.elevationOffset);b.elevationContext.set(a);b.needsElevationUpdates=d.needsElevationUpdates2D(a.mode)},
p.prototype.createVertexData=function(a){var c=a.translation;a=a.centerOffset;if(!c&&!a)return b;c=c?{size:3,data:[c[0],c[1],c[2]]}:b[D.POSITION];a=a?{size:4,data:[a[0],a[1],a[2],a[3]]}:b[D.AUXPOS1];return d={},d[D.POSITION]=c,d[D.NORMAL]=b[D.NORMAL],d[D.AUXPOS1]=a,d;var d},p.prototype.getOrCreateMaterial=function(a,b){var c=this.perInstanceMaterialParameters(a),d=v.uniqueMaterialIdentifier(c);if(d===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(a.materialCollection){var k=
a.materialCollection.getMaterial(d);return k||(k=new v(c,b+"_lineCallout_shared"),a.materialCollection.addMaterial(d,k)),{material:k,isUnique:!1}}k=new v(c,b+"_lineCallout_unique");return{material:k,isUnique:!0}},p.prototype._createAs3DShape=function(a,b,c,k,l,r){a=new q(this.createVertexData(k),m,q.DefaultOffsets,"point");a=[new t(a,l)];var p=this.getOrCreateMaterial(k,l);l=d.createStageObjectForPoint.call(this,b,a,[[p.material]],null,null,c,l,this._context.layer.uid,r,!0);if(null===l)return null;
r=new h(this,l.object,a,p.isUnique?[p.material]:null,null,u.perObjectElevationAligner,c);return r.metadata={elevationOffset:k.elevationOffset||0},r.alignedTerrainElevation=l.terrainElevation,r.needsElevationUpdates=d.needsElevationUpdates2D(c.mode),d.extendPointGraphicElevationContext(r,b,this._context.elevationProvider),r},p}(l);var b=(y={},y[D.POSITION]={size:3,data:[0,0,0]},y[D.NORMAL]={size:3,data:[0,0,1]},y[D.AUXPOS1]={size:4,data:[0,0,0,1]},y);y=new Uint32Array([0]);var m=(B={},B[D.POSITION]=
y,B[D.NORMAL]=y,B[D.AUXPOS1]=y,B),E={mode:"relative-to-ground",offset:0};return A})},"esri/views/3d/layers/graphics/Graphics3DOwner":function(){define(["require","exports"],function(A,p){Object.defineProperty(p,"__esModule",{value:!0});A=function(){return function(){this.featureExpressionInfoContext=this.localOriginFactory=this.layerView=this.layer=this.overlaySR=this.renderCoordsHelper=this.renderSpatialReference=this.clippingExtent=this.layerOrderDelta=this.layerOrder=this.stage=this.renderer=this.elevationProvider=
this.streamDataSupplier=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0}}();p.Graphics3DSymbolCreationContext=A})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper dojo/Deferred dojo/_base/lang ../../../../core/Scheduler ../../../../geometry/Multipoint".split(" "),function(A,p,w,l,h,d,u,r){Object.defineProperty(p,"__esModule",{value:!0});A=function(){function a(a,c,h){this.spatialReference=
a;this._getElevationQueryProvider=c;this._queries=[];this._isScheduled=!1;this._queryOptions=d.mixin({},h,{ignoreInvisibleLayers:!0})}return a.prototype.queryElevation=function(a,c){return l(this,void 0,void 0,function(){var d;return w(this,function(k){return d=new h,this._queries.push({x:a,y:c,result:d}),this._scheduleDoQuery(),[2,d.promise]})})},a.prototype._scheduleDoQuery=function(){var a=this;this._isScheduled||(u.schedule(function(){return a._doQuery()}),this._isScheduled=!0)},a.prototype._doQuery=
function(){return l(this,void 0,void 0,function(){var a,c,d,h,l,p,u;return w(this,function(k){switch(k.label){case 0:if(this._isScheduled=!1,a=this._queries,this._queries=[],c=a.map(function(a){return[a.x,a.y]}),d=new r({points:c,spatialReference:this.spatialReference}),h=this._getElevationQueryProvider(),!h)return a.forEach(function(a,b){return a.result.reject()}),[2];k.label=1;case 1:return k.trys.push([1,3,,4]),[4,h.queryElevation(d,this._queryOptions)];case 2:return l=k.sent(),[3,4];case 3:return p=
k.sent(),a.forEach(function(a){return a.result.reject(p)}),[2];case 4:return u=l.geometry.points,a.forEach(function(a,b){return a.result.resolve(u[b][2])}),[2]}})})},a}();p.ElevationQuery=A})},"esri/views/3d/layers/graphics/Graphics3DSpatialIndex":function(){define("require exports dojo/Deferred ../../../../processors/SpatialIndex ../../../../geometry/SpatialReference ../../../../geometry/support/webMercatorUtils".split(" "),function(A,p,w,l,h,d){return function(){function p(){var d=this;this.spatialIndex=
new l;this.spatialIndexNumPendingQueries=this.spatialIndexNumGraphics=0;this.graphicsCore=this.viewSR=this.layer=this.layerView=null;this._readyDfd=new w;var a=function(a){return a.workerClient&&a.workerClient.worker};a(this.spatialIndex)?this._readyDfd.resolve():this.spatialIndex.on("start",function(){a(d.spatialIndex)&&d._readyDfd.resolve()})}return p.prototype.initialize=function(d,a,k,c){this.layerView=d;this.layer=a;this.viewSR=k;this.graphicsCore=c},p.prototype.destroy=function(){this.spatialIndex&&
(this.spatialIndex.destroy(),this.spatialIndex=null);this.graphicsCore=this.layerView=this.viewSR=null},p.prototype.numNodesUpdating=function(){return 0},p.prototype.isUpdating=function(){return 0<this.spatialIndexNumPendingQueries},p.prototype.hasGraphics=function(){return 0<this.spatialIndexNumGraphics},p.prototype.intersects=function(d,a,k){var c=this;return this.hasGraphics()?(this.spatialIndexNumPendingQueries++,void this.spatialIndex.intersects(d,void 0,void 0,!0).then(function(a){c.spatialIndexNumPendingQueries--;
k(a.results,a.results.length);c.layerView._evaluateUpdatingState()})):void k([],0)},p.prototype.shouldAddToSpatialIndex=function(d,a,k){return k||a.needsElevationUpdates()},p.prototype.addGraphicsToSpatialIndex=function(d){if(this.layerView.loadedGraphics)for(var a=this.layerView.loadedGraphics.toArray(),k=a.length,c=0;k>c;c++){var h=a[c],l=this.graphicsCore.getGraphics3DGraphicById(h.uid);l&&!l.addedToSpatialIndex&&this.shouldAddToSpatialIndex(h,l,d)&&this.addGraphicToSpatialIndex(h,l)}},p.prototype.addGraphicToSpatialIndex=
function(l,a){var k=l.geometry.spatialReference,c=this.viewSR,r={id:l.uid,geometry:null};if(k.equals(c))r.geometry=l.geometry.toJSON();else{var p=void 0;if(k.wkid===h.WGS84.wkid&&c.isWebMercator)p=d.geographicToWebMercator(l.geometry);else{if(!k.isWebMercator||c.wkid!==h.WGS84.wkid)return console.warn("Cannot convert graphic geometry to map spatial reference, elevation and scale updates are disabled"),!1;p=d.webMercatorToGeographic(l.geometry)}r.geometry=p.toJSON()}return this.spatialIndexNumGraphics++,
this.spatialIndex.runProcess([r],this.layer.id),a.addedToSpatialIndex=!0,!0},p.prototype.whenLoaded=function(){return this._readyDfd.promise},p}()})},"esri/processors/SpatialIndex":function(){define("../core/declare dojo/Deferred dojo/_base/lang ./Processor ../workers/WorkerClient ../layers/FeatureLayer".split(" "),function(A,p,w,l,h,d){return A([l],{declaredClass:"esri.processors.SpatialIndex",index:null,indexType:"rtree",autostart:!1,constructor:function(d){d=d||{};var l=!1!==d.autostart;if(w.mixin(this,
d),this.workerCallback=["./scripts/helpers","./scripts/indexInterface","./indexWorker"],!this.fetchWithWorker){var a=this;this.workerClient=new h("./mutableWorker",function(d){this.workerClient=d;this.workerCallback.push("./libs/"+this.indexType);this.workerClient.importScripts(this.workerCallback).then(function(){a._attachedSystem=!0;l&&a.start()})}.bind(this))}this._featCache={}},destroy:function(){this.workerClient&&this.workerClient.terminate()},addLayer:function(h,l){if(h.graphics&&h.graphics.length||
l||h.isInstanceOf(d)){var a=this.workerClient;if(!this._attachedSystem&&a.worker){var k=this;this.inherited(arguments,[h,!0]);a.importScripts("./libs/"+this.indexType).then(function(){k.runProcess(h.graphics,h.id);k._attachedSystem=!0})}else this.inherited(arguments,[h])}},unsetMap:function(){this.stop();this.workerClient.terminate();this.fetchWithWorker||(this.workerClient=new h(this.workerCallback,function(){}));this.inherited(arguments);this.start()},removeLayer:function(d){this.inherited(arguments)},
runProcess:function(d,h){if(d&&d.length){var a=this,k=this.workerClient,c=d[0]._graphicsLayer;h||0===h||(h=c?c.id:"rawFeatures_"+Object.keys(this._featCache).length);this._featCache[h]||(this._featCache[h]={});for(var l,r,q=[],p=d.length,u=c&&c.objectIdField;p--;)r=d[p],l=r.attributes&&u?r.attributes[u]:r.id,null!=l&&this._featCache[h][l]||(this._featCache[h][l]=1,r.declaredClass?q.push({id:l,geometry:r.geometry.toJSON(!0),attributes:r.attributes}):q.push(r));0!==q.length&&(k.postMessage({insert:q,
system:this.indexType,options:this.indexOptions,idField:c&&c.objectIdField,layerId:h}).then(function(d){c&&c.emit("process-end",{processor:a,results:{insert:d.insert}})}),c&&c.emit("process-start",{processor:this}))}},_sendFeaturesFromLayer:function(d,h){h=h.graphic;var a=this.workerClient,k=this,c=h.attributes[d.objectIdField];this._featCache[d.id]||(this._featCache[d.id]={});this._featCache[d.id][c]||(this._featCache[d.id][c]=1,a.postMessage({insert:[{attributes:h.attributes,geometry:h.geometry.toJSON(!0)}],
system:this.indexType,options:this.indexOptions,idField:d.objectIdField,layerId:d.id}).then(function(a){d.emit("process-end",{processor:k,results:{insert:a.insert}})}),d.emit("process-start",{processor:k}))},_notifyProcessStart:function(d,h){},_sendFeaturesFromTask:function(d,h){var a,k=h.featureSet.features,c=[],l=this.workerClient,r=this,q=k.length;for(this._featCache[d.id]||(this._featCache[d.id]={});q--;)a=k[q],h=a.attributes[d.objectIdField],this._featCache[d.id][h]||(this._featCache[d.id][h]=
1,c.push(a));l.postMessage({insert:c,system:this.indexType,options:this.indexOptions,idField:d.objectIdField,layerId:d.id}).then(function(a){d.emit("process-end",{processor:r,results:{insert:a.insert}})});d.emit("process-start",{processor:r})},get:function(){},intersects:function(d,h,a,k){var c;return"rtree"!=this.indexType?(console.error("Index.intersects only works with rtree indexes"),c=new p,c.reject({message:"Index.intersects only works with rtree indexes"}),c.promise):this.workerClient.postMessage({search:d,
layerId:h,returnNode:a,onlyIds:k})},within:function(d,h,a){var k;if("rtree"!=this.indexType)return console.error("Index.within only works with rtree indexes"),k=new p,k.reject({message:"Index.within only works with rtree indexes"}),k.promise},nearest:function(d){var h;return"kdtree"!=this.indexType?(console.error("Index.nearest only works with kdtree indexes"),h=new p,h.reject({message:"Index.nearest only works with kdtree indexes"}),h.promise):this.workerClient.postMessage({search:d})}})})},"esri/processors/Processor":function(){define("../core/sniff ../core/declare dojo/_base/lang dojo/_base/array dojo/Evented ../workers/RequestClient ../layers/GraphicsLayer".split(" "),
function(A,p,w,l,h,d,u){return p([h],{declaredClass:"esri.processors.Processor",layers:null,results:null,passFeatures:!0,drawFeatures:!0,requireWorkerSupport:!0,fetchWithWorker:!1,workerCallback:null,workerClient:null,_started:null,_handlers:null,constructor:function(d){return d=d||{},w.mixin(this,d),A("esri-workers")||!1===this.requireWorkerSupport&&!1===d.requireWorkerSupport?(this._handlers={},this._notifyProcessStart=w.hitch(this,this._notifyProcessStart),this._sendFeaturesFromTask=w.hitch(this,
this._sendFeaturesFromTask),this._sendFeaturesFromLayer=w.hitch(this,this._sendFeaturesFromLayer),void(!1!==d.autostart&&this.start())):(console.log("Browser doesn't support workers \x26 worker support is required for this processor"),this.addLayer=this.setMap=this.start=this.runProcess=function(){},void(this._disabled=!0))},addLayer:function(h,a){var k=h._task,c=this._handlers[h.id]=[],l="complete";!1===this.drawFeatures&&(h._params.drawMode=!1);this.fetchWithWorker?(this.workerClient||(this.workerClient=
d.getClient(this.workerCallback)),k.requestOptions={workerOptions:{worker:this.workerClient}},this.passFeatures&&c.push(k.on(l,w.partial(this._notifyProcessStart,h)))):this.passFeatures?(l=this.drawFeatures?"graphic-draw":"graphic-add",c.push(h.on(l,w.partial(this._sendFeaturesFromLayer,h)))):c.push(k.on(l,w.partial(this._sendFeaturesFromTask,h)));!0!==a&&h.graphics&&this.runProcess(h.graphics,h.id)},removeLayer:function(d){l.forEach(this._handlers[d.id],function(a){a.remove()});delete this._handlers[d.id]},
setMap:function(d){if(this.map){if(d==this.map)return;this.unsetMap()}var a=this;l.forEach(this.layers,a.removeLayer);l.forEach(d.graphicsLayerIds,function(h){a.addLayer(d.findLayerById(h))});this._handlers.map=[d.on("layer-add",function(d){d=d.layer;d.isInstanceOf(u)&&a.addLayer(d)}),d.on("layer-remove",function(d){d=d.layer;d.isInstanceOf(u)&&a.removeLayer(d)})];this.map=d},unsetMap:function(){this.map&&(l.forEach(this._handlers.map,function(d){d.remove()}),delete this._handlers.map,l.forEach(this.layers,
this.removeLayer),this.map=null)},start:function(){this.map?this.setMap(this.map):this.layers&&(w.isArray(this.layers)||(this.layers=[this.layers]),l.forEach(this.layers,this.addLayer));this._started=!0;this.emit("start",{processor:this});console.log("processor started")},stop:function(){this._started=!1;for(var d in this._handlers)this._handlers.hasOwnProperty(d)&&(this._handlers[d].remove(),delete this._handlers[d]);this.emit("stop",{processor:this});console.log("processor stopped")},runProcess:function(d,
a){},_sendFeaturesFromTask:function(){},_sendFeaturesFromLayer:function(){},_notifyProcessStart:function(){}})})},"esri/workers/RequestClient":function(){define(["../core/declare","dojo/_base/xhr","../config","./WorkerClient"],function(A,p,w,l){function h(a,c){var h=new d;(h.addWorkerCallback(a,c),u.unshift({id:c?a+"::"+c:a,client:h}),u.length>r)&&u.pop().client.terminate();return h}var d=A([l],{declaredClass:"esri.workers.RequestClient",constructor:function(){this.setWorker(["./mutableWorker","./requestWorker"],
function(){})},get:function(a){return this._send("GET",a)},post:function(a){return this._send("POST",a)},_send:function(a,c){c=p._ioSetArgs(c);c.xhr=null;var d=c.ioArgs,h=d.url;return delete d.url,delete d.args,this.postMessage({method:a,url:h,options:d}).then(this._getSuccessHandler(c),this._getErrorHandler(c),this._getProgressHandler(c)),c},_addHeaderFunctions:function(a){return a.getResponseHeader=function(c){var d,h=a.headers;return Object.keys(h).forEach(function(a){return a.toLowerCase()==c.toLowerCase()?
(d=h[a],!1):void 0}),d},a.getAllResponseHeaders=function(){var c=[],d=a.headers;return Object.keys(d).forEach(function(a){c.push(a+": "+d[a])}),c=c.join("\n")},a},_getSuccessHandler:function(a){var c=this,d=a.ioArgs;return function(h){a.xhr=c._addHeaderFunctions(h);h=a.xhr.getResponseHeader("content-type");("xml"==d.handleAs||-1<h.indexOf("xml"))&&"string"==typeof a.xhr.response&&(a.xhr.response=(new DOMParser).parseFromString(a.xhr.response,"text/xml"));a.resolve(a.xhr.response,a.xhr)}},_getErrorHandler:function(a){return function(c){a.reject(c)}},
_getProgressHandler:function(a){return function(c){a.progress(c)}}}),u=[],r=w.request.maxWorkers,a=new d;return d.getClient=function(d,c){if(d){var k;return u.some(function(a){return a.id==(c?d+"::"+c:d)&&(k=a.client),!0}),k||h(d,c)}return a},d.setLimit=function(a){r=w.request.maxWorkers=a},d})},"esri/workers/WorkerClient":function(){define("dojo/Evented ../core/declare dojo/Deferred dojo/_base/lang dojo/request ../core/sniff ../core/urlUtils require".split(" "),function(A,p,w,l,h,d,u,r){var a=window.Blob||
window.webkitBlob||window.mozBlob,k=window.URL||window.webkitURL||window.mozURL;return p([A],{declaredClass:"esri.workers.WorkerClient",worker:null,_queue:null,constructor:function(a,h){this._isIE=d("ie");this._queue={};this._acceptMessage=l.hitch(this,this._acceptMessage);this._errorMessage=l.hitch(this,this._errorMessage);a&&this.setWorker(a,function(a){this.worker=a;h(this)}.bind(this))},setWorker:function(c,d){if(c instanceof Array){var h=c;c=h.shift()}var l=this._getUrl(c),l=u.normalize(l),r;
c=!u.hasSameOrigin(l,location.href);if(!1===l)return console.log("Can not resolve worker path"),!1;if(this.worker&&(r=this.worker,r.removeEventListener("message",this._acceptMessage,!1),r.removeEventListener("error",this._errorMessage,!1),r.terminate(),r=null),c){r=this._getUrl("./mutableWorker",!0);try{this._getRemoteText(r,function(c){c=k.createObjectURL(new a([c],{type:"text/javascript"}));d(this._createWorker(c,l))}.bind(this))}catch(y){try{r=u.getProxyUrl(r).path+"?"+encodeURI(r),this._useProxy=
!0,d(this._createWorker(r,h))}catch(B){return console.log("Can not create worker"),!1}}}else d(this._createWorker(l,h))},_createWorker:function(a,d){a=new Worker(a);return a.addEventListener("message",this._acceptMessage,!1),a.addEventListener("error",this._errorMessage,!1),this.worker=a,d&&this.importScripts(d),a},postMessage:function(a,d){(a instanceof Array||"object"!=typeof a)&&(a={data:a});var c=Math.floor(64E9*Math.random()).toString(36);a.msgId=c;c=this._queue[c]=new w;return this.worker?(d?
this.worker.postMessage(a,d):this.worker.postMessage(a),this.emit("start-message",{target:this,message:a})):c.reject({message:"No worker was set."}),c.promise},terminate:function(){var a=Object.keys(this._queue);this.worker&&this.worker.terminate();for(var d=a.length-1;0<=d;d--)this._queue[a[d]].cancel("terminated"),delete this._queue[a[d]]},addWorkerCallback:function(a,d){var c,h=this._getUrl(a,!0);return!1===h?(c=new w,c.reject({message:"Could not load text from "+a}),c.promise):this.postMessage({action:"add-callback",
url:h,cbName:d||"main"}).then(l.hitch(this,function(a){a.target=this;this.emit("callback-added",a)}))},importScripts:function(a){Array.isArray(a)||(a=[a]);a=a.map(function(a){a=this._getUrl(a,!0);return this._useProxy&&!u.hasSameOrigin(a,location.href)&&(a=u.getProxyUrl(a).path+"?"+encodeURI(a)),a},this);return this.postMessage({action:"import-script",url:a}).then(l.hitch(this,function(a){a.target=this;this.emit("scripts-imported",a)}))},_acceptMessage:function(a){var c=a.data,d=c.msgId;if(c.status&&
"debug"==c.status)console[c.showAs||"debug"](c);else if(d&&d in this._queue){var h=this._queue[d];"progress"==c.status?h.progress(a.data):"error"==c.status?(h.reject(a.data),delete this._queue[d]):(h.resolve(a.data),delete this._queue[d])}this.emit("message",{message:a.data,event:a,target:this})},_errorMessage:function(a){this.onerror||this.onError?this.onerror?this.onerror(a):this.onError(a):console.log("Worker Error: "+a.message+"\nIn "+a.filename+" on "+a.lineno)},_getUrl:function(a,d){if(!a)return console.error("can not resolve empty path"),
!1;a.match(/\.js$/)||(a+=".js");a=r.toUrl(a);return d?u.makeAbsolute(a):a},_getRemoteText:function(a,d){(a=this._getUrl(a))&&h.get(a,{sync:!1,handleAs:"text",headers:{"X-Requested-With":"","Content-Type":"text/plain"}}).then(function(a){d(a)})},_startBlobWorker:function(){var c=this._xdSource;c||(c=this._getUrl("./mutableWorker"),c=new a(["if(!self._mutable){importScripts('"+c+"');}"],{type:"text/javascript"}),c=this._xdSource=k.createObjectURL(c));try{return new Worker(c)}catch(t){return console.log(t.message),
!1}}})})},"esri/layers/GraphicsLayer":function(){define("../core/Accessor ../core/Collection ../core/promiseUtils ./Layer ./mixins/ScaleRangeLayer ../Graphic dojo/_base/lang".split(" "),function(A,p,w,l,h,d,u){var r=A.createSubclass({properties:{layer:null,layerView:null,graphics:null}});return l.createSubclass([h],{declaredClass:"esri.layers.GraphicsLayer",viewModulePaths:{"2d":"../views/2d/layers/GraphicsLayerView2D","3d":"../views/3d/layers/FeatureLayerView3D"},getDefaults:function(a){return u.mixin(this.inherited(arguments),
{graphics:[]})},destroy:function(){this.removeAll()},_gfxHdl:null,properties:{elevationInfo:null,graphics:{type:p.ofType(d),set:function(a){var d=this._get("graphics");d||(a.forEach(function(a){a.layer=this},this),this._gfxHdl=a.on("change",function(a){var c,d,h;h=a.added;for(c=0;d=h[c];c++)d.layer=this;h=a.removed;for(c=0;d=h[c];c++)d.layer=null}.bind(this)),this._set("graphics",a),d=a);d.removeAll();d.addMany(a)}},screenSizePerspectiveEnabled:!0,type:{readOnly:!0,value:"graphics"}},add:function(a){return this.graphics.add(a),
this},addMany:function(a){return this.graphics.addMany(a),this},removeAll:function(){return this.graphics.removeAll(),this},createGraphicsController:function(a){return w.resolve(new r({layer:this,layerView:a.layerView,graphics:this.graphics}))},remove:function(a){this.graphics.remove(a)},removeMany:function(a){this.graphics.removeMany(a)},graphicChanged:function(a){this.emit("graphic-update",a)}})})},"esri/layers/FeatureLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/accessorSupport/decorators dojo/_base/lang ../Graphic ../PopupTemplate ../request ../core/MultiOriginJSONSupport ../core/Collection ../core/Error ../core/HandleRegistry ../core/Logger ../core/kebabDictionary ../core/lang ../core/promiseUtils ../core/requireUtils ../core/urlUtils ../geometry/Extent ../geometry/HeightModelInfo ../geometry/SpatialReference ../geometry/support/normalizeUtils ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/support/jsonUtils ../symbols/support/ElevationInfo ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/support/jsonUtils ../renderers/support/styleUtils ../renderers/support/typeUtils ../tasks/support/FeatureSet ../tasks/support/Query ./Layer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/RefreshableLayer ./mixins/ArcGISService ./graphics/sources/MemorySource ./support/Field ./support/fieldUtils ./support/FeatureProcessing ./support/FeatureTemplate ./support/FeatureType ./support/FeatureReduction ./support/LabelClass ./support/labelingInfo ./support/arcgisLayerUrl ./support/commonProperties".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E,J,G,K,M,U,N,W,R,V,Q,S,X,z,Z,O,g,e,f,n,x,I,L,P,Y,fa,ga,ia,na,ka,wa,ta,sa){function aa(a){return a&&null!=a.applyEdits}function ya(a){return a&&a.isInstanceOf&&a.isInstanceOf(L)}function la(a,b,c){return!(a&&a.hasOwnProperty(b)?!a[b]:!c)}var za=y({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),oa=v.getLogger("esri.layers.FeatureLayer");
return function(c){function e(a){a=c.call(this)||this;return a.viewModulePaths={"2d":"../views/2d/layers/FeatureLayerView2D","3d":"../views/3d/layers/FeatureLayerView3D"},a._handles=new q,a.featureReduction=null,a.copyright=null,a.displayField=null,a.definitionExpression=null,a.editFieldsInfo=null,a.elevationInfo=null,a.fields=null,a.fullExtent=null,a.gdbVersion=null,a.geometryType=null,a.hasM=!1,a.hasZ=!1,a.heightModelInfo=null,a.isTable=!1,a.labelsVisible=!1,a.labelingInfo=null,a.layerId=void 0,
a.legendEnabled=!0,a.maxRecordCount=void 0,a.minScale=0,a.maxScale=0,a.objectIdField=null,a.operationalLayerType="ArcGISFeatureLayer",a.popupEnabled=!0,a.popupTemplate=null,a.relationships=null,a.returnM=!1,a.returnZ=!1,a.screenSizePerspectiveEnabled=!0,a.serviceDefinitionExpression=null,a.spatialReference=G.WGS84,a.templates=null,a.timeInfo=null,a.title=null,a.sublayerTitleMode="item-title",a.trackIdField=null,a.type="feature",a.typeIdField=null,a.types=null,a.userIsAdmin=!1,a.version=void 0,a.visible=
!0,a}return w(e,c),e.prototype.normalizeCtorArgs=function(a,b){return"string"==typeof a?u.mixin({},{url:a},b):a},e.prototype.load=function(){var a=this,b=this.source&&(Array.isArray(this.source)||ya(this.source));if(this.portalItem&&b)return void this.addResolvingPromise(D.resolve());b=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]}).always(function(){return a.url&&null==a.layerId&&/FeatureServer\/*$/i.test(a.url)?a._fetchFirstLayerId().then(function(b){null!=b&&(a.layerId=
b)}):void 0}).then(function(){if(!a.url&&!a._hasMemorySource())throw new C("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return a.createGraphicsSource().then(a._initLayerProperties.bind(a))});return this.addResolvingPromise(b),this.when()},Object.defineProperty(e.prototype,"allRenderers",{get:function(){return this._getAllRenderers(this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capabilities",{get:function(){var a=
this._get("capabilities");return a||!this.loaded||this.hasService?a:{data:{supportsAttachment:!1,supportsM:!1,supportsZ:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!0,supportsDelete:!0,supportsEditing:!0,supportsQuery:!0,supportsUpdate:!0},query:{supportsStatistics:!1,supportsCentroid:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!0,supportsGeometryProperties:!1,supportsOrderBy:!1,supportsPagination:!1,supportsQuantization:!1,supportsResultType:!1,
supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsQueryByOthers:!1},queryRelated:{supportsPagination:!1,supportsCount:!1,supportsOrderBy:!1},editing:{supportsGeometryUpdate:!0,supportsGlobalId:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}},enumerable:!0,configurable:!0}),e.prototype.readCapabilities=function(a,b){return b=b.layerDefinition||
b,{data:this._readDataCapabilities(b),operations:this._readOperationsCapabilities(b.capabilities||a,b),query:this._readQueryCapabilities(b),queryRelated:this._readQueryRelatedCapabilities(b),editing:this._readEditingCapabilities(b)}},Object.defineProperty(e.prototype,"hasAttachments",{get:function(){return this.hasService&&this._get("hasAttachments")||!1},enumerable:!0,configurable:!0}),e.prototype.readIsTable=function(a,b){return b=b&&b.layerDefinition||b,"Table"===b.type},Object.defineProperty(e.prototype,
"hasService",{get:function(){return!this._hasMemorySource()},enumerable:!0,configurable:!0}),e.prototype.readMinScale=function(a,b){return b.effectiveMinScale||a||0},e.prototype.readMaxScale=function(a,b){return b.effectiveMaxScale||a||0},e.prototype.readObjectIdFieldFromService=function(a,b){if(b=b.layerDefinition||b,b.objectIdField)return b.objectIdField;if(b.fields)for(a=0,b=b.fields;a<b.length;a++){var c=b[a];if("esriFieldTypeOID"===c.type)return c.name}},Object.defineProperty(e.prototype,"outFields",
{get:function(){var a=this,b=this._userOutFields,c=this.requiredFields;return b=b&&b.slice(0),c=c&&c.slice(0),b?-1===b.indexOf("*")&&c.forEach(function(a){-1===b.indexOf(a)&&b.push(a)}):b=c,this.loaded&&(b=b.filter(function(b){return"*"===b||!!a.getField(b,a.fields)},this),b=b.map(function(b){return"*"===b?b:a.getField(b,a.fields).name},this),b=b.filter(function(a,b,c){return c.indexOf(a)===b})),b},set:function(a){var b=this,c=this.requiredFields&&this.requiredFields.slice(0);a?-1===a.indexOf("*")&&
c.forEach(function(b){-1===a.indexOf(b)&&a.push(b)}):a=c;this.loaded&&(a=a.filter(function(a){return"*"===a||!!b.getField(a,b.fields)},this),a=a.map(function(a){return"*"===a?a:b.getField(a,b.fields).name},this));this._userOutFields=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parsedUrl",{get:function(){var a=this.url?m.urlToObject(this.url):null;return null!=this.layerId&&null!=a&&(a.path=m.join(a.path,this.layerId.toString())),a},enumerable:!0,configurable:!0}),e.prototype.readPopupEnabled=
function(a,b){return!b.disablePopup},e.prototype.writePopupEnabled=function(a,b,c){b[c]=!a},Object.defineProperty(e.prototype,"renderer",{set:function(a){var b=this._getAllRenderers(a);Y.fixRendererFields(b,this.fields);this._set("renderer",a)},enumerable:!0,configurable:!0}),e.prototype.readRenderer=function(a,b,c){b=b.layerDefinition||b;var e,d,f=b.drawingInfo&&b.drawingInfo.renderer||void 0;if(f)(e=S.read(f,b,c)||void 0)||oa.error("Failed to create renderer",{rendererDefinition:b.drawingInfo.renderer,
layer:this,context:c});else if(b.defaultSymbol)W.read(b.defaultSymbol,b,c),b.types&&b.types.length?(e=new Q({defaultSymbol:d,field:b.typeIdField}),b.types.forEach(function(a){f.addUniqueValueInfo(a.id,W.read(a.symbol,a,c))})):e=new V({symbol:d});else if("Table"!==b.type){switch(b.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":d=new M;break;case "esriGeometryPolyline":d=new U;break;case "esriGeometryPolygon":d=new N}e=d&&new V({symbol:d})}return e},Object.defineProperty(e.prototype,
"requiredFields",{get:function(){var a=this.timeInfo,b=[],c=[],a=[this.objectIdField,this.typeIdField,this.editFieldsInfo&&this.editFieldsInfo.creatorField,a&&a.startTimeField,a&&a.endTimeField,this.trackIdField];this.allRenderers.forEach(function(a){b=b.concat(a.requiredFields)});this.labelingInfo&&this.labelingInfo.length&&this.labelingInfo.forEach(function(a){c=c.concat(a.requiredFields)});var a=a.concat(b),a=a.concat(c),e=this.elevationInfo&&this.elevationInfo.featureExpressionInfo;return e&&
(a=a.concat(e.requiredFields)),this.popupTemplate&&(a=a.concat(this.popupTemplate.requiredFields)),a.filter(function(a,b,c){return!!a&&c.indexOf(a)===b&&"function"!=typeof a})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"source",{set:function(a){var b=this._get("source");b!==a&&(ya(b)&&this._resetMemorySource(b),ya(a)&&this._initMemorySource(a),this._set("source",a))},enumerable:!0,configurable:!0}),e.prototype.castSource=function(a){return a?Array.isArray(a)||a&&a.isInstanceOf&&
a.isInstanceOf(t)?new L({layer:this,items:a}):a:null},e.prototype.readSource=function(a,b){a=Z.fromJSON(b.featureSet);return new L({layer:this,items:a&&a.features||[]})},e.prototype.readTemplates=function(a,b){var c=b.editFieldsInfo;b=c&&c.creatorField;c=c&&c.editorField;return a=a&&a.map(function(a){return ga.fromJSON(a)}),this._fixTemplates(a,b),this._fixTemplates(a,c),a},e.prototype.readTitle=function(a,b){a=b.layerDefinition&&b.layerDefinition.name||b.name;b=b.title||b.layerDefinition&&b.layerDefinition.title;
return a?(b=this.portalItem&&this.portalItem.title,"item-title"===this.sublayerTitleMode?this.url?ta.titleFromUrlAndName(this.url,a):a:(a=a||this.url&&ta.parse(this.url).title)?("item-title-and-service-name"===this.sublayerTitleMode&&b&&(a=b+" - "+a),ta.cleanTitle(a)):void 0):"item-title"===this.sublayerTitleMode&&b?b:void 0},e.prototype.readTitleFromWebMap=function(a,b){return(a=b.layerDefinition&&b.layerDefinition.name)?a:b.title},e.prototype.readTypeIdField=function(a,b){(b=b.layerDefinition||
b,a=b.typeIdField)&&(b=this.getField(a,b.fields))&&(a=b.name);return a},e.prototype.readTypes=function(a,b){var c=this;b=b.layerDefinition||b;a=b.types;var e=(b=b.editFieldsInfo)&&b.creatorField,d=b&&b.editorField;return a&&a.map(function(a){return a=ia.fromJSON(a),c._fixTemplates(a.templates,e),c._fixTemplates(a.templates,d),a})},Object.defineProperty(e.prototype,"url",{set:function(a){a=ta.sanitizeUrlWithLayerId(this,a,oa);this._set("url",a.url);null!=a.layerId&&this._set("layerId",a.layerId)},
enumerable:!0,configurable:!0}),e.prototype.writeUrl=function(a,b,c,e){ta.writeUrlWithLayerId(this,a,b)},e.prototype.readVersion=function(a,b){return b=b.layerDefinition||b,b.currentVersion?b.currentVersion:b.hasOwnProperty("capabilities")||b.hasOwnProperty("drawingInfo")||b.hasOwnProperty("hasAttachments")||b.hasOwnProperty("htmlPopupType")||b.hasOwnProperty("relationships")||b.hasOwnProperty("timeInfo")||b.hasOwnProperty("typeIdField")||b.hasOwnProperty("types")?10:9.3},e.prototype.readVisible=
function(a,b){return b.layerDefinition&&null!=b.layerDefinition.defaultVisibility?!!b.layerDefinition.defaultVisibility:null!=b.visibility?!!b.visibility:void 0},e.prototype.applyEdits=function(a){var b=this;return this.load().then(function(){return aa(b.source)?b._processApplyEditsParams(a):D.reject(new C("FeatureLayer","Layer source does not support applyEdits capability"))}).then(function(a){return aa(b.source)?b.source.applyEdits(a).then(function(a){var c=function(a){return a.filter(function(a){return!a.error}).map(B.clone)},
c={addedFeatures:c(a.addFeatureResults),updatedFeatures:c(a.updateFeatureResults),deletedFeatures:c(a.deleteFeatureResults)};return(c.addedFeatures.length||c.updatedFeatures.length||c.deletedFeatures.length)&&b.emit("edits",c),a}):void 0})},e.prototype.createGraphicsSource=function(){var a=this;return this._hasMemorySource()?(this.emit("graphics-source-create",{graphicsSource:this.source}),this.source.when()):b.when(A,"./graphics/sources/FeatureLayerSource").then(function(b){return new b({layer:a})}).then(function(a){return a.when()}).then(function(b){return a.emit("graphics-source-create",
{graphicsSource:b}),b})},e.prototype.createGraphicsController=function(a){var c,e=this,d=a.layerView,f=t.ofType(r),g=this.source,h=ya(g),k=u.mixin(a.options||{},{layer:this,layerView:d,graphics:h?g:new f});return c=h?"./graphics/controllers/MemoryController":"2d"===d.view.type?"./graphics/controllers/AutoController2D":"./graphics/controllers/SnapshotController",b.when(A,c).then(function(a){return new a(k)}).then(function(a){return e.emit("graphics-controller-create",{graphicsController:a}),a.when()})},
e.prototype.createQuery=function(){var a=new O,b=this.get("capabilities.data");return a.returnGeometry=!0,a.returnZ=b&&b.supportsZ&&this.returnZ||null,a.returnM=b&&b.supportsM&&this.returnM||null,a.outFields=this.outFields,a.where=this.definitionExpression||"1\x3d1",a.multipatchOption="multipatch"===this.geometryType?"xyFootprint":null,a},e.prototype.getFieldDomain=function(a,b){var c,e=this,d=!1;b=(b=b&&b.feature)&&b.attributes;var f=this.typeIdField&&b&&b[this.typeIdField];return null!=f&&this.types&&
(d=this.types.some(function(b){return b.id==f?(c=b.domains&&b.domains[a],c&&"inherited"===c.type&&(c=e._getLayerDomain(a)),!0):!1})),d||c||(c=this._getLayerDomain(a)),c},e.prototype.getField=function(a,b){var c=this.processing?this.fields.concat(this.processing.fields):this.fields;return Y.getField(a,b||c)},e.prototype.graphicChanged=function(a){this.emit("graphic-update",a)},e.prototype.queryFeatures=function(a){var b=this;return this.load().then(function(){return b.source.queryFeatures?void 0:D.reject(new C("FeatureLayer",
"Layer source does not support queryFeatures capability"))}).then(function(){return b.source.queryFeatures(a||b.createQuery())}).then(function(a){if(a&&a.features){var c=b.popupTemplate;a.features.forEach(function(a){a.popupTemplate=c;a.layer=b})}return a})},e.prototype.queryObjectIds=function(a){var b=this;return this.load().then(function(){return b.source.queryObjectIds?b.source.queryObjectIds(a||b.createQuery()):D.reject(new C("FeatureLayer","Layer source does not support queryObjectIds capability"))})},
e.prototype.queryFeatureCount=function(a){var b=this;return this.load().then(function(){return b.source.queryFeatureCount?b.source.queryFeatureCount(a||b.createQuery()):D.reject(new C("FeatureLayer","Layer source does not support queryFeatureCount capability"))})},e.prototype.queryExtent=function(a){var b=this;return this.load().then(function(){return b.source.queryExtent?b.source.queryExtent(a||b.createQuery()):D.reject(new C("FeatureLayer","Layer source does not support queryExtent capability"))})},
e.prototype.read=function(a,b){switch(b&&b.origin){case "web-scene":this.inherited(arguments,[{returnZ:!0},b])}var c=a.featureCollection;if(c){var e=c.layers;e&&1===e.length&&(this.inherited(arguments,[e[0],b]),null!=c.showLegend&&this.inherited(arguments,[{showLegend:c.showLegend},b]))}return this.inherited(arguments,[a,b]),this},e.prototype.write=function(a,b){if(b&&"web-scene"===b.origin&&b.messages){if(!this.url)return b.messages.push(new C("layer:unsupported","Layers ("+this.title+", "+this.id+
") of type '"+this.declaredClass+"' require a url to a service to be written to web scenes",{layer:this})),null;if(this.isTable)return b.messages.push(new C("layer:unsupported","Layers ("+this.title+", "+this.id+") of type '"+this.declaredClass+"' using a Table source cannot written to web scenes",{layer:this})),null}return this.inherited(arguments)},e.prototype._getLayerDomain=function(a){if(!this.fields)return null;var b=null;return this.fields.some(function(c){return c.name===a&&(b=c.domain),!!b}),
b},e.prototype._fetchFirstLayerId=function(){return k(this.url,{query:{f:"json"},callbackParamName:"callback",responseType:"json"}).then(function(a){return(a=a.data)&&Array.isArray(a.layers)&&0<a.layers.length?a.layers[0].id:void 0})},e.prototype._initLayerProperties=function(a){var b=this;return this.source||(this.source=a),a.url&&(this.url=a.url),a.layerDefinition&&this.read(a.layerDefinition,{origin:"service",url:this.parsedUrl}),this._verifySource(),this._verifyFields(),this._addSymbolUrlTokens(),
Y.fixRendererFields(this._getAllRenderers(this.renderer),this.fields),this.watch("token",function(){b._addSymbolUrlTokens()}),X.loadStyleRenderer(this,{origin:"service"})},e.prototype._findUrlBasedSymbols=function(){var a=this.renderer;if(!a)return[];var b=[];a.symbol&&b.push(a.symbol);a.defaultSymbol&&b.push(a.defaultSymbol);a=a.classBreakInfos||a.uniqueValueInfos;return a&&a.forEach(function(a){a.symbol&&b.push(a.symbol)}),b.filter(function(a){return!!a.url})},e.prototype._addSymbolUrlTokens=function(){var a=
this.token;!this._hasMemorySource()&&a&&this._findUrlBasedSymbols().forEach(function(b){var c=b.url;if(c&&-1!==c.search(/https?\:/i)&&!/[?&]token=/.test(c)){var e=-1===c.indexOf("?")?"?":"\x26";b.url=c+e+"token\x3d"+a}})},e.prototype._getAllRenderers=function(a){if(!a)return[];var b=[];return[a,a.trackRenderer,a.observationRenderer,a.latestObservationRenderer].forEach(function(a){a&&(b.push(a),a.rendererInfos&&a.rendererInfos.forEach(function(a){a.renderer&&b.push(a.renderer)}))}),b},e.prototype._verifyFields=
function(){var a=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+a+")");this.isTable||this._hasMemorySource()||-1!==a.search(/\/FeatureServer\//i)||this.fields&&this.fields.some(function(a){return"geometry"===a.type})||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+a+")")},e.prototype._fixTemplates=
function(a,b){a&&a.forEach(function(a){(a=a.prototype&&a.prototype.attributes)&&b&&delete a[b]})},e.prototype._verifySource=function(){var a=this;if(this._hasMemorySource()){if(this.url)throw new C("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url");var b=["geometryType","fields","objectIdField"];if(!b.every(function(b){return null!=a[b]}))throw new C("feature-layer:missing-property","FeatureLayer created as feature collection requires properties: "+
b.join(),{requiredProperties:b});}else{if(this.isTable)throw new C("feature-layer:source-type-not-supported","The table feature service type is not yet supported",{sourceType:"Table"});if(!this.url)throw new C("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source");}},e.prototype._initMemorySource=function(a){var b=this;a.forEach(function(a){a.layer=b});this._handles.add([a.on("after-add",function(a){a.item.layer=b}),a.on("after-remove",function(a){a.item.layer=
null})],"fl-source")},e.prototype._resetMemorySource=function(a){a.forEach(function(a){a.layer=null});this._handles.remove("fl-source")},e.prototype._hasMemorySource=function(){return!(this.url||!this.source)},e.prototype._readDataCapabilities=function(a){return{supportsAttachment:la(a,"hasAttachments",!1),supportsM:la(a,"hasM",!1),supportsZ:la(a,"hasZ",!1)}},e.prototype._readOperationsCapabilities=function(a,b){a=a?a.toLowerCase().split(",").map(function(a){return a.trim()}):[];var c=-1!==a.indexOf("editing"),
e=c&&-1!==a.indexOf("create"),d=c&&-1!==a.indexOf("delete"),f=c&&-1!==a.indexOf("update");return c&&!(e||d||f)&&(e=d=f=!0),{supportsCalculate:la(b,"supportsCalculate",!1),supportsTruncate:la(b,"supportsTruncate",!1),supportsValidateSql:la(b,"supportsValidateSql",!1),supportsAdd:e,supportsDelete:d,supportsEditing:c,supportsQuery:-1!==a.indexOf("query"),supportsUpdate:f}},e.prototype._readQueryCapabilities=function(a){var b=a.advancedQueryCapabilities,c=a.ownershipBasedAccessControlForFeatures;return{supportsStatistics:la(b,
"supportsStatistics",a.supportsStatistics),supportsCentroid:la(b,"supportsReturningGeometryCentroid",!1),supportsDistance:la(b,"supportsQueryWithDistance",!1),supportsDistinct:la(b,"supportsDistinct",a.supportsAdvancedQueries),supportsExtent:la(b,"supportsReturningQueryExtent",!1),supportsGeometryProperties:la(b,"supportsReturningGeometryProperties",!1),supportsOrderBy:la(b,"supportsOrderBy",a.supportsAdvancedQueries),supportsPagination:la(b,"supportsPagination",!1),supportsQuantization:la(a,"supportsCoordinatesQuantization",
!1),supportsResultType:la(b,"supportsQueryWithResultType",!1),supportsSqlExpression:la(b,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:la(a,"useStandardizedQueries",!1),supportsQueryByOthers:la(c,"allowOthersToQuery",!0)}},e.prototype._readQueryRelatedCapabilities=function(a){a=a.advancedQueryCapabilities;var b=la(a,"supportsAdvancedQueryRelated",!1);return{supportsPagination:la(a,"supportsQueryRelatedPagination",!1),supportsCount:b,supportsOrderBy:b}},e.prototype._readEditingCapabilities=
function(a){var b=a.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:la(a,"allowGeometryUpdates",!0),supportsGlobalId:la(a,"supportsApplyEditsWithGlobalIds",!1),supportsRollbackOnFailure:la(a,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:la(a,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:la(a,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:la(b,"allowAnonymousToDelete",!0),supportsDeleteByOthers:la(b,"allowOthersToDelete",!0),supportsUpdateByAnonymous:la(b,
"allowAnonymousToUpdate",!0),supportsUpdateByOthers:la(b,"allowOthersToUpdate",!0)}},e.prototype._processApplyEditsParams=function(a){if(!a)return D.reject(new C("feature-layer:missing-parameters","'addFeatures', 'updateFeatures' or 'deleteFeatures' parameter is required"));if(a=u.mixin({},a),a.addFeatures=a.addFeatures||[],a.updateFeatures=a.updateFeatures||[],a.deleteFeatures=a.deleteFeatures||[],a.addFeatures.length||a.updateFeatures.length||a.deleteFeatures.length){var b=function(a){var b=new r;
return b.geometry=a.geometry,b.attributes=a.attributes,b};return a.addFeatures=a.addFeatures.map(b),a.updateFeatures=a.updateFeatures.map(b),this._normalizeGeometries(a)}return D.reject(new C("feature-layer:missing-parameters","'addFeatures', 'updateFeatures' or 'deleteFeatures' parameter is required"))},e.prototype._normalizeGeometries=function(a){var b=a.addFeatures,c=a.updateFeatures,e=b.concat(c).map(function(a){return a.geometry});return K.normalizeCentralMeridian(e).then(function(e){var d=b.length,
f=c.length;return e.slice(0,d).forEach(function(b,c){a.addFeatures[c].geometry=b}),e.slice(d,d+f).forEach(function(b,c){a.updateFeatures[c].geometry=b}),a})},l([d.property({types:{key:"type",base:na.FeatureReduction,typeMap:{selection:na.FeatureReductionSelection}},json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],e.prototype,"featureReduction",void 0),l([d.property({readOnly:!0,dependsOn:["loaded","renderer","fields"]})],
e.prototype,"allRenderers",null),l([d.property({readOnly:!0,dependsOn:["loaded"]})],e.prototype,"capabilities",null),l([d.reader("capabilities","layerDefinition.capabilities layerDefinition.advancedQueryCapabilities layerDefinition.supportsStatistics layerDefinition.supportsAdvancedQueries layerDefinition.hasAttachments layerDefinition.hasM layerDefinition.hasZ layerDefinition.supportsCalculate layerDefinition.supportsTruncate layerDefinition.supportsValidateSql layerDefinition.supportsCoordinatesQuantization layerDefinition.useStandardizedQueries layerDefinition.ownershipBasedAccessControlForFeatures layerDefinition.allowGeometryUpdates layerDefinition.supportsApplyEditsWithGlobalIds layerDefinition.supportsRollbackOnFailureParameter layerDefinition.allowUpdateWithoutMValues layerDefinition.supportsAttachmentsByUploadId".split(" ")),
d.reader("service","capabilities","advancedQueryCapabilities supportsStatistics supportsAdvancedQueries hasAttachments hasM hasZ supportsCalculate supportsTruncate supportsValidateSql supportsCoordinatesQuantization useStandardizedQueries ownershipBasedAccessControlForFeatures allowGeometryUpdates supportsApplyEditsWithGlobalIds supportsRollbackOnFailureParameter allowUpdateWithoutMValues supportsAttachmentsByUploadId capabilities".split(" "))],e.prototype,"readCapabilities",null),l([d.property({type:String,
json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),l([d.property({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),l([d.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],e.prototype,"definitionExpression",
void 0),l([d.property({readOnly:!0,json:{read:W.read}})],e.prototype,"defaultSymbol",void 0),l([d.property({readOnly:!0})],e.prototype,"editFieldsInfo",void 0),l([d.property({type:R,json:{origins:{service:{read:{source:"elevationInfo"},write:{target:"elevationInfo",enabled:!1}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],e.prototype,"elevationInfo",void 0),l([d.property({type:[P],json:{origins:{service:{read:!0}},read:{source:"layerDefinition.fields"}}})],
e.prototype,"fields",void 0),l([d.property({type:E,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],e.prototype,"fullExtent",void 0),l([d.property()],e.prototype,"gdbVersion",void 0),l([d.property({json:{origins:{service:{read:za.read}},read:{source:"layerDefinition.geometryType",reader:za.read}}})],e.prototype,"geometryType",void 0),l([d.property({readOnly:!0,dependsOn:["loaded"],json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasAttachments"}}})],
e.prototype,"hasAttachments",null),l([d.property({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],e.prototype,"hasM",void 0),l([d.property({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],e.prototype,"hasZ",void 0),l([d.property({readOnly:!0,type:J})],e.prototype,"heightModelInfo",void 0),l([d.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],e.prototype,"id",void 0),l([d.property({readOnly:!0})],
e.prototype,"isTable",void 0),l([d.reader("service","isTable",["type"]),d.reader("isTable",["layerDefinition.type"])],e.prototype,"readIsTable",null),l([d.property({dependsOn:["loaded","url","source"],readOnly:!0})],e.prototype,"hasService",null),l([d.property({type:Boolean,json:{read:{source:"showLabels"},write:{target:"showLabels"}}})],e.prototype,"labelsVisible",void 0),l([d.property({type:[ka],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:wa.reader},write:{target:"drawingInfo.labelingInfo",
enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:wa.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],e.prototype,"labelingInfo",void 0),l([d.property({type:Number,json:{origins:{service:{read:{source:"id"}}},read:!1}})],e.prototype,"layerId",void 0),l([d.property({type:Boolean,json:{read:{source:"showLegend"},write:{target:"showLegend"}}})],e.prototype,"legendEnabled",void 0),l([d.property({type:Number,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.maxRecordCount"}}})],
e.prototype,"maxRecordCount",void 0),l([d.property({type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}})],e.prototype,"minScale",void 0),l([d.reader("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),l([d.property({type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}})],e.prototype,"maxScale",
void 0),l([d.reader("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),l([d.property({type:String})],e.prototype,"objectIdField",void 0),l([d.reader("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),d.reader("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),l([d.property()],e.prototype,"operationalLayerType",void 0),l([d.property({dependsOn:["requiredFields"]})],e.prototype,"outFields",
null),l([d.property({readOnly:!0,dependsOn:["layerId"]})],e.prototype,"parsedUrl",null),l([d.property({type:Boolean,json:{write:{target:"disablePopup"}}})],e.prototype,"popupEnabled",void 0),l([d.reader("popupEnabled",["disablePopup"])],e.prototype,"readPopupEnabled",null),l([d.writer("popupEnabled")],e.prototype,"writePopupEnabled",null),l([d.property({type:a,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],e.prototype,"popupTemplate",void 0),l([d.property({type:fa})],e.prototype,"processing",
void 0),l([d.property({readOnly:!0})],e.prototype,"relationships",void 0),l([d.property({types:z.types,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}}},write:{target:"layerDefinition.drawingInfo.renderer"}}})],e.prototype,"renderer",null),l([d.reader("service","renderer",["drawingInfo.renderer","defaultSymbol","type"]),d.reader("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol","layerDefinition.type"])],e.prototype,"readRenderer",null),l([d.property({readOnly:!0,
dependsOn:["allRenderers","labelingInfo","elevationInfo.featureExpressionInfo","popupTemplate.requiredFields"]})],e.prototype,"requiredFields",null),l([d.property({type:Boolean})],e.prototype,"returnM",void 0),l([d.property({type:Boolean})],e.prototype,"returnZ",void 0),l([d.property(sa.screenSizePerspectiveEnabled)],e.prototype,"screenSizePerspectiveEnabled",void 0),l([d.property()],e.prototype,"source",null),l([d.cast("source")],e.prototype,"castSource",null),l([d.reader("portal-item","source",
["featureSet"]),d.reader("web-map","source",["featureSet"])],e.prototype,"readSource",null),l([d.property({readOnly:!0,json:{origins:{service:{read:{source:"definitionExpression"}}}}})],e.prototype,"serviceDefinitionExpression",void 0),l([d.property({type:G,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],e.prototype,"spatialReference",void 0),l([d.property({type:[ga]})],e.prototype,"templates",void 0),l([d.reader("templates",
["editFieldsInfo","creatorField","editorField","templates"])],e.prototype,"readTemplates",null),l([d.property()],e.prototype,"timeInfo",void 0),l([d.property()],e.prototype,"title",void 0),l([d.reader("service","title",["name"]),d.reader("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],e.prototype,"readTitle",null),l([d.reader("web-map","title",["layerDefinition.name","title"])],e.prototype,"readTitleFromWebMap",null),l([d.property({type:String})],e.prototype,"sublayerTitleMode",
void 0),l([d.property({type:String,readOnly:!0,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),l([d.property({json:{read:!1}})],e.prototype,"type",void 0),l([d.property({type:String,readOnly:!0})],e.prototype,"typeIdField",void 0),l([d.reader("service","typeIdField"),d.reader("typeIdField",["layerDefinition.typeIdField"])],e.prototype,"readTypeIdField",null),l([d.property({type:[ia]})],e.prototype,"types",void 0),l([d.reader("service","types",["types"]),d.reader("types",
["layerDefinition.types"])],e.prototype,"readTypes",null),l([d.property({type:String})],e.prototype,"url",null),l([d.writer("url")],e.prototype,"writeUrl",null),l([d.property({readOnly:!0})],e.prototype,"userIsAdmin",void 0),l([d.property({json:{origins:{"portal-item":{read:!1}}}})],e.prototype,"version",void 0),l([d.reader("service","version","currentVersion capabilities drawingInfo hasAttachments htmlPopupType relationships timeInfo typeIdField types".split(" ")),d.reader("version","layerDefinition.currentVersion layerDefinition.capabilities layerDefinition.drawingInfo layerDefinition.hasAttachments layerDefinition.htmlPopupType layerDefinition.typeIdField layerDefinition.types".split(" "))],
e.prototype,"readVersion",null),l([d.property({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],e.prototype,"visible",void 0),l([d.reader("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],e.prototype,"readVisible",null),l([h(0,d.cast(O))],e.prototype,"queryFeatures",null),l([h(0,d.cast(O))],e.prototype,"queryObjectIds",null),l([h(0,d.cast(O))],e.prototype,"queryFeatureCount",null),l([h(0,d.cast(O))],e.prototype,"queryExtent",
null),e=l([d.subclass("esri.layers.FeatureLayer")],e)}(d.declared(g,e,f,n,x,I,c))})},"esri/renderers/SimpleRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ../core/lang ../symbols/support/jsonUtils ../symbols/support/typeUtils ./Renderer".split(" "),function(A,p,w,l,h,d,u,r,a){return function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;return c.description=null,c.label=null,c.symbol=
null,c.type="simple",c}return w(c,a),k=c,c.prototype.writeSymbolWebScene=function(a,c,d,h){u.writeTarget(a,c,d,h)},c.prototype.writeSymbol=function(a,c,d,h){u.writeTarget(a,c,d,h)},c.prototype.readSymbol=function(a,c,d){return u.read(a,c,d)},c.prototype.getSymbol=function(a,c){return this.symbol},c.prototype.getSymbols=function(){return this.symbol?[this.symbol]:[]},c.prototype.clone=function(){return new k({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:d.clone(this.visualVariables),
authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})},l([h.property({type:String,json:{write:!0}})],c.prototype,"description",void 0),l([h.property({type:String,json:{write:!0}})],c.prototype,"label",void 0),l([h.property({types:r.types})],c.prototype,"symbol",void 0),l([h.writer("web-scene","symbol",{symbol:{types:r.types3D}})],c.prototype,"writeSymbolWebScene",null),l([h.writer("symbol")],c.prototype,"writeSymbol",null),l([h.reader("symbol")],c.prototype,"readSymbol",null),c=k=l([h.subclass("esri.renderers.SimpleRenderer")],
c);var k}(h.declared(a))})},"esri/renderers/support/jsonUtils":function(){define(["../../core/Warning","../SimpleRenderer","../UniqueValueRenderer","../ClassBreaksRenderer"],function(A,p,w,l){var h={simple:p,uniqueValue:w,classBreaks:l},d={fromJson:function(h){try{throw Error("fromJson is deprecated, use fromJSON instead");}catch(r){console.warn(r.stack)}return d.fromJSON(h)},read:function(d,l,a){return d&&(d.styleName||d.styleUrl)&&"uniqueValue"!==d.type?(a&&a.messages&&a.messages.push(new A("renderer:unsupported",
"Only UniqueValueRenderer can be referenced from a web style, but found '"+d.type+"'",{definition:d,context:a})),null):(l=d?h[d.type]||null:null)?(l=new l,l.read(d,a),l):(a&&a.messages&&d&&a.messages.push(new A("renderer:unsupported","Renderers of type '"+(d.type||"unknown")+"' are not supported",{definition:d,context:a})),null)},fromJSON:function(d){var l=d?h[d.type]||null:null;return l?l.fromJSON(d):null}};return d})},"esri/renderers/ClassBreaksRenderer":function(){define("../core/declare ../core/lang ../core/kebabDictionary ../core/Error ../core/Logger ../core/accessorSupport/ensureType dojo/_base/lang ../support/arcadeUtils ../symbols/Symbol ../symbols/PolygonSymbol3D ../symbols/support/jsonUtils ../symbols/support/typeUtils ./Renderer ./support/LegendOptions ./support/ClassBreakInfo".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v){var y=h.getLogger("esri.renderers.ClassBreaksRenderer");q=q.LegendOptions;v=v.ClassBreakInfo;var B=w({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"}),D=w({esriClassifyNaturalBreaks:"natural-breaks",esriClassifyEqualInterval:"equal-interval",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyGeometricalInterval:"geometrical-interval"}),b=d.ensureType(v),m=A(C,
{declaredClass:"esri.renderers.ClassBreaksRenderer",properties:{backgroundFillSymbol:{types:{base:a,key:"type",typeMap:{"simple-fill":t.types.typeMap["simple-fill"],"picture-fill":t.types.typeMap["picture-fill"],"polygon-3d":t.types.typeMap["polygon-3d"]}},value:null,json:{origins:{"web-scene":{read:c.read,write:{target:{backgroundFillSymbol:{type:k}},writer:c.writeTarget}}},read:c.read,write:c.writeTarget}},classBreakInfos:{type:[v],json:{read:function(a,b,c){if(Array.isArray(a)){var d=b.minValue;
return a.map(function(a){var b=new v;return b.read(a,c),null==b.minValue&&(b.minValue=d),null==b.maxValue&&(b.maxValue=b.minValue),d=b.maxValue,b})}},write:function(a,b,c,d){a=a.map(function(a){return a.write({},d)});this._areClassBreaksConsecutive()&&a.forEach(function(a){delete a.classMinValue});b[c]=a}}},minValue:{type:Number,readOnly:!0,dependsOn:["classBreakInfos"],get:function(){return this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0},json:{read:!1,write:{overridePolicy:function(){return 0!==
this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}},classificationMethod:{type:String,value:null,json:{read:D.fromJSON,write:function(a,b){(a=D.toJSON(a))&&(b.classificationMethod=a)}}},defaultLabel:{type:String,value:null,json:{write:!0}},defaultSymbol:{types:t.types,value:null,json:{origins:{"web-scene":{read:c.read,write:{target:{defaultSymbol:{types:t.types3D}},writer:c.writeTarget}}},read:c.read,write:c.writeTarget}},valueExpression:{type:String,value:null,
json:{write:!0}},valueExpressionTitle:{type:String,value:null,json:{write:!0}},compiledFunc:{dependsOn:["valueExpression"],get:function(){return r.createFunction(this.valueExpression)}},legendOptions:{type:q,value:null,json:{write:!0}},field:{value:null,cast:function(a){return null==a?a:"function"==typeof a?a:d.ensureString(a)},json:{type:String,write:function(a,b,c,d){"string"==typeof a?b[c]=a:d&&d.messages?d.messages.push(new l("property:unsupported","ClassBreaksRenderer.field set to a function cannot be written to JSON")):
y.error(".field: cannot write field to JSON since it's not a string value")}}},isMaxInclusive:!0,normalizationField:{type:String,value:null,json:{write:!0}},normalizationTotal:{type:Number,value:null,json:{write:!0}},normalizationType:{type:String,value:null,dependsOn:["normalizationField","normalizationTotal"],get:function(){var a=this._get("normalizationType"),b=!!this.normalizationField,c=null!=this.normalizationTotal;return b||c?(a=b&&"field"||c&&"percent-of-total",b&&c&&console.warn("warning: both normalizationField and normalizationTotal are set!")):
("field"===a||"percent-of-total"===a)&&(a=null),a},json:{read:B.fromJSON,write:function(a,b){(a=B.toJSON(a))&&(b.normalizationType=a)}}},requiredFields:{dependsOn:["field","normalizationField","valueExpression"]},type:{value:"class-breaks",json:{write:function(a,b){b.type="classBreaks"}}}},constructor:function(){this.classBreakInfos=[]},addClassBreakInfo:function(a,c,d){a="number"==typeof a?new v({minValue:a,maxValue:c,symbol:d}):b(p.clone(a));this.classBreakInfos.push(a);1===this.classBreakInfos.length&&
this.notifyChange("minValue")},removeClassBreakInfo:function(a,b){var c,d,h=this.classBreakInfos.length;for(d=0;h>d;d++)if(c=[this.classBreakInfos[d].minValue,this.classBreakInfos[d].maxValue],c[0]==a&&c[1]==b){this.classBreakInfos.splice(d,1);break}},getBreakIndex:function(a,b){var c,d,h=this.field;c=a.attributes;var k=this.classBreakInfos.length,l=this.isMaxInclusive;if(this.valueExpression)a=r.executeFunction(this.compiledFunc,r.createExecContext(a,r.getViewInfo(b)));else if(u.isFunction(h))a=
h(a);else if(a=parseFloat(c[h]),h=this.normalizationType)if(b=parseFloat(this.normalizationTotal),c=parseFloat(c[this.normalizationField]),"log"===h)a=Math.log(a)*Math.LOG10E;else if("percent-of-total"!==h||isNaN(b)){if("field"===h&&!isNaN(c)){if(isNaN(a)||isNaN(c))return-1;a/=c}}else a=a/b*100;if(null!=a&&!isNaN(a)&&"number"==typeof a)for(c=0;k>c;c++)if(d=[this.classBreakInfos[c].minValue,this.classBreakInfos[c].maxValue],d[0]<=a&&(l?a<=d[1]:a<d[1]))return c;return-1},getClassBreakInfo:function(a,
b){a=this.getBreakIndex(a,b);return-1!==a?this.classBreakInfos[a]:null},getSymbol:function(a,b){a=this.getBreakIndex(a,b);return-1<a?this.classBreakInfos[a].symbol:this.defaultSymbol},getSymbols:function(){var a=[];return this.classBreakInfos.forEach(function(b){b.symbol&&a.push(b.symbol)}),this.defaultSymbol&&a.push(this.defaultSymbol),a},clone:function(){return new m({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),classificationMethod:this.classificationMethod,
defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:p.clone(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:p.clone(this.visualVariables),legendOptions:p.clone(this.legendOptions),authoringInfo:this.authoringInfo&&
this.authoringInfo.clone()})},collectRequiredFields:function(a){this.inherited(arguments);[this.field,this.normalizationField].forEach(function(b){b&&(a[b]=!0)});this.valueExpression&&r.extractFieldNames(this.valueExpression).forEach(function(b){a[b]=!0})},_areClassBreaksConsecutive:function(){for(var a=this.classBreakInfos,b=1;b<a.length;b++)if(a[b-1].maxValue!==a[b].minValue)return!1;return!0}});return m})},"esri/renderers/support/ClassBreakInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/JSONSupport ../../symbols/support/typeUtils ../../symbols/support/jsonUtils".split(" "),
function(A,p,w,l,h,d,u,r){Object.defineProperty(p,"__esModule",{value:!0});A=function(a){function d(){var c=null!==a&&a.apply(this,arguments)||this;return c.description=null,c.label=null,c.minValue=null,c.maxValue=0,c.symbol=null,c}return w(d,a),c=d,d.prototype.clone=function(){return new c({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})},l([h.property({type:String,json:{write:!0}})],d.prototype,"description",
void 0),l([h.property({type:String,json:{write:!0}})],d.prototype,"label",void 0),l([h.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],d.prototype,"minValue",void 0),l([h.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],d.prototype,"maxValue",void 0),l([h.property({types:u.types,json:{origins:{"web-scene":{read:r.read,write:{target:{symbol:{types:u.types3D}},writer:r.writeTarget}}},read:r.read,write:r.writeTarget}})],
d.prototype,"symbol",void 0),d=c=l([h.subclass("esri.renderers.support.ClassBreakInfo")],d);var c}(h.declared(d));p.ClassBreakInfo=A;p["default"]=A})},"esri/renderers/support/typeUtils":function(){define("require exports ../Renderer ../SimpleRenderer ../UniqueValueRenderer ../ClassBreaksRenderer".split(" "),function(A,p,w,l,h,d){Object.defineProperty(p,"__esModule",{value:!0});p.types={key:"type",base:w,typeMap:{simple:l,"unique-value":h,"class-breaks":d}}})},"esri/layers/graphics/sources/MemorySource":function(){define("../../../core/Collection ../../../core/Promise ../../../core/promiseUtils ../../../core/Error ../../../tasks/support/FeatureSet ../../../Graphic ../QueryEngine".split(" "),
function(A,p,w,l,h,d,u){return A.ofType(d).createSubclass([p],{properties:{layer:{value:null},_queryEngine:{value:null,dependsOn:["layer.loaded"],get:function(){return this.get("layer.loaded")?new u({features:this,objectIdField:this.layer.objectIdField}):null}}},queryFeatures:function(d){return this._queryEngine?this._queryEngine.queryFeatures(d).then(function(a){var d=new h;return d.features=a,d}):this._rejectQuery("Not ready to execute query")},queryObjectIds:function(d){return this._queryEngine?
this._queryEngine.queryObjectIds(d):this._rejectQuery("Not ready to execute query")},queryFeatureCount:function(d){return this._queryEngine?this._queryEngine.queryFeatureCount(d):this._rejectQuery("Not ready to execute query")},queryExtent:function(d){return this._queryEngine?this._queryEngine.queryExtent(d):this._rejectQuery("Not ready to execute query")},_rejectQuery:function(d){return w.reject(new l("MemorySource",d))}})})},"esri/layers/graphics/QueryEngine":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor ../../core/Error ../../core/promiseUtils ../../geometry/support/graphicsUtils".split(" "),
function(A,p,w,l,h,d,u,r,a){return function(d){function c(){var a=null!==d&&d.apply(this,arguments)||this;return a.features=null,a.objectIdField=null,a}return w(c,d),c.prototype.queryFeatures=function(a){if(this.features)if(a)if(this._isSupportedQuery(a)){var c=this._createFilters(a);a=c.length?this._executeQuery(a,c):this._rejectQuery("Invalid query")}else a=this._rejectQuery("Unsupported query");else a=this._returnAllFeatures();else a=this._rejectQuery("Engine not initialized");return a},c.prototype.queryObjectIds=
function(a){return this.objectIdField?this.queryFeatures(a).then(this._getObjectIds.bind(this)):this._rejectQuery("Unsupported query")},c.prototype.queryFeatureCount=function(a){return this.queryFeatures(a).then(function(a){return a.length})},c.prototype.queryExtent=function(a){var c=this;return this.queryFeatures(a).then(function(a){return{count:a.length,extent:c._getExtent(a)}})},c.prototype._returnAllFeatures=function(){return r.resolve(this.features.toArray())},c.prototype._executeQuery=function(a,
c){var d=this,h=this.features.filter(function(h){return c.every(function(c){return c.call(d,h,a)})});return r.resolve(h.toArray())},c.prototype._isSupportedQuery=function(a){var c=!0;return(null!=a.distance||null!=a.geometryPrecision||a.groupByFieldsForStatistics&&a.groupByFieldsForStatistics.length||null!=a.maxAllowableOffset||a.multipatchOption||null!=a.num||a.orderByFields&&a.orderByFields.length||a.outFields&&a.outFields.length||a.outSpatialReference||a.outStatistics&&a.outStatistics.length||
a.pixelSize||a.quantizationParameters||a.relationParameter||a.returnDistinctValues||null!=a.start||a.text||a.timeExtent||a.where||a.objectIds&&a.objectIds.length&&!this.objectIdField)&&(c=!1),c},c.prototype._createFilters=function(a){var c=[];return a.objectIds&&a.objectIds.length&&c.push(this._createObjectIdFilter()),a.geometry&&"extent"===a.geometry.type&&"intersects"===a.spatialRelationship&&c.push(this._createExtentFilter()),c},c.prototype._createExtentFilter=function(){return function(a,c){a=
a.geometry;c=c.geometry;return a&&c.intersects(a)}},c.prototype._createObjectIdFilter=function(){var a=this;return function(c,d){c=c.attributes;return-1<d.objectIds.indexOf(c&&c[a.objectIdField])}},c.prototype._rejectQuery=function(a){return r.reject(new u(this.declaredClass,a))},c.prototype._getObjectIds=function(a){var c=this.objectIdField,d=[];return a.forEach(function(a){a=(a=a.attributes)&&a[c];null!=a&&d.push(a)}),d},c.prototype._getExtent=function(c){return c.length?a.graphicsExtent(c):null},
l([h.property()],c.prototype,"features",void 0),l([h.property()],c.prototype,"objectIdField",void 0),c=l([h.subclass("esri.layers.graphics.QueryEngine")],c)}(h.declared(d))})},"esri/layers/support/FeatureProcessing":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor ../../core/lang ../../layers/support/Field".split(" "),function(A,p,w,l,h,d,u,r){return function(a){function d(){return null!==
a&&a.apply(this,arguments)||this}return w(d,a),c=d,d.fromWorker=function(a){if(!a)return null;var d=new c;return d.fields=a.fields&&a.fields.map(function(a){return r.fromJSON(a)}),d.options=a.options,d.process=new (Function.bind.apply(Function,[void 0].concat(a.process.args,[a.process.body]))),d},d.prototype.clone=function(){return new c(u.clone({fields:this.fields,options:this.options,process:this.process}))},d.prototype.toWorker=function(){var a=this.process.toString();return{fields:this.fields,
options:this.options,process:{body:a.substring(a.indexOf("{")+1,a.lastIndexOf("}")),args:a.slice(a.indexOf("(")+1,a.indexOf(")")).match(/([^\s,]+)/g)}}},l([h.property({type:[r]})],d.prototype,"fields",void 0),l([h.property()],d.prototype,"options",void 0),l([h.property()],d.prototype,"process",void 0),d=c=l([h.subclass("esri.layers.support.FeatureProcessing")],d);var c}(h.declared(d))})},"esri/layers/support/FeatureTemplate":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/JSONSupport ../../core/kebabDictionary ../../core/lang".split(" "),
function(A,p,w,l,h,d,u,r){var a=u({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",
esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});return function(d){function c(a){a=d.call(this,a)||this;return a.name=null,a.description=null,a.drawingTool=null,a.prototype=null,a.thumbnail=null,a}return w(c,d),c.prototype.writeDrawingTool=function(c,d){d.drawingTool=a.toJSON(c)},c.prototype.writePrototype=function(a,c){c.prototype=r.fixJson(r.clone(a),!0)},c.prototype.writeThumbnail=function(a,c){c.thumbnail=r.fixJson(r.clone(a))},l([h.property({json:{write:!0}})],
c.prototype,"name",void 0),l([h.property({json:{write:!0}})],c.prototype,"description",void 0),l([h.property({json:{read:a.fromJSON,write:!0}})],c.prototype,"drawingTool",void 0),l([h.writer("drawingTool")],c.prototype,"writeDrawingTool",null),l([h.property({json:{write:!0}})],c.prototype,"prototype",void 0),l([h.writer("prototype")],c.prototype,"writePrototype",null),l([h.property({json:{write:!0}})],c.prototype,"thumbnail",void 0),l([h.writer("thumbnail")],c.prototype,"writeThumbnail",null),c=l([h.subclass("esri.layers.support.FeatureTemplate")],
c)}(h.declared(d))})},"esri/layers/support/FeatureType":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/JSONSupport ./domains ./FeatureTemplate ../../core/lang".split(" "),function(A,p,w,l,h,d,u,r,a){return function(d){function c(a){a=d.call(this,a)||this;return a.id=null,a.name=null,a.domains=null,a.templates=null,a}return w(c,d),c.prototype.readDomains=function(a){var c={},d;for(d in a)if(a.hasOwnProperty(d)){var h=
a[d];switch(h.type){case "range":c[d]=u.RangeDomain.fromJSON(h);break;case "codedValue":c[d]=u.CodedValueDomain.fromJSON(h);break;case "inherited":c[d]=u.InheritedDomain.fromJSON(h)}}return c},c.prototype.writeDomains=function(c,d){var h={},k;for(k in c)c.hasOwnProperty(k)&&(h[k]=c[k]&&c[k].toJSON());a.fixJson(h);d.domains=h},c.prototype.readTemplates=function(a){return a&&a.map(function(a){return new r(a)})},c.prototype.writeTemplates=function(a,c){c.templates=a&&a.map(function(a){return a.toJSON()})},
l([h.property({json:{write:!0}})],c.prototype,"id",void 0),l([h.property({json:{write:!0}})],c.prototype,"name",void 0),l([h.property({json:{write:!0}})],c.prototype,"domains",void 0),l([h.reader("domains")],c.prototype,"readDomains",null),l([h.writer("domains")],c.prototype,"writeDomains",null),l([h.property({json:{write:!0}})],c.prototype,"templates",void 0),l([h.reader("templates")],c.prototype,"readTemplates",null),l([h.writer("templates")],c.prototype,"writeTemplates",null),c=l([h.subclass("esri.layers.support.FeatureType")],
c)}(h.declared(d))})},"esri/layers/support/FeatureReduction":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/JSONSupport".split(" "),function(A,p,w,l,h,d){Object.defineProperty(p,"__esModule",{value:!0});A=function(d){function r(){var a=null!==d&&d.apply(this,arguments)||this;return a.type=null,a}return w(r,d),l([h.property({type:String,readOnly:!0,json:{read:!1,write:!0}})],r.prototype,
"type",void 0),r=l([h.subclass("esri.layers.support.FeatureReduction")],r)}(h.declared(d));p.FeatureReduction=A;A=function(d){function r(){var a=null!==d&&d.apply(this,arguments)||this;return a.type="selection",a}return w(r,d),l([h.property()],r.prototype,"type",void 0),r=l([h.subclass("esri.layers.support.FeatureReductionSelection")],r)}(h.declared(A));p.FeatureReductionSelection=A})},"esri/layers/support/LabelClass":function(){define("../../core/date ../../core/JSONSupport ../../core/lang ../../core/kebabDictionary dojo/_base/lang dojo/number ./types ../../support/arcadeUtils ../../symbols/support/jsonUtils ../../symbols/support/typeUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k){function c(a){a=(a=r.createSyntaxTree(a))&&a.body&&a.body[0]&&a.body[0].body&&a.body[0].body.body;if(!a||1!==a.length)return null;a="ExpressionStatement"===a[0].type&&a[0].expression;if(!a||"MemberExpression"!==a.type)return null;var b=a.object;if(!b||"Identifier"!==b.type||"$feature"!==b.name)return null;a=a.property;if(!a)return null;switch(a.type){case "Literal":return a.value;case "Identifier":return a.name}return null}function t(a){return a?"service"===a.origin?
!1:!a.layer||!u.isOfType(a.layer,"map-image"):!0}var C=/__begin__/ig,q=/__end__/ig,v=/^__begin__/i,y=/__end__$/i,B=l({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",
esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",
esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"}),D=p.createSubclass({declaredClass:"esri.layers.support.LabelClass",properties:{name:{type:String,value:null,json:{write:!0}},labelExpression:{type:String,value:null,json:{read:function(a,b,
c,d){b=b.labelExpressionInfo;if(!b||!b.value&&!b.expression)return a},write:{allowNull:!0,writer:function(a,b,d,h){this.labelExpressionInfo&&t(h)&&(null!=this.labelExpressionInfo.value?a=this._templateStringToSql(this.labelExpressionInfo.value):null!=this.labelExpressionInfo.expression&&(h=c(this.labelExpressionInfo.expression))&&(a="["+h+"]"));null!=a&&(b[d]=a)}}}},labelExpressionInfo:{value:null,json:{read:function(a,b,c,d){return a&&a.value&&(a=h.mixin(h.clone(a),{expression:this._convertTemplatedStringToArcade(a.value)}),
delete a.value),a},write:{target:{"labelExpressionInfo.expression":{type:String}},overridePolicy:function(a,b,c){return t(c)?{allowNull:!0}:{enabled:!1}},writer:function(a,b,c,d){if(null==a&&null!=this.labelExpression&&t(d))a={expression:this.getLabelExpressionArcade()};else{if(!a)return;a=w.fixJson(h.clone(a))}null!=a.value&&(a.expression=this._convertTemplatedStringToArcade(a.value));a.expression&&(delete a.value,b[c]=a)}}}},labelPlacement:{type:String,value:null,json:{read:function(a,b){return B.fromJSON(a)},
write:function(a,b){(a=B.toJSON(a))&&(b.labelPlacement=a)}}},maxScale:{type:Number,value:0,json:{write:function(a,b){(a||this.minScale)&&(b.maxScale=a)}}},minScale:{type:Number,value:0,json:{write:function(a,b){(a||this.maxScale)&&(b.minScale=a)}}},requiredFields:{readOnly:!0,dependsOn:["labelExpression","labelExpressionInfo","where"],get:function(){var a=Object.create(null);return this._collectRequiredFields(a),Object.keys(a)}},symbol:{value:null,types:k.types,json:{origins:{"web-scene":{read:a.read,
write:{target:{symbol:{types:k.types3D}},writer:a.writeTarget}}},read:a.read,write:a.writeTarget}},useCodedValues:{type:Boolean,value:null,json:{write:!0}},where:{type:String,value:null,json:{write:!0}}},getLabelExpression:function(){var a={expression:"",type:"none"};return this.labelExpressionInfo?this.labelExpressionInfo.value?(a.expression=this.labelExpressionInfo.value,a.type="conventional"):this.labelExpressionInfo.expression&&(a.expression=this.labelExpressionInfo.expression,a.type="arcade"):
null!=this.labelExpression&&(a.expression=this._sqlToTemplateString(this.labelExpression),a.type="conventional"),a},getLabelExpressionArcade:function(){var a=this.getLabelExpression();if(!a)return null;switch(a.type){case "conventional":return this._convertTemplatedStringToArcade(a.expression);case "arcade":return a.expression}return null},getOptions:function(){var a={},b=this.labelExpressionInfo;if(b){var c=b.expression;c&&!b.value&&(a.hasArcadeExpression=!0,a.compiledArcadeFunc=r.createFunction(c))}return a},
getLabelExpressionSingleField:function(){var a=this.getLabelExpression();if(!a)return null;switch(a.type){case "conventional":return(a=a.expression.match(b))&&a[1].trim()||null;case "arcade":return c(a.expression)}return null},clone:function(){return new D({labelExpression:this.labelExpression,labelExpressionInfo:h.clone(this.labelExpressionInfo),labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,symbol:this.symbol.clone(),where:this.where,useCodedValues:this.useCodedValues})},
_collectRequiredFields:function(a){this._collectLabelExpressionRequiredFields(this.getLabelExpression(),a);this._collectWhereRequiredFields(this.where,a)},_sqlToTemplateString:function(a){return a.replace(/\[/g,"{").replace(/\]/g,"}")},_templateStringToSql:function(a){return a.replace(/\{/g,"[").replace(/\}/g,"]")},_collectWhereRequiredFields:function(a,b){null!=a&&(a=a.split(" "),3===a.length&&(b[a[0]]=!0),7===a.length&&(b[a[0]]=!0,b[a[4]]=!0))},_collectLabelExpressionRequiredFields:function(a,b){"arcade"===
a.type?r.extractFieldNames(a.expression).forEach(function(a){b[a]=!0}):(a=a.expression.match(/{[^}]*}/g))&&a.forEach(function(a){b[a.slice(1,-1)]=!0})},_convertTemplatedStringToArcade:function(a){var b;return a?(b=h.replace(a,function(a,b){return'__begin__$feature["'+b+'"]__end__'}),b=v.test(b)?b.replace(v,""):'"'+b,b=y.test(b)?b.replace(y,""):b+'"',b=b.replace(C,'" + ').replace(q,' + "')):b='""',b}});D.evaluateWhere=function(a,b){var c=function(a,b,c){switch(b){case "\x3d":return a==c?!0:!1;case "\x3c\x3e":return a!=
c?!0:!1;case "\x3e":return a>c?!0:!1;case "\x3e\x3d":return a>=c?!0:!1;case "\x3c":return c>a?!0:!1;case "\x3c\x3d":return c>=a?!0:!1}return!1};try{if(null==a)return!0;var d=a.split(" ");if(3===d.length)return c(b[d[0]],d[1],d[2]);if(7===d.length){var h=c(b[d[0]],d[1],d[2]),k=d[3],l=c(b[d[4]],d[5],d[6]);switch(k){case "AND":return h&&l;case "OR":return h||l}}return!1}catch(N){console.log("Error.: can't parse \x3d "+a)}};D.buildLabelText=function(a,b,c,d){var h="";if(d&&d.hasArcadeExpression)d.compiledArcadeFunc&&
(a=r.createExecContext(b),a=r.executeFunction(d.compiledArcadeFunc,a),null!=a&&(h=a.toString()));else var k=b&&b.attributes||{},h=a.replace(/{[^}]*}/g,function(a){return D.formatField(a.slice(1,-1),a,k,c,d)});return h};D.formatField=function(a,b,c,k,l){var m=a.toLowerCase();for(a=0;a<k.length;a++)if(k[a].name.toLowerCase()===m){b=c[k[a].name];var q=k[a].domain;if(q&&h.isObject(q)){if("codedValue"==q.type)for(c=0;c<q.codedValues.length;c++)q.codedValues[c].code==b&&(b=q.codedValues[c].name);else"range"==
q.type&&q.minValue<=b&&b<=q.maxValue&&(b=q.name);break}q=k[a].type;"date"==q?(q=A.fromJSON(l&&l.dateFormat||"shortDate"),(q="DateFormat"+A.getFormat(q))&&(b=w.substitute({myKey:b},"{myKey:"+q+"}"))):("integer"==q||"small-integer"==q||"long"==q||"double"==q)&&l&&l.numberFormat&&l.numberFormat.digitSeparator&&l.numberFormat.places&&(b=d.format(b,{places:l.numberFormat.places}))}return null==b?"":b};var b=/^\s*\{([^}]+)\}\s*$/i;return D})},"esri/layers/support/types":function(){define(["require","exports"],
function(A,p){Object.defineProperty(p,"__esModule",{value:!0});p.isOfType=function(p,l){p=p.constructor._meta;if(!p||!p.bases)return!1;p=p.bases;var h=Array.isArray(l);return p.some(function(d){d=d.__accessorMetadata__;if(!d)return!1;d=d.properties;if(!d||!d.type||!d.type.value)return!1;d=d.type.value;return h?-1!==l.indexOf(d):d===l})}})},"esri/layers/support/labelingInfo":function(){define(["require","exports","./LabelClass"],function(A,p,w){Object.defineProperty(p,"__esModule",{value:!0});var l=
/\[([^\[\]]+)\]/gi;p.reader=function(h,d,p){var r=this;return h?h.map(function(a){var h=new w;if(h.read(a,p),h.labelExpression){var c=d.fields||d.layerDefinition&&d.layerDefinition.fields||r.fields;h.labelExpression=h.labelExpression.replace(l,function(a,d){a:if(c){a=d.toLowerCase();for(var h=0;h<c.length;h++){var k=c[h].name;if(k.toLowerCase()===a){d=k;break a}}}return"["+d+"]"})}return h}):null}})},"esri/layers/support/commonProperties":function(){define(["require","exports","../../core/accessorSupport/write",
"../../core/accessorSupport/utils","../../core/accessorSupport/PropertyOrigin"],function(A,p,w,l,h){Object.defineProperty(p,"__esModule",{value:!0});p.screenSizePerspectiveEnabled={type:Boolean,value:!0,json:{origins:{"web-scene":{read:{source:["id","url","layerType"],reader:function(d,p){return null==p.screenSizePerspective&&"defaults"===this.originOf("screenSizePerspectiveEnabled")?void l.getProperties(this).store.set("screenSizePerspectiveEnabled",!1,h.OriginId.DEFAULTS):p.screenSizePerspective}},
write:{ignoreOrigin:!0,target:"screenSizePerspective",writer:function(d,h,l,a){"defaults"===this.originOf("screenSizePerspectiveEnabled")&&d?h[l]=d:w.willPropertyWrite(this,"screenSizePerspectiveEnabled",{},a)&&(h[l]=d)}}}}}}})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define(["require","exports","../../../../core/throttle","../../support/aaBoundingRect"],function(A,p,w,l){return function(){function h(){this.dirtyExtent=l.create(l.NEGATIVE_INFINITY);this.numPendingSpatialIndexQueries=
0;this.elevationDirtyGraphicsQueue=[];this.elevationDirtyGraphicsSet={};this.elevationUpdateEventHandle=null;this.eventHandles=[];this.updateElevation=!1;this.graphicsCore=this.layerView=null;this.markDirtyThrottled=w.throttle(this.markDirty,100,this)}return h.prototype.initialize=function(d,h,l,a){var k=this;this.layerView=d;this.graphicsCore=l;this.elevationProvider=a;this.getGraphicsInExtent=h;this.elevationUpdateEventHandle=a.on("elevation-change",function(a){return k.elevationUpdateHandler(a)});
this.eventHandles.push(this.layerView.watch("suspended",function(){return k.suspendedChange()}))},h.prototype.destroy=function(){this.elevationDirtyGraphicsSet=this.elevationDirtyGraphicsQueue=null;this.elevationUpdateEventHandle&&(this.elevationUpdateEventHandle.remove(),this.elevationUpdateEventHandle=null);this.eventHandles.forEach(function(d){return d.remove()});this.eventHandles=null;this.markDirtyThrottled.remove();this.getGraphicsInExtent=this.graphicsCore=this.layerView=null},h.prototype.clear=
function(){this.elevationDirtyGraphicsSet={};this.elevationDirtyGraphicsQueue=[]},h.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&this.markAllGraphicsElevationDirty()},h.prototype.isUpdating=function(){return 0<this.elevationDirtyGraphicsQueue.length||this.markDirtyThrottled.hasPendingUpdates()||0<this.numPendingSpatialIndexQueries},h.prototype.numNodesUpdating=function(){return this.elevationDirtyGraphicsQueue.length},
h.prototype.needsIdleUpdate=function(){return this.elevationProvider&&0<this.elevationDirtyGraphicsQueue.length},h.prototype.idleUpdate=function(d){if(!d.done()){var h=this.layerView.view,l=this.elevationDirtyGraphicsQueue.length;if(0<l){for(var a=this.graphicsCore.stageLayer.getId(),k=this.graphicsCore.labelStageLayer?this.graphicsCore.labelStageLayer.getId():null,c=0,p=0,p=0;l>p;p++){var w=this.elevationDirtyGraphicsQueue[p],q=this.graphicsCore.graphics[w];if(q&&q.alignWithElevation(this.elevationProvider,
h.renderCoordsHelper),delete this.elevationDirtyGraphicsSet[w],c++,20<=c){if(h._stage.processDirtyLayer(a),null!=k&&h._stage.processDirtyLayer(k),d.done())break;c=0}}h._stage.processDirtyLayer(a);null!=k&&h._stage.processDirtyLayer(k);this.elevationDirtyGraphicsQueue.splice(0,p+1);h.deconflictor.setDirty();this.layerView._evaluateUpdatingState()}}},h.prototype.markAllGraphicsElevationDirty=function(){for(var d in this.graphicsCore.graphics)this.markGraphicElevationDirty(this.graphicsCore.graphics[d].graphic.uid);
this.layerView._evaluateUpdatingState()},h.prototype.markGraphicElevationDirty=function(d){this.elevationDirtyGraphicsSet[d]||(this.elevationDirtyGraphicsSet[d]=!0,this.elevationDirtyGraphicsQueue.push(d))},h.prototype.elevationUpdateHandler=function(d){var h=d.extent;this.layerView.suspended?this.updateElevation||(d=this.graphicsCore.computedExtent)&&h[2]>d.xmin&&h[0]<d.xmax&&h[3]>d.ymin&&h[1]<d.ymax&&(this.updateElevation=!0):(l.expand(this.dirtyExtent,h),this.spatialReference=d.spatialReference,
this.markDirtyThrottled(),this.layerView._evaluateUpdatingState())},h.prototype.markDirty=function(){var d=this,h=this.dirtyExtent;h[0]===-(1/0)?this.markAllGraphicsElevationDirty():(this.numPendingSpatialIndexQueries++,this.getGraphicsInExtent(h,this.spatialReference,function(h,a){d.numPendingSpatialIndexQueries--;for(var k=0;a>k;k++){var c=h[k],l=d.graphicsCore.graphics[c];l&&l.needsElevationUpdates()&&d.markGraphicElevationDirty(c)}d.layerView._evaluateUpdatingState()}),this.layerView._evaluateUpdatingState());
l.set(this.dirtyExtent,l.NEGATIVE_INFINITY)},h}()})},"esri/views/ui/3d/DefaultUI3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../DefaultUI dojo/_base/lang".split(" "),function(A,p,w,l,h,d,u){return function(d){function a(){return d.call(this)||this}return w(a,d),a.prototype.getDefaults=function(){return u.mixin(this.inherited(arguments),{components:["attribution","zoom","navigation-toggle",
"compass"]})},a=l([h.subclass("esri.views.ui.3d.DefaultUI3D")],a)}(h.declared(d))})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/promise/all dojo/errors/CancelError dojo/has dojo/_base/lang ../../../views/3d/support/ResourceController ../../../core/sql/WhereClause ../../../views/3d/layers/SceneLayerView3D ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SIndexTraversal ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/layers/i3s/IdleQueue ../../../views/3d/layers/i3s/GoogPriorityQueue ../../../layers/SceneLayer ../../../layers/IntegratedMeshLayer ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../core/Evented ../../../core/Promise ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/HandleRegistry ../../../views/3d/support/PromiseLightweight ../../../views/3d/support/projectionUtils ../../../views/3d/lib/glMatrix".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E,J,G,K,M,U,N,W,R,V,Q){function S(a,b){b=b.toLowerCase();for(var c=0;c<a.length;c++)if(a[c].name.toLowerCase()===b)return c;return-1}var X=M.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");A=function(p){function g(a){a=p.call(this)||this;return a.nodeIndex={},a.screenSizeFactor=0,a.updating=!0,a.updatingPercentage=0,a._lodFactorProperty=null,a._isIdle=!1,a._alwaysLoadEverythingModeEnabled=!1,a._uncompressedTextureDownsamplingEnabled=
!1,a._computedMbs={},a._nodeQueue=null,a.maxQueueLevel=0,a._numNodesLoading=0,a._numAttributesLoading=0,a._progressMaxNumNodes=1,a._poi=null,a._requiredAttributesDirty=!0,a._updatesDisabled=!1,a.disableCache=!1,a._restartNodeLoading=!1,a._fields=null,a._attributeStorageInfo=null,a._handles=new W,a._idleQueue=new B.IdleQueue,a}return w(g,p),Object.defineProperty(g.prototype,"isMeshPyramid",{get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType},enumerable:!0,
configurable:!0}),Object.defineProperty(g.prototype,"streamDataSupplier",{get:function(){return this.layerView.view.resourceController.registerClient(this.layerView,a.ClientType.SCENE,{trackRequests:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"parsedDefinitionExpression",{get:function(){if(!(this.layer instanceof b&&this.layer.definitionExpression))return null;try{var a=k.create(this.layer.definitionExpression);if(!a.isStandardized())return X.error("definitionExpression is using non standard function"),
null;var c=[],d=a.getFields();return q.findFieldsCaseInsensitive(d,this.layer.fields,{missingFields:c}),0<c.length?(X.error("definitionExpression references unknown fields: "+c.join(", ")),null):a}catch(x){return X.error("Failed to parse definitionExpression: "+x),null}},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"definitionExpressionFields",{get:function(){if(this.parsedDefinitionExpression){var a=this.parsedDefinitionExpression.getFields();return q.findFieldsCaseInsensitive(a,
this._fields)}return null},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"crsVertex",{get:function(){return q.getVertexCrs(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"crsIndex",{get:function(){return q.getIndexCrs(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"rootNodeVisible",{get:function(){var a=this._rootNodeId&&this.nodeIndex[this._rootNodeId];return a&&this._viewportQueries?this._viewportQueries.isNodeVisible(a):
!0},enumerable:!0,configurable:!0}),g.prototype.initialize=function(){var a=this;this.updateEventListener={needsUpdate:function(){return a._needsAnimationFrameHandler()},idleFrame:function(b){return a._animationFrameHandler(b)},idleBegin:function(){a._startNodeLoading();a._updateIdleState(!0)},idleEnd:function(){a.cancelNodeLoading();a._updateIdleState(!1)}};this.updateEventListenerWhileSuspended={idleBegin:function(){return a._startNodeLoadingWhileSuspended()}};this._lodHandling=new v(this.layerViewRequiredFunctions,
this.layerViewOptionalFunctions,function(){return a._evaluateUpdatingState()});this.layerView._controller=this;var d=this.layer;this._defaultGeometrySchema=d.store.defaultGeometrySchema;this._rootNodeUrl=d.store.rootNode;var g=this._rootNodeUrl.split("/");this._rootNodeId=g[g.length-1];this.disableCache=u("disable-feature:idb-cache");d instanceof b?("mesh"===d.geometryType?this._lodFactorProperty="qualitySettings.sceneService.3dObject.lodFactor":"point"===d.geometryType&&(this._lodFactorProperty=
"qualitySettings.sceneService.point.lodFactor"),this._fields=d.fields,this._attributeStorageInfo=d.attributeStorageInfo):d instanceof m&&(this._lodFactorProperty="qualitySettings.sceneService.integratedMesh.lodFactor");d=h([this.layer.when(),this.layerView.when()]).then(function(){if(!a.destroyed&&a.layerView&&!a.layerView.destroyed){a.setClippingArea(a.layerView.view.clippingArea);var b=a.layerView.view.pointsOfInterest,e=function(){return a.restartNodeLoading()};a._centerOnSurface=b.centerOnSurfaceFrequent;
a._handles.add([a._centerOnSurface.watch("renderLocation",function(){return a._pointOfInterestChanged()}),b.events.on("camera-parameters-changed",e)],"view");var d=a.layerView.view.resourceController,f=!1;a._handles.add(N.init(a.layerView,"suspended",function(b){f&&d.deregisterIdleFrameWorker(a);b?d.registerIdleFrameWorker(a,a.updateEventListenerWhileSuspended):d.registerIdleFrameWorker(a,a.updateEventListener);f=!0}),"layerview");a._handles.add(a.layer.watch("elevationInfo",function(b){return a._elevationInfoChanged(b)}),
"layer");a.layerView instanceof c&&a._handles.add([N.init(a.layerView,"alwaysLoadEverythingModeEnabled",function(b){a._alwaysLoadEverythingModeEnabled=b;e()}),N.init(a.layerView,"uncompressedTextureDownsamplingEnabled",function(b){a._uncompressedTextureDownsamplingEnabled=b;e()})],"layer");a._lodFactorProperty&&a._handles.add(a.layerView.view.watch(a._lodFactorProperty,function(){return a._qualityChanged()}),"quality")}});this.addResolvingPromise(d)},g.prototype.destroy=function(){this.layerView.view.resourceController.deregisterIdleFrameWorker(this);
this.layerView.view.resourceController.deregisterClient(this.layerView);this._handles.destroy();this._nodeLoader=null},g.prototype._getRequiredAttributes=function(){if(!(null!=this._attributeStorageInfo&&this.layer instanceof b&&this._fields))return[];var a=Object.create(null);if(this.layer.renderer&&this.layer.renderer.collectRequiredFields(a),this.layer.labelsVisible&&this.layer.labelingInfo&&this.layer.labelingInfo.forEach(function(b){b._collectRequiredFields(a)}),null!=this.definitionExpressionFields)for(var c=
0,d=this.definitionExpressionFields;c<d.length;c++)a[d[c]]=!0;var g=this._attributeStorageInfo,h=this._fields,k=this.layer.objectIdField;return Object.keys(a).map(function(a){var b=S(g,a);a=S(h,a);return 0<=b&&0<=a?{index:b,name:h[a].name,field:h[a],attributeStorageInfo:g[b]}:null}).filter(function(a){return null!=a&&a.name!==k}).sort(function(a,b){return b.index-a.index}).filter(function(a,b,c){return 0===b||c[b-1].index!==a.index})},g.prototype._requiredFieldsChange=function(){this._requiredAttributesDirty=
!0;this.restartNodeLoading()},g.prototype._labelingChanged=function(){var a=this._requiredAttributes,b=this._getRequiredAttributes();a.length===b.length&&a.every(function(a){return 0<=S(b,a.name)})||this._requiredFieldsChange()},g.prototype.setClippingArea=function(a){var b=[];V.extentToBoundingBox(a,b,this.layerView.view.renderSpatialReference)?this._clippingArea=b:this._clippingArea=null},g.prototype._qualityChanged=function(){this.restartNodeLoading()},g.prototype._pointOfInterestChanged=function(){this._poi&&
(this._calculatePointOfInterest(this._poi),this._indexLoader&&(this._indexLoader.updatePointOfInterest(this._poi),this._indexLoader.progressiveLoadPenalty=z.distancePenalty*this._viewportQueries.distCameraToPOI(this._poi)))},g.prototype._calculatePointOfInterest=function(a){void 0===a&&(a=Q.vec3d.create());var b=Q.vec3d.create(),c=Q.vec3d.create(),e=this._centerOnSurface.renderLocation,d=this.layerView.view.renderCoordsHelper;Q.vec3d.subtract(e,this.camPos,b);Q.vec3d.normalize(b);d.worldUpAtPosition(e,
c);b=Math.acos(Q.vec3d.dot(c,b))-.5*Math.PI;return Q.vec3d.lerp(this.camPos,e,Math.max(0,Math.min(1,b/(.5*Math.PI))),a),a},g.prototype.updateClippingArea=function(a){this.setClippingArea(a);this.restartNodeLoading()},g.prototype.getBaseUrl=function(){return this.layer.parsedUrl.path},g.prototype.updateElevationChanged=function(a,b,c){q.findIntersectingNodes(a,b,this.nodeIndex.root,this.crsIndex,this.nodeIndex,c);for(a=0;a<c.length;a++)b=c.data[a],this._computedMbs[b.id]&&(this._computedMbs[b.id][3]=
-1),b.id===this._rootNodeId&&this.notifyChange("rootNodeVisible");c.length&&this.restartNodeLoading()},g.prototype._elevationInfoChanged=function(a){a=0;for(var b=Object.keys(this._computedMbs);a<b.length;a++)this._computedMbs[b[a]][3]=-1;this._initViewData()},g.prototype.restartNodeLoading=function(){this._restartNodeLoading=!0;this._evaluateUpdatingState()},g.prototype.schedule=function(a){return this._idleQueue.push(a)},g.prototype._needsAnimationFrameHandler=function(){return!0},g.prototype._animationFrameHandler=
function(a){if(this._restartNodeLoading&&(this.cancelNodeLoading(),this._startNodeLoading()),null!=this._nodeLoader){var b=this._indexLoader&&(this.maxQueueLevel>=this._indexLoader.getMaxLevel(0)||!this._indexLoader.isLoading());if(this._nodeQueue&&b)for(var c=this._indexLoader.isLoading()?3:5;this._numNodesLoading<c&&!this._nodeQueue.isEmpty();)this._loadNode(this._nodeQueue.dequeue());this._indexLoader&&(b=b?4:10,c=this._indexLoader.getNumLoading(),b=Math.min(b-c,4),0<b&&this._indexLoader.continueTraversal(b));
for(;0<this._idleQueue.length()&&!a.done();)this._idleQueue.process();this._evaluateUpdatingState();this._lodHandling.lodGlobalHandling()}},g.prototype._evaluateUpdatingState=function(){var a=this._indexLoader?this._indexLoader.getQueueSize():0,b=this._nodeQueue?this._nodeQueue.getCount():0,a=a+3*(b+this._numNodesLoading),b=!(!(0<a||0<this._numAttributesLoading||this._indexLoader&&this._indexLoader.isLoading()||this._restartNodeLoading||0<this._idleQueue.length()||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling)&&
this._isIdle);0===a&&(this._progressMaxNumNodes=1);this._progressMaxNumNodes=Math.max(a,this._progressMaxNumNodes);b!==this._get("updating")&&this._set("updating",b);a=100*a/this._progressMaxNumNodes;a!==this._get("updatingPercentage")&&this._set("updatingPercentage",a)},g.prototype._initViewData=function(){var a=this.layerView.view,b=a.state.camera,c=a.renderCoordsHelper;this.camPos=Q.vec3d.create(a.pointsOfInterest.renderPointOfView);this.screenSizeFactor=1/b.perPixelRatio;this._poi=this._calculatePointOfInterest();
var d=this._lodFactorProperty&&this.layerView.view.get(this._lodFactorProperty)||1;this._viewportQueries=new y(this._computedMbs,this.crsIndex,c,b,this._clippingArea,null!=this.layerViewOptionalFunctions.traversalOptions?this.layerViewOptionalFunctions.traversalOptions.errorMetricPreference:null,a.elevationProvider,this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(this.layer,d),screenspaceErrorBias:d,angleDependentLoD:.5>d,disableLod:this._alwaysLoadEverythingModeEnabled});
this.notifyChange("rootNodeVisible")},g.prototype._getProgressiveLoadFactor=function(a,c){return a instanceof b&&"mesh"===a.geometryType?(a=1<=c&&u("enable-feature:progressive-3dobject"))?z.factor3dObject:1:a instanceof m?(a=1<=c&&!u("disable-feature:progressive-im"))?z.factorIM:1:1},g.prototype._startNodeLoadingWhileSuspended=function(){var a=this;(this._initViewData(),this._alwaysLoadEverythingModeEnabled&&this.layerView.visible&&!this.layerView.get("parent.suspended"))||this._removeInvisibleNodes(function(b){return a._viewportQueries.isNodeVisible(b)})},
g.prototype._startNodeLoading=function(){var a=this;if(this._restartNodeLoading=!1,!this._updatesDisabled&&null!=this.streamDataSupplier){this._initViewData();null!=this.layerViewOptionalFunctions.getLoadedAttributes&&this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1,this._handles.add([this.layer.watch("renderer",function(){return a._requiredFieldsChange()}),this.layer.watch("definitionExpression",function(){return a._requiredFieldsChange()}),
this.layer.watch("labelsVisible",function(){return a._labelingChanged()}),this.layer.watch("labelingInfo",function(){return a._labelingChanged()})],"requiredAttributes"));var b=this.layerViewOptionalFunctions.textureOptions,d=t.TextureFormat.Normal;b&&b.useCompressedTextures?d=t.TextureFormat.Compressed:this._uncompressedTextureDownsamplingEnabled&&(d=t.TextureFormat.Downsampled);b=this._defaultGeometrySchema;this._nodeLoader=new t(this.streamDataSupplier,X,b,this._requiredAttributes,{textureFormat:d,
loadTextureData:this.layerView instanceof c&&this.layerView.rendererNeedsTextures,loadFeatureData:!this.isMeshPyramid||null==b||null==b.ordering});d=r.mixin({loadEverything:this._alwaysLoadEverythingModeEnabled},this.layerViewOptionalFunctions.traversalOptions);this._indexLoader=new C(this.getBaseUrl(),this._rootNodeUrl,this._rootNodeId,this._poi,this.nodeIndex,this.streamDataSupplier,this._viewportQueries,function(b,c){return a._processNodeIndexDocument(b,c)},function(b){return a._lodHandling.finishedLevel(b)},
X,d);this._indexLoader.progressiveLoadPenalty=z.distancePenalty*this._viewportQueries.distCameraToPOI(this._poi);this._nodeQueue=new Z;this.maxQueueLevel=0;this._indexLoader.start();this._alwaysLoadEverythingModeEnabled||this._removeInvisibleNodes(function(b){return a._indexLoader.nodeIsVisible(b)});this._lodHandling.startNodeLoading(function(b){return a._indexLoader.nodeIsVisible(b)},function(b){return a._indexLoader.nodeTraversalState(b)},this.nodeIndex,this._rootNodeId,{mode:null!=d&&d.perLevelTraversal?
"perLevel":"global",allowPartialOverlaps:!!d.allowPartialOverlaps,maxLodLevel:this._viewportQueries.maxLodLevel});this.layerViewOptionalFunctions.additionalStartNodeLoadingHandler&&this.layerViewOptionalFunctions.additionalStartNodeLoadingHandler();this._evaluateUpdatingState()}},g.prototype.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._indexLoader},g.prototype.cancelNodeLoading=function(){this.isNodeLoading()&&(this._indexLoader.cancel(),this._nodeLoader.cancel(),this.streamDataSupplier.cancelAll(),
this._idleQueue.cancelAll(),this._numNodesLoading=0,this._nodeLoader=null,this._indexLoader=null,this._nodeQueue=null,this._poi=null,this.layerViewOptionalFunctions.additionalCancelNodeLoadingHandler&&this.layerViewOptionalFunctions.additionalCancelNodeLoadingHandler(),this._evaluateUpdatingState())},g.prototype._removeInvisibleNodes=function(a){for(var b={},c=this.layerViewRequiredFunctions.getAddedNodeIDs(),e=0;e<c.length;e++){var d=c[e],g=this.nodeIndex[d];this._isNodeVisibleWithParents(g,a)?b[d]=
g:this._removeNodeData(g)}return b},g.prototype._isNodeVisibleWithParents=function(a,b){var c=a;do a=b(c),c=c.parentNode,c=null!=c?this.nodeIndex[c.id]:null;while(a&&null!=c);return a},g.prototype._removeNodeData=function(a){this._lodHandling.setLodGlobalDirty();this.layerViewRequiredFunctions.removeNodeData(a)},g.prototype._processNodeIndexDocument=function(a,b){var c=this.layerViewOptionalFunctions.traversalOptions;if(c&&c.perLevelTraversal)return this._loadNode(a);this._nodeQueue.enqueue(b,a);
this.maxQueueLevel=Math.max(a.level,this.maxQueueLevel);a=new R.Promise;return a.done(),a},g.prototype._loadNode=function(a){var b=this,c=new R.Promise;if(null!=a.featureData&&0<a.featureData.length)if(this.layerViewRequiredFunctions.areAllBundlesLoaded(a)){var e=this.layerViewOptionalFunctions.getLoadedAttributes,e=null!=e?e(a):void 0;null!=e&&e!==this._requiredAttributes&&(this._nodeLoader.loadAttributes(a,a.baseUrl,this._requiredAttributes).then(function(c){b.layerViewOptionalFunctions.setAttributeData(a,
b._requiredAttributes,c)}).otherwise(function(c){b.layerViewOptionalFunctions.setAttributeData(a,b._requiredAttributes,{})}).then(function(){b._numAttributesLoading--;b._evaluateUpdatingState()}),this._numAttributesLoading++,this._evaluateUpdatingState());this._lodHandling.shouldLoadNode(a)&&this._lodHandling.lodSwapBundleLoaded(a)}else if(this._lodHandling.shouldLoadNode(a)){if(this.layerViewRequiredFunctions.isOverMemory())return c.done(),c;for(var e=[],d=0;d<a.featureData.length;d++)this.layerViewRequiredFunctions.isBundleAlreadyAddedToStage(a,
d)||e.push(this._loadAndAddBundle(a,d));return this._numNodesLoading++,this._evaluateUpdatingState(),U.eachAlways(e).then(function(){b._numNodesLoading--;b._evaluateUpdatingState();c.done()}),c}return c.done(),c},g.prototype._loadCached=function(a,b){var c=this,e=this.disableCache?null:this.layerViewOptionalFunctions.loadCachedBundle,d=this.disableCache?null:this.layerViewOptionalFunctions.addCachedBundle;return e&&d?this.schedule().then(function(){return e(a,b,function(a,b){return c._nodeLoader.loadTextures(a,
b)})}).then(function(e){if(null==e)return!1;var f=c._requiredAttributes;return c.schedule().then(function(){return c._nodeLoader.loadAttributes(a,a.baseUrl,f)}).then(function(a){return c.schedule({loadedAttributes:f,attributeData:a})}).then(function(c){return d(a,b,e,c)}).then(function(){return c._lodHandling.lodSwapBundleLoaded(a),!0})}):U.resolve(!1)},g.prototype._loadUncached=function(a,b){var c=this;return this.schedule().then(function(){return c._nodeLoader.loadBundleData(a,b)}).then(function(a){return c.schedule(a)}).then(function(e){return c.layerViewRequiredFunctions.addBundle(a,
b,e)}).then(function(){return c._lodHandling.lodSwapBundleLoaded(a)})},g.prototype._loadAndAddBundle=function(a,b){var c=this;return this._loadCached(a,b).then(function(e){return e?void 0:c._loadUncached(a,b)}).otherwise(function(c){c instanceof d||X.error("Failed to load node '"+a.id+"' bundle "+b+": "+c)})},g.prototype._updateIdleState=function(a){a!==this._isIdle&&(this._isIdle=a,this._evaluateUpdatingState())},l([E.property({readOnly:!0})],g.prototype,"isMeshPyramid",null),l([E.property({readOnly:!0})],
g.prototype,"streamDataSupplier",null),l([E.property({readOnly:!0,dependsOn:["layer.definitionExpression"]})],g.prototype,"parsedDefinitionExpression",null),l([E.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],g.prototype,"definitionExpressionFields",null),l([E.property({readOnly:!0})],g.prototype,"crsVertex",null),l([E.property({readOnly:!0})],g.prototype,"crsIndex",null),l([E.property({readOnly:!0})],g.prototype,"nodeIndex",void 0),l([E.property()],g.prototype,"camPos",void 0),
l([E.property()],g.prototype,"screenSizeFactor",void 0),l([E.property()],g.prototype,"layerView",void 0),l([E.property()],g.prototype,"layerViewRequiredFunctions",void 0),l([E.property()],g.prototype,"layerViewOptionalFunctions",void 0),l([E.property()],g.prototype,"layer",void 0),l([E.property({readOnly:!0})],g.prototype,"updating",void 0),l([E.property({readOnly:!0})],g.prototype,"updatingPercentage",void 0),l([E.property({readOnly:!0})],g.prototype,"rootNodeVisible",null),g=l([E.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],
g)}(E.declared(J,K,G));var z={factorIM:.2,factor3dObject:.05,distancePenalty:10},Z=D.goog.structs.PriorityQueue;return A})},"esri/core/sql/WhereClause":function(){define(["require","exports","./WhereGrammar","../../moment","./StandardizedFunctions"],function(A,p,w,l,h){function d(a){return Array.isArray(a)?a:[a]}function u(a){return null!==a?!0!==a:null}function r(a,c){if(null==a)return null;for(var d=!1,h=0;h<c.length;h++){var k=c[h];if(null==k)d=null;else if(a===k){d=!0;break}}return d}function a(a,
c,d){if(null==a)return null;for(var h="",k=0,l=0;l<c.length;l++){var b=c.charAt(l);switch(k){case 0:b===d?k=1:h+=0<="-[]/{}()*+?.\\^$|".indexOf(b)?"\\"+b:"%"===b?".*":"_"===b?".":b;break;case 1:h+=0<="-[]/{}()*+?.\\^$|".indexOf(b)?"\\"+b:b,k=0}}return(new RegExp("^"+h+"$")).test(a)}function k(a){return a instanceof Date?a.valueOf():a}function c(a,c,d){if(null==c||null==d)return null;c=k(c);d=k(d);switch(a){case "\x3c\x3e":return c!==d;case "\x3d":return c===d;case "\x3e":return c>d;case "\x3c":return d>
c;case "\x3e\x3d":return c>=d;case "\x3c\x3d":return d>=c}}function t(a){for(var c=[],d={},h=0;h<a.length;h++){var k=a[h],l=k.toLowerCase();void 0===d[l]&&(c.push(k),d[l]=1)}return c}return function(){function p(){this.parameters=this.parseTree=null}return p.create=function(a){var c=new p;return c.parseTree=w.WhereGrammar.parse(a),c},p.prototype.isStandardized=function(){var a=!0;return this.visitAll(this.parseTree,function(c){a&&"function"===c.type&&(a=h.isStandardized(c.name,c.args.value.length))}),
a},p.prototype.setVariablesDictionary=function(a){this.parameters=a},p.prototype.testFeature=function(a){return!!this.evaluateNode(this.parseTree,a)},p.prototype.calculateValue=function(a){return this.evaluateNode(this.parseTree,a)},p.prototype.getFunctions=function(){var a=[];return this.visitAll(this.parseTree,function(c){"function"===c.type&&a.push(c.name.toLowerCase())}),t(a)},p.prototype.getFields=function(){var a=[];return this.visitAll(this.parseTree,function(c){"column_ref"===c.type&&a.push(c.column)}),
t(a)},p.prototype.getVariables=function(){var a=[];return this.visitAll(this.parseTree,function(c){"param"===c.type&&a.push(c.value.toLowerCase())}),t(a)},p.prototype.featureValue=function(a,c,d){a=a&&"object"==typeof a.attributes?a.attributes:a;var h=a[c];if(void 0!==h)return h;for(var k in a)if(c.toLowerCase()===k.toLowerCase())return d.column=k,a[k];return null},p.prototype.visitAll=function(a,c){if(null!=a)switch(c(a),a.type){case "when_clause":this.visitAll(a.operand,c);this.visitAll(a.value,
c);break;case "case_expression":for(var d=0,h=a.clauses;d<h.length;d++){var k=h[d];this.visitAll(k,c)}"simple"===a.format&&this.visitAll(a.operand,c);null!==a["else"]&&this.visitAll(a["else"],c);break;case "expr_list":d=0;for(a=a.value;d<a.length;d++)k=a[d],this.visitAll(k,c);break;case "unary_expr":this.visitAll(a.expr,c);break;case "binary_expr":this.visitAll(a.left,c);this.visitAll(a.right,c);break;case "function":this.visitAll(a.args,c)}},p.prototype.evaluateNode=function(q,p){switch(q.type){case "case_expression":if("simple"===
q.format)for(var t=k(this.evaluateNode(q.operand,p)),v=0;v<q.clauses.length;v++){if(t===k(this.evaluateNode(q.clauses[v].operand,p)))return this.evaluateNode(q.clauses[v].value,p)}else for(v=0;v<q.clauses.length;v++)if(!0===this.evaluateNode(q.clauses[v].operand,p))return this.evaluateNode(q.clauses[v].value,p);return null!==q["else"]?this.evaluateNode(q["else"],p):null;case "param":return this.parameters[q.value.toLowerCase()];case "expr_list":t=[];v=0;for(q=q.value;v<q.length;v++){var w=q[v];t.push(this.evaluateNode(w,
p))}return t;case "unary_expr":return u(this.evaluateNode(q.expr,p));case "binary_expr":switch(q.operator){case "AND":return t=this.evaluateNode(q.left,p),p=this.evaluateNode(q.right,p),null!=t&&null!=p?!0===t&&!0===p:!1===t||!1===p?!1:null;case "OR":return t=this.evaluateNode(q.left,p),p=this.evaluateNode(q.right,p),null!=t&&null!=p?!0===t||!0===p:!0===t||!0===p?!0:null;case "IS":if("null"!==q.right.type)throw Error("Unsupported RHS for IS");return null===this.evaluateNode(q.left,p);case "ISNOT":if("null"!==
q.right.type)throw Error("Unsupported RHS for IS");return null!==this.evaluateNode(q.left,p);case "IN":return t=d(this.evaluateNode(q.right,p)),r(this.evaluateNode(q.left,p),t);case "NOT IN":return t=d(this.evaluateNode(q.right,p)),u(r(this.evaluateNode(q.left,p),t));case "BETWEEN":return t=this.evaluateNode(q.left,p),p=this.evaluateNode(q.right,p),null==t||null==p[0]||null==p[1]?null:t>=p[0]&&t<=p[1];case "NOTBETWEEN":return t=this.evaluateNode(q.left,p),p=this.evaluateNode(q.right,p),null==t||null==
p[0]||null==p[1]?null:t<p[0]||t>p[1];case "LIKE":return a(this.evaluateNode(q.left,p),this.evaluateNode(q.right,p),q.escape);case "NOT LIKE":return u(a(this.evaluateNode(q.left,p),this.evaluateNode(q.right,p),q.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return c(q.operator,this.evaluateNode(q.left,p),this.evaluateNode(q.right,p));case "*":return this.evaluateNode(q.left,p)*this.evaluateNode(q.right,p);case "-":return this.evaluateNode(q.left,p)-this.evaluateNode(q.right,
p);case "+":return this.evaluateNode(q.left,p)+this.evaluateNode(q.right,p);case "/":return this.evaluateNode(q.left,p)/this.evaluateNode(q.right,p)}throw Error("Not Supported Operator "+q.operator);case "null":case "bool":case "string":case "number":return q.value;case "date":return l(q.value,["YYYY-M-D"]).toDate();case "timestamp":return l(q.value,["YYYY-M-D H:m:s","YYYY-M-D H:mZ","YYYY-M-D H:m:sZ","YYYY-M-D H:m","YYYY-m-d"]).toDate();case "column_ref":return"CURRENT_DATE"===q.column.toUpperCase()?
(w=new Date,w.setHours(0,0,0,0),w):"CURRENT_TIMESTAMP"===q.column.toUpperCase()?new Date:this.featureValue(p,q.column,q);case "function":return p=this.evaluateNode(q.args,p),h.evaluateFunction(q.name,p)}throw Error("Unsupported sql syntax "+q.type);},p}()})},"esri/core/sql/WhereGrammar":function(){define(["require","exports","./sql92grammar"],function(A,p,w){Object.defineProperty(p,"__esModule",{value:!0});A=function(){function l(){}return l.parse=function(h){return w.parse(h)},l}();p.WhereGrammar=
A})},"esri/core/sql/sql92grammar":function(){define([],function(){function A(p,w,l,h){this.message=p;this.expected=w;this.found=l;this.location=h;this.name="SyntaxError";"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,A)}return function(p,w){function l(){this.constructor=p}l.prototype=w.prototype;p.prototype=new l}(A,Error),A.buildMessage=function(p,w){function l(d){return d.charCodeAt(0).toString(16).toUpperCase()}function h(d){return d.replace(/\\/g,"\\\\").replace(/"/g,
'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+l(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+l(a)})}function d(d){return d.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+l(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+
l(a)})}var u={literal:function(d){return'"'+h(d.text)+'"'},"class":function(h){var a,k="";for(a=0;a<h.parts.length;a++)k+=h.parts[a]instanceof Array?d(h.parts[a][0])+"-"+d(h.parts[a][1]):d(h.parts[a]);return"["+(h.inverted?"^":"")+k+"]"},any:function(d){return"any character"},end:function(d){return"end of input"},other:function(d){return d.description}};return"Expected "+function(d){var a,h=Array(d.length);for(a=0;a<d.length;a++){var c=a,l;l=d[a];l=u[l.type](l);h[c]=l}if(h.sort(),0<h.length){for(d=
a=1;a<h.length;a++)h[a-1]!==h[a]&&(h[d]=h[a],d++);h.length=d}switch(h.length){case 1:return h[0];case 2:return h[0]+" or "+h[1];default:return h.slice(0,-1).join(", ")+", or "+h[h.length-1]}}(p)+" but "+(w?'"'+h(w)+'"':"end of input")+" found."},{SyntaxError:A,parse:function(p,w){function l(a,b){return{type:"literal",text:a,ignoreCase:b}}function h(a,b,c){return{type:"class",parts:a,inverted:b,ignoreCase:c}}function d(a){var b,c=Vb[a];if(c)return c;for(b=a-1;!Vb[b];)b--;c=Vb[b];for(c={line:c.line,
column:c.column};a>b;)10===p.charCodeAt(b)?(c.line++,c.column=1):c.column++,b++;return Vb[a]=c,c}function u(a,b){var c=d(a),e=d(b);return{start:{offset:a,line:c.line,column:c.column},end:{offset:b,line:e.line,column:e.column}}}function r(a){Za>H||(H>Za&&(Za=H,Wb=[]),Wb.push(a))}function a(){var a,b,e,d;return a=H,b=aa(),b!==F?(e=c(),e!==F?(d=aa(),d!==F?(b=e,a=b):(H=a,a=F)):(H=a,a=F)):(H=a,a=F),a}function k(){var a,b,e,d,f,g,h,k;if(a=H,b=c(),b!==F){e=[];d=H;f=aa();for(f!==F?(g=wa(),g!==F?(h=aa(),h!==
F?(k=c(),k!==F?(f=[f,g,h,k],d=f):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F);d!==F;)e.push(d),d=H,f=aa(),f!==F?(g=wa(),g!==F?(h=aa(),h!==F?(k=c(),k!==F?(f=[f,g,h,k],d=f):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F);if(e!==F){a={type:"expr_list"};b=[b];for(d=0;d<e.length;d++)b.push(e[d][3]);a=b=(a.value=b,a)}else H=a,a=F}else H=a,a=F;return a}function c(){var a,b,c,e,d,f,g,h;if(a=H,b=t(),b!==F){c=[];e=H;d=aa();for(d!==F?(f=L(),f!==F?(g=aa(),g!==F?(h=t(),h!==F?(d=[d,f,g,h],e=d):(H=e,e=F)):(H=e,e=F)):(H=
e,e=F)):(H=e,e=F);e!==F;)c.push(e),e=H,d=aa(),d!==F?(f=L(),f!==F?(g=aa(),g!==F?(h=t(),h!==F?(d=[d,f,g,h],e=d):(H=e,e=F)):(H=e,e=F)):(H=e,e=F)):(H=e,e=F);c!==F?(b=za(b,c),a=b):(H=a,a=F)}else H=a,a=F;return a}function t(){var a,b,c,e,d,f,g,h;if(a=H,b=C(),b!==F){c=[];e=H;d=aa();for(d!==F?(f=I(),f!==F?(g=aa(),g!==F?(h=C(),h!==F?(d=[d,f,g,h],e=d):(H=e,e=F)):(H=e,e=F)):(H=e,e=F)):(H=e,e=F);e!==F;)c.push(e),e=H,d=aa(),d!==F?(f=I(),f!==F?(g=aa(),g!==F?(h=C(),h!==F?(d=[d,f,g,h],e=d):(H=e,e=F)):(H=e,e=F)):
(H=e,e=F)):(H=e,e=F);c!==F?(b=za(b,c),a=b):(H=a,a=F)}else H=a,a=F;return a}function C(){var a,b,c,e,d;a=H;b=x();b===F&&(b=H,33===p.charCodeAt(H)?(c=Qa,H++):(c=F,0===ba&&r(Pa)),c!==F?(e=H,ba++,61===p.charCodeAt(H)?(d=Fa,H++):(d=F,0===ba&&r(ea)),ba--,d===F?e=void 0:(H=e,e=F),e!==F?(c=[c,e],b=c):(H=b,b=F)):(H=b,b=F));b!==F?(c=aa(),c!==F?(e=C(),e!==F?(b={type:"unary_expr",operator:"NOT",expr:e},a=b):(H=a,a=F)):(H=a,a=F)):(H=a,a=F);if(a===F){var g;a=H;b=B();if(b!==F)if(c=aa(),c!==F){var h,l,m,n,t;if(c=
[],h=H,l=aa(),l!==F?(m=q(),m!==F?(n=aa(),n!==F?(t=B(),t!==F?(l=[l,m,n,t],h=l):(H=h,h=F)):(H=h,h=F)):(H=h,h=F)):(H=h,h=F),h!==F)for(;h!==F;)c.push(h),h=H,l=aa(),l!==F?(m=q(),m!==F?(n=aa(),n!==F?(t=B(),t!==F?(l=[l,m,n,t],h=l):(H=h,h=F)):(H=h,h=F)):(H=h,h=F)):(H=h,h=F);else c=F;h=(c!==F&&(c={type:"arithmetic",tail:c}),c);if(h===F){var u,w,z,A,D,E,G,J;h=(u=H,w=y(),w!==F?(z=aa(),z!==F?(A=ta(),A!==F?(D=aa(),D!==F?(E=k(),E!==F?(G=aa(),G!==F?(J=sa(),J!==F?(w={op:w,right:E},u=w):(H=u,u=F)):(H=u,u=F)):(H=u,
u=F)):(H=u,u=F)):(H=u,u=F)):(H=u,u=F)):(H=u,u=F),u===F&&(u=H,w=y(),w!==F?(z=aa(),z!==F?(A=ta(),A!==F?(D=aa(),D!==F?(E=sa(),E!==F?(w={op:w,right:{type:"expr_list",value:[]}},u=w):(H=u,u=F)):(H=u,u=F)):(H=u,u=F)):(H=u,u=F)):(H=u,u=F),u===F&&(u=H,w=y(),w!==F?(z=aa(),z!==F?(A=U(),A!==F?(w={op:w,right:A},u=w):(H=u,u=F)):(H=u,u=F)):(H=u,u=F))),u);if(h===F){var M,L,Ia,O,N,Ea,Z,Q,S,T;h=(M=H,L=x(),L!==F?(Ia=aa(),Ia!==F?(O=P(),O!==F?(N=aa(),N!==F?(Ea=B(),Ea!==F?(Z=aa(),Z!==F?(Q=I(),Q!==F?(S=aa(),S!==F?(T=B(),
T!==F?(L={op:"NOT"+O,right:{type:"expr_list",value:[Ea,T]}},M=L):(H=M,M=F)):(H=M,M=F)):(H=M,M=F)):(H=M,M=F)):(H=M,M=F)):(H=M,M=F)):(H=M,M=F)):(H=M,M=F)):(H=M,M=F),M===F&&(M=H,L=P(),L!==F?(Ia=aa(),Ia!==F?(O=B(),O!==F?(N=aa(),N!==F?(Ea=I(),Ea!==F?(Z=aa(),Z!==F?(Q=B(),Q!==F?(L={op:L,right:{type:"expr_list",value:[O,Q]}},M=L):(H=M,M=F)):(H=M,M=F)):(H=M,M=F)):(H=M,M=F)):(H=M,M=F)):(H=M,M=F)):(H=M,M=F)),M);if(h===F){var Y,V,X,oa,fa,da;h=(Y=H,V=f(),V!==F?(X=aa(),X!==F?(oa=x(),oa!==F?(fa=aa(),fa!==F?(da=
B(),da!==F?(V={op:V+"NOT",right:da},Y=V):(H=Y,Y=F)):(H=Y,Y=F)):(H=Y,Y=F)):(H=Y,Y=F)):(H=Y,Y=F),Y===F&&(Y=H,V=f(),V!==F?(X=aa(),X!==F?(oa=B(),oa!==F?(V={op:V,right:oa},Y=V):(H=Y,Y=F)):(H=Y,Y=F)):(H=Y,Y=F)),Y);if(h===F){var ca,ha,ga;u=H;w=v();if(w!==F)if(g=aa(),g!==F)if(ca=W(),ca!==F)if(z=aa(),z!==F){var ia,Ga,ja,qa;z=(ia=H,p.substr(H,6).toLowerCase()===nc?(Ga=p.substr(H,6),H+=6):(Ga=F,0===ba&&r(Ya)),Ga!==F?(ja=H,ba++,qa=K(),ba--,qa===F?ja=void 0:(H=ja,ja=F),ja!==F?(Ga="ESCAPE",ia=Ga):(H=ia,ia=F)):
(H=ia,ia=F),ia);z!==F?(ha=aa(),ha!==F?(ga=R(),ga!==F?(w={op:w,right:ca,escape:ga.value},u=w):(H=u,u=F)):(H=u,u=F)):(H=u,u=F)}else H=u,u=F;else H=u,u=F;else H=u,u=F;else H=u,u=F;h=(u===F&&(u=H,w=v(),w!==F?(g=aa(),g!==F?(ca=W(),ca!==F?(w={op:w,right:ca,escape:""},u=w):(H=u,u=F)):(H=u,u=F)):(H=u,u=F)),u)}}}}g=h;g===F&&(g=null);g!==F?(ca=b,a=b=""==g||void 0==g||null==g?ca:"arithmetic"==g.type?za(ca,g.tail):la(g.op,ca,g.right,g.escape)):(H=a,a=F)}else H=a,a=F;else H=a,a=F}return a}function q(){var a;return p.substr(H,
2)===Na?(a=Na,H+=2):(a=F,0===ba&&r(Ga)),a===F&&(62===p.charCodeAt(H)?(a=La,H++):(a=F,0===ba&&r(ib)),a===F&&(p.substr(H,2)===ha?(a=ha,H+=2):(a=F,0===ba&&r(Ua)),a===F&&(p.substr(H,2)===Ma?(a=Ma,H+=2):(a=F,0===ba&&r(qa)),a===F&&(60===p.charCodeAt(H)?(a=db,H++):(a=F,0===ba&&r(Va)),a===F&&(61===p.charCodeAt(H)?(a=Fa,H++):(a=F,0===ba&&r(ea)),a===F&&(p.substr(H,2)===va?(a=va,H+=2):(a=F,0===ba&&r(bb)))))))),a}function v(){var a,b,c,e,d;return a=H,b=H,c=x(),c!==F?(e=aa(),e!==F?(d=n(),d!==F?(c=[c,e,d],b=c):
(H=b,b=F)):(H=b,b=F)):(H=b,b=F),b!==F&&(b=b[0]+" "+b[2]),a=b,a===F&&(a=n()),a}function y(){var a,b,c,d,f;return a=H,b=H,c=x(),c!==F?(d=aa(),d!==F?(f=e(),f!==F?(c=[c,d,f],b=c):(H=b,b=F)):(H=b,b=F)):(H=b,b=F),b!==F&&(b=b[0]+" "+b[2]),a=b,a===F&&(a=e()),a}function B(){var a,c,e,d,f,g,h,k;if(a=H,c=b(),c!==F){e=[];d=H;f=aa();for(f!==F?(g=D(),g!==F?(h=aa(),h!==F?(k=b(),k!==F?(f=[f,g,h,k],d=f):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F);d!==F;)e.push(d),d=H,f=aa(),f!==F?(g=D(),g!==F?(h=aa(),h!==F?(k=b(),
k!==F?(f=[f,g,h,k],d=f):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F);e!==F?(c=za(c,e),a=c):(H=a,a=F)}else H=a,a=F;return a}function D(){var a;return 43===p.charCodeAt(H)?(a=da,H++):(a=F,0===ba&&r(Ba)),a===F&&(45===p.charCodeAt(H)?(a=T,H++):(a=F,0===ba&&r(ra))),a}function b(){var a,b,c,e,d,f,g,h;if(a=H,b=E(),b!==F){c=[];e=H;d=aa();for(d!==F?(f=m(),f!==F?(g=aa(),g!==F?(h=E(),h!==F?(d=[d,f,g,h],e=d):(H=e,e=F)):(H=e,e=F)):(H=e,e=F)):(H=e,e=F);e!==F;)c.push(e),e=H,d=aa(),d!==F?(f=m(),f!==F?(g=aa(),g!==F?
(h=E(),h!==F?(d=[d,f,g,h],e=d):(H=e,e=F)):(H=e,e=F)):(H=e,e=F)):(H=e,e=F);c!==F?(b=za(b,c),a=b):(H=a,a=F)}else H=a,a=F;return a}function m(){var a;return 42===p.charCodeAt(H)?(a=ua,H++):(a=F,0===ba&&r(Aa)),a===F&&(47===p.charCodeAt(H)?(a=ma,H++):(a=F,0===ba&&r(pa))),a}function E(){var a,b,d,f,g,h,l;l=R();if(l===F){var m,n,q,t;m=H;var v,u,w,x;l=(n=(v=H,u=X(),u!==F?(w=z(),w!==F?(x=Z(),x!==F?(u=parseFloat(u+w+x),v=u):(H=v,v=F)):(H=v,v=F)):(H=v,v=F),v===F&&(v=H,u=X(),u!==F?(w=z(),w!==F?(u=parseFloat(u+
w),v=u):(H=v,v=F)):(H=v,v=F),v===F&&(v=H,u=X(),u!==F?(w=Z(),w!==F?(u=parseFloat(u+w),v=u):(H=v,v=F)):(H=v,v=F),v===F&&(v=H,u=X(),u!==F&&(u=parseFloat(u)),v=u))),v),n!==F?(q=H,ba++,t=G(),ba--,t===F?q=void 0:(H=q,q=F),q!==F?(n={type:"number",value:n},m=n):(H=m,m=F)):(H=m,m=F),m);if(l===F){var y,C;y=H;var B,A,D,E;C=(B=H,p.substr(H,4).toLowerCase()===Uc?(A=p.substr(H,4),H+=4):(A=F,0===ba&&r(Vc)),A!==F?(D=H,ba++,E=K(),ba--,E===F?D=void 0:(H=D,D=F),D!==F?(A=[A,D],B=A):(H=B,B=F)):(H=B,B=F),B);C!==F&&(C=
{type:"bool",value:!0});y=C;if(y===F){y=H;var I,L,Ia,O;C=(I=H,p.substr(H,5).toLowerCase()===ld?(L=p.substr(H,5),H+=5):(L=F,0===ba&&r(nd)),L!==F?(Ia=H,ba++,O=K(),ba--,O===F?Ia=void 0:(H=Ia,Ia=F),Ia!==F?(L=[L,Ia],I=L):(H=I,I=F)):(H=I,I=F),I);C!==F&&(C={type:"bool",value:!1});y=C}l=y;if(l===F){var P,Ea,Qa,T,Pa;l=(P=(Ea=H,p.substr(H,4).toLowerCase()===jd?(Qa=p.substr(H,4),H+=4):(Qa=F,0===ba&&r(kd)),Qa!==F?(T=H,ba++,Pa=K(),ba--,Pa===F?T=void 0:(H=T,T=F),T!==F?(Qa=[Qa,T],Ea=Qa):(H=Ea,Ea=F)):(H=Ea,Ea=F),
Ea),P!==F&&(P={type:"null",value:null}),P);if(l===F){var ea,oa,Fa,da;ea=H;var ca,ha,Ga,ja;l=(oa=(ca=H,p.substr(H,4).toLowerCase()===Jb?(ha=p.substr(H,4),H+=4):(ha=F,0===ba&&r(zd)),ha!==F?(Ga=H,ba++,ja=K(),ba--,ja===F?Ga=void 0:(H=Ga,Ga=F),Ga!==F?(ha="DATE",ca=ha):(H=ca,ca=F)):(H=ca,ca=F),ca),oa!==F?(Fa=aa(),Fa!==F?(da=W(),da!==F?(oa={type:"date",value:da.value},ea=oa):(H=ea,ea=F)):(H=ea,ea=F)):(H=ea,ea=F),ea);if(l===F){var qa,ma,la,na;qa=H;var Na,pa,ra,za;l=(ma=(Na=H,p.substr(H,9).toLowerCase()===
ob?(pa=p.substr(H,9),H+=9):(pa=F,0===ba&&r(Ab)),pa!==F?(ra=H,ba++,za=K(),ba--,za===F?ra=void 0:(H=ra,ra=F),ra!==F?(pa="TIMESTAMP",Na=pa):(H=Na,Na=F)):(H=Na,Na=F),Na),ma!==F?(la=aa(),la!==F?(na=W(),na!==F?(ma={type:"timestamp",value:na.value},qa=ma):(H=qa,qa=F)):(H=qa,qa=F)):(H=qa,qa=F),qa)}}}}}a=l;if(a===F){var ka,ua,va,La,db,Ma,wa,ya,Aa,Ua,Ba,ib;ka=H;var Va,Ha,Ja,bb;ua=(Va=H,p.substr(H,7).toLowerCase()===Wc?(Ha=p.substr(H,7),H+=7):(Ha=F,0===ba&&r(Xc)),Ha!==F?(Ja=H,ba++,bb=K(),ba--,bb===F?Ja=void 0:
(H=Ja,Ja=F),Ja!==F?(Ha="EXTRACT",Va=Ha):(H=Va,Va=F)):(H=Va,Va=F),Va);if(ua!==F)if(va=aa(),va!==F)if(La=ta(),La!==F)if(db=aa(),db!==F){var Da,Ra,$a,Ya,hb;Da=(Ra=H,p.substr(H,4).toLowerCase()===Hd?($a=p.substr(H,4),H+=4):($a=F,0===ba&&r(md)),$a!==F?(Ya=H,ba++,hb=K(),ba--,hb===F?Ya=void 0:(H=Ya,Ya=F),Ya!==F?($a="YEAR",Ra=$a):(H=Ra,Ra=F)):(H=Ra,Ra=F),Ra);if(Da===F){var Za,cb,fb,rb;Da=(Za=H,p.substr(H,5).toLowerCase()===Wa?(cb=p.substr(H,5),H+=5):(cb=F,0===ba&&r(jc)),cb!==F?(fb=H,ba++,rb=K(),ba--,rb===
F?fb=void 0:(H=fb,fb=F),fb!==F?(cb="MONTH",Za=cb):(H=Za,Za=F)):(H=Za,Za=F),Za);if(Da===F){var ab,Db,kb,tb;Da=(ab=H,p.substr(H,3).toLowerCase()===Bc?(Db=p.substr(H,3),H+=3):(Db=F,0===ba&&r(Ad)),Db!==F?(kb=H,ba++,tb=K(),ba--,tb===F?kb=void 0:(H=kb,kb=F),kb!==F?(Db="DAY",ab=Db):(H=ab,ab=F)):(H=ab,ab=F),ab);if(Da===F){var eb,lb,nb,Bb;Da=(eb=H,p.substr(H,4).toLowerCase()===Bd?(lb=p.substr(H,4),H+=4):(lb=F,0===ba&&r(Cd)),lb!==F?(nb=H,ba++,Bb=K(),ba--,Bb===F?nb=void 0:(H=nb,nb=F),nb!==F?(lb="HOUR",eb=lb):
(H=eb,eb=F)):(H=eb,eb=F),eb);if(Da===F){var jb,pb,qb,Ib;Da=(jb=H,p.substr(H,6).toLowerCase()===Cc?(pb=p.substr(H,6),H+=6):(pb=F,0===ba&&r(Yc)),pb!==F?(qb=H,ba++,Ib=K(),ba--,Ib===F?qb=void 0:(H=qb,qb=F),qb!==F?(pb="MINUTE",jb=pb):(H=jb,jb=F)):(H=jb,jb=F),jb);if(Da===F){var uc,ub,vb,Rb;Da=(uc=H,p.substr(H,6).toLowerCase()===Ed?(ub=p.substr(H,6),H+=6):(ub=F,0===ba&&r(Dd)),ub!==F?(vb=H,ba++,Rb=K(),ba--,Rb===F?vb=void 0:(H=vb,vb=F),vb!==F?(ub="SECOND",uc=ub):(H=uc,uc=F)):(H=uc,uc=F),uc)}}}}}Ma=Da;Ma!==
F?(wa=aa(),wa!==F?(ya=Y(),ya!==F?(Aa=aa(),Aa!==F?(Ua=c(),Ua!==F?(Ba=aa(),Ba!==F?(ib=sa(),ib!==F?(ua={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:Ma},Ua]}},ka=ua):(H=ka,ka=F)):(H=ka,ka=F)):(H=ka,ka=F)):(H=ka,ka=F)):(H=ka,ka=F)):(H=ka,ka=F)):(H=ka,ka=F)}else H=ka,ka=F;else H=ka,ka=F;else H=ka,ka=F;else H=ka,ka=F;a=ka;if(a===F){var Sa,Cb,Tb,Vb,Xb,Eb,Yb,Zb,$b,Fb,ac,mb,vc,Qb,Sb,Wb;Sa=H;var wc,Zc,$c,ic;Cb=(wc=H,p.substr(H,9).toLowerCase()===Jc?(Zc=p.substr(H,9),H+=
9):(Zc=F,0===ba&&r(qc)),Zc!==F?($c=H,ba++,ic=K(),ba--,ic===F?$c=void 0:(H=$c,$c=F),$c!==F?(Zc="SUBSTRING",wc=Zc):(H=wc,wc=F)):(H=wc,wc=F),wc);if(Cb!==F)if(Tb=aa(),Tb!==F)if(Vb=ta(),Vb!==F)if(Xb=aa(),Xb!==F)if(Eb=c(),Eb!==F)if(Yb=aa(),Yb!==F)if(Zb=Y(),Zb!==F)if($b=aa(),$b!==F)if(Fb=c(),Fb!==F)if(ac=aa(),ac!==F){mb=H;var xc,ad,bd,lc;vc=(xc=H,p.substr(H,3).toLowerCase()===Ic?(ad=p.substr(H,3),H+=3):(ad=F,0===ba&&r(Gd)),ad!==F?(bd=H,ba++,lc=K(),ba--,lc===F?bd=void 0:(H=bd,bd=F),bd!==F?(ad="FOR",xc=ad):
(H=xc,xc=F)):(H=xc,xc=F),xc);vc!==F?(Qb=aa(),Qb!==F?(Sb=c(),Sb!==F?(Wb=aa(),Wb!==F?(vc=[vc,Qb,Sb,Wb],mb=vc):(H=mb,mb=F)):(H=mb,mb=F)):(H=mb,mb=F)):(H=mb,mb=F);mb===F&&(mb=null);mb!==F?(vc=sa(),vc!==F?(Cb={type:"function",name:"substring",args:{type:"expr_list",value:mb?[Eb,Fb,mb[2]]:[Eb,Fb]}},Sa=Cb):(H=Sa,Sa=F)):(H=Sa,Sa=F)}else H=Sa,Sa=F;else H=Sa,Sa=F;else H=Sa,Sa=F;else H=Sa,Sa=F;else H=Sa,Sa=F;else H=Sa,Sa=F;else H=Sa,Sa=F;else H=Sa,Sa=F;else H=Sa,Sa=F;else H=Sa,Sa=F;a=Sa;if(a===F){var xa,dc,
Kb,Lb,Mb,wb,Nb,Rc,Ob,Pb,nc,bc,oc,pc;a=(xa=H,dc=fa(),dc!==F?(Kb=aa(),Kb!==F?(Lb=ta(),Lb!==F?(Mb=aa(),Mb!==F?(wb=N(),wb===F&&(wb=null),wb!==F?(Nb=aa(),Nb!==F?(Rc=c(),Rc!==F?(Ob=aa(),Ob!==F?(Pb=Y(),Pb!==F?(nc=aa(),nc!==F?(bc=c(),bc!==F?(oc=aa(),oc!==F?(pc=sa(),pc!==F?(dc={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==wb?"BOTH":wb},Rc,bc]}},xa=dc):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):
(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F),xa===F&&(xa=H,dc=fa(),dc!==F?(Kb=aa(),Kb!==F?(Lb=ta(),Lb!==F?(Mb=aa(),Mb!==F?(wb=N(),wb===F&&(wb=null),wb!==F?(Nb=aa(),Nb!==F?(Rc=c(),Rc!==F?(Ob=aa(),Ob!==F?(Pb=sa(),Pb!==F?(dc={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==wb?"BOTH":wb},Rc]}},xa=dc):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)),xa);if(a===F){var Ta,Ub,rc,sc,tc,kc,Dc,Ec,Fc,
mc,Gc,Hc;Ta=H;var yc,cd,dd,Kc;a=(Ub=(yc=H,p.substr(H,8).toLowerCase()===sb?(cd=p.substr(H,8),H+=8):(cd=F,0===ba&&r(Xa)),cd!==F?(dd=H,ba++,Kc=K(),ba--,Kc===F?dd=void 0:(H=dd,dd=F),dd!==F?(cd="POSITION",yc=cd):(H=yc,yc=F)):(H=yc,yc=F),yc),Ub!==F?(rc=aa(),rc!==F?(sc=ta(),sc!==F?(tc=aa(),tc!==F?(kc=c(),kc!==F?(Dc=aa(),Dc!==F?(Ec=e(),Ec!==F?(Fc=aa(),Fc!==F?(mc=c(),mc!==F?(Gc=aa(),Gc!==F?(Hc=sa(),Hc!==F?(Ub={type:"function",name:"position",args:{type:"expr_list",value:[kc,mc]}},Ta=Ub):(H=Ta,Ta=F)):(H=Ta,
Ta=F)):(H=Ta,Ta=F)):(H=Ta,Ta=F)):(H=Ta,Ta=F)):(H=Ta,Ta=F)):(H=Ta,Ta=F)):(H=Ta,Ta=F)):(H=Ta,Ta=F)):(H=Ta,Ta=F)):(H=Ta,Ta=F),Ta);if(a===F){var gb,ed,Lc,Mc,Nc,Sc,Oc,Pc;gb=H;var xb,zc,fd,Hb;if(xb=H,zc=J(),xb=zc,xb===F)if(xb=H,96===p.charCodeAt(H)?(zc=od,H++):(zc=F,0===ba&&r(pd)),zc!==F){if(fd=[],qd.test(p.charAt(H))?(Hb=p.charAt(H),H++):(Hb=F,0===ba&&r(rd)),Hb!==F)for(;Hb!==F;)fd.push(Hb),qd.test(p.charAt(H))?(Hb=p.charAt(H),H++):(Hb=F,0===ba&&r(rd));else fd=F;fd!==F?(96===p.charCodeAt(H)?(Hb=od,H++):
(Hb=F,0===ba&&r(pd)),Hb!==F?(zc=fd.join(""),xb=zc):(H=xb,xb=F)):(H=xb,xb=F)}else H=xb,xb=F;a=(ed=xb,ed!==F?(Lc=aa(),Lc!==F?(Mc=ta(),Mc!==F?(Nc=aa(),Nc!==F?(Sc=k(),Sc===F&&(Sc=null),Sc!==F?(Oc=aa(),Oc!==F?(Pc=sa(),Pc!==F?(ed={type:"function",name:ed,args:Sc?Sc:{type:"expr_list",value:[]}},gb=ed):(H=gb,gb=F)):(H=gb,gb=F)):(H=gb,gb=F)):(H=gb,gb=F)):(H=gb,gb=F)):(H=gb,gb=F)):(H=gb,gb=F),gb);if(a===F){var sd,Ca,ec,td,Tc,ud,fc,yb,gd,Qc,Id;if(Ca=H,ec=ga(),ec!==F)if(td=aa(),td!==F)if(Tc=c(),Tc!==F)if(ud=
aa(),ud!==F){fc=[];for(yb=Q();yb!==F;)fc.push(yb),yb=Q();fc!==F?(yb=aa(),yb!==F?(gd=ia(),gd!==F?(ec={type:"case_expression",format:"simple",operand:Tc,clauses:fc,"else":null},Ca=ec):(H=Ca,Ca=F)):(H=Ca,Ca=F)):(H=Ca,Ca=F)}else H=Ca,Ca=F;else H=Ca,Ca=F;else H=Ca,Ca=F;else H=Ca,Ca=F;if(Ca===F)if(Ca=H,ec=ga(),ec!==F)if(td=aa(),td!==F)if(Tc=c(),Tc!==F)if(ud=aa(),ud!==F){fc=[];for(yb=Q();yb!==F;)fc.push(yb),yb=Q();fc!==F?(yb=aa(),yb!==F?(gd=S(),gd!==F?(Qc=aa(),Qc!==F?(Id=ia(),Id!==F?(ec={type:"case_expression",
format:"simple",operand:Tc,clauses:fc,"else":gd.value},Ca=ec):(H=Ca,Ca=F)):(H=Ca,Ca=F)):(H=Ca,Ca=F)):(H=Ca,Ca=F)):(H=Ca,Ca=F)}else H=Ca,Ca=F;else H=Ca,Ca=F;else H=Ca,Ca=F;else H=Ca,Ca=F;sd=Ca;if(sd===F){var Oa,gc,vd,hc,zb,hd,Jd,Kd;if(Oa=H,gc=ga(),gc!==F)if(vd=aa(),vd!==F){hc=[];for(zb=V();zb!==F;)hc.push(zb),zb=V();hc!==F?(zb=aa(),zb!==F?(hd=ia(),hd!==F?(gc={type:"case_expression",format:"searched",clauses:hc,"else":null},Oa=gc):(H=Oa,Oa=F)):(H=Oa,Oa=F)):(H=Oa,Oa=F)}else H=Oa,Oa=F;else H=Oa,Oa=F;
if(Oa===F)if(Oa=H,gc=ga(),gc!==F)if(vd=aa(),vd!==F){hc=[];for(zb=V();zb!==F;)hc.push(zb),zb=V();hc!==F?(zb=aa(),zb!==F?(hd=S(),hd!==F?(Jd=aa(),Jd!==F?(Kd=ia(),Kd!==F?(gc={type:"case_expression",format:"searched",clauses:hc,"else":hd.value},Oa=gc):(H=Oa,Oa=F)):(H=Oa,Oa=F)):(H=Oa,Oa=F)):(H=Oa,Oa=F)):(H=Oa,Oa=F)}else H=Oa,Oa=F;else H=Oa,Oa=F;sd=Oa}a=sd;if(a===F){var id,Ld,Ac,wd,xd,yd;if(Ac=H,wd=G(),wd!==F){xd=[];for(yd=M();yd!==F;)xd.push(yd),yd=M();xd!==F?(wd+=xd.join(""),Ac=wd):(H=Ac,Ac=F)}else H=
Ac,Ac=F;a=(id=(Ld=Ac,Ld),id!==F&&(id={type:"column_ref",table:"",column:id}),id);a===F&&(a=U(),a===F&&(a=H,b=ta(),b!==F?(d=aa(),d!==F?(f=c(),f!==F?(g=aa(),g!==F?(h=sa(),h!==F?a=b=(f.paren=!0,f):(H=a,a=F)):(H=a,a=F)):(H=a,a=F)):(H=a,a=F)):(H=a,a=F)))}}}}}}}return a}function J(){var a,b,c,e;if(a=H,b=G(),b!==F){c=[];for(e=K();e!==F;)c.push(e),e=K();c!==F?(b+=c.join(""),a=b):(H=a,a=F)}else H=a,a=F;return a}function G(){var a;return ca.test(p.charAt(H))?(a=p.charAt(H),H++):(a=F,0===ba&&r(Db)),a}function K(){var a;
return $a.test(p.charAt(H))?(a=p.charAt(H),H++):(a=F,0===ba&&r(kb)),a}function M(){var a;return Lb.test(p.charAt(H))?(a=p.charAt(H),H++):(a=F,0===ba&&r(tb)),a}function U(){var a,b,c;a=H;64===p.charCodeAt(H)?(b=Mb,H++):(b=F,0===ba&&r(Eb));b!==F?(c=J(),c!==F?(b=[b,c],a=b):(H=a,a=F)):(H=a,a=F);a!==F&&(a={type:"param",value:a[1]});return a}function N(){var a,b,c,e,d;a=(b=H,p.substr(H,7).toLowerCase()===kc?(c=p.substr(H,7),H+=7):(c=F,0===ba&&r(Ub)),c!==F?(e=H,ba++,d=K(),ba--,d===F?e=void 0:(H=e,e=F),e!==
F?(c="LEADING",b=c):(H=b,b=F)):(H=b,b=F),b);if(a===F){var f,g,h,k;a=(f=H,p.substr(H,8).toLowerCase()===Da?(g=p.substr(H,8),H+=8):(g=F,0===ba&&r(rc)),g!==F?(h=H,ba++,k=K(),ba--,k===F?h=void 0:(H=h,h=F),h!==F?(g="TRAILING",f=g):(H=f,f=F)):(H=f,f=F),f);if(a===F){var l,m,n,q;a=(l=H,p.substr(H,4).toLowerCase()===lc?(m=p.substr(H,4),H+=4):(m=F,0===ba&&r(Kb)),m!==F?(n=H,ba++,q=K(),ba--,q===F?n=void 0:(H=n,n=F),n!==F?(m="BOTH",l=m):(H=l,l=F)):(H=l,l=F),l)}}return a}function W(){var a;return a=R(),a===F&&
(a=U()),a}function R(){var a,b,c,e,d;if(a=H,39===p.charCodeAt(H)?(b=Yb,H++):(b=F,0===ba&&r(Zb)),b===F&&(p.substr(H,2)===eb?(b=eb,H+=2):(b=F,0===ba&&r(Nb))),b!==F){c=[];e=H;p.substr(H,2)===ub?(d=ub,H+=2):(d=F,0===ba&&r($b));d!==F&&(d="'");e=d;for(e===F&&(qb.test(p.charAt(H))?(e=p.charAt(H),H++):(e=F,0===ba&&r(Fb)));e!==F;)c.push(e),e=H,p.substr(H,2)===ub?(d=ub,H+=2):(d=F,0===ba&&r($b)),d!==F&&(d="'"),e=d,e===F&&(qb.test(p.charAt(H))?(e=p.charAt(H),H++):(e=F,0===ba&&r(Fb)));c!==F?(39===p.charCodeAt(H)?
(e=Yb,H++):(e=F,0===ba&&r(Zb)),e!==F?(b={type:"string",value:c.join("")},a=b):(H=a,a=F)):(H=a,a=F)}else H=a,a=F;return a}function V(){var a,b,e,d,f,g,h,k;return a=H,b=na(),b!==F?(e=aa(),e!==F?(d=c(),d!==F?(f=aa(),f!==F?(g=ka(),g!==F?(h=aa(),h!==F?(k=c(),k!==F?(b={type:"when_clause",operand:d,value:k},a=b):(H=a,a=F)):(H=a,a=F)):(H=a,a=F)):(H=a,a=F)):(H=a,a=F)):(H=a,a=F)):(H=a,a=F),a}function Q(){var a,b,e,d,f,g,h,k;return a=H,b=na(),b!==F?(e=aa(),e!==F?(d=c(),d!==F?(f=aa(),f!==F?(g=ka(),g!==F?(h=aa(),
h!==F?(k=c(),k!==F?(b={type:"when_clause",operand:d,value:k},a=b):(H=a,a=F)):(H=a,a=F)):(H=a,a=F)):(H=a,a=F)):(H=a,a=F)):(H=a,a=F)):(H=a,a=F),a}function S(){var a,b,e,d;a=H;var f,g,h,k;return b=(f=H,p.substr(H,4).toLowerCase()===Nc?(g=p.substr(H,4),H+=4):(g=F,0===ba&&r(sc)),g!==F?(h=H,ba++,k=K(),ba--,k===F?h=void 0:(H=h,h=F),h!==F?(g="ELSE",f=g):(H=f,f=F)):(H=f,f=F),f),b!==F?(e=aa(),e!==F?(d=c(),d!==F?(b={type:"else_clause",value:d},a=b):(H=a,a=F)):(H=a,a=F)):(H=a,a=F),a}function X(){var a,b,c;return a=
O(),a===F&&(a=H,45===p.charCodeAt(H)?(b=T,H++):(b=F,0===ba&&r(ra)),b===F&&(43===p.charCodeAt(H)?(b=da,H++):(b=F,0===ba&&r(Ba))),b!==F?(c=O(),c!==F?(b=b[0]+c,a=b):(H=a,a=F)):(H=a,a=F)),a}function z(){var a,b,c;return a=H,46===p.charCodeAt(H)?(b=ac,H++):(b=F,0===ba&&r(Ob)),b!==F?(c=O(),c===F&&(c=null),c!==F?(b="."+(null!=c?c:""),a=b):(H=a,a=F)):(H=a,a=F),a}function Z(){var a,b,c;a=H;var e,d,f;return b=(e=H,lb.test(p.charAt(H))?(d=p.charAt(H),H++):(d=F,0===ba&&r(Gc)),d!==F?(Bb.test(p.charAt(H))?(f=p.charAt(H),
H++):(f=F,0===ba&&r(vb)),f===F&&(f=null),f!==F?(d="e"+(null===f?"":f),e=d):(H=e,e=F)):(H=e,e=F),e),b!==F?(c=O(),c!==F?(b+=c,a=b):(H=a,a=F)):(H=a,a=F),a}function O(){var a,b;if(a=[],b=g(),b!==F)for(;b!==F;)a.push(b),b=g();else a=F;return a!==F&&(a=a.join("")),a}function g(){var a;return Pb.test(p.charAt(H))?(a=p.charAt(H),H++):(a=F,0===ba&&r(rb)),a}function e(){var a,b,c,e;return a=H,p.substr(H,2).toLowerCase()===jb?(b=p.substr(H,2),H+=2):(b=F,0===ba&&r(Ra)),b!==F?(c=H,ba++,e=K(),ba--,e===F?c=void 0:
(H=c,c=F),c!==F?(b="IN",a=b):(H=a,a=F)):(H=a,a=F),a}function f(){var a,b,c,e;return a=H,p.substr(H,2).toLowerCase()===ic?(b=p.substr(H,2),H+=2):(b=F,0===ba&&r(Ib)),b!==F?(c=H,ba++,e=K(),ba--,e===F?c=void 0:(H=c,c=F),c!==F?(b="IS",a=b):(H=a,a=F)):(H=a,a=F),a}function n(){var a,b,c,e;return a=H,p.substr(H,4).toLowerCase()===Xb?(b=p.substr(H,4),H+=4):(b=F,0===ba&&r(nb)),b!==F?(c=H,ba++,e=K(),ba--,e===F?c=void 0:(H=c,c=F),c!==F?(b="LIKE",a=b):(H=a,a=F)):(H=a,a=F),a}function x(){var a,b,c,e;return a=H,
p.substr(H,3).toLowerCase()===bc?(b=p.substr(H,3),H+=3):(b=F,0===ba&&r(Qb)),b!==F?(c=H,ba++,e=K(),ba--,e===F?c=void 0:(H=c,c=F),c!==F?(b="NOT",a=b):(H=a,a=F)):(H=a,a=F),a}function I(){var a,b,c,e;return a=H,p.substr(H,3).toLowerCase()===Rb?(b=p.substr(H,3),H+=3):(b=F,0===ba&&r(Ja)),b!==F?(c=H,ba++,e=K(),ba--,e===F?c=void 0:(H=c,c=F),c!==F?(b="AND",a=b):(H=a,a=F)):(H=a,a=F),a}function L(){var a,b,c,e;return a=H,p.substr(H,2).toLowerCase()===oc?(b=p.substr(H,2),H+=2):(b=F,0===ba&&r(pc)),b!==F?(c=H,
ba++,e=K(),ba--,e===F?c=void 0:(H=c,c=F),c!==F?(b="OR",a=b):(H=a,a=F)):(H=a,a=F),a}function P(){var a,b,c,e;return a=H,p.substr(H,7).toLowerCase()===Cb?(b=p.substr(H,7),H+=7):(b=F,0===ba&&r(Sb)),b!==F?(c=H,ba++,e=K(),ba--,e===F?c=void 0:(H=c,c=F),c!==F?(b="BETWEEN",a=b):(H=a,a=F)):(H=a,a=F),a}function Y(){var a,b,c,e;return a=H,p.substr(H,4).toLowerCase()===Tb?(b=p.substr(H,4),H+=4):(b=F,0===ba&&r(Hc)),b!==F?(c=H,ba++,e=K(),ba--,e===F?c=void 0:(H=c,c=F),c!==F?(b="FROM",a=b):(H=a,a=F)):(H=a,a=F),a}
function fa(){var a,b,c,e;return a=H,p.substr(H,4).toLowerCase()===hb?(b=p.substr(H,4),H+=4):(b=F,0===ba&&r(cb)),b!==F?(c=H,ba++,e=K(),ba--,e===F?c=void 0:(H=c,c=F),c!==F?(b="TRIM",a=b):(H=a,a=F)):(H=a,a=F),a}function ga(){var a,b,c,e;return a=H,p.substr(H,4).toLowerCase()===Dc?(b=p.substr(H,4),H+=4):(b=F,0===ba&&r(Kc)),b!==F?(c=H,ba++,e=K(),ba--,e===F?c=void 0:(H=c,c=F),c!==F?(b="CASE",a=b):(H=a,a=F)):(H=a,a=F),a}function ia(){var a,b,c,e;return a=H,p.substr(H,3).toLowerCase()===Lc?(b=p.substr(H,
3),H+=3):(b=F,0===ba&&r(pb)),b!==F?(c=H,ba++,e=K(),ba--,e===F?c=void 0:(H=c,c=F),c!==F?(b="END",a=b):(H=a,a=F)):(H=a,a=F),a}function na(){var a,b,c,e;return a=H,p.substr(H,4).toLowerCase()===Ec?(b=p.substr(H,4),H+=4):(b=F,0===ba&&r(Fc)),b!==F?(c=H,ba++,e=K(),ba--,e===F?c=void 0:(H=c,c=F),c!==F?(b="WHEN",a=b):(H=a,a=F)):(H=a,a=F),a}function ka(){var a,b,c,e;return a=H,p.substr(H,4).toLowerCase()===mc?(b=p.substr(H,4),H+=4):(b=F,0===ba&&r(Mc)),b!==F?(c=H,ba++,e=K(),ba--,e===F?c=void 0:(H=c,c=F),c!==
F?(b="THEN",a=b):(H=a,a=F)):(H=a,a=F),a}function wa(){var a;return 44===p.charCodeAt(H)?(a=tc,H++):(a=F,0===ba&&r(Oc)),a}function ta(){var a;return 40===p.charCodeAt(H)?(a=Pc,H++):(a=F,0===ba&&r(ab)),a}function sa(){var a;return 41===p.charCodeAt(H)?(a=Qc,H++):(a=F,0===ba&&r(ja)),a}function aa(){var a,b;a=[];for(b=ya();b!==F;)a.push(b),b=ya();return a}function ya(){var a;return Ha.test(p.charAt(H))?(a=p.charAt(H),H++):(a=F,0===ba&&r(fb)),a}function la(a,b,c,e){a={type:"binary_expr",operator:a,left:b,
right:c};return void 0!==e&&(a.escape=e),a}function za(a,b){for(var c=0;c<b.length;c++)a=la(b[c][1],a,b[c][3]);return a}w=void 0!==w?w:{};var oa,F={},Ia={start:a},Ea=a,Qa="!",Pa=l("!",!1),Fa="\x3d",ea=l("\x3d",!1),Na="\x3e\x3d",Ga=l("\x3e\x3d",!1),La="\x3e",ib=l("\x3e",!1),ha="\x3c\x3d",Ua=l("\x3c\x3d",!1),Ma="\x3c\x3e",qa=l("\x3c\x3e",!1),db="\x3c",Va=l("\x3c",!1),va="!\x3d",bb=l("!\x3d",!1),da="+",Ba=l("+",!1),T="-",ra=l("-",!1),ua="*",Aa=l("*",!1),ma="/",pa=l("/",!1),ca=/^[A-Za-z_\x80-\uFFFF]/,
Db=h([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),$a=/^[A-Za-z0-9_]/,kb=h([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Lb=/^[A-Za-z0-9_.\x80-\uFFFF]/,tb=h([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),Mb="@",Eb=l("@",!1),Yb="'",Zb=l("'",!1),eb="N'",Nb=l("N'",!1),ub="''",$b=l("''",!1),qb=/^[^']/,Fb=h(["'"],!0,!1),ac=".",Ob=l(".",!1),Pb=/^[0-9]/,rb=h([["0","9"]],!1,!1),lb=/^[eE]/,Gc=h(["e","E"],!1,!1),Bb=/^[+\-]/,vb=h(["+","-"],!1,!1),jd="null",kd=l("NULL",!0),Uc="true",Vc=
l("TRUE",!0),ld="false",nd=l("FALSE",!0),jb="in",Ra=l("IN",!0),ic="is",Ib=l("IS",!0),Xb="like",nb=l("LIKE",!0),nc="escape",Ya=l("ESCAPE",!0),bc="not",Qb=l("NOT",!0),Rb="and",Ja=l("AND",!0),oc="or",pc=l("OR",!0),Cb="between",Sb=l("BETWEEN",!0),Tb="from",Hc=l("FROM",!0),Ic="for",Gd=l("FOR",!0),Jc="substring",qc=l("SUBSTRING",!0),Wc="extract",Xc=l("EXTRACT",!0),hb="trim",cb=l("TRIM",!0),sb="position",Xa=l("POSITION",!0),ob="timestamp",Ab=l("TIMESTAMP",!0),Jb="date",zd=l("DATE",!0),kc="leading",Ub=l("LEADING",
!0),Da="trailing",rc=l("TRAILING",!0),lc="both",Kb=l("BOTH",!0),Hd="year",md=l("YEAR",!0),Wa="month",jc=l("MONTH",!0),Bc="day",Ad=l("DAY",!0),Bd="hour",Cd=l("HOUR",!0),Cc="minute",Yc=l("MINUTE",!0),Ed="second",Dd=l("SECOND",!0),Dc="case",Kc=l("CASE",!0),Lc="end",pb=l("END",!0),Ec="when",Fc=l("WHEN",!0),mc="then",Mc=l("THEN",!0),Nc="else",sc=l("ELSE",!0),tc=",",Oc=l(",",!1),Pc="(",ab=l("(",!1),Qc=")",ja=l(")",!1),Ha=/^[ \t\n\r]/,fb=h([" ","\t","\n","\r"],!1,!1),od="`",pd=l("`",!1),qd=/^[^`]/,rd=h(["`"],
!0,!1),H=0,Vb=[{line:1,column:1}],Za=0,Wb=[],ba=0;if("startRule"in w){if(!(w.startRule in Ia))throw Error("Can't start parsing from rule \""+w.startRule+'".');Ea=Ia[w.startRule]}if(oa=Ea(),oa!==F&&H===p.length)return oa;throw oa!==F&&H<p.length&&r({type:"end"}),function(a,b,c){return new A(A.buildMessage(a,b),a,b,c)}(Wb,Za<p.length?p.charAt(Za):null,Za<p.length?u(Za,Za+1):u(Za,Za));}}})},"esri/core/sql/StandardizedFunctions":function(){define(["require","exports","dojo/regexp"],function(A,p,w){Object.defineProperty(p,
"__esModule",{value:!0});p.evaluateFunction=function(h,d){var p=l[h.toLowerCase()];if(null==p)throw Error("Function Not Recognised");if(d.length<p.minParams||d.length>p.maxParams)throw Error("Invalid Parameter count for call to "+h.toUpperCase());return p.evaluate(d)};p.isStandardized=function(h,d){h=l[h.toLowerCase()];return null!=h&&d>=h.minParams&&d<=h.maxParams};var l={extract:{minParams:2,maxParams:2,evaluate:function(h){var d=h[0];h=h[1];if(null==h)return null;if(h instanceof Date)switch(d.toUpperCase()){case "SECOND":return h.getSeconds();
case "MINUTE":return h.getMinutes();case "HOUR":return h.getHours();case "DAY":return h.getDate();case "MONTH":return h.getMonth()+1;case "YEAR":return h.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,maxParams:3,evaluate:function(h){if(2===h.length){var d=h[0],l=h[1];return null==d||null==l?null:d.toString().substring(l-1)}if(3===h.length)return d=h[0],l=h[1],h=h[2],null==d||null==l||null==h?null:0>=h?"":d.toString().substring(l-1,l+h-1)}},position:{minParams:2,
maxParams:2,evaluate:function(h){var d=h[0];h=h[1];return null==d||null==h?null:h.indexOf(d)+1}},trim:{minParams:2,maxParams:3,evaluate:function(h){var d=3===h.length,l=d?h[1]:" ",d=d?h[2]:h[1];if(null==l||null==d)return null;l="("+w.escapeString(l)+")";switch(h[0]){case "BOTH":return d.replace(new RegExp("^"+l+"*|"+l+"*$","g"),"");case "LEADING":return d.replace(new RegExp("^"+l+"*","g"),"");case "TRAILING":return d.replace(new RegExp(l+"*$","g"),"")}throw Error("Invalid Parameter for call to TRIM");
}},abs:{minParams:1,maxParams:1,evaluate:function(h){return null==h[0]?null:Math.abs(h[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(h){return null==h[0]?null:Math.ceil(h[0])}},floor:{minParams:1,maxParams:1,evaluate:function(h){return null==h[0]?null:Math.floor(h[0])}},log:{minParams:1,maxParams:1,evaluate:function(h){return null==h[0]?null:Math.log(h[0])}},log10:{minParams:1,maxParams:1,evaluate:function(h){return null==h[0]?null:Math.log(h[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,
evaluate:function(h){return null==h[0]?null:Math.sin(h[0])}},cos:{minParams:1,maxParams:1,evaluate:function(h){return null==h[0]?null:Math.cos(h[0])}},tan:{minParams:1,maxParams:1,evaluate:function(h){return null==h[0]?null:Math.tan(h[0])}},asin:{minParams:1,maxParams:1,evaluate:function(h){return null==h[0]?null:Math.asin(h[0])}},acos:{minParams:1,maxParams:1,evaluate:function(h){return null==h[0]?null:Math.acos(h[0])}},atan:{minParams:1,maxParams:1,evaluate:function(h){return null==h[0]?null:Math.atan(h[0])}},
sign:{minParams:1,maxParams:1,evaluate:function(h){return null==h[0]?null:0<h[0]?1:0>h[1]?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(h){return null==h[0]||null==h[1]?null:Math.pow(h[0],h[1])}},mod:{minParams:2,maxParams:2,evaluate:function(h){return null==h[0]||null==h[1]?null:h[0]%h[1]}},round:{minParams:1,maxParams:2,evaluate:function(h){var d=h[0];h=2===h.length?Math.pow(10,h[1]):1;return null==d?null:Math.round(d*h)/h}},truncate:{minParams:1,maxParams:2,evaluate:function(h){return null==
h[0]?null:1===h.length?parseInt(h[0].toFixed(0),10):parseFloat(h[0].toFixed(h[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(h){return"string"==typeof h[0]||h[0]instanceof String?h[0].length:0}},concat:{minParams:1,maxParams:1/0,evaluate:function(h){for(var d="",l=0;l<h.length;l++){if(null==h[l])return null;d+=h[l].toString()}return d}},lower:{minParams:1,maxParams:1,evaluate:function(h){return null==h[0]?null:h[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(h){return null==
h[0]?null:h[0].toString().toUpperCase()}}}})},"esri/views/3d/layers/SceneLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../layers/IntegratedMeshLayer ../../../core/arrayUtils ../../../core/watchUtils ../../../core/promiseUtils ../../../core/Logger ../../../core/Collection ../../../core/Scheduler ../../../core/lang ../../../geometry/support/scaleUtils ../../../symbols/support/unitConversionUtils dojo/_base/lang dojo/has dojo/errors/CancelError ../../../Graphic ../../../symbols/Symbol3D ../../../tasks/support/Query ./LayerView3D ./i3s/I3SUtil ./i3s/I3SElevationProvider ./i3s/I3SGeometryUtil ./i3s/I3SProjectionUtil ./i3s/I3SQueryEngine ./i3s/Highlights ./i3s/IDBCache ./graphics/graphicUtils ./support/LayerViewUpdatingPercentage ../support/projectionUtils ../support/aaBoundingBox ../webgl-engine/Stage ../webgl-engine/lib/Layer ../webgl-engine/lib/Geometry ../webgl-engine/lib/PreinterleavedGeometryData ../webgl-engine/lib/Object3D ../webgl-engine/lib/Texture ../webgl-engine/materials/Material ./support/attributeUtils ../webgl-engine/lib/Util ../lib/glMatrix".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E,J,G,K,M,U,N,W,R,V,Q,S,X,z,Z,O,g,e,f,n,x,I,L){function P(a,b,c,e,d){var g,h=!1;b.encoding===G.DDS_ENCODING_STRING?g=f.DDS_ENCODING:h=!(I.isPowerOfTwo(a.width)&&I.isPowerOfTwo(a.height));c=((a=b.usedByEngineMats.some(function(a){return a.getParams().atlasRegions})||b.atlas)?e:c)&&!h;return{mipmap:c,wrapClamp:a||!b.wrap,disableAnisotropy:a&&c&&d,encoding:g,noUnpackFlip:!0}}function Y(a){return a.data instanceof ArrayBuffer}function fa(a,b){for(var c=
1024,e=0;e<a.length;e++)c+=a[e].interleavedVertexData.byteLength;for(a=0;a<b.length;a++)e=b[a],e.data instanceof ArrayBuffer&&(c+=e.data.byteLength);return c}var ga=z.ModelContentType,ia=k.getLogger("esri.views.3d.layers.SceneLayerView3D"),na=[1,1,1,1],ka=[.8,.8,.8],wa=[.5,.5,.5];A=function(k){function p(){var a=null!==k&&k.apply(this,arguments)||this;return a._queryEngine=null,a._highlights=new W(a),a._elevationProvider=null,a._controllerCreated=!1,a._idbCache=new R.IDBCache("esri-scenelayer-cache",
"geometries",4),a._cancelCount=0,a._hasColors=!1,a._hasTextures=!1,a._hasData=!1,a.alwaysLoadEverythingModeEnabled=!1,a._cacheKeySuffix=null,a._definitionExpressionErrors=0,a._maxDefinitionExpressionErrors=20,a}return w(p,k),Object.defineProperty(p.prototype,"hasTexturesOrVertexColors",{get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"rendererNeedsTextures",{get:function(){return G.rendererNeedsTextures(this.layer.renderer)},
enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"elevationOffset",{get:function(){var a=null!=this.layer?this.layer.elevationInfo:null;if(null!=a&&"absolute-height"===a.mode){var b=q.getMetersPerVerticalUnitForSR(this.layer.spatialReference),c=v.getMetersPerUnit(a.unit);return(a.offset||0)*c/b}return 0},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"uncompressedTextureDownsamplingEnabled",{get:function(){return this.view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&
!this._useCompressedTextures},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"_useCompressedTextures",{get:function(){var a=this.layer.version,a=!B("trident")||1<a.major||1===a.major&&3<a.minor;return this.view.has("s3tc")&&a},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"_enableMipMaps",{get:function(){return!this.uncompressedTextureDownsamplingEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"_enableAtlasMipMaps",{get:function(){return this._enableMipMaps&&
this.view.has("standardDerivatives")},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"_atlasBiasCompensationEnabled",{get:function(){return!this.view.has("shaderTextureLOD")&&this._enableAtlasMipMaps},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"_disableAtlasAnisotropy",{get:function(){return this._atlasBiasCompensationEnabled},enumerable:!0,configurable:!0}),p.prototype.initialize=function(){var a=this;G.checkSceneLayerValid(this.layer);G.checkSceneLayerCompatibleWithView(this.layer,
this.view);this._initGraphicsController();this.maxGpuMemory=1E3;this.geoMemoryEstimate=this.texMemoryEstimate=this.gpuMemoryEstimate=0;this._stage=this.view._stage;this._matId2Meta={};this._texId2Meta={};this._nodeId2Meta={};this._addThisLayerToStage();this._elevationProvider=new K({layerView:this,stageLayer:this._stageLayer});this.handles.add([r.init(this.view,"clippingArea",function(){return a._clippingAreaChanged()}),r.init(this.layer,"renderer",function(b){return a._rendererChange(b)}),r.init(this.layer,
"objectIdFilter",function(){return a._filterChange()}),r.init(this.layer,"elevationInfo",function(){return a._elevationInfoChanged()}),r.init(this,"_controller.parsedDefinitionExpression",function(){return a._filterChange()}),r.watch(this,"fullOpacity",function(b){return a._opacityChange(b)}),r.watch(this,["elevationOffset","rendererNeedsTextures"],function(){return a._reloadAll()}),r.watch(this,"uncompressedTextureDownsamplingEnabled",function(){return a._reloadAll()}),r.init(this,"suspended",function(b){return a.setVisibility(!b)})],
"sceneLayerHandles");this._idbCache.init();this._cacheKeySuffix=G.getCacheKeySuffix(this.layer.spatialReference,this.view.renderSpatialReference)},p.prototype.destroy=function(){this.handles.remove("sceneLayerHandles");this._removeThisLayerFromStage();this._stage=null;this._idbCache&&(this._idbCache.destroy(),this._idbCache=null);null!=this._controller&&(this._controller.destroy(),this._controller=null);this._highlights.destroy();this._nodeId2Meta=this._texId2Meta=this._matId2Meta=null;this.emit("visible-geometry-changed");
this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)},p.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)},p.prototype.isUpdating=function(){return this._controllerCreated?!(!this._controller||!this._controller.updating):!0},p.prototype.memEstimateTextureAdded=function(a){a=a.getEstimatedTexMemRequiredMB();this.gpuMemoryEstimate+=a;this.texMemoryEstimate+=
a},p.prototype.memEstimateTextureRemoved=function(a){a=a.getEstimatedTexMemRequiredMB();this.gpuMemoryEstimate-=a;this.texMemoryEstimate-=a},p.prototype.memEstimateGeometryAdded=function(a){a=a.estimateGpuMemoryUsage()/1E6;this.gpuMemoryEstimate+=a;this.geoMemoryEstimate+=a},p.prototype.memEstimateGeometryRemoved=function(a){a=a.estimateGpuMemoryUsage()/1E6;this.gpuMemoryEstimate-=a;this.geoMemoryEstimate-=a},p.prototype.isBundleAlreadyAddedToStage=function(a,b){return null!=this._nodeId2Meta[a.id]&&
null!=this._nodeId2Meta[a.id].engineObjectsPerBundle&&null!=this._nodeId2Meta[a.id].engineObjectsPerBundle[b]},p.prototype._initGraphicsController=function(){var a=this;this.layer.createGraphicsController({layerView:this,layerViewRequiredFunctions:{addBundle:function(b,c,e){return a._addBundle(b,c,e)},isBundleAlreadyAddedToStage:function(b,c){return a.isBundleAlreadyAddedToStage(b,c)},isOverMemory:function(){return a._isOverMemory()},removeNodeData:function(b){return a._removeNodeDataFromStage(b.id)},
getAddedNodeIDs:function(){return a._getAddedNodeIDs()},areAllBundlesLoaded:function(b){return a._areAllBundlesLoaded(b)}},layerViewOptionalFunctions:{setPolygonOffset:function(b,c){return a._setPolygonOffset(b,c?1:0)},traversalOptions:{initDepthFirst:!1,neighborhood:!0,perLevelTraversal:!1,allowPartialOverlaps:!1},textureOptions:{useCompressedTextures:this._useCompressedTextures},getLoadedAttributes:function(b){return a._getLoadedAttributes(b)},setAttributeData:function(b,c,e){return a._setAttributeData(b,
c,e)},additionalCancelNodeLoadingHandler:function(){return a._cancel()},loadCachedBundle:function(b,c,e){return a._loadCachedBundle(b,c,e)},addCachedBundle:function(b,c,e,d){return a._addCachedBundle(b,c,e,d)}}}).then(function(b){a._controller=b;b.watch("rootNodeVisible",function(){a.notifyChange("suspended")})}).always(function(){a._controllerCreated=!0;a.notifyChange("updating")})},p.prototype.setMaxGpuMemory=function(a){this.maxGpuMemory=a},p.prototype.setVisibility=function(a){if(this._stage&&
this._stageLayer){var b=this._stageLayer.getId(),c=0<=this._stage.getViewContent().indexOf(b);!!a!==c&&(b=[b],a?(this._stage.addToViewContent(b),a=this._isIntegratedMesh()?"im":"scene",this.view.elevationProvider.register(a,this._elevationProvider),this.visibleGeometryChanged()):(this._stage.removeFromViewContent(b),this.visibleGeometryChanged(),this.view.elevationProvider.unregister(this._elevationProvider)))}},p.prototype.getStats=function(){var a={nodesInIndex:0,knownFeatures:0,activeMaterials:0,
"Total GPU Memory Estimate":this.gpuMemoryEstimate+"MB","Geometry Memory Estimate":this.geoMemoryEstimate+"MB","Texture Memory Estimate":this.texMemoryEstimate+"MB"};return this._controller?(a.nodesInIndex=Object.keys(this._controller.nodeIndex).length,a.activeMaterials=Object.keys(this._matId2Meta).length,a):a},p.prototype._addThisLayerToStage=function(){for(var a=this._stage,b=new Uint8Array(256),c=0;c<b.length;c++)b[c]=255;this._whiteTexture=new f(b,"white",{width:8,height:8});a.add(ga.TEXTURE,
this._whiteTexture);b=this.layer.id;this._stageLayer=b=new Z(b,{},b);a.add(ga.LAYER,b)},p.prototype._removeThisLayerFromStage=function(){if(null!=this._stageLayer){var a=this._stage;a.remove(ga.TEXTURE,this._whiteTexture.getId());this._removeAllNodeDataFromStage();I.assert(I.objectEmpty(this._nodeId2Meta));I.assert(I.objectEmpty(this._matId2Meta));I.assert(I.objectEmpty(this._texId2Meta));a.remove(ga.LAYER,this._stageLayer.getId());this._matId2Meta={};this._texId2Meta={};this._nodeId2Meta={};this._stageLayer=
void 0;this.gpuMemoryEstimate=0}},p.prototype._getLoadedAttributes=function(a){return(a=this._nodeId2Meta[a.id])&&1===a.engineObjects.length?a.engineObjects[0].getMetadata().loadedAttributes:void 0},p.prototype._setAttributeData=function(a,b,c){var e=this._nodeId2Meta[a.id];if(e&&1===e.engineObjects.length){var e=e.engineObjects[0],d=e.getMetadata();d.loadedAttributes=b;d.attributeData=c;this._setObjectSymbology(e);this._applyFilters(a);this.visibleGeometryChanged(e)}},p.prototype._isOverMemory=function(){if(this.gpuMemoryEstimate>
this.maxGpuMemory&&this.gpuMemoryEstimate!==this.warnGpuMemoryEstimate){this.warnGpuMemoryEstimate=this.gpuMemoryEstimate;var a=function(a){return a.toLocaleString(void 0,{maximumFractionDigits:1})+" Mb"};ia.warn("GPU Memory Limit exceeded!\nLimit: "+a(this.maxGpuMemory)+" Current: "+a(this.gpuMemoryEstimate)+"\n(Textures: "+a(this.texMemoryEstimate)+" Geometry: "+a(this.geoMemoryEstimate)+")")}return this.gpuMemoryEstimate>this.maxGpuMemory},p.prototype._getAddedNodeIDs=function(){return Object.keys(this._nodeId2Meta)},
p.prototype._calcEngineMaterialTransparencyParams=function(a,b,c){var e=this.fullOpacity,d=1-I.clamp(I.fallbackIfUndefined(b.transparency,0),0,1);a=1>d||1>e||a&&C.endsWith(a.channels,"a")||!0===b.useVertexColorAlpha||c;return{opacity:d,layerOpacity:e,transparent:a}},p.prototype._calcEngineMaterialDoubleSidedParams=function(a){return null!=a.doubleSided?a.doubleSided:!0},p.prototype._calcEngineMaterialCullFaceParams=function(a){return a.cullFace?a.cullFace:null!=a.doubleSided?a.doubleSided?"none":
"back":"none"},p.prototype._getMaterialParameters=function(a,b,c){var e;null!=a&&(e=(e=this._texId2Meta[b])&&e.engineTex?e.engineTex.getId():this._whiteTexture.getId());b=c.params;var d=I.fallbackIfUndefined(b.diffuse,ka);"standard"!==c.type&&ia.warn("Unknown material type '"+c.type+"', must be 'standard'");void 0===b.reflectivity&&ia.warn("Material parameter 'reflectivity' is missing.");c=this._isIntegratedMesh();e={ambient:d,diffuse:d,specular:I.fallbackIfUndefined(b.specular,wa),shininess:I.fallbackIfUndefined(b.shininess,
64),atlasRegions:b.vertexRegions,textureId:e,vertexColors:this._hasVertexColors(),symbolColors:this._hasSymbolColors(),flipV:!1,doubleSided:this._calcEngineMaterialDoubleSidedParams(b),cullFace:this._calcEngineMaterialCullFaceParams(b),writeStencil:c,receiveSSAO:!c,groundNormalShading:c};c||(a=this._calcEngineMaterialTransparencyParams(a,b),y.mixin(e,a));return e},p.prototype._createEngineMaterial=function(a,b,c,e,d){var g=null!=a?this._getI3STexEncoding(a):null,h=this._getMaterialParameters(a,b,
c),h=new n(h,e);if(h.metadata={i3sMatId:e,i3sTexId:b,i3sTex:a,i3sMatParams:c.params},null!=a){(c=this._texId2Meta[b])?c.usedByEngineMats.push(h):(c={id:b,usedByEngineMats:[h],images:a.images,encoding:g,atlas:!0===a.atlas,wrap:"none"!==a.wrap[0]||"none"!==a.wrap[1]},this._texId2Meta[b]=c);a:{for(a=0;a<d.length;a++)if(g=d[a],g.i3sTexId===b){d=g.data;break a}d=null}null!=d&&null==c.engineTex&&(a=P(d,c,this._enableMipMaps,this._enableAtlasMipMaps,this._disableAtlasAnisotropy),c.engineTex=new f(d,c.id,
a),this._stage.add(ga.TEXTURE,c.engineTex),this.memEstimateTextureAdded(c.engineTex));if(null!=c.engineTex)for(d=c.engineTex.getId(),a=0,c=c.usedByEngineMats;a<c.length;a++)c[a].setParameterValues({textureId:d})}return this._matId2Meta[e]||(this._matId2Meta[e]={}),this._matId2Meta[e][b]={engineMat:h,refCount:1},h},p.prototype._getI3STexEncoding=function(a){var b=G.getAppropriateTextureEncoding(a.encoding,this._useCompressedTextures);return-1<b?a.encoding[b]:a.encoding},p.prototype._hasNonWhiteColors=
function(a){var b=a.data,c=a.size,e=a.strideIdx;for(a=a.offsetIdx;a<b.length;a+=e)for(var d=0;c>d;d++)if(255!==b[a+d])return!0;return!1},p.prototype._getVertexBufferLayout=function(a,b){var c=a.params.materialID,e=b.materialDefinitions[c];I.assert(void 0!==e,"geometry wants unknown material "+c);var d;a=a.params.textureID||"none";"none"!==a&&((null==b.textureDefinitions||null==b.textureDefinitions[a])&&ia.warn("textureDefinitions missing in shared resource"),d=b.textureDefinitions[a]);b=this._getMaterialParameters(d,
a,e);return n.getVertexBufferLayout(b)},p.prototype._createEngineMat=function(a,b,c){var e=a.params.materialID,d=b.materialDefinitions[e];I.assert(void 0!==d,"geometry wants unknown material "+e);var f;a=a.params.textureID||"none";"none"!==a&&((null==b.textureDefinitions||null==b.textureDefinitions[a])&&ia.warn("textureDefinitions missing in shared resource"),f=b.textureDefinitions[a]);this._matId2Meta[e]&&this._matId2Meta[e][a]?(c=this._matId2Meta[e][a],b=c.engineMat,c.refCount++):b=this._createEngineMaterial(f,
a,d,e,c);return b},p.prototype._areAllBundlesLoaded=function(a){if(null==this._nodeId2Meta[a.id]||null==this._nodeId2Meta[a.id].engineObjectsPerBundle)return!1;for(var b=0;b<a.featureData.length;b++)if(null==this._nodeId2Meta[a.id].engineObjectsPerBundle[b])return!1;return!0},p.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"},p.prototype._findGraphicNodeAndIndex=function(a){a=x.attributeLookup(a.attributes,this._getObjectIdField());for(var b=0,c=Object.keys(this._nodeId2Meta);b<
c.length;b++)for(var e=c[b],d=this._nodeId2Meta[e].engineObjects,f=0;f<d.length;f++){var g=d[f].getMetadata().featureIds.indexOf(a);if(-1!==g)return{node:this._controller.nodeIndex[e],nodeId:e,bundleNr:f,index:g}}return null},p.prototype._getGraphicIndices=function(a,b,c){a=this._nodeId2Meta[a.id].engineObjects;if(!a||!a[b])return[];b=a[b].getMetadata();a=[];for(var e=this._getObjectIdField(),d=0;d<c.length;d++){var f=x.attributeLookup(c[d].attributes,e),f=b.featureIds.indexOf(f);-1!==f&&a.push(f)}return a},
p.prototype.whenGraphicBounds=function(b){b=this._findGraphicNodeAndIndex(b);if(null!=b&&(b=this._boundingBoxCornerPoints(b.index,this._nodeId2Meta[b.nodeId].engineObjects[b.bundleNr],new Float64Array(24)),S.bufferToBuffer(b,this.view.renderSpatialReference,0,b,this.view.spatialReference,0,8))){var c=X.create(X.NEGATIVE_INFINITY);return X.expandBuffer(c,b,0,8),a.resolve({boundingBox:c,screenSpaceObjects:[]})}return a.reject()},p.prototype.whenGraphicAttributes=function(a,b){var c=this;return G.whenGraphicAttributes(this.layer,
[a],this._getObjectIdField(),b,function(){var b=c._findGraphicNodeAndIndex(a);return{node:b.node,indices:[b.index]}},{ignoreUnavailableFields:!0,populateObjectId:!0}).then(function(a){return a[0]})},p.prototype.getGraphicsFromStageObject=function(b,c){if(this.layer instanceof d)return a.reject();var e=b.getMetadata();b=b.getComponentFromTriangleNr(0,c);return null!=b&&null!=e.featureIds&&b<e.featureIds.length?(e=this._createGraphic(b,e),a.resolve(e)):a.reject()},p.prototype._getCacheKey=function(a){return a.baseUrl+
this._cacheKeySuffix},p.prototype._cachingEnabled=function(){return!this._controller.disableCache&&0===this.elevationOffset&&null!=this._cacheKeySuffix},p.prototype._cancel=function(){this._cancelCount=this._cancelCount+1|0},p.prototype._handleCancelled=function(a){if(0<(this._cancelCount-a|0))throw new D;},p.prototype._loadCachedBundle=function(b,c,e){var d=this,f=this._cancelCount;return this._cachingEnabled()?this._idbCache.get(this._getCacheKey(b)).then(function(a){if(null==a)return null;if(d._handleCancelled(f),
a.nodeVersion!==b.version)return d._idbCache.remove(d._getCacheKey(b)),null;var c=function(b){if(null==b.data)return!0;var c=d._getI3STexEncoding(a.sharedResource.textureDefinitions[b.i3sTexId]);return b.encoding!==c};return d.rendererNeedsTextures&&a.textureData.some(c)?e(a.allGeometryData,a.sharedResource).then(function(c){return a.textureData=c,c.every(Y)&&d._idbCache.put(d._getCacheKey(b),a).otherwise(function(){return ia.warn("Failed to update node with textures in IndexedDB cache: "+b.id)}),
d._handleCancelled(f),a}):a}):a.resolve(null)},p.prototype._addBundle=function(a,b,c){var e=this;return this._transformBundle(a,b,c).then(function(d){if(e._cachingEnabled()){var f=d.allGeometryData,g=d.transformedGeometries,h=d.sharedResource,k=d.byteSize,l=d.textureData.map(function(a){return Y(a)?a:{i3sTexId:a.i3sTexId,encoding:a.encoding,data:null}});e._idbCache.put(e._getCacheKey(a),{allGeometryData:f,transformedGeometries:g,textureData:l,sharedResource:h,nodeVersion:a.version,byteSize:k}).otherwise(function(){return ia.warn("Failed to store node in IndexedDB cache: "+
a.id)})}return e._addCachedBundle(a,b,d,c.attributeDataInfo)})},p.prototype._transformBundle=function(b,c,e){c=e.allGeometryData;var d=e.geometryBuffer,f=e.textureData,h=e.sharedResource,k=this._hasColors,l=[];for(e=0;e<c.length;e++)for(var m=c[e],n=m.componentOffsets,q=function(a){var c=r._getVertexBufferLayout(a,h);a=M.interleaveGeometryBuffer(a,d,c,[{name:I.VertexAttrConstants.NORMAL,byteValue:0},{name:I.VertexAttrConstants.COLOR,byteValue:255},{name:I.VertexAttrConstants.SYMBOLCOLOR,byteValue:0}]);
var e=new g(new Float32Array(a),c,n||g.DefaultOffsets),f=r._controller.crsIndex,m=r._controller.crsVertex,q=r.view.renderSpatialReference,p=L.vec4d.set(b.mbs,ya);p[2]+=r.elevationOffset;m=U.reprojectPoints(U.ReprojectionTypes.PER_VERTEX,e.getAttribute(I.VertexAttrConstants.POSITION),p,f,m,q);if(!r._isIntegratedMesh()&&r._controller.isMeshPyramid){var t={normals:e.getAttribute(I.VertexAttrConstants.NORMAL),positions:e.getAttribute(I.VertexAttrConstants.POSITION),normalInd:e.getIndices(I.VertexAttrConstants.NORMAL),
positionInd:e.getIndices(I.VertexAttrConstants.POSITION)};G.processNormals(t,r.layer.normalReferenceFrame||"none",function(a,b){return U.reprojectNormalsPerVertex(a,p,f,b,q)})}(e=e.getAttribute(I.VertexAttrConstants.COLOR))&&(k=k||r._hasNonWhiteColors(e));l.push({layout:c,interleavedVertexData:a,corMatrices:m,hasNonWhiteColors:k})},r=this,p=0,m=m.geometries;p<m.length;p++)q(m[p]);return a.resolve({allGeometryData:c,transformedGeometries:l,textureData:f,sharedResource:h,nodeVersion:b.version,byteSize:fa(l,
f)})},p.prototype._addCachedBundle=function(b,c,d,f){if(this._isOverMemory())return a.reject();var h=d.allGeometryData,k=d.transformedGeometries,l=d.textureData,m=d.sharedResource;if(!this.rendererNeedsTextures)for(d=0;d<l.length;d++)l[d].data=null;d=this._stage;var n={};n[ga.OBJECT]={};n[ga.GEOMETRY]={};n[ga.MATERIAL]={};n[ga.TEXTURE]={};var q=this._stageLayer,r=q.getId();if(null!=this._nodeId2Meta[b.id]&&null!=this._nodeId2Meta[b.id].engineObjectsPerBundle&&this._nodeId2Meta[b.id].engineObjectsPerBundle[c])return this._applyFilters(b),
a.resolve();null==this._nodeId2Meta[b.id]&&(this._nodeId2Meta[b.id]={engineObjects:[],engineObjectsPerBundle:[]});this._nodeId2Meta[b.id].engineObjectsPerBundle[c]=[];for(var p=0,t=this._hasColors,v=0;v<h.length;v++){for(var u=h[v],w=u.componentOffsets,x=u.featureIds,y=b.id+"|"+x[0],z=[],C=[],B=[],A=void 0,D=0,u=u.geometries;D<u.length;D++){var E=u[D],F=this._createEngineMat(E,m,l),A=k[p++],t=t||A.hasNonWhiteColors,G=new g(new Float32Array(A.interleavedVertexData),A.layout,w||g.DefaultOffsets),A=
A.corMatrices,J=L.mat4d.create(A.localTrafo);null!=E.transformation&&L.mat4d.multiply(J,E.transformation,J);E=z.length;G=new O(G,y+(0<E?"_"+E:""));z.push(G);C.push(J);B.push([F]);this.memEstimateGeometryAdded(G.getData());n[ga.MATERIAL][F.getId()]=F;n[ga.GEOMETRY][G.getId()]=G}w=new e({idHint:b.id,name:y,geometries:z,materials:B,transformations:C,castShadow:!0,metadata:{i3sNode:b.id,ceLayer:r,featureIds:x,attributeData:f?f.attributeData:null,loadedAttributes:f?f.loadedAttributes:null,layerUid:this.layer.uid}});
x=L.mat4d.create();L.mat4d.identity(x);L.mat4d.multiply(x,A.globalTrafo,x);w.setObjectTransformation(x);this._nodeId2Meta[b.id].engineObjectsPerBundle[c].push(w);this._nodeId2Meta[b.id].engineObjects.push(w);n[ga.OBJECT][w.getId()]=w;this._setObjectSymbology(w);this._applyFilters(b);this._highlights.objectCreated(w);this.visibleGeometryChanged(w)}d.beginMod();c=n[ga.OBJECT];for(var K in c)c.hasOwnProperty(K)&&q.addObject(c[K]);for(var I in n)if(n.hasOwnProperty(I)){K=n[I];for(var M in K)K.hasOwnProperty(M)&&
null==d.get(I,M)&&d.add(I,K[M])}return d.endMod(),!this._hasTextures&&null!=b.textureData&&0<b.textureData.length&&(this._hasTextures=!0),this._hasColors=t,this._hasData=!0,this.notifyChange("hasTexturesOrVertexColors"),a.resolve()},p.prototype._clippingAreaChanged=function(){var a=this,b=[];if(S.extentToBoundingBox(this.view.clippingArea,b,this.view.renderSpatialReference)?this._clippingArea=b:this._clippingArea=null,this._updateFilters(),this._controller){var c=this._controller.nodeIndex;c&&Object.keys(this._nodeId2Meta).forEach(function(b){return a._applyFilters(c[b])});
this._controller.updateClippingArea(this.view.clippingArea)}},p.prototype._filterChange=function(){if(this._updateFilters(),this._controller){var a=this._controller.nodeIndex;if(a)for(var b=0,c=Object.keys(this._nodeId2Meta);b<c.length;b++)this._applyFilters(a[c[b]])}},p.prototype._updateFilters=function(){var a=this,b=[];if(this.layer.objectIdFilter){var c=new Float64Array(this.layer.objectIdFilter.ids),e="include"===this.layer.objectIdFilter.method;c.sort();b.push(function(b,d){return a._objectIdFilter(c,
e,d)})}if(this._controller&&this._controller.parsedDefinitionExpression&&this._controller.definitionExpressionFields){this._definitionExpressionErrors=0;var d=this._controller.parsedDefinitionExpression,f=this._controller.definitionExpressionFields;b.push(function(b,c){return a._sqlFilter(b,d,f,c)})}this._clippingArea&&b.push(function(b,c){return a._boundingboxFilter(b,a._clippingArea,c)});this._filters=b},p.prototype._sqlFilter=function(a,c,e,d){var f={},g=new b(null,null,f);g.layer=this.layer;var h=
this.layer.objectIdField,k=0,l=0,m=function(a){var b=a.getMetadata();a=b.featureIds;for(var m=b.attributeData,b=e.every(function(a){return null!=m[a]||a===h}),q=0;q<a.length&&k<d.length;q++)if(d[k]===a[q]){var r=!0;if(b){f[h]=a[q];for(var r=0,p=e;r<p.length;r++){var t=p[r];t!==h&&(f[t]=G.getCachedAttributeValue(m[t],q))}r=n._evaluateClause(c,g)}r&&(d[l]=d[k],l++);k++}},n=this,q=0;for(a=this._nodeId2Meta[a.id].engineObjects;q<a.length;q++)m(a[q]);d.length=l},p.prototype._evaluateClause=function(a,
b){try{return a.testFeature(b)}catch(Ea){return this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&ia.error("Error while evaluating definitionExpression: "+Ea),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&ia.error("Further errors are ignored"),!1}},p.prototype._objectIdFilter=function(a,b,c){for(var e=0,d=0;e<c.length;)0<=u.binaryIndexOf(a,c[e])===b&&(c[d]=c[e],d++),e++;c.length=d},p.prototype._boundingboxFilter=function(a,
b,c){var e=[0,0,0,0];S.mbsToMbs(a.mbs,this._controller.crsIndex,e,this.view.renderSpatialReference);e=null!=b?G.intersectBoundingBoxWithMbs(b,e):2;if(2!==e){if(0===e)return void(c.length=0);var d=e=0,f=0;for(a=this._nodeId2Meta[a.id].engineObjects;f<a.length;f++){var g=a[f],h=g.getMetadata().featureIds,k=g.getObjectTransformation(),l=g.getGeometryRecords()[0].getShaderTransformation();if(L.mat4d.multiply(k,l),0===k[1]&&0===k[2]&&0===k[3]&&0===k[4]&&0===k[6]&&0===k[7]&&0===k[8]&&0===k[9]&&0===k[11]&&
1===k[15]){l=sa;l[0]=(b[0]-k[12])/k[0];l[1]=(b[1]-k[13])/k[5];l[2]=(b[2]-k[14])/k[10];l[3]=(b[3]-k[12])/k[0];l[4]=(b[4]-k[13])/k[5];l[5]=(b[5]-k[14])/k[10];for(var g=g.getGeometryRecords()[0].geometry,k=g.getComponentCount(),m=0;k>m&&e<c.length;m++)if(c[e]===h[m]){var n=g.getComponentAABB(m,aa);X.intersects(l,n)&&(c[d]=c[e],d++);e++}}}c.length=d}},p.prototype._applyFilters=function(a){if(this._nodeId2Meta[a.id]&&null!=this._nodeId2Meta[a.id].engineObjects){for(var b=this._nodeId2Meta[a.id].engineObjects,
c=0;c<b.length;c++){var e=b[c];e.unhideAllComponents()}if(0!==this._filters.length){for(var c=[],d=0;d<b.length;d++)e=b[d],c=c.concat(e.getMetadata().featureIds);e=c.length;for(d=0;d<this._filters.length;d++)this._filters[d](a,c);if(c.length!==e)for(d=a=0;d<b.length;d++)for(var e=b[d],f=e.getGeometryRecords()[0],g=e.getMetadata().featureIds,h=0;h<g.length;h++){var k=g[h];a>=c.length||c[a]!==k?e.setComponentVisibility(f,h,!1):a++}}}},p.prototype._removeAllNodeDataFromStage=function(){for(var a=0,b=
Object.keys(this._nodeId2Meta);a<b.length;a++)this._removeNodeDataFromStage(b[a])},p.prototype._removeNodeDataFromStage=function(a){if(null!=this._nodeId2Meta[a]&&null!=this._nodeId2Meta[a].engineObjects){for(var b=this._stage,c=this._stageLayer,e=this._nodeId2Meta[a].engineObjects,d=0;d<e.length;++d){var f=e[d];this._highlights.objectDeleted(f);this.visibleGeometryChanged(f);c.removeObject(f);for(var g=f.getGeometryRecords(),h=0;h<g.length;h++){var k=g[h];this.memEstimateGeometryRemoved(k.geometry.getData());
b.remove(ga.GEOMETRY,k.geometry.getId());for(var l=0;l<k.materials.length;l++){var m=k.materials[l],n=m.getId(),q=m.metadata.i3sMatId,r=m.metadata.i3sTexId||"none",p=this._matId2Meta[q][r];I.assert(0<p.refCount);p.refCount--;0===p.refCount&&this._removeMaterial(n,r,q,m,b)}}b.remove(ga.OBJECT,f.getId())}delete this._nodeId2Meta[a]}},p.prototype._removeMaterial=function(a,b,c,e,d){if(d.remove(ga.MATERIAL,a),"none"!==b){a=this._texId2Meta[b];var f=a.usedByEngineMats;e=f.indexOf(e);if(I.assert(-1<e),
f[e]=f[f.length-1],f.pop(),1>f.length)(e=a.engineTex)&&e!==this._whiteTexture&&(this.memEstimateTextureRemoved(e),d.remove(ga.TEXTURE,a.engineTex.getId())),a.engineTex=void 0,delete this._texId2Meta[b]}delete this._matId2Meta[c][b];I.objectEmpty(this._matId2Meta[c])&&delete this._matId2Meta[c]},p.prototype._setPolygonOffset=function(a,b){if(null!=this._nodeId2Meta[a.id]&&null!=this._nodeId2Meta[a.id].engineObjectsPerBundle){b={polygonOffset:b};for(var c=0;c<this._nodeId2Meta[a.id].engineObjectsPerBundle.length;c++)for(var e=
this._nodeId2Meta[a.id].engineObjectsPerBundle[c],d=0;d<e.length;d++)for(var f=e[d].getGeometryRecords(),g=0;g<f.length;g++)for(var h=f[g].materials,k=0;k<h.length;k++)h[k].setParameterValues(b)}},p.prototype._rendererChange=function(a){if(this._currentRenderer=a,a&&(a.colorInfo||a.sizeInfo)&&ia.warn("renderer.colorInfo and renderer.sizeInfo are not supported for Scene Services. Use visualVariables instead."),a){var b=0;for(a=a.getSymbols();b<a.length;b++){var c=a[b];"mesh-3d"!==c.type&&ia.error("Symbols of type '"+
c.type+"' are not supported for 3D Object Scene Services.")}}},p.prototype._getRenderingInfo=function(a){var b=this._currentRenderer,c=b&&b.getSymbol(a);if(!(c instanceof m&&this._hasSymbolColors()))return null;var e,d,c={symbol:c};if(b&&b.visualVariables)for(a=b.getVisualVariableValues(a),b=0;b<a.length;b++){var f=a[b],g=f.variable.type;"color"===g?e=f.value:"opacity"===g&&(d=f.value)}return e&&(c.color=[e.r/255,e.g/255,e.b/255]),null!=d?c.opacity=d:e&&null!=e.a&&(c.opacity=e.a),c},p.prototype._getSymbolFillMaterial=
function(a,b){var c=0;for(a=a.symbolLayers.items;c<a.length;c++){var e=a[c];if("fill"===e.type)return c=e.material,a=null!=c?c.color:null,null!=a?(la[0]=a.r/255,la[1]=a.g/255,la[2]=a.b/255,la[3]=a.a,b.color=la):b.color=null,void(b.colorMixMode=null!=c?c.colorMixMode:null)}b.color=null;b.colorMixMode=null},p.prototype._hasSymbolColors=function(){if(this._isIntegratedMesh()||!this.layer.store.defaultGeometrySchema)return!1;var a=this.layer.store.defaultGeometrySchema.featureAttributes;return a&&a.faceRange&&
a.id},p.prototype._isIntegratedMesh=function(){return this.layer instanceof d},p.prototype._hasVertexColors=function(){return null!=this.layer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.layer.cachedDrawingInfo||!this.layer.cachedDrawingInfo.color)},p.prototype._setObjectSymbology=function(a){if(this._hasSymbolColors()){for(var c=a.getMetadata(),e=c.featureIds?c.featureIds.length:1,d=new b(null,null,{}),f=d.attributes,g=this.layer.objectIdField,h=this._currentRenderer&&this._currentRenderer.requiredFields,
k=a.geometryRecords[0].geometry,l=k.data.getAttribute(I.VertexAttrConstants.SYMBOLCOLOR),m=!1,n=new Uint8Array(4),q={color:null,colorMixMode:null},r=null,p=0;e>p;p++){if(null!=g&&null!=c.featureIds&&(f[g]=c.featureIds[p]),null!=h&&null!=c.attributeData)for(var t=0,v=h;t<v.length;t++){var u=v[t];null!=c.attributeData[u]&&(f[u]=G.getCachedAttributeValue(c.attributeData[u],p))}(v=this._getRenderingInfo(d))?(v.symbol!==r&&(r=v.symbol,this._getSymbolFillMaterial(v.symbol,q)),t=v.color,v=v.opacity,t=null==
t||null==v?V.overrideColor(t,v,q.color,q.color&&q.color[3],na):V.overrideColor(t,v,null,null,na),1>t[3]&&(m=!0),G.encodeSymbolColor(t,q.colorMixMode,n)):G.encodeSymbolColor(null,null,n);this._setComponentColor(k,p,l,n)}a.geometryColorAttrsUpdated(0);a=a.getGeometryRecords();for(c=0;c<a.length;c++)for(e=a[c],d=0;d<e.materials.length;d++)f=e.materials[d],g=f.getParams().transparent,h=f.getParams().opacity,f.metadata.symbolIsTransparent=m,k=this._calcEngineMaterialTransparencyParams(f.metadata.i3sTex,
f.metadata.i3sMatParams,f.metadata.symbolIsTransparent),g===k.transparent&&h===k.opacity||f.setParameterValues({transparent:k.transparent,opacity:k.opacity})}},p.prototype._setComponentColor=function(a,b,c,e){var d=c.data,f=c.offsetIdx,g=c.strideIdx;I.assert(4===c.size);c=f+a.data.componentOffsets[b+1]*g;for(a=f+a.data.componentOffsets[b]*g;c>a;a+=g)d[a]=e[0],d[a+1]=e[1],d[a+2]=e[2],d[a+3]=e[3]},p.prototype._elevationInfoChanged=function(){var a=this.layer.elevationInfo&&this.layer.elevationInfo.unit;
a&&!v.supportsUnit(a)&&ia.warn("elevationInfo.unit","'"+a+"' is not a valid unit")},p.prototype._reloadAll=function(){this._removeAllNodeDataFromStage();null!=this._controller&&this._controller.restartNodeLoading()},p.prototype._opacityChange=function(a){for(var b in this._matId2Meta)for(var c in this._matId2Meta[b]){a=this._matId2Meta[b][c].engineMat;var e=a.getParams(),d=this._calcEngineMaterialTransparencyParams(a.metadata.i3sTex,a.metadata.i3sMatParams,a.metadata.symbolIsTransparent);e.transparent===
d.transparent&&e.layerOpacity===d.layerOpacity||a.setParameterValues(d)}},p.prototype.queryExtent=function(a){return this._ensureQueryEngine().queryExtent(a)},p.prototype.queryFeatureCount=function(a){return this._ensureQueryEngine().queryFeatureCount(a)},p.prototype.queryFeatures=function(a){return this._ensureQueryEngine().queryFeatures(a)},p.prototype.queryObjectIds=function(a){return this._ensureQueryEngine().queryObjectIds(a)},p.prototype._ensureQueryEngine=function(){return this._queryEngine||
(this._queryEngine=this._createQueryEngine()),this._queryEngine},p.prototype._createQueryEngine=function(){var a=this,b={id:0,index:0,object:null,bbCorners:new Float64Array(24)};return new N({forAll:function(c,e){a._forAllFeatures(function(e,d,f){b.id=e;b.index=d;b.object=f;a._boundingBoxCornerPoints(b.index,b.object,b.bbCorners);c(b)},e)},createGraphic:function(b){return a._createGraphic(b.index,b.object.getMetadata())},requestFields:function(b,c,e){return G.whenGraphicAttributes(a.layer,c,a._getObjectIdField(),
e,function(){var e=a._getGraphicIndices(b.node,b.bundleNr,c);return{node:b.node,indices:e}},{ignoreUnavailableFields:!1})},createExtentBuilder:function(){return a._createExtentBuilder()}},{enableObjectId:!0,enableOutFields:!!this.layer.objectIdField})},p.prototype._createExtentBuilder=function(){var a=this.view.renderSpatialReference,b=this.view.spatialReference,c=X.create(X.NEGATIVE_INFINITY),e=new Float64Array(24);return{add:function(d){S.bufferToBuffer(d.bbCorners,a,0,e,b,0,8)&&X.expandBuffer(c,
e,0,8)},getExtent:function(){return X.toExtent(c,b)}}},p.prototype._forAllFeatures=function(a,b,c){for(var e=0,d=Object.keys(this._nodeId2Meta);e<d.length;e++)for(var f=d[e],g=this._nodeId2Meta[f].engineObjects,h=0;h<g.length;h++)this._forAllFeaturesOfObject(g[h],a,c),b&&b({node:this._controller.nodeIndex[f],bundleNr:h})},p.prototype._forAllFeaturesOfObject=function(a,b,c){for(var e=a.getMetadata().featureIds,d=a.getGeometryRecords()[0],f=0;f<e.length;f++)(c||a.getComponentVisibility(d,f))&&b(e[f],
f,a,d)},p.prototype._createGraphic=function(a,c){var e={};if(null!=c.featureIds&&(e[this._getObjectIdField()]=c.featureIds[a]),null!=c.attributeData)for(var d=0,f=Object.keys(c.attributeData);d<f.length;d++){var g=f[d];e[g]=G.getCachedAttributeValue(c.attributeData[g],a)}a=new b(null,null,e);return a.layer=this.layer,a},p.prototype._boundingBoxCornerPoints=function(a,b,c){a=b.geometries[0].getComponentAABB(a,sa);for(var e=0;8>e;++e)ta[0]=1&e?a[0]:a[3],ta[1]=2&e?a[1]:a[4],ta[2]=4&e?a[2]:a[5],L.mat4d.multiplyVec3(b.objectTransformation,
ta),c[3*e]=ta[0],c[3*e+1]=ta[1],c[3*e+2]=ta[2];return c},p.prototype.highlight=function(a,e){var d=this,f=this._highlights;if(a instanceof E){e=f.acquireSet(e);var g=e.set,h=e.handle;return this.queryObjectIds(a).then(function(a){return f.setFeatureIds(g,a)}),h}if("number"==typeof a||a instanceof b)return this.highlight([a],e);if(a instanceof c&&(a=a.toArray()),Array.isArray(a)&&0<a.length){if(a[0]instanceof b)return a=a.map(function(a){return x.attributeLookup(a.attributes,d._getObjectIdField())}),
h=f.acquireSet(e),e=h.set,h=h.handle,f.setFeatureIds(e,a),h;if("number"==typeof a[0])return h=f.acquireSet(e),e=h.set,h=h.handle,f.setFeatureIds(e,a),h}return{remove:function(){}}},p.prototype.visibleGeometryChanged=function(a){var b=this;a?this._elevationProvider.objectChanged(a):this._elevationProvider.layerChanged();null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=t.schedule(function(){b.emit("visible-geometry-changed");b._visibleGeometryChangedSchedulerHandle=
null}))},l([h.property()],p.prototype,"layer",void 0),l([h.property()],p.prototype,"_controller",void 0),l([h.property({dependsOn:["_controller.updating"]})],p.prototype,"updating",void 0),l([h.property({readOnly:!0,aliasOf:"_controller.updatingPercentage"})],p.prototype,"updatingPercentageValue",void 0),l([h.property({readOnly:!0})],p.prototype,"hasTexturesOrVertexColors",null),l([h.property({readOnly:!0,dependsOn:["layer.renderer"]})],p.prototype,"rendererNeedsTextures",null),l([h.property({readOnly:!0,
dependsOn:["layer.elevationInfo"]})],p.prototype,"elevationOffset",null),l([h.property()],p.prototype,"alwaysLoadEverythingModeEnabled",void 0),l([h.property({dependsOn:["view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled","_useCompressedTextures"]})],p.prototype,"uncompressedTextureDownsamplingEnabled",null),l([h.property({dependsOn:["layer.version"]})],p.prototype,"_useCompressedTextures",null),p=l([h.subclass("esri.views.3d.layers.SceneLayerView3D")],p)}(h.declared(J,Q));
var ta=L.vec3d.create(),sa=X.create(),aa=X.create(),ya=L.vec4d.create(),la=[0,0,0,0];return A})},"esri/layers/IntegratedMeshLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./Layer ./mixins/SceneService ../symbols/support/ElevationInfo ../core/Error dojo/_base/lang".split(" "),function(A,p,w,l,h,d,u,r,a,k){return function(c){function d(a,d){a=c.call(this)||this;return a.geometryType="mesh",a.operationalLayerType=
"IntegratedMeshLayer",a.type="integrated-mesh",a.profile="mesh-pyramids",a.elevationInfo=null,a}return w(d,c),d.prototype.normalizeCtorArgs=function(a,c){return"string"==typeof a?k.mixin({},{url:a},c):a},d.prototype.load=function(){var a=this,c=this.loadFromPortal({supportedTypes:["Scene Service"]}).always(function(){return a._fetchService()}).then(function(){return a._verifyRootNodeAndUpdateExtent()});return this.addResolvingPromise(c),this.when()},d.prototype._validateLayer=function(c){if(c.layerType&&
"IntegratedMesh"!==c.layerType)throw new a("integratedmeshlayer:layer-type-not-supported","IntegratedMeshLayer does not support this layer type",{layerType:c.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new a("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new a("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,
supportedVersions:"1.x"});},l([h.shared("esri.layers.IntegratedMeshLayer")],d.prototype,"declaredClass",void 0),l([h.shared({"3d":"../views/3d/layers/SceneLayerView3D"})],d.prototype,"viewModulePaths",void 0),l([h.property({type:String,readOnly:!0})],d.prototype,"geometryType",void 0),l([h.property()],d.prototype,"operationalLayerType",void 0),l([h.property({json:{read:!1},readOnly:!0})],d.prototype,"type",void 0),l([h.property({type:r,json:{origins:{service:{read:{source:"elevationInfo"}}},read:{source:"layerDefinition.elevationInfo"},
write:{target:"layerDefinition.elevationInfo"}}})],d.prototype,"elevationInfo",void 0),d=l([h.subclass()],d)}(h.declared(d,u))})},"esri/layers/mixins/SceneService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../request ../../core/MultiOriginJSONSupport ../../core/Error ../../core/urlUtils ../../core/promiseUtils ../../core/requireUtils ../../core/Logger ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../Layer ../support/arcgisLayerUrl ./ArcGISService ./OperationalLayer ./PortalLayer".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m){var E=t.getLogger("esri.layers.mixins.SceneService");return function(b){function m(){var a=null!==b&&b.apply(this,arguments)||this;return a.blendMode=null,a.spatialReference=null,a.fullExtent=null,a.heightModelInfo=null,a.version={major:Number.NaN,minor:Number.NaN,versionString:""},a.copyright=null,a.sublayerTitleMode="item-title",a.title=null,a.layerId=null,a}return w(m,b),m.prototype.readSpatialReference=function(a,b){return this._readSpatialReference(b)},
m.prototype._readSpatialReference=function(a){if(null!=a.spatialReference)return v.fromJSON(a.spatialReference);a=a.store;a=(a=a.indexCRS||a.geographicCRS)&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10);return null!=a?new v(a):null},m.prototype.readFullExtent=function(a,b){a=b.store;b=this._readSpatialReference(b);return null==b||null==a||null==a.extent?null:new C({xmin:a.extent[0],ymin:a.extent[1],xmax:a.extent[2],ymax:a.extent[3],spatialReference:b})},m.prototype.readVersion=function(a,
b){a=b.store;b=null!=a.version?a.version.toString():"";a={major:Number.NaN,minor:Number.NaN,versionString:b};b=b.split(".");return 2<=b.length&&(a.major=parseInt(b[0],10),a.minor=parseInt(b[1],10)),a},m.prototype.readCopyright=function(a,b){return b.copyrightText},m.prototype.readTitlePortalItem=function(a,b){return"item-title"!==this.sublayerTitleMode?void 0:a},m.prototype.readTitleService=function(a,b){a=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return B.titleFromUrlAndName(this.url,
b.name);b=b.name||B.parse(this.url).title;return"item-title-and-service-name"===this.sublayerTitleMode&&a&&(b=a+" - "+b),B.cleanTitle(b)},m.prototype.readLayerId=function(a,b){return b.id},Object.defineProperty(m.prototype,"url",{set:function(a){a=B.sanitizeUrlWithLayerId(this,a,E);this._set("url",a.url);null!=a.layerId&&this._set("layerId",a.layerId)},enumerable:!0,configurable:!0}),m.prototype.writeUrl=function(a,b){B.writeUrlWithLayerId(this,a,"layers",b)},Object.defineProperty(m.prototype,"parsedUrl",
{get:function(){var b=this._get("url");if(!b)return null;b=a.urlToObject(b);return null!=this.layerId&&B.match.test(b.path)&&(b.path=b.path+"/layers/"+this.layerId),b},enumerable:!0,configurable:!0}),m.prototype.readRootNode=function(a,b){return b.store.rootNode},m.prototype._verifyRootNodeAndUpdateExtent=function(){var a=this;return this._fetchRootNode().then(function(b){return a._updateExtentFromRootNode(b)})},m.prototype._updateExtentFromRootNode=function(a){if(null!=this.fullExtent&&!this.fullExtent.hasZ&&
null!=a&&Array.isArray(a.mbs)&&4===a.mbs.length){var b=a.mbs[2];a=a.mbs[3];this.fullExtent.zmin=b-a;this.fullExtent.zmax=b+a}},m.prototype._fetchRootNode=function(){if(!this.rootNode)return k.resolve();var b=a.join(this.parsedUrl.path,this.rootNode);return d(b,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data}).otherwise(function(a){throw new r("sceneservice:root-node-missing","Root node missing.",{error:a,url:b});})},m.prototype._fetchService=function(){var a,b=this;return a=
null==this.layerId&&/SceneServer\/*$/i.test(this.url)?this._fetchFirstLayerId().then(function(a){null!=a&&(b.layerId=a)}):k.resolve(),a.then(function(){return b._fetchServiceLayer()})},m.prototype._fetchFirstLayerId=function(){return d(this.url,{query:{f:"json"},callbackParamName:"callback",responseType:"json"}).then(function(a){return a.data&&Array.isArray(a.data.layers)&&0<a.data.layers.length?a.data.layers[0].id:void 0})},m.prototype._fetchServiceLayer=function(){var a=this;return d(this.parsedUrl.path,
{query:{f:"json"},responseType:"json"}).then(function(b){b.ssl&&(a.url=a.url.replace(/^http:/i,"https:"));b=b.data;a.read(b,{origin:"service",url:a.parsedUrl});a._validateLayer(b)})},m.prototype._validateLayer=function(a){},m.prototype.createGraphicsController=function(a){var b=this;a.layer=this;var d=c.when(A,"../graphics/controllers/I3SOnDemandController").then(function(b){return new b(a)});return d.then(function(a){b.emit("graphics-controller-create",{graphicsController:a})}),d},l([h.shared({id:{json:{origins:{service:{read:!1},
"portal-item":{read:!1}}}}})],m.prototype,"properties",void 0),l([h.property({type:v})],m.prototype,"spatialReference",void 0),l([h.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],m.prototype,"readSpatialReference",null),l([h.property({type:C})],m.prototype,"fullExtent",void 0),l([h.reader("fullExtent",["store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],m.prototype,"readFullExtent",null),l([h.property({readOnly:!0,type:q})],m.prototype,
"heightModelInfo",void 0),l([h.property({readOnly:!0})],m.prototype,"version",void 0),l([h.reader("version",["store.version"])],m.prototype,"readVersion",null),l([h.property({type:String})],m.prototype,"copyright",void 0),l([h.reader("copyright",["copyrightText"])],m.prototype,"readCopyright",null),l([h.property({type:String})],m.prototype,"sublayerTitleMode",void 0),l([h.property({type:String})],m.prototype,"title",void 0),l([h.reader("portal-item","title")],m.prototype,"readTitlePortalItem",null),
l([h.reader("service","title",["name"])],m.prototype,"readTitleService",null),l([h.property({type:Number})],m.prototype,"layerId",void 0),l([h.reader("service","layerId",["id"])],m.prototype,"readLayerId",null),l([h.property()],m.prototype,"url",null),l([h.writer("url")],m.prototype,"writeUrl",null),l([h.property({dependsOn:["layerId"]})],m.prototype,"parsedUrl",null),l([h.property()],m.prototype,"store",void 0),l([h.property({type:String})],m.prototype,"rootNode",void 0),l([h.reader("rootNode",["store.rootNode"])],
m.prototype,"readRootNode",null),m=l([h.subclass("esri.layers.mixins.SceneService")],m)}(h.declared(y,D,u,b,m))})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("require exports ../../../../request ../../../../core/promiseUtils ../../../../core/Error ../../../../core/urlUtils ../../../../geometry/SpatialReference ../../../../geometry/support/webMercatorUtils ../../../../tasks/QueryTask ../../../../tasks/support/Query ../../support/projectionUtils ../../lib/glMatrix ../../webgl-engine/lib/Util ./I3SBinaryReader".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q){function v(a){return a&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10)}function y(a,b,d,g,e,f){if(null!=d){var h=Q;if(c.mbsToMbs(d.mbs,g,h,b),0!==B(a,h)){f.push(d);for(var h=null!=d.children?d.children.length:0,k=0;h>k;k++)y(a,b,e[d.children[k].id],g,e,f)}}}function B(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var f=0;if(c<a[0])var h=a[0]-c,f=f+h*h;d<a[1]&&(h=a[1]-d,f+=h*h);e<a[2]&&(h=a[2]-e,f+=h*h);c>a[3]&&(h=c-a[3],f+=h*h);d>a[4]&&(h=d-a[4],f+=h*h);e>a[5]&&
(h=e-a[5],f+=h*h);if(f>b*b)return 0;if(0<f)return 1;f=1/0;return c-a[0]<f&&(f=c-a[0]),d-a[1]<f&&(f=d-a[1]),e-a[2]<f&&(f=e-a[2]),a[3]-c<f&&(f=a[3]-c),a[4]-d<f&&(f=a[4]-d),a[5]-e<f&&(f=a[5]-e),f>b?2:1}function D(a,b,c){var d=[],e=c&&c.missingFields;c=c&&c.originalFields;for(var f=0;f<a.length;f++){for(var h=a[f],k=h.toLowerCase(),l=!1,m=0,q=b;m<q.length;m++){var r=q[m];if(k===r.name.toLowerCase()){d.push(r.name);l=!0;c&&c.push(h);break}}!l&&e&&e.push(h)}return d}function b(a,b){return a.filter(function(a){return a.toLowerCase()!==
b.toLowerCase()}).concat([b])}function m(a,b,c,d){b.sort(function(a,b){return a.attributes[c]-b.attributes[c]});var e=b.map(function(a){return a.attributes[c]}),f=[],g=D(d,a.fields,{originalFields:f});return J(a,e,g).then(function(a){for(var c=0;c<b.length;c++){var e=b[c],d=a[c];e.attributes={};for(var h=0;h<f.length;h++)e.attributes[f[h]]=d[g[h]]}return b})}function E(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e in b.attributes||c.push(e)}return c}function J(b,c,d){if(null!=b.maxRecordCount&&
c.length>b.maxRecordCount){var g=M(c,b.maxRecordCount);return l.all(g.map(function(a){return J(b,a,d)})).then(U)}g=new k({objectIds:c,outFields:d,orderByFields:[b.objectIdField]});return(new a(b.parsedUrl.path)).execute(g).then(function(a){return a&&a.features&&a.features.length===c.length?a.features.map(function(a){return a.attributes}):l.reject(new h("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer"))})}function G(a,b,c,g,e){for(var f=[],k=0;k<b.attributeData.length;k++){var m=
b.attributeData[k],r=a[k];r&&-1!==g.indexOf(r.name)&&(m=d.makeAbsolute(m.href,b.baseUrl),f.push({url:m,storageInfo:r}))}return l.eachAlways(f.map(function(a){return w(a.url,{responseType:"array-buffer"}).then(function(b){return q.readBinaryAttribute(a.storageInfo,b.data)})})).then(function(a){var b=[];if(!e.ignoreUnavailableFields&&a.some(function(a){return null==a.value})){for(var b=[],d=0;d<a.length;d++)null==a[d].value&&b.push({name:f[d].storageInfo.name,error:a[d].error});return l.reject(new h("scenelayer:attribute-request-failed",
"Request for scene layer attributes failed",{failedAttributes:b}))}for(var g=0;g<c.length;g++){for(var k=c[g],m={},d=0;d<a.length;d++)null!=a[d].value&&(m[f[d].storageInfo.name]=K(a[d].value,k));b.push(m)}return b})}function K(a,b){b=a[b];return a instanceof Int16Array?b===S?null:b:a instanceof Int32Array?b===X?null:b:b!==b?null:b}function M(a,b){var c=a.length;b=Math.ceil(c/b);for(var d=[],e=0;b>e;e++)d.push(a.slice(Math.floor(c*e/b),Math.floor(c*(e+1)/b)));return d}function U(a){for(var b=[],c=
0;c<a.length;c++)b=b.concat(a[c]);return b}function N(a){var b=new u(v(a.store.indexCRS||a.store.geographicCRS));return b.equals(a.spatialReference)?a.spatialReference:b}function W(a){var b=new u(v(a.store.vertexCRS||a.store.projectedCRS));return b.equals(a.spatialReference)?a.spatialReference:b}function R(a,b,c){if(!r.canProject(a,b))throw new h("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===
c&&a.isGeographic)throw new h("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",{});}function V(a,b,c){var d=N(a);a=W(a);R(d,b,c);R(a,b,c)}Object.defineProperty(p,"__esModule",{value:!0});p.DDS_ENCODING_STRING="image/vnd-ms.dds";p.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS=["image/jpeg","image/png"];p.extractWkid=v;p.processNormals=function(a,b,d){switch(b){case "none":var g=a.normals,e=a.positions;b=a.normalInd;d=a.positionInd;C.assert(a.normalInd.length===
a.positionInd.length);a=t.vec3d.create();for(var f=t.vec3d.create(),h=e.data,k=e.offsetIdx,e=e.strideIdx,l=g.data,m=g.offsetIdx,g=g.strideIdx,q=0;q<d.length;q+=3){var r=d[q],r=k+e*r,p=h[r],v=h[r+1],u=h[r+2],r=d[q+1],r=k+e*r;a[0]=h[r]-p;a[1]=h[r+1]-v;a[2]=h[r+2]-u;r=d[q+2];r=k+e*r;f[0]=h[r]-p;f[1]=h[r+1]-v;f[2]=h[r+2]-u;t.vec3d.cross(a,f,a);t.vec3d.normalize(a);for(p=0;3>p;p++)v=m+g*b[q+p],l[v]=a[0],l[v+1]=a[1],l[v+2]=a[2]}break;case "east-north-up":break;case "earth-centered":d(a.normals,c.SphericalECEFSpatialReference);
break;case "vertex-reference-frame":break;default:throw Error("Received unexpected normalReferenceFrame: "+b);}};p.getAppropriateTextureEncoding=function(a,b){if(Array.isArray(a)){if(b&&(b=a.indexOf(p.DDS_ENCODING_STRING),-1<b))return b;for(b=0;b<a.length;b++)if(-1<p.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS.indexOf(a[b]))return b;throw Error("Could not find appropriate texture encoding (among "+a.toString()+")");}return-1};p.findIntersectingNodes=y;var Q=t.vec4d.create();p.intersectBoundingBoxWithMbs=
B;p.findFieldsCaseInsensitive=D;p.whenGraphicAttributes=function(a,c,d,g,e,f){var k=!0===(f&&f.populateObjectId),q=f.ignoreUnavailableFields?void 0:[],r=1===g.length&&"*"===g[0];!r&&k&&(g=b(g,d));g=r?g:D(g,a.fields,{missingFields:q});if(q&&0!==q.length)return l.reject(new h("scenelayer:unknown-fields","This scene layer does not have the requested fields",{unknownFields:q}));if(0===c.length)return l.resolve(c);var k=a.associatedLayer,q=a.attributeStorageInfo,p=r?a.fields.map(function(a){return a.name}):
g;if(k)return m(k,c,d,p);a=E(p,c[0]);return 0===a.length?l.resolve(c):q?(e=e(),null==e?l.reject(new h("scenelayer:feature-not-loaded","Tried to query attributes for unloaded features")):G(q,e.node,e.indices,a,f).then(function(a){for(var b=0;b<c.length;b++){for(var e=0,d=p;e<d.length;e++){var f=d[e];f in a[b]||(a[b][f]=c[b].attributes[f])}c[b].attributes=a[b]}return c})):l.reject(new h("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available"))};var S=-Math.pow(2,
15),X=-Math.pow(2,31);p.getCachedAttributeValue=K;p.convertFlatRangesToOffsets=function(a,b,c){void 0===c&&(c=2);b=null!=b?b:a.length/c;for(var d=new Uint32Array(b+1),e=0;b>e;e++){var f=a[e*c];d[e]=3*f;var k=(e-1)*c+1;if(0<=k&&f-1!==a[k])throw new h("Face ranges are not continuous");}return d[d.length-1]=3*(a[(b-1)*c+1]+1),d};p.getIndexCrs=N;p.getVertexCrs=W;p.getCacheKeySuffix=function(a,b){return b===c.SphericalECEFSpatialReference?"@ECEF":a.equals(b)?"":null!=b.wkid?"@"+b.wkid:null};p.checkSpatialReference=
R;p.checkSpatialReferences=V;p.checkSceneLayerValid=function(a){var b;(b=null==a.store||null==a.store.defaultGeometrySchema)||(a=a.store.defaultGeometrySchema,b=!(null!=a.geometryType&&"triangles"!==a.geometryType?0:null!=a.topology&&"PerAttributeArray"!==a.topology?0:null!=a.vertexAttributes&&null!=a.vertexAttributes.position));if(b)throw new h("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{});};p.checkSceneLayerCompatibleWithView=function(a,
b){V(a,b.spatialReference,b.viewingMode)};p.checkPointCloudLayerValid=function(a){var b;(b=null==a.store||null==a.store.defaultGeometrySchema)||(a=a.store.defaultGeometrySchema,b=!(null==a.geometryType||"points"!==a.geometryType?0:null!=a.topology&&"PerAttributeArray"!==a.topology?0:null!=a.encoding&&""!==a.encoding&&"lepcc-xyz"!==a.encoding?0:null!=a.vertexAttributes&&null!=a.vertexAttributes.position));if(b)throw new h("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",
{});};p.checkPointCloudLayerCompatibleWithView=function(a,b){R(a.spatialReference,b.spatialReference,b.viewingMode)};p.encodeSymbolColor=function(a,b,c){if(null==a||"ignore"===b)return c[0]=255,c[1]=255,c[2]=255,void(c[3]=255);c[0]=Math.floor(255*a[0]);c[1]=Math.floor(255*a[1]);c[2]=Math.floor(255*a[2]);a=Math.floor(85*a[3]);0===a?c[3]=0:"tint"===b?c[3]=a:"replace"===b?c[3]=a+85:c[3]=a+170};p.rendererNeedsTextures=function(a){if(null==a||"simple"!==a.type&&"class-breaks"!==a.type&&"unique-value"!==
a.type||("unique-value"===a.type||"class-breaks"===a.type)&&null==a.defaultSymbol)return!0;a=a.getSymbols();if(0===a.length)return!0;for(var b=0;b<a.length;b++){var c=a[b];if("mesh-3d"!==c.type||0===c.symbolLayers.length)return!0;for(var d=0,c=c.symbolLayers.items;d<c.length;d++){var e=c[d];if("fill"!==e.type||null==e.material||"replace"!==e.material.colorMixMode)return!0}}return!1}})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("require exports dojo/_base/lang ../../../../core/Logger ../../../../core/Error ./LEPCC".split(" "),
function(A,p,w,l,h,d){function u(a,c,b){for(var d="",k=0;b>k;){var l=a[c+k];if(128>l)d+=String.fromCharCode(l),k++;else if(192<=l&&224>l){if(k+1>=b)throw new h("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");var q=a[c+k+1],l=(31&l)<<6|63&q,d=d+String.fromCharCode(l),k=k+2}else if(224<=l&&240>l){if(k+2>=b)throw new h("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");var q=a[c+k+1],r=a[c+k+2],l=(15&l)<<12|(63&q)<<6|63&r,d=d+String.fromCharCode(l),
k=k+3}else{if(!(240<=l&&248>l))throw new h("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");if(k+3>=b)throw new h("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");q=a[c+k+1];r=a[c+k+2];l=(7&l)<<18|(63&q)<<12|(63&r)<<6|63&a[c+k+3];d=65536<=l?d+String.fromCharCode((l-65536>>10)+55296,(1023&l)+56320):d+String.fromCharCode(l);k+=4}}return d}function r(a,c){for(var b={byteOffset:0,byteCount:0,fields:Object.create(null)},d=0,h=0;h<c.length;h++){var k=
c[h],l=k.valueType||k.type;b.fields[k.property]=(0,p.valueType2ArrayBufferReader[l])(a,d);d+=p.valueType2TypedArrayClassMap[l].BYTES_PER_ELEMENT}return b.byteCount=d,b}function a(a,c,b){var d,k,l=[],q=0;for(k=0;a>k;k+=1){if(d=c[k],0<d){if(l.push(u(b,q,d-1)),0!==b[q+d-1])throw new h("string-array-error","Invalid string array: missing null termination.");}else l.push(null);q+=d}return l}function k(a,c){return new p.valueType2TypedArrayClassMap[c.valueType](a,c.byteOffset,c.count*c.valuesPerElement)}
function c(a,c){return new Uint8Array(a,c.byteOffset,c.byteCount)}function t(a,c,b){a=null!=c.header?r(a,c.header):{byteOffset:0,byteCount:0,fields:{count:b}};b={header:a,byteOffset:a.byteCount,byteCount:0,entries:Object.create(null)};for(var d=a.byteCount,k=0;k<c.ordering.length;k++){var l=c.ordering[k],p=w.clone(c[l]);if(p.count=a.fields.count,"String"===p.valueType){if(p.byteOffset=d,p.byteCount=a.fields[l+"ByteCount"],"UTF-8"!==p.encoding)throw new h("unsupported-encoding","Unsupported String encoding.",
{encoding:p.encoding});}else{if(!q(p.valueType))throw new h("unsupported-value-type","Unsupported binary valueType",{valueType:p.valueType});var t=v(p.valueType),d=d+(0!==d%t?t-d%t:0);p.byteOffset=d;p.byteCount=t*p.valuesPerElement*p.count}d+=p.byteCount;b.entries[l]=p}return b.byteCount=d-b.byteOffset,b}function C(a,c,b){if(c!==a&&y.error("Invalid "+b+" buffer size\n expected: "+a+", actual: "+c+")"),a>c)throw new h("buffer-too-small","Binary buffer is too small",{expectedSize:a,actualSize:c});}
function q(a){return p.valueType2TypedArrayClassMap.hasOwnProperty(a)}function v(a){return q(a)&&p.valueType2TypedArrayClassMap[a].BYTES_PER_ELEMENT}Object.defineProperty(p,"__esModule",{value:!0});var y=l.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");p.readHeader=r;p.readStringArray=a;p.createTypedView=k;p.createRawView=c;p.createAttributeDataIndex=t;p.createGeometryDataIndex=function(a,c,b){var d=r(a,c.header),h=d.byteCount,k={header:d,byteOffset:d.byteCount,byteCount:0,vertexAttributes:w.clone(c.vertexAttributes)},
l=k.vertexAttributes;b||null==l.region||delete l.region;var d=d.fields,q=null!=d.vertexCount?d.vertexCount:d.count;for(b=0;b<c.ordering.length;b++){var p=c.ordering[b];null!=l[p]&&(l[p].byteOffset=h,l[p].count=q,h+=v(l[p].valueType)*l[p].valuesPerElement*q)}l=d.faceCount;if(c.faces&&l)for(k.faces=w.clone(c.faces),q=k.faces,b=0;b<c.ordering.length;b++)p=c.ordering[b],null!=q[p]&&(q[p].byteOffset=h,q[p].count=l,h+=v(q[p].valueType)*q[p].valuesPerElement*l);d=d.featureCount;if(c.featureAttributes&&c.featureAttributeOrder&&
d)for(k.featureAttributes=w.clone(c.featureAttributes),l=k.featureAttributes,b=0;b<c.featureAttributeOrder.length;b++)q=c.featureAttributeOrder[b],l[q].byteOffset=h,l[q].count=d,p=v(l[q].valueType),"UInt64"===l[q].valueType&&(p=8),h+=p*l[q].valuesPerElement*d;return C(h,a.byteLength,"geometry"),k.byteCount=h-k.byteOffset,k};p.readBinaryAttribute=function(l,q,b){if("lepcc-rgb"===l.encoding)return d.decodeRGB(q);if("lepcc-intensity"===l.encoding)return d.decodeIntensity(q);if(null!=l.encoding&&""!==
l.encoding)throw new h("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");l["attributeByteCounts "]&&!l.attributeByteCounts&&(y.warn("Warning: Trailing space in 'attributeByteCounts '."),l.attributeByteCounts=l["attributeByteCounts "]);"ObjectIds"===l.ordering[0]&&l.hasOwnProperty("objectIds")&&(y.warn("Warning: Case error in objectIds"),l.ordering[0]="objectIds");b=t(q,l,b);C(b.byteOffset+b.byteCount,q.byteLength,"attribute");if(l=b.entries.attributeValues||b.entries.objectIds){if("String"===
l.valueType){b=b.entries.attributeByteCounts;var m=k(q,b);q=c(q,l);return a(b.count,m,q)}return k(q,l)}throw new h("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};p.valueType2TypedArrayClassMap={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array};p.valueType2ArrayBufferReader={Float32:function(a,c){return(new DataView(a,0)).getFloat32(c,!0)},Float64:function(a,c){return(new DataView(a,
0)).getFloat64(c,!0)},UInt8:function(a,c){return(new DataView(a,0)).getUint8(c)},Int8:function(a,c){return(new DataView(a,0)).getInt8(c)},UInt16:function(a,c){return(new DataView(a,0)).getUint16(c,!0)},Int16:function(a,c){return(new DataView(a,0)).getInt16(c,!0)},UInt32:function(a,c){return(new DataView(a,0)).getUint32(c,!0)},Int32:function(a,c){return(new DataView(a,0)).getInt32(c,!0)}};p.isValueType=q;p.getBytesPerValue=v})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["require","exports",
"../../../../core/Error"],function(A,p,w){function l(a,d,c){return{identifier:String.fromCharCode.apply(null,new Uint8Array(a,c+r.identifierOffset,r.identifierLength)),version:d.getUint16(c+r.versionOffset,u),checksum:d.getUint32(c+r.checksumOffset,u)}}function h(a,h,c){var k=[];h=d(a,h,k);for(var l=[],q=0;q<k.length;q++){l.length=0;h=d(a,h,l);for(var r=0;r<l.length;r++)c.push(l[r]+k[q])}return h}function d(a,d,c){var h=new DataView(a,d),k=h.getUint8(0),l=31&k,r=!!(32&k),p=(192&k)>>6,k=0;if(0===p)k=
h.getUint32(1,u),d+=5;else if(1===p)k=h.getUint16(1,u),d+=3;else{if(2!==p)throw new w("lepcc-decode-error","Bad count type");k=h.getUint8(1);d+=2}if(r)throw new w("lepcc-decode-error","LUT not implemented");a=new Uint8Array(a,d,Math.ceil(k*l/8));for(var p=r=h=0,A=-1>>>32-l,D=0;k>D;D++){for(;l>r;)h|=a[p]<<r,r+=8,p+=1;c[D]=h&A;h>>>=l;r-=l;32<r+l&&(h|=a[p-1]>>8-r)}return d+p}Object.defineProperty(p,"__esModule",{value:!0});var u=!0,r={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,
byteCount:16};p.decodeXYZ=function(a){var d,c,p,C,q,v,y,A,D,b,m,E,J=new DataView(a,0),G=0;C=l(a,J,G);p=C.identifier;C=C.version;if(G+=r.byteCount,"LEPCC     "!==p)throw new w("lepcc-decode-error","Bad identifier");if(1<C)throw new w("lepcc-decode-error","Unknown version");var K=G;d=J.getUint32(K+0,u);c=J.getUint32(K+4,u);p=J.getFloat64(K+8,u);C=J.getFloat64(K+16,u);q=J.getFloat64(K+24,u);v=J.getFloat64(K+32,u);y=J.getFloat64(K+40,u);A=J.getFloat64(K+48,u);D=J.getFloat64(K+56,u);b=J.getFloat64(K+64,
u);m=J.getFloat64(K+72,u);E=J.getUint32(K+80,u);J.getUint32(K+84,u);G+=88;if(c*Math.pow(2,32)+d!==a.byteLength)throw new w("lepcc-decode-error","Bad size");J=new Float64Array(3*E);d=[];c=[];E=[];K=[];if(G=h(a,G,d),G=h(a,G,c),G=h(a,G,E),G=h(a,G,K),G!==a.byteLength)throw new w("lepcc-decode-error","Bad length");for(var M=G=a=0;M<d.length;M++)for(var G=G+d[M],U=0,N=0;N<c[M];N++){var U=U+E[a],W=K[a];J[3*a]=Math.min(v,p+2*D*U);J[3*a+1]=Math.min(y,C+2*b*G);J[3*a+2]=Math.min(A,q+2*m*W);a++}return{errorX:D,
errorY:b,errorZ:m,result:J}};p.decodeRGB=function(a){var d,c,h,p,q,v,y=new DataView(a,0),A=0;p=l(a,y,A);h=p.identifier;p=p.version;if(A+=r.byteCount,"ClusterRGB"!==h)throw new w("lepcc-decode-error","Bad identifier");if(1<p)throw new w("lepcc-decode-error","Unknown version");v=A;d=y.getUint32(v+0,u);c=y.getUint32(v+4,u);h=y.getUint32(v+8,u);p=y.getUint16(v+12,u);q=y.getUint8(v+14);v=y.getUint8(v+15);A+=16;if(c*Math.pow(2,32)+d!==a.byteLength)throw new w("lepcc-decode-error","Bad size");if(2!==q&&
1!==q||0!==v){if(0===q&&0===v){if(3*h+A!==a.byteLength||0!==p)throw new w("lepcc-decode-error","Bad count");return(new Uint8Array(a,A)).slice()}if(2>=q&&1===v){if(A+3!==a.byteLength||1!==p)throw new w("lepcc-decode-error","Bad count");a=y.getUint8(A);p=y.getUint8(A+1);d=y.getUint8(A+2);A=new Uint8Array(3*h);for(y=0;y<h;y++)A[3*y]=a,A[3*y+1]=p,A[3*y+2]=d;return A}throw new w("lepcc-decode-error","Bad method "+q+","+v);}if(3*p+h+A!==a.byteLength||256<p)throw new w("lepcc-decode-error","Bad count");
d=new Uint8Array(a,A,3*p);a=new Uint8Array(a,A+3*p,h);A=new Uint8Array(3*h);for(y=0;y<h;y++)p=a[y],A[3*y]=d[3*p],A[3*y+1]=d[3*p+1],A[3*y+2]=d[3*p+2];return A};p.decodeIntensity=function(a){var h,c,p,A,q,v=new DataView(a,0),y=0;A=l(a,v,y);p=A.identifier;A=A.version;if(y+=r.byteCount,"Intensity "!==p)throw new w("lepcc-decode-error","Bad identifier");if(1<A)throw new w("lepcc-decode-error","Unknown version");var B=y;h=v.getUint32(B+0,u);c=v.getUint32(B+4,u);p=v.getUint32(B+8,u);A=v.getUint16(B+12,u);
q=v.getUint8(B+14);v.getUint8(B+15);y+=16;if(c*Math.pow(2,32)+h!==a.byteLength)throw new w("lepcc-decode-error","Bad size");v=new Uint16Array(p);if(8===q){if(p+y!==a.byteLength)throw new w("lepcc-decode-error","Bad size");q=new Uint8Array(a,y,p)}else if(16===q){if(2*p+y!==a.byteLength)throw new w("lepcc-decode-error","Bad size");q=new Uint16Array(a,y,p)}else if(q=[],d(a,y,q)!==a.byteLength)throw new w("lepcc-decode-error","Bad size");for(a=0;a<p;a++)v[a]=q[a]*A;return v}})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../core/Accessor ../../../../core/Logger ../../../../geometry/Point ../../webgl-engine/lib/Selector ../../support/Evented ../../support/aaBoundingRect ../../lib/glMatrix".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t){var C=c.create(c.NEGATIVE_INFINITY),q={spatialReference:null,extent:C},v=t.vec3d.create(),y=t.vec3d.create(),B=t.vec3d.create(),D=u.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");return function(b){function d(a){return b.call(this)||this}return w(d,b),d.prototype.initialize=function(){this.renderCoordsHelper=this.layerView.view.renderCoordsHelper;this.intersectLayers=[this.stageLayer];this.selector=new a(this.layerView.view.viewingMode);var b=this.layerView.layer.fullExtent;
this.zmin=b.zmin;this.zmax=b.zmax},d.prototype.getElevation=function(a){if(a instanceof r){if(!this.renderCoordsHelper.toRenderCoords(a,v))return D.error("could not project point for elevation alignment"),-(1/0)}else if(!this.renderCoordsHelper.toRenderCoords(a,this.spatialReference,v))return D.error("could not project point for elevation alignment"),-(1/0);var b=this.layerView.elevationOffset;a=this.zmin+b;b=this.zmax+b;return t.vec3d.set(v,y),t.vec3d.set(v,B),this.renderCoordsHelper.setAltitude(b,
y),this.renderCoordsHelper.setAltitude(a,B),this.selector.init(this.intersectLayers,y,B,null,null,1,!1),this.selector.getMinResult().getIntersectionPoint(v)?this.renderCoordsHelper.getAltitude(v):-(1/0)},d.prototype.layerChanged=function(){this.spatialReference&&(q.extent=this.computeLayerExtent(this.intersectLayers[0]),q.spatialReference=this.spatialReference,this.emit("elevation-change",q))},d.prototype.objectChanged=function(a){this.spatialReference&&(q.extent=this.computeObjectExtent(a),q.spatialReference=
this.spatialReference,this.emit("elevation-change",q))},d.prototype.computeObjectExtent=function(a){return c.set(C,c.NEGATIVE_INFINITY),this.expandExtent(a,C),C},d.prototype.computeLayerExtent=function(a){c.set(C,c.NEGATIVE_INFINITY);var b=0;for(a=a.getObjects();b<a.length;b++)this.expandExtent(a[b],C);return C},d.prototype.expandExtent=function(a,b){for(var d=a.getBBMin(!0),h=a.getBBMax(!0),k=0;8>k;++k)v[0]=1&k?d[0]:h[0],v[1]=2&k?d[1]:h[1],v[2]=4&k?d[2]:h[2],t.mat4d.multiplyVec3(a.objectTransformation,
v),this.renderCoordsHelper.fromRenderCoords(v,v,this.spatialReference),c.expand(b,v);return b},l([h.property({constructOnly:!0})],d.prototype,"layerView",void 0),l([h.property({constructOnly:!0})],d.prototype,"stageLayer",void 0),l([h.property({readOnly:!0,aliasOf:"layerView.view.elevationProvider.spatialReference"})],d.prototype,"spatialReference",void 0),d=l([h.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],d)}(h.declared(d,k.Evented))})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define(["require",
"exports"],function(A,p){function w(a,c,d,h,l,p,u){switch(d){case 1:for(d=0;u>d;d++)h[l]=a[c],c+=1,l+=p;break;case 2:for(d=0;u>d;d++)h[l]=a[c],h[l+1]=a[c+1],c+=2,l+=p;break;case 3:for(d=0;u>d;d++)h[l]=a[c],h[l+1]=a[c+1],h[l+2]=a[c+2],c+=3,l+=p;break;case 4:for(d=0;u>d;d++)h[l]=a[c],h[l+1]=a[c+1],h[l+2]=a[c+2],h[l+3]=a[c+3],c+=4,l+=p;break;default:throw r("Unhandled stride size "+d);}}function l(a,c,d,h,l,p){switch(c){case 1:for(c=0;p>c;c++)d[h]=a[0],h+=l;break;case 2:for(c=0;p>c;c++)d[h]=a[0],d[h+
1]=a[0],h+=l;break;case 3:for(c=0;p>c;c++)d[h]=a[0],d[h+1]=a[0],d[h+2]=a[0],h+=l;break;case 4:for(c=0;p>c;c++)d[h]=a[0],d[h+1]=a[0],d[h+2]=a[0],d[h+3]=a[0],h+=l;break;default:throw r("Unhandled stride size "+c);}}function h(a){switch(a){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw Error("Unhandled data type: "+a);}function d(a){switch(a){case 5120:return"Int8";
case 5126:return"Float32";case 5124:return"Int32";case 5122:return"Int16";case 5121:return"UInt8";case 5125:return"UInt32";case 5123:return"UInt16"}throw Error("Unhandled data type: "+a);}function u(a){return 0<a&&0===a%Uint32Array.BYTES_PER_ELEMENT}function r(a){return Error("I3SGeometryUtil processing failed: "+a)}Object.defineProperty(p,"__esModule",{value:!0});var a=new Uint8Array(64);p.interleaveGeometryBuffer=function(k,c,p,A){void 0===A&&(A=[]);var q=k.params.vertexAttributes,t=q.position.count;
if(!u(p[0].stride))throw r("Layout stride must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");var y=new Uint32Array(p[0].stride/Uint32Array.BYTES_PER_ELEMENT*t);p=p.slice(0).sort(function(a,b){return a.offset-b.offset});k=function(k){var b=q[k.name],m=h(k.type),p=void 0,v=!1;if(null==b){v=A.filter(function(a){return a.name===k.name})[0];if(!v)throw r("Geometry definition is missing attribute");b={valueType:d(k.type),byteOffset:0,count:t,valuesPerElement:k.count};for(p=0;p<a.length;p++)a[p]=v.byteValue;
p=a.buffer;v=!0}else p=c;if(d(k.type)!==b.valueType)throw r("Geometry definition type must match attribute type");if(0!==b.byteOffset%Uint32Array.BYTES_PER_ELEMENT||0!==k.offset%Uint32Array.BYTES_PER_ELEMENT)throw r(k.name+" offset must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");if(!u(b.valuesPerElement*m.BYTES_PER_ELEMENT)||!u(k.count*m.BYTES_PER_ELEMENT))throw r(k.name+" data must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");var p=new Uint32Array(p),C=b.byteOffset/Uint32Array.BYTES_PER_ELEMENT,
b=b.valuesPerElement*m.BYTES_PER_ELEMENT/Uint32Array.BYTES_PER_ELEMENT,m=k.offset/Uint32Array.BYTES_PER_ELEMENT,B=k.stride/Uint32Array.BYTES_PER_ELEMENT;v?l(p,b,y,m,B,t):w(p,C,b,y,m,B,t)};for(var C=0;C<p.length;C++)k(p[C]);return y.buffer}})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["require","exports","../../support/projectionUtils","../../lib/glMatrix","../../webgl-engine/lib/Util"],function(A,p,w,l,h){Object.defineProperty(p,"__esModule",{value:!0});p.ReprojectionTypes={PER_VERTEX:"perVertex",
NO_REPROJECTION:"noReprojection"};var d=new Float64Array(3E3);p.reprojectPoints=function(h,r,a,k,c,t){if(h===p.ReprojectionTypes.PER_VERTEX){h=r.data;var u=r.offsetIdx;r=r.strideIdx;var q=l.mat4d.create();w.computeLinearTransformation(k,a,q,t);var v=l.mat4d.create();l.mat4d.inverse(q,v);var y=l.mat4d.create();l.mat4d.identity(y);var A=[0,0,0],D=h.length/r;w.vectorToVector(a,k,A,c);for(a=0;D>a;a+=1E3){k=Math.min(1E3,D-a);for(var b=0;k>b;b++){var m=u+r*(a+b);d[3*b]=h[m]+A[0];d[3*b+1]=h[m+1]+A[1];d[3*
b+2]=h[m+2]+A[2]}w.bufferToBuffer(d,c,0,d,t,0,k);for(b=0;k>b;b++){var E=d[3*b],J=d[3*b+1],G=d[3*b+2],m=u+r*(a+b);h[m]=v[0]*E+v[4]*J+v[8]*G+v[12];h[m+1]=v[1]*E+v[5]*J+v[9]*G+v[13];h[m+2]=v[2]*E+v[6]*J+v[10]*G+v[14]}}t={localTrafo:y,globalTrafo:q}}else c=l.mat4d.create(),l.mat4d.identity(c),h=l.mat4d.create(),w.computeLinearTransformation(k,a,h,t),t={localTrafo:c,globalTrafo:h};return t};p.reprojectNormalsPerVertex=function(d,p,a,k,c){h.assert(k.equals(w.SphericalECEFSpatialReference));k=l.mat4d.create();
w.computeLinearTransformation(a,p,k,c);p=l.mat4d.create();l.mat4d.inverse(k,p);a=d.data;c=d.offsetIdx;d=d.strideIdx;k=a.length/d;for(var r=0;k>r;r++){var u=c+d*r,q=a[u],v=a[u+1],y=a[u+2];a[u]=p[0]*q+p[4]*v+p[8]*y;a[u+1]=p[1]*q+p[5]*v+p[9]*y;a[u+2]=p[2]*q+p[6]*v+p[10]*y}}})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("require exports dojo/promise/all ../../../../core/promiseUtils ../../../../core/Error ../../../../tasks/support/FeatureSet".split(" "),function(A,p,w,l,h,d){return function(){function p(d,
a){this._support=d;this._options=a}return p.prototype.queryExtent=function(d){var a=this;return this._rejectUnsupported(d).then(function(){var h=0,c=a._support.createExtentBuilder();return a._forAllQueried(d,function(a){h++;c.add(a)}),{count:h,extent:0===h?null:c.getExtent()}})},p.prototype.queryFeatureCount=function(d){var a=this;return this._rejectUnsupported(d).then(function(){var h=0;return a._forAllQueried(d,function(){return h++}),h})},p.prototype.queryFeatures=function(h){var a=this;return this._rejectUnsupported(h).then(function(){var d=
[],c=h&&h.outFields,p=[];return a._forAllQueried(h,function(c){return p.push(a._support.createGraphic(c))},function(h){c&&(d.push(a._support.requestFields(h,p,c)),p=[])}),c||d.push(l.resolve(p)),w(d)}).then(function(a){a=a.reduce(function(a,c){return a.concat(c)},[]);var c=new d;return c.features=a,c})},p.prototype.queryObjectIds=function(d){var a=this;return this._rejectUnsupported(d).then(function(){var h=[];return a._forAllQueried(d,function(a){return h.push(a.id)}),h})},p.defaultExtentBuilder=
function(d){var a=null;return{add:function(h){(h=d(h))&&(a=null!=a?a.union(h):h.clone())},getExtent:function(){return a}}},p.prototype._forAllQueried=function(d,a,h){var c=[];if(d&&d.objectIds){var k=d.objectIds;c.push(function(a){return 0<=k.indexOf(a.id)})}this._support.forAll(function(d){for(var h=0;h<c.length;h++)if(!(0,c[h])(d))return;a(d)},h)},p.prototype._rejectUnsupported=function(d){if(null==d)return l.resolve();var a=function(a){return l.reject(new h("Unsupported Query","Unsupported property '"+
a+"'"))};return null!=d.distance?a("distance"):null!=d.geometryPrecision?a("geometryPrecision"):d.groupByFieldsForStatistics&&d.groupByFieldsForStatistics.length?a("groupByFieldsForStatistics"):null!=d.maxAllowableOffset?a("maxAllowableOffset"):d.multipatchOption?a("multipatchOption"):null!=d.num?a("num"):d.orderByFields&&d.orderByFields.length?a("orderByFields"):d.outSpatialReference?a("outSpatialReference"):d.outStatistics&&d.outStatistics.length?a("outStatistics"):d.pixelSize?a("pixelSize"):d.quantizationParameters?
a("quantizationParameters"):d.relationParameter?a("relationParameter"):d.returnDistinctValues?a("returnDistinctValues"):null!=d.start?a("start"):d.text?a("text"):d.timeExtent?a("timeExtent"):d.where?a("where"):d.geometry?a("geometry"):!this._options.enableOutFields&&d.outFields&&d.outFields.length?a("outFields"):!this._options.enableObjectId&&d.objectIds&&d.objectIds.length?a("objectIds"):l.resolve()},p}()})},"esri/views/3d/layers/i3s/Highlights":function(){define(["require","exports","../../webgl-engine/lib/HighlightSet"],
function(A,p,w){var l=function(){return function(h){this.highlightSet=new w;this.ids=new Set;this.options=h}}();return function(){function h(d){this.highlights=[];this.layerView=d}return h.prototype.destroy=function(){this.highlights.forEach(function(d){return d.highlightSet.removeAll()});this.highlights=null},h.prototype.acquireSet=function(d){var h=this,p=new l(d);this.highlights.push(p);return{set:p,handle:{remove:function(){return h.releaseSet(p)}}}},h.prototype.releaseSet=function(d){d.highlightSet.removeAll();
d=this.highlights?this.highlights.indexOf(d):-1;-1!==d&&this.highlights.splice(d,1)},h.prototype.setFeatureIds=function(d,h){h.forEach(function(h){return d.ids.add(h)});this.layerView._forAllFeatures(function(h,a,k,c){d.ids.has(h)&&(h=k.setComponentHighlight(c,a,d.options),d.highlightSet.addObject(k,h))},null,!0)},h.prototype.objectCreated=function(d){var h=this;this.highlights.forEach(function(l){h.layerView._forAllFeaturesOfObject(d,function(a,d,c,h){l.ids.has(a)&&(a=c.setComponentHighlight(h,d,
l.options),l.highlightSet.addObject(c,a))},!0)})},h.prototype.objectDeleted=function(d){this.highlights.forEach(function(h){h.highlightSet.removeObject(d)})},h.prototype.allObjectsDeleted=function(){this.highlights.forEach(function(d){return d.highlightSet.removeAll()})},h}()})},"esri/views/3d/webgl-engine/lib/HighlightSet":function(){define(["require","exports"],function(A,p){return function(){function p(){this.items=[]}return p.prototype.addObject=function(l,h){this.items.push({type:"object",highlightId:h,
object:l})},p.prototype.addRenderGeometry=function(l,h,d){this.items.push({type:"renderGeometry",highlightId:d,renderGeometry:l,renderer:h})},p.prototype.removeObject=function(l){for(var h=this.items.length-1;0<=h;--h){var d=this.items[h];"object"===d.type&&d.object===l&&(d.object.removeHighlights(d.highlightId),this.items.splice(h,1))}},p.prototype.removeRenderGeometry=function(l){for(var h=this.items.length-1;0<=h;--h){var d=this.items[h];"renderGeometry"===d.type&&d.renderGeometry===l&&(d.renderer.removeRenderGeometryHighlight(d.renderGeometry,
d.highlightId),this.items.splice(h,1))}},p.prototype.removeAll=function(){this.items.forEach(function(l){"object"===l.type?l.object.removeHighlights(l.highlightId):"renderGeometry"===l.type&&l.renderer.removeRenderGeometryHighlight(l.renderGeometry,l.highlightId)});this.items=[]},p}()})},"esri/views/3d/layers/i3s/IDBCache":function(){define(["require","exports","../../../../core/Error","../../../../core/promiseUtils"],function(A,p,w,l){function h(d){return l.create(function(h,a){d.oncomplete=function(){return h()};
d.onerror=function(){return a(d.error)};d.onabort=function(){return a(d.error)}})}function d(d){return l.create(function(h,a){"done"===d.readyState?null!=d.error?a(d.error):h(d.result):(d.onsuccess=function(){return h(d.result)},d.onerror=function(){return a(d.error)})})}Object.defineProperty(p,"__esModule",{value:!0});A=function(){function p(d,a,h){this._quotaReductionPromise=this._db=null;this._gcCounter=0;this.gcFrequency=50;this.maxByteSize=1073741824;this.quotaReductionFactor=.2;this._dbName=
d;this._storeName=a;this._version=h}return p.prototype.init=function(){var h=this;return l.resolve().then(function(){var a=indexedDB.open(h._dbName,h._version);return a.onupgradeneeded=function(d){var c=a.result,k=a.transaction,l=c.objectStoreNames.contains(h._storeName)?k.objectStore(h._storeName):c.createObjectStore(h._storeName),c=c.objectStoreNames.contains("last_access")?k.objectStore("last_access"):c.createObjectStore("last_access");c.indexNames.contains("date")||c.createIndex("date","date",
{unique:!1});c.indexNames.contains("byteSize")||c.createIndex("byteSize","byteSize",{unique:!1});d.oldVersion<h._version&&(l.clear(),c.clear())},d(a)}).then(function(a){h._db=a})},p.prototype.destroy=function(){this._db&&(this._db.close(),this._db=null)},p.prototype.put=function(d,a){var h=this;return null==this._db?l.reject(new w("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:l.resolve()).then(function(){return h._put(d,
a)}).otherwise(function(c){if("QuotaExceededError"===c.name)return null==h._quotaReductionPromise&&(h._quotaReductionPromise=h._getCacheSize().then(function(c){return h._removeLeastRecentlyAccessed(a.byteSize+Math.ceil(c*h.quotaReductionFactor))}),h._quotaReductionPromise.always(function(){h._quotaReductionPromise=null})),h._quotaReductionPromise.then(function(){return h._put(d,a)});throw c;}).then(function(){h._gcCounter--;0>h._gcCounter&&(h._gcCounter=h.gcFrequency,h._getCacheSize().then(function(a){return h._removeLeastRecentlyAccessed(a-
h.maxByteSize)}))})},p.prototype.get=function(h){var a=this;return null==this._db?l.resolve(null):l.resolve().then(function(){var k=a._db.transaction(a._storeName,"readonly").objectStore(a._storeName).get(h);return d(k)}).then(function(d){null!=d&&a._db.transaction("last_access","readwrite").objectStore("last_access").put({date:(new Date).getTime(),byteSize:d.byteSize},h);return d}).otherwise(function(a){return null})},p.prototype.remove=function(d){var a=this;return null==this._db?l.resolve():l.resolve().then(function(){var k=
a._db.transaction([a._storeName,"last_access"],"readwrite"),c=k.objectStore(a._storeName),l=k.objectStore("last_access");return c["delete"](d),l["delete"](d),h(k)})},p.prototype._put=function(d,a){var k=this._db.transaction([this._storeName,"last_access"],"readwrite");k.objectStore(this._storeName).put(a,d);return k.objectStore("last_access").put({date:(new Date).getTime(),byteSize:a.byteSize},d),h(k)},p.prototype._removeLeastRecentlyAccessed=function(d){if(!(0>=d)){var a=this._db.transaction([this._storeName,
"last_access"],"readwrite"),k=a.objectStore(this._storeName),c=a.objectStore("last_access"),l=0,p=c.index("date").openCursor(null,"next");return p.onsuccess=function(a){a=p.result;null!=a&&(null!=a.value.byteSize&&(l+=a.value.byteSize),k["delete"](a.primaryKey),c["delete"](a.primaryKey),d>l&&a["continue"]())},h(a)}},p.prototype._getCacheSize=function(){var d=this._db.transaction("last_access"),a=0,k=d.objectStore("last_access").index("byteSize").openKeyCursor();return k.onsuccess=function(c){if(c=
k.result){var d=c.key;null!=d&&(a+=d);c["continue"]()}},h(d).then(function(){return a})},p}();p.IDBCache=A;p.whenTransaction=h;p.whenRequest=d})},"esri/views/3d/webgl-engine/lib/PreinterleavedGeometryData":function(){define(["require","exports","../../../webgl/Util","./ComponentUtils","./geometryDataUtils"],function(A,p,w,l,h){function d(d){switch(d){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;
case 5123:return Uint16Array}throw Error("Unhandled data type: "+d);}return function(){function p(r,a,k){void 0===k&&(k=p.DefaultOffsets);this.preinterleaved=!0;this.primitiveType="triangle";for(var c=w.getStride(a)/4,c=h.generateDefaultIndexArray(r.length/c),t={},u=0;u<a.length;u++){var q=a[u],v=new (d(q.type))(r.buffer),y=w.getBytesPerElement(q.type);t[q.name]={data:v,size:q.count,offsetIdx:q.offset/y,strideIdx:q.stride/y}}this._id=h.getNewId();this._vertexData=r;this._vertexAttributes=t;this._layout=
a;this._indexData=c;this._componentOffsets=l.createOffsets(k)}return Object.defineProperty(p.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"vertexData",{get:function(){return this._vertexData},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"indexData",{get:function(){return this._indexData},enumerable:!0,
configurable:!0}),Object.defineProperty(p.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"indexCount",{get:function(){return this._indexData.length},enumerable:!0,configurable:!0}),p.prototype.getId=function(){return this.id},p.prototype.toRenderData=function(){return{id:this._id.toString(),preinterleaved:!0,indexCount:this.indexCount,vertexData:this._vertexData,layout:this._layout}},p.prototype.getIndices=
function(d){return this._indexData},p.prototype.getAttribute=function(d){return this._vertexAttributes[d]},p.prototype.estimateGpuMemoryUsage=function(){return this._vertexData.byteLength},p.DefaultOffsets=new Uint32Array(0),p}()})},"esri/views/3d/layers/support/attributeUtils":function(){define(["require","exports"],function(A,p){Object.defineProperty(p,"__esModule",{value:!0});p.attributeLookup=function(p,l){l=l.toLowerCase();for(var h=0,d=Object.keys(p);h<d.length;h++){var u=d[h];if(u.toLowerCase()===
l)return p[u]}return null}})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("require exports dojo/_base/lang dojo/Deferred dojo/errors/CancelError ../../webgl-engine/lib/Util ./I3SUtil ./I3SBinaryReader ../../../../core/promiseUtils ../../../../core/urlUtils".split(" "),function(A,p,w,l,h,d,u,r,a,k){A=function(){function c(d,h,l,p,r){this.logger=h;this.defaultGeometrySchema=l;this.requiredAttributes=p;this.options=r;this.loadShared=function(d){if(null==d.sharedResource)return a.resolve({});
var h=k.makeAbsolute(d.sharedResource.href,d.baseUrl);return this.loadJSON(h).then(function(a){return c.fixTextureEncodings(a),c.addAbsoluteHrefTexture(a,h),a})};this.loader=d;this.cancelled=!1}return c.prototype.cancel=function(){this.cancelled=!0},c.prototype.loadJSON=function(a){var c=this.loader.request(a,"json"),d=new l;return c.then(function(a,c){d.resolve(c)},function(c){d.reject(Error("Failed to load: "+a))}),d.promise},c.prototype.loadBinary=function(a){var c=this.loader.request(a,"binary"),
d=new l;return c.then(function(a,c){d.resolve(c)},function(c){d.reject(Error("Failed to load: "+a))}),d.promise},c.prototype.loadImage=function(a){var c=this.loader.request(a,"image"),d=new l;return c.then(function(a,c){d.resolve(c)},function(c){d.reject(Error("Failed to load: "+a))}),d.promise},c.prototype.loadAttribute=function(a,c,d){a=k.makeAbsolute(d,a);return this.loadBinary(a).then(function(a){return r.readBinaryAttribute(c,a)})},c.prototype.loadAttributes=function(c,d,h){var k=this,l=h.map(function(h){return null==
c.attributeData||null==c.attributeData[h.index]?(k.logger.error("Missing attributeData for '"+h.name+"' on node '"+c.id+"'"),a.resolve(null)):k.loadAttribute(d,h.attributeStorageInfo,c.attributeData[h.index].href).otherwise(function(a){return k.logger.error("Failed to load attributeData for '"+h.name+"' on node '"+c.id+"'"),null})});return a.all(l).then(function(a){for(var c={},b=0;b<h.length;++b)a[b]&&(c[h[b].name]=a[b]);return c})},c.prototype.prepareBinaryGeometryData=function(a,c,d,h){if(w.mixin(a.geometries[0].params,
d),h||null!=d.vertexAttributes.region||delete d.vertexAttributes.region,null!=d.featureAttributes){h=d.featureAttributes;if(h.faceRange){var k=r.createTypedView(c,h.faceRange);a.componentOffsets=u.convertFlatRangesToOffsets(k,d.header.fields.featureCount,h.faceRange.valuesPerElement)}if(h.id){a.featureIds=[];var k=1,l=r.valueType2TypedArrayClassMap[h.id.valueType];"UInt64"===h.id.valueType&&(l=Uint32Array,k=2);c=new l(c,h.id.byteOffset,h.id.count*h.id.valuesPerElement*k);for(l=0;l<d.header.fields.featureCount;l++)if(a.featureIds[l]=
c[l*h.id.valuesPerElement*k],2===k){var p=c[l*h.id.valuesPerElement*k+1];if(2097150<=p)throw Error("ID exceeded maximum range supported by javascript (max \x3d 53bit-1 \x3d 9007199254740991)");a.featureIds[l]+=4294967296*p}}}},c.prototype.loadBundleData=function(c,d){var h=this,l=c.baseUrl,p=null,t=this.loadShared(c),u=null;null!=this.requiredAttributes&&(u=this.loadAttributes(c,l,this.requiredAttributes));var b=null;null!=c.geometryData&&(l=k.makeAbsolute(c.geometryData[d].href,l),b=this.loadBinary(l));
return t.then(function(k){h.handleCancelled();return(h.options.loadFeatureData?h.loadFeatureData(c,d):a.resolve(null)).then(function(d){h.handleCancelled();var l=h.options.loadFeatureData?h.collectGeometries(c,d,k):h.meshPyramidGeometryData(c,k);d=null!=b?b.then(function(a){p=a;var b=Object.keys(k.materialDefinitions)[0],b=k.materialDefinitions[b].params.vertexRegions,c=r.createGeometryDataIndex(a,h.defaultGeometrySchema,b);return h.prepareBinaryGeometryData(l[0],a,c,b),l}):a.resolve(l);var m=h.loadTextures(l,
k);return a.all([m,d,u])}).then(function(a){var b=a[0],c=a[1];a=a[2];h.handleCancelled();var d=null;return a&&(d={attributeData:a,loadedAttributes:h.requiredAttributes}),{allGeometryData:c,attributeDataInfo:d,geometryBuffer:p,sharedResource:k,textureData:b}})})},c.addAbsoluteHrefTexture=function(a,c){a=a.textureDefinitions;if(null!=a)for(var d=0,h=Object.keys(a);d<h.length;d++)for(var l=0,p=a[h[d]].images;l<p.length;l++){var r=p[l];Array.isArray(r.href)?r.hrefConcat=r.href.map(function(a){return k.makeAbsolute(a,
c)}):r.hrefConcat=k.makeAbsolute(r.href,c)}},c.fixTextureEncodings=function(a){a=a.textureDefinitions;if(null!=a)for(var c in a){var d=a[c];if(Array.isArray(d.encoding))for(var h=0;h<d.encoding.length;h++){var k=d.encoding[h];"data:"===k.substring(0,5)&&(d.encoding[h]=k.substring(5))}else k=d.encoding,"data:"===k.substring(0,5)&&(d.encoding=k.substring(5))}},c.prototype.loadTexture=function(a,c,d,h){var k=this;return h===u.DDS_ENCODING_STRING?this.loadBinary(a).then(function(a){return k.handleCancelled(),
{i3sTexId:c,data:a,encoding:h}}):this.loadImage(a).then(function(a){var l=a;k.handleCancelled();if(d&&4096<=a.width*a.height){var l=Math.ceil(a.width/2),b=Math.ceil(a.height/2),m=document.createElement("canvas");m.width=l;m.height=b;m.getContext("2d").drawImage(a,0,0,l,b);l=m}return{i3sTexId:c,data:l,encoding:h}})},c.prototype.loadTextures=function(h,k){for(var l=[],p=0;p<h.length;p++){var r=h[p].geometries;if(null!=r)for(var t=0;t<r.length;t++){var w=r[t].params.textureID||"none";if("none"!==w){null!=
k.textureDefinitions&&null!=k.textureDefinitions[w]||this.logger.warn("textureDefinitions missing in shared resource. i3sTexId: "+w);var b=k.textureDefinitions[w];if(d.assert(void 0!==b,"geometry wants unknown texture "+w),0!==b.images.length){var m=b.images[b.images.length-1],A=this.options.textureFormat===c.TextureFormat.Downsampled,C=u.getAppropriateTextureEncoding(b.encoding,this.options.textureFormat===c.TextureFormat.Compressed),b=-1<C?b.encoding[C]:b.encoding,m=-1<C?m.hrefConcat[C]:m.hrefConcat;
this.options.loadTextureData?l.push(this.loadTexture(m,w,A,b)):l.push({i3sTexId:w,encoding:b,data:null})}}}}return a.all(l)},c.prototype.meshPyramidGeometryData=function(a,c){a=c.materialDefinitions?Object.keys(c.materialDefinitions)[0]:null;c=c.textureDefinitions?Object.keys(c.textureDefinitions)[0]:null;return[{featureIds:[],geometries:[{type:"ArrayBufferView",params:{materialID:a,textureID:c}}],featureDataPosition:[0,0,0]}]},c.prototype.collectGeometries=function(a,c,d){a=[];d=0;for(c=c.featureData;d<
c.length;d++){var h=c[d],k=h.geometries;if(null!=k)for(var l=0;l<k.length;l++)a.push({featureIds:[h.id],featureDataPosition:h.position,geometries:[h.geometries[l]]});else null!=h.position&&a.push({featureIds:[h.id],featureDataPosition:h.position,geometries:null})}return a},c.prototype.loadFeatureData=function(a,c){a=k.makeAbsolute(a.featureData[c].href,a.baseUrl);return this.loadJSON(a)},c.prototype.handleCancelled=function(){if(this.cancelled)throw new h;},c}();return function(a){a=a.TextureFormat||
(a.TextureFormat={});a[a.Compressed=0]="Compressed";a[a.Normal=1]="Normal";a[a.Downsampled=2]="Downsampled";!0}(A||(A={})),A})},"esri/views/3d/layers/i3s/I3SIndexTraversal":function(){define("require exports ./GoogPriorityQueue ../../support/PromiseLightweight ../../lib/glMatrix ../../../../core/urlUtils".split(" "),function(A,p,w,l,h,d){var u=w.goog.structs.PriorityQueue;return function(){function p(a,k,c,l,p,q,r,u,w,A,b){void 0===b&&(b={initDepthFirst:!0,neighborhood:!0,perLevelTraversal:!1});var m=
this;this.baseURL=a;this.startNodeUrl=k;this.rootId=c;this.poi=l;this.nodeIndex=p;this.streamDataSupplier=q;this.viewportQueries=r;this.processNodeIndexDocument=u;this.finishedLevelCallback=w;this.logger=A;this.traversalOptions=b;this.queues=[];this.knownNodes=new Set;this.dataLoadingPerLevel=[];this.numIndicesLoading=this.currentLevel=0;this.cancelled=this.queueTraversalEnabled=!1;this.progressiveLoadPenalty=0;this.initQueryErrback=function(){m.initPromise.done()};this.initQueryCallback=function(a,
b){if(m.cancelled)return void m.initPromise.done();if(m.nodeTraversalState(b.id),m.enqueueConnected(a,b,0),m.isLeafNode(b))m.initPromise.done();else{for(var c=1/0,h=null,k=0;k<b.children.length;++k){var l=b.children[k];if(m.nodeIsVisible(l)&&(!m.viewportQueries.hasLOD(b)||!m.viewportQueries.getLodLevel(b))){var p=m.viewportQueries.distToPOI(l,m.poi);c>p&&(c=p,h=l)}}h?(a=d.makeAbsolute(h.href,a),m.getNode(a,h.id,m.initQueryCallback,m.initQueryErrback)):m.initPromise.done()}};this.poi=h.vec3d.create(l);
this._maxLodLevel=this.viewportQueries.maxLodLevel}return p.prototype.updatePointOfInterest=function(a){h.vec3d.set(a,this.poi);this.reprioritizeQueues()},p.prototype.start=function(){var a=this;this._nodeTraversalState={};this._nodeIsVisibleCached={};this.dataLoadingPerLevel=[];this.currentLevel=0;this.maxLevel=[];for(var h=0;h<this._maxLodLevel;h++)this.maxLevel[h]=0;this.rootUrl=d.makeAbsolute(this.startNodeUrl,this.baseURL);this.traversalOptions.initDepthFirst?(this.initPromise=new l.Promise,
this.getNode(this.rootUrl,this.rootId,this.initQueryCallback,this.initQueryErrback),this.initPromise.then(function(){a.cancelled||(a.queueTraversalEnabled=!0)})):(this.enqueue({id:this.rootId,hrefConcat:this.rootUrl,mbs:null},0),this.queueTraversalEnabled=!0)},p.prototype.continueTraversal=function(a){if(void 0===a&&(a=5),this.queueTraversalEnabled)for(var d=0;d<this.queues.length;d++)if(!this.traversalOptions.perLevelTraversal||this.currentLevel===d){for(var c=this.queues[d];this.numIndicesLoading<
a&&!c.isEmpty();)this.processQueueOne(d);this.traversalOptions.perLevelTraversal&&c.isEmpty()&&0===this.dataLoadingPerLevel[d]&&(this.finishedLevelCallback.call(null,this.currentLevel),this.currentLevel++)}},p.prototype.isQueueTraversalEnabled=function(){return this.queueTraversalEnabled},p.prototype.getQueueSize=function(){for(var a=0,d=0;d<this.queues.length;d++)a+=this.queues[d].getCount();return a},p.prototype.cancel=function(){this.queueTraversalEnabled=!1;for(var a=0;a<this.queues.length;a++)this.queues[a].clear();
this.cancelled=!0},p.prototype.isLoading=function(){return 0<this.numIndicesLoading||0<this.getQueueSize()},p.prototype.getNumLoading=function(){return this.numIndicesLoading+this.dataLoadingPerLevel[this.currentLevel]},p.prototype.getMaxLevel=function(a){return this.maxLevel[a]},p.prototype.nodeIsVisible=function(a){return this.traversalOptions.loadEverything?!0:null!=this._nodeIsVisibleCached[a.id]?this._nodeIsVisibleCached[a.id]:(this._nodeIsVisibleCached[a.id]=this.viewportQueries.isNodeVisible(a),
this._nodeIsVisibleCached[a.id])},p.prototype.nodeTraversalState=function(a){if(null!=this._nodeTraversalState[a])return this._nodeTraversalState[a];var d=this.nodeIndex[a];if(null==d)return null;var c=null,h=0;if(null!=d.parentNode){if(c=this.nodeIndex[d.parentNode.id],null==c)return null;c=this._nodeTraversalState[c.id];null!=c&&(h=c.lodLevel)}var c=this.viewportQueries.hasLOD(d),l=this.viewportQueries.getLodLevel(d);return this._nodeTraversalState[d.id]={visited:!0,nodeHasLOD:c,lodLevel:l,isChosen:!c||
l>h},this._nodeTraversalState[a]},p.prototype.reprioritizeQueues=function(){for(var a=0;a<this.queues.length;a++)this.queues[a]=this.reprioritizeQueue(this.queues[a])},p.prototype.reprioritizeQueue=function(a){for(var d=new u;!a.isEmpty();){var c=a.dequeue(),h=this.entryPriority(c);d.enqueue(h,c)}return d},p.prototype.processQueueOne=function(a){var d=this,c=this.queues[a].dequeue();this.dataLoadingPerLevel[a]++;var h=function(){return d.dataLoadingPerLevel[a]--},l=function(k,l){d.nodeTraversalState(l.id);
d.enqueueConnected(k,l,a);k=d.entryPriority(c);d.processNodeIndexDocument(l,k).then(h,h)};this.getNode(c.hrefConcat,c.id,function(a,c){if(d.traversalOptions.neighborhood&&null!=c.parentNode){var k=d.concatHref(c.parentNode,a);d.getNode(k,c.parentNode.id,function(){return l(a,c)},h)}else l(a,c)},h)},p.prototype.getNode=function(a,d,c,h){var k=this;this.numIndicesLoading++;this.nodeIndex[d]?(c(a,this.nodeIndex[d]),this.numIndicesLoading--):this.streamDataSupplier.request(a,"json").then(function(a,d){k.nodeIndex[d.id]=
d;d.baseUrl=a;c(a,d);k.numIndicesLoading--},function(c){null!=h&&h(c);k.loadErrorCallback(a);k.numIndicesLoading--})},p.prototype.isLeafNode=function(a){return null==a.children},p.prototype.concatHref=function(a,h){return d.makeAbsolute(a.href,h)},p.prototype.enqueue=function(a,d){this.traversalOptions.perLevelTraversal||(d=0);for(this.knownNodes.add(a.id);this.queues.length<=d;)this.queues.push(new u),this.dataLoadingPerLevel.push(0);var c=this.entryPriority(a);this.queues[d].enqueue(c,a)},p.prototype.entryPriority=
function(a){if(a.id===this.rootId)return 0;var d=0,c=this.nodeIndex[a.id];null!=c&&null!=c.parentNode&&(c=this._nodeTraversalState[c.parentNode.id],null!=c&&(d=c.lodLevel));a=this.viewportQueries.distToPOI(a,this.poi);return a+d*(a+this.progressiveLoadPenalty)},p.prototype.queueEntryFromNode=function(a,d){return{id:a.id,mbs:a.mbs,hrefConcat:d}},p.prototype.queueEntryFromNodeRef=function(a,d){return this.queueEntryFromNode(a,this.concatHref(a,d))},p.prototype.enqueueConnected=function(a,d,c){if(!this.cancelled&&
null!=d){d.id===this.rootId||null==d.parentNode||this.knownNodes.has(d.parentNode.id)?d.id===this.rootId&&!this.knownNodes.has(d.id)&&this.nodeIsVisible(d)&&this.enqueue(this.queueEntryFromNode(d,a),c):this.enqueue(this.queueEntryFromNodeRef(d.parentNode,a),c-1);var h=this.nodeTraversalState(d.id);if(!h.nodeHasLOD||h.lodLevel!==this._maxLodLevel){if(d.children)for(var k=0,l=d.children;k<l.length;k++){var p=l[k],r=this.nodeIsVisible(p);!this.knownNodes.has(p.id)&&r&&(this.enqueue(this.queueEntryFromNodeRef(p,
a),c+1),this.maxLevel[h.lodLevel]=Math.max(d.level+1,this.maxLevel[h.lodLevel]))}if(this.traversalOptions.neighborhood&&d.neighbors)for(h=0,d=d.neighbors;h<d.length;h++)k=d[h],l=this.nodeIsVisible(k),!this.knownNodes.has(k.id)&&l&&this.enqueue(this.queueEntryFromNodeRef(k,a),c)}}},p.prototype.loadErrorCallback=function(a){this.logger.warn("Error loading node: "+a)},p}()})},"esri/views/3d/layers/i3s/GoogPriorityQueue":function(){define([],function(){var A={};return function(){function p(a){var c=typeof a;
if("object"==c){if(!a)return"null";if(a instanceof Array)return"array";if(a instanceof Object)return c;var d=Object.prototype.toString.call(a);if("[object Window]"==d)return"object";if("[object Array]"==d||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==d||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else if("function"==
c&&"undefined"==typeof a.call)return"object";return c}function w(d,c){d=d.split(".");var h=a;d[0]in h||!h.execScript||h.execScript("var "+d[0]);for(var k;d.length&&(k=d.shift());)d.length||void 0===c?h=h[k]?h[k]:h[k]={}:h[k]=c}function l(a,c){this.d=a;this.b=c}function h(a){if("array"!=p(a))for(var c=a.length-1;0<=c;c--)delete a[c];a.length=0}function d(a){if(this.a=[],a)a:{var c,h;if(a instanceof d){c=a.a;h=[];for(var k=c.length,p=0;k>p;p++)h.push(c[p].getKey());c=h;h=a.a;for(var k=[],p=h.length,
r=0;p>r;r++)k.push(h[r].b);if(h=k,0>=a.a.length){a=this.a;for(k=0;k<c.length;k++)a.push(new l(c[k],h[k]));break a}}else{c=[];k=0;for(p in a)c[k++]=p;k=[];p=0;for(h in a)k[p++]=a[h];h=k}for(k=0;k<c.length;k++)u(this,c[k],h[k])}}function u(a,c,d){var h=a.a;h.push(new l(c,d));c=h.length-1;a=a.a;for(d=a[c];0<c&&(h=c-1>>1,a[h].getKey()>d.getKey());)a[c]=a[h],c=h;a[c]=d}function r(){d.call(this)}var a=this;l.prototype.getKey=function(){return this.d};l.prototype.c=function(){return new l(this.d,this.b)};
d.prototype.remove=function(){var a=this.a,c=a.length,d=a[0];if(!(0>=c)){if(1==c)h(a);else{a[0]=a.pop();for(var a=0,c=this.a,l=c.length,p=c[a];l>>1>a;){var r=2*a+1,u=2*a+2,r=l>u&&c[u].getKey()<c[r].getKey()?u:r;if(c[r].getKey()>p.getKey())break;c[a]=c[r];a=r}c[a]=p}return d.b}};d.prototype.c=function(){return new d(this)};d.prototype.g=function(){return this.a.length};d.prototype.h=function(){return 0==this.a.length};d.prototype.clear=function(){h(this.a)};(function(){function a(){}a.prototype=d.prototype;
r.i=d.prototype;r.prototype=new a})();r.prototype.f=function(a,c){u(this,a,c)};r.prototype.e=function(){return this.remove()};w("goog.structs.PriorityQueue",r);w("goog.structs.PriorityQueue.prototype.enqueue",r.prototype.f);w("goog.structs.PriorityQueue.prototype.dequeue",r.prototype.e);w("goog.structs.PriorityQueue.prototype.isEmpty",r.prototype.h);w("goog.structs.PriorityQueue.prototype.clear",r.prototype.clear);w("goog.structs.PriorityQueue.prototype.clone",r.prototype.c);w("goog.structs.PriorityQueue.prototype.getCount",
r.prototype.g)}.call(A),A})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["require","exports"],function(A,p){return function(){function p(l,h,d){this.layerViewRequiredFunctions=l;this.layerViewOptionalFunctions=h;this.lodGlobalDirtyChanged=d}return p.prototype.startNodeLoading=function(l,h,d,p,r){this._lodGlobalDirty=!1;this._lodMode=r.mode;this._allowPartialOverlaps=r.allowPartialOverlaps;this._maxLodLevel=r.maxLodLevel;this._nodeIndex=d;this._rootId=p;this._nodeTraversalState=h;
this._nodeIsVisible=l;this.lodGlobalDirtyChanged(this._lodGlobalDirty)},p.prototype.shouldLoadNode=function(l){var h=this._nodeTraversalState(l.id);return"perLevel"!==this._lodMode?h.isChosen?h.lodLevel===this._maxLodLevel?!0:this._subtreeEmpty(l):!1:h.isChosen||!h.nodeHasLOD?!0:this._allowPartialOverlaps?!this._subtreeComplete(l):this._subtreeEmpty(l)},p.prototype.setLodGlobalDirty=function(){this._lodGlobalDirty=!0;this.lodGlobalDirtyChanged(this._lodGlobalDirty)},p.prototype.finishedLevel=function(l){"perLevel"===
this._lodMode&&this._removeUpToLevelRecursive(this._nodeIndex[this._rootId],l-1)},p.prototype.lodSwapBundleLoaded=function(l){if("perLevel"===this._lodMode){var h=this._nodeTraversalState(l.id).isChosen;h&&this._removeChildrenRecursive(l);null!=this.layerViewOptionalFunctions.setPolygonOffset&&this.layerViewOptionalFunctions.setPolygonOffset(l,!h)}else this.setLodGlobalDirty()},Object.defineProperty(p.prototype,"requiresLODGlobalHandling",{get:function(){return"global"===this._lodMode&&null!=this._rootId&&
(!0===this._lodGlobalDirty||this.layerViewRequiredFunctions.isOverMemory())},enumerable:!0,configurable:!0}),p.prototype.lodGlobalHandling=function(){if(this.requiresLODGlobalHandling){var l=this._rootId,h=this.layerViewRequiredFunctions.isOverMemory();this._lodGlobalHandlingRecursion(l,!1,h);this._lodGlobalDirty=!1;this.lodGlobalDirtyChanged(this._lodGlobalDirty)}},p.prototype._lodGlobalHandlingRecursion=function(l,h,d){var p=this._nodeIndex[l];if(null==p)return!1;l=this._nodeTraversalState(l);l=
l.isChosen&&(!l.nodeHasLOD||l.lodLevel===this._maxLodLevel);var r=this.layerViewRequiredFunctions.isBundleAlreadyAddedToStage(p,0);r&&null!=this.layerViewOptionalFunctions.setPolygonOffset&&this.layerViewOptionalFunctions.setPolygonOffset(p,!l);if(l&&r)return this._removeChildrenRecursive(p),!0;var a=!1;if(null!=p.children&&0!==p.children.length)for(var a=!0,k=0,c=p.children;k<c.length;k++){var t=c[k];this._nodeIsVisible(t)&&(t=this._lodGlobalHandlingRecursion(t.id,r||h,d),a=a&&t)}return r&&!l&&(h||
a||d)&&(this.layerViewRequiredFunctions.removeNodeData(p),r=!1),a||r},p.prototype._removeChildrenRecursive=function(l){if(null!=l.children){var h=0;for(l=l.children;h<l.length;h++){var d=this._nodeIndex[l[h].id];null!=d&&(this._removeChildrenRecursive(d),this.layerViewRequiredFunctions.removeNodeData(d))}}},p.prototype._removeUpToLevelRecursive=function(l,h){if(!(null==l||0>h)&&(this._nodeTraversalState(l.id).isChosen||this.layerViewRequiredFunctions.removeNodeData(l),null!=l.children)){var d=0;for(l=
l.children;d<l.length;d++)this._removeUpToLevelRecursive(this._nodeIndex[l[d].id],h-1)}},p.prototype._subtreeEmpty=function(l){if(this.layerViewRequiredFunctions.areAllBundlesLoaded(l))return!1;if(null==l.children)return!0;var h=0;for(l=l.children;h<l.length;h++){var d=l[h];if(this._nodeIsVisible(d)&&(d=this._nodeIndex[d.id],null!=d&&!this._subtreeEmpty(d)))return!1}return!0},p.prototype._subtreeComplete=function(l){if(this.layerViewRequiredFunctions.areAllBundlesLoaded(l))return!0;if(null==l.children||
0===l.children.length)return!1;var h=0;for(l=l.children;h<l.length;h++){var d=l[h];if(this._nodeIsVisible(d)&&(d=this._nodeIndex[d.id],null==d||!this._subtreeComplete(d)))return!1}return!0},p}()})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("require exports ../../lib/glMatrix ./I3SUtil ../../webgl-engine/lib/Util ../../support/projectionUtils ../graphics/featureExpressionInfoUtils ../graphics/ElevationContext ../graphics/Graphics3DSymbolCommonCode ../../../../geometry/Point".split(" "),
function(A,p,w,l,h,d,u,r,a,k){var c=w.vec3d,t=w.vec4d;return function(){function p(a,c,d,l,p,b,m,w,A){void 0===A&&(A={});this._computedMbs=a;this.indexSR=c;this._renderCoordsHelper=d;this.extent=p;this.errorMetricPreference=b;this.elevationProvider=m;this.options=A;this.fp=[];this.maxLodLevel=2;this._tmp1=[0,0,0];this._tmp2=[0,0,0];this._tmp3=[0,0,0];this._tmp0=[0,0,0];this.supportedMetrics=["screenSpaceRelative","maxScreenThreshold","removedFeatureDiameter","distanceRangeFromDefaultCamera"];this.screenspaceErrorBias=
A.screenspaceErrorBias||1;this.progressiveLoadFactor=A.progressiveLoadFactor||1;this.enableLoD=!A.disableLod;for(a=0;8>a;++a)this.fp[a]=t.create();h.matrix2frustumPlanes(l.viewMatrix,l.projectionMatrix,this.fp);this.engineSR=this._renderCoordsHelper.spatialReference;this._screenSizeFactor=1/l.perPixelRatio;this._camPos=l.eye;w?(this._elevationContext=new r,this._elevationContext.featureExpressionInfoContext=u.createContext(u.extractExpressionInfo(w,!1)),this._elevationContext.mixinApi(w)):this._elevationContext=
null;this.tmpPoint=new k({x:0,y:0,z:0,spatialReference:c})}return p.prototype.computedMbs=function(c){var h=this._computedMbs[c.id];return null==h&&(h=t.createFrom(0,0,0,-1),this._computedMbs[c.id]=h),0>h[3]&&(t.set(c.mbs,h),this._elevationContext&&1E5>c.mbs[3]&&(this.tmpPoint.x=h[0],this.tmpPoint.y=h[1],this.tmpPoint.z=h[2],h[2]=a.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),d.mbsToMbs(h,this.indexSR,h,this.engineSR)),h},p.prototype.isNodeVisible=
function(a){a=this.computedMbs(a);return this.isMBSinExtent(a)&&this.isMBSVisible(a)},p.prototype.isMBSinExtent=function(a){return this.extent?0!==l.intersectBoundingBoxWithMbs(this.extent,a):!0},p.prototype.isMBSVisible=function(a){var c=a[0],d=a[1],h=a[2];a=a[3];var k=this.fp;return k[0][0]*c+k[0][1]*d+k[0][2]*h+k[0][3]<=a&&k[1][0]*c+k[1][1]*d+k[1][2]*h+k[1][3]<=a&&k[2][0]*c+k[2][1]*d+k[2][2]*h+k[2][3]<=a&&k[3][0]*c+k[3][1]*d+k[3][2]*h+k[3][3]<=a&&k[4][0]*c+k[4][1]*d+k[4][2]*h+k[4][3]<=a&&k[5][0]*
c+k[5][1]*d+k[5][2]*h+k[5][3]<=a},p.prototype.calcScreenSpaceSize=function(a,d){a=this.computedMbs(a);var h=a[3];a=c.dist2(a,this._camPos)-h*h;return 0>a?.5*Number.MAX_VALUE:d/Math.sqrt(a)*this._screenSizeFactor},p.prototype.calcCameraDistance=function(a){a=this.computedMbs(a);return Math.max(0,c.dist(a,this._camPos)-a[3])},p.prototype.calcAngleDependentLoD=function(a){a=this.computedMbs(a);var d=a[3];a=(Math.abs(a[0]*(a[0]-this._camPos[0])+a[1]*(a[1]-this._camPos[1])+a[2]*(a[2]-this._camPos[2]))/
c.length(a)+d)/c.dist(a,this._camPos);return Math.min(1,a)},p.prototype.hasLOD=function(a){return null!=a.lodSelection},p.prototype.hasFeatures=function(a){return null!=a.featureData},p.prototype.getDistancePlanarMode=function(a,c,d){var h=a[0]-c[0],k=a[1]-c[1];a=a[2]-c[2];h=h+h+k*k;if(d*d>=h)return Math.abs(a);d=Math.sqrt(h)-d;return Math.sqrt(a*a+d*d)},p.prototype.getDistanceGlobeMode=function(a,d,h){var k=c.length(d),l=c.length(a)-k;c.scale(a,c.dot(a,d)/c.length2(a),this._tmp0);var b=c.dist2(d,
this._tmp0);if(h*h>=b)return Math.abs(l);d=c.scale(d,1/k,this._tmp0);k=c.scale(d,k-h*h/2/k,this._tmp1);b=c.subtract(a,k,this._tmp2);b=c.subtract(b,c.scale(d,c.dot(d,b),this._tmp3),this._tmp2);k=c.add(k,c.scale(b,h/c.length(b),this._tmp2),this._tmp2);h=c.dist(a,k);2E5<=l&&(a=c.subtract(a,k,this._tmp1),a=c.dot(a,d)/c.length(a),.08>a&&(a=1E-4),h/=a);return h},p.prototype.getDistance=function(a,c,h){return this.engineSR===d.SphericalECEFSpatialReference?this.getDistanceGlobeMode(a,c,h):this.getDistancePlanarMode(a,
c,h)},p.prototype._selectErrorMetric=function(a){if(this.errorMetricPreference)for(var c=0;c<this.errorMetricPreference.length;c++)for(var d=0;d<a.length;d++){if(a[d].metricType===this.errorMetricPreference[c])return a[d]}else for(c=0;c<a.length;c++)if(0<=this.supportedMetrics.indexOf(a[c].metricType))return a[c];return null},p.prototype.getLodLevel=function(a){if(a.lodSelection&&0<a.lodSelection.length){if(!1===this.hasFeatures(a))return 0;if(null==a.children||0===a.children.length)return this.maxLodLevel;
var c=this.enableLoD?this._selectErrorMetric(a.lodSelection):null;if(null!=c){if(1>this.progressiveLoadFactor){var d=this.screenspaceErrorBias;return this.evaluateLODmetric(a,this.progressiveLoadFactor*this.screenspaceErrorBias,c)?this.evaluateLODmetric(a,d,c)?2:1:0}return this.evaluateLODmetric(a,this.screenspaceErrorBias,c)?this.maxLodLevel:0}}return 0},p.prototype.evaluateLODmetric=function(a,c,d){return"screenSpaceRelative"===d.metricType?(a=this.computedMbs(a),a=2*this.getDistance(this._camPos,
a,a[3])/this._screenSizeFactor,d.maxError*c<=a):"maxScreenThreshold"===d.metricType?(c=this.calcScreenSpaceSize(a,a.mbs[3]*c),this.options.angleDependentLoD&&(c*=this.calcAngleDependentLoD(a)),c<d.maxError):"removedFeatureDiameter"===d.metricType?10>this.calcScreenSpaceSize(a,d.maxError)*c:"distanceRangeFromDefaultCamera"===d.metricType?this.calcCameraDistance(a)>d.maxError*c:!1},p.prototype.distToPOI=function(a,d){a=this.computedMbs(a);return c.dist(a,d)-a[3]},p.prototype.distCameraToPOI=function(a){return c.dist(this._camPos,
a)},p}()})},"esri/views/3d/layers/i3s/IdleQueue":function(){define(["require","exports","dojo/Deferred"],function(A,p,w){Object.defineProperty(p,"__esModule",{value:!0});A=function(){function l(){this._deferreds=[];this._values=[]}return l.prototype.push=function(h){var d=new w;return this._deferreds.push(d),this._values.push(h),d.promise},l.prototype.length=function(){return this._deferreds.length},l.prototype.process=function(){this._deferreds.shift().resolve(this._values.shift())},l.prototype.cancelAll=
function(){for(var h=0,d=this._deferreds;h<d.length;h++)d[h].cancel();this._deferreds.length=0;this._values.length=0},l}();p.IdleQueue=A})},"esri/layers/SceneLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./Layer ./FeatureLayer ./support/Field ./support/fieldUtils ./support/LabelClass ../symbols/support/ElevationInfo ./support/labelingInfo ./support/FeatureReduction ./mixins/SceneService ./support/commonProperties ../PopupTemplate ../request ../core/requireUtils ../core/promiseUtils ../core/urlUtils ../core/Error ../core/Logger ../core/accessorSupport/PropertyOrigin ../core/accessorSupport/utils ../renderers/support/jsonUtils ../renderers/support/styleUtils ../renderers/support/typeUtils ../portal/PortalItem ../tasks/support/Query dojo/_base/lang dojo/promise/all".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E,J,G,K,M,U,N,W,R,V,Q){function S(a,b,c){return a&&(a=M.read(a,b,c)||void 0,a||z.error("Failed to create renderer",{rendererDefinition:a,layer:this,context:c})),a}var X=["3DObject","Point"],z=J.getLogger("esri.layers.SceneLayer"),Z={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},
O={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return function(d){function e(a,b){a=d.call(this)||this;return a.featureReduction=null,a.operationalLayerType="ArcGISSceneServiceLayer",a.type="scene",a.fields=[],a.definitionExpression=null,a.elevationInfo=null,a.labelsVisible=!1,a.labelingInfo=null,a.legendEnabled=!0,a.cachedDrawingInfo={color:!1},a.popupEnabled=!0,a.popupTemplate=null,a.objectIdField=null,a.objectIdFilter=null,a._fieldUsageInfo={},a.screenSizePerspectiveEnabled=
!0,a}return w(e,d),e.prototype.normalizeCtorArgs=function(a,b){return"string"==typeof a?V.mixin({},{url:a},b):a},e.prototype.getField=function(b){return a.getField(b,this.fields)},Object.defineProperty(e.prototype,"geometryType",{get:function(){return O[this.profile]||"mesh"},enumerable:!0,configurable:!0}),e.prototype.readLabelsVisible=function(a,b){return b.showLabels},e.prototype.writeLabelsVisible=function(a,b){b.showLabels=!!a},Object.defineProperty(e.prototype,"renderer",{set:function(b){a.fixRendererFields(b,
this.fields);this._set("renderer",b)},enumerable:!0,configurable:!0}),e.prototype.readCachedDrawingInfo=function(a,b){return(null==a||"object"!=typeof a)&&(a={}),null==a.color&&(a.color=!1),a},e.prototype.readPopupEnabled=function(a,b){return null!=b.disablePopup?!b.disablePopup:void 0},e.prototype.writePopupEnabled=function(a,b){a||(b.disablePopup=!0)},e.prototype.readObjectIdField=function(a,b){return!a&&b.fields&&b.fields.some(function(b){return"esriFieldTypeOID"===b.type&&(a=b.name),!!a}),a||
void 0},e.prototype.readProfile=function(a,b){a=b.store.profile;return null!=a&&Z[a]?Z[a]:(z.error("Unknown or missing profile",{profile:a,layer:this}),"mesh-pyramids")},e.prototype.readNormalReferenceFrame=function(a,b){return b.store.normalReferenceFrame},e.prototype.load=function(){var b=this,c=this.loadFromPortal({supportedTypes:["Scene Service"]}).always(function(){return b._fetchService()}).then(function(){return Q([b._verifyRootNodeAndUpdateExtent(),b._setCompanionFeatureLayer()])}).then(function(){return b._applyCompanionOverrides()}).then(function(){return b._populateFieldUsageInfo()}).then(function(){return U.loadStyleRenderer(b,
{origin:"service"})}).then(function(){return a.fixRendererFields(b.renderer,b.fields)});return this.addResolvingPromise(c),this.when()},e.prototype.createLayerView=function(a){var b,c=this;return b=null==this.profile||"mesh-pyramids"===this.profile?"../views/3d/layers/SceneLayerView3D":"../views/3d/layers/SceneLayerGraphicsView3D",D.when(A,b).then(function(b){return new b({view:a,layer:c})})},e.prototype.createQuery=function(){var a=new R;return"mesh"!==this.geometryType&&(a.returnGeometry=!0,a.returnZ=
!0),a.where=this.definitionExpression||"1\x3d1",a.sqlFormat="standard",a},e.prototype.queryExtent=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryExtent(a||b.createQuery())})},e.prototype.queryFeatureCount=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeatureCount(a||b.createQuery())})},e.prototype.queryFeatures=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeatures(a||
b.createQuery())}).then(function(a){if(a&&a.features)for(var c=0,e=a.features;c<e.length;c++)e[c].layer=b;return a})},e.prototype.queryObjectIds=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryObjectIds(a||b.createQuery())})},e.prototype.getFieldUsageInfo=function(a){return this._fieldUsageInfo[a]||{supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1}},e.prototype._getAssociatedLayerForQuery=function(){var a=this;
if(!this.loaded)return this.load().then(function(){return a._getAssociatedLayerForQuery()});var c=this.associatedLayer;return null!=c?b.resolve(c):b.reject(new E("scenelayer:query-not-available","SceneLayer queries are not available without associated feature layer"))},e.prototype.hasCachedStatistics=function(a){return null!=this.statisticsInfo&&this.statisticsInfo.some(function(b){return b.name===a})},e.prototype.queryCachedStatistics=function(a){if(!this.hasCachedStatistics(a))return b.reject(new E("scenelayer:no-cached-statistics",
"Cached statistics for this attribute are not available"));for(var c=0,e=this.statisticsInfo;c<e.length;c++){var d=e[c];if(d.name===a)return a=m.join(this.parsedUrl.path,d.href),B(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data})}},e.prototype.graphicChanged=function(a){this.emit("graphic-update",a)},e.prototype._validateLayer=function(a){if(a.layerType&&-1===X.indexOf(a.layerType))throw new E("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",
{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new E("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new E("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});a=this.normalReferenceFrame;var b=this.spatialReference,c=!1,e=!1;if(null==a)e=c=!0;else switch(b=
b&&b.isGeographic,a){case "east-north-up":case "earth-centered":c=!0;e=b;break;case "vertex-reference-frame":c=!0;e=!b;break;default:c=!1}if(!c)throw new E("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!e)throw new E("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");},e.prototype._populateFieldUsageInfo=function(){if(this._fieldUsageInfo={},this.fields)for(var a=function(a){var c=!(!b.attributeStorageInfo||
!b.attributeStorageInfo.some(function(b){return b.name===a.name})),e=!!(b.associatedLayer&&b.associatedLayer.fields&&b.associatedLayer.fields.some(function(b){return b&&a.name===b.name}));b._fieldUsageInfo[a.name]={supportsLabelingInfo:c,supportsRenderer:c,supportsPopupTemplate:c||e,supportsLayerQuery:e}},b=this,c=0,e=this.fields;c<e.length;c++)a(e[c])},e.prototype._applyCompanionOverrides=function(){if(this.associatedLayer){if(this.associatedLayer.fields)for(var a=0,b=this.associatedLayer.fields;a<
b.length;a++){var c=b[a];this.getField(c.name)||this.fields.push(c.clone())}a=["popupTemplate","popupEnabled"];b=K.getProperties(this);for(c=0;c<a.length;c++){var e=a[c];this._buddyIsMoreImportant(e)&&(b.setDefaultOrigin(this.associatedLayer.originOf(e)),b.set(e,this.associatedLayer[e]),b.setDefaultOrigin("user"))}}},e.prototype._setCompanionFeatureLayer=function(){var a=this;return this._fetchCompanionFeatureLayer().then(function(b){a.associatedLayer=b})},e.prototype._fetchCompanionFeatureLayer=
function(){var a,c=this;return-1===["mesh-pyramids","points"].indexOf(this.profile)?b.resolve(null):(a=this.portalItem&&this.portalItem.isResolved()?this._fetchCompanionFeatureLayerFromRelatedItems(this.portalItem):this._fetchCompanionFeatureLayerFromUrl(),a.then(function(a){return a.load()}).otherwise(function(a){return null==c.attributeStorageInfo?z.warn("Companion FeatureLayer could not be loaded and no binary attributes found. Popups will not work for this SceneLayer: "+c.title):z.info("Companion FeatureLayer could not be loaded. Falling back to binary attributes for Popups on this SceneLayer: "+
c.title),null}))},e.prototype._fetchCompanionFeatureLayerFromRelatedItems=function(a){var c=this;return a.fetchRelatedItems({relationshipType:"Service2Data",direction:"forward"}).then(function(a){return(a=a.filter(function(a){return"Feature Service"===a.type})[0])?c._fetchCompanionFeatureLayerFromPortalItem(new W({id:a.id,portal:a.portal})):b.reject()}).otherwise(function(){return c._fetchCompanionFeatureLayerFromUrl()})},e.prototype._fetchCompanionFeatureLayerFromPortalItem=function(a){var c=this;
return a.load().then(function(a){return c._findMatchingCompanionSublayerUrl(a.url)}).then(function(c){return b.resolve(new u({url:c,portalItem:a}))})},e.prototype._fetchCompanionFeatureLayerFromUrl=function(){return this._findMatchingCompanionSublayerUrl().then(function(a){return b.resolve(new u({url:a}))})},e.prototype._findMatchingCompanionSublayerUrl=function(a){var c=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);if(!c)return b.reject();null==a&&(a=c[1]+"/FeatureServer");
var e=a.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");a={query:{f:"json"},responseType:"json"};var d=c[1]+"/SceneServer",f=parseInt(c[2],10),c=B(d,a).otherwise(function(a){return{layers:null}});a=B(e,a);return Q([a,c]).then(function(a){var b=a[0];a=a[1];a=a.data&&a.data.layers;b=b.data&&b.data.layers;if(!Array.isArray(b))throw Error("expected layers array");if(Array.isArray(a))for(var c=0;c<Math.min(a.length,b.length);c++){if(a[c].id===f)return e+"/"+b[c].id}else if(f<b.length)return e+"/"+b[f].id;
throw Error("could not find matching associated sublayer");})},e.prototype._buddyIsMoreImportant=function(a){if(!this.associatedLayer)return!1;var b=G.nameToId(this.originOf(a));a=G.nameToId(this.associatedLayer.originOf(a));return null!=a&&a<=G.OriginId.SERVICE?null==b||b<G.OriginId.SERVICE:null!=a&&a<=G.OriginId.PORTAL_ITEM?null==b||b<G.OriginId.PORTAL_ITEM:!1},l([h.shared("esri.layers.SceneLayer")],e.prototype,"declaredClass",void 0),l([h.property({types:{key:"type",base:C.FeatureReduction,typeMap:{selection:C.FeatureReductionSelection}},
json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],e.prototype,"featureReduction",void 0),l([h.property()],e.prototype,"associatedLayer",void 0),l([h.property()],e.prototype,"operationalLayerType",void 0),l([h.property({json:{read:!1},readOnly:!0})],e.prototype,"type",void 0),l([h.property({type:[r]})],e.prototype,"fields",void 0),l([h.property({readOnly:!0})],e.prototype,"attributeStorageInfo",void 0),l([h.property({readOnly:!0})],
e.prototype,"statisticsInfo",void 0),l([h.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],e.prototype,"definitionExpression",void 0),l([h.property({type:c,json:{origins:{service:{read:{source:"elevationInfo"}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],e.prototype,"elevationInfo",void 0),l([h.property({type:String,dependsOn:["profile"]})],
e.prototype,"geometryType",null),l([h.property({type:Boolean})],e.prototype,"labelsVisible",void 0),l([h.reader("labelsVisible",["showLabels"])],e.prototype,"readLabelsVisible",null),l([h.writer("labelsVisible")],e.prototype,"writeLabelsVisible",null),l([h.property({type:[k],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:t.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:t.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],
e.prototype,"labelingInfo",void 0),l([h.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],e.prototype,"legendEnabled",void 0),l([h.property({types:N.types,json:{origins:{service:{read:{source:"drawingInfo.renderer",reader:S}}},read:{source:"layerDefinition.drawingInfo.renderer",reader:S},write:{target:"layerDefinition.drawingInfo.renderer"}},value:null})],e.prototype,"renderer",null),l([h.property({json:{read:!1}})],e.prototype,
"cachedDrawingInfo",void 0),l([h.reader("service","cachedDrawingInfo")],e.prototype,"readCachedDrawingInfo",null),l([h.property({type:Boolean})],e.prototype,"popupEnabled",void 0),l([h.reader("popupEnabled",["disablePopup"])],e.prototype,"readPopupEnabled",null),l([h.writer("popupEnabled")],e.prototype,"writePopupEnabled",null),l([h.property({type:y,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],e.prototype,"popupTemplate",void 0),l([h.property({type:String,json:{read:!1}})],e.prototype,
"objectIdField",void 0),l([h.reader("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdField",null),l([h.property()],e.prototype,"objectIdFilter",void 0),l([h.property({type:String,json:{read:!1}})],e.prototype,"profile",void 0),l([h.reader("service","profile",["store.profile"])],e.prototype,"readProfile",null),l([h.property({readOnly:!0,type:String,json:{read:!1}})],e.prototype,"normalReferenceFrame",void 0),l([h.reader("service","normalReferenceFrame",["store.normalReferenceFrame"])],
e.prototype,"readNormalReferenceFrame",null),l([h.property(v.screenSizePerspectiveEnabled)],e.prototype,"screenSizePerspectiveEnabled",void 0),e=l([h.subclass()],e)}(h.declared(d,q))})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ./TiledLayerView3D ./support/tiledLayerUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k){return function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return w(c,a),c.prototype.initialize=function(){var a=this,c=this.get("view.map.ground.layers"),h=this.get("view.map.allLayers"),h=h&&h.includes(this.layer),c=c&&c.includes(this.layer);h&&!c&&(c=new d("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added in the map ground"),this.addResolvingPromise(u.reject(c)));(c=this._getTileInfoSupportError(this.tileInfo,
this.layer.fullExtent))?this.addResolvingPromise(u.reject(c)):(c=r.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(function(){k.throwIfError(a._getTileInfoCompatibilityError(a.tileInfo,a.view.basemapTerrain.tilingScheme))}),this.addResolvingPromise(c));this.addResolvingPromise(k.checkArcGISServiceVersionCompatibility(this.layer));this._updateMinMaxDataLevel()},l([h.property({aliasOf:"layer.fullExtent"})],c.prototype,"fullExtent",void 0),l([h.property()],c.prototype,"layer",void 0),
l([h.property({aliasOf:"layer.tileInfo"})],c.prototype,"tileInfo",void 0),c=l([h.subclass("esri.views.3d.layers.ElevationLayerView3D")],c)}(h.declared(a))})},"esri/views/3d/layers/support/tiledLayerUtils":function(){define("require exports dojo/request/xhr ../../../../core/Error ../../../../core/promiseUtils ../../../../layers/support/arcgisLayerUrl".split(" "),function(A,p,w,l,h,d){function u(d){var a=null,h=d.search(/\/rest\/services\//i);return 0<h&&(a=d.substring(0,h+6)),a}Object.defineProperty(p,
"__esModule",{value:!0});p.checkArcGISServiceVersionCompatibility=function(p){if(!d.isHostedAgolService(p.url)){if(10.22>p.version)return p=new l("layerview:service-version-too-old","Tiled Map Layers on servers prior to 10.2.2 are not supported. Detected version: "+p.version,{minVersion:10.22,detectedVersion:p.version}),h.reject(p);if(10.22!==p.version||d.isHostedSecuredProxyService(p.url,p.get("portalItem.id")))return h.resolve();p=u(p.url);var a=new l("tiledlayerview3d:service-missing-cors-patch",
"Tiled Map Layers from 10.2.2 servers are only supported if all server updates have been applied.");return w(p+"self?f\x3djson",{headers:{"X-Requested-With":null},timeout:1E4,handleAs:"json"}).then(function(d){if(!d||d.error)throw a;}).otherwise(function(){throw a;})}};p.throwIfError=function(d){if(d)throw d;}})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../layers/FeatureLayer ./GraphicLayerView3DBase ../../../layers/graphics/controllers/SnapshotController ../../../core/watchUtils ../../../core/Error ../../../core/promiseUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c){return function(p){function t(a){var c=p.call(this)||this;return c.labelingEnabled=a.layer instanceof d,c}return w(t,p),q=t,t.prototype.initialize=function(){this.addResolvingPromise(this.validateMaximumFeatureCount())},t.prototype.createController=function(){var d=this;return this.layer.createGraphicsController({layerView:this,options:{maxPageSize:300,extent:this.view.clippingArea}}).then(function(c){return c instanceof r&&d._eventHandles.push(a.whenFalseOnce(d,"suspended",
function(){c.startup()})),c}).otherwise(function(a){return c.reject(new k("featurelayerview3d:create-controller",a.message,{error:a}))})},t.prototype.validateMaximumFeatureCount=function(){return 0>q.maximumFeatureCount||!this.layer.url?c.resolve():this.layer.queryFeatureCount().then(function(a){if(a>q.maximumFeatureCount)throw new k("featurelayerview3d:maximum-feature-count-exceeded","The maximum number of allowed features (${maximumFeatureCount}) has been exceeded (layer has ${numberOfFeatures} features)",
{maximumFeatureCount:q.maximumFeatureCount,numberOfFeatures:a});})},t.maximumFeatureCount=-1,l([h.property()],t.prototype,"controller",void 0),t=q=l([h.subclass("esri.views.3d.layers.FeatureLayerView3D")],t);var q}(h.declared(u))})},"esri/views/3d/layers/GraphicLayerView3DBase":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators dojo/promise/all ./graphics/Graphics3DLayerViewCore ./graphics/graphicUtils ./support/LayerViewUpdatingPercentage ../../../renderers/support/renderingInfoUtils ../support/PromiseLightweight ../../../core/watchUtils ./LayerView3D ./support/projectExtentUtils ../../../core/Error ../../../core/promiseUtils ../../../layers/graphics/QueryEngine".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B){return function(a){function b(b){b=a.call(this)||this;return b.supportsHeightUnitConversion=!0,b.controller=null,b.supportsDraping=!0,b._overlayUpdating=null,b._progressMaxNumNodes=0,b._eventHandles=[],b._controllerClientSideFiltering=!1,b._suspendResumeExtent=null,b.fullExtentInViewSpatialReference=null,b._isUpdating=!1,b._controllerCreated=!1,b}return w(b,a),Object.defineProperty(b.prototype,"drawingOrder",{set:function(a){this._layerViewCore.graphicsCore.setDrawingOrder(a);
this._set("drawingOrder",a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"hasDraped",{get:function(){return this._layerViewCore.graphicsCore.hasDraped},enumerable:!0,configurable:!0}),b.prototype.initialize=function(){var a=this;this._layerViewCore=new u({owner:this,layer:this.layer,spatialIndexRequired:!0,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,labelingEnabled:this.labelingEnabled,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,verticalScaleEnabled:this.supportsHeightUnitConversion,
highlightsEnabled:!0,updateSuspendResumeExtent:function(){return a.updateSuspendResumeExtent()},updateClippingExtent:function(b){return a.updateClippingExtent(b)}});this.addResolvingPromise(this._layerViewCore.initialize());this.drawingOrder=this.view.getDrawingOrder(this.layer.uid);this.initializeController();this.addResolvingPromise(this.validateGeometryType());var b=q.toView(this).then(function(b){a.fullExtentInViewSpatialReference=b});b&&this.addResolvingPromise(b);this._evaluateUpdatingState()},
b.prototype.destroy=function(){this._eventHandles.forEach(function(a){return a.remove()});this._eventHandles=null;this.controller&&(this.controller.destroy(),this.controller=null);this._layerViewCore&&(this._layerViewCore.destroy(),this._layerViewCore=null);this.loadedGraphics=null},b.prototype.getRenderingInfo=function(a){if((a=k.getRenderingInfo(a,{renderer:this.layer.renderer}))&&a.color){var b=a.color;b[0]/=255;b[1]/=255;b[2]/=255}return a},b.prototype.getGraphicsFromStageObject=function(a,b){var d=
a.getMetadata().graphicId,h=null;this.loadedGraphics&&this.loadedGraphics.some(function(a){return a.uid===d?(h=a,!0):!1});a=new c.Promise;return null!==h?a.done(h):a.reject(),a},b.prototype.getGraphics3DGraphics=function(){return this._layerViewCore.graphicsCore.getGraphics3DGraphics()},b.prototype.getGraphics3DGraphicsKeys=function(){return this._layerViewCore.graphicsCore.getGraphics3DGraphicsKeys()},b.prototype.getSymbolUpdateType=function(){return this._layerViewCore.graphicsCore.getSymbolUpdateType()},
b.prototype.queryGraphics=function(){return this._queryEngine?this._queryEngine.queryFeatures():this._rejectQuery()},b.prototype.queryFeatures=function(a){return this._queryEngine?this._queryEngine.queryFeatures(a):this._rejectQuery()},b.prototype.queryObjectIds=function(a){return this._queryEngine?this._queryEngine.queryObjectIds(a):this._rejectQuery()},b.prototype.queryFeatureCount=function(a){return this._queryEngine?this._queryEngine.queryFeatureCount(a):this._rejectQuery()},b.prototype.queryExtent=
function(a){return this._queryEngine?this._queryEngine.queryExtent(a):this._rejectQuery()},b.prototype.whenGraphicBounds=function(a){return this._layerViewCore.graphicsCore.whenGraphicBounds(a)},b.prototype.highlight=function(a,b){return this._layerViewCore.highlight(a,b,this.layer.objectIdField)},b.prototype._rejectQuery=function(){return y.reject(new v("FeatureLayerView3D","Not ready to execute query"))},b.prototype._notifySuspendedChange=function(){this.notifyChange("suspended")},b.prototype._notifyDrapedDataChange=
function(){this.notifyChange("hasDraped");this.emit("draped-data-change")},b.prototype.canResume=function(){return this.inherited(arguments)&&this._layerViewCore&&this._layerViewCore.canResume()},b.prototype._evaluateUpdatingState=function(){if(this._layerViewCore.elevationAlignment){var a;a=0+this._layerViewCore.elevationAlignment.numNodesUpdating();a+=this._layerViewCore.graphicsCore.numNodesUpdating();var b;b=(b=(b=(b=(b=!this._controllerCreated)||this.controller&&this.controller.updating)||this._overlayUpdating)||
this._layerViewCore.graphicsCore.needsIdleUpdate())||!(this.view.basemapTerrain&&this.view.basemapTerrain.ready);var c;c=(c=(c=0<a||b)||this._layerViewCore.spatialIndex.isUpdating())||this._layerViewCore.elevationAlignment.isUpdating();this._progressMaxNumNodes=Math.max(a,this._progressMaxNumNodes);0===a&&(this._progressMaxNumNodes=1);this._isUpdating=c;this.notifyChange("updating");this._set("updatingPercentageValue",b?100:100*a/this._progressMaxNumNodes)}else this._isUpdating=!1,this.notifyChange("updating"),
this._set("updatingPercentageValue",100)},b.prototype.isUpdating=function(){return this._isUpdating},b.prototype.initializeController=function(){var a=this,b=null,c=this.createController().then(function(a){b=a}),h=t.whenTrueOnce(this.view,"basemapTerrain.ready");d([this.when(),h]).then(function(){a.controller=b;a._eventHandles.push(a.controller.watch("updating",function(){return a._evaluateUpdatingState()}));a.loadedGraphics=b.graphics;a._queryEngine=new B({features:a.loadedGraphics,objectIdField:a.layer.objectIdField});
a._evaluateUpdatingState()}).always(function(){a._controllerCreated=!0;a._evaluateUpdatingState()});this.addResolvingPromise(c)},b.prototype.updateClippingExtent=function(a){return this.controller?this._controllerClientSideFiltering?!1:this.controller.extent?(this.controller.extent=null,this._controllerClientSideFiltering=!0,!0):(this.controller.extent=a,!0):!1},b.prototype.updateSuspendResumeExtent=function(){return this._suspendResumeExtent=r.enlargeExtent(this._layerViewCore.graphicsCore.computedExtent,
this._suspendResumeExtent,1.2),this._suspendResumeExtent},b.prototype.validateGeometryType=function(){var a=this.layer;switch(a.geometryType){case "multipatch":case "multipoint":return y.reject(new v("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:a.geometryType}))}},b.prototype.getStats=function(){var a=this._layerViewCore.graphicsCore.getGraphics3DGraphics(),b="null",c=this._suspendResumeExtent;c&&(b=[c[0],c[1],c[2],c[3]].map(function(a){return a.toPrecision(4)}).join(", "));
var c="null",d=this._layerViewCore.graphicsCore.computedExtent;return d&&(c=[d.xmin,d.ymin,d.xmax,d.ymax].map(function(a){return a.toPrecision(4)}).join(", ")),{numCollection:this.loadedGraphics.length,numGraphics:Object.keys(a).length,numElevationUpdating:this._layerViewCore.elevationAlignment.numNodesUpdating(),numSpatialIndexUpdating:this._layerViewCore.spatialIndex.numNodesUpdating(),numGraphicsUpdating:this._layerViewCore.graphicsCore.numNodesUpdating(),visibilityFrustum:this._layerViewCore.frustumVisibility.canResume(),
visibilityScale:this._layerViewCore.scaleVisibility.canResume(),resumeExtent:b,computedExtent:c,updating:this.updating,suspended:this.suspended}},b.maximumFeatureCount=-1,l([h.property()],b.prototype,"drawingOrder",null),l([h.property()],b.prototype,"loadedGraphics",void 0),l([h.property()],b.prototype,"symbolsUpdating",void 0),l([h.property()],b.prototype,"hasDraped",null),l([h.property()],b.prototype,"controller",void 0),b=l([h.subclass("esri.views.3d.layers.GraphicsLayerView3DBase")],b)}(h.declared(C,
a))})},"esri/views/3d/layers/graphics/Graphics3DLayerViewCore":function(){define("require exports ../../../../core/HandleRegistry ../../../../core/watchUtils ../../../../core/promiseUtils ../../../../core/Collection ../../../../tasks/support/Query ../../../../Graphic ./Graphics3DCore ./Graphics3DLabeling ./Graphics3DScaleVisibility ./Graphics3DFrustumVisibility ./Graphics3DElevationAlignment ./Graphics3DSpatialIndex ./Graphics3DVerticalScale ./Graphics3DHighlights ../support/attributeUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B){return function(){function p(b){var d=this;if(this._handles=new w,this.layer=b.layer,this.owner=b.owner,this.updateClippingExtent=b.updateClippingExtent,this.updateSuspendResumeExtent=b.updateSuspendResumeExtent,this.getGraphicsInExtent=b.getGraphicsInExtent,this.graphicsCore=new a(b.elevationFeatureExpressionEnabled),b.spatialIndexRequired&&(this.spatialIndex=new q),b.frustumVisibilityEnabled){this.frustumVisibility=new t;var h=this.owner.view.basemapTerrain;
this._handles.add([this.owner.view.on("resize",function(){return d.frustumVisibility.viewChange()}),this.owner.view.state.watch("camera",function(){return d.frustumVisibility.viewChange()},!0),h.on("elevation-bounds-change",function(){return d.frustumVisibility.elevationBoundsChange()})]);"local"===this.owner.view.viewingMode?this.frustumVisibility.isVisibleBelowSurface=!0:this._handles.add(l.init(h,["opacity","wireframe"],function(){return d.frustumVisibility.isVisibleBelowSurface=h.isSeeThrough()}))}b.scaleVisibilityEnabled&&
(b.spatialIndexRequired?(this.scaleVisibility=new c,this._handles.add(this.layer.watch("minScale,maxScale",function(){return d.scaleVisibility.layerMinMaxScaleChangeHandler()}))):console.warn("scaleVisibility requires a spatialIndex"));b.elevationAlignmentEnabled&&(this.elevationAlignment=new C,this._handles.add(this.layer.watch("elevationInfo",function(){return d.graphicsCore.elevationInfoChange()})));b.labelingEnabled&&(this.labeling=new k,this._handles.add(this.layer.watch("labelsVisible",function(){return d.labeling.labelVisibilityChanged()})),
this._handles.add(this.layer.watch("labelingInfo",function(){return d.labeling.updateLabelingInfo()})));b.verticalScaleEnabled&&(this.verticalScale=new v({sourceSpatialReference:this.layer.spatialReference,destSpatialReference:this.owner.view.spatialReference}));b.highlightsEnabled&&(this.highlights=new y)}return p.prototype.initialize=function(){var a=this;return this.whenSpatialIndexLoaded().then(function(){return a.deferredInitialize()})},p.prototype.whenSpatialIndexLoaded=function(){return this.spatialIndex?
this.spatialIndex.whenLoaded():h.resolve()},p.prototype.deferredInitialize=function(){var a=this;this.spatialIndex&&this.spatialIndex.initialize(this.owner,this.layer,this.owner.view.spatialReference,this.graphicsCore);this.frustumVisibility&&this.frustumVisibility.initialize(this.owner);var c=this.owner.view.basemapTerrain,d=this.owner.view.elevationProvider;(this.scaleVisibility&&this.scaleVisibility.initialize(this.owner,this.layer,this.spatialIndex,this.graphicsCore,c),this.elevationAlignment&&
this.elevationAlignment.initialize(this.owner,function(b,c,d){return a._getGraphicsInExtent(b,c,d)},this.graphicsCore,d),this.labeling)&&this.labeling.initialize(this.owner,this.layer,this.spatialIndex,this.graphicsCore,this.scaleVisibility);return this.highlights&&this.highlights.initialize(this.graphicsCore),this.graphicsCore.initialize(this.owner,this.layer,this.elevationAlignment,this.scaleVisibility,this.spatialIndex,this.labeling,this.highlights,function(){a.updateSuspendResumeExtent&&a._updateSuspendResumeExtent(a.updateSuspendResumeExtent())},
function(b){return a.verticalScale?a.verticalScale.adjust(b):b},c),this._handles.add([this.layer.watch("renderer",function(b){return a.graphicsCore.rendererChange(b)}),this.owner.watch("fullOpacity",function(){return a.graphicsCore.opacityChange()})]),this._handles.add(this.layer.on("graphic-update",function(b){return a.graphicsCore.graphicUpdateHandler(b)})),this.owner.view.resourceController.registerIdleFrameWorker(this,{needsUpdate:this._needsIdleUpdate,idleFrame:this._idleUpdate}),this.updateClippingExtent&&
(this._handles.add(this.owner.view.watch("clippingArea",function(){return a._updateClippingExtent()})),this._updateClippingExtent()),this.labeling?this.labeling.updateLabelingInfo():void 0},p.prototype.destroy=function(){this.owner&&this.owner.view.resourceController.deregisterIdleFrameWorker(this);this._handles&&(this._handles.destroy(),this._handles=null);this.frustumVisibility&&(this.frustumVisibility.destroy(),this.frustumVisibility=null);this.scaleVisibility&&(this.scaleVisibility.destroy(),
this.scaleVisibility=null);this.elevationAlignment&&(this.elevationAlignment.destroy(),this.elevationAlignment=null);this.labeling&&(this.labeling.destroy(),this.labeling=null);this.graphicsCore&&(this.graphicsCore.destroy(),this.graphicsCore=null);this.spatialIndex&&(this.spatialIndex.destroy(),this.spatialIndex=null);this.highlights&&(this.highlights.destroy(),this.highlights=null);this.owner=this.layer=null},p.prototype.highlight=function(a,c,h){var b=this;if(a instanceof u){c=this.highlights.acquireSet(c,
h);var k=c.set,l=c.handle;return this.owner.queryObjectIds(a).then(function(a){return b.highlights.setObjectIds(k,a)}),l}if("number"==typeof a||a instanceof r)return this.highlight([a],c,h);if(a instanceof d&&(a=a.toArray()),Array.isArray(a)&&0<a.length){if(a[0]instanceof r){l=a;if(!h||!l[0].attributes||null===B.attributeLookup(l[0].attributes,h))return a=l.map(function(a){return a.uid}),l=this.highlights.acquireSet(c,null),c=l.set,l=l.handle,this.highlights.setUids(c,a),l;a=l.map(function(a){return B.attributeLookup(a.attributes,
h)})}if("number"==typeof a[0])return l=this.highlights.acquireSet(c,h),c=l.set,l=l.handle,this.highlights.setObjectIds(c,a),l}return{remove:function(){}}},p.prototype.canResume=function(){return(!this.frustumVisibility||this.frustumVisibility.canResume())&&(!this.scaleVisibility||this.scaleVisibility.canResume())},p.prototype._needsIdleUpdate=function(){return this.frustumVisibility&&this.frustumVisibility.needsIdleUpdate()?!0:this.scaleVisibility&&this.scaleVisibility.needsIdleUpdate()?!0:this.elevationAlignment&&
this.elevationAlignment.needsIdleUpdate()?!0:this.graphicsCore&&this.graphicsCore.needsIdleUpdate()?!0:!1},p.prototype._idleUpdate=function(a){this.frustumVisibility&&this.frustumVisibility.idleUpdate(a);this.scaleVisibility&&this.scaleVisibility.idleUpdate(a);this.elevationAlignment&&this.elevationAlignment.idleUpdate(a);this.graphicsCore&&this.graphicsCore.idleUpdate(a)},p.prototype._updateSuspendResumeExtent=function(a){this.frustumVisibility&&this.frustumVisibility.setExtent(a);this.scaleVisibility&&
this.scaleVisibility.setExtent(a)},p.prototype._updateClippingExtent=function(){var a=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(a,this.owner.view.spatialReference)&&(this.updateClippingExtent(a)||this.graphicsCore.recreateAllGraphics())},p.prototype._getGraphicsInExtent=function(a,c,d){this.getGraphicsInExtent?this.getGraphicsInExtent(a,c,d):this.spatialIndex?this.spatialIndex.intersects(a,c,d):d([],0)},p}()})},"esri/views/3d/layers/graphics/Graphics3DLabeling":function(){define("require exports dojo/promise/all ../../../../core/HandleRegistry ../../../../core/watchUtils ../../../../layers/support/LabelClass ../../../../symbols/callouts/calloutUtils ../../webgl-engine/lib/TextTextureAtlas ../../webgl-engine/lib/MaterialCollection ./Graphics3DWebStyleSymbol ./Graphics3DCalloutSymbolLayerFactory ./labelPlacement ../../support/debugFlags".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C){return function(){function p(){this.calloutMaterialCollection=this.hudMaterialCollection=this.textTextureAtlas=null;this.labelVisibilityDirty=!1;this.labelClasses=[];this.eventHandles=new l;this.graphicsCore=this.spatialIndex=this.layer=this.layerView=null}return p.prototype.initialize=function(a,c,d,k,b){var l=this;this.layerView=a;this.layer=c;this.spatialIndex=d;this.graphicsCore=k;this.scaleVisibility=b;this.eventHandles.add(h.whenNot(this.layerView,"suspended",
function(){return l.resume()}))},p.prototype.destroy=function(){this.textTextureAtlas&&(this.textTextureAtlas.dispose(),this.textTextureAtlas=null);this.hudMaterialCollection&&(this.hudMaterialCollection.dispose(),this.hudMaterialCollection=null);this.calloutMaterialCollection&&(this.calloutMaterialCollection.dispose(),this.calloutMaterialCollection=null);this.labelClasses=null;this.eventHandles.destroy();this.graphicsCore=this.layer=this.layerView=this.eventHandles=null},p.prototype.clear=function(){this.layerView.view.deconflictor.setDirty();
this.textTextureAtlas&&(this.textTextureAtlas.dispose(),this.textTextureAtlas=null);this.hudMaterialCollection&&(this.hudMaterialCollection.dispose(),this.hudMaterialCollection=null);this.calloutMaterialCollection&&(this.calloutMaterialCollection.dispose(),this.calloutMaterialCollection=null)},p.prototype.updateLabelingInfo=function(){var a=this;return this.removeLabels(),this.layer.when(function(){a.scaleVisibility&&a.scaleVisibility.updateScaleRangeActive();var d=a.layer.labelingInfo&&a.layer.labelingInfo.filter(function(a){return!!a.symbol});
if(d&&0<d.length){var h=Array(d.length),d=d.map(function(d,b){var l=d.symbol,p;p=a.graphicsCore.getOrCreateGraphics3DSymbol(l);p=p instanceof k?p.graphics3DSymbol:p;var r=null;return u.isCalloutSupport(l)&&l.hasVisibleCallout()&&(r=c.make(l,a.graphicsCore.symbolCreationContext)),h[b]={labelClass:d,graphics3DSymbol:p,graphics3DCalloutSymbolLayer:r,options:d.getOptions()},p});return w(d).then(function(){return h})}return null}).then(function(c){a.labelClasses=c;a.labelVisibilityChanged()})},p.prototype.createLabelsForGraphic=
function(c,h){var k=!1;if(this.labelClasses&&0!==this.labelClasses.length&&h._graphics[0]){for(var l=this.layerLabelsEnabled(),b=0;b<this.labelClasses.length;b++){var m=this.labelClasses[b],p=m.labelClass;if(d.evaluateWhere(p.where,c.attributes)&&(p=p.getLabelExpression(),p.expression)){var q=d.buildLabelText(p.expression,c,this.layer.fields,m.options);if(q){p=null;m.graphics3DSymbol&&m.graphics3DSymbol.symbol&&"label-3d"===m.graphics3DSymbol.symbol.type&&(p=m.graphics3DSymbol.symbol);var u=m.graphics3DSymbol.childGraphics3DSymbols[0],
v=t.get({graphic:c,graphics3DGraphic:h,labelSymbol:p,labelClass:m.labelClass});if(u&&v.isValid){null==this.textTextureAtlas&&(this.textTextureAtlas=new r(this.layer.id,this.layerView.view._stage));null==this.hudMaterialCollection&&(this.hudMaterialCollection=new a(this.layerView.view._stage));b={text:q,centerOffset:v.centerOffset,translation:v.translation,elevationOffset:v.elevationOffset,screenOffset:v.screenOffset,anchor:v.anchor,needsOffsetAdjustment:v.needsOffsetAdjustment,centerOffsetUnits:v.centerOffsetUnits,
verticalOffset:v.verticalOffset,debugDrawBorder:C.LABELS_SHOW_BORDER};(u=u.createGraphics3DGraphic(c,b,this.hudMaterialCollection,this.textTextureAtlas))&&(u._labelClass=m.labelClass,h.addLabelGraphic(u,this.graphicsCore.labelStageLayer,this.graphicsCore.stage),this.spatialIndex&&!h.addedToSpatialIndex&&this.spatialIndex.shouldAddToSpatialIndex(c,h,this.scaleVisibility.scaleRangeActive())&&this.spatialIndex.addGraphicToSpatialIndex(c,h),h.setVisibilityFlag(0,l,1),h.setVisibilityFlag(1,void 0,1),this.layerView.view.deconflictor.initializeLabelVisibility(h),
k=!0,m.graphics3DCalloutSymbolLayer&&v.hasLabelVerticalOffset)&&(null==this.calloutMaterialCollection&&(this.calloutMaterialCollection=new a(this.layerView.view._stage)),(l=m.graphics3DCalloutSymbolLayer.createGraphics3DGraphic(c,{symbol:p,needsOffsetAdjustment:v.needsOffsetAdjustment,translation:b.translation,elevationOffset:b.elevationOffset,screenOffset:b.screenOffset,centerOffset:b.centerOffset,centerOffsetUnits:b.centerOffsetUnits,materialCollection:this.calloutMaterialCollection}))&&h.addLabelGraphic(l,
this.graphicsCore.labelStageLayer,this.graphicsCore.stage));break}}}}k&&this.scaleVisibility&&this.scaleVisibility.updateGraphicLabelScaleVisibility(c,h)}},p.prototype.layerLabelsEnabled=function(){return this.layer.labelsVisible},p.prototype.getGraphics3DGraphics=function(){return this.graphicsCore.getGraphics3DGraphics()},p.prototype.getGraphics3DGraphicsKeys=function(){return this.graphicsCore.getGraphics3DGraphicsKeys()},p.prototype.labelVisibilityChanged=function(){var a=this;if(this.layerView.suspended)return void(this.labelVisibilityDirty=
!0);if(this.layerView.loadedGraphics){var c=this.layerLabelsEnabled();this.layerView.loadedGraphics.forEach(function(d){var h=a.graphicsCore.getGraphics3DGraphicById(d.uid);h&&(c&&0===h._labelGraphics.length&&a.createLabelsForGraphic(d,h),h.setVisibilityFlag(0,c,1))});this.layerView.view.deconflictor.setDirty();this.labelVisibilityDirty=!1}},p.prototype.elevationInfoChange=function(){this.labelClasses&&this.labelClasses.forEach(function(a){a.graphics3DSymbol.layerPropertyChanged("elevationInfo",{})})},
p.prototype.resume=function(){this.labelVisibilityDirty&&this.labelVisibilityChanged()},p.prototype.removeLabels=function(){var a=this;this.layerView.loadedGraphics&&(this.layerView.loadedGraphics.forEach(function(c){(c=a.graphicsCore.getGraphics3DGraphicById(c.uid))&&(c._labelGraphics&&c._labelGraphics.forEach(function(a){return a._labelClass=null}),c.clearLabelGraphics())}),this.labelClasses=null,this.layerView.view.deconflictor.setDirty())},p}()})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("require exports ./Texture ./TextTexture ./ModelContentType ../../../webgl/Texture ../../../webgl/enums".split(" "),
function(A,p,w,l,h,d,u){var r=l.preferredAtlasSize(),a=function(){function a(a){this.textTextures={};this.dirty=!1;this._glTexture=null;this.id=w.idGen.gen(a)}return a.prototype.getId=function(){return this.id},a.prototype.dispose=function(){},a.prototype.deferredLoading=function(){return!1},a.prototype.getWidth=function(){return r},a.prototype.getHeight=function(){return r},a.prototype.initializeThroughRender=function(a,h){h.wrapMode=33071;h.samplingMode=9987;h.flipped=!0;h.preMultiplyAlpha=!0;h.hasMipmap=
!0;var c=this._drawToCanvas();return this._glTexture=new d(a,h,c),this.dirty=!1,this._glTexture},a.prototype.redraw=function(){if(this.dirty&&this._glTexture){var a=this._drawToCanvas();this._glTexture.setData(a);this.dirty=!1}},a.prototype.setUnloadFunc=function(a){this._unloadFunc=a},a.prototype.unload=function(){null!=this._unloadFunc&&(this._unloadFunc(this.id),this._unloadFunc=null)},a.prototype._drawToCanvas=function(){var c=a._create2Dcanvas(),d=c.getContext("2d");d.clearRect(0,0,r,r);for(var h in this.textTextures){var k=
this.textTextures[h];k.textTexture.renderText(k.placement.width,k.placement.height,d,k.placement.atlasOffX,k.placement.atlasOffY)}return c},a._create2Dcanvas=function(){return a._textCanvas2D||(a._textCanvas2D=document.createElement("canvas"),a._textCanvas2D.setAttribute("id","canvas2d"),a._textCanvas2D.setAttribute("width",r.toString()),a._textCanvas2D.setAttribute("height",r.toString()),a._textCanvas2D.setAttribute("style","display:none")),a._textCanvas2D},a}();return function(){function d(a,d){this._textureAtlasSubtextures=
[];this._curLineHeight=this._curY=this._curX=0;this._idHint=a;this._stage=d}return d.prototype.dispose=function(){for(var a=0;a<this._textureAtlasSubtextures.length;a++)this._stage.remove(h.TEXTURE,this._textureAtlasSubtextures[a].getId());this._textureAtlasSubtextures=[]},d.prototype.canHoldTextTexture=function(a){return a.getRenderedWidth()<=r&&a.getRenderedHeight()<=r},d.prototype.addTextTexture=function(c){for(var d=JSON.stringify(c.getParams())+"_"+c.getText(),k=0;k<this._textureAtlasSubtextures.length;k++){var l=
this._textureAtlasSubtextures[k].textTextures[d];if(null!=l)return l.placement}var p=null;0===this._textureAtlasSubtextures.length&&(p=new a(this._idHint),this._textureAtlasSubtextures.push(p));var u,w,k=c.getRenderedWidth(),l=c.getRenderedHeight(),A=k+2,b=l+2+2;this._curLineHeight=Math.max(this._curLineHeight,b);this._curX+A<r&&this._curY+this._curLineHeight<r?(u=this._curX,w=this._curY,this._curX+=A):this._curY+this._curLineHeight+b<r?(this._curX=0,this._curY+=this._curLineHeight,u=this._curX,w=
this._curY,this._curX+=A):(p=new a(this._idHint),this._textureAtlasSubtextures.push(p),this._curX=0,this._curY=0,this._curLineHeight=b,u=this._curX,w=this._curY,this._curX+=A);null!=p&&this._stage.add(h.TEXTURE,p);p=this._textureAtlasSubtextures[this._textureAtlasSubtextures.length-1];u={uvMinMax:[u/r,1-(w+l)/r,(u+k)/r,1-w/r],atlasOffX:u,atlasOffY:w,width:k,height:l,texture:p};return p.textTextures[d]={placement:u,textTexture:c},p.dirty=!0,u},d}()})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["require",
"exports","./ModelContentType"],function(A,p,w){return function(){function l(h){this.materials={};this.stage=h}return l.prototype.getMaterial=function(h){return this.materials[h]},l.prototype.addMaterial=function(h,d){this.materials[h]=d;this.stage.add(w.MATERIAL,d)},l.prototype.dispose=function(){for(var h in this.materials)this.stage.remove(w.MATERIAL,this.materials[h].getId());this.materials={}},l}()})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("require exports ../../../../core/Logger ../../../../core/Scheduler ../../lib/glMatrix ../../webgl-engine/materials/HUDMaterial ./Graphics3DWebStyleSymbol".split(" "),
function(A,p,w,l,h,d,u){function r(b,c){switch(c.graphic.geometry.type){case "polyline":case "polygon":case "extent":b.anchor="center";break;case "point":var k=c.graphics3DGraphic,l=a(k.graphics3DSymbol).symbol.symbolLayers.getItemAt(0),k=k.getCenterObjectSpace();switch(h.vec3d.set(k,b.translation),l.type){case "icon":case "text":k=c.graphics3DGraphic;l=k._graphics[0].getScreenSize();k.isDraped()?b.hasLabelVerticalOffset||(b.anchor="center"):(k=void 0,void 0===k&&(k=D),c=c.graphics3DGraphic._graphics[0].stageObject.getGeometryRecords()[0].materials[0],
c instanceof d?(c=c.getParams().anchorPos,k[0]=2*(c[0]-.5),k[1]=2*(c[1]-.5)):(k[0]=0,k[1]=0),c=k,B[0]=l[0]/2*(b.normalizedOffset[0]-c[0]),B[1]=l[1]/2*(b.normalizedOffset[1]-c[1]),b.screenOffset[0]=B[0],b.hasLabelVerticalOffset?(b.centerOffset[1]=B[1],b.centerOffsetUnits="screen"):b.screenOffset[1]=B[1]);break;case "object":c=c.graphics3DGraphic._graphics[0].getBoundingBoxObjectSpace(),c=[c[3]-c[0],c[4]-c[1],c[5]-c[2]],b.centerOffset[0]=1.1*Math.max(c[0],c[1])/2*b.normalizedOffset[0],l=c[2]/2*b.normalizedOffset[1]+
b.translation[2],b.translation[2]=l*(1.1-1),b.elevationOffset=l,c=h.vec3d.length(c),b.centerOffset[2]=1.1*c/2*b.normalizedOffset[2]}}}function a(a){return a instanceof u?a.graphics3DSymbol:a}function k(b,d){var h=d.labelSymbol;d=d.graphics3DGraphic;var k=a(d.graphics3DSymbol).symbol;if("point-3d"===k.type&&k.supportsCallout()&&k.hasVisibleVerticalOffset()&&!d.isDraped())b.verticalOffset=c(k.verticalOffset);else if(h&&h.hasVisibleVerticalOffset()&&("point-3d"!==k.type||!k.supportsCallout()||!k.verticalOffset||
d.isDraped())){a:switch(b.placement){case "above-center":d=!0;break a;default:d=!1}d?(b.verticalOffset=c(h.verticalOffset),b.anchor="bottom",b.normalizedOffset=[0,b.normalizedOffset[1],0],b.hasLabelVerticalOffset=!0):(t.error("verticalOffset","Callouts and vertical offset on labels are currently only supported with above-center label placement (not with "+b.placement+" placement)"),b.isValid=!1)}}function c(a){return{screenLength:a.screenLength,minWorldLength:a.minWorldLength,maxWorldLength:a.maxWorldLength}}
Object.defineProperty(p,"__esModule",{value:!0});var t=w.getLogger("esri.views.3d.layers.graphics.labelPlacement"),C=null;p.get=function(a){var b=a.labelClass.labelPlacement,c=q[b];c||(null!=b&&null==C&&(t.warn("labelPlacement","'"+b+"' is not a valid label placement"),C=l.schedule(function(){C.remove();C=null})),c=q["default"]);var b=a.graphics3DGraphic._graphics[0],d=b.graphics3DSymbolLayer.getGraphicElevationContext(a.graphics3DGraphic.graphic),c={placement:c.placement,anchor:c.anchor,normalizedOffset:c.normalizedOffset,
needsOffsetAdjustment:b.isDraped()?void 0:d.hasOffsetAdjustment,verticalOffset:null,screenOffset:[0,0],centerOffset:[0,0,0,-1],centerOffsetUnits:"world",translation:[0,0,0],elevationOffset:0,hasLabelVerticalOffset:!1,isValid:!0};return k(c,a),r(c,a),c};var q={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},
"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},v={"above-center":["default",
"esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};
A=function(a){var b=q[a];v[a].forEach(function(a){q[a]=b})};for(var y in v)A(y);Object.freeze&&(Object.freeze(q),Object.keys(q).forEach(function(a){Object.freeze(q[a]);Object.freeze(q[a].normalizedOffset)}));var B=[0,0],D=[0,0]})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define(["require","exports"],function(A,p){function w(l,h){return null!==l&&0<l&&8E7>l||50<h}return function(){function l(){this._scaleRangeActive=!1;this.layerScaleRangeVisibilityDirty=this.layerScaleRangeVisibility=
!0;this.layerScaleRangeVisibilityQuery=!1;this.basemapTerrain=this.graphicsCore=this.extent=this.spatialIndex=this.layer=this.layerView=this.scaleChangeEventHandle=null}return l.prototype.initialize=function(h,d,l,p,a){this.layerView=h;this.layer=d;this.spatialIndex=l;this.graphicsCore=p;this.basemapTerrain=a;this.updateScaleRangeActive()},l.prototype.destroy=function(){this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null);this.graphicsCore=this.spatialIndex=
this.extent=this.layerView=null},l.prototype.needsIdleUpdate=function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},l.prototype.canResume=function(){return this.layerScaleRangeVisibility},l.prototype.setExtent=function(h){this.extent=h;this.layerScaleRangeVisibilityDirty=!0},l.prototype.idleUpdate=function(h){this.layerView.view.basemapTerrain&&(h.done()||this.layerScaleRangeVisibilityDirty&&(this.updateSuspendScaleVisible(),this.layerScaleRangeVisibilityDirty=
!1))},l.prototype.scaleRangeActive=function(){return this._scaleRangeActive},l.prototype.updateScaleRangeActive=function(){var h=this;if(!this.spatialIndex)return this._scaleRangeActive=!1,!1;var d=this.layer,l=!1;d.labelingInfo&&(l=l||d.labelingInfo.some(function(d){return d&&w(d.minScale,d.maxScale)}));l=l||w(d.minScale,d.maxScale);d=this._scaleRangeActive!==l;return this._scaleRangeActive=l,l&&!this.scaleChangeEventHandle&&this.basemapTerrain?this.scaleChangeEventHandle=this.basemapTerrain.on("scale-change",
function(d){return h.scaleUpdateHandler(d)}):!l&&this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null),d},l.prototype.updateSuspendScaleVisibleFinish=function(h){this.layerScaleRangeVisibilityQuery=!1;this.layerScaleRangeVisibility!==h&&(this.layerScaleRangeVisibility=h,this.layerView._notifySuspendedChange())},l.prototype.updateSuspendScaleVisible=function(){var h=this,d=this.layerView.view.basemapTerrain;this.extent&&d&&this._scaleRangeActive?this.layerScaleRangeVisibilityQuery||
(this.layerScaleRangeVisibilityQuery=!0,d.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,function(d){return h.updateSuspendScaleVisibleFinish(d)})):this.updateSuspendScaleVisibleFinish(!0)},l.prototype.visibleAtScale=function(h,d,l){return null==h?!0:h>l&&(!d||d>h)},l.prototype.visibleAtLayerScale=function(h){return this.visibleAtScale(h,this.layer.minScale,this.layer.maxScale)},l.prototype.visibleAtLabelScale=function(h,d){return this.visibleAtScale(h,d.minScale,d.maxScale)},
l.prototype.graphicScale=function(h,d){var l;return(d.centroid?l=d.centroid:"point"===h.geometry.type&&(l=h.geometry),l)?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(l):1:null},l.prototype.graphicVisible=function(h,d){h=this.graphicScale(h,d);return this.visibleAtLayerScale(h)},l.prototype.updateGraphicScaleVisibility=function(h,d){return this._scaleRangeActive?(d.addedToSpatialIndex||this.spatialIndex.addGraphicToSpatialIndex(h,d),h=this.graphicVisible(h,d),d.setVisibilityFlag(1,
h)):!1},l.prototype.updateGraphicLabelScaleVisibility=function(h,d){if(!this._scaleRangeActive||!d._labelGraphics||0===d._labelGraphics.length)return!1;d.addedToSpatialIndex||this.spatialIndex.addGraphicToSpatialIndex(h,d);h=this.graphicScale(h,d);d=this.updateLabelScaleVisibility(d,h);return d&&this.layerView.view.deconflictor.setDirty(),d},l.prototype.updateLabelScaleVisibility=function(h,d){if(!h._labelGraphics||0===h._labelGraphics.length)return!1;1<h._labelGraphics.length&&console.warn("Multiple label classes are not supported");
var l=h._labelGraphics[0]._labelClass;return l&&null!=l.minScale&&null!=l.maxScale&&(d=this.visibleAtLabelScale(d,l),h.setVisibilityFlag(1,d,1))?!0:!1},l.prototype.scaleUpdateHandler=function(h){var d=this;if(!this.layerView.suspended&&this.spatialIndex.hasGraphics()){var l=h.extent,p=h.scale;this.spatialIndex.intersects(l,h.spatialReference,function(a,h){for(var c=d.visibleAtLayerScale(p),k=!1,r=!1,q=0;h>q;q++){var u=d.graphicsCore.getGraphics3DGraphicById(a[q]);if(u){var w=u.centroid;w&&(l[0]>w.x||
l[1]>w.y||l[2]<w.x||l[3]<w.y)||(w=!1,u.setVisibilityFlag(1,c)&&(w=!0),d.updateLabelScaleVisibility(u,p)&&(w=!0),w&&(r=!0,u.isDraped()&&(k=!0)))}}r&&d.layerView.view.deconflictor.setDirty();k&&d.layerView._notifyDrapedDataChange()})}this.layerScaleRangeVisibilityDirty=!0},l.prototype.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&(this._scaleRangeActive?this.graphicsCore.updateAllGraphicsVisibility():this.graphicsCore.forEachGraphics3DGraphic(function(h){return h.setVisibilityFlag(1,
void 0)}));this.layerScaleRangeVisibilityDirty=!0},l}()})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("require exports ../../support/earthUtils ../../support/projectionUtils ../../support/intersectionUtils ../../support/mathUtils ../../support/aaBoundingBox ../../support/aaBoundingRect ../../lib/glMatrix".split(" "),function(A,p,w,l,h,d,u,r,a){var k=-.3*w.earthRadius;A=.5*Math.PI;var c=A/Math.PI*180,t=A*w.earthRadius,C=.9*w.earthRadius,q=function(){function k(){this.extent=
Array(4);this.planes=Array(4);this.maxSpan=0;this.center={origin:a.vec3d.create(),direction:a.vec3d.create()};for(var b=0;4>b;b++)this.extent[b]={origin:a.vec3d.create(),originLength:0,direction:a.vec3d.create(),cap:{next:null,direction:a.vec3d.create()}},this.planes[b]=a.vec4d.create();this.planes[4]=a.vec4d.create()}return k.prototype.toRenderBoundingExtent=function(c,h,k,m){r.center(c,y);y[2]=m;l.computeLinearTransformation(k,y,B,h);a.mat4d.inverse(B,D);u.set(b,u.NEGATIVE_INFINITY);for(var p=0,
q=v;p<q.length;p++)for(var t=q[p],w=t.x0,A=t.x1,C=t.y0,t=t.y1,E=0;5>E;E++){var G=E/4;y[0]=d.lerp(c[w],c[A],G);y[1]=d.lerp(c[C],c[t],G);y[2]=m;l.vectorToVector(y,k,y,h);a.mat4d.multiplyVec3(D,y);u.expand(b,y)}a.mat4d.multiplyVec3(B,a.vec3d.set3(b[0],b[1],b[2],this.extent[0].origin));a.mat4d.multiplyVec3(B,a.vec3d.set3(b[3],b[1],b[2],this.extent[1].origin));a.mat4d.multiplyVec3(B,a.vec3d.set3(b[3],b[4],b[2],this.extent[2].origin));a.mat4d.multiplyVec3(B,a.vec3d.set3(b[0],b[4],b[2],this.extent[3].origin))},
k.prototype.update=function(b,c,d,h,k,l){k=this.extent;this.toRenderBoundingExtent(b,d,h,l);a.vec3d.add(k[0].origin,k[2].origin,this.center.origin);a.vec3d.scale(this.center.origin,.5);c(this.center.origin,this.center.direction);for(d=0;4>d;d++)h=k[d],c(h.origin,h.direction),h.originLength=a.vec3d.length(h.origin),l=k[3===d?0:d+1],h.cap.next=l.origin,a.vec3d.direction(l.origin,h.origin,h.cap.direction),this._computePlane(h.cap.direction,h.direction,h.origin,this.planes[d]);this._computePlane(k[1].cap.direction,
k[0].cap.direction,k[0].origin,this.planes[4]);this.maxSpan=Math.max(Math.abs(b[0]-b[2]),Math.abs(b[1]-b[3]))},k.prototype.isVisibleInFrustumGlobal=function(b){if(0>a.vec3d.dot(this.center.direction,b.direction))return!0;for(var c=0;4>c;c++)if(0>a.vec3d.dot(this.extent[c].direction,b.direction))return!0;return!1},k.prototype.isVisibleInFrustum=function(a,b,d){if("global"===a.viewingMode){if(this.maxSpan>(a.spatialReference.isWGS84?c:t))return!0;if(b.altitude>=C)return this.isVisibleInFrustumGlobal(b)}for(a=
0;a<this.extent.length;a++)if(d=this.extent[a],h.frustumRay(b.planes,d.origin,null,d.direction)||h.frustumLineSegment(b.planes,d.origin,d.cap.next,d.cap.direction))return!0;for(a=0;a<b.lines.length;a++)if(d=b.lines[a],h.frustumLineSegment(this.planes,d.origin,d.endpoint,d.direction))return!0;return!1},k.prototype._computePlane=function(b,c,d,h){a.vec3d.cross(b,c,h);h[3]=-a.vec3d.dot(h,d)},k}();w=function(){function a(){this.frustumVisibilityDirty=this.frustumVisibility=!0;this.extent=null;this.extentEngine=
new q;this.extentEngineDirty=!0;this.renderSREqualsViewSR=null;this._isVisibleBelowSurface=!1;this.layerView=null}return a.prototype.initialize=function(a){this.layerView=a;this.renderSREqualsViewSR=a.view.renderSpatialReference.equals(a.view.spatialReference)},a.prototype.destroy=function(){this.extentEngine=this.extent=this.layerView=null},a.prototype.needsIdleUpdate=function(){return this.frustumVisibilityDirty},a.prototype.canResume=function(){return this.frustumVisibility},a.prototype.setExtent=
function(a){this.extent=a;this.frustumVisibilityDirty=this.extentEngineDirty=!0},a.prototype.viewChange=function(){this.frustumVisibilityDirty=!0},a.prototype.elevationBoundsChange=function(){this.extentEngineDirty=this.frustumVisibilityDirty=!0},Object.defineProperty(a.prototype,"isVisibleBelowSurface",{set:function(a){this._isVisibleBelowSurface=a;this.extentEngineDirty=this.frustumVisibilityDirty=!0},enumerable:!0,configurable:!0}),a.prototype.idleUpdate=function(a){a.done()||this.frustumVisibilityDirty&&
(this.updateSuspendFrustumVisible(),this.frustumVisibilityDirty=!1)},a.prototype.updateExtentEngine=function(){if(this.extentEngineDirty){this.extentEngineDirty=!1;var a,b=this.layerView.view,c=b.renderCoordsHelper.worldUpAtPosition.bind(b.renderCoordsHelper);if(this._isVisibleBelowSurface)a=k;else{a=b.basemapTerrain.getElevationBounds();var d=a[0];a=d-Math.max(1,(a[1]-d)*(1.2-1))}this.extentEngine.update(this.extent,c,b.renderSpatialReference,b.spatialReference,this.renderSREqualsViewSR,a)}},a.prototype.updateSuspendFrustumVisible=
function(){if(!this.extent)return void(this.frustumVisibility=!0);this.updateExtentEngine();var a=this.extentEngine.isVisibleInFrustum(this.layerView.view,this.layerView.view.frustum,this._isVisibleBelowSurface);a!==this.frustumVisibility&&(this.frustumVisibility=a,this.layerView._notifySuspendedChange())},a}();var v=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],y=a.vec3d.create(),B=a.mat4d.create(),D=a.mat4d.create(),b=u.create();return w})},"esri/views/3d/layers/graphics/Graphics3DVerticalScale":function(){define(["require",
"exports","../../../../geometry/support/scaleUtils"],function(A,p,w){return function(){function l(h){this.sourceSpatialReference=h.sourceSpatialReference;this.destSpatialReference=h.destSpatialReference}return l.prototype.adjust=function(h){var d=this._getVerticalUnitScale();return 1!==d?(h=h.slice(),this._scaleVerticalUnits(h,d),h):h},l.prototype._getVerticalUnitScale=function(){if(this.sourceSpatialReference&&!this.sourceSpatialReference.equals(this.destSpatialReference)){var h=w.getMetersPerVerticalUnitForSR(this.sourceSpatialReference),
d=w.getMetersPerVerticalUnitForSR(this.destSpatialReference);return h/d}return 1},l.prototype._vertexListsScaleZ=function(h,d){for(var l=0;l<h.length;++l)for(var p=h[l],a=0;a<p.length;++a)p[a][2]*=d},l.prototype._scaleVerticalUnits=function(h,d){for(var l=0;l<h.length;++l){var p=h[l].geometry;if(!p.hasZ)break;this._geometryIsPoint(p)?null!==p.z&&(p.z*=d):this._geometryIsPolyline(p)?this._vertexListsScaleZ(p.paths,d):this._geometryIsPolygon(p)&&this._vertexListsScaleZ(p.rings,d)}},l.prototype._geometryIsPoint=
function(h){return"point"===h.type},l.prototype._geometryIsPolygon=function(h){return"polygon"===h.type},l.prototype._geometryIsPolyline=function(h){return"polyline"===h.type},l}()})},"esri/views/3d/layers/graphics/Graphics3DHighlights":function(){define(["require","exports","./Graphics3DHighlightSet"],function(A,p,w){return function(){function l(){this.graphicsCore=null;this.highlights=[]}return l.prototype.destroy=function(){this.highlights.forEach(function(h){return h.highlightSet.removeAll()});
this.highlights=null},l.prototype.initialize=function(h){this.graphicsCore=h},l.prototype.acquireSet=function(h,d){var l=this,p=new w(h,d);this.highlights.push(p);return{set:p,handle:{remove:function(){return l.releaseSet(p)}}}},l.prototype.releaseSet=function(h){h.highlightSet.removeAll();h=this.highlights?this.highlights.indexOf(h):-1;-1!==h&&this.highlights.splice(h,1)},l.prototype.setUids=function(h,d){var l=this.graphicsCore.graphics;d.forEach(function(d){h.ids.add(d);(d=l[d])&&d.addHighlight(h.highlightSet,
h.options)})},l.prototype.setObjectIds=function(h,d){var l=this.graphicsCore.graphics;d.forEach(function(a){return h.ids.add(a)});for(var p in l)(d=l[p])&&h.hasGraphic(d)&&d.addHighlight(h.highlightSet,h.options)},l.prototype.graphicCreated=function(h){this.highlights.forEach(function(d){d.hasGraphic(h)&&h.addHighlight(d.highlightSet,d.options)})},l.prototype.graphicDeleted=function(h){this.highlights.forEach(function(d){d.hasGraphic(h)&&h.removeHighlight(d.highlightSet)})},l.prototype.allGraphicsDeleted=
function(){this.highlights.forEach(function(h){return h.highlightSet.removeAll()})},l}()})},"esri/views/3d/layers/graphics/Graphics3DHighlightSet":function(){define(["require","exports","../../webgl-engine/lib/HighlightSet"],function(A,p,w){return function(){function l(h,d){this.highlightSet=new w;this.ids=new Set;this.options=h;this.objectIdField=d}return l.prototype.hasGraphic=function(h){return this.objectIdField?this.ids.has(h.graphic.attributes[this.objectIdField]):this.ids.has(h.graphic.uid)},
l}()})},"esri/renderers/support/renderingInfoUtils":function(){define(["require","exports"],function(A,p){function w(h,d){if(!h||h.symbol)return null;d=d.renderer;return h&&d&&d.getObservationRenderer?d.getObservationRenderer(h):d}function l(h,d){if(h.symbol)return h.symbol;var l=w(h,d);return l&&l.getSymbol(h,d)}Object.defineProperty(p,"__esModule",{value:!0});p.getRenderer=w;p.getSymbol=l;p.getRenderingInfo=function(h,d){var p=w(h,d),r=l(h,d);if(!r)return null;r={renderer:p,symbol:r};if(p){if(p.colorInfo&&
(r.color=p.getColor(h).toRgba()),p.sizeInfo){var a=p.getSize(h);r.size=[a,a,a]}if(p.visualVariables){h=p.getVisualVariableValues(h,d);a=["proportional","proportional","proportional"];for(d=0;d<h.length;d++){var k=h[d],p=k.variable,c=k.value;"color"===p.type?r.color=c.toRgba():"size"===p.type?"outline"===p.target?r.outlineSize=c:(k=p.axis,p=p.useSymbolValue?"symbolValue":c,"width"===k?a[0]=p:"depth"===k?a[1]=p:"height"===k?a[2]=p:"width-and-depth"===k?a[0]=a[1]=p:a[0]=a[1]=a[2]=p):"opacity"===p.type?
r.opacity=c:"rotation"===p.type&&"tilt"===p.axis?r.tilt=c:"rotation"===p.type&&"roll"===p.axis?r.roll=c:"rotation"===p.type&&(r.heading=c)}(isFinite(a[0])||isFinite(a[1])||isFinite(a[2]))&&(r.size=a)}}return r}})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["require","exports","../../../../portal/support/geometryServiceUtils","../../../../core/promiseUtils","../../../../geometry/support/webMercatorUtils"],function(A,p,w,l,h){Object.defineProperty(p,"__esModule",{value:!0});
p.toView=function(d){var p=d.view.spatialReference,r=d.layer.fullExtent&&d.layer.fullExtent.spatialReference;return!r||r.equals(p)||"local"!==d.view.viewingMode?l.resolve(null):h.canProject(r,p)?l.resolve(h.project(d.layer.fullExtent,p)):w.projectGeometry(d.layer.fullExtent,p,d.layer.portalItem).then(function(a){return!d.destroyed&&a?a:void 0}).otherwise(function(){return null})}})},"esri/layers/graphics/controllers/SnapshotController":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../core/Error ../../../core/Evented ../../../core/Logger ../../../core/HandleRegistry ../../../core/Promise ../../../core/promiseUtils ../../support/GraphicsManager ../../../geometry/support/scaleUtils".split(" "),
function(A,p,w,l,h,d,u,r,a,k,c,t,C,q,v){var y=k.getLogger("esri.layers.graphics.controllers.SnapshotController");return function(a){function h(){var b=a.call(this)||this;return b._cancelErrorMsg="SnapshotController: query cancelled",b._featureResolution={value:.25,scale:945},b._gManager=null,b._handles=new c,b._maxFeatures={point:16E3,multipoint:8E3,polyline:4E3,polygon:4E3,multipatch:4E3},b._source=null,b._started=!1,b._pendingQueries=new Map,b.extent=null,b.hasAllFeatures=!1,b.hasFeatures=!1,b.layer=
null,b.layerView=null,b.maxPageSize=null,b.pageSize=null,b.paginationEnabled=!1,b}return w(h,a),h.prototype.initialize=function(){var a=this,c=this.layer.when(function(){return a._verifyCapabilities()}).then(function(){return a._init()});this.addResolvingPromise(c)},h.prototype.destroy=function(){this.cancelQuery();this._gManager&&(this._gManager.destroy(),this._gManager=null);this._handles.destroy();this._pendingQueries=this._handles=null},Object.defineProperty(h.prototype,"updating",{get:function(){return!!(this._pendingQueries&&
0<this._pendingQueries.size)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"graphics",{set:function(a){this._get("graphics")!==a&&(this._handles.remove("graphics"),a&&(this._collectionChanged({added:a.toArray()}),this._handles.add(a.on("change",this._collectionChanged.bind(this)),"graphics")),this._set("graphics",a))},enumerable:!0,configurable:!0}),h.prototype.cancelQuery=function(){var a=this;this._pendingQueries&&(this._pendingQueries.forEach(function(b,c){b.isFulfilled()||
b.cancel(Error(a._cancelErrorMsg))}),this._pendingQueries.clear(),this.notifyChange("updating"))},h.prototype.refresh=function(){this.isResolved()&&this._started&&this._queryFeatures()},h.prototype.startup=function(){this._started||(this._started=!0,this._resolutionParams=this._getResolutionParams(),this._queryFeatures())},h.prototype.update=function(){this.startup()},h.prototype._init=function(){var a=this.layer;this.paginationEnabled=!!a.get("capabilities.query.supportsPagination");this._source=
a.source;this.pageSize=null==this.maxPageSize?a.maxRecordCount:Math.min(a.maxRecordCount,this.maxPageSize);this._gManager=new q({graphics:this.graphics,objectIdField:a.objectIdField});this._setupStateWatchers()},h.prototype._getResolutionParams=function(){var a,c=this.layer,d=c.get("capabilities.query.supportsQuantization");if("polyline"===c.geometryType||"polygon"===c.geometryType){var h=v.getMetersPerUnit(this.layerView.view.spatialReference);null!=h&&(a=this._featureResolution.scale,h=this._featureResolution.value/
h,a=c.maxScale?c.maxScale:c.minScale?Math.min(a,c.minScale):Math.min(a,v.getScale(this.layerView.view,c.fullExtent)),a*=h/this._featureResolution.scale)}return a?{maxAllowableOffset:d?null:a,quantizationParameters:d?{mode:"view",originPosition:"upperLeft",tolerance:a,extent:c.fullExtent}:null}:null},h.prototype._setupStateWatchers=function(){this._handles.add([this.watch("extent",this.refresh.bind(this)),this.layer.watch("definitionExpression",this.refresh.bind(this)),this.layer.on("edits",this._editsHandler.bind(this))])},
h.prototype._createQueryParams=function(){var a=this.layerView,c=this.layer.createQuery();return c.outSpatialReference=a.view.spatialReference,c.geometry=this.extent,c.set(this._resolutionParams),this.paginationEnabled&&(c.start=0,c.num=this.pageSize),c},h.prototype._queryFeatures=function(){this.cancelQuery();this.hasAllFeatures=this.hasFeatures=!1;this._gManager.beginPagedUpdate();this.emit("query-start");this._executeQuery(this._createQueryParams())},h.prototype._executeQuery=function(a){var b=
this,c=this._source.queryFeatures(a),d=this._gManager.createIntentToAdd();this._querySetup(d,c);c.then(this._processFeatureSet.bind(this,a,d))["catch"](function(a){return b._queryError(d,a)}).always(function(){return b._queryTeardown(d)})},h.prototype._processFeatureSet=function(a,c,d){var b=d.exceededTransferLimit,h=d.features,k=this._maxFeatures[this.layer.geometryType]||0,l=h?h.length:0,m=this._gManager.numGraphics+l,p=m>=k;p&&(y.warn('Feature limit exceeded on layer "',this.layer.title,'". Not all features are shown.'),
(k=m-k)&&h.splice(l-k,k));a=b&&this.paginationEnabled&&!p?this._queryNextPage(a):!1;return h&&this._gManager.addPage(h,c),this.hasFeatures=!0,a||(this._gManager.endPagedUpdate(),this.hasAllFeatures=!b,this.emit("query-end",{success:!0})),d},h.prototype._queryNextPage=function(a){return a.start+=this.pageSize,this._executeQuery(a),!0},h.prototype._queryError=function(a,c){if(c&&"cancel"===c.dojoType&&!this.hasFeatures?this._gManager.revertPagedUpdate():this._gManager.endPagedUpdate(),this.emit("query-end",
{success:!1}),c&&"cancel"===c.dojoType)return C.reject(c);a=new r("snapshotcontroller:tile-request-failed","Failed to query for features",{error:c});return y.error(a),C.reject(a)},h.prototype._querySetup=function(a,c){this._pendingQueries.set(a,c);this.notifyChange("updating")},h.prototype._queryTeardown=function(a){this._gManager.removeIntent(a);this._pendingQueries["delete"](a);this.notifyChange("updating")},h.prototype._processRefetch=function(a,c){(c=c.features)&&this._gManager.add(c,a)},h.prototype._refetchError=
function(a,c){},h.prototype._verifyCapabilities=function(){if(!this.layer.get("capabilities.operations.supportsQuery"))throw new r("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:this.layer});},h.prototype._collectionChanged=function(a){var b=a.added;if(b)for(var c=0;c<b.length;c++)b[c].layer=this.layer;if(b=a.removed)for(c=0;c<b.length;c++)b[c].layer=null},h.prototype._editsHandler=function(a){var b=function(a){return a.objectId},
c=a.deletedFeatures.map(b);this._gManager["delete"](c);a=a.addedFeatures.concat(a.updatedFeatures).map(b);a.length&&(b=this._createQueryParams(),b.objectIds=a,b=this._source.queryFeatures(b),a=this._gManager.createIntentToAdd(a),this._querySetup(a,b),b.then(this._processRefetch.bind(this,a)).otherwise(this._refetchError.bind(this,a)).always(this._queryTeardown.bind(this,a)))},l([d.property()],h.prototype,"_pendingQueries",void 0),l([d.property({dependsOn:["_pendingQueries"]})],h.prototype,"updating",
null),l([d.property()],h.prototype,"graphics",null),l([d.property()],h.prototype,"extent",void 0),l([d.property()],h.prototype,"hasAllFeatures",void 0),l([d.property()],h.prototype,"hasFeatures",void 0),l([d.property()],h.prototype,"layer",void 0),l([d.property()],h.prototype,"layerView",void 0),l([d.property()],h.prototype,"maxPageSize",void 0),l([d.property()],h.prototype,"pageSize",void 0),l([d.property()],h.prototype,"paginationEnabled",void 0),h=l([d.subclass("esri.layers.graphics.controllers.SnapshotController")],
h)}(d.declared(u,t,a))})},"esri/layers/support/GraphicsManager":function(){define(["../../core/Accessor"],function(A){var p=0;return A.createSubclass({constructor:function(){this._deletedGraphicsIndex=new Set;this._intentsIndex=new Map},destroy:function(){this.removeAll();this._intentsIndex=this._deletedGraphicsIndex=null},properties:{graphics:null,indexById:{value:null,dependsOn:["graphics","objectIdField"],get:function(){return this._createIndexById(this.graphics&&this.graphics.toArray(),this.objectIdField)}},
numGraphics:{value:0,dependsOn:["indexById"],get:function(){return this.indexById?this.indexById.size:0}},objectIdField:null,updating:{value:!1,dependsOn:["_intentsIndex"],get:function(){return!!(this._intentsIndex&&0<this._intentsIndex.size)}},_intentsIndex:{value:null}},_oldIndex:null,_deletedGraphicsIndex:null,beginPagedUpdate:function(){this._oldIndex=this.indexById;this.indexById=null;this.notifyChange("numGraphics")},addPage:function(p,l){this.add(p,l)},revertPagedUpdate:function(){var p=this._removeLeftOnly(this.indexById,
this._oldIndex);this.indexById=this._oldIndex;this._oldIndex=null;this.graphics.removeMany(p);this.notifyChange("numGraphics")},endPagedUpdate:function(){var p=this._removeLeftOnly(this._oldIndex,this.indexById);this._oldIndex=null;this.graphics.removeMany(p);this.notifyChange("numGraphics")},findGraphic:function(p){return(p=this.indexById&&this.indexById.get(p))&&p.graphic},removeAll:function(){this.indexById=this._oldIndex=null;this.graphics.removeAll();this.notifyChange("numGraphics")},add:function(p,
l){p&&p.length&&(this.indexById=this.indexById||new Map,p=this._updateAndExtractNew(p,this.indexById,this._oldIndex,l),this.graphics.removeMany(p.toRemove),this.graphics.addMany(p.toAdd),this.notifyChange("numGraphics"))},remove:function(p){this._remove(p,!1)},"delete":function(p){this._remove(p,!0)},isDeleted:function(p){return this._deletedGraphicsIndex.has(p)},createIntentToAdd:function(w){w&&this._intentsIndex.forEach(function(h,d){w.forEach(function(d){h.ignoredIds.add(d)})},this);var l=p++;
return this._intentsIndex.set(l,{ignoredIds:new Set}),this.notifyChange("updating"),l},findIntent:function(p){return this._intentsIndex.get(p)},removeIntent:function(p){this._intentsIndex["delete"](p);this.notifyChange("updating")},_createIndexById:function(p,l){var h;if(p&&p.length&&l){var d,u,r;h=new Map;for(d=0;u=p[d];d++)r=u.attributes&&u.attributes[l],null!=r&&h.set(r,{graphic:u,refCount:1})}return h},_updateAndExtractNew:function(p,l,h,d){var u=[],r=[],a=p?p.length:0,k=this.objectIdField,c=
this.findIntent(d);for(d=0;a>d;d++){var t=p[d],w=t.attributes&&t.attributes[k];if(null!=w){var q=h&&h.get(w);(q=l.get(w)||q)?c&&c.ignoredIds.has(w)||(l.set(w,{graphic:t,refCount:q.refCount+1}),r.push(q.graphic),u.push(t)):this.isDeleted(w)||(l.set(w,{graphic:t,refCount:1}),u.push(t))}else u.push(t)}return{toRemove:r,toAdd:u}},_remove:function(p,l){p=p||[];p="object"==typeof p[0]?p.map(function(d){return d.attributes&&d.attributes[this.objectIdField]}.bind(this)):p;var h=this._extractGraphics(p,this._oldIndex),
d=this._extractGraphics(p,this.indexById);p.forEach(function(d){l&&this._deletedGraphicsIndex.add(d);this._removeFromIndex(d,this._oldIndex,l);this._removeFromIndex(d,this.indexById,l)}.bind(this));this.graphics.removeMany(h.concat(d));this.notifyChange("numGraphics")},_removeFromIndex:function(p,l,h){if(l&&l.has(p))if(h)l["delete"](p);else{h=l.get(p);var d=h.refCount-1;0===d?l["delete"](p):h.refCount=d}},_removeLeftOnly:function(p,l){var h=[];return p&&p.forEach(function(d,u){var r=d.graphic;!r||
l&&l.has(u)||(--d.refCount,0===d.refCount&&p["delete"](u),h.push(r))}),h},_extractGraphics:function(p,l){return p&&l?p.map(function(h){return(h=l.get(h))&&h.graphic}):[]}})})},"url:esri/views/3d/environment/materials/SimpleAtmosphereMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vsSimpleAtmosphere"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n\n#ifndef PANORAMIC\n\n  const float TWICEPI \x3d 2.0*3.14159265;\n  const float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\n\n  uniform vec3 silCircleCenter;\n  uniform vec3 silCircleV1;\n  uniform vec3 silCircleV2;\n  uniform vec2 texV;\n\n#endif\n\n  uniform vec3 lightDirection;\n\n  attribute vec3 $position;\n  varying vec2 vtc;\n  varying float falloff;\n\n  void main(void) {\n\n#ifdef PANORAMIC\n\n    vec3 pos \x3d $position;\n    float ndotl \x3d lightDirection.z;\n    vtc \x3d vec2(0, $position.z+0.05);\n\n#else\n\n    float phi \x3d $position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\n    vec3 pos \x3d (sin(phi) * silCircleV1 + cos(phi) * silCircleV2 + silCircleCenter) * $position.y;\n    float ndotl \x3d dot(normalize(pos), lightDirection);\n\n    vtc.x \x3d $position.x / ATMOSPHERE_RIM_SEGMENTS;\n    vtc.y \x3d texV.x * (1.0 - $position.z) + texV.y * $position.z;\n\n#endif\n\n    falloff \x3d max(0.0, (smoothstep(-1.0, 0.8, ndotl + ndotl)));\n\n    gl_Position \x3d proj * view * vec4(pos, 1.0);\n    gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsSimpleAtmosphere"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  uniform vec4 color;\n  varying vec2 vtc;\n  varying float falloff;\n\n  void main() {\n    vec4 texColor \x3d texture2D(tex, vtc);\n    gl_FragColor \x3d texColor * color * falloff;\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/environment/materials/RealisticAtmosphereMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3c!--Vertex Shader for Atmosphere--\x3e\n\x3csnippet name\x3d"vsRealisticAtmosphere"\x3e\x3c![CDATA[\n//\n// Based on Atmospheric scattering vertex shader by Sean O\'Neil from GPU Gems 2 Chapter 16.\n//\n// Link:                   http://http.developer.nvidia.com/GPUGems2/gpugems2_chapter16.html\n// Download Portal:        http://http.download.nvidia.com/developer/GPU_Gems_2/CD/Index.html\n// Unmodified Source Code: http://http.download.nvidia.com/developer/GPU_Gems_2/CD/Content/16.zip\n//\n// Adapted for WebGIS by Jascha Gr\u00fcbel (jgruebel@esri.com), Z\u00fcrich 2015\n//\n\n  $vsprecisionf\n\n  //Camera\n  uniform vec2 halfSizeNearPlane;\n  uniform vec3 v3CameraUp;\n  uniform vec3 v3CameraRight;\n  uniform vec3 v3CameraDir;\n  uniform vec2 v2CameraCenterOffset;\n\n  //Attributes\n  attribute vec3 $position;\n  attribute vec2 $uv0;\n\n  //Varyings\n  varying vec3 v3WorldRay;\n  varying vec2 vtc;\n\n#ifdef HAZE\n  varying vec3 v3EyeDir;\n#endif\n\n  void main(void) {\n    vec3 v3Pos \x3d $position;\n    vtc \x3d $uv0;\n    vec2 rayvtc \x3d $uv0 - v2CameraCenterOffset;\n\n#ifdef HAZE\n    v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\n#else\n    vec3 v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\n#endif\n    v3WorldRay \x3d v3EyeDir.z*v3CameraDir + v3EyeDir.y*v3CameraUp + v3EyeDir.x*v3CameraRight;\n    gl_Position \x3d vec4(v3Pos, 1.0);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"atmosphereScaleFunction"\x3e\x3c![CDATA[\n  //Approximation for inner integral based on a radii ratio of 10.25:10\n  float scale(float fCos){\n    float x \x3d 1.0 - fCos;\n    return exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"toneMapperConstants"\x3e\x3c![CDATA[\n#ifdef HAZE\n  const float fOneOverGamma \x3d 1.0;//Gamma \x3d 1.0\n#else\n  const float fOneOverGamma \x3d 0.454545; // Gamma \x3d 2.2\n#endif\n  const vec3 v3OneOverGamma \x3d vec3(fOneOverGamma);\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"exponentialToneMapper"\x3e\x3c![CDATA[\n  //ToneMapping operators\n  vec3 expTM(vec3 inputColor,float exposure){\n      return pow(1.0 - exp(inputColor * -exposure), v3OneOverGamma);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"reinhardToneMapper"\x3e\x3c![CDATA[\n  vec3 reinhardTM(vec3 inputColor, float exposure){\n      vec3 intermediate \x3d inputColor *exposure;\n      intermediate /\x3d (1.0+intermediate);\n      return pow(intermediate, v3OneOverGamma);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\n\x3csnippet name\x3d"HSVColorSpace"\x3e\x3c![CDATA[\n//based on http://gamedev.stackexchange.com/a/59808\n// Hue in range [0,1] instead of 360\u00b0\nvec3 rgb2hsv(vec3 c)\n{\n    vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n    vec4 p \x3d mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q \x3d mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n    float d \x3d q.x - min(q.w, q.y);\n    float e \x3d 1.0e-10;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c)\n{\n    vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"atmosphereUniformsConstantsVaryings"\x3e\x3c![CDATA[\n\n  //Light\n  uniform vec3 v3LightDir;      // The direction vector to the light source\n  uniform vec3 v3InvWavelength; // 1 / pow(wavelength, 4) for the red, green, and blue channels\n  uniform vec3 v3InvWavelengthScaled; //v3InvWavelength * fKr4PI + fKm4PI\n\n  //Radii\n  uniform vec4 v4Radii; // inner, inner^2, outer, outer^2,\n\n  //Atmosphere\n  const float fKrESun \x3d 0.075;        // Kr * ESun \x3d 0.005 * 15.0\n  const float fKmESun \x3d 0.015;        // Km * ESun \x3d 0.005 * 15\n  //uniform float fScale;         // 1 / (fOuterRadius - fInnerRadius)\n  //uniform float fScaleDepth;    // The scale depth (i.e. the altitude at which the atmosphere\'s average density is found)\n  //uniform float fScaleOverScaleDepth; // fScale / fScaleDepth\n  //uniform float fOneOverScaleDepth; // 1.0 / fScaleDepth\n\n  //uniform float fScaleDepthBlue;    // The scale depth (i.e. the altitude at which the atmosphere\'s average density is found)\n  //uniform float fScaleOverScaleDepthBlue; // fScale / fScaleDepth\n  //uniform float fOneOverScaleDepthBlue; // 1.0 / fScaleDepth\n\n  uniform vec4 v4AtmosParams1; //(fScale,fScaleDepth,fScaleOverScaleDepth,fOneOverScaleDepth)\n  uniform vec4 v4AtmosParams2; //(g,fScaleDepthBlue,fScaleOverScaleDepthBlue,fOneOverScaleDepthBlue)\n#ifndef HAZE\n  uniform vec4 v4AtmosParams3; //(g2,fMiePhaseCoefficients,fLowerAlphaBlendBound,fOneOverOuterRadiusMinusAlphaBlendBound)\n#endif\n\n  //Camera\n  uniform vec3 v3CameraPos;     // The camera\'s current position\n  //uniform float fCameraHeight;  // The camera\'s current height\n  //uniform float fCameraHeight2; // fCameraHeight^2\n  //uniform float fC; //fCameraHeight2 - fOuterRadius2; // C \x3d ||o-c||^2 - r^2\n  //uniform float fCSur; //fCameraHeight2 - (fInnerRadius2 - 63756370000.0); // C \x3d ||o-c||^2 - r^2\n  uniform vec4 v4SphereComp; //The camera\'s current height, CameraHeight^2,fC,fCSur\n  uniform vec2 nearFar;\n\n  //Camera HDR\n#ifdef HAZE\n  const float fExposure \x3d 1.5;\n#else\n  const float fExposure \x3d 2.0;\n#endif\n\n#ifdef HAZE\n  //Depth texture\n  uniform sampler2D tDepth;\n#endif\n\n  //Testing variables\n  uniform float showTest;\n\n  //Varyings\n  varying vec3 v3EyeDir;\n  varying vec3 v3WorldRay;\n  varying vec2 vtc;\n\n  //Loop constants for integral approximation\n  const float fSamples \x3d 5.0;\n  const int maxSamples \x3d 5;\n]]\x3e\x3c/snippet\x3e\n\n\n\x3csnippet name\x3d"atmospherePrecomputation"\x3e\x3c![CDATA[\n    float fInnerRadius \x3d v4Radii[0];   // The inner (planetary) radius\n    float fInnerRadius2 \x3d v4Radii[1];  // fInnerRadius^2\n    float fOuterRadius \x3d v4Radii[2];   // The outer (atmosphere) radius\n    float fOuterRadius2 \x3d v4Radii[3];  // fOuterRadius^2\n\n    float fCameraHeight \x3d v4SphereComp[0];\n    float fCameraHeight2 \x3d v4SphereComp[1];\n    float fC \x3d v4SphereComp[2];\n    float fCSur \x3d v4SphereComp[3];\n\n#ifdef PLANAR\n    vec3 cameraPosition \x3d vec3(0.0,0.0,fCameraHeight);\n#else\n    vec3 cameraPosition \x3d v3CameraPos;\n#endif\n\n    //Debug variables\n    vec3 test \x3d vec3(0.0,0.0,0.0);\n\n    //Obtain ray from Camera\n    vec3 worldSpaceRay \x3d normalize(v3WorldRay);\n\n    //Compute Atmosphere intersection; i.e. ray/sphere intersection\n    float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay); // B \x3d 2(l * (o-c))\n    float det \x3d B*B - 4.0 * fC; // det \x3d B^2 - 4.0* C\n\n    //idealized sphere intersection to discard early some pixels\n    float detSur \x3d B*B - 4.0 * fCSur; // det \x3d B^2 - 4.0* C\n\n]]\x3e\x3c/snippet\x3e\n\n\n\x3csnippet name\x3d"atmosphereDiscardPixels"\x3e\x3c![CDATA[\n      bool continueComputation \x3d true;\n#ifdef HAZE\n      // only use red channel from depth texture.\n      // see \'Issues\' at https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture\n      float depthSample \x3d texture2D(tDepth, vtc).r;\n\n      float zNear \x3d nearFar[0];\n      float zFar \x3d nearFar[1];\n\n      // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\n      float zNorm \x3d 2.0 * depthSample - 1.0;\n      float linDepth \x3d 2.0 * zNear * zFar /\n        (zFar + zNear - zNorm * (zFar - zNear));\n\n      float nearSurfaceT;\n      if (detSur\x3e0.0){\n        nearSurfaceT \x3d 0.5 *(-B - sqrt(detSur));\n      }\n\n      float rayEndT;\n\n      // find intersections with ground, but only between the near and far\n      // clipping planes.\n      if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\n        vec3 cameraSpaceRay \x3d normalize(v3EyeDir);\n        cameraSpaceRay /\x3d cameraSpaceRay.z;\n        cameraSpaceRay *\x3d linDepth;\n#ifndef PLANAR\n        if((fCameraHeight-fInnerRadius)\x3e8000000.0 \x26\x26 detSur\x3e0.0){\n          rayEndT \x3d nearSurfaceT;\n        } else  if ((fCameraHeight-fInnerRadius)\x3e2000000.0 \x26\x26 detSur\x3e0.0){\n          rayEndT \x3d mix(length(cameraSpaceRay),nearSurfaceT,((fCameraHeight-fInnerRadius)-2000000.0)/6000000.0);\n        } else {\n          rayEndT \x3d length(cameraSpaceRay);\n        }\n#else\n        rayEndT \x3d length(cameraSpaceRay);\n#endif\n      } else {\n        continueComputation \x3d false;\n      }\n#ifdef PLANAR\n      if (16500.0+ fInnerRadius \x3c fCameraHeight){\n        continueComputation \x3d false;\n      }\n#endif\n#else\n      if (detSur\x3e0.0){\n        float nearSurfaceT \x3d 0.5 *(-B - sqrt(detSur));\n        if (nearSurfaceT \x3e 0.0){\n          continueComputation \x3d false;\n        }\n      }\n#endif\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"atmosphereUnpackAddUniforms"\x3e\x3c![CDATA[\n        float fScale \x3d v4AtmosParams1.x;\n        vec2 v2ScaleDepth \x3d vec2(v4AtmosParams1.y,v4AtmosParams2.y);//fScaleDepth, fScaleDepthBlue\n        vec2 v2ScaleOverScaleDepth \x3d vec2(v4AtmosParams1.z,v4AtmosParams2.z);//fScaleOverScaleDepth, fScaleOverScaleDepthBlue\n        vec2 v2OneOverScaleDepth \x3d vec2(v4AtmosParams1.w,v4AtmosParams2.w);//fOneOverScaleDepth, fOneOverScaleDepthBlue\n\n#ifndef HAZE\n        float g \x3d v4AtmosParams2.x;\n        float g2 \x3d v4AtmosParams3.x;\n        float fMiePhaseCoefficients \x3d v4AtmosParams3.y;\n        float fLowerAlphaBlendBound \x3d v4AtmosParams3.z;\n        float fOneOverOuterRadiusMinusAlphaBlendBound \x3d v4AtmosParams3.w;\n#endif\n]]\x3e\x3c/snippet\x3e\n\n\n\x3csnippet name\x3d"atmosphereComputeRayAndLoopSetup"\x3e\x3c![CDATA[\n        float rayStartT \x3d 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\n#ifdef HAZE\n        float nearT \x3d abs(rayStartT);\n        float farT \x3d abs(rayEndT);\n#else\n        float rayEndT \x3d 0.5 *(-B + sqrt(det)); //far intersection with atmosphere\n\n#endif\n\n        float fDistance;//calculate its scattering offset\n        // Calculate the ray\'s starting position\n        if (rayStartT \x3c 0.0)\n        { //ray starts from camera to far\n          rayStartT \x3d 0.0;\n#ifndef HAZE\n          fDistance \x3d fScale*(fInnerRadius - fCameraHeight);\n#endif\n        }\n#ifndef HAZE\n        else\n        {//outside atmosphere\n          fDistance \x3d -1.0;\n        }\n#endif\n\n        // Initialize the scattering loop variables\n        vec3 v3Start \x3d cameraPosition + worldSpaceRay * rayStartT;\n\n#ifdef HAZE\n        vec3 v3End \x3d cameraPosition + worldSpaceRay * rayEndT;\n\n        float fEndLength \x3d length(v3End);\n        float fLocalCameraHeight \x3d length(v3Start);\n\n        //computed for the original end point to get consistent light angles after possible inversions\n        float fLightAngle \x3d dot(v3LightDir, v3End) / fEndLength;\n\n        if (nearT \x3e farT)\n        {\n          if (fLocalCameraHeight \x3c fEndLength)\n          {\n            //Switch positive slopes for flipped rays\n            v3End \x3d cameraPosition + worldSpaceRay * rayStartT;\n            v3Start \x3d cameraPosition + worldSpaceRay * rayEndT;\n            worldSpaceRay *\x3d -1.0;\n            fEndLength \x3d length(v3End);\n            fLocalCameraHeight \x3d length(v3Start);\n          }\n          else if (fLocalCameraHeight \x3d\x3d fEndLength)\n          {// create minuscule fake slope for integration if the slope is zero\n            fLocalCameraHeight +\x3d 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\n            //slope for the camera function\n          }\n        }\n\n        //Calculate its scattering offset\n        // Assumes camera constrains of WSV 3.8\n        float fCameraDepth;\n        float fCameraDepthBlue;\n        if (fLocalCameraHeight \x3e fOuterRadius)\n        {\n          fDistance \x3d fInnerRadius - fOuterRadius;\n        } else\n        {//outside atmosphere\n          fDistance \x3d fEndLength - fLocalCameraHeight;\n        }\n\n#endif\n        vec2 v2OpticalStartDepth \x3d exp(fDistance * v2OneOverScaleDepth);\n\n        float fRayLength \x3d rayEndT - rayStartT;\n        float fSampleLength \x3d fRayLength / fSamples;\n        float fScaledLength \x3d fSampleLength * fScale;\n        vec3 v3SampleRay \x3d worldSpaceRay * fSampleLength;\n        vec3 v3SamplePoint \x3d v3Start + v3SampleRay * 0.5;\n\n#ifdef HAZE\n        float fCameraAngle \x3d dot(-worldSpaceRay, v3End) / fEndLength;\n        float fScaleCameraAngle \x3d scale(fCameraAngle);\n        vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth;\n\n        float scaledValues \x3d scale(fLightAngle) + fScaleCameraAngle;\n        vec2 v2ScaledValuesDepth \x3d scaledValues * v2ScaleDepth;\n#else\n        float fCameraAngle \x3d dot(worldSpaceRay, v3Start / length(v3Start));\n        float angleMultiplier \x3d fCameraAngle\x3e0.0?fCameraAngle:0.0;\n\n        float fScaleCameraAngle \x3d scale(fCameraAngle);\n        vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth * v2ScaleDepth;\n#endif\n\n        //Loop variables\n        vec3 v3FrontColor \x3d vec3(0.0, 0.0, 0.0);\n        vec3 v3FrontColorBlue \x3d vec3(0.0, 0.0, 0.0);\n        vec3 v3Attenuate\x3d vec3(0.0, 0.0, 0.0);\n        vec3 v3AttenuateBlue \x3d vec3(0.0, 0.0, 0.0);\n]]\x3e\x3c/snippet\x3e\n\n\n\x3csnippet name\x3d"atmosphereComputeSampleContribution"\x3e\x3c![CDATA[\n          float fHeight \x3d length(v3SamplePoint);\n          vec2 v2Depth \x3d exp(v2ScaleOverScaleDepth * (fInnerRadius - fHeight));\n#ifdef HAZE\n          vec2 v2Scatter \x3d v2Depth*v2ScaledValuesDepth-v2CameraOffset;\n#else\n          float fLightAngle \x3d dot(v3LightDir, v3SamplePoint) / fHeight;\n          float fCameraAngle \x3d dot(worldSpaceRay, v3SamplePoint) / fHeight;\n          float fTempScaledValues \x3d scale(fLightAngle) - scale(fCameraAngle);\n          vec2 v2Scatter \x3d v2CameraOffset + fTempScaledValues*v2Depth* v2ScaleDepth;\n#endif\n          v3Attenuate \x3d exp(-v2Scatter.x * v3InvWavelengthScaled);\n          v3AttenuateBlue \x3d exp(-v2Scatter.y * v3InvWavelengthScaled);\n\n          v3FrontColor +\x3d v3Attenuate * v2Depth.x;\n          v3FrontColorBlue +\x3d v3AttenuateBlue * v2Depth.y;\n\n          v3SamplePoint +\x3d v3SampleRay;\n]]\x3e\x3c/snippet\x3e\n\n\n\x3csnippet name\x3d"atmosphereComputeHDRColors"\x3e\x3c![CDATA[\n        //Phase computation\n        //clamp to avoid numerical instability at fCos \x3d\x3d -1.0 (and close values) to display fake sun\n        float fCos \x3d clamp(dot(v3LightDir, -worldSpaceRay ),-0.9999999,1.0);\n        float fOnePlusCos2 \x3d fCos*fCos + 1.0;\n#ifdef HAZE\n        // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\n        vec3 colorCoefficients \x3d (fScaledLength* 0.75 * fOnePlusCos2)*(fKrESun*v3InvWavelength+fKmESun);\n\n        //Scaled Length is only applied afterwards to save multiplications\n        vec3 v3Color \x3d colorCoefficients *v3FrontColor;\n        vec3 v3ColorBlue \x3d colorCoefficients *v3FrontColorBlue;\n#else\n        vec3 v3RayleighCoefficients \x3d (fScaledLength*0.75 * fOnePlusCos2*fKrESun)*v3InvWavelength;\n        float fMieCoefficients \x3d fScaledLength*fKmESun * fMiePhaseCoefficients * fOnePlusCos2 / pow(1.0 + g2 - 2.0*g*fCos, 1.5);\n\n        // Calculate the attenuation factor for the ground\n        vec3 v3Color \x3d v3RayleighCoefficients * v3FrontColor + fMieCoefficients * v3FrontColor;\n        vec3 v3ColorBlue \x3d v3RayleighCoefficients * v3FrontColorBlue + fMieCoefficients * v3FrontColorBlue;\n#endif\n]]\x3e\x3c/snippet\x3e\n\n\n\x3csnippet name\x3d"atmosphereComputePixelColor"\x3e\x3c![CDATA[\n\n\n        //HDR to LDR conversion\n        vec3 ldrBlue \x3d expTM(v3ColorBlue,2.0*fExposure);\n        vec3 ldrRed \x3d expTM(v3Color,fExposure);\n\n        //mix reddish and blueish atmosphere\n        vec3 LDR \x3d mix(ldrBlue,ldrRed,0.2);\n#ifdef HAZE\n        LDR *\x3d (1.0-fCameraAngle);\n        vec3 hsv \x3d rgb2hsv(LDR);\n        hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0);//boost haze saturation by 50%\n        LDR \x3d hsv2rgb(hsv);\n        vec3 finalColor \x3d LDR;\n        // when rendering we specify the blend functions such that\n        // newDestColor \x3d oldDestColor*(1.0-finalColor) + finalColor\n#else\n        //reinhard tonemapper for looking upwards\n        vec3 ldrReinhard \x3d reinhardTM(v3Color,fExposure);\n        LDR +\x3d angleMultiplier*ldrReinhard;\n\n        //height dependent parameter to smooth out reddish atmosphere\n        float side \x3d (rayEndT+rayStartT)*0.5;\n        float atmoHeight \x3d sqrt(fCameraHeight2 - side*side);\n        float h2 \x3d clamp(1.0-(atmoHeight-fLowerAlphaBlendBound)/(fOuterRadius-fLowerAlphaBlendBound),0.0,1.0);\n\n        vec3 finalColor \x3d LDR*h2;\n        vec3 hsv \x3d rgb2hsv(finalColor);\n        hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0);//boost sky saturation by 50%\n        finalColor \x3d hsv2rgb(hsv);\n#endif\n#ifdef PLANAR\n#ifndef HAZE\n        float alpha \x3d clamp(fCameraHeight-fInnerRadius,7000.0,30000.0);\n        alpha \x3d alpha / (30000.0-7000.0);\n        gl_FragColor \x3d vec4(finalColor, 1.0-alpha);\n#else\n        float alpha \x3d clamp(fCameraHeight-fInnerRadius,0.0,16500.0);\n        alpha \x3d alpha / (16500.0-0.0);\n        gl_FragColor \x3d vec4(finalColor, 1.0-alpha);\n#endif\n#else\n#ifndef HAZE\n        float alpha \x3d clamp(fCameraHeight-fInnerRadius,7000.0,30000.0);\n        alpha \x3d alpha / (30000.0-7000.0);\n        float atmosStrength \x3d clamp((length(ldrRed)-0.05)*1.05,0.0,1.0);\n        gl_FragColor \x3d vec4(finalColor, atmosStrength*clamp(1.0-(atmoHeight-fInnerRadius)/(fOuterRadius-fInnerRadius),0.0,1.0));\n#else\n        gl_FragColor \x3d vec4(finalColor, 1.0);\n#endif\n#endif\n\n\n]]\x3e\x3c/snippet\x3e\n\n\x3c!--Fragment Shader for Atmosphere--\x3e\n\x3csnippet name\x3d"fsRealisticAtmosphere"\x3e\x3c![CDATA[\n\n  $fsprecisionf\n\n$atmosphereUniformsConstantsVaryings\n\n$atmosphereScaleFunction\n\n  //Conversion implementation found in util.xml\n$rgba2float\n\n\n$toneMapperConstants\n$exponentialToneMapper\n#ifndef HAZE\n$reinhardToneMapper\n#endif\n\n$HSVColorSpace\n\n  void main()\n  {\n\n    $atmospherePrecomputation\n\n    //Inside Atmosphere\n    if (det \x3e\x3d 0.0){\n\n      $atmosphereDiscardPixels\n\n      if(continueComputation){\n\n        $atmosphereUnpackAddUniforms\n\n        $atmosphereComputeRayAndLoopSetup\n\n        // Now loop through the sample rays\n        for(int i\x3d0; i\x3cmaxSamples; i++)\n        {\n          $atmosphereComputeSampleContribution\n        }\n\n        $atmosphereComputeHDRColors\n\n        $atmosphereComputePixelColor\n\n        //Debug variable overlay\n        if(showTest\x3e0.0){\n          gl_FragColor \x3d vec4(test,1.0);\n        }\n\n      } else {//Not on surface\n        gl_FragColor \x3d vec4(0.0);\n      }\n    } else {//Outside Atmosphere\n      gl_FragColor \x3d vec4(0.0);\n    }\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/internal/offscreen.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vsOffscreenRenderer"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $position;\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n\n  void main(void) {\n    gl_Position \x3d vec4(position.xy, 0.0, 1.0);\n    vtc \x3d $uv0.xy * 0.5 + 0.5;\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsOffscreenRenderer"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  varying vec2 vtc;\n\n  void main() {\n    vec4 texColor \x3d texture2D(tex, vtc);\n    gl_FragColor \x3d texColor;\n  }\n\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/environment/materials/StarMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vertexShaderStar"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tuniform mat4 proj;\n\tuniform mat4 view;\n\tuniform mat4 model;\n\tuniform vec4 viewport;\n\n\tattribute vec3 $position;\n\tattribute vec4 $color;\n  attribute float $size;\n\n\tvarying vec4 vcolor;\n\tvarying float vsize;\n\n\t$alignToPixelCenter\n\n\tvoid main(void) {\n\t\tvec4 posProj \x3d proj * view * model*vec4($position*1.0e25,1.0);//move infinitely far away\n\t\tgl_Position \x3d alignToPixelCenter(posProj, viewport.zw); //pixel align position\n    gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\n\t\tvcolor \x3d $color/1.2;\n\t\tvsize \x3d size*5.0;\n\t\tgl_PointSize \x3d vsize;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderStar"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tvarying vec4 vcolor;\n\tvarying float vsize;\n\n\tvoid main() {\n\t\tfloat cap \x3d 0.7;\n\t\tfloat scale \x3d 1.0/cap;\n\t\tfloat helper \x3d clamp(length(abs(gl_PointCoord-vec2(0.5))),0.0,cap);\n\t\tfloat alpha \x3d clamp((cap-helper)*scale,0.0,1.0);\n\t\tfloat intensity \x3d alpha*alpha*alpha;\n\t\tif (vsize \x3c 3.0)\n\t\t\tintensity *\x3d 0.5;\n\t\tgl_FragColor \x3d vec4(1.0,1.0,1.0,intensity);\n\t\tgl_FragColor.xyz *\x3d vcolor.xyz;\n\t}\n]]\x3e\x3c/snippet\x3e\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/HUDMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vertexShaderHUD"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  $commonAttributesAndUniformsHUD\n\n  uniform float pixelRatio;\n  uniform vec2 screenOffset;\n  uniform vec2 anchorPos;\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n  uniform vec4 screenSizePerspective;\n\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\n  varying vec3 debugBorderCoords;\n#endif\n\n  attribute vec2 $uv0;\n  attribute vec4 $color;\n  attribute vec2 $size;\n  attribute vec4 $auxpos2;\n\n  varying vec4 vcolor;\n\n  varying vec2 vtc;\n  varying vec2 vsize;\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n  varying float voccluded;\n#endif\n\n  $vvUniforms\n\n  $alignToPixelCenter\n  $alignToPixelOrigin\n  $projectPositionHUD\n  $vvFunctions\n\n  void main(void) {\n    ProjectHUDAux projectAux;\n    vec4 posProj \x3d projectPositionHUD(projectAux);\n\n    vec2 inputSize;\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n    inputSize \x3d screenSizePerspectiveScaleVec2($size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n\n    vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n\n#else\n\n    inputSize \x3d $size;\n\n    vec2 screenOffsetScaled \x3d screenOffset;\n#endif\n\n#ifdef VV_SIZE\n    // only use width (.xx) for proportional scaling\n    // (if no width was defined in vv, width\n    //  will be a copy of height vv)\n    inputSize *\x3d vvGetScale($auxpos2).xx;\n#endif\n\n    vec2 combinedSize \x3d inputSize * pixelRatio;\n    vec4 quadOffset \x3d vec4(0);\n\n#if defined(OCCL_TEST) || defined(BINARY_HIGHLIGHT_OCCLUSION)\n    bool visible \x3d testVisibilityHUD(posProj);\n#endif\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n  voccluded \x3d visible ? 0.0 : 1.0;\n#endif\n\n#ifdef OCCL_TEST\n    if (visible) {\n#endif\n      // UV goes from 0 to 1.99999, where the integer part is used\n      // for the normalized vertex coordinates, and the fractional\n      // part is used for texture sampling\n      vec2 uv01 \x3d floor($uv0);\n      vec2 uv \x3d $uv0 - uv01;\n\n      // Displace icon based on anchor position (normalized for size) and\n      // absolute screen offset. anchorPos is [-0.5, 0.5]\n      quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n\n#ifdef SIGNED_DISTANCE_FIELD\n\n      // SDF primitives might be scaled so that the SDF texture resolution does\n      // not match the resolution of the canvas, but we still want to render\n      // outline-only (\'cross\' and \'x\') primitives cleanly. Aligning to a screen\n      // pixel border at the geometry center achieves this, since SDF textures\n      // always have power of 2 dimensions.\n      posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;\n#else\n      posProj +\x3d quadOffset;\n\n      // Aligning vertex positions to the nearest (using \'floor\') screen pixel\n      // border renders textures with pixel-perfect results. If the texture\n      // resolution does not match the canvas resolution then aligning is\n      // redundant.\n      if (inputSize.x \x3d\x3d $size.x) {\n        posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\n      }\n#endif\n\n      gl_Position \x3d posProj;\n\n      vtc \x3d uv;\n\n#ifdef DEBUG_DRAW_BORDER\n      debugBorderCoords \x3d vec3(uv01, 1.0 / combinedSize);\n#endif\n\n      vsize \x3d inputSize;\n#ifdef OCCL_TEST\n    } else {\n      vtc \x3d vec2(.0);\n\n#ifdef DEBUG_DRAW_BORDER\n      debugBorderCoords \x3d vec3(0);\n#endif\n\n    }\n#endif\n\n    gl_Position \x3d posProj;\n\n#ifdef VV_COLOR\n    vcolor \x3d vvGetColor($auxpos2, vvColorValues, vvColorColors);\n#else\n    vcolor \x3d $color / 255.0;\n#endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderHUDBaseVariables"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  #extension GL_OES_standard_derivatives : require\n\n  uniform sampler2D tex;\n  uniform vec4 overrideColor;\n  uniform vec4 outlineColor;\n  uniform float outlineSize;\n\n  varying vec4 vcolor;\n\n  varying vec2 vtc;\n  varying vec2 vsize;\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n  varying float voccluded;\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\n  varying vec3 debugBorderCoords;\n#endif\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderHUDBaseMain"\x3e\x3c![CDATA[\n  vec4 premultiply(vec4 v) {\n    return vec4(v.rgb * v.a, v.a);\n  }\n\n  void main() {\n\n#ifdef SIGNED_DISTANCE_FIELD\n    vec4 color \x3d vec4(0.0, 0.0, 0.0, 0.0);\n    vec4 fillPixelColor \x3d overrideColor * vcolor;\n\n    // Attempt to sample texel centers to avoid thin cross outline\n    // disappearing with large symbol sizes.\n    // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n    const float txSize \x3d 128.0;\n    vec2 scaleFactor \x3d ((vsize - txSize) / txSize);\n    vec2 samplePos \x3d vtc + vec2(1.0, -1.0) * (1.0 / txSize) * scaleFactor;\n\n    // Distance in [-0.5, 0.5]\n    float d \x3d dot(texture2D(tex, samplePos), vec4(1.0/16777216.0, 1.0/65535.0, 1.0/256.0, 1.0)) - 0.5;\n\n    // Work around loss of precision for \'d \x3d 0.0\'.\n    // \'0\' gets normalised to 0.5 * 256 \x3d 128 before float packing, but can only\n    // be stored in the texture as 128 / 255 \x3d 0.502.\n    // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603110\n    const float diff \x3d (128.0/255.0 - 0.5);\n\n    // adjust all values, not just those close to 0, to avoid discontinuities in\n    // the outlines of other shapes e.g. circles\n    d \x3d d - diff;\n\n    // Distance in output units\n    float dist \x3d d * vsize.x;\n\n    fillPixelColor.a *\x3d clamp(0.5 - dist, 0.0, 1.0);\n\n    if (outlineSize \x3e 0.25) {\n      vec4 outlinePixelColor \x3d outlineColor;\n      float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\n      outlinePixelColor.a *\x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n\n      // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n      float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n      vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\n        vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n      gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\n    }\n    else {\n      gl_FragColor \x3d premultiply(fillPixelColor);\n    }\n\n    // visualize SDF:\n    // gl_FragColor \x3d vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n#else\n\n    // HUDMaterial is rendered with a blending mode that assumes a pre-multiplied\n    // fragment color. Input textures should already be pre-multiplied and so\n    // don\'t require adjustment, but the override and vertex colors must be\n    // modulated by their alpha values.\n\n    gl_FragColor \x3d texture2D(tex, vtc, -0.5) * premultiply(overrideColor * vcolor);\n\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\n     float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, vec2(debugBorderCoords.z))) || any(greaterThan(debugBorderCoords.xy, vec2(1.0 - debugBorderCoords.z))));\n     gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 1, 1), isBorder);\n#endif\n\n    if (gl_FragColor.a \x3c 0.1) {\n      discard;\n    }\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderHUD"\x3e\x3c![CDATA[\n$fragmentShaderHUDBaseVariables\n$fragmentShaderHUDBaseMain\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderHUDHighlight"\x3e\x3c![CDATA[\n$fragmentShaderHUDBaseVariables\n\n  uniform sampler2D depthTex;\n  uniform vec4 highlightViewportPixelSz;\n\n$fragmentShaderHUDBaseMain\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n    // Instead of deciding on a per-pixel basis if the highlight is occluded,\n    // do it for all highlight pixel based on the centroid occlusion. This\n    // is a temporary solution for:\n    // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/9645\n    if (voccluded \x3d\x3d 1.0) {\n      gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n    } else {\n      gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n    }\n#else\n    $highlightWrite\n#endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\n\x3csnippet name\x3d"vertexShaderOcclusionTestPixel"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  $commonAttributesAndUniformsHUD\n\n  $alignToPixelCenter\n  $projectPositionHUD\n\n  void main(void) {\n    vec4 posProjCenter;\n\n    // Check for special value of position (0, 0, 0) which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just project outside\n    // of clip space.\n    if (dot($position, $position) \x3e 0.0) {\n      // Render single point to center of the pixel to avoid subpixel filtering to affect\n      // the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj \x3d projectPositionHUD(projectAux);\n\n      posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n    }\n    else {\n      // Project out of clip space\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position \x3d posProjCenter;\n    gl_PointSize \x3d 1.0;\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vertexShaderTexOnly"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tuniform mat4 proj;\n\tuniform mat4 view;\n\tuniform mat4 model;\n\tattribute vec3 $position;\n\tattribute vec2 $uv0;\n\tvarying vec2 vtc;\n\n\tvoid main(void) {\n\t\tgl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\n\t\tvtc \x3d $uv0;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderTexOnly"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform sampler2D tex;\n\tuniform vec4 color;\n\tvarying vec2 vtc;\n\n\tvoid main() {\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\n\t\tgl_FragColor \x3d texColor * color;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/internal/ssao.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\t\x3csnippet name\x3d"createFsSSAOSrc"\x3e\x3c![CDATA[\n\n\t$fsprecisionf\n\n\tuniform sampler2D rnm;\n\tuniform sampler2D normalMap;\n\tuniform sampler2D depthMap;\n\tuniform float\t\tssaoAtt;\n\tuniform vec2\t\trnmScale;\n\tuniform float\t\tradius;\n\tuniform vec2\t\tnearFar;\n\tuniform vec3\t\tpSphere[64];\n\n\tvarying vec2\t\tuv;\n\n\tconst\tfloat\t\tstrength \x3d .07;\n\tconst\tfloat\t\tfalloff \x3d .000002;\n\n\t$rgba2float\n\tvoid main(void) {\n\t\tvec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n\t\tfloat currentPixelDepth \x3d rgba2float(texture2D(depthMap, uv));\n\t\tvec3 ep \x3d vec3(uv.xy, currentPixelDepth);\n\t\tvec3 norm \x3d vec3(-1.0) + 2.0 * texture2D(normalMap, uv).xyz;\n\t\tfloat bl \x3d .0;\n\t\tfloat f \x3d mix(nearFar.x, nearFar.y, currentPixelDepth) / nearFar.x;\n\t\tfloat radD \x3d radius / f;\n\t\tradD \x3d min(radD, .5);\n\t\tfloat depthDifference;\n\t\tvec3 ray;\n\n\t\tfor(int i \x3d 0; i \x3c NUM_TAP_SAMPLES; ++i) {\n\t\t\tray \x3d radD*reflect(pSphere[i], fres);\n\t\t\tvec2 tc \x3d ep.xy + sign(dot(ray, norm) ) * ray.xy;\n\t\t\tif (tc.x \x3e\x3d .0 \x26\x26 tc.y \x3e\x3d .0 \x26\x26 tc.x \x3c\x3d 1.0 \x26\x26 tc.y \x3c\x3d 1.0) {\n\t\t\t\tfloat occluderDepth \x3d rgba2float(texture2D(depthMap, tc));\n\t\t\t\tvec3 occluderNormal \x3d vec3(-1.0) + 2.0 * texture2D(normalMap, tc).xyz;\n\t\t\t\tdepthDifference \x3d currentPixelDepth - occluderDepth;\n\t\t\t\tbl +\x3d step(falloff, depthDifference) * (1.0 - dot(occluderNormal, norm)) * (1.0 - smoothstep(falloff, strength, depthDifference));\n\t\t\t};\n\t\t}\n\n\t\tfloat ao \x3d 1.0 + bl * (-1.38 / float(NUM_TAP_SAMPLES)) * ssaoAtt;\n\t\tgl_FragColor.a \x3d ao;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\t\x3csnippet name\x3d"getDepthLinear"\x3e\x3c![CDATA[\n\tfloat getDepthLinear(vec2 ssC) {\n\t\treturn -(rgba2float(texture2D(depthMap, ssC))*(nearFar[1] - nearFar[0])+nearFar[0]);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"createFsSSAOSrcObscurance"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform mat4 projMatrixInv;\n\n\tuniform sampler2D normalMap;\n\tuniform sampler2D depthMap;\n\n\tuniform float     intensity;\n\n\tuniform float projScale;\n\tuniform float     radius;\n\tuniform vec2      nearFar;\n\n\tuniform vec4      projInfo;\n\n\tuniform vec2\t  screenDimensions;\n\n\t//noise texture lookup could be replaced with hash function if WebGL gets XOR functionality\n\tuniform vec3\t\tpSphere[NUM_TAP_SAMPLES]; //tap position\n\tuniform vec2\t\trnmScale;\n\tuniform sampler2D rnm; //noise texture\n\n\t//set z scaling, used to prevent division in ortho mode\n\tuniform vec2 zScale;\n\n\tvarying vec2  uv;\n\tvarying vec4  camPos;\n\n\t$rgba2float\n\t$getDepthLinear\n\n\t/** Returns a unit vector and a screen-space radius for the tap on a unit disk (the caller should scale by the actual disk radius) */\n\t/*uniform float numSpiralTurns;\n\tvec2 tapLocation(int sampleNumber, float spinAngle, out float ssR){\n\t\t// Radius relative to ssR\n\t\tfloat alpha \x3d (float(sampleNumber) + 0.5) * (1.0 / float(NUM_TAP_SAMPLES));\n\t\tfloat angle \x3d alpha * (numSpiralTurns * 6.28) + spinAngle;\n\n\t\tssR \x3d alpha;\n\t\treturn vec2(cos(angle), sin(angle));\n\t}*/\n\n\n\tfloat fallOffFunction(float vv, float vn, float bias) {\n\t  float radius2 \x3d radius * radius;\n\n\t\t// A: From the HPG12 paper\n\t\t// Note large epsilon to avoid overdarkening within cracks\n\t\t// return float(vv \x3c radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\n\n\t\t// B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\n\t\tfloat f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\n\n\t\t// C: Medium contrast (which looks better at high radii), no division.  Note that the\n\t\t// contribution still falls off with radius^2, but we\'ve adjusted the rate in a way that is\n\t\t// more computationally efficient and happens to be aesthetically pleasing.\n\t\t// return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\n\n\t\t// D: Low contrast, no division operation\n\t\t// return 2.0 * float(vv \x3c radius * radius) * max(vn - bias, 0.0);\n\t}\n\n\n\t/** Compute the occlusion due to sample point \\a Q about camera-space point \\a C with unit normal \\a n_C */\n\tfloat aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\n\t\tvec3 v \x3d Q - C;\n\t\tfloat vv \x3d dot(v, v);\n\t\tfloat vn \x3d dot(normalize(v), n_C);\n\t\treturn fallOffFunction(vv, vn, 0.1);\n\t}\n\n\n\t/** Reconstruct camera-space P.xyz from screen-space S \x3d (x, y) in\n\t\tpixels and camera-space z \x3c 0.  Assumes that the upper-left pixel center\n\t\tis at (0.5, 0.5) [but that need not be the location at which the sample tap\n\t\twas placed!]\n\n\t\tCosts 3 MADD.  Error is on the order of 10^3 at the far plane, partly due to z precision.\n\t  */\n\tvec3 reconstructCSPosition(vec2 S, float z) {\n\t\treturn vec3(( (S.xy) * projInfo.xy + projInfo.zw)*(z*zScale.x+zScale.y), z);\n\t}\n\n\tvoid main(void)\n\t{\n\n\t\t//Hash function used in the HPG12 AlchemyAO paper\n\t\t//Not supported in WebGL -\x3e using texture lookup as in old SSAO shader instead\n\t\t//ivec2 ssC \x3d ivec2(gl_FragCoord.xy);\n\t\t//float randomPatternRotationAngle \x3d float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\n\t\tvec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n\n\t   float currentPixelDepth \x3d getDepthLinear(uv);\n\n\t   if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\n\t\tgl_FragColor \x3d vec4(0);\n\t\treturn;\n\t   }\n\n\t   vec3 currentPixelPos \x3d reconstructCSPosition(gl_FragCoord.xy,currentPixelDepth);\n\n\t   // get the normal of current fragment\n\t   vec4 norm4 \x3d texture2D(normalMap, uv);\n\t   vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\n\t   bool isTerrain \x3d norm4.w\x3c0.5;\n\n\t   float sum \x3d .0;\n\n\t   vec4 occluderFragment;\n\t   vec3 ray;\n\n\t   vec3 tapPixelPos;\n\n\t   // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\n\t   // bug or deviation from CE somewhere else?\n\t   float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\n\n\t   for(int i \x3d 0; i \x3c NUM_TAP_SAMPLES; ++i)\n\t   {\n\t\t  // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\n\t\t  //float ssR;\n\t\t  //vec2 unitOffset \x3d tapLocation(i, randomPatternRotationAngle, ssR);\n\t\t  // get the depth of the occluder fragment\n\t\t  //vec2 offset \x3d vec2(-unitOffset*radius*ssR*ps);\n\n\t\t  vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\n\t\t  vec2 offset \x3d vec2(-unitOffset*radius*ps);\n\n\n\t\t  //don\'t use current or very nearby samples\n\t\t  if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\n\n\n\t\t  vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\n\t\t  if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\n\t\t  vec2 tcTap \x3d tc/screenDimensions;\n\t\t  float occluderFragmentDepth \x3d getDepthLinear(tcTap);\n\n\t\t  if (isTerrain) {\n\t\t  \tbool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\n\t\t  \tif (isTerrainTap)\n\t\t  \t\tcontinue;\n\t\t  }\n\n\t\t  tapPixelPos \x3d reconstructCSPosition(tc, occluderFragmentDepth);\n\n\t\t  sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\n\t   }\n\n\t   // output the result\n\n\t\tfloat A \x3d max(1.0-sum*intensity/float(NUM_TAP_SAMPLES),0.0);\n\n\t\t// Anti-tone map to reduce contrast and drag dark region farther\n\t\t// (x^0.2 + 1.2 * x^4)/2.2\n\t\tA \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n\n\n\t   //gl_FragColor \x3d vec4(norm/2.0+0.5, 1.0);\n\t   //gl_FragColor \x3d vec4(-currentPixelDepth/1000.0);\n\t   //gl_FragColor \x3d vec4(tapPixelPos.x/100.0);\n\t   gl_FragColor \x3d vec4(A);\n\n\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsBlurEdgeAware"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform sampler2D normalMap;\n\tuniform sampler2D depthMap;\n\tuniform sampler2D tex;\n\n\n\tuniform vec2 blurSize;\n\n\n\tuniform float g_BlurFalloff;\n\tuniform float projScale;\n\n\n\tvarying vec2 uv;\n\n\tuniform vec2\t\tnearFar;\n\n\t//set z scaling, used to prevent division in ortho mode\n\tuniform vec2 zScale;\n\n\t$rgba2float\n\t$getDepthLinear\n\n\tfloat BlurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness)\n\t{\n\t\tfloat c \x3d texture2D(tex, uv).r;\n\t\tfloat d \x3d getDepthLinear(uv);\n\n\t\tfloat ddiff \x3d d - center_d;\n\n\t\tfloat w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\n\n\t\tw_total +\x3d w;\n\n\t\treturn w*c;\n\t}\n\n\tvoid main(void)\n\t{\n\n\t\tfloat b \x3d 0.0;\n\t\tfloat w_total \x3d 0.0;\n\n\t\tfloat center_d \x3d  getDepthLinear(uv);\n\n\t\tfloat sharpness \x3d -0.05*projScale/(center_d*zScale.x+zScale.y);\n\t\tfor (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r)\n\t\t{\n\t\t\tfloat rf \x3d float(r);\n\t\t\tvec2 uvOffset \x3d uv + rf*blurSize;\n\t\t\tb +\x3d BlurFunction(uvOffset, rf, center_d, w_total, sharpness);\n\t\t}\n\n\t\tgl_FragColor \x3d vec4(b/w_total);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\n\t\x3csnippet name\x3d"fsBlurSrc0"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform sampler2D tex;\n\tuniform float blurSize;\n\tvarying vec2 uv;\n\n\tvoid main() {\n\t\tint rad \x3d RADIUS - 1;\n\n\t\tvec4 sum \x3d vec4(0.0);\n\t\tfor (int k \x3d -RADIUS; k \x3c\x3d RADIUS; ++k) { \t\t// NOTE for-variable-init must be a const expression\n\t\t\tfloat fi \x3d float(k);\n]]\x3e\x3c/snippet\x3e\n\n\t\x3csnippet name\x3d"fsBlurSrc1"\x3e\x3c![CDATA[\n\t\t}\n\n\t\tgl_FragColor \x3d sum / float(RADIUS * RADIUS);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\t\x3csnippet name\x3d"fsBlurH"\x3e\x3c![CDATA[\n\t$fsBlurSrc0\n\t\t\tsum +\x3d texture2D(tex, vec2(uv.x + fi * blurSize, uv.y)) * (float(rad) - abs(fi) + 1.0);\n\t$fsBlurSrc1\n]]\x3e\x3c/snippet\x3e\n\n\t\x3csnippet name\x3d"fsBlurV"\x3e\x3c![CDATA[\n\t$fsBlurSrc0\n\t\t\tsum +\x3d texture2D(tex, vec2(uv.x, uv.y + fi * blurSize)) * (float(rad) - abs(fi) + 1.0);\n\t$fsBlurSrc1\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/internal/highlight.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3c!--\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\nSmartly downsamples a texture, halfing its resolution. This allows for a square\nscreen region to check if none, any or all pixels were set.\n\nThe red channel is always ceiled after interpolating the 4 merged pixels.\nThis allows to evaluate:\nany(pixels.red !\x3d 0.0) as red \x3d\x3d 1.0\nnone(pixels.red !\x3d 0.0) as red \x3d\x3d 0.0\n\nThe green and blue channels are set to floor(max(green, blue)).\nThis allows to evaluate:\nall(pixels.green || pixels.blue) as green \x3d\x3d 1.0\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\n--\x3e\n\n\x3csnippet name\x3d"vsConservativeDownsample"\x3e\x3c![CDATA[\n\n  $vsprecisionf\n\n  attribute vec2 $position;\n\n  void main()\n  {\n    gl_Position \x3d vec4(vec2(1.0) - $position * 2.0, .0, 1.0);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsConservativeDownsample"\x3e\x3c![CDATA[\n\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  uniform vec2 invFramebufferDim;\n\n  void main()\n  {\n    vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\n    vec4 value \x3d texture2D(tex, coord);\n    float mx \x3d floor(max(value.g, value.b));\n    gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c!--\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\nGaussian blur with linear sampling. Supports different number of samples, but\nonly 5 samples have proper weights. Uses linear texture interpolation to reduce\nthe number of samples taken.\n\nDefines:\nGRID_OPTIMIZATION (set or !set)\nGAUSSIAN_SAMPLES (3,5,7)\n\nThis technique requires linear filtering on source texture\nhttp://rastergrid.com/blog/2010/09/efficient-gaussian-blur-with-linear-sampling/\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\n--\x3e\n\x3csnippet name\x3d"vsHighlightBlurFastGaussian"\x3e\x3c![CDATA[\n\n  $vsprecisionf\n\n  attribute vec2 $position;\n  attribute vec2 $uv0;\n\n  #ifdef GRID_OPTIMIZATION\n    uniform sampler2D coverageTex;\n    varying vec3 blurCoordinate;\n  #else\n    uniform vec2 blurSize;\n    varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\n  #endif\n\n  void main()\n  {\n    gl_Position \x3d vec4($position, 0.0, 1.0);\n\n    #ifdef GRID_OPTIMIZATION\n      // sample the coverage texture at the block center\n      // and if no coverage detected, create degenerate triangle\n      vec4 cov \x3d texture2D(coverageTex, $uv0);\n      if (cov.r \x3d\x3d 0.0) {\n        gl_Position \x3d vec4(0,0,0,0);\n      }\n\n      // create texture coordinate for blur center\n      // encode information about fully inside block in z coordinate\n      blurCoordinate \x3d vec3(gl_Position.xy * .5 + vec2(.5), max(cov.g, cov.b));\n    #else\n      vec2 uv \x3d $position.xy * .5 + vec2(.5);\n\n      #if GAUSSIAN_SAMPLES \x3d\x3d 3\n        // not proper gaussian weights\n        blurCoordinates[0] \x3d uv;\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 5\n        blurCoordinates[0] \x3d uv;\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n        blurCoordinates[3] \x3d uv + blurSize * 3.294215;\n        blurCoordinates[4] \x3d uv - blurSize * 3.294215;\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 7\n        // not proper gaussian weights\n        blurCoordinates[0] \x3d uv;\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n        blurCoordinates[3] \x3d uv + blurSize * 3.294215;\n        blurCoordinates[4] \x3d uv - blurSize * 3.294215;\n        blurCoordinates[5] \x3d uv + blurSize * 5.1;\n        blurCoordinates[6] \x3d uv - blurSize * 5.1;\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 9\n        // not proper gaussian weights\n        blurCoordinates[0] \x3d uv;\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n        blurCoordinates[3] \x3d uv + blurSize * 3.294215;\n        blurCoordinates[4] \x3d uv - blurSize * 3.294215;\n        blurCoordinates[5] \x3d uv + blurSize * 5.1;\n        blurCoordinates[6] \x3d uv - blurSize * 5.1;\n        blurCoordinates[7] \x3d uv + blurSize * 7.1;\n        blurCoordinates[8] \x3d uv - blurSize * 7.1;\n      #endif\n    #endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsHighlightBlurFastGaussian"\x3e\x3c![CDATA[\n\n  $fsprecisionf\n\n  uniform sampler2D tex;\n\n  #ifdef GRID_OPTIMIZATION\n    uniform vec2 blurSize;\n    varying vec3 blurCoordinate;\n  #else\n    varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\n  #endif\n\n  void main()\n  {\n    #ifdef GRID_OPTIMIZATION\n      vec2 uv \x3d blurCoordinate.xy;\n      vec4 center \x3d texture2D(tex, uv);\n\n      // do not blur if no pixel or all pixels in neighborhood are set\n      if (blurCoordinate.z \x3d\x3d 1.0) {\n        gl_FragColor \x3d center;\n      }\n      else {\n        vec4 sum \x3d vec4(0.0);\n\n        #if GAUSSIAN_SAMPLES \x3d\x3d 3\n          // not proper gaussian weights\n          sum +\x3d center * 0.204164;\n          sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n          sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n        #elif GAUSSIAN_SAMPLES \x3d\x3d 5\n          sum +\x3d center * 0.204164;\n          sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n          sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n          sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n          sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n        #elif GAUSSIAN_SAMPLES \x3d\x3d 7\n          // not proper gaussian weights\n          sum +\x3d center * 0.204164;\n          sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n          sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n          sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n          sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n          sum +\x3d texture2D(tex, uv + blurSize * 5.1) * 0.03;\n          sum +\x3d texture2D(tex, uv - blurSize * 5.1) * 0.03;\n        #elif GAUSSIAN_SAMPLES \x3d\x3d 9\n          // not proper gaussian weights\n          sum +\x3d center * 0.154164;\n          sum +\x3d texture2D(tex, uv + blurSize * 1.5) * 0.204005;\n          sum +\x3d texture2D(tex, uv - blurSize * 1.5) * 0.204005;\n          sum +\x3d texture2D(tex, uv + blurSize * 3.5) * 0.123913;\n          sum +\x3d texture2D(tex, uv - blurSize * 3.5) * 0.123913;\n          sum +\x3d texture2D(tex, uv + blurSize * 5.5) * 0.123913;\n          sum +\x3d texture2D(tex, uv - blurSize * 5.5) * 0.123913;\n          sum +\x3d texture2D(tex, uv + blurSize * 7.5) * 0.05;\n          sum +\x3d texture2D(tex, uv - blurSize * 7.5) * 0.05;\n        #endif\n\n        gl_FragColor \x3d sum;\n      }\n    #else\n      vec4 sum \x3d vec4(0.0);\n\n      #if GAUSSIAN_SAMPLES \x3d\x3d 3\n        // not proper gaussian weights\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 5\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\n        sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\n        sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 7\n        // not proper gaussian weights\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\n        sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\n        sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\n        sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.03;\n        sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.03;\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 9\n        // not proper gaussian weights\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.154164;\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.204005;\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.204005;\n        sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.123913;\n        sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.123913;\n        sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.09;\n        sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.09;\n        sum +\x3d texture2D(tex, blurCoordinates[7]) * 0.05;\n        sum +\x3d texture2D(tex, blurCoordinates[8]) * 0.05;\n      #endif\n\n      gl_FragColor \x3d sum;\n    #endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c!--\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\nMerging blurred outlines with source image, advanced version\n\nDefines:\nGRID_OPTIMIZATION (set or !set)\nGRID_DEBUG (set or !set)\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\n--\x3e\n\x3csnippet name\x3d"vsHighlightApply"\x3e\x3c![CDATA[\n\n  $vsprecisionf\n\n  attribute vec2 $position;\n  varying vec2 uv;\n\n  #ifdef GRID_OPTIMIZATION\n    attribute vec2 $uv0;\n    uniform sampler2D coverageTex;\n  #endif\n\n  void main()\n  {\n    #ifdef GRID_OPTIMIZATION\n      #ifdef GRID_DEBUG\n        vec4 cov \x3d texture2D(coverageTex, $uv0);\n        // if no highlight pixel set in this block,\n        // or all pixels set, hide block\n        if (cov.r \x3d\x3d 0.0 || cov.g \x3d\x3d 1.0 || cov.b \x3d\x3d 1.0) {\n          gl_Position \x3d vec4(0,0,0,0);\n          return;\n        }\n        gl_Position \x3d vec4($position, .0, 1.0);\n        uv \x3d $uv0;\n        return;\n      #else\n        vec4 cov \x3d texture2D(coverageTex, $uv0);\n        // if no highlight pixel set in this block, hide block\n        if (cov.r \x3d\x3d 0.0) {\n          gl_Position \x3d vec4(0,0,0,0);\n          return;\n        }\n      #endif\n    #endif\n\n    gl_Position \x3d vec4($position, .0, 1.0);\n    uv \x3d $position.xy * .5 + vec2(.5);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsHighlightApply"\x3e\x3c![CDATA[\n\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  uniform sampler2D origin;\n\n  uniform vec4 color;\n  uniform float outlineSize;\n  uniform float blurSize;\n  uniform vec4 opacities; // [outline, outlineOccluded, fill, fillOccluded]\n\n  varying vec2 uv;\n\n  void main()\n  {\n    #if defined(GRID_OPTIMIZATION) \x26\x26 defined(GRID_DEBUG)\n      gl_FragColor \x3d vec4(uv, 0, 1.0);\n    #else\n      // Read the highlight intensity from the blurred highlight image\n      vec4 blurredHighlightValue \x3d texture2D(tex, uv);\n      float highlightIntensity \x3d blurredHighlightValue.a;\n\n      // Discard all pixels which are not affected by highlight\n      if (highlightIntensity \x3d\x3d 0.0) {\n        discard;\n      }\n\n      vec4 origin_color \x3d texture2D(origin, uv);\n\n      float outlineIntensity;\n      float fillIntensity;\n\n      // if occluded\n      if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\n        outlineIntensity \x3d color.w * opacities[1];\n        fillIntensity \x3d color.w * opacities[3];\n      }\n      // if unoccluded\n      else {\n        outlineIntensity \x3d color.w * opacities[0];\n        fillIntensity \x3d color.w * opacities[2];\n      }\n\n      float inner \x3d 1.0 - outlineSize / 9.0;\n      float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\n\n      float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\n      //float fillFactor \x3d smoothstep(0.6, 0.72, highlightIntensity);\n      float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\n      float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\n\n      // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n      // I.e., color should not be premultiplied with alpha\n      gl_FragColor \x3d vec4(color.xyz, intensity);\n    #endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/internal/occluded.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vsRenderOccludedApply"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $position;\n  varying vec2 uv;\n\n  void main(void) {\n    gl_Position \x3d vec4($position, 0.0, 1.0);\n    uv \x3d $position.xy * 0.5 + vec2(0.5);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsRenderOccludedApply"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D occludedColorMap;\n\n  varying vec2 uv;\n\n  void main() {\n    vec4 occludedColor \x3d texture2D(occludedColorMap, uv);\n    gl_FragColor \x3d occludedColor * vec4(1.0, 1.0, 1.0, 0.4);\n  }\n\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/internal/util.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"alignToPixelCenter"\x3e\x3c![CDATA[\n  vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n    // From clip space to (0 : 1), bias towards right pixel edge\n    vec2 xy \x3d vec2(.500123) + .5 * clipCoord.xy / clipCoord.w;\n\n    // Size of a pixel in range (0 : 1)\n    vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n\n    // Round to nearest pixel center\n    vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n\n    // Convert back to clip space\n    vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n\n    return vec4(result, clipCoord.zw);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"alignToPixelOrigin"\x3e\x3c![CDATA[\n  vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n    // From clip space to (0 : 1),\n    vec2 xy \x3d vec2(.5) + .5 * clipCoord.xy / clipCoord.w;\n\n    // Size of a pixel in range (0 : 1)\n    vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n\n    // Round to nearest pixel border, (0 : 1)\n    vec2 ij \x3d floor((xy + .5 * pixelSz) * widthHeight) * pixelSz;\n\n    // Convert back to clip space\n    vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n\n    return vec4(result, clipCoord.zw);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"float2rgba"\x3e\x3c![CDATA[\n\tvec4 float2rgba(const in float v) {\n\t\tvec4 enc \x3d vec4(1.0, 255.0, 65025.0, 16581375.0) * v;\n\t\tenc \x3d fract(enc);\n\t\tenc -\x3d enc.yzww * vec4(1.0/255.0, 1.0/255.0, 1.0/255.0, 0.0);\n\t\treturn enc;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"rgba2float"\x3e\x3c![CDATA[\n\tfloat rgba2float(vec4 rgba) {\n\t\treturn dot(rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0));\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"calcFragDepth"\x3e\x3c![CDATA[\n\t#extension GL_OES_standard_derivatives : enable\n\n\tfloat calcFragDepth(const in float depth) {\n\t\t//calc polygon offset\n\t\tconst float SLOPE_SCALE \x3d 2.0;\n\t\tconst float BIAS \x3d 2.0 * .000015259;\t\t// 1 / (2^16 - 1)\n\t\tfloat m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\n\t\tfloat result \x3d depth + SLOPE_SCALE * m + BIAS;\n\t\treturn clamp(result, .0, .999999);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"evalShadow"\x3e\x3c![CDATA[\n\t$rgba2float\n\n\t// "matrix" parameter used to have const qualifier as well, but IE11 couldn\'t deal with it at time of writing.\n\t// once IE11 is fine with it, const should probably be re-introduced\n\tfloat evalShadow(const in vec3 vpos, const in float depth, const in sampler2D depthTex, const int num, const in vec4 distance, in mat4 matrix[4], const in float halfPxSz) {\n\t\t//choose correct cascade\n\t\tint i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\n\n\t\tif (i \x3e\x3d num) return .0;\n\n\t\tmat4 mat \x3d i \x3d\x3d 0 ? matrix[0] : i \x3d\x3d 1 ? matrix[1] : i \x3d\x3d 2 ? matrix[2] : matrix[3];\n\n\t\tvec4 lv \x3d mat * vec4(vpos, 1.0);\n\t\tlv.xy /\x3d lv.w;\n\n\t\t//vertex completely outside? -\x3e no shadow\n\t\tvec3 lvpos \x3d .5 * lv.xyz + vec3(.5);\n\t\tif (lvpos.z \x3e\x3d 1.0) return .0;\n\t\tif (lvpos.x \x3c .0 || lvpos.x \x3e 1.0 || lvpos.y \x3c .0 || lvpos.y \x3e 1.0) return .0;\n\n\t\t//calc coord in cascade texture\n\t\tvec2 uv \x3d vec2(float(i - 2 * (i / 2)) *.5, float(i / 2) * .5) + .5 * lvpos.xy;\n\n\t\tfloat texSize \x3d .5 / halfPxSz;\n\n\t\t//filter, offset by half pixels\n\t\tvec2 st \x3d fract((vec2(halfPxSz) + uv) * texSize);\n\n\t\tfloat s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\n\t\tfloat s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\n\t\tfloat s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\n\t\tfloat s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\n\n\t\treturn mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\n\x3c!--\n\tScene Lighting Definitions:\n\t\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\n\n\tdefines:\n\t\t- SH_ORDER: 1|2|3\n\tinput:\n\t\t- normal: vec3\n\t\t- albedo: vec3\n\t  - shadow: float\n\t\t- ssao: float\n\treturn:\n\t  - color: vec3\n--\x3e\n\x3csnippet name\x3d"sceneLightingDefinitions"\x3e\x3c![CDATA[\n\t$viewingMode\n\n\t// main light\n\t/////////////////////////////////////////\n\tuniform vec3 lightingMainDirection;\n\tuniform vec3 lightingMainIntensity;\n\n\t// ambient lighting\n\t/////////////////////////////////////////\n\t#ifndef SH_ORDER\n\t\t#define SH_ORDER 2\n\t#endif\n\n\t#if SH_ORDER \x3d\x3d 0\n\t\tuniform vec3 lightingAmbientSH0;\n\t#elif SH_ORDER \x3d\x3d 1\n\t\tuniform vec4 lightingAmbientSH_R;\n\t\tuniform vec4 lightingAmbientSH_G;\n\t\tuniform vec4 lightingAmbientSH_B;\n\t#elif SH_ORDER \x3d\x3d 2\n\t\tuniform vec3 lightingAmbientSH0;\n\t\tuniform vec4 lightingAmbientSH_R1;\n\t\tuniform vec4 lightingAmbientSH_G1;\n\t\tuniform vec4 lightingAmbientSH_B1;\n\t\tuniform vec4 lightingAmbientSH_R2;\n\t\tuniform vec4 lightingAmbientSH_G2;\n\t\tuniform vec4 lightingAmbientSH_B2;\n\t#endif\n\n\t// special tweaking\n\t//////////////////////////////////////////\n\t\tuniform float lightingFixedFactor;\n\t\tuniform float lightingGlobalFactor;\n\n\t\tuniform float ambientBoostFactor;\n\n\t// evaluation\n\t//////////////////////////////////////////\n\n\tvec3 evaluateSceneLighting(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n\t\t// evaluate the main light\n\t\tfloat dotVal \x3d mix(clamp(-dot(normal, lightingMainDirection), 0.0, 1.0), 1.0, lightingFixedFactor);\n\t\tvec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\n\n\t\t// evaluate the sh ambient light\n\t\t#if SH_ORDER \x3d\x3d 0\n\t\t\tvec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n\t\t#elif SH_ORDER \x3d\x3d 1\n\t\t\tvec4 sh0 \x3d vec4(\n\t\t\t\t0.282095,\n\t\t\t\t0.488603 * normal.x,\n\t\t\t\t0.488603 * normal.z,\n\t\t\t\t0.488603 * normal.y\n\t\t\t);\n\t\t\tvec3 ambientLight \x3d vec3(\n\t\t\t\tdot(lightingAmbientSH_R, sh0),\n\t\t\t\tdot(lightingAmbientSH_G, sh0),\n\t\t\t\tdot(lightingAmbientSH_B, sh0)\n\t\t\t);\n\t\t#elif SH_ORDER \x3d\x3d 2\n\t\t\tvec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n\n\t\t\tvec4 sh1 \x3d vec4(\n\t\t\t\t0.488603 * normal.x,\n\t\t\t\t0.488603 * normal.z,\n\t\t\t\t0.488603 * normal.y,\n\t\t\t\t1.092548 * normal.x * normal.y\n\t\t\t);\n\t\t\tvec4 sh2 \x3d vec4(\n\t\t\t\t1.092548 * normal.y * normal.z,\n\t\t\t\t0.315392 * (3.0 * normal.z * normal.z - 1.0),\n\t\t\t\t1.092548 * normal.x * normal.z,\n\t\t\t\t0.546274 * (normal.x * normal.x - normal.y * normal.y)\n\t\t\t);\n\t\t\tambientLight +\x3d vec3(\n\t\t\t\tdot(lightingAmbientSH_R1, sh1),\n\t\t\t\tdot(lightingAmbientSH_G1, sh1),\n\t\t\t\tdot(lightingAmbientSH_B1, sh1)\n\t\t\t);\n\t\t\tambientLight +\x3d vec3(\n\t\t\t\tdot(lightingAmbientSH_R2, sh2),\n\t\t\t\tdot(lightingAmbientSH_G2, sh2),\n\t\t\t\tdot(lightingAmbientSH_B2, sh2)\n\t\t\t);\n\t\t#endif\n\t\tambientLight *\x3d (1.0 - ssao);\n\n\t\t// inverse gamma correction on the albedo color\n\t\tfloat gamma \x3d 2.1;\n\t\tvec3 albedoGammaC \x3d pow(albedo, vec3(gamma));\n\n\t\t// physically correct BRDF normalizes by PI\n\t\tconst float PI \x3d 3.14159;\n\t\tvec3 totalLight \x3d mainLight + ambientLight + additionalLight;\n\t\ttotalLight \x3d min(totalLight, vec3(PI, PI, PI));\n\t\tvec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\n\n\t\t// apply gamma correction to the computed color\n\t\toutColor \x3d pow(outColor, vec3(1.0/gamma));\n\n\t\treturn outColor;\n\t}\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"sceneLightingAdditionalLightGlobal"\x3e\x3c![CDATA[\n\t// heuristic lighting model originally used in the terrain shading\n\t// now used to generated additional ambient light\n\t#ifdef VIEWING_MODE_GLOBAL\n\t\tfloat vndl \x3d -dot(normalize(vpos + localOrigin), lightingMainDirection);\n\t#else\n\t\tfloat vndl \x3d -dot(vec3(0,0,1), lightingMainDirection);\n\t#endif\n\tfloat additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\n\tvec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"normal2envTC"\x3e\x3c![CDATA[\n\tvec2 normal2envTC(vec3 normal) {\n\t\tfloat v \x3d .5 + .5 * asin(normal.y) * 0.63661977;\n\t\tfloat u \x3d .5 - .5 * atan(normal.z, normal.x) * 0.31830988;\n\t\treturn vec2(u, v);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vertexShaderShowDepth"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tuniform mat4 proj;\n\tattribute vec2 $position;\n\tattribute vec2 $uv0;\n\tvarying vec2 vtc;\n\n\tvoid main(void) {\n\t\tgl_Position \x3d proj * vec4($position.x, $position.y, .0, 1.0);\n\t\tvtc \x3d $uv0;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\t\x3csnippet name\x3d"fragmentShaderShowDepth"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform sampler2D depthTex;\n\tvarying vec2 vtc;\n\t$rgba2float\n\tvoid main() {\n\t//\tgl_FragColor \x3d vec4(vec3(texture2D(depthTex, vtc).a), 1.0);\n\t\tgl_FragColor \x3d vec4(rgba2float(texture2D(depthTex, vtc)));\n\t//\tgl_FragColor \x3d texture2D(depthTex, vtc);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsUVQuad"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tattribute vec2 $position;\n\tvarying vec2 uv;\n\n\tvoid main(void) {\n\t\tgl_Position \x3d vec4($position.x, $position.y, .0, 1.0);\n\t\tuv \x3d $position * .5 + vec2(.5);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"toScreenCoords"\x3e\x3c![CDATA[\n\tvec4 toScreenCoords(vec3 vertex) {\n\t\tvec4 vClipSpace \x3d proj * view * vec4((model * vec4(vertex, 1.0)).xyz, 1.0);\n\t\tvClipSpace.xy *\x3d screenSize;\n\t\treturn vClipSpace/abs(vClipSpace.w);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vvUniforms"\x3e\x3c![CDATA[\n#if defined(VV_SIZE)\n\t#define VV_CUSTOM_MODEL_MATRIX\n#endif\n\n#if defined(VV_SIZE)\n\tuniform vec3 vvSizeMinSize;\n\tuniform vec3 vvSizeMaxSize;\n\tuniform vec3 vvSizeOffset;\n\tuniform vec3 vvSizeFactor;\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\n\tuniform vec3 vvSizeValue;\n#endif\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n\tuniform mat3 vvSymbolRotation;\n#endif\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n\tuniform vec3 vvSymbolAnchor;\n#endif\n\n#ifdef VV_COLOR\n\t#define VV_COLOR_N 8\n\tuniform float vvColorValues[VV_COLOR_N];\n\tuniform vec4 vvColorColors[VV_COLOR_N];\n#endif\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vvFunctions"\x3e\x3c![CDATA[\n// Evaluation of size\n#if defined(VV_SIZE)\n\tvec3 vvGetScale(vec4 featureAttribute) {\n\t\treturn clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n\t}\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\n\tvec3 vvGetScale(vec4 featureAttribute) {\n\t\treturn vvSizeValue;\n\t}\n#endif\n\n// Applying the model matrix\n#ifdef VV_CUSTOM_MODEL_MATRIX\n\tvec4 vvTransformPosition(vec3 position, vec4 featureAttribute) {\n\t\treturn vec4(vvSymbolRotation * (vvGetScale(featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n\t}\n\n\tvec4 vvTransformNormal(vec3 normal, vec4 featureAttribute) {\n\t\t// Normal transform is the inverse transpose of model transform\n\t\treturn vec4(vvSymbolRotation * normal / vvGetScale(featureAttribute), 1.0);\n\t}\n#endif\n\n#ifdef VV_COLOR\n\tvec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n\t\tfloat value \x3d featureAttribute.y;\n\t\tif (value \x3c\x3d values[0]) {\n\t\t\treturn colors[0];\n\t\t}\n\n\t\tfor (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n\t\t\tif (values[i] \x3e\x3d value) {\n\t\t\t\tfloat f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\n\t\t\t\treturn mix(colors[i-1], colors[i], f);\n\t\t\t}\n\t\t}\n\n\t\treturn colors[VV_COLOR_N - 1];\n\t}\n#endif\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"rgb2hsv"\x3e\x3c![CDATA[\nvec3 rgb2hsv(vec3 c)\n{\n\tvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\tvec4 p \x3d mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n\tvec4 q \x3d mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n\tfloat d \x3d q.x - min(q.w, q.y);\n\tfloat e \x3d 1.0e-10;\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"hsv2rgb"\x3e\x3c![CDATA[\nvec3 hsv2rgb(vec3 c)\n{\n\tvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\tvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"colorMixMode"\x3e\x3c![CDATA[\n$rgb2hsv\n$hsv2rgb\n\n\n/*\n * The color mix modes are encoded in the symbol color as follows:\n *  - Fully transparent symbols are represented with alpha 0 for\n *    all color mix modes (except ignore).\n *  - color mix mode ignore is encoded as multiply with white\n *  - the other 3 color mix modes (tint, replace, multiply) are\n *    equally distributed on the remaining 255 alpha values, which\n *    gives us 85 possible alpha values\n *\n * alpha             0 : fully transparent\n * alpha in [  1 -  85]: tint\n * alpha in [ 86 - 170]: replace\n * alpha in [171 - 255]: multiply\n */\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n  float symbolAlpha \x3d 0.0;\n\n  const float maxTint \x3d 85.0;\n  const float maxReplace \x3d 170.0;\n  const float scaleAlpha \x3d 3.0;\n\n  if (symbolColor.a \x3d\x3d 0.0) {\n    colorMixMode \x3d 1; // fully transparent -\x3e multiply\n    symbolAlpha \x3d 0.0;\n  }\n  else if (symbolColor.a \x3c\x3d maxTint) {\n    colorMixMode \x3d 0; // tint\n    symbolAlpha \x3d scaleAlpha * symbolColor.a;\n  }\n  else if (symbolColor.a \x3c\x3d maxReplace) {\n    colorMixMode \x3d 3; // replace\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\n  }\n  else {\n    colorMixMode \x3d 1;  // multiply\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\n  }\n\n  return vec4(symbolColor.rgb, symbolAlpha);\n}\n\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n\n  // workaround for artifacts in OSX using Intel Iris Pro\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n  vec3 internalMixed \x3d internalColor * textureColor;\n  vec3 allMixed \x3d internalMixed * externalColor;\n\n  if (mode \x3d\x3d 1 /* multiply */) {\n    return allMixed;\n  }\n  else if (mode \x3d\x3d 2 /* ignore */ ) {\n    return internalMixed;\n  }\n  else if (mode \x3d\x3d 3 /* replace */ ) {\n    return externalColor;\n  }\n  else {\n    // tint (or something invalid)\n    vec3 hsvIn \x3d rgb2hsv(internalMixed);\n    vec3 hsvTint \x3d rgb2hsv(externalColor);\n    vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\n    return hsv2rgb(hsvOut);\n  }\n}\n\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n\n  // workaround for artifacts in OSX using Intel Iris Pro\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n  float internalMixed \x3d internalOpacity * textureOpacity;\n  float allMixed \x3d internalMixed * externalOpacity;\n\n  if (mode \x3d\x3d 2 /* ignore */ ) {\n    return internalMixed;\n  }\n  else if (mode \x3d\x3d 3 /* replace */ ) {\n    return externalOpacity;\n  }\n  else {\n    // multiply or tint (or something invalid)\n    return allMixed;\n  }\n}\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"highlightWrite"\x3e\x3c![CDATA[\n  // the following uniforms are common to all highlight shaders:\n  // uniform sampler2D depthTex\n  // uniform vec4 highlightViewportPixelSz\n  float sceneDepth \x3d texture2D(depthTex, (gl_FragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n  if (gl_FragCoord.z \x3e sceneDepth + 5e-6) {\n    gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n  }\n  else {\n    gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"screenSizePerspective"\x3e\x3c![CDATA[\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n// Note that the implementation here should be kept in sync with the corresponding\n// CPU implementation (used for hitTest etc) in screenSizePerspectiveUtils.ts\n\n/**\n * Compute the screen size perspective lower bound from pre-computed screen\n * size perspective factors (or parameters, since both store the pixel lower\n * bound information in the same place). When computing the minimum size,\n * the padding (e.g. text halo) is scaled with the same factor as the\n * original size scales to reach the minimum size.\n *\n * {\n *    x: N/A\n *    y: N/A\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nfloat screenSizePerspectiveMinSize(float size, vec4 factor) {\n\n  // Original calculation:\n  //   padding \x3d 2 * factor.w\n  //   minSize \x3d factor.z\n  //\n  //   minSize + minSize / size * padding\n  //\n  // Incorporates padding (factor.w, e.g. text halo size) into the\n  // minimum bounds calculation, taking into account that padding\n  // would scale down proportionally to the size.\n  //\n  // Calculation below is the same, but avoids division by zero when\n  // size would be zero, without branching using step.\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10683\n\n  // nonZeroSize is 1 if size \x3e 0, and 0 otherwise\n  float nonZeroSize \x3d 1.0 - step(size, 0.0);\n\n  return (\n    factor.z * (\n      1.0 +\n      nonZeroSize *                // Multiply by nzs ensures if size is 0, then we ignore\n                                   // proportionally scaled padding\n      2.0 * factor.w / (\n        size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n      )\n    )\n  );\n}\n\n/**\n * Computes the view angle dependent screen size perspective factor. The goal\n * of this factor is that:\n *\n *   1. There is no perspective when looking top-down\n *   2. There is a smooth and quick transition to full perspective when\n *      tilting.\n */\nfloat screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n  return absCosAngle * absCosAngle * absCosAngle;\n}\n\n/**\n * Precomputes a set of factors that can be used to apply screen size perspective\n * The factors are based on the viewing angle, distance to camera and the screen size\n * perspective parameters:\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n *\n * The result is a set of factors that can be used to apply the perspective:\n *\n * {\n *    x: distance based relative scale factor (0 -\x3e 1)\n *    y: view dependent scale factor\n *    z: minPixelSize (abs)\n *    w: sizePaddingInPixels (abs)\n * }\n */\nvec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n  return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\n}\n\n/**\n * Applies screen size perspective factors to a single dimension size, given the viewing angle,\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\n * perspective parameters using screenSizePerspectiveScaleFactorFloat.\n *\n * Note that for single scale application, the screenSizePerspectiveScaleFloat can be used, which\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorFloat.\n */\n\nfloat applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n  return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n}\n\n/**\n * Applies screen size perspective parameters to a single dimension size, given the viewing angle,\n * distance to camera and perspective parameters\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nfloat screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n  return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}\n\n/**\n * Applies screen size perspective factors to a vec2 size (width/height), given the viewing angle,\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\n * perspective parameters using screenSizePerspectiveScaleFactorVec2.\n *\n * Note that for single scale application, the screenSizePerspectiveScaleVec2 can be used, which\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorVec2.\n */\nvec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n  return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n}\n\n/**\n * Applies screen size perspective parameters to a vec2 size (width/height), given the viewing angle,\n * distance to camera and perspective parameters\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nvec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n  return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}\n\n#endif\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"computeNormal"\x3e\x3c![CDATA[\n\t#ifdef GROUND_NORMAL_SHADING\n\t\t#ifdef VIEWING_MODE_GLOBAL\n\t\t\tvec3 normal \x3d normalize(vpos + localOrigin);\n\t\t#else\n\t\t\tvec3 normal \x3d vec3(0,0,1);\n\t\t#endif\n\t#else\n\t\t\t// compute normal\n\t\t#ifndef DOUBLESIDED\n\t\t\t\tvec3 normal \x3d vnormal;\n\t\t#else\n\t\t\t\tvec3 normal \x3d dot(vnormal, viewDir)\x3e0.0 ? -vnormal : vnormal;\n\t\t#endif\n\t\tnormal \x3d normalize(normal);\n\t#endif\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/internal/hud.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"commonAttributesAndUniformsHUD"\x3e\x3c![CDATA[\n  attribute vec3 $position;\n  attribute vec3 $normal;\n  attribute vec4 $auxpos1;\n\n  uniform mat4 proj;\n\n  uniform mat4 view;\n  uniform mat4 viewNormal;\n\n  uniform mat4 model;\n  uniform mat4 modelNormal;\n\n  uniform vec4 viewport;\n\n  uniform vec3 camPos;\n\n  uniform float polygonOffset;\n  uniform float cameraGroundRelative;\n\n#ifdef VERTICAL_OFFSET\n\n  // [ screenLength, distanceFactor, minWorldLength, maxWorldLength ]\n  uniform vec4 verticalOffset;\n\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n  // [ divisor, offset, minPixelSize, paddingPixels ]\n  uniform vec4 screenSizePerspectiveAlignment;\n\n#endif\n\n  uniform sampler2D hudVisibilityTexture;\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"projectPositionHUD"\x3e\x3c![CDATA[\n  $screenSizePerspective\n\n  // Corresponds to cos(10 deg), used to compare against dot product of two vectors\n  const float SMALL_OFFSET_ANGLE \x3d 0.984807753012208;\n\n  struct ProjectHUDAux {\n    vec3 posModel;\n    vec3 posView;\n    vec3 vnormal;\n\n    float distanceToCamera;\n    float absCosAngle;\n  };\n\n\n  /**\n   * Apply the simulated polygon offset for HUD objects that improves\n   * issues with Z-fighting.\n   *\n   * @param posView {vec3} (inout) the position in view space. Will be modified in place.\n   * @param pointGroundDistance {float} the distance from the point geometry to the ground surface.\n   * @param absCosAngle {float} the absolute cosine of the angle between the world-up at the point geometry\n   *   and the view direction.\n   *\n   * Dependencies:\n   *\n   *   Attributes:\n   *     - auxpos1: contains centerOffset and pointGroundDistance\n   *\n   *   Uniforms:\n   *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\n   *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\n   *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\n   *         reduced flickering.\n   *     - viewport: the viewport [x, y, width, height]\n   */\n  float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n    float pointGroundSign \x3d sign(pointGroundDistance);\n\n    if (pointGroundSign \x3d\x3d 0.0) {\n      pointGroundSign \x3d 1.0;\n    }\n\n    // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n    // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n    float groundRelative \x3d cameraGroundRelative * pointGroundSign;\n\n    // view angle dependent part of polygon offset emulation\n    // we take the absolute value because the sign that is dropped is\n    // instead introduced using the ground-relative position of the symbol and the camera\n    if (polygonOffset \x3e .0) {\n      float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\n\n      float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n      float factor \x3d (1.0 - tanAlpha / viewport[2]);\n\n      // same side of the terrain\n      if (groundRelative \x3e 0.0) {\n        posView *\x3d factor;\n      }\n      // opposite sides of the terrain\n      else {\n        posView /\x3d factor;\n      }\n    }\n\n    return groundRelative;\n  }\n\n  /**\n   * Project the 3d position of a HUD object from world space to clip space. In addition\n   * to standard model view projection, it also emulates a polygon offset to\n   * help with points above/below ground and icon flickering. The resulting location\n   * is the anchor of the HUD object, i.e. the position that is used also for testing\n   * visibility of the HUD object. Note that the returned projected position is not\n   * aligned to a pixel center or border, it is up to the caller to align if necessary.\n   *\n   * Dependencies:\n   *\n   *   Attributes:\n   *     - position: contains the point world position\n   *     - normal: contains the world normal pointing up at the point\n   *     - auxpos1: contains centerOffset and pointGroundDistance\n   *\n   *   Uniforms:\n   *     - model: the object -\x3e world transformation matrix\n   *     - modelNormal: the object -\x3e world normal transformation matrix (inv transp of model)\n   *     - view: the world -\x3e view transformation matrix\n   *     - viewNormal: the world -\x3e view normal transformation matrix (inv transp of view)\n   *     - proj: the view -\x3e clip projection matrix\n   *     - verticalOffset: a vec4 containing:\n   *         - the screen height of the vertical offset\n   *         - the screen height of the vertical offset as a fraction of camera distance.\n   *         - the minimum world size vertical offset.\n   *         - the maximum world size vertical offset.\n   *       This will do a screen sized offset of the point along its normal (used for line callouts)\n   *     - screenSizePerspectiveAlignment: a vec3 containing\n   *         - the view distance dependent divisor\n   *         - the view distance dependent offset\n   *         - the minimum pixel size\n   *         - the amount of padding in pixels around the region to be scaled (not used for alignment)\n   *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\n   *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\n   *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\n   *         reduced flickering.\n   *     - camPos: the position of the camera in world space\n   *     - viewport: the viewport [x, y, width, height]\n   */\n  vec4 projectPositionHUD(out ProjectHUDAux aux) {\n    // centerOffset is in view space and is used to implement world size offsetting\n    // of labels with respect to objects. It also pulls the label towards the viewer\n    // so that the label is visible in front of the object.\n    vec3 centerOffset \x3d $auxpos1.xyz;\n\n    // The pointGroundDistance is the distance of the geometry to the ground and is\n    // negative if the point is below the ground, or positive if the point is above\n    // ground.\n    float pointGroundDistance \x3d $auxpos1.w;\n\n    aux.posModel \x3d (model * vec4($position, 1.0)).xyz;\n    aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\n    aux.vnormal \x3d (modelNormal * vec4($normal, 1.0)).xyz;\n\n    // Screen sized offset in world space, used for example for line callouts\n    // Note: keep this implementation in sync with the CPU implementation, see\n    //   - MaterialUtil.verticalOffsetAtDistance\n    //   - HUDMaterial.applyVerticalOffsetTransformation\n\n    aux.distanceToCamera \x3d length(aux.posView);\n\n    vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\n    float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\n\n    aux.absCosAngle \x3d abs(cosAngle);\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n#if defined(VERTICAL_OFFSET) || defined(CENTER_OFFSET_UNITS_SCREEN)\n    vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);\n#endif\n\n#endif\n\n#ifdef VERTICAL_OFFSET\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n    float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);\n#else\n    float verticalOffsetScreenHeight \x3d verticalOffset.x;\n#endif\n\n    float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n    vec3 modelOffset \x3d aux.vnormal * worldOffset;\n\n    aux.posModel +\x3d modelOffset;\n\n    vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n    aux.posView +\x3d viewOffset;\n\n    // Since we elevate the object, we need to take that into account\n    // in the distance to ground\n    pointGroundDistance +\x3d worldOffset;\n\n#endif\n\n    float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n#ifndef CENTER_OFFSET_UNITS_SCREEN\n    // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n    aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0);\n\n    // Same material all have same z !\x3d 0.0 condition so should not lead to\n    // branch fragmentation and will save a normalization if it\'s not needed\n    if (centerOffset.z !\x3d 0.0) {\n      aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\n    }\n#endif\n\n    vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\n\n#ifdef CENTER_OFFSET_UNITS_SCREEN\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n    float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);\n#else\n    float centerOffsetY \x3d centerOffset.y;\n#endif\n\n    posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * 2.0 / viewport.zw * posProj.w;\n\n#endif\n\n    // constant part of polygon offset emulation\n    posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\n\n    return posProj;\n  }\n\n  /**\n   * Test for visibility of a HUD object.\n   *\n   * Dependencies:\n   *\n   *   Uniforms:\n   *     - hudVisibilityTexture: the texture that contains the visibility information\n   *     - markerColor: the special marker color that is used to write visibility information\n   *     - viewport: the viewport\n   */\n  bool testVisibilityHUD(vec4 posProj) {\n    // For occlusion testing, use the nearest pixel center to avoid\n    // subpixel filtering messing up the color we use to test for\n    vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n\n    return texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w).r \x3e 0.0;\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/BillboardMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vertexShaderBillboard"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tuniform mat4 proj;\n\tuniform mat4 view;\n\tuniform mat4 model;\n\tuniform mat4 modelNormal;\n\tattribute vec3 $position;\n\tattribute vec3 $normal;\n\tattribute vec2 $uv0;\n\tvarying vec2 vtc;\n\tvarying vec3 vnormal;\n\tconst float size \x3d 1.05;\n\n\tvoid main(void) {\n\t\tvec3 pos \x3d (view * model * vec4($position, 1.0)).xyz;\n\t\tvec2 uv01 \x3d floor($uv0);\n\t\tvec2 uv \x3d $uv0 - uv01;\n\t\tvec3 zDir \x3d normalize(-pos);\n\t\tvec3 xDir \x3d normalize(cross(vec3(.0, 1.0, .0), zDir));\n\t\tvec3 yDir \x3d cross(zDir, xDir);\n\t\tpos +\x3d xDir * (uv01.x - .5) * size;\n\t\tpos +\x3d yDir * (uv01.y - .5) * size;\n\t\tvec4 pos4 \x3d proj * vec4(pos, 1.0);\n\t\tgl_Position \x3d pos4;\n\t\tvtc \x3d uv;\n\t\tvnormal \x3d normalize((modelNormal * vec4($normal, 1.0)).xyz);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderBillboard"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform vec4 lightAmbient;\n\tuniform vec4 lightDiffuse;\n\tuniform vec3 lightDirection;\n\tuniform sampler2D tex;\n\tvarying vec2 vtc;\n\tvarying vec3 vnormal;\n\n\tvoid main() {\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\n\t\tif (texColor.a \x3c .15) discard;\n\t\tgl_FragColor \x3d texColor;\n\t\tgl_FragColor.rgb *\x3d lightAmbient.rgb * lightAmbient.w + lightDiffuse.rgb * lightDiffuse.w * dot(lightDirection, vnormal);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vertexShaderBillboardDepth"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tuniform mat4 proj;\n\tuniform mat4 view;\n\tuniform mat4 model;\n\tuniform vec2 nearFar;\n\tattribute vec3 $position;\n\tattribute vec2 $uv0;\n\tvarying vec2 vtc;\n\tvarying float depth;\n\tconst float size \x3d 1.05;\n\n\tvoid main(void) {\n\t\tvec3 pos \x3d (view * model * vec4($position, 1.0)).xyz;\n\t\tvec2 uv01 \x3d floor($uv0);\n\t\tvec2 uv \x3d $uv0 - uv01;\n\t\tpos.x +\x3d (uv01.x - .5) * size;\n\t\tpos.y +\x3d (uv01.y - .5) * size;\n\t\tvec4 eye \x3d vec4(pos, 1.0);\n\t\tgl_Position \x3d proj * eye;\n\t\tdepth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\n\t\tvtc \x3d uv;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/ColorMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vertexShaderColorMaterial"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tuniform mat4 proj;\n\tuniform mat4 view;\n\tuniform mat4 model;\n\n\tattribute vec3 $position;\n#ifdef VERTEXCOLORS\n\tattribute vec4 $color;\n\n\tvarying vec4 vColor;\n#endif\n\n\tvoid main(void) {\n#ifdef VERTEXCOLORS\n\t\tvColor \x3d $color * 0.003921568627451; // \x3d 1/255;\n#endif\n\t\tgl_Position \x3d proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderColorMaterial"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform vec4 eColor;\n#ifdef VERTEXCOLORS\n\tvarying vec4 vColor;\n#endif\n\n\tvoid main() {\n#ifdef VERTEXCOLORS\n\t\tgl_FragColor \x3d vColor * eColor;\n#else\n\t\tgl_FragColor \x3d eColor;\n#endif\n\t}\n]]\x3e\x3c/snippet\x3e\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/LineCalloutMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vertexShaderLineCallout"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  $commonAttributesAndUniformsHUD\n\n  attribute vec2 $uv0;\n\n  uniform float lineSize;\n  uniform vec2 pixelToNDC;\n  uniform float borderSize;\n  uniform vec2 screenOffset;\n\n  varying vec4 coverageSampling;\n  varying vec2 lineSizes;\n\n  $alignToPixelOrigin\n  $alignToPixelCenter\n\n  $projectPositionHUD\n\n  void main(void) {\n    ProjectHUDAux projectAux;\n    vec4 endPoint \x3d projectPositionHUD(projectAux);\n\n#ifdef OCCL_TEST\n    if (!testVisibilityHUD(endPoint)) {\n      gl_Position \x3d vec4(1e38, 1e38, 1e38, 1);\n    }\n    else {\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n      vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n      vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n#else\n      vec2 screenOffsetScaled \x3d screenOffset;\n#endif\n\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly\n      // used to get the correct depth value\n      vec3 posView \x3d (view * model * vec4($position, 1.0)).xyz;\n      applyHUDViewDependentPolygonOffset($auxpos1.w, projectAux.absCosAngle, posView);\n\n      vec4 startPoint \x3d proj * vec4(posView, 1);\n\n      // Apply screen offset to both start and end point\n      vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\n\n      startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\n      endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\n\n      // Align start and end to pixel origin\n      vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\n      vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\n\n#ifdef DEPTH_HUD\n\n#ifdef DEPTH_HUD_ALIGN_START\n      endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);\n#else\n      startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);\n#endif\n\n#endif\n\n      vec4 projectedPosition \x3d mix(startAligned, endAligned, $uv0.y);\n\n      // The direction of the line in screen space\n      vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n      float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n      float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n\n#else\n\n      float lineSizeScaled \x3d lineSize;\n      float borderSizeScaled \x3d borderSize;\n\n#endif\n\n      float halfPixelSize \x3d lineSizeScaled * 0.5;\n\n      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\n      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\n      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\n      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\n      float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\n      float halfPixelSizeInt \x3d floor(halfWholePixelSize);\n\n      // Sub-pixel offset if we need to grow sub-pixels to the left\n      float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\n\n      // Pixel offset aligning to whole pixels and adding subpixel offset if needed\n      float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\n\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n      float padding \x3d 1.0 + borderSizeScaled;\n      vec2 ndcOffset \x3d (pixelOffset - padding + $uv0 * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n      // Offset x/y from the center of the line in screen space\n      projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n      // Compute a coverage varying which we can use in the fragment shader to determine\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n      // This works by computing two coordinates that can be linearly interpolated and then\n      // subtracted to find out how far away from the line edge we are.\n      float edgeDirection \x3d ($uv0.x * 2.0 - 1.0);\n\n      float halfBorderSize \x3d 0.5 * borderSizeScaled;\n      float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\n      float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n      float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\n\n      coverageSampling \x3d vec4(\n        // Edge coordinate\n        outerEdgeCoverageSampler,\n\n        // Border edge coordinate\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n        // Line offset\n        halfPixelSize - 0.5,\n\n        // Border offset\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n      );\n\n      lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\n\n      gl_Position \x3d projectedPosition;\n\n#ifdef OCCL_TEST\n    }\n#endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet\x3e\x3c![CDATA[\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderLineCallout"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  uniform vec4 color;\n  uniform vec4 borderColor;\n\n  varying vec4 coverageSampling;\n  varying vec2 lineSizes;\n\n  void main() {\n    // Mix between line and border coverage offsets depending on whether we need\n    // a border (based on the sidedness).\n    vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n    // Mix between border and line color based on the line coverage (conceptually the line\n    // blends on top of the border background).\n    //\n    // Anti-alias by blending final result using the full (including optional border) coverage\n    // and the color alpha\n    float borderAlpha \x3d color.a * borderColor.a * coverage.y;\n    float colorAlpha \x3d color.a * coverage.x;\n\n    float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\n\n#ifdef DEPTH_HUD\n\n    if (finalAlpha \x3c 0.01) {\n      discard;\n    }\n\n#else\n\n    // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\n    // need to divide by finalAlpha). We avoid the division here by setting the\n    // appropriate blending function in the material.\n    vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\n\n    gl_FragColor \x3d vec4(finalRgb, finalAlpha);\n\n#endif\n\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/LeafCardMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vertexShaderLeafCard"\x3e\n\t\x3c![CDATA[\n  $vsprecisionf\n\n\tuniform mat4 proj;\n\tuniform mat4 view;\n\tuniform mat4 model;\n\tuniform mat4 modelNormal;\n\n\tuniform vec3 localOrigin;\n\n\tattribute vec3 $position;\n\tattribute vec4 $normal;\n\tattribute vec4 $uv0;\n\tvarying vec2 vtc;\n\tvarying vec3 vnormal;\n\tvarying float ambientLeaf;\n\n\tuniform float trafoScale;\n\tvarying vec3 vpos;\n\n\tvec2 rotate(vec2 pos, float angle) {\n\t\tfloat c \x3d cos(angle);\n\t\tfloat s \x3d sin(angle);\n\t\treturn vec2(c * pos.x - s * pos.y, s * pos.x + c * pos.y);\n\t}\n\n\tvoid main(void) {\n\n\t\tvpos \x3d (model * vec4($position, 1.0)).xyz;\n\n\t\tvec3 pos \x3d (view * model * vec4($position, 1.0)).xyz;\n\t\tvec2 uv01 \x3d floor($uv0.xy);\n\t\tvec2 uv \x3d $uv0.xy - uv01;\n\n   \t\tvec2 up \x3d rotate(vec2(1,0), $uv0.z);\n   \t\tvec3 xDir \x3d  vec3(up.x,up.y,0.0);\n   \t\tvec3 yDir \x3d  vec3(-up.y,up.x,0.0);\n\n\t\tpos +\x3d xDir * (uv01.x - .5) * $uv0.w *trafoScale;\n\t\tpos +\x3d yDir * (uv01.y - .5) * $uv0.w *trafoScale;;\n\t\tvec4 pos4 \x3d proj * vec4(pos, 1.0);\n\t\tgl_Position \x3d pos4;\n\t\tvtc \x3d uv;\n\t\tambientLeaf \x3d normal.w;\n\t\tvnormal \x3d normalize((modelNormal * vec4($normal.xyz, 1.0)).xyz);\n\t}\n]]\x3e\n\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderLeafCard"\x3e\n\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform vec3 camPos;\n\n\tuniform vec3 diffuse;\n\n\tuniform vec3 localOrigin;\n\n\tuniform sampler2D tex;\n\tvarying vec2 vtc;\n\tvarying vec3 vnormal;\n\tvarying float ambientLeaf;\n\n\tvarying vec3 vpos;\n\n\t$sceneLightingDefinitions\n\n\tvoid main() {\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\n\t\tif (texColor.a \x3c .33) discard;\n\n\t\tvec3 normal \x3d normalize(vnormal);\n\t\tvec3 albedo \x3d diffuse * ambientLeaf * texColor.rgb;\n\n\t\tfloat ssao \x3d 1.0;\n\n\t\t$sceneLightingAdditionalLightGlobal\n\n\t\tvec3 color \x3d evaluateSceneLighting(normal, albedo, 1.0, 1.0 - ssao, additionalLight);\n\n\t\tgl_FragColor \x3d vec4(color, texColor.a);\n\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\n\x3csnippet name\x3d"vertexShaderLeafCardDepth"\x3e\x3c![CDATA[\n    $vsprecisionf\n\n   \tuniform mat4 proj;\n   \tuniform mat4 view;\n   \tuniform mat4 model;\n   \tuniform vec2 nearFar;\n\n   \tattribute vec3 $position;\n   \tattribute vec4 $uv0;\n\n   \tuniform float trafoScale;\n\n   \tvarying vec2 vtc;\n   \tvarying float depth;\n\n   \tvec2 rotate(vec2 pos, float angle) {\n   \t\tfloat c \x3d cos(angle);\n   \t\tfloat s \x3d sin(angle);\n   \t\treturn vec2(c * pos.x - s * pos.y, s * pos.x + c * pos.y);\n   \t}\n\n   \tvoid main(void) {\n   \t\tvec3 pos \x3d (view * model * vec4($position, 1.0)).xyz;\n   \t\tvec2 uv01 \x3d floor($uv0.xy);\n   \t\tvec2 uv \x3d $uv0.xy - uv01;\n\n   \t\tvec2 up \x3d rotate(vec2(1,0), $uv0.z);\n   \t\tvec3 xDir \x3d  vec3(up.x,up.y,0.0);\n   \t\tvec3 yDir \x3d  vec3(-up.y,up.x,0.0);\n\n   \t\tpos +\x3d xDir * (uv01.x - .5) * $uv0.w*trafoScale;\n   \t\tpos +\x3d yDir * (uv01.y - .5) * $uv0.w*trafoScale;\n   \t\tvec4 pos4 \x3d proj * vec4(pos, 1.0);\n   \t\tgl_Position \x3d pos4;\n   \t\tvtc \x3d uv;\n\n   \t\tdepth \x3d (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\n\n   \t}\n ]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/Material.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"calculateVerticalOffset"\x3e\x3c![CDATA[\n  $viewingMode\n\n#ifdef VERTICAL_OFFSET\n  // [ verticalOffsetPerDistance, minWorldLength, maxWorldLength ]\n  uniform vec4 verticalOffset;\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n  uniform vec4 screenSizePerspectiveAlignment;\n\n  $screenSizePerspective\n\n#endif\n\n  vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n    float viewDistance \x3d length((view * vec4(worldPos, 1)).xyz);\n    float verticalOffsetOffsetDistance \x3d verticalOffset.x * viewDistance;\n\n#ifdef VIEWING_MODE_GLOBAL\n    vec3 worldNormal \x3d normalize(worldPos + localOrigin);\n#else\n    vec3 worldNormal \x3d vec3(0, 0, 1);\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n    float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\n\n    float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);\n#else\n    float verticalOffsetScreenHeight \x3d verticalOffset.x;\n#endif\n\n    // Screen sized offset in world space, used for example for line callouts\n    float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n\n    return worldNormal * worldOffset;\n  }\n#endif\n]]\x3e\n\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsPhongSrc"\x3e\x3c![CDATA[\n\tuniform mat4 proj;\n\tuniform mat4 view;\n  uniform vec3 camPos;\n\n\tuniform vec3 localOrigin;\n\n#ifdef INSTANCED\n    attribute mat4 model;\n    attribute mat4 modelNormal;\n#else\n\tuniform mat4 model;\n\tuniform mat4 modelNormal;\n#endif\n#ifdef INSTANCEDCOLOR\n\tattribute vec4 instanceColor;\n#endif\n\tattribute vec3 $position;\n\tattribute vec3 $normal;\n\tvarying vec3 vpos;\n\tvarying vec3 vnormal;\n\n#ifdef RECEIVE_SHADOWS\n\tvarying float linearDepth;\n#endif\n\n#ifdef VERTEXCOLORS\n\tattribute vec4 $color;\n#endif\n\n#ifdef SYMBOLVERTEXCOLORS\n  attribute vec4 $symbolColor;\n#endif\n\n#if defined(VV_SIZE) || defined(VV_COLOR)\n\tattribute vec4 instanceFeatureAttribute;\n#endif\n\n$vvUniforms\n\n#if defined(VERTEXCOLORS)\n\tvarying vec4 vcolor;\n#endif\n\n#if defined(INSTANCEDCOLOR) || defined(VV_COLOR) || defined(SYMBOLVERTEXCOLORS)\n\tuniform vec4 externalColor;\n\tvarying vec4 vcolorExt;\n#endif\n\n#if defined(SYMBOLVERTEXCOLORS)\n\tvarying mediump float colorMixMode; // varying int is not supported in WebGL\n#endif\n\n\t$vvFunctions\n\n\t$colorMixMode\n\n  $calculateVerticalOffset\n\n\tvoid main(void) {\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n\n\t\tvpos \x3d (model * vvTransformPosition($position, instanceFeatureAttribute)).xyz;\n\t\tvnormal \x3d normalize((modelNormal * vvTransformNormal($normal, instanceFeatureAttribute)).xyz);\n\n#ifdef VERTICAL_OFFSET\n\t\tvec3 centerPos \x3d (model * vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute)).xyz;\n#endif\n\n#else /* VV_CUSTOM_MODEL_MATRIX */\n\n\t\tvpos \x3d (model * vec4($position, 1.0)).xyz;\n\t\tvnormal \x3d normalize((modelNormal * vec4($normal, 1.0)).xyz);\n\n#ifdef VERTICAL_OFFSET\n\t\tvec3 centerPos \x3d (model * vec4(vec3(0, 0, 0), 1.0)).xyz;\n#endif\n\n#endif /* VV_CUSTOM_MODEL_MATRIX */\n\n#ifdef VERTICAL_OFFSET\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\n#endif\n\n\t\tgl_Position \x3d proj * view * vec4(vpos, 1.0);\n\n#ifdef RECEIVE_SHADOWS\n\t\t// Shadowmap\'s cascading index used to be based on \'1.0 / gl_FragCoord.w\'\n\t\t// (i.e. the perspective interpolation of \'gl_Position.w\'). Precision\n\t\t// issues on iPad/iPhone with the \'w\' component require the depth to be\n\t\t// passed as varying to properly drive the cascading shadow map index.\n\t\tlinearDepth \x3d gl_Position.w;\n#endif\n\n#ifdef VERTEXCOLORS\n\t\tvcolor \x3d $color * 0.003921568627451; // \x3d 1/255\n#endif\n\n#if defined(INSTANCEDCOLOR) || defined(VV_COLOR) || defined(SYMBOLVERTEXCOLORS)\n\t\tvcolorExt \x3d externalColor;\n#endif\n#ifdef INSTANCEDCOLOR\n\t\tvcolorExt *\x3d instanceColor;\n#endif\n#ifdef VV_COLOR\n\t\tvcolorExt *\x3d vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n#endif\n#ifdef SYMBOLVERTEXCOLORS\n    int symbolColorMixMode;\n    vcolorExt *\x3d decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\n    colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n#endif\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsPhongSrc"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n\tuniform vec3 camPos;\n\tuniform vec3 localOrigin;\n\n\t$sceneLightingDefinitions\n\n\t// material parameters\n\t//////////////////////////////////////////\n\tuniform vec3 ambient;\n\tuniform vec3 diffuse;\n\tuniform vec3 specular;\n\tuniform float shininess;\n\tuniform float opacity;\n\tuniform float layerOpacity;\n\n#ifdef SYMBOLVERTEXCOLORS\n\tvarying mediump float colorMixMode; // varying int is not supported in WebGL\n#else\n  uniform int colorMixMode;\n#endif\n\n#ifdef RECEIVE_SHADOWS\n\tuniform sampler2D depthTex;\n\tuniform int shadowMapNum;\n\tuniform vec4 shadowMapDistance;\n\tuniform mat4 shadowMapMatrix[4];\n\tuniform float depthHalfPixelSz;\n#endif\n\n#ifdef RECEIVE_SSAO\n\tuniform sampler2D ssaoTex;\n\tuniform vec4 viewportPixelSz;\n#endif\n\n\n\tvarying vec3 vpos;\n\tvarying vec3 vnormal;\n#if defined(VERTEXCOLORS)\n\tvarying vec4 vcolor;\n#endif\n#if defined(INSTANCEDCOLOR) || defined(VV_COLOR) || defined(SYMBOLVERTEXCOLORS)\n\tvarying vec4 vcolorExt;\n#else\n\tuniform vec4 externalColor;\n#endif\n\n#ifdef RECEIVE_SHADOWS\n\tvarying float linearDepth;\n\t$evalShadow\n#endif\n\n\t$colorMixMode\n\n\tvoid main() {\n\t\tvec3 viewDir \x3d normalize(vpos - camPos);\n\n\t\t$computeNormal\n\n\t\tvec3 reflDir \x3d normalize(reflect(viewDir, normal));\n\n\t\t// compute ssao\n\t\t#ifdef RECEIVE_SSAO\n\t\t\t\tfloat ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n\t\t\t\tssao \x3d viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\n\t\t#else\n\t\t\t\tfloat ssao \x3d 1.0;\n\t\t#endif\n\n\t\t// At global scale we create some additional ambient light based on the main light to simulate global illumination\n\t\t// This also defines "additionalAmbientScale" which might be used as a shadow fallback further down\n\t\t$sceneLightingAdditionalLightGlobal\n\n\t\t// compute shadowing\n\t\tfloat shadow \x3d 0.0;\n\t\t#ifdef RECEIVE_SHADOWS\n\t\t\tshadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n\t\t#elif defined(VIEWING_MODE_GLOBAL)\n\t\t\t// at global scale (and in global scenes) we fall back to this approximation\n\t\t\t// to shadow objects on the dark side of the earth\n\t\t\tshadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n\t\t#endif\n\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"externalColorMix"\x3e\x3c![CDATA[\n\tvec3 matColor \x3d max(ambient, diffuse); // combine the old material parameters into a single one\n\t#if defined(VERTEXCOLORS) \x26\x26 (defined(INSTANCEDCOLOR) || defined(VV_COLOR) || defined(SYMBOLVERTEXCOLORS))\n\t\t\t// Internal colors: varying vcolor + uniform ambient/diffuse, external colors: varying vcolorExt\n\t\t\tvec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n\t\t\tfloat opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n\t#elif defined(VERTEXCOLORS)\n\t\t\t// Internal colors: varying vcolor + uniform ambient/diffuse, external colors: uniform externalColor\n\t\t\tvec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, externalColor.rgb, int(colorMixMode));\n\t\t\tfloat opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, externalColor.a, int(colorMixMode));\n\t#elif defined(INSTANCEDCOLOR) || defined(VV_COLOR) || defined(SYMBOLVERTEXCOLORS)\n\t\t\t// Internal colors: uniform ambient/diffuse, external colors: varying vcolorExt\n\t\t\tvec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n\t\t\tfloat opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n\t#else\n\t\t\t// Internal colors: uniform ambient/diffuse, external colors: uniform externalColor\n\t\t\tvec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, externalColor.rgb, int(colorMixMode));\n\t\t\tfloat opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, externalColor.a, int(colorMixMode));\n\t#endif\n\talbedo_+\x3d 0.25 * specular; // don\'t completely ignore specular for now\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsPhong"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\t$vsPhongSrc\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsPhong"\x3e\x3c![CDATA[\n\t\t$fsprecisionf\n\n\t\t$fsPhongSrc\n\n\t\tvec4 texColor \x3d vec4(1,1,1,1);\n\t\t$externalColorMix\n\n\t\tvec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\n\t\tgl_FragColor \x3d vec4(shadedColor, opacity_);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsPhongTextured"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tattribute vec2 $uv0;\n\tvarying vec2 vtc;\n\t$vsPhongSrc\n#ifndef FLIPV\n\t\tvtc \x3d $uv0;\n#else\n\t\tvtc \x3d vec2($uv0.x, 1.0-$uv0.y);\n#endif\n\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsPhongTextured"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform sampler2D tex;\n\tvarying vec2 vtc;\n\n\t$fsPhongSrc\n\n\t\t// read texture color\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\n\t\tif (texColor.a \x3c .33) discard;\n\n\t\t$externalColorMix\n\n\t\tvec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\n\n\t\tgl_FragColor \x3d vec4(shadedColor, opacity_);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsPhongAtlasTextured"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tattribute vec4 $uv0;\n\tattribute vec4 $region;\n\tvarying vec2 vtc;\n\tvarying vec4 regionV;\n\t$vsPhongSrc\n#ifndef FLIPV\n\t\tvtc \x3d $uv0.xy;\n#else\n\t\tvtc \x3d vec2($uv0.x, 1.0-$uv0.y);\n#endif\n\t\tregionV \x3d $region/65535.0;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsPhongAtlasTextured"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform sampler2D tex;\n\tuniform vec2 texSize;\n\tvarying vec2 vtc;\n\tvarying vec4 regionV;\n\n\tfloat calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n\t\t// from:\n\t\t//   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\n\t\t//   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\n\t\t//   - http://www.linedef.com/virtual-texture-demo.html\n\t\tfloat deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\n\t\treturn max(0.5 * log2(deltaMaxSqr), 0.0);\n\t}\n\n\t$fsPhongSrc\n\n\t\tvec2 uv \x3d vtc;\n\t\tuv \x3d fract(uv);\n\t\t//[umin, vmin, umax, vmax]\n\n\t\tvec2 atlasScale \x3d regionV.zw - regionV.xy;\n\t\tuv \x3d uv.xy * atlasScale + regionV.xy;\n\n\t\tvec4 texColor;\n\t\t#ifdef GL_OES_standard_derivatives\n\t\t\t#extension GL_OES_standard_derivatives : enable\n\n\t\t\t// calculate derivative of continuous texture coordinate\n\t\t\t// to avoid mipmapping artifacts caused by manual wrapping in shader\n\t\t\tvec2 dUVdx \x3d dFdx(vtc) * atlasScale;\n\t\t\tvec2 dUVdy \x3d dFdy(vtc) * atlasScale;\n\n\t\t\t#ifdef GL_EXT_shader_texture_lod\n\t\t\t\t#extension GL_EXT_shader_texture_lod : enable\n\n\t\t\t\t// workaround for artifacts in Windows 10 using Intel HD Graphics 4000 series\n\t\t\t\t// see: https://devtopia.esri.com/Zurich-R-D-Center/arcgis-js-api-canvas3d-issues/issues/768\n\t\t\t\tconst float epsilon \x3d 1.0E-32;\n\t\t\t\tfloat zeroUVShift \x3d uv.x \x3d\x3d 0.0 \x26\x26 uv.y \x3d\x3d 0.0 ? epsilon : 0.0;\n\n\t\t\t\ttexColor \x3d texture2DGradEXT(tex, uv + zeroUVShift, dUVdx, dUVdy);\n\t\t\t#else\n\t\t\t\t// use bias to compensate for difference in automatic vs desired mipmap level\n\t\t\t\tvec2 dUVdxAuto \x3d dFdx(uv);\n\t\t\t\tvec2 dUVdyAuto \x3d dFdy(uv);\n\t\t\t\tfloat mipMapLevel \x3d calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\n\t\t\t\tfloat autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\n\t\t\t\ttexColor \x3d texture2D(tex, uv, mipMapLevel - autoMipMapLevel);\n\t\t\t#endif\n\t\t#else\n\t\t\ttexColor \x3d texture2D(tex, uv);\n\t\t#endif\n\n\t\tif (texColor.a \x3c .33) discard;\n\n\t\t$externalColorMix\n\n\t\tvec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\n\t\tgl_FragColor \x3d vec4(shadedColor, opacity_);\n\t}\n\t]]\x3e\x3c/snippet\x3e\n\n\t\x3csnippet name\x3d"fsPhongTexturedRefl"\x3e\x3c![CDATA[\n\t\t$fsprecisionf\n\n\t\tuniform sampler2D tex;\n\t\tuniform sampler2D reflTex;\n\t\tuniform float reflectivity;\n\t\tvarying vec2 vtc;\n\n\t\t$normal2envTC\n\n\t\t$fsPhongSrc\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\n\t\tif (texColor.a \x3c .33) discard;\n\t\tvec4 reflColor \x3d texture2D(reflTex, normal2envTC(reflDir));\n\n\t\t$externalColorMix\n\n\t\tvec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\n\t\tshadedColor.rgb \x3d mix(shadedColor.rgb, reflColor.rgb, reflectivity);\n\n\t\tgl_FragColor \x3d vec4(shadedColor, opacity_);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsDepthSrc"\x3e\x3c![CDATA[\n\tuniform mat4 proj;\n\tuniform mat4 view;\n  uniform vec3 camPos;\n  uniform vec3 localOrigin;\n\n#ifdef INSTANCED\n\tattribute mat4 model;\n  attribute mat4 modelNormal;\n#else\n\tuniform mat4 model;\n  uniform mat4 modelNormal;\n#endif\n\tuniform vec2 nearFar;\n\tattribute vec3 $position;\n\tvarying float depth;\n\n\t$vvUniforms\n#if defined(VV_CUSTOM_MODEL_MATRIX)\n\tattribute vec4 instanceFeatureAttribute;\n#endif\n\t$vvFunctions\n\n  $calculateVerticalOffset\n\n\tvoid main(void) {\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n\n    vec3 vpos \x3d (model * vvTransformPosition($position, instanceFeatureAttribute)).xyz;\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos \x3d (model * vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute)).xyz;\n#endif\n\n#else /* VV_CUSTOM_MODEL_MATRIX */\n\n\t\tvec3 vpos \x3d (model * vec4($position, 1.0)).xyz;\n\n#ifdef VERTICAL_OFFSET\n\t\tvec3 centerPos \x3d (model * vec4(vec3(0, 0, 0), 1.0)).xyz;\n#endif\n\n#endif /* VV_CUSTOM_MODEL_MATRIX */\n\n#ifdef VERTICAL_OFFSET\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\n#endif\n\n    vec4 eye \x3d view * vec4(vpos, 1);\n\n\t\tgl_Position \x3d proj * eye;\n\t\tdepth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsDepth"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\t$vsDepthSrc\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsDepthTextured"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tattribute vec2 $uv0;\n\tvarying vec2 vtc;\n\t$vsDepthSrc\n#ifndef FLIPV\n        vtc \x3d $uv0;\n#else\n        vtc \x3d vec2($uv0.x, 1.0-$uv0.y);\n#endif\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsNormalSrc"\x3e\x3c![CDATA[\n\tuniform mat4 proj;\n\tuniform mat4 view;\n  uniform vec3 camPos;\n  uniform vec3 localOrigin;\n\n#ifdef INSTANCED\n\tattribute mat4 model;\n\tattribute mat4 modelNormal;\n#else\n\tuniform mat4 model;\n\tuniform mat4 modelNormal;\n#endif\n\tuniform mat4 viewNormal;\n\tattribute vec3 $position;\n\tattribute vec3 $normal;\n\tvarying vec3 vnormal;\n\n\t$vvUniforms\n#if defined(VV_CUSTOM_MODEL_MATRIX)\n\tattribute vec4 instanceFeatureAttribute;\n#endif\n\t$vvFunctions\n\n  $calculateVerticalOffset\n\n\tvoid main(void) {\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n\n    vec3 vpos \x3d (model * vvTransformPosition($position, instanceFeatureAttribute)).xyz;\n\t\tvnormal \x3d normalize((viewNormal * modelNormal * vvTransformNormal($normal, instanceFeatureAttribute)).xyz);\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos \x3d (model * vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute)).xyz;\n#endif\n\n#else /* VV_CUSTOM_MODEL_MATRIX */\n\t\tvec3 vpos \x3d (model * vec4($position, 1.0)).xyz;\n\t\tvnormal \x3d normalize((viewNormal * modelNormal * vec4($normal, 1.0)).xyz);\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos \x3d (model * vec4(vec3(0, 0, 0), 1.0)).xyz;\n#endif\n\n#endif /* VV_CUSTOM_MODEL_MATRIX */\n\n#ifdef VERTICAL_OFFSET\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\n#endif\n\n    gl_Position \x3d proj * view * vec4(vpos, 1);\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsNormal"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\t$vsNormalSrc\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsNormalTextured"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tattribute vec2 $uv0;\n\tvarying vec2 vtc;\n\t$vsNormalSrc\n#ifndef FLIPV\n\t\tvtc \x3d $uv0;\n#else\n\t\tvtc \x3d vec2($uv0.x, 1.0-$uv0.y);\n#endif\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsHighlightSrc"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tuniform mat4 proj;\n\tuniform mat4 view;\n  uniform vec3 camPos;\n  uniform vec3 localOrigin;\n\n#ifdef INSTANCED\n\tattribute mat4 model;\n  attribute mat4 modelNormal;\n#else\n\tuniform mat4 model;\n  uniform mat4 modelNormal;\n#endif\n\tattribute vec3 $position;\n\n\t$vvUniforms\n#if defined(VV_CUSTOM_MODEL_MATRIX)\n\tattribute vec4 instanceFeatureAttribute;\n#endif\n\t$vvFunctions\n\n  $calculateVerticalOffset\n\n\tvoid main(void) {\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n\n    vec3 vpos \x3d (model * vvTransformPosition($position, instanceFeatureAttribute)).xyz;\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos \x3d (model * vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute)).xyz;\n#endif\n\n#else /* VV_CUSTOM_MODEL_MATRIX */\n\n    vec3 vpos \x3d (model * vec4($position, 1.0)).xyz;\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos \x3d (model * vec4(vec3(0, 0, 0), 1.0)).xyz;\n#endif\n\n#endif /* VV_CUSTOM_MODEL_MATRIX */\n\n#ifdef VERTICAL_OFFSET\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\n#endif\n\n\t\tgl_Position \x3d proj * view * vec4(vpos, 1);\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsHighlight"\x3e\x3c![CDATA[\n\t$vsHighlightSrc\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsHighlightTextured"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tattribute vec2 $uv0;\n\tvarying vec2 vtc;\n\t$vsHighlightSrc\n#ifndef FLIPV\n\t\tvtc \x3d $uv0;\n#else\n\t\tvtc \x3d vec2($uv0.x, 1.0-$uv0.y);\n#endif\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsDepthSrc"\x3e\x3c![CDATA[\n  $fsprecisionf\n\tvarying float depth;\n\n\tvoid main() {\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsDepth"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\t$calcFragDepth\n\t$float2rgba\n\t$fsDepthSrc\n#ifndef BIAS_SHADOWMAP\n\t\tgl_FragColor \x3d float2rgba(depth);\n#else\n\t\tgl_FragColor \x3d float2rgba(calcFragDepth(depth));\n#endif\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsDepthTextured"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform sampler2D tex;\n\tvarying vec2 vtc;\n\t$calcFragDepth\n\t$float2rgba\n\n\t$fsDepthSrc\n\t\tif (texture2D(tex, vtc).a \x3c .33) discard;\n#ifndef BIAS_SHADOWMAP\n\t\tgl_FragColor \x3d float2rgba(depth);\n#else\n\t\tgl_FragColor \x3d float2rgba(calcFragDepth(depth));\n#endif\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsNormal"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tvarying vec3 vnormal;\n\tvoid main() {\n\t\tvec3 normal \x3d normalize(vnormal);\n\t\tif (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\n\n#ifndef ALPHA_ZERO\n\t\tgl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\n#else\n\t\tgl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\n#endif\n\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsNormalTextured"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tvarying vec3 vnormal;\n\tvarying vec2 vtc;\n\tuniform sampler2D tex;\n\tvoid main() {\n\t\tif (texture2D(tex, vtc).a \x3c .33) discard;\n\t\tvec3 normal \x3d normalize(vnormal);\n\t\tif (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\n#ifndef ALPHA_ZERO\n\t\tgl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\n#else\n\t\tgl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\n#endif\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsHighlight"\x3e\x3c![CDATA[\n\t$fsprecisionf\n  uniform sampler2D depthTex;\n  uniform vec4 highlightViewportPixelSz;\n\n\tvoid main() {\n\t\t$highlightWrite\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsHighlightTextured"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tvarying vec2 vtc;\n\tuniform sampler2D tex;\n  uniform sampler2D depthTex;\n  uniform vec4 highlightViewportPixelSz;\n\n\tvoid main() {\n\t\tif (texture2D(tex, vtc).a \x3c .33) discard;\n\n\t\t$highlightWrite\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/RibbonLineMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vsRibbonLine"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tuniform mat4 proj;\n\tuniform mat4 view;\n\tuniform mat4 model;\n\n\tuniform float extLineWidth;\n\tuniform float nearPlane;\n\n\tattribute vec3 $position;\n\tattribute vec2 $uv0;\n\tvarying vec2 vtc;\n\n\tattribute vec4 $color;\n\tvarying vec4 vColor;\n\n\tattribute float size;\n\n#ifndef WALL\n\tuniform float miterLimit;\n\tattribute vec3 $auxpos1;\n\tattribute vec3 $auxpos2;\n#endif\n\n#ifdef SCREENSCALE\n\tuniform vec2 screenSize;\n\t$toScreenCoords\n#define VECTYPE vec2\n#define ZEROVEC vec2(0.0, 0.0)\n#define PERPENDICULAR(v) vec2(v.y, -v.x);\n#define ISOUTSIDE (left.x * right.y - left.y * right.x)*$uv0.y \x3e 0.0\n\n#else //ifdef SCREENSCALE\n\n#define VECTYPE vec3\n#define ZEROVEC vec3(0.0, 0.0, 0.0)\n// these macros are only valid for "strip" type lines:\n#define PERPENDICULAR(v) cross(up/*vec3(0.0, 1.0, 0.0)*/, v)\n#define ISOUTSIDE dot(cross(left, right), up/*vec3(0.0, 1.0, 0.0)*/)*$uv0.y \x3c 0.0\n\n#endif //ifdef SCREENSCALE\n\n\tfloat interp(float ncp, vec4 a, vec4 b) {\n\t\treturn (-ncp - a.z) / (b.z - a.z);\n\t}\n\n#ifdef SCREENSCALE\n\n  void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next) {\n\t\tfloat vnp \x3d nearPlane*0.99;\n\n\t\t//We have four vertices per point on the line. Start and end vertices\n\t\t//are treated differently --\x3e d \x3e 0, d \x3c 0\n\t\tfloat d \x3d abs($uv0.y) - 1.1;\n\n\t\t//current pos behind ncp --\x3e we need to clip\n\t\tif(pos.z \x3e -nearPlane) {\n\t\t\tif (d \x3c 0.0) {\n\t\t\t\t//previous in front of ncp\n\t\t\t\tif(prev.z \x3c -nearPlane) {\n\t\t\t\t\tpos \x3d mix(prev, pos, interp(vnp, prev, pos));\n\t\t\t\t\tnext \x3d pos;\n\t\t\t\t} else {\n\t\t\t\t  pos \x3d vec4(0, 0, 0, 1);\n\t\t\t  }\n\t\t\t}\n\t\t\t//next in front of ncp\n\t\t\tif(d \x3e 0.0) {\n\t\t\t\tif(next.z \x3c -nearPlane) {\n\t\t\t\t\tpos \x3d mix(pos, next, interp(vnp, pos, next));\n\t\t\t\t\tprev \x3d pos;\n\t\t\t\t} else {\n\t\t\t\t\tpos \x3d vec4(0, 0, 0, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\telse {\n\t\t\t//current position visible\n\t\t\t//previous behind ncp\n\t\t\tif (prev.z \x3e -nearPlane) {\n\t\t\t\tprev \x3d mix(pos, prev, interp(vnp, pos, prev));\n\t\t\t}\n\t\t\t//next behind ncp\n\t\t\tif (next.z \x3e -nearPlane) {\n\t\t\t\tnext \x3d mix(next, pos, interp(vnp, next, pos));\n\t\t\t}\n\t\t}\n\n\t\tpos\x3d proj * pos;\n\t\tpos.xy *\x3d screenSize;\n\t\tpos /\x3d pos.w;\n\n\t\tnext \x3d proj * next;\n\t\tnext.xy *\x3d screenSize;\n\t\tnext /\x3d next.w;\n\n\t\tprev \x3d proj * prev;\n\t\tprev.xy *\x3d screenSize;\n\t\tprev /\x3d prev.w;\n  }\n\n#endif // SCREENSCALE\n\n\tvoid main(void) {\n\n\tfloat lineWidth \x3d extLineWidth + $size;\n\n#ifdef SCREENSCALE\n\n#if 0\n\t\tvec4 pos \x3d toScreenCoords($position.xyz);\n\t\tvec2 left \x3d (pos - toScreenCoords($auxpos1)).xy;\n\t\tvec2 right \x3d (toScreenCoords($auxpos2) - pos).xy;\n#else\n\t\tvec4 pos  \x3d view * vec4((model * vec4($position.xyz, 1.0)).xyz, 1.0);\n\t\tvec4 prev \x3d view * vec4((model * vec4($auxpos1.xyz, 1.0)).xyz, 1.0);\n\t\tvec4 next \x3d view * vec4((model * vec4($auxpos2.xyz, 1.0)).xyz, 1.0);\n\n\t\tclipAndTransform(pos, prev, next);\n\n\t\tvec2 left \x3d (pos - prev).xy;\n\t\tvec2 right \x3d (next - pos).xy;\n#endif\n\n#else // ifdef SCREENSCALE\n\t\tvec4 pos \x3d vec4($position, 1.0);\n#ifndef WALL\n\t\tvec3 left \x3d $position.xyz - $auxpos1;\n\t\tvec3 right \x3d $auxpos2 - $position.xyz;\n\t\tvec3 up \x3d normalize($position.xyz);\n#endif // ifndef WALL\n#endif // ifdef SCREENSCALE\n\n#ifdef WALL\n\t\tfloat displacementLen \x3d lineWidth;\n\t\tvec3 displacementDir \x3d normalize($position.xyz);//vec3(0.0, 1.0, 0.0);\n#else // ifdef WALL\n\n\t\tfloat leftLen \x3d length(left);\n\t\tleft \x3d (leftLen \x3e 0.001) ? left/leftLen : ZEROVEC;\n\n\t\tfloat rightLen \x3d length(right);\n\t\tright \x3d (rightLen \x3e 0.001) ? right/rightLen : ZEROVEC;\n\n\t\t// determine if vertex is on the "outside or "inside" of the join\n\t\tbool isOutside \x3d ISOUTSIDE;\n\n\t\t// compute miter join position first\n\t\tfloat displacementLen \x3d lineWidth;\n\t\tVECTYPE displacementDir \x3d normalize(left + right);\n\t\tdisplacementDir \x3d PERPENDICULAR(displacementDir);\n\t\tif (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\n\t\t\tfloat nDotSeg \x3d dot(displacementDir, left);\n\t\t\tdisplacementLen /\x3d length(nDotSeg*left - displacementDir);\n\n\t\t\t// limit displacement of inner vertices\n\t\t\tif (!isOutside)\n\t\t\t\tdisplacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n\t\t}\n\n\t\tif (isOutside \x26\x26 (displacementLen \x3e miterLimit*lineWidth)) {\n\t\t\t// convert to bevel join if miterLimit is exceeded\n\t\t\tif (leftLen \x3c 0.001)\n\t\t\t    displacementDir \x3d right;\n\t\t\telse if (rightLen \x3c 0.001)\n\t\t\t\tdisplacementDir \x3d left;\n\t\t\telse\n\t\t\t\tdisplacementDir \x3d (abs($uv0.y) - 1.1 \x3c 0.0) ? left : right;\n\t\t\tdisplacementDir \x3d normalize(displacementDir);\n\t\t\tdisplacementDir \x3d PERPENDICULAR(displacementDir);\n\t\t\tdisplacementLen \x3d lineWidth;\n\t\t}\n\n#endif // ifdef WALL\n\n#ifdef SCREENSCALE\n\t\tpos.xy +\x3d displacementDir * floor($uv0.y + 0.5) * displacementLen;\n\t\tpos.xy /\x3d screenSize;\n#else\n\t\tpos.xyz +\x3d displacementDir * floor($uv0.y + 0.5) * displacementLen;\n\t\tpos \x3d proj * view * model * pos;\n#endif\n\n\t\tvtc \x3d $uv0;\n\t\tvColor \x3d $color * 0.003921568627451; // \x3d 1/255\n\t\tgl_Position \x3d pos;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\n\x3csnippet name\x3d"fsRibbonLine"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n\tuniform vec4 eColor;\n\tvarying vec4 vColor;\n\tvarying vec2 vtc;\n\n#ifdef STIPPLE\n  uniform float stippleLengthDoubleInv;\n#endif\n\n\tvoid main() {\n\n#ifdef STIPPLE\n    if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\n      discard;\n    }\n#endif\n\n    gl_FragColor \x3d eColor * vColor;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsRibbonLineHighlight"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n#ifdef STIPPLE\n  uniform float stippleLengthDoubleInv;\n#endif\n\n\tvoid main() {\n#ifdef STIPPLE\n    if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\n      discard;\n    }\n#endif\n\n\t\tgl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/WaterMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vertexShaderWater"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tuniform mat4 proj;\n\tuniform mat4 view;\n\tuniform mat4 model;\n\tattribute vec3 $position;\n\tvarying vec3 vpos;\n\tvarying float linearDepth;\n\n\tvoid main(void) {\n\t\tvpos \x3d (model * vec4($position, 1.0)).xyz;\n\t\tgl_Position \x3d proj * view * vec4(vpos, 1.0);\n\t\tlinearDepth \x3d gl_Position.w;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderWater"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform vec3 color;\n\tuniform float scale;\n\tuniform float speed;\n\n\tuniform vec4 lightAmbient;\n\tuniform vec4 lightDiffuse;\n\tuniform vec4 lightSpecular;\n\tuniform vec3 lightDirection;\n\n\tuniform vec3 camPos;\n\n\tuniform sampler2D noiseTex;\n\tuniform sampler2D reflTex;\n\n\tuniform sampler2D depthTex;\n\tuniform int shadowMapNum;\n\tuniform vec4 shadowMapDistance;\n\tuniform mat4 shadowMapMatrix[4];\n\tuniform float depthHalfPixelSz;\n\n\tvarying vec3 vpos;\n\tvarying float linearDepth;\n\n\t$evalShadow\n\n\t$normal2envTC\n\n\tvec2 rotate(vec2 pos, float angle) {\n\t\tfloat c \x3d cos(angle);\n\t\tfloat s \x3d sin(angle);\n\t\treturn vec2(c * pos.x - s * pos.y, s * pos.x + c * pos.y);\n\t}\n\n\tfloat compDelta(vec2 pos) {\n\t\tconst float PI_THIRD \x3d 1.04719755;\n\n\t\tfloat result \x3d .0;\n\t\tfloat s \x3d 1.0;\n\t\tfor (int i \x3d 0; i \x3c 6; ++i) {\n\t\t\tvec2 tc \x3d pos / (20.0 * s);\n\t\t\ttc +\x3d rotate(vec2(1.0 + speed, .0), PI_THIRD * float(i));\n\t\t\tresult +\x3d s * texture2D(noiseTex, tc).r;\n\t\t\ts *\x3d 1.5;\n\t\t}\n\t\treturn result * scale * .2;\n\t}\n\n\tvoid main() {\n\t\tvec3 viewVec \x3d normalize(camPos - vpos);\n\n\t\tfloat d0 \x3d compDelta(vpos.xz);\n\t\tfloat dx \x3d compDelta(vpos.xz + vec2(.05, .0));\n\t\tfloat dz \x3d compDelta(vpos.xz + vec2(.0, .05));\n\n\t\tvec3 normal \x3d normalize(vec3(d0 - dx, .05, d0 - dz));\n\n\t\tfloat fresnel \x3d clamp(1.0 - 1.25 * dot(viewVec, normal), .0, 1.0);\n\n\t\tfloat shadow \x3d 0.0;\n\t\tif (halfPxSz \x3e\x3d .0) {\n\t\t\tshadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n\t\t}\n\n\t\tvec3 reflDir \x3d reflect(-viewVec, normal);\n\t\tif (reflDir.y \x3c .02) reflDir.y \x3d 0.04 - reflDir.y;\n\n\t\tvec3 reflCol \x3d texture2D(reflTex, normal2envTC(reflDir)).rgb * lightAmbient.rgb*lightSpecular.w;\n\t\treflCol *\x3d .5 + max(lightDirection.y, .0) * .5; // ?\t+\n\t\tvec3 waterColor \x3d color * (lightAmbient.rgb * lightAmbient.w + (1.0 - shadow) * max(lightDirection.y, .0) * lightDiffuse.rgb * lightDiffuse.w);\n\t\tvec3 finalColor \x3d mix(waterColor, reflCol, .15 + .6 * fresnel);\n\n\t\tvec3 spec \x3d pow(max(dot(reflDir, lightDirection), .001), 80.0) * lightSpecular.rgb * lightSpecular.w * 2.0;\n\t\tfinalColor +\x3d (1.0 - shadow) * lightDiffuse.w * spec;\n\n\t\tgl_FragColor \x3d vec4(finalColor, 1.0);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/MeasurementArrowMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vsMeasurementArrow"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform mat4 model;\n\n  uniform float width;\n\n  attribute vec3 $position;\n  attribute vec3 $normal;\n  attribute vec2 $uv0;\n  attribute float $auxpos1;\n\n  varying vec2 vtc;\n  varying float vlength;\n  varying float vradius;\n\n  void main(void) {\n    vec3 bitangent \x3d $normal;\n\n    vtc \x3d $uv0;\n    vlength \x3d $auxpos1;\n    vradius \x3d 0.5 * width;\n\n    vec4 pos \x3d view * vec4((model * vec4($position + vradius * bitangent * $uv0.y, 1.0)).xyz, 1.0);\n    gl_Position \x3d proj * pos;\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsMeasurementArrow"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  uniform float outlineSize;\n  uniform vec4 outlineColor;\n  uniform float stripeLength;\n  uniform vec4 stripeEvenColor;\n  uniform vec4 stripeOddColor;\n\n  varying vec2 vtc;\n  varying float vlength;\n  varying float vradius;\n\n  #define INV_SQRT2 (1.0 / sqrt(2.0))\n\n  vec4 arrowColor(vec2 tc, float len) {\n    float d \x3d INV_SQRT2 * (tc.x - abs(tc.y));\n    d \x3d min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\n    d \x3d min(d, 1.0 - abs(tc.y));\n\n    if (d \x3c 0.0) {\n      return vec4(0.0);\n    } else if (d \x3c outlineSize) {\n      return outlineColor;\n    } else {\n      return fract(0.5 / stripeLength * tc.x * vradius) \x3e\x3d 0.5 ? stripeOddColor : stripeEvenColor;\n    }\n  }\n\n  void main(void) {\n    vec2 ntc \x3d vec2(vtc.x / vradius, vtc.y);\n    vec4 color \x3d arrowColor(ntc, vlength / vradius);\n    if (color.a \x3d\x3d 0.0) {\n      discard;\n    }\n    gl_FragColor \x3d color;\n  }\n\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/internal/SimpleGLMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vertexShaderSimple"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tuniform mat4 proj;\n\tuniform mat4 view;\n\tuniform mat4 model;\n\tattribute vec3 $position;\n\n\tvoid main(void) {\n\t\tgl_Position \x3d proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderSimple"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform vec4 color;\n\n\tvoid main() {\n\t\tgl_FragColor \x3d color;\n\t}\n]]\x3e\x3c/snippet\x3e\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/internal/BlendLayers.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vertexShaderBlendLayers"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tattribute vec3 $position;\n\tattribute vec2 $uv0;\n\n\tuniform float scale;\n\tuniform vec2 offset;\n\n\tvarying vec2 uv;\n\n\tvoid main(void) {\n\t\tgl_Position \x3d vec4($position, 1.0);\n\t\tuv \x3d $uv0 * scale + offset;;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderBlendLayers"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n\tvarying vec2 uv;\n\n\tuniform sampler2D tex;\n\tuniform float opacity;\n\n\tvoid main() {\n\t\tvec4 color \x3d texture2D(tex, uv);\n\n    // Note: output in pre-multiplied alpha for correct alpha compositing\n\t\tgl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/terrain/TerrainMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vsTerrain"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform vec3 origin;\n  uniform vec2 texOffset;\n  uniform float texScale;\n  uniform mat4 viewNormal;\n\n  attribute vec3 $position;\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n  varying vec3 vpos;\n  varying vec3 vnormal;\n\n#ifdef RECEIVE_SHADOWS\n  varying float linearDepth;\n#endif\n\n#if defined(WIREFRAME) || defined(TILE_BORDERS)\n  varying vec2 vuv;\n#endif\n\n#ifdef ATMOSPHERE\n  uniform vec3 lightDirection;\n  varying vec3 wpos;\n  varying vec3 wview;\n  varying vec3 wnormal;\n  varying vec3 wlight;\n#endif\n\n#ifdef OVERLAY\n  uniform vec2 overlayTexOffset;\n  uniform vec2 overlayTexScale;\n  varying vec2 vtcOverlay;\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\n\n  uniform vec4 screenSizePerspective;\n\n  varying float screenSizeDistanceToCamera;\n  varying float screenSizeCosAngle;\n\n#endif\n\n  void main(void) {\n    vpos \x3d $position;\n\n#ifdef SPHERICAL\n    vnormal \x3d normalize(vpos + origin);\n#else\n    vnormal \x3d vec3(0, 0, 1); // WARNING: up-axis dependent code\n#endif\n\n#ifdef ATMOSPHERE\n    wpos \x3d (view * vec4(vpos, 1.0)).xyz;\n    wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\n    wlight \x3d (view  * vec4(lightDirection, 1.0)).xyz;\n#endif\n\n#if defined(WIREFRAME) || defined(TILE_BORDERS)\n    vuv \x3d $uv0;\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\n\n    vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\n\n    screenSizeDistanceToCamera \x3d length(viewPos);\n\n    vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\n    screenSizeCosAngle \x3d abs(viewSpaceNormal.z);\n\n#endif\n\n    gl_Position \x3d proj * view * vec4(vpos, 1.0);\n\n#ifdef RECEIVE_SHADOWS\n    // Shadowmap\'s cascading index used to be based on \'1.0 / gl_FragCoord.w\'\n    // (i.e. the perspective interpolation of \'gl_Position.w\'). Precision\n    // issues on iPad/iPhone with the \'w\' component require the depth to be\n    // passed as varying to properly drive the cascading shadow map index.\n    linearDepth \x3d gl_Position.w;\n#endif\n\n    vtc \x3d $uv0*texScale + texOffset;\n\n#ifdef OVERLAY\n    vtcOverlay \x3d $uv0*overlayTexScale + overlayTexOffset;\n#endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsTerrainCommon"\x3e\x3c![CDATA[\n  uniform vec3 lightDirection;\n  uniform vec3 viewDirection;\n  uniform sampler2D depthTex;\n  uniform int shadowMapNum;\n  uniform vec4 shadowMapDistance;\n  uniform mat4 shadowMapMatrix[4];\n  uniform float depthHalfPixelSz;\n  uniform sampler2D ssaoTex;\n  uniform vec4 viewportPixelSz;\n  uniform sampler2D tex;\n  uniform float opacity;\n\n  varying vec3 vpos;\n  varying vec3 vnormal;\n  varying vec2 vtc;\n\n#if defined(WIREFRAME) || defined(TILE_BORDERS)\n  varying vec2 vuv;\n#endif\n\n#ifdef ATMOSPHERE\n  varying vec3 wpos;\n  varying vec3 wview;\n  varying vec3 wnormal;\n  varying vec3 wlight;\n#endif\n\n  $sceneLightingDefinitions\n\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\n  $screenSizePerspective\n\n  uniform vec4 screenSizePerspective;\n\n  varying float screenSizeDistanceToCamera;\n  varying float screenSizeCosAngle;\n#endif\n\n  const vec3 ambient \x3d vec3(0.2,0.2,0.2);\n  const vec3 diffuse \x3d vec3(0.8,0.8,0.8);\n  const float diffuseHardness \x3d 2.5;\n\n#ifdef OVERLAY\n  uniform sampler2D overlayTex;\n  uniform float overlayOpacity;\n  varying vec2 vtcOverlay;\n#endif\n\n#ifdef RECEIVE_SHADOWS\n\tvarying float linearDepth;\n\t$evalShadow\n#endif\n\n  float lum(vec3 c) {\n    float max \x3d max(max(c.r, c.g), c.b);\n    float min \x3d min(min(c.r, c.g), c.b);\n    return (min + max) * 0.5;\n  }\n\n#ifdef ATMOSPHERE\n  vec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\n    vec3 surfaceColor   \x3d vec3(0.0);\n    vec3 fuzzySpecColor \x3d vec3(1.0);\n    vec3 subColor       \x3d vec3(0.0);\n    float rollOff       \x3d 1.0;\n\n    vec3 Ln \x3d normalize(lightPos);\n    vec3 Nn \x3d normalize(normal);\n    vec3 Hn \x3d normalize(view + Ln);\n\n    float ldn \x3d dot(Ln, Nn);\n    float diffComp \x3d max(0.0, ldn);\n    float vdn \x3d 1.0 - dot(view, Nn);\n    float ndv \x3d dot(view, Ln);\n\n    vec3 diffContrib \x3d surfaceColor * diffComp;\n    float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\n\n    vec3 subContrib \x3d subLamb * subColor;\n    vec3 vecColor \x3d vec3(vdn);\n\n    vec3 diffuseContrib \x3d (subContrib + diffContrib);\n    vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\n\n    return (diffContrib + specularContrib) * rollOff;\n  }\n#endif\n\n  void main() {\n    vec3 a \x3d ambient;\n\n    float shadow \x3d 0.0;\n#ifdef RECEIVE_SHADOWS\n    shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n#endif\n    float vndl \x3d dot(normalize(vnormal), lightDirection);\n    float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\n    vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\n\n    float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n    vec4 texCol \x3d texture2D(tex, vtc);\n\n#ifdef OVERLAY\n    if ((vtcOverlay.x \x3e 0.0) \x26\x26 (vtcOverlay.y \x3e 0.0) \x26\x26 (vtcOverlay.x \x3c 1.0) \x26\x26 (vtcOverlay.y \x3c 1.0)) {\n      vec4 overlayTexCol \x3d texture2D(overlayTex, vtcOverlay);\n      overlayTexCol *\x3d overlayOpacity;\n      texCol \x3d texCol * (1.0 - overlayTexCol.a) + overlayTexCol; // texCol and overlayTexCol have pre-multiplied alpha\n    }\n#endif\n\n    vec3 atm \x3d vec3(0.0);\n#ifdef ATMOSPHERE\n    float ndotl \x3d max(0.0, min(1.0, vndl));\n    atm \x3d atmosphere(wlight, wnormal, -viewDirection);\n    atm *\x3d max(0.0, min(1.0, (1.0-lum(texCol.rgb)*1.5))); //avoid atmosphere on bright base maps\n    atm *\x3d max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\n#endif\n\n    vec3 albedo \x3d atm + texCol.rgb;\n    vec3 normal \x3d normalize(vnormal);\n\n    // heuristic shading function used in the old terrain, now used to add ambient lighting\n    float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\n\t\tvec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n\n    gl_FragColor \x3d vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), texCol.a) * opacity;\n\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\n    // This is only used for debug rendering the screenSize perspective\n\n    float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\n\n    if (perspectiveScale \x3c\x3d 0.25) {\n      gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 0, 1), perspectiveScale * 4.0);\n    }\n    else if (perspectiveScale \x3c\x3d 0.5) {\n      gl_FragColor \x3d mix(gl_FragColor, vec4(0, 0, 1, 1), (perspectiveScale - 0.25) * 4.0);\n    }\n    else if (perspectiveScale \x3e\x3d 0.99) {\n      gl_FragColor \x3d mix(gl_FragColor, vec4(0, 1, 0, 1), 0.2);\n    }\n    else {\n      gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 1, 1), (perspectiveScale - 0.5) * 2.0);\n    }\n\n#endif\n\n  // closing } is missing here, it\'s in the shaders using this snippet below\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsTerrainWireframe"\x3e\x3c![CDATA[\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n\n  $fsprecisionf\n\n  struct WireframeSettings {\n    float width;\n    float falloff;\n    float subdivision;\n    vec4 color;\n    float wireOpacity;\n    float surfaceOpacity;\n  };\n\n  uniform WireframeSettings wireframe;\n\n    $fsTerrainCommon\n\n    vec2 vuvScaled \x3d vuv * wireframe.subdivision;\n    vec2 vuvMod \x3d fract(vuvScaled);\n\n#ifdef GL_OES_standard_derivatives\n    vec2 dVuv \x3d fwidth(vuvScaled);\n    dVuv \x3d max(vec2(0.00001), dVuv); // workaround against flickering skirts, see #10245\n#else\n    // Something that reasonably works\n    vec2 dVuv \x3d vec2(0.05);\n#endif\n\n    vec2 edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\n                                  wireframe.width * dVuv, min(vuvMod, 1.0 - vuvMod));\n\n    float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\n\n#ifdef WIREFRAME\n    gl_FragColor \x3d vec4(mix(gl_FragColor.rgb, wireframe.color.rgb, edgeFactor * wireframe.color.a),\n                        mix(wireframe.surfaceOpacity, wireframe.wireOpacity, edgeFactor));\n#endif\n\n\n#ifdef TILE_BORDERS\n    dVuv \x3d fwidth(vuv);\n    edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\n                              wireframe.width * dVuv, min(vuv, 1.0 - vuv));\n    edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\n\n    gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);\n#endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsTerrain"\x3e\x3c![CDATA[\n    $fsprecisionf\n    $fsTerrainCommon\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsTerrainNormal"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  uniform vec3 origin;\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform mat4 viewNormal;\n  attribute vec3 $position;\n  varying vec3 vnormal;\n\n  void main(void) {\n#ifdef SPHERICAL\n    vec4 normal \x3d vec4(normalize($position + origin), 1.0);\n#else\n    vec4 normal \x3d vec4(0.0, 1.0, 0.0, 1.0);\n#endif\n\n    gl_Position \x3d proj * view * vec4($position, 1.0);\n    vnormal \x3d normalize((viewNormal * normal).xyz);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsTerrainDepthOnly"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n\n  attribute vec3 $position;\n\n  void main() {\n    gl_Position \x3d proj * view * vec4($position, 1.0);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsTerrainDepthOnly"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  void main() {\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsTerrainHighlight"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform vec2 overlayTexScale;\n  uniform vec2 overlayTexOffset;\n\n  attribute vec3 $position;\n  attribute vec2 $uv0;\n\n  varying vec2 vtcOverlay;\n\n  void main() {\n    vtcOverlay \x3d $uv0*overlayTexScale + overlayTexOffset;\n\n    gl_Position \x3d proj * view * vec4($position, 1.0);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsTerrainHighlight"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D overlayTex;\n\n  uniform sampler2D depthTex;\n  uniform vec4 highlightViewportPixelSz;\n\n  varying vec2 vtcOverlay;\n\n  void main() {\n    vec4 texCol \x3d vec4(0,0,0,0);\n    if ((vtcOverlay.x \x3e 0.0) \x26\x26 (vtcOverlay.y \x3e 0.0) \x26\x26 (vtcOverlay.x \x3c 1.0) \x26\x26 (vtcOverlay.y \x3c 1.0)) {\n      texCol \x3d texture2D(overlayTex, vtcOverlay);\n    }\n\n    if (texCol.a \x3d\x3d 0.0) {\n      // Here we have to write black, instead of discarding the fragment in order to overwrite\n      // the highlights which might have been written by skirts of other tiles.\n      // As a consequence skirts are not visible, but terrain overwrites draped highlights.\n      gl_FragColor \x3d vec4(0,0,0,0);\n      return;\n    }\n\n    $highlightWrite\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"*now":function(A){A(['dojo/i18n!*preload*esri/views/nls/SceneView*["ar","ca","cs","da","de","el","en-gb","en-us","es-es","fi-fi","fr-fr","he-il","hu","it-it","ja-jp","ko-kr","nl-nl","nb","pl","pt-br","pt-pt","ru","sk","sl","sv","th","tr","zh-tw","zh-cn","ROOT"]'])},"*noref":1}});
define("../core/accessorSupport/watch dojo/_base/kernel dojo/dom dojo/Deferred dojo/when ./View ./BreakpointsOwner ./DOMContainer ./ViewAnimation ../geometry/HeightModelInfo ../geometry/SpatialReference ../geometry/support/scaleUtils ../geometry/support/webMercatorUtils ../Camera ../Graphic ../geometry/Point ../geometry/Extent ../geometry/ScreenPoint ../Viewpoint ../core/Scheduler ../core/sniff ../core/watchUtils ../core/promiseUtils ../core/Error ../core/Logger ../core/HandleRegistry ../webscene/Environment ./support/screenshotUtils ./support/WebGLRequirements ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/constraints/Constraints ./3d/input/SceneInputManager ./3d/lib/glMatrix ./3d/support/projectionUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Selector ./3d/support/CombinedElevationProvider ./3d/support/HighlightOptions ./3d/support/RenderCoordsHelper ./3d/support/MapCoordsHelper ./3d/support/ResourceController ./3d/support/DisplayQualityProfile ./3d/support/QualitySettings ./3d/support/SharedSymbolResources ./3d/support/pointsOfInterest/PointsOfInterest ./3d/support/debugFlags ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/layers/graphics/Deconflictor ./3d/layers/GraphicsView3D ./ui/3d/DefaultUI3D".split(" "),function(A,
p,w,l,h,d,u,r,a,k,c,t,C,q,v,y,B,D,b,m,E,J,G,K,M,U,N,W,R,V,Q,S,X,z,Z,O,g,e,f,n,x,I,L,P,Y,fa,ga,ia,na,ka,wa,ta,sa,aa){ga=ga["default"];Q=Q["default"];z=z["default"];var ya=M.getLogger("esri.views.SceneView");V=V.ViewState;var la=O.vec3d,za=la.create(),oa={point:new y(0,0,0),retval:null};ia=ia["default"];return r.createSubclass([d,u],{declaredClass:"esri.views.SceneView",properties:{activeTool:{value:null,set:function(a){if(a&&!this.ready)return void ya.error("#activeTool\x3d","cannot set active tool while view is not ready");
var b=this._get("activeTool");a!==b&&(b&&b.deactivate(this.inputManager._inputManager),this._set("activeTool",a),a&&a.activate(this.inputManager._inputManager))}},animation:{type:a,readOnly:!0,aliasOf:"state.animation"},basemapTerrain:{readOnly:!0,value:null},elevationProvider:{readOnly:!0,value:null},camera:{type:q,aliasOf:"stateManager.camera"},canvas:{readOnly:!0,value:null},center:{type:y,aliasOf:"stateManager.center"},clippingArea:{type:B,dependsOn:["map.clippingArea","map.clippingEnabled","viewingMode"],
get:function(){if("global"===this.viewingMode)return null;if(this._userClippingArea)return this._userClippingArea;var a=this.get("map.clippingEnabled"),b=this.get("map.clippingArea");return a&&b?b instanceof B?C.canProject(b.spatialReference,this.spatialReference)?(b=C.project(b,this.spatialReference),this._clippingArea&&b&&this._clippingArea.equals(b)?this._clippingArea:(this._clippingArea=b,b)):(ya.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):
(ya.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea):(this._clippingArea=null,null)},set:function(a){this.ready&&"global"===this.viewingMode&&a?ya.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):(this._userClippingArea=a,this.notifyChange("clippingArea"))}},constraints:{type:z,value:null},dataExtent:{dependsOn:["basemapTerrain.extent","clippingArea","map"],readOnly:!0,get:function(){function a(a){a&&(a=C.project(a,
d))&&(e&&(a=a.intersection(e)),a&&b.push(a))}var b=[],d=this.spatialReference||c.WGS84,e=this.clippingArea;e&&(e=C.project(e,d));var f=this._get("basemapTerrain");return(f&&f.spatialReference&&a(new B({xmin:f.extent[0],ymin:f.extent[1],zmin:0,xmax:f.extent[2],ymax:f.extent[3],zmax:0,spatialReference:f.spatialReference})),this.map&&this.map.allLayers.forEach(function(b){a(b.fullExtent)}),0<b.length)?(f=b.reduce(function(a,b){return a.union(b)}),f.hasZ?(f.zmin=Math.min(0,f.zmin),f.zmax=Math.max(0,f.zmax)):
(f.zmin=0,f.zmax=0),f):new B({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:d})}},environment:{value:null,set:function(a){return a!==this._defaults.environment&&(this._externallySet.environment=!0),a?void(a instanceof S?this._set("environment",a):a instanceof N?this.environment.lighting=a.lighting:a.declaredClass?this._set("environment",a):this._set("environment",new S(a))):void this._set("environment",new S)}},environmentManager:{},extent:{type:B,aliasOf:"stateManager.extent"},frustum:{aliasOf:"stateManager.frustum"},
fullOpacity:1,groundExtent:{dependsOn:["basemapTerrain.extent"],readOnly:!0,get:function(){var a=this._get("basemapTerrain");if(a&&a.spatialReference){var b=a.extent;return new B({xmin:b[0],ymin:b[1],xmax:b[2],ymax:b[3],spatialReference:a.spatialReference})}return new B({spatialReference:this.spatialReference||c.WGS84})}},initialExtentRequired:{dependsOn:["stateManager.hasInitialView"],get:function(){return!this.stateManager.hasInitialView}},interacting:{dependsOn:["state.interacting"],readOnly:!0,
get:function(){return!!this.state&&this.state.interacting}},map:{value:null},mapCoordsHelper:{},padding:{aliasOf:"stateManager.padding"},pointsOfInterest:ia,screenSizePerspectiveEnabled:!0,state:{readOnly:!0,value:null},stateManager:{readOnly:!0},inputManager:{},qualityProfile:{set:function(a){Y.isValidProfile(a)&&(Y.apply(a,this),this._set("qualityProfile",a))}},qualitySettings:{type:fa},ready:{dependsOn:["viewingMode"]},renderCoordsHelper:{},resolution:{dependsOn:["scale","spatialReference"],readOnly:!0,
get:function(){return null!=this.spatialReference?t.getResolutionForScale(this.scale,this.spatialReference):0}},scale:{aliasOf:"stateManager.scale"},spatialReference:{dependsOn:["map.initialViewProperties.spatialReference","defaultsFromMap.isSpatialReferenceDone"]},spatialReferenceWarningDelay:1E3,isHeightModelInfoRequired:!0,type:"3d",ui:{type:aa},updating:{},updatingPercentage:0,viewingMode:{dependsOn:["map.initialViewProperties.viewingMode","spatialReference"],get:function(){var a=this.get("map.initialViewProperties.viewingMode"),
b=this.spatialReference;return a||(a=!b||b.isWebMercator||b.isWGS84?"global":"local"),a},set:function(a){this._internallyReady?ya.error("#viewingMode","viewingMode cannot be set once view is ready"):0<=["local","global"].indexOf(a)?this._override("viewingMode",a):void 0===a&&this._clearOverride("viewingMode")}},viewpoint:{type:b,aliasOf:"stateManager.viewpoint"},zoom:{aliasOf:"stateManager.zoom"},highlightOptions:{type:x}},getDefaults:function(a){var b=this.inherited(arguments);return b.constraints||
a.constraints||(b.constraints=new z),b.environment||a.environment||(this._defaults.environment=new S,b.environment=this._defaults.environment),b.qualitySettings=new fa,b.qualityProfile=Y.getDefaultProfile(),b.highlightOptions=new x,b},constructor:function(){J.when(this,"ready",this._viewReadyHandler.bind(this));this._internallyReady=!1;this._initialProps={};this._initialDefaultSpatialReference=this._gotoTask=this._userClippingArea=null;this.inputManager=new Z({view:this});this.stateManager=new Q({view:this});
this._clippingArea=this._constraints=null;this._defaults={};this._externallySet={};this.resourceController=new P(this);this.deconflictor=new ta(this);this._evaluateUpdating=this._evaluateUpdating.bind(this);this._layerViewsUpdatingHandles={};this._stageHandles=new U;this.watch("map",function(a){a&&a.load&&a.load()})},initialize:function(){this.environmentManager=new X({view:this});this._updateUpdatingMonitorsHandle=this.allLayerViews.on("change",this._updateUpdatingMonitors.bind(this));this._updateUpdatingMonitors({added:this.allLayerViews.toArray(),
removed:[],moved:[]});J.whenNot(this,"ready",this._viewUnreadyHandler.bind(this));var a;J.init(this.defaultsFromMap,"isSpatialReferenceDone",function(b){var c=!!(this.map&&0<this.map.allLayers.length);b&&!this.spatialReference&&c||!a?b&&!this.spatialReference&&c&&!a&&(a=G.after(this.spatialReferenceWarningDelay),a.then(function(){ya.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")})):(a.cancel(),a=null)}.bind(this));J.init(this.qualitySettings,
"gpuMemoryLimit",function(a){this.resourceController&&this.resourceController.setMaxGpuMemory(a)}.bind(this))},destroy:function(){this.activeTool=null;A.dispatchTarget(this);this.environmentManager.destroy();this._disposeGraphicsView();this._updateUpdatingMonitorsHandle.remove();this._updateUpdatingMonitorsHandle=null;this._stageHandles.remove();this.inputManager&&(this.inputManager.destroy(),this.inputManager=null)},destroyLayerViews:function(){for(var a in this._layerViewsUpdatingHandles)this._layerViewsUpdatingHandles[a].remove();
this._layerViewsUpdatingHandles={};this.stateManager.deinit();this._disposeSurface();this.inherited(arguments);this._stage&&(this._stage.dispose(),this._stage=null,this._stageHandles.remove());this._setCanvas(null);this.deconflictor.destroy();this.deconflictor=null;this.resourceController.destroy();this.resourceController=null},on:function(a,b,c){var d=this.inputManager.viewEvents.register(a,b,c);return d?d:this.inherited(arguments)},toMap:function(a,b,c){if(!this.ready)return ya.error("#toMap()",
"Scene view cannot be used before it is ready"),null;a=this._normalizePointArgs(a,b,void 0,c);b=this._stage.pick([a.point.x,this.height-a.point.y]).getMinResult();return this._computeMapPointFromIntersectionResult(b,a.retval)},toScreen:function(a,b,c,d){if(!this.ready)return ya.error("#toScreen()","Scene view cannot be used before it is ready"),null;a=this._normalizePointArgs(a,b,c,d);return g.pointToVector(a.point,za,this.renderSpatialReference),this.engineToScreen(za,a.retval)},pixelSizeAt:function(a,
b,c){if(!this.ready)return ya.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if("esri.geometry.ScreenPoint"===a.declaredClass){if(!this._stage.pick([a.x,this.height-a.y]).getMinResult().getIntersectionPoint(za))return 0}else a=this._normalizePointArgs(a,b,c,void 0),g.pointToVector(a.point,za,this.renderSpatialReference);return this.state.camera.computePixelSizeAt(za)},hitTest:function(a,b){if(!this.ready)return ya.error("#hitTest()","Scene view cannot be used before it is ready"),
null;var c;a=this._normalizePointArgs(a,b,void 0,void 0);var d=[a.point.x,this.height-a.point.y],e=this._stage.pick(d,null,!0);a=e.getMinResult();var f=this._computeMapPointFromIntersectionResult(a);switch(a.targetType){case "None":c=null;break;case "StageObject":c=this._getGraphicFromStageObject(a.target,a.triangleNr);break;case "StagePoint":c=this._getGraphicFromStagePoint(a.target)}return h(c).otherwise(function(){return null}).then(function(a){var b=[];(a||f)&&b.push({mapPoint:f,graphic:a});a=
{screenPoint:d,results:b};return na.SCENEVIEW_HITTEST_RETURN_SELECTOR&&(a.selector=e),a})},goTo:function(a,b){return this.stateManager.goTo(a,b)},animateTo:function(a,b){return p.deprecated(this.declaredClass+".animateTo is deprecated. Use .goTo instead.","","4.0"),this.goTo(a,b)},takeScreenshot:function(a){if(!this.ready)return void ya.error("#takeScreenshot()","Scene view cannot be used before it is ready");a=W.adjustScreenshotSettings(a,this);var b=new l;return this._stage.requestScreenCapture(a,
function(a){m.schedule(function(){b.resolve(a)})}),b.promise},engineToScreen:function(a,b){var c=la.create();this.state.camera.projectPoint(a,c);a=c[0];var d=this.height-c[1],c=c[2];return b?(b.x=a,b.y=d,b.z=c,b):new D({x:a,y:d,z:c})},getDefaultSpatialReference:function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||this.get("defaultsFromMap.isSpatialReferenceDone")&&this._initialDefaultSpatialReference||null},validate:function(){var a=
R.check();return E("safari")&&9>E("safari")&&(a=new K("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:E("safari")})),a?(ya.warn("#validate()",a.message),G.reject(a)):G.resolve()},isSpatialReferenceSupported:function(a,b){var c=a.isGeographic,d=a.isWebMercator,e=a.isWGS84,f="local"===this.viewingMode,g=!(!this._isOverridden("viewingMode")&&!this.get("map.initialViewProperties.viewingMode"));if(g){if(f&&
c||!f&&!d&&!e)return!1}else if(c&&!e)return!1;if(b)if(wa.isTiledLayer(b)){if(g?c=wa.getTiledLayerInfo(b,a,this.viewingMode):(c=wa.getTiledLayerInfo(b,a,"global"),null==c.tileInfo&&(c=wa.getTiledLayerInfo(b,a,"local"))),null==c.tileInfo)return!1}else if((e||d)&&!f)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=a),g||this._internallyReady||(this.viewingMode="global"),!1;return!0},has:function(a){return this._stage.has(a)},flushDisplayModifications:function(){this._stage.processDirty()},
getDrawingOrder:function(a){return this.allLayerViews.findIndex(function(b){return b.layer&&b.layer.uid===a})},getViewForGraphic:function(a){return a.layer?this.allLayerViews.find(function(b){return b.layer===a.layer}):this._graphicsView},whenViewForGraphic:function(a){return a.layer?this.whenLayerView(a.layer):G.resolve(this._graphicsView)},renderSpatialReference:null,_graphicsView:null,_surfaceReadyWatchHandle:null,_stageHandles:null,_computeMapPointFromIntersectionResult:function(a,b){if(a.getIntersectionPoint(za)){b=
this._computeMapPointFromVec3d(za,b);var c=this._get("basemapTerrain");"terrain"===a.intersector&&c&&(a=c.getElevation(b),null!==a&&(b.z=a));return b}return null},_computeMapPointFromVec3d:function(a,b){var d=this.spatialReference||c.WGS84;return g.vectorToVector(a,this.renderSpatialReference,a,d)||(d=c.WGS84,g.vectorToVector(a,this.renderSpatialReference,a,d)),b?(b.x=a[0],b.y=a[1],b.z=a[2],b.spatialReference=d):b=new y(a,d),b},_getGraphicFromStageObject:function(a,b){var c=a.getMetadata();if(null!=
c&&null!=c.layerUid){if(c.layerUid===this._graphicsView.mockLayerId)return this._graphicsView.getGraphicsFromStageObject(a,b);if(c=this.map.findLayerByUid(c.layerUid))return this.whenLayerView(c).then(function(c){return c&&null!=c.getGraphicsFromStageObject&&!c.suspended?c.getGraphicsFromStageObject(a,b):void 0})}return null},_getGraphicFromStagePoint:function(a){var b=this._computeMapPointFromVec3d(a.point),b=new v(b);a=a.metadata.layerUid;return null!=a&&(b.layer=this.map.findLayerByUid(a)),b},
_viewingModeToManifold:function(a){return{local:"planar",global:"spherical"}[a]},_initBasemapTerrain:function(a){this._disposeBasemapTerrain();this._set("basemapTerrain",new ka(this,this._viewingModeToManifold(a)));this._set("elevationProvider",new n({view:this}));this.elevationProvider.register("ground",this.basemapTerrain)},_initGlobe:function(a){this._initCoordinateSystem();this._initState();this._stage.setViewParams({backgroundColor:[0,0,0,0],maxFarNearRatio:0,frustumCullingEnabled:!1});this._initBasemapTerrain(a);
this.pointsOfInterest=new ia({view:this});this._initStateManager()},_initCoordinateSystem:function(){if(this.spatialReference){var a=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(a)||(this.mapCoordsHelper=new L(this.map,a));var b=this.renderCoordsHelper?this.renderCoordsHelper.unitInMeters:1,c="global"===this.viewingMode,a=c?g.SphericalECEFSpatialReference:a;a!==this.renderSpatialReference&&(this.renderSpatialReference=a,this.renderCoordsHelper=I.createRenderCoordsHelper(c?
"global":"local",a),this._stage&&this._stage.setIntersectTolerance(f.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters),this._constraints)&&this._constraints.scale(b/this.renderCoordsHelper.unitInMeters)}else this.renderSpatialReference=this.renderCoordsHelper=this.mapCoordsHelper=null},_cameraAlmostEquals:function(a,b){return 1E-5>Math.abs(a.tilt-b.tilt)&&1E-5>Math.abs(a.heading-b.heading)&&1E-5>Math.abs(a.fov-b.fov)&&a.position.equals(b.position)},_evaluateUpdating:function(){var a=0,b=0,c=
!1;this.allLayerViews.forEach(function(d){d.updating&&(c=!0,d=d.updatingPercentage,null!=d&&(++b,a+=d))});this._graphicsView&&this._graphicsView.updating&&(c=!0);c!==this.updating&&(this.updating=c);0!==b?a/=b:a=c?100:0;this.updatingPercentage!==a&&(this.updatingPercentage=a)},_updateUpdatingMonitors:function(a){for(var b=0;b<a.removed.length;b++){var c=a.removed[b],d=this._layerViewsUpdatingHandles[c.uid];d&&(delete this._layerViewsUpdatingHandles[c.uid],c.destroyed||d.remove())}for(b=0;b<a.added.length;b++)c=
a.added[b],c.destroyed||(d=c.watch(["updating","updatingPercentage"],this._evaluateUpdating),this._layerViewsUpdatingHandles[c.uid]=d);this._evaluateUpdating()},_pickRay:function(a,b,c,d,e,f,g){return this._stage?this._stage.pickRay(a,b,c,d,e,f,g):null},_pickRayWithBeginPoint:function(a,b,c,d,e){return this._stage?this._stage.pickRayWithBeginPoint(a,b,c,d,e):null},_removeHandles:function(a){for(var b=0;b<a.length;b++){var c=a[b];this[c]&&(this[c].remove(),this[c]=null)}},_setCanvas:function(a){a!==
this._get("canvas")&&this._set("canvas",a)},_disposeSurface:function(){this._removeHandles(["_stageFrameTask","_updateDrawingOrderHandle","onViewExtentUpdateHandle","_mapLayersChangeHandle"]);this.pointsOfInterest&&(this.pointsOfInterest.destroy(),this.pointsOfInterest=null);this._disposeBasemapTerrain();this._setNavigation(null);this.environmentManager&&this.environmentManager.disposeRendering()},_disposeBasemapTerrain:function(){var a=this._get("basemapTerrain");a&&(a.destroy(),this._set("basemapTerrain",
null))},_disposeNavigation:function(){var a=this._get("navigation");a&&(a.destroy(),this._set("navigation",null))},_setNavigation:function(a){this._get("navigation")!==a&&(this._disposeNavigation(),this._set("navigation",a))},_initStage:function(){var a={};a.deactivatedWebGLExtensions=this.deactivatedWebGLExtensions;a.viewingMode=this.viewingMode;this.renderCanvas&&(a.canvas=this.renderCanvas);this._stage=new e(this.viewingMode,w.byId(this.surface),a);this._stage.selectionState=!1;this._stageHandles.add(J.init(this.qualitySettings,
"antialiasingEnabled",function(){this._stage.setRenderParams({antialiasingEnabled:this.qualitySettings.antialiasingEnabled})}.bind(this)));this._stageHandles.add(J.watch(this,this.highlightOptions.keys().map(function(a){return"highlightOptions."+a}),function(){this._stage.setRenderParams({defaultHighlightOptions:x.toEngineOptions(this.highlightOptions)})}.bind(this)));this._stageHandles.add(J.init(this,"highlightOptions",function(){this._stage.setRenderParams({defaultHighlightOptions:x.toEngineOptions(this.highlightOptions)})}.bind(this)));
this.renderCoordsHelper&&this._stage.setIntersectTolerance(f.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._setCanvas(this._stage.getCanvas());this._stageFrameTask=m.addFrameTask(this._stage.getFrameTask())},_initSurface:function(){this._initStage();this._initGlobe(this.viewingMode);this.sharedSymbolResources=new ga({stage:this._stage,viewingMode:this.viewingMode,resourceController:this.resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})},_initGraphicsView:function(){this._surfaceReadyWatchHandle=
J.whenTrueOnce(this,"basemapTerrain.ready",function(){this._graphicsView=new sa({view:this,graphics:this.graphics});this._surfaceReadyWatchHandle=null;this._layerViewsUpdatingHandles[this._graphicsView.mockLayerId]=J.init(this._graphicsView,"updating",this._evaluateUpdating)}.bind(this))},_disposeGraphicsView:function(){if(this._surfaceReadyWatchHandle&&(this._surfaceReadyWatchHandle.remove(),this._surfaceReadyWatchHandle=null),this._graphicsView){var a=this._graphicsView.mockLayerId;this._layerViewsUpdatingHandles[a].remove();
delete this._layerViewsUpdatingHandles[a];this._graphicsView.destroy();this._graphicsView=null}},_normalizePointArgs:function(a,b,d,e,f){f=f||oa;var g=f.point;return g.spatialReference=void 0,"object"==typeof a?(g.x=a.x,g.y=a.y,g.z=a.z,a.spatialReference&&(g.spatialReference=a.spatialReference),f.retval=b):(g.x=a,g.y=b,"number"!=typeof d&&void 0!==d?(g.z=void 0,f.retval=d):(g.z=d,f.retval=e)),g.spatialReference||(g.spatialReference=this.spatialReference||c.WGS84),f},_initState:function(){this._set("state",
new V({viewingMode:this.viewingMode,spatialReference:this.spatialReference}))},_initStateManager:function(){this.stateManager.init()},_viewReadyHandler:function(a,b){b||(("global"===this.viewingMode&&(this._clippingArea=null),this._internallyReady=!0,this._initSurface(),this._initGraphicsView(),this._externallySet.environment)||(a=this.get("map.initialViewProperties.environment"))&&(this.environment=a),this._updateDrawingOrderHandle=this.allLayerViews.on("change",this._updateDrawingOrder.bind(this)),
this._updateDrawingOrder({added:this.allLayerViews.toArray(),removed:[],moved:[]}),this.environmentManager.updateReadyChange(!0))},_viewUnreadyHandler:function(a,b){b&&(this.activeTool&&(this.activeTool.deactivate(this.inputManager._inputManager),this._set("activeTool",null)),this._initialDefaultSpatialReference=null,this.environmentManager.updateReadyChange(!1),this._disposeGraphicsView(),this._internallyReady=!1,this.stateManager.deinit(),this._disposeSurface(),this.state.destroy(),this._set("state",
null),this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null),this._stage&&(this._stage.dispose(),this._stage=null,this._stageHandles.remove()),this._setCanvas(null))},_heightModelInfoGetter:function(){var a=this.getDefaultHeightModelInfo();return null!=a?k.deriveUnitFromSR(a,this.spatialReference):null},_isIncompatibleSpatialReference:function(a){return a&&!a.equals(this.spatialReference)&&!C.canProject(a,this.spatialReference)},_updateDrawingOrder:function(){var a=
this.allLayerViews.length-1;this.allLayerViews.forEach(function(b,c){null!=b.drawingOrder&&(b.drawingOrder=a-c)},this)},_mapSetter:function(a){a!==this._get("map")&&(this._mapLayersChangeHandle&&(this._mapLayersChangeHandle.remove(),this._mapLayersChangeHandle=null),a&&(this._mapLayersChangeHandle=a.allLayers.on("change",this.notifyChange.bind(this,"dataExtent"))),this.inherited(arguments))}})});