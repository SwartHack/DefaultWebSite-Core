//>>built
define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ../../core/ArrayPool ./Bucket ../2d/engine/webgl/Geometry ../../core/libs/earcut/earcut".split(" "),function(F,G,C,H,y,D,z,E){return function(B){function d(a,b,h,c,k,e){b=B.call(this,a,b)||this;if(a.hasDataDrivenFill!==h.isDataDriven())throw Error("incompatible fill buffer");if(a.hasDataDrivenOutline!==k.isDataDriven())throw Error("incompatible outline buffer");return b._fillVertexBuffer=h,b._fillIndexBuffer=
c,b._outlineVertexBuffer=k,b._outlineIndexBuffer=e,b}return C(d,B),Object.defineProperty(d.prototype,"fillIndexStart",{get:function(){return this._fillIndexStart},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"fillIndexCount",{get:function(){return this._fillIndexCount},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"outlineIndexStart",{get:function(){return this._outlineIndexStart},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"outlineIndexCount",
{get:function(){return this._outlineIndexCount},enumerable:!0,configurable:!0}),d.prototype.assignBufferInfo=function(a){a._fillIndexStart=this._fillIndexStart;a._fillIndexCount=this._fillIndexCount;a.layer.getPaintProperty("fill-outline-color")?(a._outlineIndexStart=this._outlineIndexStart,a._outlineIndexCount=this._outlineIndexCount):(a._outlineIndexStart=0,a._outlineIndexCount=0)},d.prototype.processFeatures=function(a,b){this._fillIndexStart=this._fillIndexBuffer.index;this._fillIndexCount=0;
this._outlineIndexStart=this._outlineIndexBuffer.index;this._outlineIndexCount=0;b=this.layer;var h=this.zoom,c=b.hasDataDrivenFill,k=b.hasDataDrivenOutline;a&&a.setExtent(this.layerExtent);for(var e=b.getPaintValue("fill-pattern",h),n=b.getPaintValue("fill-antialias",h)&&void 0===e,d=0,p=this._features;d<p.length;d++){var l=p[d],q=void 0;c&&(q={color:e?[1,1,1,1]:b.getPaintValue("fill-color",h,l),opacity:b.getPaintValue("fill-opacity",h,l)});var g=void 0;k&&(g={color:e?[1,1,1,1]:b.getPaintValue("fill-outline-color",
h,l),opacity:b.getPaintValue("fill-opacity",h,l)});l=l.getGeometry(a);this._processFeature(l,n,q,g)}},d.prototype._processFeature=function(a,b,h,c){if(a){var k=a.length;if(b)for(b=0;k>b;b++)this._processOutline(a[b],c);var e;for(b=0;k>b;b++)c=d._area(a[b]),128<c?(void 0!==e&&this._processFill(a,e,h),e=[b]):-128>c&&void 0!==e&&e.push(b);void 0!==e&&this._processFill(a,e,h)}},d.prototype._processOutline=function(a,b){var h,c,k,e=this._outlineVertexBuffer,n=this._outlineIndexBuffer,d=n.index,p=new z.Point(0,
0),l=new z.Point(0,0),q=new z.Point(0,0),g=-1,f=-1,m=-1,t=-1,x=-1,A=!1,u=a.length;if(!(2>u)){for(var w=a[0],r=a[u-1];u&&r.isEqual(w);)--u,r=a[u-1];if(!(2>u-0)){for(w=0;u>w;++w){0===w?(h=a[u-1],c=a[0],k=a[1],p.assignSub(c,h),p.normalize(),p.rightPerpendicular()):(h=c,c=k,k=w!==u-1?a[w+1]:a[0],p.assign(l));r=this._isClipEdge(h,c);-1===t&&(A=r);l.assignSub(k,c);l.normalize();l.rightPerpendicular();var y=p.x*l.y-p.y*l.x;q.assignAdd(p,l);q.normalize();var v=-q.x*-p.x+-q.y*-p.y,v=Math.abs(0!==v?1/v:1);
8<v&&(v=8);0<=y?(m=e.add(c.x,c.y,p.x,p.y,0,1,b),-1===t&&(t=m),0<=g&&0<=f&&0<=m&&!r&&n.add(g,f,m),f=e.add(c.x,c.y,v*-q.x,v*-q.y,0,-1,b),-1===x&&(x=f),0<=g&&0<=f&&0<=m&&!r&&n.add(g,f,m),g=f,f=m,m=e.add(c.x,c.y,q.x,q.y,0,1,b),0<=g&&0<=f&&0<=m&&!r&&n.add(g,f,m),f=e.add(c.x,c.y,l.x,l.y,0,1,b),0<=g&&0<=f&&0<=m&&!r&&n.add(g,f,m)):(m=e.add(c.x,c.y,v*q.x,v*q.y,0,1,b),-1===t&&(t=m),0<=g&&0<=f&&0<=m&&!r&&n.add(g,f,m),f=e.add(c.x,c.y,-p.x,-p.y,0,-1,b),-1===x&&(x=f),0<=g&&0<=f&&0<=m&&!r&&n.add(g,f,m),g=f,f=m,
m=e.add(c.x,c.y,-q.x,-q.y,0,-1,b),0<=g&&0<=f&&0<=m&&!r&&n.add(g,f,m),g=e.add(c.x,c.y,-l.x,-l.y,0,-1,b),0<=g&&0<=f&&0<=m&&!r&&n.add(g,f,m))}0<=g&&0<=f&&0<=t&&!A&&n.add(g,f,t);0<=g&&0<=t&&0<=x&&!A&&n.add(g,x,t);this._outlineIndexCount+=3*(n.index-d)}}},d.prototype._processFill=function(a,b,h){var c;1<b.length&&(c=[]);for(var k=0,e=0;e<b.length;e++){var n=b[e];0!==k&&c.push(k);k+=a[n].length}for(var e=2*k,k=y.acquire(),d=0;d<b.length;d++)for(var n=b[d],n=a[n],p=n.length,l=0;p>l;++l)k.push(n[l].x),k.push(n[l].y);
a=E(k,c,2);b=a.length;if(0<b){c=this._fillVertexBuffer.index;for(d=0;e>d;)this._fillVertexBuffer.add(k[d++],k[d++],h);for(h=0;b>h;)this._fillIndexBuffer.add(c+a[h++],c+a[h++],c+a[h++]);this._fillIndexCount+=b}y.release(k)},d.prototype._isClipEdge=function(a,b){return a.x===b.x?-64>=a.x||4160<=a.x:a.y===b.y?-64>=a.y||4160<=a.y:!1},d._area=function(a){for(var b=0,d=a.length-1,c=0;d>c;c++)b+=(a[c].x-a[c+1].x)*(a[c].y+a[c+1].y);return b+=(a[d].x-a[0].x)*(a[d].y+a[0].y),.5*b},d}(D)});