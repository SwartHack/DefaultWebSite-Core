//>>built
define(["require","exports","./Placement"],function(u,v,t){return function(){function m(a,e,f,c,n,b,p,d){this._glyphItems=a;this._maxWidth=e;this._lineHeight=f;this._letterSpacing=c;this._offset=n;this._hAnchor=b;this._vAnchor=p;this._justify=d}return m.prototype.getShaping=function(a,e){for(var f=this._letterSpacing,c=this._offset[0],n=this._offset[1],b=[],p=a.length,d=0;p>d;d++){for(var h=a.charCodeAt(d),q=void 0,g=0,r=this._glyphItems;g<r.length&&!(q=r[g][h]);g++);q&&(b.push(new t.ShapedGlyph(h,
c,n,q)),c+=q.metrics.advance+f)}if(0<b.length){q=this._maxWidth;a=this._lineHeight;c=this._justify;n=b.length;h=p=f=0;if(0!==q)for(d=r=g=0;n>d;d++){var k=b[d];if(k.x-=r,e?k.y-=a*f:k.y+=a*f,k.x>q&&0<g){for(var m=b[g+1].x,h=Math.max(m,h),l=g+1;d>=l;l++)e?b[l].y-=a:b[l].y+=a,b[l].x-=m;c&&this._applyJustification(b,p,g-1);p=g+1;g=0;r+=m;f++}32===k.glyph&&(g=d)}d=b[n-1];h=Math.max(h,d.x+d.glyphItem.metrics.advance);c&&this._applyJustification(b,p,n-1);d=(c-this._hAnchor)*h;c=(-this._vAnchor*(f+1)+.5)*
a;e&&f&&(c+=f*a);for(e=0;e<b.length;e++)a=b[e],a.x+=d,a.y+=c}return b},m.prototype._applyJustification=function(a,e,f){for(var c=a[f],c=(c.x+c.glyphItem.metrics.advance)*this._justify;f>=e;e++)a[e].x-=c},m}()});