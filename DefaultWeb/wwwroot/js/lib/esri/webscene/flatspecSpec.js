//>>built
define(["require","exports","./schema","../core/promiseUtils"],function(t,n,g,q){function p(a,c,d,e){var k=[],b;a:{if(c.properties){if("layerType"in c.properties){b=c.properties.layerType["enum"][0];break a}if("type"in c.properties){b=c.properties.type["enum"][0];break a}}b=void 0}return b&&/<\?TYPE\?>/.test(d)?d=d.replace("?TYPE?",b):d.indexOf("\x3c?TYPE?\x3e")&&(d=d.replace("\x3c?TYPE?\x3e","")),e.classPaths&&(e.classPaths[d]=a),0<e.schemaPath.indexOf(a)?k.push({path:d,type:"LOOP0!"}):(e.schemaPath.push(a),
k=m(c,d,e),e.schemaPath.pop()),k}function r(a,c,d){a=a.$ref.replace("#/definitions/","");return p(a,d.definitions[a],c,d)}function m(a,c,d){var e=[],k=d.filteredProperties;if(d.filteredProperties=null,"array"===a.type)e=e.concat(m(a.items,c+"[]",d));else if("properties"in a)for(var b in a.properties){if(!k||k.has(b))e=e.concat(m(a.properties[b],c?c+"."+b:b,d))}else if("allOf"in a){var h=null,g=new Set;b=0;for(a=a.allOf;b<a.length;b++){var l=a[b];if("$ref"in l){if(h)throw Error("Cannot process more than 1 ref in an allOf construct");
h=l}else{if(!("properties"in l))throw Error("allOf construct only allows simple top-level property filters");for(var f in l.properties)g.add(f)}}a=d.filteredProperties;d.filteredProperties=g;e=e.concat(r(h,c,d));d.filteredProperties=a}else if("oneOf"in a){f=a.oneOf;b={cnt:f.length,refsCnt:0,typesCnt:0,distinctTypes:[],summary:""};for(g in f)l=f[g],l.$ref?b.refsCnt++:l.type&&b.typesCnt++;f=(b.distinctTypes=Object.keys(b.distinctTypes),b.refsCnt===b.cnt?b.summary="refs":2===b.cnt&&0<b.refsCnt&&1===
b.distinctTypes.length&&"null"===b.distinctTypes[0]?b.summary="refsAndNull":b.typesCnt===b.cnt?(b.summary="types",b.distinctTypes=b.distinctTypes):b.summary="mix",b);if("refs"===f.summary||"refsAndNull"===f.summary)for(h in a.oneOf)"null"!==a.oneOf[h].type&&(f="\x3c?TYPE?\x3e",e=e.concat(m(a.oneOf[h],""+c+f,d)));else if("types"===f.summary)e.push({path:c,type:f.distinctTypes.join("|")});else for(h in a.oneOf)f=".oneOf["+h+"]",e=e.concat(m(a.oneOf[h],""+c+f,d))}else"$ref"in a?e=e.concat(r(a,c,d)):
(f="unknown",a.type&&(f=Array.isArray(a.type)?a.type.join("|"):a.type.replace(/ /g,"").split(",").join("|")),c={path:c,type:f},a["enum"]&&(c["enum"]=a["enum"].join("|")),e.push(c));return d.filteredProperties=k,e}Object.defineProperty(n,"__esModule",{value:!0});n.scan=function(a){var c=p(a||"webScene",a?g.json.definitions[a+"_schema.json"]:g.json,"",{definitions:g.json.definitions,schemaPath:[]});return c.sort(function(a,c){return a.path.localeCompare(c.path)}),q.resolve(c.filter(function(a,e){return 0===
e||c[e-1].path!==a.path}))};n.collectClassPaths=function(a){var c={definitions:g.json.definitions,schemaPath:[],classPaths:{}};return p(a||"webScene",a?g.json.definitions[a+"_schema.json"]:g.json,"",c),q.resolve(c.classPaths)}});