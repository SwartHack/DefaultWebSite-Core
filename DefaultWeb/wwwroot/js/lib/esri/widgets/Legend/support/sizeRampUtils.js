//>>built
define(["require","exports","../../../symbols/support/symbolUtils","../../../core/numberUtils","./utils"],function(M,p,u,r,z){function C(a,b){var c=null,e=null;if("simple"===a.type)c=a.symbol;else if("unique-value"===a.type||"class-breaks"===a.type)c=(c=(a=a.classBreakInfos||a.uniqueValueInfos)&&a[0])&&c.symbol,e=1<a.length;if(!c||D(c))b=null;else{c=c.clone();if(b||e)-1<c.type.indexOf("3d")?E(c):(b=c,-1!==b.type.indexOf("line")?b.color=n:(b.color=w,"simple-marker"===b.type&&(b.outline={color:n,width:1.5})));
b=c}return b}function D(a){if(a)return-1<a.type.indexOf("3d")?(a=a.symbolLayers)?a.some(function(a){return a&&"fill"===a.type}):!1:-1!==a.type.indexOf("fill")}function E(a){u.isVolumetricSymbol(a)||(-1!==a.type.indexOf("line-3d")?a.symbolLayers.forEach(function(a){a.material={color:n}}):a.symbolLayers.forEach(function(a){"icon"!==a.type||a.resource&&a.resource.href?a.material={color:F}:(a.material={color:w},a.outline={color:n,size:1.5})}))}function G(a,b,c,e){var d=a.getSizeRangeAtScale(b,e),k=d&&
H(d);if(d||k){for(var h=k.map(function(a){var c=d.minSize,e=d.maxSize,f=b.minDataValue,q=b.maxDataValue;return c>=a?f:a>=e?q:(a-c)/(e-c)*(q-f)+f}),h=r.round(h),f=1;f<h.length-1;f++){var l=I(a,b,c,h[f],h[f-1],e);l&&(h[f]=l[0],k[f]=l[1])}return h}}function H(a){var b=a.minSize,c=J;a=(a.maxSize-b)/(c-1);for(var e=[],d=0;c>d;d++)e.push(b+a*d);return e}function I(a,b,c,e,d,k){var h=v(a,b,c,e,k);d=v(a,b,c,d,k);var f=r.numDigits(e),l=f.fractional,A=K,g=f.integer,t=f=null;0<e&&1>e&&(f=Math.pow(10,l),e*=f,
g=r.numDigits(e).integer);for(l=g-1;0<=l;l--){var m=Math.pow(10,l),g=Math.floor(e/m)*m,m=Math.ceil(e/m)*m;null!=f&&(g/=f,m/=f);var q=(g+m)/2,q=r.round([g,q,m],{indexes:[1]}),q=q[1],B=v(a,b,c,g,k),p=v(a,b,c,m,k),n=v(a,b,c,q,k),u=r.percentChange(h,B,d,null),w=r.percentChange(h,p,d,null),z=r.percentChange(h,n,d,null),x=u.previous<=A,y=w.previous<=A;if(x&&y&&(u.previous<=w.previous?(x=!0,y=!1):(y=!0,x=!1)),x?t=[g,B]:y?t=[m,p]:z.previous<=A&&(t=[q,n]),t)break}return t}function v(a,b,c,e,d){return a.getSize(e,
{sizeInfo:b,scale:d,shape:-1!==c.type.indexOf("marker-symbol")?c.style:null})}function L(a,b){a=a.clone();if("esri.symbols.Symbol3D"===a.declaredClass)u.isVolumetricSymbol(a)||a.symbolLayers.forEach(function(a){"fill"!==a.type&&(a.size=b)});else if("esri.symbols.SimpleMarkerSymbol"===a.declaredClass)a.size=b;else if("esri.symbols.PictureMarkerSymbol"===a.declaredClass){var c=a.width,e=a.height;a.height=b;a.width=c/e*b}else"esri.symbols.SimpleLineSymbol"===a.declaredClass?a.width=b:"esri.symbols.TextSymbol"===
a.declaredClass&&a.font&&(a.font.size=b);return a}Object.defineProperty(p,"__esModule",{value:!0});p.REAL_WORLD_MAX_SIZE=30;p.REAL_WORLD_MIN_SIZE=12;var w=[255,255,255],F=[200,200,200],n=[128,128,128],K=20,J=5;p.getRampStops=function(a,b,c,e){var d=b.legendOptions,d=d&&d.customValues,k=C(a,c);c=null!=b.minSize&&null!=b.maxSize;var h=b.stops&&1<b.stops.length,f=!!b.target;if(k&&(d||c||h&&!f)){var l=u.isVolumetricSymbol(k),n=null,g=null,t=null,g=l&&!h?[b.minDataValue,b.maxDataValue]:d||G(a,b,k,e);!g&&
h&&(g=b.stops.map(function(a){return a.value}),n=b.stops.some(function(a){return!!a.label}),n&&(t=b.stops.map(function(a){return a.label})));d=!l||g&&2===g.length;if(!g||!d)return null;var m=[p.REAL_WORLD_MIN_SIZE,p.REAL_WORLD_MAX_SIZE];return g.map(function(c,d){var f=l?m[d]:v(a,b,k,c,e),h=L(k,f);d=n?t[d]:z.getLabelPrefix(d,g.length-1)+r.format(c);return{value:c,symbol:h,label:d,size:f}}).reverse()}}});